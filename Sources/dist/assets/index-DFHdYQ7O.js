const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-ClsPfYEg.js","./matrix-sdk-crypto-wasm-DGXDpLaN.js","./polyfill-force--UtEEfcF.js","./index-yNRC6NoK.js","./polyfill-force-BPMH2I58.js"])))=>i.map(i=>d[i]);
function Zne(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var $Ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function BGe(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var yT={exports:{}},Em={},_T={exports:{}},bt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _O;function Qne(){if(_O)return bt;_O=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function p(q){return q===null||typeof q!="object"?null:(q=h&&q[h]||q["@@iterator"],typeof q=="function"?q:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,g={};function S(q,Q,Se){this.props=q,this.context=Q,this.refs=g,this.updater=Se||m}S.prototype.isReactComponent={},S.prototype.setState=function(q,Q){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,Q,"setState")},S.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function b(){}b.prototype=S.prototype;function R(q,Q,Se){this.props=q,this.context=Q,this.refs=g,this.updater=Se||m}var k=R.prototype=new b;k.constructor=R,v(k,S.prototype),k.isPureReactComponent=!0;var I=Array.isArray,T=Object.prototype.hasOwnProperty,C={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function M(q,Q,Se){var Ie,Ne={},Le=null,xe=null;if(Q!=null)for(Ie in Q.ref!==void 0&&(xe=Q.ref),Q.key!==void 0&&(Le=""+Q.key),Q)T.call(Q,Ie)&&!P.hasOwnProperty(Ie)&&(Ne[Ie]=Q[Ie]);var Ee=arguments.length-2;if(Ee===1)Ne.children=Se;else if(1<Ee){for(var Ce=Array(Ee),Ve=0;Ve<Ee;Ve++)Ce[Ve]=arguments[Ve+2];Ne.children=Ce}if(q&&q.defaultProps)for(Ie in Ee=q.defaultProps,Ee)Ne[Ie]===void 0&&(Ne[Ie]=Ee[Ie]);return{$$typeof:n,type:q,key:Le,ref:xe,props:Ne,_owner:C.current}}function D(q,Q){return{$$typeof:n,type:q.type,key:Q,ref:q.ref,props:q.props,_owner:q._owner}}function F(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function U(q){var Q={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(Se){return Q[Se]})}var B=/\/+/g;function V(q,Q){return typeof q=="object"&&q!==null&&q.key!=null?U(""+q.key):Q.toString(36)}function z(q,Q,Se,Ie,Ne){var Le=typeof q;(Le==="undefined"||Le==="boolean")&&(q=null);var xe=!1;if(q===null)xe=!0;else switch(Le){case"string":case"number":xe=!0;break;case"object":switch(q.$$typeof){case n:case e:xe=!0}}if(xe)return xe=q,Ne=Ne(xe),q=Ie===""?"."+V(xe,0):Ie,I(Ne)?(Se="",q!=null&&(Se=q.replace(B,"$&/")+"/"),z(Ne,Q,Se,"",function(Ve){return Ve})):Ne!=null&&(F(Ne)&&(Ne=D(Ne,Se+(!Ne.key||xe&&xe.key===Ne.key?"":(""+Ne.key).replace(B,"$&/")+"/")+q)),Q.push(Ne)),1;if(xe=0,Ie=Ie===""?".":Ie+":",I(q))for(var Ee=0;Ee<q.length;Ee++){Le=q[Ee];var Ce=Ie+V(Le,Ee);xe+=z(Le,Q,Se,Ce,Ne)}else if(Ce=p(q),typeof Ce=="function")for(q=Ce.call(q),Ee=0;!(Le=q.next()).done;)Le=Le.value,Ce=Ie+V(Le,Ee++),xe+=z(Le,Q,Se,Ce,Ne);else if(Le==="object")throw Q=String(q),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.");return xe}function H(q,Q,Se){if(q==null)return q;var Ie=[],Ne=0;return z(q,Ie,"","",function(Le){return Q.call(Se,Le,Ne++)}),Ie}function J(q){if(q._status===-1){var Q=q._result;Q=Q(),Q.then(function(Se){(q._status===0||q._status===-1)&&(q._status=1,q._result=Se)},function(Se){(q._status===0||q._status===-1)&&(q._status=2,q._result=Se)}),q._status===-1&&(q._status=0,q._result=Q)}if(q._status===1)return q._result.default;throw q._result}var Y={current:null},G={transition:null},K={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:G,ReactCurrentOwner:C};function ee(){throw Error("act(...) is not supported in production builds of React.")}return bt.Children={map:H,forEach:function(q,Q,Se){H(q,function(){Q.apply(this,arguments)},Se)},count:function(q){var Q=0;return H(q,function(){Q++}),Q},toArray:function(q){return H(q,function(Q){return Q})||[]},only:function(q){if(!F(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},bt.Component=S,bt.Fragment=t,bt.Profiler=i,bt.PureComponent=R,bt.StrictMode=r,bt.Suspense=c,bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K,bt.act=ee,bt.cloneElement=function(q,Q,Se){if(q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+q+".");var Ie=v({},q.props),Ne=q.key,Le=q.ref,xe=q._owner;if(Q!=null){if(Q.ref!==void 0&&(Le=Q.ref,xe=C.current),Q.key!==void 0&&(Ne=""+Q.key),q.type&&q.type.defaultProps)var Ee=q.type.defaultProps;for(Ce in Q)T.call(Q,Ce)&&!P.hasOwnProperty(Ce)&&(Ie[Ce]=Q[Ce]===void 0&&Ee!==void 0?Ee[Ce]:Q[Ce])}var Ce=arguments.length-2;if(Ce===1)Ie.children=Se;else if(1<Ce){Ee=Array(Ce);for(var Ve=0;Ve<Ce;Ve++)Ee[Ve]=arguments[Ve+2];Ie.children=Ee}return{$$typeof:n,type:q.type,key:Ne,ref:Le,props:Ie,_owner:xe}},bt.createContext=function(q){return q={$$typeof:o,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},q.Provider={$$typeof:s,_context:q},q.Consumer=q},bt.createElement=M,bt.createFactory=function(q){var Q=M.bind(null,q);return Q.type=q,Q},bt.createRef=function(){return{current:null}},bt.forwardRef=function(q){return{$$typeof:a,render:q}},bt.isValidElement=F,bt.lazy=function(q){return{$$typeof:u,_payload:{_status:-1,_result:q},_init:J}},bt.memo=function(q,Q){return{$$typeof:l,type:q,compare:Q===void 0?null:Q}},bt.startTransition=function(q){var Q=G.transition;G.transition={};try{q()}finally{G.transition=Q}},bt.unstable_act=ee,bt.useCallback=function(q,Q){return Y.current.useCallback(q,Q)},bt.useContext=function(q){return Y.current.useContext(q)},bt.useDebugValue=function(){},bt.useDeferredValue=function(q){return Y.current.useDeferredValue(q)},bt.useEffect=function(q,Q){return Y.current.useEffect(q,Q)},bt.useId=function(){return Y.current.useId()},bt.useImperativeHandle=function(q,Q,Se){return Y.current.useImperativeHandle(q,Q,Se)},bt.useInsertionEffect=function(q,Q){return Y.current.useInsertionEffect(q,Q)},bt.useLayoutEffect=function(q,Q){return Y.current.useLayoutEffect(q,Q)},bt.useMemo=function(q,Q){return Y.current.useMemo(q,Q)},bt.useReducer=function(q,Q,Se){return Y.current.useReducer(q,Q,Se)},bt.useRef=function(q){return Y.current.useRef(q)},bt.useState=function(q){return Y.current.useState(q)},bt.useSyncExternalStore=function(q,Q,Se){return Y.current.useSyncExternalStore(q,Q,Se)},bt.useTransition=function(){return Y.current.useTransition()},bt.version="18.3.1",bt}var bO;function Zx(){return bO||(bO=1,_T.exports=Qne()),_T.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SO;function ere(){if(SO)return Em;SO=1;var n=Zx(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,c,l){var u,h={},p=null,m=null;l!==void 0&&(p=""+l),c.key!==void 0&&(p=""+c.key),c.ref!==void 0&&(m=c.ref);for(u in c)r.call(c,u)&&!s.hasOwnProperty(u)&&(h[u]=c[u]);if(a&&a.defaultProps)for(u in c=a.defaultProps,c)h[u]===void 0&&(h[u]=c[u]);return{$$typeof:e,type:a,key:p,ref:m,props:h,_owner:i.current}}return Em.Fragment=t,Em.jsx=o,Em.jsxs=o,Em}var wO;function tre(){return wO||(wO=1,yT.exports=ere()),yT.exports}var w=tre();const nre="l",rre="rn",ire={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":","ꓽ":":","⩴":"::=","⧴":":→","！":"!",ǃ:"!","ⵑ":"!","‼":"!!","⁉":"!?",ʔ:"?","Ɂ":"?","ॽ":"?",Ꭾ:"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·",ᐧ:"·","⋯":"···","ⵈ":"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'","ʹ":"'","ʹ":"'","ˈ":"'","ˊ":"'","ˋ":"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'","ꞌ":"'",י:"'","ߴ":"'","ߵ":"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''","ʺ":"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/","Ⳇ":"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·","Ⲵ":"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">","𖼿":">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2",Ƨ:"2",Ϩ:"2","Ꙅ":"2",ᒿ:"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3",Ȝ:"3",Ʒ:"3","Ꝫ":"3","Ⳍ":"3",З:"3",Ӡ:"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6",б:"6",Ꮾ:"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a",ɑ:"a",α:"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a",а:"a","ⷶ":"ͣ",Ａ:"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A",Α:"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A",А:"A",Ꭺ:"A",ᗅ:"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B",Β:"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B",В:"B",Ᏼ:"B",ᗷ:"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ","ᏼ":"ʙ",ｃ:"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c",ϲ:"c","ⲥ":"c",с:"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C","Ⅽ":"C",ℂ:"C",ℭ:"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C",С:"C",Ꮯ:"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄	⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ",є:"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d",Ꮷ:"d",ᑯ:"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D","ꓓ":"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵","ꝺ":"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ","ꭰ":"ᴅ","⸹":"ẟ",δ:"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ",ծ:"ẟ",ᕷ:"ẟ","℮":"e",ｅ:"e",ℯ:"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E",Ε:"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E",Е:"E","ⴹ":"E",Ꭼ:"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E",ě:"ĕ",Ě:"Ĕ","ɇ":"e̸","Ɇ":"E̸",ҿ:"ę","ꭼ":"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ",ɚ:"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ","Ԑ":"Ɛ",Ꮛ:"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ",з:"ɜ",ҙ:"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f",ſ:"f","ẝ":"f",ք:"f","𝈓":"F",ℱ:"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F",Ϝ:"F","𝟊":"F",ᖴ:"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F",ƒ:"f̦",Ƒ:"F̦","ᵮ":"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g",ɡ:"g","ᶃ":"g",ƍ:"g",ց:"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G",Ꮐ:"G",Ᏻ:"G","ꓖ":"G","ᶢ":"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ",ｈ:"h",ℎ:"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H",Η:"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H",Н:"H",Ꮋ:"H",ᕼ:"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ",ɦ:"h̔","ꚕ":"h̔",Ᏺ:"h̔","Ⱨ":"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵","Ӊ":"H̦",Ӈ:"H̦",н:"ʜ","ꮋ":"ʜ",ң:"ʜ̩","ӊ":"ʜ̦",ӈ:"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i",ｉ:"i","ⅰ":"i",ℹ:"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i",ı:"i","𝚤":"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i",і:"i","ꙇ":"i","ӏ":"i","ꭵ":"i",Ꭵ:"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii",ĳ:"ij","ⅳ":"iv","ⅸ":"ix",ｊ:"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j",ϳ:"j",ј:"j",Ｊ:"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J",Ј:"J",Ꭻ:"J",ᒍ:"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵",ᒙ:"J·","𝚥":"ȷ",յ:"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k",K:"K",Ｋ:"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K",Κ:"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K",К:"K",Ꮶ:"K",ᛕ:"K","ꓗ":"K","𐔘":"K",ƙ:"k̔","Ⱪ":"K̩",Қ:"K̩","₭":"K̵","Ꝁ":"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:nre,Ｉ:"l","Ⅰ":"l",ℐ:"l",ℑ:"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l",Ɩ:"l",ｌ:"l","ⅼ":"l",ℓ:"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l",ǀ:"l",Ι:"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l","𞸀":"l","𞺀":"l",ﺎ:"l",ﺍ:"l","ߊ":"l","ⵏ":"l",ᛁ:"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L",ℒ:"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L",Ꮮ:"L",ᒪ:"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll","Ⅱ":"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ",Ｍ:"M","Ⅿ":"M",ℳ:"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M",Μ:"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N",Ν:"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩",Ɲ:"N̦","ᵰ":"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No","ͷ":"ᴎ",и:"ᴎ","𐑍":"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o",ο:"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o",σ:"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o",о:"o","ჿ":"o",օ:"o",ס:"o",ه:"o","𞸤":"o","𞹤":"o","𞺄":"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O",Ο:"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O",О:"O",Օ:"O","ⵔ":"O",ዐ:"O",ଠ:"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º",ǒ:"ŏ",Ǒ:"Ŏ","ۿ":"ô",Ő:"Ö",ø:"o̸","ꬾ":"o̸",Ø:"O̸","ⵁ":"O̸",Ǿ:"Ó̸",ɵ:"o̵","ꝋ":"o̵",ө:"o̵",ѳ:"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵","Ꝋ":"O̵",θ:"O̵",ϑ:"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵",Θ:"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵",Ө:"O̵",Ѳ:"O̵","ⴱ":"O̵",Ꮎ:"O̵",Ꮻ:"O̵","ꭴ":"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى","ൟ":"oരo",တ:"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p",ｐ:"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p",ρ:"p",ϱ:"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p",р:"p",Ｐ:"P",ℙ:"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P",Ρ:"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P",Р:"P",Ꮲ:"P",ᑭ:"P","ꓑ":"P","𐊕":"P",ƥ:"p̔","ᵽ":"p̵",ᑷ:"p·",ᒆ:"P'","ᴩ":"ᴘ","ꮲ":"ᴘ",φ:"ɸ",ϕ:"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ",ф:"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q",գ:"q",զ:"q",ℚ:"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q",ʠ:"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ",κ:"ĸ",ϰ:"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ",к:"ĸ","ꮶ":"ĸ",қ:"ĸ̩",ҟ:"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r",г:"r","ꮁ":"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R","ꓣ":"R","𖼵":"R",ɽ:"r̨",ɼ:"r̩","ɍ":"r̵",ғ:"r̵","ᵲ":"r̴",ґ:"r'","𑣣":"rn",m:rre,"ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸",ɱ:"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ",я:"ᴙ","ᵳ":"ɾ̴","℩":"ɿ",ｓ:"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s",ƽ:"s",ѕ:"s","ꮪ":"s","𑣁":"s","𐑈":"s",Ｓ:"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S",ʂ:"s̨","ᵴ":"s̴","ꞵ":"ß",β:"ß",ϐ:"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T",Τ:"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T",Т:"T",Ꭲ:"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T",ƭ:"t̔","⍡":"T̈","Ⱦ":"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵","ᵵ":"t̴",Ⴀ:"Ꞇ","Ꜩ":"T3",ʨ:"tɕ","℡":"TEL","ꝷ":"tf",ʦ:"ts",ʧ:"tʃ","ꜩ":"tȝ",τ:"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ",т:"ᴛ","ꭲ":"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u",ʋ:"u",υ:"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u",ս:"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U","ꓴ":"U","𖽂":"U","𑢸":"U",ǔ:"ŭ",Ǔ:"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'","ᵫ":"ue","ꭣ":"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v",ｖ:"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v",ν:"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v",ѵ:"v",ט:"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V",Ѵ:"V","ⴸ":"V",Ꮩ:"V",ᐯ:"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ",Л:"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w",ѡ:"w","ԝ":"w",ա:"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W",Ꮃ:"W",Ꮤ:"W","ꓪ":"W",ѽ:"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ",м:"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X",Χ:"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X",Х:"X","ⵝ":"X",ᚷ:"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll",ɣ:"y","ᶌ":"y",ｙ:"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y",ʏ:"y","ỿ":"y","ꭚ":"y",γ:"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y",у:"y",ү:"y",ყ:"y","𑣜":"y",Ｙ:"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y",Υ:"Y",ϒ:"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y",ƴ:"y̔","ɏ":"y̵",ұ:"y̵","¥":"Y̵","Ɏ":"Y̵",Ұ:"Y̵",ʒ:"ȝ","ꝫ":"ȝ","ⳍ":"ȝ",ӡ:"ȝ",ჳ:"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z",Ζ:"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z",Ꮓ:"Z","ꓜ":"Z","𑢩":"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦","ᵶ":"z̴",ƿ:"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ",ϩ:"ƨ","ꙅ":"ƨ",ь:"ƅ","ꮟ":"ƅ",ы:"ƅi","ꭾ":"ɂ",ˤ:"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ","𖼇":"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ",ᐃ:"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ",µ:"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ",ϖ:"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π",п:"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π",П:"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ",ϛ:"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ",ѱ:"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω",Ω:"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω",ᘯ:"Ω",ᘵ:"Ω","𐊶":"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И",Й:"Ѝ","Ҋ":"Ѝ̦",ѝ:"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո","ꓵ":"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ","ݲ":"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز",ﺰ:"ز",ﺯ:"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ","ݾ":"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ","ࢯ":"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ","ࢤ":"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ","ݣ":"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى","ݢ":"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ","ࢰ":"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م","ࢧ":"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن","ݨ":"نؕ","ݩ":"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و",ﻮ:"و",ﻭ:"و","ࢱ":"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى",ں:"ى","𞸝":"ى","𞹝":"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆",ێ:"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै","ऄ":"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ",က:"ဂာ","ၰ":"ဃှ","ၦ":"ပှ",ဟ:"ပာ","ၯ":"ပာှ","ၾ":"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·","ᣝ":"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ","ᣠ":"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·",ᕩ:"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ",ᇃ:"ᄀᄅ","ᇻ":"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ","ᇿ":"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ","ퟋ":"ᄂᄅ",ᄖ:"ᄂᄇ","ᅛ":"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ","ᅜ":"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ","ퟌ":"ᄂᄎ",ᇉ:"ᄂᄐ","ᅝ":"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ",ᇋ:"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ","ꥤ":"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ","ꥦ":"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ","ꥧ":"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ","ꥬ":"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ","ퟲ":"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ","ퟛ":"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ","ퟜ":"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ","ꥯ":"ᄆᄀ",ᇚ:"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ",ᇛ:"ᄆᄅ","ퟠ":"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ","ퟢ":"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ","ퟣ":"ᄇᄃ",ᇣ:"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ","ퟦ":"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ","ퟨ":"ᄇᄌ",ᄨ:"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ","ꥴ":"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ","ퟪ":"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ","ퟯ":"ᄉᄌ",ᄷ:"ᄉᄎ","ퟰ":"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ","ퟱ":"ᄉᄐ",ᄺ:"ᄉᄑ","ퟮ":"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ","ꥶ":"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ","ꥷ":"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ","ꥹ":"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ","ퟺ":"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ","ꥻ":"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ","ꥼ":"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ","ᆣ":"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ","ᆤ":"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ","ᆥ":"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨","ힰ":"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ","ힱ":"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨","ힴ":"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨","ힵ":"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨","ힶ":"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ","ힷ":"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨","ힸ":"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ","ퟅ":"ᆞᅡ",ᆟ:"ᆞᅥ","ퟆ":"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄",不:"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨",ᆚ:"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ",ᆛ:"丨ᅮ","ퟃ":"丨ᅲ",ᆝ:"丨ᆞ","ퟄ":"丨丨",串:"串","丸":"丸",丹:"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二","𠄢":"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什","仌":"仌",令:"令","你":"你",倂:"併","倂":"併","侀":"侀",來:"來",例:"例","侮":"侮","侮":"侮","侻":"侻",便:"便",值:"値",倫:"倫","偺":"偺","備":"備","像":"像",僚:"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿",兀:"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全",兩:"兩",ハ:"八","⼋":"八",六:"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃",切:"切","切":"切",列:"列",利:"利","㓟":"㓟",刺:"刺","刻":"刻","剆":"剆","割":"割","剷":"剷",劉:"劉","𠠄":"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉",勒:"勒",勞:"勞","勤":"勤","勤":"勤",勵:"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕",北:"北","北":"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即",卵:"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶",參:"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句","叫":"叫","叱":"叱","吆":"吆",吏:"吏",吝:"吝","吸":"吸",呂:"呂","呈":"呈","周":"周","咞":"咞","咢":"咢",咽:"咽",䎛:"㖈","哶":"哶","唐":"唐","啓":"啓",啟:"啓","啕":"啕","啣":"啣","善":"善","善":"善",喇:"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳",嗀:"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器",囹:"囹","圖":"圖","圗":"圗","⼟":"土",士:"土","⼠":"土","型":"型","城":"城",㦳:"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀",塚:"塚","塚":"塚",塞:"塞",填:"塡",壿:"墫","墬":"墬","墳":"墳",壘:"壘",壟:"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊",タ:"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄",奈:"奈",契:"契","奔":"奔","奢":"奢",女:"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦",嬀:"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀",宅:"宅","𡧈":"𡧈","寃":"寃","寘":"寘",寧:"寧",寧:"寧","寧":"寧",寮:"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸",尿:"尿","屠":"屠",屢:"屢","層":"層",履:"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦",崙:"崙","嵃":"嵃",嵐:"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲",嶺:"嶺","⼮":"巛","巢":"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾",帲:"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干",年:"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶",廊:"廊","廊":"廊",廉:"廉","廒":"廒",廓:"廓","廙":"廙",廬:"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱",弄:"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳",律:"律","㣣":"㣣","徚":"徚",復:"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志",念:"念","忹":"忹",怒:"怒",怜:"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘",惡:"惡","𢛔":"𢛔","愈":"愈","慨":"慨",慄:"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎",憐:"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲",懶:"懶","懶":"懶",戀:"戀","⼽":"戈","成":"成","戛":"戛",戮:"戮","戴":"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱",拉:"拉",拏:"拏",拓:"拓","拔":"拔","拼":"拼",拾:"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨",捻:"捻","掃":"掃",掠:"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮",搉:"㩁",撚:"撚","撝":"撝",擄:"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬",數:"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日",易:"易",曶:"㫚","㫤":"㫤","晉":"晉",晩:"晚",晴:"晴","晴":"晴","暑":"暑","暑":"暑",暈:"暈","㬈":"㬈","暜":"暜",暴:"暴",曆:"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰",更:"更","書":"書","⽉":"月","𣍟":"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗","朗":"朗","朗":"朗",脧:"朘","望":"望","望":"望",幐:"㬺",䐠:"㬻","𣎓":"𣎓",膧:"朣","𣎜":"𣎜","⽊":"木",李:"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃",柿:"杮",杻:"杻","枅":"枅",林:"林","㭉":"㭉","𣏕":"𣏕",柳:"柳","柺":"柺",栗:"栗","栟":"栟","桒":"桒","𣑭":"𣑭",梁:"梁","梅":"梅","梅":"梅","梎":"梎",梨:"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝",槩:"㮣",樧:"榝","榣":"榣","槪":"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓","𣚣":"𣚣","檨":"檨",櫓:"櫓","櫛":"櫛",欄:"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲",歷:"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟",殮:"殮","⽎":"殳",殺:"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧",沈:"沈","沿":"沿",泌:"泌","泍":"泍",泥:"泥","𣲼":"𣲼",洛:"洛",洞:"洞","洴":"洴","派":"派",流:"流","流":"流","流":"流","洖":"洖","浩":"浩",浪:"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞",淋:"淋",淚:"淚",淪:"淪","淹":"淹","渚":"渚","港":"港","湮":"湮",潙:"溈","滋":"滋","滋":"滋",溜:"溜",溺:"溺","滇":"滇",滑:"滑","滛":"滛","㴳":"㴳",漏:"漏","漢":"漢","漢":"漢",漣:"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆",濫:"濫",濾:"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災",炙:"炙","炭":"炭",烈:"烈",烙:"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅",煉:"煉","𤋮":"𤋮","熜":"熜",燎:"燎",燐:"燐","𤎫":"𤎫",爐:"爐",爛:"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛",牢:"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯",狀:"狀","𤜵":"𤜵",狼:"狼",猪:"猪","猪":"猪","𤠔":"𤠔",獵:"獵","獺":"獺","⽞":"玄",率:"率",率:"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥",玲:"玲","㺸":"㺸","㺸":"㺸",珞:"珞",琉:"琉",理:"理","琢":"琢","瑇":"瑇","瑜":"瑜",瑩:"瑩","瑱":"瑱","瑱":"瑱","璅":"璅",璉:"璉",璘:"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶",留:"留",略:"略",異:"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒",痢:"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼",益:"益","益":"益","盛":"盛",盧:"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳",省:"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹",晣:"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝",硏:"研","硎":"硎",硫:"硫",碌:"碌","碌":"碌","碑":"碑",磊:"磊","磌":"磌","磌":"磌",磻:"磻","䃣":"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝",神:"神",祥:"祥","視":"視","視":"視",祿:"祿","𥚚":"𥚚","禍":"禍","禎":"禎",福:"福","福":"福","𥛅":"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊","䄯":"䄯","秫":"秫",稜:"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱",立:"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹",笠:"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐",簾:"簾",籠:"籠","⽶":"米","类":"类",粒:"粒",精:"精","糒":"糒",糖:"糖","糨":"糨","䊠":"䊠","糣":"糣",糧:"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀",紐:"紐",索:"索",累:"累",絶:"絕","絣":"絣","絛":"絛",綠:"綠",綾:"綾","緇":"緇",練:"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉",縷:"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙",罹:"罹","罺":"罺",羅:"羅","𦌾":"𦌾","⽺":"羊","羕":"羕",羚:"羚",羽:"羽","⽻":"羽","翺":"翺",老:"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳",聆:"聆","聠":"聠","𦖨":"𦖨",聯:"聯","聰":"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙",腁:"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽",若:"若","若":"若","苦":"苦","𦬼":"𦬼",茶:"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓",菉:"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華",菱:"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭",落:"落",葉:"葉",蔿:"蒍","𦳕":"𦳕","𦵫":"𦵫",蓮:"蓮","蓱":"蓱","蓳":"蓳",蓼:"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬",藍:"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡",藺:"藺",蘆:"蘆","䕫":"䕫",蘒:"蘒",蘭:"蘭","𧃒":"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎","虐":"虐",虜:"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊",螺:"螺","蠁":"蠁","䗹":"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤",裂:"裂","𧙧":"𧙧",裏:"裏","裗":"裗","裞":"裞",裡:"裡",裸:"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆",見:"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦",詽:"訮",訞:"䚶","䚾":"䚾","䛇":"䛇","誠":"誠",說:"說",說:"說","調":"調","請":"請",諒:"諒",論:"論","諭":"諭","諭":"諭",諸:"諸","諸":"諸",諾:"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹",識:"識",讀:"讀",讏:"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈","豕":"豕","⾗":"豕",豣:"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁",賂:"賂",賈:"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起",趆:"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼",跺:"跥",路:"路","跰":"跰",躛:"躗","⾝":"身",車:"車","⾞":"車","軔":"軔",輧:"軿",輦:"輦",輪:"輪","輸":"輸","輸":"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛","辞":"辞",辰:"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡",連:"連",逸:"逸","逸":"逸","遲":"遲",遼:"遼","𨗒":"𨗒","𨗭":"𨗭",邏:"邏","⾢":"邑","邔":"邔",郎:"郎",郞:"郎","郞":"郎","郱":"郱",都:"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉",酪:"酪","醙":"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼",錄:"錄",鍊:"鍊",鎮:"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕",閭:"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸","陼":"陼",隆:"隆",隣:"隣","䧦":"䧦","⾪":"隶","隷":"隷",隸:"隷",隸:"隷","⾫":"隹","雃":"雃",離:"離","難":"難","難":"難","⾬":"雨",零:"零",雷:"雷","霣":"霣","𩅅":"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋",領:"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻",類:"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢",飯:"飯",飼:"飼","䬳":"䬳",館:"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂",駱:"駱","駾":"駾",驪:"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯","鱀":"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎",鶴:"鶴","𪄅":"𪄅","䳸":"䳸",鷺:"鷺","𪈎":"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿","𪊑":"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎","䵖":"䵖","⿊":"黑",黒:"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿",龍:"龍","⿓":"龍","龎":"龎","⻰":"龙",龜:"龜",龜:"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var bT,EO;function sre(){if(EO)return bT;EO=1;var n=ire;function e(s){return s.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var t=RegExp(Object.keys(n).map(e).join("|"),"g");function r(s){return n[s]}function i(s){return s.replace(t,r)}return bT=i,bT}var ore=sre();const are=Wo(ore);var Cm={exports:{}},ST={},wT,CO;function cre(){if(CO)return wT;CO=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return wT=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var s=this._errors[i],o=s.message,a=(e[o]||0)+1;e[o]=a,a>=r&&(t=s,r=a)}return t},wT}var TO;function lre(){return TO||(TO=1,function(n){var e=cre();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<r.retries;o++)s.push(this.createTimeout(o,r));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,r)),s.sort(function(a,c){return a-c}),s},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,s=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return s=Math.min(s,r.maxTimeout),s},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(u){var h=n.operation(r),p=Array.prototype.slice.call(arguments,1),m=p.pop();p.push(function(v){h.retry(v)||(v&&(arguments[0]=h.mainError()),m.apply(this,arguments))}),h.attempt(function(){u.apply(t,p)})}).bind(t,c),t[a].options=r}}}(ST)),ST}var ET,IO;function ure(){return IO||(IO=1,ET=lre()),ET}var RO;function dre(){if(RO)return Cm.exports;RO=1;const n=ure(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(a){super(),a instanceof Error?(this.originalError=a,{message:a}=a):(this.originalError=new Error(a),this.originalError.stack=this.stack),this.name="AbortError",this.message=a}}const r=(o,a,c)=>{const l=c.retries-(a-1);return o.attemptNumber=a,o.retriesLeft=l,o},i=o=>e.includes(o),s=(o,a)=>new Promise((c,l)=>{a={onFailedAttempt:()=>{},retries:10,...a};const u=n.operation(a);u.attempt(async h=>{try{c(await o(h))}catch(p){if(!(p instanceof Error)){l(new TypeError(`Non-error was thrown: "${p}". You should only throw errors.`));return}if(p instanceof t)u.stop(),l(p.originalError);else if(p instanceof TypeError&&!i(p.message))u.stop(),l(p);else{r(p,h,a);try{await a.onFailedAttempt(p)}catch(m){l(m);return}u.retry(p)||l(u.mainError())}}})});return Cm.exports=s,Cm.exports.default=s,Cm.exports.AbortError=t,Cm.exports}var hre=dre();const fj=Wo(hre);let tw=class{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){const e=[this.name],t=this.altName;return t&&e.push(t),e}matches(e){return this.name===e||this.altName===e}findIn(e){let t;return this.name&&(t=e==null?void 0:e[this.name]),!t&&this.altName&&(t=e==null?void 0:e[this.altName]),t}includedIn(e){let t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}};class nw extends tw{constructor(){super(...arguments),this.preferUnstable=!1}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class jn extends tw{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}var Ed=(n=>(n.Self="m.self",n.Pin="m.pin",n))(Ed||{});const ty=new jn("m.asset","org.matrix.msc3488.asset"),fu=new jn("m.ts","org.matrix.msc3488.ts"),ny=new jn("m.location","org.matrix.msc3488.location");var li=(n=>(n.Read="m.read",n.FullyRead="m.fully_read",n.ReadPrivate="m.read.private",n))(li||{});const ry="main",CT=new Map;function TT(n){return n instanceof String&&(n=n.toString()),CT.has(n)||CT.set(n,n),CT.get(n)}function kR(n,e){const t=e??new URLSearchParams;for(const[r,i]of Object.entries(n))i!=null&&(Array.isArray(i)?i.forEach(s=>{t.append(r,String(s))}):t.append(r,String(i)));return t}function kO(n,e,t){const r={...t,[e]:t[n]};return delete r[n],r}function Ae(n,e){for(const t in e){if(!e.hasOwnProperty(t))continue;const r=e[t];r!=null&&(n=n.replace(t,encodeURIComponent(r)))}return n}function yb(n,e,t){let r;if(t){for(r=n.length-1;r>=0;r--)if(e(n[r],r,n))return n.splice(r,1),!0}else for(r=0;r<n.length;r++)if(e(n[r],r,n))return n.splice(r,1),!0;return!1}function pj(n,e){for(const t of e)if(!n.hasOwnProperty(t))throw new Error("Missing required key: "+t)}function rw(n){return JSON.parse(JSON.stringify(n))}function Cd(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="number"&&isNaN(n)&&isNaN(e))return!0;if(n===null||e===null)return n===e;if(!(n instanceof Object)||n.constructor!==e.constructor||n.prototype!==e.prototype)return!1;if(n instanceof RegExp||n instanceof Date)return n.toString()===e.toString();if(Array.isArray(n)){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Cd(n[t],e[t]))return!1}else{for(const t in e)if(e.hasOwnProperty(t)!==n.hasOwnProperty(t))return!1;for(const t in n)if(e.hasOwnProperty(t)!==n.hasOwnProperty(t)||!Cd(n[t],e[t]))return!1}return!0}function xR(n){if(typeof n!="object"||n==null||Array.isArray(n))return n;const e=[];for(const[t,r]of Object.entries(n))e.push([t,xR(r)]);return e.sort((t,r)=>p_(t[0],r[0])),e}function xO(n){return typeof n=="number"&&isFinite(n)}function $l(n){return typeof n=="string"?are(n.normalize("NFD").replace(pre,"")):""}function _b(n){return typeof n=="string"?n.replace(/[\u202d-\u202e]/g,""):""}function fre(n){return $l(n.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}const pre=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function mj(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gj(n){return mj(n).replace(/\\\*/g,".*").replace(/\?/g,".")}function IT(n){return n!=null&&n.endsWith("/")?n.slice(0,-1):n}function Td(n,e){return new Promise(t=>{setTimeout(t,n,e)})}async function VGe(n,e,t){const r=Date.now();try{return await t()}finally{const i=Date.now();n.debug(`[Perf]: ${e} took ${i-r}ms`)}}function mre(n,e,t){const r=Date.now();try{return t()}finally{const i=Date.now();n.debug(`[Perf]: ${e} took ${i-r}ms`)}}function vj(n){return n==null}function Xl(){let n,e;const t=new Promise((r,i)=>{n=r,e=i});return{resolve:n,reject:e,promise:t}}async function af(n,e){for(const t of n)await e(await t)}function kh(n){return Promise.resolve(n())}function gre(n){return fj(e=>n(e),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})}const Jl=(()=>{let n="";for(let e=32;e<=126;e++)n+=String.fromCharCode(e);return n})();function PO(n,e,t=Jl){return n.padEnd(e,t[0])}function nv(n,e=Jl){const t=BigInt(e.length);if(n<=t)return e[Number(n)-1]??"";let r=n/t,i=Number(n%t)-1;return i<0&&(r-=BigInt(Math.abs(i)),i=Number(t)-1),nv(r,e)+e[i]}function bb(n,e=Jl){const t=BigInt(e.length);let r=BigInt(0);for(let i=n.length-1,s=BigInt(0);i>=0;i--,s++){const o=n.charCodeAt(i)-e.charCodeAt(0);r+=BigInt(1+o)*t**s}return r}function vre(n,e,t=Jl){const r=Math.max(n.length,e.length),i=bb(PO(n,r,t),t),s=bb(PO(e,r,t),t),o=(i+s)/BigInt(2);return o===i||o==s?nv(o,t)+t[0]:nv(o,t)}function Tm(n,e=Jl){return nv(bb(n,e)+BigInt(1),e)}function LO(n,e=Jl){return nv(bb(n,e)-BigInt(1),e)}function p_(n,e){return n<e?-1:n>e?1:0}function yj(n,e,t=!1){for(const[r,i]of Object.entries(e)){if(n[r]instanceof Object&&i){yj(n[r],i);continue}if(i!=null||!t){Sb(n,r,i);continue}}return n}function AO(n){return fu.findIn(n.getContent())??-1}function yre(n,e){return AO(e)-AO(n)}function Qx(n){return[li.Read,li.ReadPrivate].includes(n)}function MO(n,e,t=(r,i)=>r===i){if(n.size!==e.size)return!1;for(const[r,i]of n){const s=e.get(r);if(s===void 0||!t(i,s))return!1}return!0}function _j(n){return n instanceof Map?ed(n):Array.isArray(n)?n.map(e=>_j(e)):n}function ed(n){const e=new Map;for(const[t,r]of n)e.set(t,_j(r));return Object.fromEntries(e.entries())}function Tg(n){return n==="__proto__"||n==="prototype"||n==="constructor"}function Sb(n,e,t){if(Tg(e))throw new Error("Trying to modify prototype or constructor");n[e]=t}function Po(n){return!(Tg(n.room_id)||Tg(n.sender)||Tg(n.event_id))}class yc extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}const PR="migrationState";var Id=(n=>(n[n.NOT_STARTED=0]="NOT_STARTED",n[n.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",n[n.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",n[n.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",n[n.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",n[n.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",n))(Id||{});const Hf=50;function X0(n,e){return encodeURIComponent(n)+"/"+encodeURIComponent(e)}function _re(n){const e=n.split("/"),t=decodeURIComponent(e[0]),r=decodeURIComponent(e[1]);return{senderKey:t,sessionId:r}}class iw{constructor(){this.migrationState=Id.NOT_STARTED,this.account=null,this.crossSigningKeys=null,this.privateKeys={},this.sessions={},this.inboundGroupSessions={},this.inboundGroupSessionsWithheld={},this.rooms={},this.sessionsNeedingBackup={}}async containsData(){return this.account!==null}async startup(){return this}deleteAllData(){return Promise.resolve()}async getMigrationState(){return this.migrationState}async setMigrationState(e){this.migrationState=e}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,r){const i=this.privateKeys[r];t(i||null)}storeSecretStorePrivateKey(e,t,r){this.privateKeys[t]=r}countEndToEndSessions(e,t){let r=0;for(const i of Object.values(this.sessions))r+=Object.keys(i).length;t(r)}getEndToEndSession(e,t,r,i){const s=this.sessions[e]||{};i(s[t]||null)}getEndToEndSessions(e,t,r){r(this.sessions[e]||{})}storeEndToEndSession(e,t,r,i){let s=this.sessions[e];s===void 0&&(s={},this.sessions[e]=s),Sb(s,t,r)}async getEndToEndSessionsBatch(){const e=[];for(const t of Object.values(this.sessions))for(const r of Object.values(t))if(e.push(r),e.length>=Hf)return e;return e.length===0?null:e}async deleteEndToEndSessionsBatch(e){for(const{deviceKey:t,sessionId:r}of e){const i=this.sessions[t]||{};delete i[r],Object.keys(i).length===0&&delete this.sessions[t]}}getEndToEndInboundGroupSession(e,t,r,i){const s=X0(e,t);i(this.inboundGroupSessions[s]||null,this.inboundGroupSessionsWithheld[s]||null)}storeEndToEndInboundGroupSession(e,t,r,i){const s=X0(e,t);this.inboundGroupSessions[s]=r}async countEndToEndInboundGroupSessions(){return Object.keys(this.inboundGroupSessions).length}async getEndToEndInboundGroupSessionsBatch(){const e=[];for(const[t,r]of Object.entries(this.inboundGroupSessions))if(e.push({..._re(t),sessionData:r,needsBackup:t in this.sessionsNeedingBackup}),e.length>=Hf)return e;return e.length===0?null:e}async deleteEndToEndInboundGroupSessionsBatch(e){for(const{senderKey:t,sessionId:r}of e){const i=X0(t,r);delete this.inboundGroupSessions[i]}}getEndToEndRooms(e,t){t(this.rooms)}markSessionsNeedingBackup(e){for(const t of e){const r=X0(t.senderKey,t.sessionId);this.sessionsNeedingBackup[r]=!0}return Promise.resolve()}doTxn(e,t,r){return Promise.resolve(r(null))}}const bre=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/;function Sre(n){const e=bre.exec(n);return(e==null?void 0:e[0])===n}const wre=/^[\w-]+$/;function Ere(n){const e=wre.exec(n);return(e==null?void 0:e[0])===n}function sw(n,e,t,r,i,s=!1,o,a){if(typeof e!="string"||!e)return"";if(!e.startsWith("mxc://"))return s?e:"";const[c,l,...u]=e.slice(6).split("/");if(u.length>0||!Sre(c)||!Ere(l))return"";a&&(o=!0);let h;const m=!!t||!!r||!!i?"thumbnail":"download";a?h=`/_matrix/client/v1/media/${m}`:h=`/_matrix/media/v3/${m}`;const v=new URL(`${h}/${c}/${l}`,n);return t&&v.searchParams.set("width",Math.round(t).toString()),r&&v.searchParams.set("height",Math.round(r).toString()),i&&v.searchParams.set("method",i),typeof o=="boolean"&&v.searchParams.set("allow_redirect",JSON.stringify(o)),v.href}var m_={exports:{}},Cre=m_.exports,OO;function Tre(){return OO||(OO=1,function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(Cre,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(g){return g==="debug"&&(g="log"),typeof console===t?!1:g==="trace"&&r?c:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===t&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==t&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return l(g)||h.apply(this,arguments)}function m(g,S){var b=this,R,k,I,T="loglevel";typeof g=="string"?T+=":"+g:typeof g=="symbol"&&(T=void 0);function C(U){var B=(i[U]||"silent").toUpperCase();if(!(typeof window===t||!T)){try{window.localStorage[T]=B;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+B+";"}catch{}}}function P(){var U;if(!(typeof window===t||!T)){try{U=window.localStorage[T]}catch{}if(typeof U===t)try{var B=window.document.cookie,V=encodeURIComponent(T),z=B.indexOf(V+"=");z!==-1&&(U=/^([^;]+)/.exec(B.slice(z+V.length+1))[1])}catch{}return b.levels[U]===void 0&&(U=void 0),U}}function M(){if(!(typeof window===t||!T)){try{window.localStorage.removeItem(T)}catch{}try{window.document.cookie=encodeURIComponent(T)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var B=U;if(typeof B=="string"&&b.levels[B.toUpperCase()]!==void 0&&(B=b.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=b.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+U)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return I??k??R},b.setLevel=function(U,B){return I=D(U),B!==!1&&C(I),u.call(b)},b.setDefaultLevel=function(U){k=D(U),P()||b.setLevel(U,!1)},b.resetLevel=function(){I=null,M(),u.call(b)},b.enableAll=function(U){b.setLevel(b.levels.TRACE,U)},b.disableAll=function(U){b.setLevel(b.levels.SILENT,U)},b.rebuild=function(){if(o!==b&&(R=D(o.getLevel())),u.call(b),o===b)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var F=P();F!=null&&(I=D(F)),u.call(b)}o=new m,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[S];return b||(b=s[S]=new m(S,o.methodFactory)),b};var v=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(m_)),m_.exports}var Ire=Tre();const LR=Wo(Ire),Rre="matrix";LR.methodFactory=function(n,e,t){return function(...r){return this.prefix&&r.unshift(this.prefix),n==="error"||n==="warn"||n==="trace"||n==="info"||n==="debug"?console[n](...r):console.log(...r)}};function bj(n){const e=Rre+(n===void 0?"":`-${n}`),t=LR.getLogger(e);return t.getChild===void 0&&(t.prefix=n,t.getChild=r=>bj((n??"")+r),t.setLevel(LR.levels.DEBUG,!1)),t}const O=bj();class GGe{constructor(e,t){this.parent=e,this.name=t+":"}trace(...e){this.parent.trace(this.name,...e)}debug(...e){this.parent.debug(this.name,...e)}info(...e){this.parent.info(this.name,...e)}warn(...e){this.parent.warn(this.name,...e)}error(...e){this.parent.error(this.name,...e)}}var J0={exports:{}},NO;function kre(){if(NO)return J0.exports;NO=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(T,C,P){return Function.prototype.apply.call(T,C,P)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:t=function(T){return Object.getOwnPropertyNames(T)};function r(I){console&&console.warn&&console.warn(I)}var i=Number.isNaN||function(T){return T!==T};function s(){s.init.call(this)}J0.exports=s,J0.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");o=I}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this};function c(I){return I._maxListeners===void 0?s.defaultMaxListeners:I._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(T){for(var C=[],P=1;P<arguments.length;P++)C.push(arguments[P]);var M=T==="error",D=this._events;if(D!==void 0)M=M&&D.error===void 0;else if(!M)return!1;if(M){var F;if(C.length>0&&(F=C[0]),F instanceof Error)throw F;var U=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw U.context=F,U}var B=D[T];if(B===void 0)return!1;if(typeof B=="function")e(B,this,C);else for(var V=B.length,z=v(B,V),P=0;P<V;++P)e(z[P],this,C);return!0};function l(I,T,C,P){var M,D,F;if(a(C),D=I._events,D===void 0?(D=I._events=Object.create(null),I._eventsCount=0):(D.newListener!==void 0&&(I.emit("newListener",T,C.listener?C.listener:C),D=I._events),F=D[T]),F===void 0)F=D[T]=C,++I._eventsCount;else if(typeof F=="function"?F=D[T]=P?[C,F]:[F,C]:P?F.unshift(C):F.push(C),M=c(I),M>0&&F.length>M&&!F.warned){F.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=I,U.type=T,U.count=F.length,r(U)}return I}s.prototype.addListener=function(T,C){return l(this,T,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(T,C){return l(this,T,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(I,T,C){var P={fired:!1,wrapFn:void 0,target:I,type:T,listener:C},M=u.bind(P);return M.listener=C,P.wrapFn=M,M}s.prototype.once=function(T,C){return a(C),this.on(T,h(this,T,C)),this},s.prototype.prependOnceListener=function(T,C){return a(C),this.prependListener(T,h(this,T,C)),this},s.prototype.removeListener=function(T,C){var P,M,D,F,U;if(a(C),M=this._events,M===void 0)return this;if(P=M[T],P===void 0)return this;if(P===C||P.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete M[T],M.removeListener&&this.emit("removeListener",T,P.listener||C));else if(typeof P!="function"){for(D=-1,F=P.length-1;F>=0;F--)if(P[F]===C||P[F].listener===C){U=P[F].listener,D=F;break}if(D<0)return this;D===0?P.shift():g(P,D),P.length===1&&(M[T]=P[0]),M.removeListener!==void 0&&this.emit("removeListener",T,U||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(T){var C,P,M;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[T]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[T]),this;if(arguments.length===0){var D=Object.keys(P),F;for(M=0;M<D.length;++M)F=D[M],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=P[T],typeof C=="function")this.removeListener(T,C);else if(C!==void 0)for(M=C.length-1;M>=0;M--)this.removeListener(T,C[M]);return this};function p(I,T,C){var P=I._events;if(P===void 0)return[];var M=P[T];return M===void 0?[]:typeof M=="function"?C?[M.listener||M]:[M]:C?S(M):v(M,M.length)}s.prototype.listeners=function(T){return p(this,T,!0)},s.prototype.rawListeners=function(T){return p(this,T,!1)},s.listenerCount=function(I,T){return typeof I.listenerCount=="function"?I.listenerCount(T):m.call(I,T)},s.prototype.listenerCount=m;function m(I){var T=this._events;if(T!==void 0){var C=T[I];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function v(I,T){for(var C=new Array(T),P=0;P<T;++P)C[P]=I[P];return C}function g(I,T){for(;T+1<I.length;T++)I[T]=I[T+1];I.pop()}function S(I){for(var T=new Array(I.length),C=0;C<T.length;++C)T[C]=I[C].listener||I[C];return T}function b(I,T){return new Promise(function(C,P){function M(F){I.removeListener(T,D),P(F)}function D(){typeof I.removeListener=="function"&&I.removeListener("error",M),C([].slice.call(arguments))}k(I,T,D,{once:!0}),T!=="error"&&R(I,M,{once:!0})})}function R(I,T,C){typeof I.on=="function"&&k(I,"error",T,C)}function k(I,T,C,P){if(typeof I.on=="function")P.once?I.once(T,C):I.on(T,C);else if(typeof I.addEventListener=="function")I.addEventListener(T,function M(D){P.once&&I.removeEventListener(T,M),C(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return J0.exports}var ow=kre();const eP=Wo(ow);var tP=(n=>(n.NewListener="newListener",n.RemoveListener="removeListener",n.Error="error",n))(tP||{});class Xn extends ow.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e,...t){return super.emit(e,...t)}async emitPromised(e,...t){const r=this.listeners(e);return Promise.allSettled(r.map(i=>i(...t))).then(()=>r.length>0)}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return e===void 0?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}var ie=(n=>(n.RoomCanonicalAlias="m.room.canonical_alias",n.RoomCreate="m.room.create",n.RoomJoinRules="m.room.join_rules",n.RoomMember="m.room.member",n.RoomThirdPartyInvite="m.room.third_party_invite",n.RoomPowerLevels="m.room.power_levels",n.RoomName="m.room.name",n.RoomTopic="m.room.topic",n.RoomAvatar="m.room.avatar",n.RoomPinnedEvents="m.room.pinned_events",n.RoomEncryption="m.room.encryption",n.RoomHistoryVisibility="m.room.history_visibility",n.RoomGuestAccess="m.room.guest_access",n.RoomServerAcl="m.room.server_acl",n.RoomTombstone="m.room.tombstone",n.RoomPredecessor="org.matrix.msc3946.room_predecessor",n.PolicyRuleUser="m.policy.rule.user",n.PolicyRuleRoom="m.policy.rule.room",n.PolicyRuleServer="m.policy.rule.server",n.SpaceChild="m.space.child",n.SpaceParent="m.space.parent",n.RoomRedaction="m.room.redaction",n.RoomMessage="m.room.message",n.RoomMessageEncrypted="m.room.encrypted",n.Sticker="m.sticker",n.CallInvite="m.call.invite",n.CallCandidates="m.call.candidates",n.CallAnswer="m.call.answer",n.CallHangup="m.call.hangup",n.CallReject="m.call.reject",n.CallSelectAnswer="m.call.select_answer",n.CallNegotiate="m.call.negotiate",n.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",n.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",n.CallReplaces="m.call.replaces",n.CallAssertedIdentity="m.call.asserted_identity",n.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",n.CallEncryptionKeysPrefix="io.element.call.encryption_keys",n.KeyVerificationRequest="m.key.verification.request",n.KeyVerificationStart="m.key.verification.start",n.KeyVerificationCancel="m.key.verification.cancel",n.KeyVerificationMac="m.key.verification.mac",n.KeyVerificationDone="m.key.verification.done",n.KeyVerificationKey="m.key.verification.key",n.KeyVerificationAccept="m.key.verification.accept",n.KeyVerificationReady="m.key.verification.ready",n.RoomMessageFeedback="m.room.message.feedback",n.Reaction="m.reaction",n.PollStart="org.matrix.msc3381.poll.start",n.Typing="m.typing",n.Receipt="m.receipt",n.Presence="m.presence",n.FullyRead="m.fully_read",n.Tag="m.tag",n.SpaceOrder="org.matrix.msc3230.space_order",n.PushRules="m.push_rules",n.Direct="m.direct",n.IgnoredUserList="m.ignored_user_list",n.RoomKey="m.room_key",n.RoomKeyRequest="m.room_key_request",n.ForwardedRoomKey="m.forwarded_room_key",n.Dummy="m.dummy",n.SecretRequest="m.secret.request",n.SecretSend="m.secret.send",n.GroupCallPrefix="org.matrix.msc3401.call",n.GroupCallMemberPrefix="org.matrix.msc3401.call.member",n.CallNotify="org.matrix.msc4075.call.notify",n))(ie||{}),on=(n=>(n.Annotation="m.annotation",n.Replace="m.replace",n.Reference="m.reference",n.Thread="m.thread",n))(on||{}),zo=(n=>(n.Text="m.text",n.Emote="m.emote",n.Notice="m.notice",n.Image="m.image",n.File="m.file",n.Audio="m.audio",n.Location="m.location",n.Video="m.video",n.KeyVerificationRequest="m.key.verification.request",n))(zo||{});const wb="type";var cd=(n=>(n.Space="m.space",n.UnstableCall="org.matrix.msc3417.call",n.ElementVideo="io.element.video",n))(cd||{});const aw="org.matrix.msgid",AR=new jn("m.room.purpose","org.matrix.msc3088.purpose"),MR=new jn("m.enabled","org.matrix.msc3088.enabled"),OR=new jn("m.data_tree","org.matrix.msc3089.data_tree"),Sj=new jn("m.leaf","org.matrix.msc3089.leaf"),uc=new jn("m.branch","org.matrix.msc3089.branch"),wj=new jn("m.room.marker","org.matrix.msc2716.marker"),NR=new jn("with_rel_types","org.matrix.msc3912.with_relations"),Ej=new jn("io.element.functional_members","io.element.functional_members"),td=new jn("m.visibility","org.matrix.msc3531.visibility"),DR=new jn("enabled","org.matrix.msc3881.enabled"),xre=new jn("device_id","org.matrix.msc3881.device_id"),Cj=new jn("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),Eb=new jn("thread_id","org.matrix.msc4023.thread_id"),Tj=new tw("membership","io.element.msc4115.membership");var ze=(n=>(n.Ban="ban",n.Invite="invite",n.Join="join",n.Knock="knock",n.Leave="leave",n))(ze||{}),Fo=(n=>(n.Membership="RoomMember.membership",n.Name="RoomMember.name",n.PowerLevel="RoomMember.powerLevel",n.Typing="RoomMember.typing",n))(Fo||{});class Cb extends Xn{constructor(e,t){super(),this.roomId=e,this.userId=t,this._isOutOfBand=!1,this.modified=-1,this.requestedProfileInfo=!1,this.typing=!1,this.powerLevel=0,this.powerLevelNorm=0,this.disambiguate=!1,this.events={},this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){const r=e.getDirectionalContent().displayname??"";if(e.getType()!==ie.RoomMember)return;this._isOutOfBand=!1,this.events.member=e;const i=this.membership;this.membership=e.getDirectionalContent().membership,this.membership===void 0&&O.trace(`membership event with membership undefined (forwardLooking: ${e.forwardLooking})!`,e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=Are(this.userId,r,t);const s=this.name;this.name=Mre(this.userId,r,this.disambiguate),this.rawDisplayName=_b(e.getDirectionalContent().displayname??""),(!this.rawDisplayName||!$l(this.rawDisplayName))&&(this.rawDisplayName=this.userId),i!==this.membership&&(this.updateModifiedTime(),this.emit("RoomMember.membership",e,this,i)),s!==this.name&&(this.updateModifiedTime(),this.emit("RoomMember.name",e,this,s))}setPowerLevelEvent(e){if(e.getType()!==ie.RoomPowerLevels||e.getStateKey()!=="")return;const t=e.getDirectionalContent();let r=t.users_default||0;const i=t.users||{};Object.values(i).forEach(a=>{r=Math.max(r,a)});const s=this.powerLevel,o=this.powerLevelNorm;i[this.userId]!==void 0&&Number.isInteger(i[this.userId])?this.powerLevel=i[this.userId]:t.users_default!==void 0?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,r>0&&(this.powerLevelNorm=this.powerLevel*100/r),(s!==this.powerLevel||o!==this.powerLevelNorm)&&(this.updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))}setTypingEvent(e){if(e.getType()!=="m.typing")return;const t=this.typing;this.typing=!1;const r=e.getContent().user_ids;Array.isArray(r)&&(r.indexOf(this.userId)!==-1&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit("RoomMember.typing",e,this)))}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===ze.Leave&&this.events.member!==void 0&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const e=this.events.member;let t=e.getContent(),r=e.getSender();if(t.membership===ze.Join&&(t=e.getPrevContent(),r=e.getUnsigned().prev_sender),t.membership===ze.Invite&&t.is_direct)return r}}getAvatarUrl(e,t,r,i,s=!0,o,a=!1){const c=this.getMxcAvatarUrl();if(!c&&!s)return null;const l=sw(e,c,t,r,i,o,void 0,a);return l||null}getMxcAvatarUrl(){if(this.events.member)return this.events.member.getDirectionalContent().avatar_url;if(this.user)return this.user.avatarUrl}}const Pre=/@.+:.+/,Lre=/[\u200E\u200F\u202A-\u202F]/;function Are(n,e,t){if(!e||e===n||!t)return!1;const r=$l(e);return r?!!(Pre.test(r)||Lre.test(e)||t.getUserIdsWithDisplayName(e).some(s=>s!==n)):!1}function Mre(n,e,t){return!e||e===n?n:t?_b(e)+" ("+n+")":$l(e)?_b(e):n}var RT={},Im={},Rm={},DO;function Ij(){if(DO)return Rm;DO=1,Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.NamespacedMap=void 0;function n(c,l){var u=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!u){if(Array.isArray(c)||(u=e(c))||l){u&&(c=u);var h=0,p=function(){};return{s:p,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(b){throw b},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,g;return{s:function(){u=u.call(c)},n:function(){var b=u.next();return m=b.done,b},e:function(b){v=!0,g=b},f:function(){try{!m&&u.return!=null&&u.return()}finally{if(v)throw g}}}}function e(c,l){if(c){if(typeof c=="string")return t(c,l);var u=Object.prototype.toString.call(c).slice(8,-1);if(u==="Object"&&c.constructor&&(u=c.constructor.name),u==="Map"||u==="Set")return Array.from(c);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return t(c,l)}}function t(c,l){(l==null||l>c.length)&&(l=c.length);for(var u=0,h=new Array(l);u<l;u++)h[u]=c[u];return h}function r(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")}function i(c,l){for(var u=0;u<l.length;u++){var h=l[u];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}function s(c,l,u){return l&&i(c.prototype,l),Object.defineProperty(c,"prototype",{writable:!1}),c}function o(c,l,u){return l in c?Object.defineProperty(c,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[l]=u,c}var a=function(){function c(l){if(r(this,c),o(this,"internalMap",new Map),l){var u=n(l),h;try{for(u.s();!(h=u.n()).done;){var p=h.value;this.set(p[0],p[1])}}catch(m){u.e(m)}finally{u.f()}}}return s(c,[{key:"get",value:function(u){return u.name&&this.internalMap.has(u.name)?this.internalMap.get(u.name):u.altName&&this.internalMap.has(u.altName)?this.internalMap.get(u.altName):null}},{key:"set",value:function(u,h){u.name&&this.internalMap.set(u.name,h),u.altName&&this.internalMap.set(u.altName,h)}},{key:"has",value:function(u){return!!this.get(u)}},{key:"delete",value:function(u){u.name&&this.internalMap.delete(u.name),u.altName&&this.internalMap.delete(u.altName)}},{key:"hasNamespaced",value:function(u){return this.internalMap.has(u)}},{key:"getNamespaced",value:function(u){return this.internalMap.get(u)}}]),c}();return Rm.NamespacedMap=a,Rm}var km={},FO;function fp(){if(FO)return km;FO=1;function n(v){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},n(v)}Object.defineProperty(km,"__esModule",{value:!0}),km.InvalidEventError=void 0;function e(v,g,S){return Object.defineProperty(v,"prototype",{writable:!1}),v}function t(v,g){if(!(v instanceof g))throw new TypeError("Cannot call a class as a function")}function r(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(g&&g.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),Object.defineProperty(v,"prototype",{writable:!1}),g&&h(v,g)}function i(v){var g=l();return function(){var b=p(v),R;if(g){var k=p(this).constructor;R=Reflect.construct(b,arguments,k)}else R=b.apply(this,arguments);return s(this,R)}}function s(v,g){if(g&&(n(g)==="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o(v)}function o(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function a(v){var g=typeof Map=="function"?new Map:void 0;return a=function(b){if(b===null||!u(b))return b;if(typeof b!="function")throw new TypeError("Super expression must either be null or a function");if(typeof g<"u"){if(g.has(b))return g.get(b);g.set(b,R)}function R(){return c(b,arguments,p(this).constructor)}return R.prototype=Object.create(b.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),h(R,b)},a(v)}function c(v,g,S){return l()?c=Reflect.construct:c=function(R,k,I){var T=[null];T.push.apply(T,k);var C=Function.bind.apply(R,T),P=new C;return I&&h(P,I.prototype),P},c.apply(null,arguments)}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function u(v){return Function.toString.call(v).indexOf("[native code]")!==-1}function h(v,g){return h=Object.setPrototypeOf||function(b,R){return b.__proto__=R,b},h(v,g)}function p(v){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(S){return S.__proto__||Object.getPrototypeOf(S)},p(v)}var m=function(v){r(S,v);var g=i(S);function S(b){return t(this,S),g.call(this,b)}return e(S)}(a(Error));return km.InvalidEventError=m,km}var xh={},xm={},Pm={},UO;function iy(){if(UO)return Pm;UO=1,Object.defineProperty(Pm,"__esModule",{value:!0}),Pm.ExtensibleEvent=void 0;function n(i,s){if(!(i instanceof s))throw new TypeError("Cannot call a class as a function")}function e(i,s){for(var o=0;o<s.length;o++){var a=s[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function t(i,s,o){return s&&e(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),i}var r=function(){function i(s){n(this,i),this.wireFormat=s}return t(i,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),i}();return Pm.ExtensibleEvent=r,Pm}var Lm={},jO;function Rj(){if(jO)return Lm;jO=1,Object.defineProperty(Lm,"__esModule",{value:!0}),Lm.isOptionalAString=n,Lm.isProvided=e;function n(t){return e(t)&&typeof t=="string"}function e(t){return t!=null}return Lm}var ds={},Fu={},$O;function pp(){if($O)return Fu;$O=1;function n(m){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},n(m)}Object.defineProperty(Fu,"__esModule",{value:!0}),Fu.UnstableValue=Fu.NamespacedValue=void 0;function e(m,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(v&&v.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),v&&t(m,v)}function t(m,v){return t=Object.setPrototypeOf||function(S,b){return S.__proto__=b,S},t(m,v)}function r(m){var v=o();return function(){var S=a(m),b;if(v){var R=a(this).constructor;b=Reflect.construct(S,arguments,R)}else b=S.apply(this,arguments);return i(this,b)}}function i(m,v){if(v&&(n(v)==="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(m)}function s(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(m){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)},a(m)}function c(m,v){if(!(m instanceof v))throw new TypeError("Cannot call a class as a function")}function l(m,v){for(var g=0;g<v.length;g++){var S=v[g];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(m,S.key,S)}}function u(m,v,g){return v&&l(m.prototype,v),Object.defineProperty(m,"prototype",{writable:!1}),m}var h=function(){function m(v,g){if(c(this,m),this.stable=v,this.unstable=g,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return u(m,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(g){return!!this.name&&this.name===g||!!this.altName&&this.altName===g}},{key:"findIn",value:function(g){var S;return this.name&&(S=g==null?void 0:g[this.name]),!S&&this.altName&&(S=g==null?void 0:g[this.altName]),S}},{key:"includedIn",value:function(g){var S=!1;return this.name&&(S=g.includes(this.name)),!S&&this.altName&&(S=g.includes(this.altName)),S}}]),m}();Fu.NamespacedValue=h;var p=function(m){e(g,m);var v=r(g);function g(S,b){var R;if(c(this,g),R=v.call(this,S,b),!R.unstable)throw new Error("Unstable value must be supplied");return R}return u(g,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),g}(h);return Fu.UnstableValue=p,Fu}var BO;function Na(){if(BO)return ds;BO=1,Object.defineProperty(ds,"__esModule",{value:!0}),ds.M_TEXT=ds.M_NOTICE=ds.M_MESSAGE=ds.M_HTML=ds.M_EMOTE=void 0;var n=pp(),e=new n.UnstableValue("m.message","org.matrix.msc1767.message");ds.M_MESSAGE=e;var t=new n.UnstableValue("m.text","org.matrix.msc1767.text");ds.M_TEXT=t;var r=new n.UnstableValue("m.html","org.matrix.msc1767.html");ds.M_HTML=r;var i=new n.UnstableValue("m.emote","org.matrix.msc1767.emote");ds.M_EMOTE=i;var s=new n.UnstableValue("m.notice","org.matrix.msc1767.notice");return ds.M_NOTICE=s,ds}var Z0={},HO;function Bd(){if(HO)return Z0;HO=1,Object.defineProperty(Z0,"__esModule",{value:!0}),Z0.isEventTypeSame=n;function n(e,t){if(typeof e=="string")return typeof t=="string"?t===e:t.matches(e);if(typeof t=="string")return e.matches(t);var r=t,i=e;return r.matches(i.name)||r.matches(i.altName)}return Z0}var VO;function Hd(){if(VO)return xm;VO=1;function n(I){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},n(I)}Object.defineProperty(xm,"__esModule",{value:!0}),xm.MessageEvent=void 0;var e=iy(),t=Rj(),r=fp(),i=Na(),s=Bd();function o(I,T){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(I);T&&(P=P.filter(function(M){return Object.getOwnPropertyDescriptor(I,M).enumerable})),C.push.apply(C,P)}return C}function a(I){for(var T=1;T<arguments.length;T++){var C=arguments[T]!=null?arguments[T]:{};T%2?o(Object(C),!0).forEach(function(P){R(I,P,C[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):o(Object(C)).forEach(function(P){Object.defineProperty(I,P,Object.getOwnPropertyDescriptor(C,P))})}return I}function c(I,T){if(!(I instanceof T))throw new TypeError("Cannot call a class as a function")}function l(I,T){for(var C=0;C<T.length;C++){var P=T[C];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(I,P.key,P)}}function u(I,T,C){return T&&l(I.prototype,T),C&&l(I,C),Object.defineProperty(I,"prototype",{writable:!1}),I}function h(I,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(T&&T.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),Object.defineProperty(I,"prototype",{writable:!1}),T&&p(I,T)}function p(I,T){return p=Object.setPrototypeOf||function(P,M){return P.__proto__=M,P},p(I,T)}function m(I){var T=S();return function(){var P=b(I),M;if(T){var D=b(this).constructor;M=Reflect.construct(P,arguments,D)}else M=P.apply(this,arguments);return v(this,M)}}function v(I,T){if(T&&(n(T)==="object"||typeof T=="function"))return T;if(T!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(I)}function g(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(I){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},b(I)}function R(I,T,C){return T in I?Object.defineProperty(I,T,{value:C,enumerable:!0,configurable:!0,writable:!0}):I[T]=C,I}var k=function(I){h(C,I);var T=m(C);function C(P){var M;c(this,C),M=T.call(this,P),R(g(M),"text",void 0),R(g(M),"html",void 0),R(g(M),"renderings",void 0);var D=i.M_MESSAGE.findIn(M.wireContent),F=i.M_TEXT.findIn(M.wireContent),U=i.M_HTML.findIn(M.wireContent);if((0,t.isProvided)(D)){if(!Array.isArray(D))throw new r.InvalidEventError("m.message contents must be an array");var B=D.find(function(z){return!(0,t.isProvided)(z.mimetype)||z.mimetype==="text/plain"}),V=D.find(function(z){return z.mimetype==="text/html"});if(!B)throw new r.InvalidEventError("m.message is missing a plain text representation");M.text=B.body,M.html=V==null?void 0:V.body,M.renderings=D}else if((0,t.isOptionalAString)(F))M.text=F,M.html=U,M.renderings=[{body:F,mimetype:"text/plain"}],M.html&&M.renderings.push({body:M.html,mimetype:"text/html"});else throw new r.InvalidEventError("Missing textual representation for event");return M}return u(C,[{key:"isEmote",get:function(){return i.M_EMOTE.matches(this.wireFormat.type)||(0,t.isProvided)(i.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return i.M_NOTICE.matches(this.wireFormat.type)||(0,t.isProvided)(i.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(M){return(0,s.isEventTypeSame)(M,i.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var M=R({},i.M_MESSAGE.name,this.renderings);if(this.renderings.length===1){var D=this.renderings[0].mimetype;(D===void 0||D==="text/plain")&&(M=R({},i.M_TEXT.name,this.renderings[0].body))}return M}},{key:"serialize",value:function(){var M;return{type:"m.room.message",content:a(a({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:(M=this.html)!==null&&M!==void 0?M:void 0})}}}],[{key:"from",value:function(M,D){var F;return new C({type:i.M_MESSAGE.name,content:(F={},R(F,i.M_TEXT.name,M),R(F,i.M_HTML.name,D),F)})}}]),C}(e.ExtensibleEvent);return xm.MessageEvent=k,xm}var Am={},GO;function nP(){if(GO)return Am;GO=1;function n(R){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},n(R)}Object.defineProperty(Am,"__esModule",{value:!0}),Am.NoticeEvent=void 0;var e=Hd(),t=Na(),r=Bd();function i(R,k,I){return k in R?Object.defineProperty(R,k,{value:I,enumerable:!0,configurable:!0,writable:!0}):R[k]=I,R}function s(R,k){if(!(R instanceof k))throw new TypeError("Cannot call a class as a function")}function o(R,k){for(var I=0;I<k.length;I++){var T=k[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function a(R,k,I){return k&&o(R.prototype,k),I&&o(R,I),Object.defineProperty(R,"prototype",{writable:!1}),R}function c(){return typeof Reflect<"u"&&Reflect.get?c=Reflect.get:c=function(k,I,T){var C=l(k,I);if(C){var P=Object.getOwnPropertyDescriptor(C,I);return P.get?P.get.call(arguments.length<3?k:T):P.value}},c.apply(this,arguments)}function l(R,k){for(;!Object.prototype.hasOwnProperty.call(R,k)&&(R=S(R),R!==null););return R}function u(R,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(k&&k.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),k&&h(R,k)}function h(R,k){return h=Object.setPrototypeOf||function(T,C){return T.__proto__=C,T},h(R,k)}function p(R){var k=g();return function(){var T=S(R),C;if(k){var P=S(this).constructor;C=Reflect.construct(T,arguments,P)}else C=T.apply(this,arguments);return m(this,C)}}function m(R,k){if(k&&(n(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v(R)}function v(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(R){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)},S(R)}var b=function(R){u(I,R);var k=p(I);function I(T){return s(this,I),k.call(this,T)}return a(I,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(C){return(0,r.isEventTypeSame)(C,t.M_NOTICE)||c(S(I.prototype),"isEquivalentTo",this).call(this,C)}},{key:"serialize",value:function(){var C=c(S(I.prototype),"serialize",this).call(this);return C.content.msgtype="m.notice",C}}],[{key:"from",value:function(C,P){var M;return new I({type:t.M_NOTICE.name,content:(M={},i(M,t.M_TEXT.name,C),i(M,t.M_HTML.name,P),M)})}}]),I}(e.MessageEvent);return Am.NoticeEvent=b,Am}var Mm={},qO;function rP(){if(qO)return Mm;qO=1;function n(R){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},n(R)}Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.EmoteEvent=void 0;var e=Hd(),t=Na(),r=Bd();function i(R,k,I){return k in R?Object.defineProperty(R,k,{value:I,enumerable:!0,configurable:!0,writable:!0}):R[k]=I,R}function s(R,k){if(!(R instanceof k))throw new TypeError("Cannot call a class as a function")}function o(R,k){for(var I=0;I<k.length;I++){var T=k[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function a(R,k,I){return k&&o(R.prototype,k),I&&o(R,I),Object.defineProperty(R,"prototype",{writable:!1}),R}function c(){return typeof Reflect<"u"&&Reflect.get?c=Reflect.get:c=function(k,I,T){var C=l(k,I);if(C){var P=Object.getOwnPropertyDescriptor(C,I);return P.get?P.get.call(arguments.length<3?k:T):P.value}},c.apply(this,arguments)}function l(R,k){for(;!Object.prototype.hasOwnProperty.call(R,k)&&(R=S(R),R!==null););return R}function u(R,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(k&&k.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),k&&h(R,k)}function h(R,k){return h=Object.setPrototypeOf||function(T,C){return T.__proto__=C,T},h(R,k)}function p(R){var k=g();return function(){var T=S(R),C;if(k){var P=S(this).constructor;C=Reflect.construct(T,arguments,P)}else C=T.apply(this,arguments);return m(this,C)}}function m(R,k){if(k&&(n(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v(R)}function v(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(R){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)},S(R)}var b=function(R){u(I,R);var k=p(I);function I(T){return s(this,I),k.call(this,T)}return a(I,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(C){return(0,r.isEventTypeSame)(C,t.M_EMOTE)||c(S(I.prototype),"isEquivalentTo",this).call(this,C)}},{key:"serialize",value:function(){var C=c(S(I.prototype),"serialize",this).call(this);return C.content.msgtype="m.emote",C}}],[{key:"from",value:function(C,P){var M;return new I({type:t.M_EMOTE.name,content:(M={},i(M,t.M_TEXT.name,C),i(M,t.M_HTML.name,P),M)})}}]),I}(e.MessageEvent);return Mm.EmoteEvent=b,Mm}var KO;function kj(){if(KO)return xh;KO=1,Object.defineProperty(xh,"__esModule",{value:!0}),xh.LEGACY_M_ROOM_MESSAGE=void 0,xh.parseMRoomMessage=l;var n=Hd(),e=nP(),t=rP(),r=pp(),i=Na();function s(u,h){var p=Object.keys(u);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(u);h&&(m=m.filter(function(v){return Object.getOwnPropertyDescriptor(u,v).enumerable})),p.push.apply(p,m)}return p}function o(u){for(var h=1;h<arguments.length;h++){var p=arguments[h]!=null?arguments[h]:{};h%2?s(Object(p),!0).forEach(function(m){a(u,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(p)):s(Object(p)).forEach(function(m){Object.defineProperty(u,m,Object.getOwnPropertyDescriptor(p,m))})}return u}function a(u,h,p){return h in u?Object.defineProperty(u,h,{value:p,enumerable:!0,configurable:!0,writable:!0}):u[h]=p,u}var c=new r.NamespacedValue("m.room.message");xh.LEGACY_M_ROOM_MESSAGE=c;function l(u){var h,p,m;if(i.M_MESSAGE.findIn(u.content)||i.M_TEXT.findIn(u.content))return new n.MessageEvent(u);var v=(h=u.content)===null||h===void 0?void 0:h.msgtype,g=(p=u.content)===null||p===void 0?void 0:p.body,S=((m=u.content)===null||m===void 0?void 0:m.format)==="org.matrix.custom.html"?u.content.formatted_body:null;if(v==="m.text"){var b;return new n.MessageEvent(o(o({},u),{},{content:o(o({},u.content),{},(b={},a(b,i.M_TEXT.name,g),a(b,i.M_HTML.name,S),b))}))}else if(v==="m.notice"){var R;return new e.NoticeEvent(o(o({},u),{},{content:o(o({},u.content),{},(R={},a(R,i.M_TEXT.name,g),a(R,i.M_HTML.name,S),R))}))}else if(v==="m.emote"){var k;return new t.EmoteEvent(o(o({},u),{},{content:o(o({},u.content),{},(k={},a(k,i.M_TEXT.name,g),a(k,i.M_HTML.name,S),k))}))}else return null}return xh}var Q0={},WO;function xj(){if(WO)return Q0;WO=1,Object.defineProperty(Q0,"__esModule",{value:!0}),Q0.parseMMessage=i;var n=Hd(),e=Na(),t=rP(),r=nP();function i(s){return e.M_EMOTE.matches(s.type)?new t.EmoteEvent(s):e.M_NOTICE.matches(s.type)?new r.NoticeEvent(s):new n.MessageEvent(s)}return Q0}var hs={},zO;function mp(){if(zO)return hs;zO=1,Object.defineProperty(hs,"__esModule",{value:!0}),hs.M_POLL_START=hs.M_POLL_RESPONSE=hs.M_POLL_KIND_UNDISCLOSED=hs.M_POLL_KIND_DISCLOSED=hs.M_POLL_END=void 0;var n=pp(),e=new n.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");hs.M_POLL_KIND_DISCLOSED=e;var t=new n.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");hs.M_POLL_KIND_UNDISCLOSED=t;var r=new n.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");hs.M_POLL_START=r;var i=new n.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");hs.M_POLL_RESPONSE=i;var s=new n.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");return hs.M_POLL_END=s,hs}var e1={},Uu={},YO;function Pj(){if(YO)return Uu;YO=1;function n(H){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(J){return typeof J}:function(J){return J&&typeof Symbol=="function"&&J.constructor===Symbol&&J!==Symbol.prototype?"symbol":typeof J},n(H)}Object.defineProperty(Uu,"__esModule",{value:!0}),Uu.PollStartEvent=Uu.PollAnswerSubevent=void 0;var e=mp(),t=Hd(),r=Na(),i=fp(),s=pp(),o=Bd(),a=iy();function c(H){return p(H)||h(H)||u(H)||l()}function l(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u(H,J){if(H){if(typeof H=="string")return m(H,J);var Y=Object.prototype.toString.call(H).slice(8,-1);if(Y==="Object"&&H.constructor&&(Y=H.constructor.name),Y==="Map"||Y==="Set")return Array.from(H);if(Y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return m(H,J)}}function h(H){if(typeof Symbol<"u"&&H[Symbol.iterator]!=null||H["@@iterator"]!=null)return Array.from(H)}function p(H){if(Array.isArray(H))return m(H)}function m(H,J){(J==null||J>H.length)&&(J=H.length);for(var Y=0,G=new Array(J);Y<J;Y++)G[Y]=H[Y];return G}function v(H,J){var Y=Object.keys(H);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(H);J&&(G=G.filter(function(K){return Object.getOwnPropertyDescriptor(H,K).enumerable})),Y.push.apply(Y,G)}return Y}function g(H){for(var J=1;J<arguments.length;J++){var Y=arguments[J]!=null?arguments[J]:{};J%2?v(Object(Y),!0).forEach(function(G){F(H,G,Y[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(Y)):v(Object(Y)).forEach(function(G){Object.defineProperty(H,G,Object.getOwnPropertyDescriptor(Y,G))})}return H}function S(H,J){if(!(H instanceof J))throw new TypeError("Cannot call a class as a function")}function b(H,J){for(var Y=0;Y<J.length;Y++){var G=J[Y];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(H,G.key,G)}}function R(H,J,Y){return J&&b(H.prototype,J),Y&&b(H,Y),Object.defineProperty(H,"prototype",{writable:!1}),H}function k(H,J){if(typeof J!="function"&&J!==null)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(J&&J.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),Object.defineProperty(H,"prototype",{writable:!1}),J&&I(H,J)}function I(H,J){return I=Object.setPrototypeOf||function(G,K){return G.__proto__=K,G},I(H,J)}function T(H){var J=M();return function(){var G=D(H),K;if(J){var ee=D(this).constructor;K=Reflect.construct(G,arguments,ee)}else K=G.apply(this,arguments);return C(this,K)}}function C(H,J){if(J&&(n(J)==="object"||typeof J=="function"))return J;if(J!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return P(H)}function P(H){if(H===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return H}function M(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(H){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},D(H)}function F(H,J,Y){return J in H?Object.defineProperty(H,J,{value:Y,enumerable:!0,configurable:!0,writable:!0}):H[J]=Y,H}var U=function(H){k(Y,H);var J=T(Y);function Y(G){var K;S(this,Y),K=J.call(this,G),F(P(K),"id",void 0);var ee=G.content.id;if(!ee||typeof ee!="string")throw new i.InvalidEventError("Answer ID must be a non-empty string");return K.id=ee,K}return R(Y,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:g({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(K,ee){return new Y({type:"org.matrix.sdk.poll.answer",content:F({id:K},r.M_TEXT.name,ee)})}}]),Y}(t.MessageEvent);Uu.PollAnswerSubevent=U;var B=function(H){k(Y,H);var J=T(Y);function Y(G){var K;S(this,Y),K=J.call(this,G),F(P(K),"question",void 0),F(P(K),"kind",void 0),F(P(K),"rawKind",void 0),F(P(K),"maxSelections",void 0),F(P(K),"answers",void 0);var ee=e.M_POLL_START.findIn(K.wireContent);if(!ee.question)throw new i.InvalidEventError("A question is required");if(K.question=new t.MessageEvent({type:"org.matrix.sdk.poll.question",content:ee.question}),K.rawKind=ee.kind,e.M_POLL_KIND_DISCLOSED.matches(K.rawKind)?K.kind=e.M_POLL_KIND_DISCLOSED:K.kind=e.M_POLL_KIND_UNDISCLOSED,K.maxSelections=Number.isFinite(ee.max_selections)&&ee.max_selections>0?ee.max_selections:1,!Array.isArray(ee.answers))throw new i.InvalidEventError("Poll answers must be an array");var q=ee.answers.slice(0,20).map(function(Q){return new U({type:"org.matrix.sdk.poll.answer",content:Q})});if(q.length<=0)throw new i.InvalidEventError("No answers available");return K.answers=q,K}return R(Y,[{key:"isEquivalentTo",value:function(K){return(0,o.isEventTypeSame)(K,e.M_POLL_START)}},{key:"serialize",value:function(){var K;return{type:e.M_POLL_START.name,content:(K={},F(K,e.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(ee){return ee.serialize().content})}),F(K,r.M_TEXT.name,"".concat(this.question.text,`
`).concat(this.answers.map(function(ee,q){return"".concat(q+1,". ").concat(ee.text)}).join(`
`))),K)}}}],[{key:"from",value:function(K,ee,q){var Q,Se=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return new Y({type:e.M_POLL_START.name,content:(Q={},F(Q,r.M_TEXT.name,K),F(Q,e.M_POLL_START.name,{question:F({},r.M_TEXT.name,K),kind:q instanceof s.NamespacedValue?q.name:q,max_selections:Se,answers:ee.map(function(Ie){return F({id:z()},r.M_TEXT.name,Ie)})}),Q)})}}]),Y}(a.ExtensibleEvent);Uu.PollStartEvent=B;var V="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function z(){return c(Array(16)).map(function(){return V.charAt(Math.floor(Math.random()*V.length))}).join("")}return Uu}var Om={},Nm={},XO;function iP(){if(XO)return Nm;XO=1,Object.defineProperty(Nm,"__esModule",{value:!0}),Nm.REFERENCE_RELATION=void 0;var n=pp(),e=new n.NamespacedValue("m.reference");return Nm.REFERENCE_RELATION=e,Nm}var JO;function Lj(){if(JO)return Om;JO=1;function n(R){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},n(R)}Object.defineProperty(Om,"__esModule",{value:!0}),Om.PollResponseEvent=void 0;var e=iy(),t=mp(),r=fp(),i=iP(),s=Bd();function o(R,k){if(!(R instanceof k))throw new TypeError("Cannot call a class as a function")}function a(R,k){for(var I=0;I<k.length;I++){var T=k[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function c(R,k,I){return k&&a(R.prototype,k),I&&a(R,I),Object.defineProperty(R,"prototype",{writable:!1}),R}function l(R,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(k&&k.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),k&&u(R,k)}function u(R,k){return u=Object.setPrototypeOf||function(T,C){return T.__proto__=C,T},u(R,k)}function h(R){var k=v();return function(){var T=g(R),C;if(k){var P=g(this).constructor;C=Reflect.construct(T,arguments,P)}else C=T.apply(this,arguments);return p(this,C)}}function p(R,k){if(k&&(n(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m(R)}function m(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(R){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)},g(R)}function S(R,k,I){return k in R?Object.defineProperty(R,k,{value:I,enumerable:!0,configurable:!0,writable:!0}):R[k]=I,R}var b=function(R){l(I,R);var k=h(I);function I(T){var C;o(this,I),C=k.call(this,T),S(m(C),"internalAnswerIds",void 0),S(m(C),"internalSpoiled",void 0),S(m(C),"pollEventId",void 0);var P=C.wireContent["m.relates_to"];if(!i.REFERENCE_RELATION.matches(P==null?void 0:P.rel_type)||typeof(P==null?void 0:P.event_id)!="string")throw new r.InvalidEventError("Relationship must be a reference to an event");return C.pollEventId=P.event_id,C.validateAgainst(null),C}return c(I,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(C){var P=t.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(P==null?void 0:P.answers)){this.internalSpoiled=!0,this.internalAnswerIds=[];return}var M=P.answers;if(M.some(function(D){return typeof D!="string"})||M.length===0){this.internalSpoiled=!0,this.internalAnswerIds=[];return}if(C){if(M.some(function(D){return!C.answers.some(function(F){return F.id===D})})){this.internalSpoiled=!0,this.internalAnswerIds=[];return}M=M.slice(0,C.maxSelections)}this.internalAnswerIds=M,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(C){return(0,s.isEventTypeSame)(C,t.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:t.M_POLL_RESPONSE.name,content:S({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:this.pollEventId}},t.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(C,P){return new I({type:t.M_POLL_RESPONSE.name,content:S({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:P}},t.M_POLL_RESPONSE.name,{answers:C})})}}]),I}(e.ExtensibleEvent);return Om.PollResponseEvent=b,Om}var Dm={},ZO;function Aj(){if(ZO)return Dm;ZO=1;function n(C){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},n(C)}Object.defineProperty(Dm,"__esModule",{value:!0}),Dm.PollEndEvent=void 0;var e=mp(),t=fp(),r=iP(),i=Hd(),s=Na(),o=Bd(),a=iy();function c(C,P){var M=Object.keys(C);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(C);P&&(D=D.filter(function(F){return Object.getOwnPropertyDescriptor(C,F).enumerable})),M.push.apply(M,D)}return M}function l(C){for(var P=1;P<arguments.length;P++){var M=arguments[P]!=null?arguments[P]:{};P%2?c(Object(M),!0).forEach(function(D){I(C,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(M)):c(Object(M)).forEach(function(D){Object.defineProperty(C,D,Object.getOwnPropertyDescriptor(M,D))})}return C}function u(C,P){if(!(C instanceof P))throw new TypeError("Cannot call a class as a function")}function h(C,P){for(var M=0;M<P.length;M++){var D=P[M];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(C,D.key,D)}}function p(C,P,M){return P&&h(C.prototype,P),M&&h(C,M),Object.defineProperty(C,"prototype",{writable:!1}),C}function m(C,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(P&&P.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),P&&v(C,P)}function v(C,P){return v=Object.setPrototypeOf||function(D,F){return D.__proto__=F,D},v(C,P)}function g(C){var P=R();return function(){var D=k(C),F;if(P){var U=k(this).constructor;F=Reflect.construct(D,arguments,U)}else F=D.apply(this,arguments);return S(this,F)}}function S(C,P){if(P&&(n(P)==="object"||typeof P=="function"))return P;if(P!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return b(C)}function b(C){if(C===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function k(C){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},k(C)}function I(C,P,M){return P in C?Object.defineProperty(C,P,{value:M,enumerable:!0,configurable:!0,writable:!0}):C[P]=M,C}var T=function(C){m(M,C);var P=g(M);function M(D){var F;u(this,M),F=P.call(this,D),I(b(F),"pollEventId",void 0),I(b(F),"closingMessage",void 0);var U=F.wireContent["m.relates_to"];if(!r.REFERENCE_RELATION.matches(U==null?void 0:U.rel_type)||typeof(U==null?void 0:U.event_id)!="string")throw new t.InvalidEventError("Relationship must be a reference to an event");return F.pollEventId=U.event_id,F.closingMessage=new i.MessageEvent(F.wireFormat),F}return p(M,[{key:"isEquivalentTo",value:function(F){return(0,o.isEventTypeSame)(F,e.M_POLL_END)}},{key:"serialize",value:function(){return{type:e.M_POLL_END.name,content:l(I({"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:this.pollEventId}},e.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(F,U){var B;return new M({type:e.M_POLL_END.name,content:(B={"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:F}},I(B,e.M_POLL_END.name,{}),I(B,s.M_TEXT.name,U),B)})}}]),M}(a.ExtensibleEvent);return Dm.PollEndEvent=T,Dm}var QO;function Mj(){if(QO)return e1;QO=1,Object.defineProperty(e1,"__esModule",{value:!0}),e1.parseMPoll=i;var n=mp(),e=Pj(),t=Lj(),r=Aj();function i(s){return n.M_POLL_START.matches(s.type)?new e.PollStartEvent(s):n.M_POLL_RESPONSE.matches(s.type)?new t.PollResponseEvent(s):n.M_POLL_END.matches(s.type)?new r.PollEndEvent(s):null}return e1}var e5;function Ore(){if(e5)return Im;e5=1,Object.defineProperty(Im,"__esModule",{value:!0}),Im.ExtensibleEvents=void 0;var n=Ij(),e=fp(),t=kj(),r=xj(),i=Na(),s=mp(),o=Mj();function a(g,S){var b=typeof Symbol<"u"&&g[Symbol.iterator]||g["@@iterator"];if(!b){if(Array.isArray(g)||(b=c(g))||S){b&&(g=b);var R=0,k=function(){};return{s:k,n:function(){return R>=g.length?{done:!0}:{done:!1,value:g[R++]}},e:function(M){throw M},f:k}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I=!0,T=!1,C;return{s:function(){b=b.call(g)},n:function(){var M=b.next();return I=M.done,M},e:function(M){T=!0,C=M},f:function(){try{!I&&b.return!=null&&b.return()}finally{if(T)throw C}}}}function c(g,S){if(g){if(typeof g=="string")return l(g,S);var b=Object.prototype.toString.call(g).slice(8,-1);if(b==="Object"&&g.constructor&&(b=g.constructor.name),b==="Map"||b==="Set")return Array.from(g);if(b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return l(g,S)}}function l(g,S){(S==null||S>g.length)&&(S=g.length);for(var b=0,R=new Array(S);b<S;b++)R[b]=g[b];return R}function u(g,S){if(!(g instanceof S))throw new TypeError("Cannot call a class as a function")}function h(g,S){for(var b=0;b<S.length;b++){var R=S[b];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(g,R.key,R)}}function p(g,S,b){return S&&h(g.prototype,S),b&&h(g,b),Object.defineProperty(g,"prototype",{writable:!1}),g}function m(g,S,b){return S in g?Object.defineProperty(g,S,{value:b,enumerable:!0,configurable:!0,writable:!0}):g[S]=b,g}var v=function(){function g(){u(this,g),m(this,"interpreters",new n.NamespacedMap([[t.LEGACY_M_ROOM_MESSAGE,t.parseMRoomMessage],[i.M_MESSAGE,r.parseMMessage],[i.M_EMOTE,r.parseMMessage],[i.M_NOTICE,r.parseMMessage],[s.M_POLL_START,o.parseMPoll],[s.M_POLL_RESPONSE,o.parseMPoll],[s.M_POLL_END,o.parseMPoll]])),m(this,"_unknownInterpretOrder",[i.M_MESSAGE])}return p(g,[{key:"unknownInterpretOrder",get:function(){var b;return(b=this._unknownInterpretOrder)!==null&&b!==void 0?b:[]},set:function(b){this._unknownInterpretOrder=b}},{key:"registerInterpreter",value:function(b,R){this.interpreters.set(b,R)}},{key:"parse",value:function(b){try{if(this.interpreters.hasNamespaced(b.type))return this.interpreters.getNamespaced(b.type)(b);var R=a(this.unknownInterpretOrder),k;try{for(R.s();!(k=R.n()).done;){var I=k.value;if(this.interpreters.has(I)){var T=this.interpreters.get(I)(b);if(T)return T}}}catch(C){R.e(C)}finally{R.f()}return null}catch(C){if(C instanceof e.InvalidEventError)return null;throw C}}}],[{key:"defaultInstance",get:function(){return g._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return g.defaultInstance.unknownInterpretOrder},set:function(b){g.defaultInstance.unknownInterpretOrder=b}},{key:"registerInterpreter",value:function(b,R){g.defaultInstance.registerInterpreter(b,R)}},{key:"parse",value:function(b){return g.defaultInstance.parse(b)}}]),g}();return Im.ExtensibleEvents=v,m(v,"_defaultInstance",new v),Im}var kT={},t5;function Nre(){return t5||(t5=1,Object.defineProperty(kT,"__esModule",{value:!0})),kT}var ju={},n5;function Dre(){if(n5)return ju;n5=1,Object.defineProperty(ju,"__esModule",{value:!0}),ju.LegacyMsgType=void 0,ju.isEventLike=t;var n=Na(),e;ju.LegacyMsgType=e,function(r){r.Text="m.text",r.Notice="m.notice",r.Emote="m.emote"}(e||(ju.LegacyMsgType=e={}));function t(r,i){var s=r.content;return i===e.Text?n.M_MESSAGE.matches(r.type)||r.type==="m.room.message"&&(s==null?void 0:s.msgtype)==="m.text":i===e.Emote?n.M_EMOTE.matches(r.type)||r.type==="m.room.message"&&(s==null?void 0:s.msgtype)==="m.emote":i===e.Notice?n.M_NOTICE.matches(r.type)||r.type==="m.room.message"&&(s==null?void 0:s.msgtype)==="m.notice":!1}return ju}var r5;function Fre(){return r5||(r5=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var e=Ore();Object.keys(e).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===e[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return e[C]}})});var t=Nre();Object.keys(t).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===t[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return t[C]}})});var r=fp();Object.keys(r).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===r[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return r[C]}})});var i=pp();Object.keys(i).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===i[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return i[C]}})});var s=Ij();Object.keys(s).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===s[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return s[C]}})});var o=Rj();Object.keys(o).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===o[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return o[C]}})});var a=Dre();Object.keys(a).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===a[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return a[C]}})});var c=Bd();Object.keys(c).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===c[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return c[C]}})});var l=kj();Object.keys(l).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===l[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return l[C]}})});var u=xj();Object.keys(u).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===u[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return u[C]}})});var h=Mj();Object.keys(h).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===h[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return h[C]}})});var p=iP();Object.keys(p).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===p[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return p[C]}})});var m=iy();Object.keys(m).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===m[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return m[C]}})});var v=Na();Object.keys(v).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===v[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return v[C]}})});var g=Hd();Object.keys(g).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===g[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return g[C]}})});var S=rP();Object.keys(S).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===S[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return S[C]}})});var b=nP();Object.keys(b).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===b[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return b[C]}})});var R=mp();Object.keys(R).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===R[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return R[C]}})});var k=Pj();Object.keys(k).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===k[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return k[C]}})});var I=Lj();Object.keys(I).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===I[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return I[C]}})});var T=Aj();Object.keys(T).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===T[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return T[C]}})})}(RT)),RT}var ss=Fre();const Ure="modulepreload",jre=function(n,e){return new URL(n,e).href},i5={},rv=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=jre(l,r),l in i5)return;i5[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!r)for(let v=o.length-1;v>=0;v--){const g=o[v];if(g.href===l&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Ure,u||(m.as="script"),m.crossOrigin="",m.href=l,c&&m.setAttribute("nonce",c),document.head.appendChild(m),u)return new Promise((v,g)=>{m.addEventListener("load",v),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var Ll=(n=>(n.DisplayName="User.displayName",n.AvatarUrl="User.avatarUrl",n.Presence="User.presence",n.CurrentlyActive="User.currentlyActive",n.LastPresenceTs="User.lastPresenceTs",n))(Ll||{});class _c extends Xn{constructor(e){super(),this.userId=e,this.modified=-1,this.presence="offline",this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={},this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,t){const r=new _c(e);return t.reEmitter.reEmit(r,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),r}setPresenceEvent(e){if(e.getType()!=="m.presence")return;const t=this.events.presence===null;this.events.presence=e;const r=[];(e.getContent().presence!==this.presence||t)&&r.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push("User.displayName"),e.getContent().currently_active!==void 0&&e.getContent().currently_active!==this.currentlyActive&&r.push("User.currentlyActive"),this.presence=e.getContent().presence,r.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(const i of r)this.emit(i,e,this)}setDisplayName(e){const t=this.displayName;this.displayName=e,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var St=(n=>(n.Backward="b",n.Forward="f",n))(St||{});const oi=class oi{constructor(e){var t;this.eventTimelineSet=e,this.events=[],this.baseIndex=0,this.startToken=null,this.endToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={b:null,f:null},this.roomId=((t=e.room)==null?void 0:t.roomId)??null,this.roomId&&(this.startState=new fv(this.roomId),this.endState=new fv(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+new Date().toISOString()}static setEventMetadata(e,t,r){e.setMetadata(t,r)}initialiseState(e,{timelineWasEmpty:t}={}){var r,i;if(this.events.length>0)throw new Error("Cannot initialise state after events are added");(r=this.startState)==null||r.setStateEvents(e,{timelineWasEmpty:t}),(i=this.endState)==null||i.setStateEvents(e,{timelineWasEmpty:t})}forkLive(e){const t=this.getState(e),r=new oi(this.eventTimelineSet);return r.startState=t==null?void 0:t.clone(),r.endState=t,this.endState=t==null?void 0:t.clone(),r}fork(e){const t=this.getState(e),r=new oi(this.eventTimelineSet);return r.startState=t==null?void 0:t.clone(),r.endState=t==null?void 0:t.clone(),r}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==oi.BACKWARDS)return this.startState;if(e==oi.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e==="b"?this.startToken:this.endToken}setPaginationToken(e,t){this.roomId?this.getState(t).paginationToken=e:t==="b"?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==oi.BACKWARDS)return this.prevTimeline;if(e==oi.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==oi.BACKWARDS)this.prevTimeline=e;else if(t==oi.FORWARDS)this.nextTimeline=e;else throw new Error("Invalid direction '"+t+"'");this.setPaginationToken(null,t)}addEvent(e,{toStartOfTimeline:t,roomState:r,timelineWasEmpty:i,addToState:s}){r||(r=t?this.startState:this.endState);const o=this.getTimelineSet();o.room&&(oi.setEventMetadata(e,r,t),s&&e.isState()&&o.room.getUnfilteredTimelineSet()===o&&(r==null||r.setStateEvents([e],{timelineWasEmpty:i}),(!e.sender||e.getType()===ie.RoomMember&&!t)&&oi.setEventMetadata(e,r,t)));let a;t?a=0:a=this.events.length,this.events.splice(a,0,e),t&&this.baseIndex++}insertEvent(e,t,r,i){const s=this.getTimelineSet();s.room&&(oi.setEventMetadata(e,r,!1),i&&e.isState()&&s.room.getUnfilteredTimelineSet()===s&&(r.setStateEvents([e],{}),(!e.sender||e.getType()===ie.RoomMember)&&oi.setEventMetadata(e,r,!1))),this.events.splice(t,0,e)}removeEvent(e){for(let t=this.events.length-1;t>=0;t--){const r=this.events[t];if(r.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,r}return null}toString(){return this.name}};oi.BACKWARDS="b",oi.FORWARDS="f";let $e=oi;var Oj=(n=>(n.Add="Relations.add",n.Remove="Relations.remove",n.Redaction="Relations.redaction",n))(Oj||{});const $re=(n,e,t=[])=>[e,...t].includes(n);class sP extends Xn{constructor(e,t,r,i){super(),this.relationType=e,this.eventType=t,this.altEventTypes=i,this.relationEventIds=new Set,this.relations=new Set,this.annotationsByKey={},this.annotationsBySender={},this.sortedAnnotationsByKey=[],this.targetEvent=null,this.creationEmitted=!1,this.onEventStatus=(s,o)=>{if(!s.isSending()){s.removeListener(mn.Status,this.onEventStatus);return}o===nt.CANCELLED&&(s.removeListener(mn.Status,this.onEventStatus),this.removeEvent(s))},this.onBeforeRedaction=async s=>{if(this.relations.has(s)){if(this.relations.delete(s),this.relationType===on.Annotation)this.removeAnnotationFromAggregation(s);else if(this.relationType===on.Replace&&this.targetEvent&&!this.targetEvent.isState()){const o=await this.getLastReplacement();this.targetEvent.makeReplaced(o)}s.removeListener(mn.BeforeRedaction,this.onBeforeRedaction),this.emit("Relations.redaction",s)}},this.client=r instanceof dw?r.client:r}async addEvent(e){if(this.relationEventIds.has(e.getId()))return;const t=e.getRelation();if(!t){O.error("Event must have relation info");return}const r=t.rel_type,i=e.getType();if(this.relationType!==r||!$re(i,this.eventType,this.altEventTypes)){O.error("Event relation info doesn't match this container");return}if(e.isSending()&&e.on(mn.Status,this.onEventStatus),this.relations.add(e),this.relationEventIds.add(e.getId()),this.relationType===on.Annotation)this.addAnnotationToAggregation(e);else if(this.relationType===on.Replace&&this.targetEvent&&!this.targetEvent.isState()){const s=await this.getLastReplacement();this.targetEvent.makeReplaced(s)}e.on(mn.BeforeRedaction,this.onBeforeRedaction),this.emit("Relations.add",e),this.maybeEmitCreated()}async removeEvent(e){if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===on.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===on.Replace&&this.targetEvent&&!this.targetEvent.isState()){const t=await this.getLastReplacement();this.targetEvent.makeReplaced(t)}this.emit("Relations.remove",e)}}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){const{key:t}=e.getRelation()??{};if(!t)return;let r=this.annotationsByKey[t];r||(r=this.annotationsByKey[t]=new Set,this.sortedAnnotationsByKey.push([t,r])),r.add(e),this.sortedAnnotationsByKey.sort((o,a)=>{const c=o[1];return a[1].size-c.size});const i=e.getSender();let s=this.annotationsBySender[i];s||(s=this.annotationsBySender[i]=new Set),s.add(e)}removeAnnotationFromAggregation(e){const{key:t}=e.getRelation()??{};if(!t)return;const r=this.annotationsByKey[t];r&&(r.delete(e),this.sortedAnnotationsByKey.sort((o,a)=>{const c=o[1];return a[1].size-c.size}));const i=e.getSender(),s=this.annotationsBySender[i];s&&s.delete(e)}getSortedAnnotationsByKey(){return this.relationType!==on.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==on.Annotation?null:this.annotationsBySender}async getLastReplacement(){if(this.relationType!==on.Replace||!this.targetEvent)return null;const e=this.targetEvent.getServerAggregatedRelation(on.Replace),t=e==null?void 0:e.origin_server_ts,r=this.getRelations().reduce((i,s)=>s.getSender()!==this.targetEvent.getSender()||t&&t>s.getTs()||i&&i.getTs()>s.getTs()?i:s,null);return r!=null&&r.shouldAttemptDecryption()&&this.client.getCrypto()?await r.attemptDecryption(this.client.getCrypto()):r!=null&&r.isBeingDecrypted()&&await r.getDecryptionPromise(),r}async setTargetEvent(e){if(!this.targetEvent){if(this.targetEvent=e,this.relationType===on.Replace&&!this.targetEvent.isState()){const t=await this.getLastReplacement();t&&this.targetEvent.makeReplaced(t)}this.maybeEmitCreated()}}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(mn.RelationsCreated,this.relationType,this.eventType))}}class Nj{constructor(e,t){this.client=e,this.room=t,this.relations=new Map}getChildEventsForEvent(e,t,r){var i,s;return(s=(i=this.relations.get(e))==null?void 0:i.get(t))==null?void 0:s.get(r)}getAllChildEventsForEvent(e){const t=this.relations.get(e)??new Map,r=[];for(const i of t.values())for(const s of i.values())r.push(...s.getRelations());return r}aggregateParentEvent(e){const t=this.relations.get(e.getId());if(t)for(const r of t.values())for(const i of r.values())i.setTargetEvent(e)}aggregateChildEvent(e,t){if(e.isRedacted()||e.status===nt.CANCELLED)return;const r=e.getRelation();if(!r)return;const i=()=>{if(e.isDecryptionFailure()){e.once(mn.Decrypted,i);return}this.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption()){e.once(mn.Decrypted,i);return}const{event_id:s,rel_type:o}=r,a=e.getType();let c=this.relations.get(s);c||(c=new Map,this.relations.set(s,c));let l=c.get(o);l||(l=new Map,c.set(o,l));let u=l.get(a);if(!u){u=new sP(o,a,this.client),l.set(a,u);const h=this.room??(t==null?void 0:t.room),p=(t==null?void 0:t.findEventById(s))??(h==null?void 0:h.findEventById(s))??(h==null?void 0:h.getPendingEvent(s));p&&u.setTargetEvent(p)}u.addEvent(e)}}let Qh;Qh=O.log.bind(O);var Ig=(n=>(n.Ignore="ignore",n.Replace="replace",n))(Ig||{});class cf extends Xn{constructor(e,t={},r,i,s=null){var o;super(),this.room=e,this.thread=i,this.threadListType=s,this._eventIdToTimeline=new Map,this.timelineSupport=!!t.timelineSupport,this.liveTimeline=new $e(this),this.displayPendingEvents=t.pendingEvents!==!1,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=t.filter,this.relations=((o=this.room)==null?void 0:o.relations)??new Nj((e==null?void 0:e.client)??r)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return!this.room||!this.displayPendingEvents?[]:this.room.getPendingEvents()}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,t){const r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,r))}resetLiveTimeline(e,t){const r=!this.timelineSupport||!t,i=this.liveTimeline,s=r?i.forkLive($e.FORWARDS):i.fork($e.FORWARDS);r?(this.timelines=[s],this._eventIdToTimeline=new Map):this.timelines.push(s),t&&i.setPaginationToken(t,$e.FORWARDS),s.setPaginationToken(e??null,$e.BACKWARDS),this.liveTimeline=s,this.emit(Je.TimelineReset,this.room,this,r)}getTimelineForEvent(e){if(e==null)return null;const t=this._eventIdToTimeline.get(e);return t===void 0?null:t}findEventById(e){const t=this.getTimelineForEvent(e);if(t)return t.getEvents().find(function(r){return r.getId()==e})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new $e(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,r,i,s){if(!i)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&i==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&(e=this.filter.filterRoomTimeline(e),!e.length))return;const o=t?$e.BACKWARDS:$e.FORWARDS,a=t?$e.FORWARDS:$e.BACKWARDS;let c=!1,l=!1;for(const u of e){const h=u.getId(),p=this._eventIdToTimeline.get(h);if(!p){this.addEventToTimeline(u,i,{toStartOfTimeline:t,addToState:r}),l=!0,c=!0;continue}if(l=!1,p==i){Qh("Event "+h+" already in timeline "+i);continue}const m=i.getNeighbouringTimeline(o);if(m){p==m?Qh("Event "+h+" in neighbouring timeline - switching to "+p):Qh("Event "+h+" already in a different timeline "+p),i=p;continue}O.info("Already have timeline for "+h+" - joining timeline "+i+" to "+p);const v=p===this.liveTimeline,g=i===this.liveTimeline,S=o===$e.BACKWARDS&&v,b=o===$e.FORWARDS&&g;if(S||b){S&&O.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+p+")"),b&&O.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+i+")");continue}i.setNeighbouringTimeline(p,o),p.setNeighbouringTimeline(i,a),i=p,c=!0}if(l||!c){if(o===$e.FORWARDS&&i===this.liveTimeline){O.warn({lastEventWasNew:l,didUpdate:c}),O.warn(`Refusing to set forwards pagination token of live timeline ${i} to ${s}`);return}i.setPaginationToken(s??null,o)}}addLiveEvent(e,{duplicateStrategy:t,fromCache:r,roomState:i,timelineWasEmpty:s,addToState:o}){if(this.filter&&!this.filter.filterRoomTimeline([e]).length)return;const a=this._eventIdToTimeline.get(e.getId());if(a){if(t==="replace"){Qh("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const c=a.getEvents();for(let l=0;l<c.length;l++)if(c[l].getId()===e.getId()){i||(i=a.getState($e.FORWARDS)),$e.setEventMetadata(e,i,!1),c[l]=e;break}}else Qh("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());return}this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:r,roomState:i,timelineWasEmpty:s,addToState:o})}addEventToTimeline(e,t,{toStartOfTimeline:r,fromCache:i=!1,roomState:s,timelineWasEmpty:o,addToState:a}){var u,h;if(t.getTimelineSet()!==this)throw new Error(`EventTimelineSet.addEventToTimeline: Timeline=${t.toString()} does not belong " +
                "in timelineSet(threadId=${(u=this.thread)==null?void 0:u.id})`);const c=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){let p=`event=${c}`;e.threadRootId&&(p+=`(belongs to thread=${e.threadRootId})`),O.warn(`EventTimelineSet.addEventToTimeline: Ignoring ${p} that does not belong in timeline=${t.toString()} timelineSet(threadId=${(h=this.thread)==null?void 0:h.id})`);return}t.addEvent(e,{toStartOfTimeline:r,roomState:s,timelineWasEmpty:o,addToState:a}),this._eventIdToTimeline.set(c,t);const l={timeline:t,liveEvent:!r&&t==this.liveTimeline&&!i};this.emit(Je.Timeline,e,this.room,!!r,!1,l)}insertEventIntoTimeline(e,t,r,i){var p,m;if(t.getTimelineSet()!==this)throw new Error(`EventTimelineSet.insertEventIntoTimeline: Timeline=${t.toString()} does not belong " +
                "in timelineSet(threadId=${(p=this.thread)==null?void 0:p.id})`);const s=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){let v=`event=${s}`;e.threadRootId&&(v+=`(belongs to thread=${e.threadRootId})`),O.warn(`EventTimelineSet.insertEventIntoTimeline: Ignoring ${v} that does not belong in timeline=${t.toString()} timelineSet(threadId=${(m=this.thread)==null?void 0:m.id})`);return}const o=e.relationEventId;if(!o){this.addEventToTimeline(e,t,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:r,addToState:i});return}const a=this.findEventById(o),c=t.getEvents();let u=a!==void 0?c.indexOf(a):0;for(;u<c.length&&!(c[u].getTs()>e.getTs());u++);t.insertEvent(e,u,r,i),this._eventIdToTimeline.set(s,t);const h={timeline:t,liveEvent:!1};this.emit(Je.Timeline,e,this.room,!1,!1,h)}handleRemoteEcho(e,t,r){const i=this._eventIdToTimeline.get(t);i?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(r,i)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){const t=this._eventIdToTimeline.get(e);if(!t)return null;const r=t.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);const i={timeline:t};this.emit(Je.Timeline,r,this.room,void 0,!0,i)}return r}compareEventOrdering(e,t){if(e==t)return 0;const r=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(t);if(r===void 0||i===void 0)return null;if(r===i){let o,a;const c=r.getEvents();for(let u=0;u<c.length&&(o===void 0||a===void 0);u++){const h=c[u].getId();h==e&&(o=u),h==t&&(a=u)}const l=o-a;return l<0?-1:l>0?1:0}let s=r;for(;s;){if(s===i)return-1;s=s.getNeighbouringTimeline($e.FORWARDS)}for(s=r;s;){if(s===i)return 1;s=s.getNeighbouringTimeline($e.BACKWARDS)}return null}canContain(e){var s;if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");const{threadId:t,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);return this.thread?this.thread.id===t:(!r&&!i&&O.warn(`EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=${(s=this.room)==null?void 0:s.roomId} eventId=${e.getId()} threadId=${e.threadRootId}`),r)}}var nt=(n=>(n.NOT_SENT="not_sent",n.ENCRYPTING="encrypting",n.SENDING="sending",n.QUEUED="queued",n.SENT="sent",n.CANCELLED="cancelled",n))(nt||{});class Dj{constructor(e,t){this.roomId=e}}class Fj{constructor(e){this.target=e,this.reEmitters=new WeakMap}reEmit(e,t){let r=this.reEmitters.get(e);r||(r=new Map,this.reEmitters.set(e,r));for(const i of t){if(r.has(i))continue;const s=(...o)=>{i==="error"&&this.target.listenerCount("error")===0||this.target.emit(i,...o,e)};e.on(i,s),r.set(i,s)}}stopReEmitting(e,t){const r=this.reEmitters.get(e);if(r){for(const i of t)e.off(i,r.get(i)),r.delete(i);r.size===0&&this.reEmitters.delete(e)}}}class sy extends Fj{constructor(e){super(e)}reEmit(e,t){super.reEmit(e,t)}stopReEmitting(e,t){super.stopReEmitting(e,t)}}const iv=new nw("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function Bre(n,e){if(e.endsWith("*")){const t=e.slice(0,-1);return n.slice(0,t.length)===t}else return n===e}class s5{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var s,o;const t=((s=e.getUnsigned())==null?void 0:s["m.relations"])||{},r=Object.keys(t),i=[];return this.userId&&((o=t==null?void 0:t[tn.name])!=null&&o.current_user_participated)&&i.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),e.getContent()?e.getContent().url!==void 0:!1,r,i)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[wf.name]:this.filterJson[wf.name]||[],[Ef.name]:this.filterJson[Ef.name]||[]}}checkFields(e,t,r,i,s,o){const a={rooms:function(h){return e===h},senders:function(h){return t===h},types:function(h){return Bre(r,h)}};for(const h in a){const p=a[h],m="not_"+h,v=this.filterJson[m];if(v!=null&&v.some(p))return!1;const g=this.filterJson[h];if(g&&!g.some(p))return!1}const c=this.filterJson.contains_url;if(c!==void 0&&c!==i)return!1;const l=this.filterJson[Ef.name];if(l!==void 0&&!this.arrayMatchesFilter(l,s))return!1;const u=this.filterJson[wf.name];return!(u!==void 0&&!this.arrayMatchesFilter(u,o))}arrayMatchesFilter(e,t){return t.length>0&&e.every(r=>t.includes(r))}filter(e){return e.filter(this.check,this)}limit(){return this.filterJson.limit!==void 0?this.filterJson.limit:10}}function xT(n,e,t){const r=e.split(".");let i=n;for(let s=0;s<r.length-1;s++)i[r[s]]||(i[r[s]]={}),i=i[r[s]];i[r[r.length-1]]=t}const QS=class QS{constructor(e,t){this.userId=e,this.filterId=t,this.definition={}}static fromJson(e,t,r){const i=new QS(e,t);return i.setDefinition(r),i}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;const t=e.room,r={};t&&(t.rooms&&(r.rooms=t.rooms),t.rooms&&(r.not_rooms=t.not_rooms)),this.roomFilter=new s5(r,this.userId),this.roomTimelineFilter=new s5((t==null?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){xT(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var t,r,i;this.definition={...this.definition,room:{...(t=this.definition)==null?void 0:t.room,timeline:{...(i=(r=this.definition)==null?void 0:r.room)==null?void 0:i.timeline,[iv.name]:e}}}}setLazyLoadMembers(e){xT(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){xT(this.definition,"room.include_leave",e)}};QS.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0};let ys=QS;function Tb(n){return n!=null}const Hre=new ss.UnstableValue("m.message","org.matrix.msc1767.message"),oP=new ss.UnstableValue("m.text","org.matrix.msc1767.text"),Vre=new ss.UnstableValue("m.html","org.matrix.msc1767.html"),Uj=new ss.NamespacedValue("m.reference");function Gre(n,e){if(typeof n=="string")return typeof e=="string"?e===n:e.matches(n);if(typeof e=="string")return n.matches(e);{const t=e,r=n;return t.matches(r.name)||Tb(r.altName)&&t.matches(r.altName)}}const aP=new jn("m.topic","org.matrix.msc3765.topic");function jj(n,e){return{msgtype:zo.Text,format:"org.matrix.custom.html",body:n,formatted_body:e}}function $j(n,e){return{msgtype:zo.Notice,format:"org.matrix.custom.html",body:n,formatted_body:e}}function Bj(n,e){return{msgtype:zo.Emote,format:"org.matrix.custom.html",body:n,formatted_body:e}}function Hj(n){return{msgtype:zo.Text,body:n}}function Vj(n){return{msgtype:zo.Notice,body:n}}function Gj(n){return{msgtype:zo.Emote,body:n}}const qj=(n,e,t,r)=>{const i=`at ${new Date(t).toISOString()}`,s=e===Ed.Self?"User":void 0,o=r?`"${r}"`:void 0;return[s,"Location",o,n,i].filter(Boolean).join(" ")},Kj=(n,e,t,r,i)=>{const s=n??qj(e,i||Ed.Self,t,r),o=t?{[fu.name]:t}:{};return{msgtype:zo.Location,body:s,geo_uri:e,[ny.name]:{description:r,uri:e},[ty.name]:{type:i||Ed.Self},[oP.name]:s,...o}},qre=n=>{const e=ny.findIn(n),t=ty.findIn(n),r=fu.findIn(n),i=oP.findIn(n),s=(e==null?void 0:e.uri)??(n==null?void 0:n.geo_uri),o=e==null?void 0:e.description,a=(t==null?void 0:t.type)??Ed.Self,c=i??n.body;return Kj(c,s,r??void 0,o,a)},Wj=(n,e)=>{const t=[];return Tb(n)&&t.push({body:n,mimetype:"text/plain"}),Tb(e)&&t.push({body:e,mimetype:"text/html"}),{topic:n,[aP.name]:t}},Kre=n=>{var i,s;const e=aP.findIn(n);if(!Array.isArray(e))return{text:n.topic??void 0};const t=((i=e==null?void 0:e.find(o=>!Tb(o.mimetype)||o.mimetype==="text/plain"))==null?void 0:i.body)??n.topic??void 0,r=(s=e==null?void 0:e.find(o=>o.mimetype==="text/html"))==null?void 0:s.body;return{text:t,html:r}},Wre=(n,e,t,r,i)=>({description:t,timeout:n,live:e,[fu.name]:i||Date.now(),[ty.name]:{type:r??Ed.Self}}),zj=n=>{const{description:e,timeout:t,live:r}=n,i=fu.findIn(n)??void 0,s=ty.findIn(n);return{description:e,timeout:t,live:r,assetType:s==null?void 0:s.type,timestamp:i}},zre=(n,e,t,r)=>({[ny.name]:{description:r,uri:n},[fu.name]:e,"m.relates_to":{rel_type:Uj.name,event_id:t}}),FR=n=>{const e=ny.findIn(n),t=fu.findIn(n)??void 0;return{description:e==null?void 0:e.description,uri:e==null?void 0:e.uri,timestamp:t}},Yre=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:qj,makeBeaconContent:zre,makeBeaconInfoContent:Wre,makeEmoteMessage:Gj,makeHtmlEmote:Bj,makeHtmlMessage:jj,makeHtmlNotice:$j,makeLocationContent:Kj,makeNotice:Vj,makeTextMessage:Hj,makeTopicContent:Wj,parseBeaconContent:FR,parseBeaconInfoContent:zj,parseLocationEvent:qre,parseTopicContent:Kre},Symbol.toStringTag,{value:"Module"}));var qn=(n=>(n.New="Beacon.new",n.Update="Beacon.update",n.LivenessChange="Beacon.LivenessChange",n.Destroy="Beacon.Destroy",n.LocationUpdate="Beacon.LocationUpdate",n))(qn||{});const UR=(n,e,t)=>t>=n&&n+e>=t,Ib=n=>`${n.getRoomId()}_${n.getStateKey()}`;class Yj extends Xn{constructor(e){super(),this.rootEvent=e,this.clearLatestLocation=()=>{this._latestLocationEvent=void 0,this.emit("Beacon.LocationUpdate",this.latestLocationState)},this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return Ib(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&FR(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(Ib(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit("Beacon.update",e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit("Beacon.Destroy",this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),!!this.beaconInfo)if(this.isLive){const e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(e){var i;if(!this.isLive)return;const r=(i=e.filter(s=>{const o=s.getContent(),a=FR(o);if(!a.uri||!a.timestamp)return!1;const{timestamp:c}=a;return this._beaconInfo.timestamp&&UR(this._beaconInfo.timestamp,this._beaconInfo.timeout,c)&&(!this.latestLocationState||c>this.latestLocationState.timestamp)}).sort(yre))==null?void 0:i[0];r&&(this._latestLocationEvent=r,this.emit("Beacon.LocationUpdate",this.latestLocationState))}setBeaconInfo(e){this._beaconInfo=zj(e.getContent()),this.checkLiveness()}checkLiveness(){const e=this.isLive;if(!this.beaconInfo)return;const t=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!t&&UR(t,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit("Beacon.LivenessChange",this.isLive,this)}}function Xj(n,e,t,r=!1){return new Ji({content:{[e.getId()]:{[t]:{[n]:{ts:e.getTs(),...!r&&{thread_id:qf(e)}}}}},type:ie.Receipt,room_id:e.getRoomId()})}const Ph=0,Lh=1;class Jj extends Xn{constructor(){super(...arguments),this.receipts=new yc(()=>new Map),this.receiptCacheByEventId=new Map}getReadReceiptForUserId(e,t=!1,r=li.Read){var o;const[i,s]=((o=this.receipts.get(r))==null?void 0:o.get(e))??[null,null];return t?i:s??i}compareReceipts(e,t){return this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,t.eventId)??e.data.ts-t.data.ts}getEventReadUpTo(e,t=!1){const r=this.getLatestReceipt(e,t);return r&&this.receiptPointsAtConsistentEvent(r)?r.eventId:null}receiptPointsAtConsistentEvent(e){var r;const t=this.findEventById(e.eventId);if(!t)return!1;if(!((r=e.data)!=null&&r.thread_id))return!0;if(e.data.thread_id===ry){if(hv(t))return!0}else if(t.threadRootId===e.data.thread_id)return!0;return O.warn(`Ignoring receipt because its thread_id (${e.data.thread_id}) disagrees with the thread root (${t.threadRootId}) of the referenced event (event ID = ${e.eventId})`),!1}getLatestReceipt(e,t){const r=this.getReadReceiptForUserId(e,t,li.Read),i=this.getReadReceiptForUserId(e,t,li.ReadPrivate);let s;return r!=null&&r.eventId&&(i!=null&&i.eventId)&&(s=this.compareReceipts(r,i)),s?(s<0?i:r)??null:i??r??null}addReceiptToStructure(e,t,r,i,s){const o=this.receipts.getOrCreate(t);let a=o.get(r);a||(a=[null,null],o.set(r,a));let c=a[Ph];s&&(c=a[Lh]??a[Ph]);const l={eventId:e,data:i};if(c&&this.compareReceipts(c,l)>=0)return;const u=s?a[Ph]:l,h=s?l:a[Lh];let p=null;u&&h&&(p=this.getUnfilteredTimelineSet().compareEventOrdering(u.eventId,h.eventId));const m=p===null||p<0,v=a[Lh]??a[Ph];s&&m?a[Lh]=l:s||(a[Ph]=l,m||(a[Lh]=null));const g=a[Lh]??a[Ph];if(v!==g){if(v&&this.receiptCacheByEventId.get(v.eventId)){const S=v.eventId;this.receiptCacheByEventId.set(S,this.receiptCacheByEventId.get(S).filter(b=>b.type!==t||b.userId!==r)),this.receiptCacheByEventId.get(S).length<1&&this.receiptCacheByEventId.delete(S)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:r,type:t,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){const t=this.getReadReceiptForUserId(e,!1),r=this.timeline[this.timeline.length-1];r&&(t==null?void 0:t.eventId)===r.getId()&&e===r.getSender()&&(this.setUnread(sr.Total,0),this.setUnread(sr.Highlight,0))}addLocalEchoReceipt(e,t,r,i=!1){this.addReceipt(Xj(e,t,r,i),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter(function(t){return Qx(t.type)}).map(function(t){return t.userId})}}const Xre=new ss.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),Jre=new ss.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),Zre=new ss.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),sv=new ss.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),Rb=new ss.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");var cP=(n=>(n.New="Poll.new",n.End="Poll.end",n.Update="Poll.update",n.Responses="Poll.Responses",n.Destroy="Poll.Destroy",n.UndecryptableRelations="Poll.UndecryptableRelations",n))(cP||{});const o5=(n,e)=>({responseEvents:n.filter(r=>{if(!r.isDecryptionFailure())return sv.matches(r.getType())&&r.getTs()<=e})});class Zj extends Xn{constructor(e,t,r){if(super(),this.rootEvent=e,this.matrixClient=t,this.room=r,this._isFetchingResponses=!1,this.responses=null,this.undecryptableRelationEventIds=new Set,this.countUndecryptableEvents=i=>{const s=i.filter(a=>a.isDecryptionFailure()).map(a=>a.getId()),o=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...s]),this.undecryptableRelationsCount!==o&&this.emit("Poll.UndecryptableRelations",this.undecryptableRelationsCount)},!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return(e=this.endEvent)==null?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}async getResponses(){return this.responses?this.responses:(this.isFetchingResponses||await this.fetchResponses(),this.responses)}onNewRelation(e){var i;if(Rb.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit("Poll.end")),!this.responses)return;const t=((i=this.endEvent)==null?void 0:i.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:r}=o5([e],t);this.countUndecryptableEvents([e]),r.length&&(r.forEach(s=>{this.responses.addEvent(s)}),this.emit("Poll.Responses",this.responses))}async fetchResponses(){var o;this._isFetchingResponses=!0;const e=await this.matrixClient.relations(this.roomId,this.rootEvent.getId(),"m.reference",void 0,{from:this.relationsNextBatch||void 0});await Promise.all(e.events.map(a=>this.matrixClient.decryptEventIfNeeded(a)));const t=this.responses||new sP("m.reference",sv.name,this.matrixClient,[sv.altName]),r=e.events.find(a=>Rb.matches(a.getType()));this.validateEndEvent(r)&&(this.endEvent=r,this.refilterResponsesOnEnd(),this.emit("Poll.end"));const i=((o=this.endEvent)==null?void 0:o.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:s}=o5(e.events,i);s.forEach(a=>{t.addEvent(a)}),this.relationsNextBatch=e.nextBatch??void 0,this.responses=t,this.countUndecryptableEvents(e.events),this.relationsNextBatch?this.fetchResponses():this._isFetchingResponses=!1,this.emit("Poll.Responses",this.responses)}refilterResponsesOnEnd(){var t;if(!this.responses)return;const e=((t=this.endEvent)==null?void 0:t.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach(r=>{var i;r.getTs()>e&&((i=this.responses)==null||i.removeEvent(r))}),this.emit("Poll.Responses",this.responses)}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;const t=this.room.currentState,r=e.getSender();return!!r&&(r===this.rootEvent.getSender()||t.maySendRedactionForEvent(this.rootEvent,r))}}const Qj=n=>{const e=n.getType();return ss.M_POLL_START.matches(e)||sv.matches(e)||Rb.matches(e)};class Qre{constructor(e){this.onTimelineEvent=t=>{const r=t.getId();if(!r)return;const i=this.danglingReceipts.remove(r);i==null||i.forEach(s=>{s.receipt.thread_id?this.threadedReceipts.set(s.receipt.thread_id,s.eventId,s.receiptType,s.userId,s.receipt.ts,s.synthetic):this.unthreadedReceipts.set(r,s.receiptType,s.userId,s.receipt.ts,s.synthetic)})},this.room=e,this.threadedReceipts=new rie(e),this.unthreadedReceipts=new e$(e),this.danglingReceipts=new iie,e.on(Je.Timeline,this.onTimelineEvent)}add(e,t){for(const[r,i]of Object.entries(e))for(const[s,o]of Object.entries(i))for(const[a,c]of Object.entries(o))this.room.findEventById(r)?c.thread_id?this.threadedReceipts.set(c.thread_id,r,s,a,c.ts,t):this.unthreadedReceipts.set(r,s,a,c.ts,t):this.danglingReceipts.add(new tie(r,s,a,c,t))}hasUserReadEvent(e,t){const r=this.unthreadedReceipts.get(e);if(r&&jR(r.eventId,t,this.room))return!0;const i=this.room.findEventById(t);if(!i)return O.warn(`hasUserReadEvent event ID ${t} not found in room ${this.room.roomId}: this shouldn't happen!`),!1;const s=qf(i),o=this.threadedReceipts.get(s,e);return!!(o&&jR(o.eventId,t,this.room)||this.userSentLatestEventInThread(s,e))}userSentLatestEventInThread(e,t){var i;const r=e===ry?this.room.getLiveTimeline().getEvents():(i=this.room.getThread(e))==null?void 0:i.timeline;return!!(r&&r.length>0&&r[r.length-1].getSender()===t)}}class eie{constructor(e,t,r){this.eventId=e,this.receiptType=t,this.ts=r}}class tie{constructor(e,t,r,i,s){this.eventId=e,this.receiptType=t,this.userId=r,this.receipt=i,this.synthetic=s}}class nie{constructor(e){this.room=e,this.real=void 0,this.synthetic=void 0}set(e,t){e?this.synthetic=t:this.real=t,this.synthetic&&this.real&&jR(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){return this.synthetic??this.real}getByType(e){return e?this.synthetic:this.real}}class e${constructor(e){this.room=e,this.data=new Map}set(e,t,r,i,s){const o=lP(this.data,r,()=>new nie(this.room)),a=o.getByType(s);a&&sie(a.eventId,e,this.room)||o.set(s,new eie(e,t,i))}get(e){var t;return(t=this.data.get(e))==null?void 0:t.get()}}class rie{constructor(e){this.room=e,this.data=new Map}set(e,t,r,i,s,o){lP(this.data,e,()=>new e$(this.room)).set(t,r,i,s,o)}get(e,t){var r;return(r=this.data.get(e))==null?void 0:r.get(t)}}class iie{constructor(){this.data=new Map}add(e){lP(this.data,e.eventId,()=>[]).push(e)}remove(e){const t=this.data.get(e);return this.data.delete(e),t}}function lP(n,e,t){const r=n.get(e);if(r)return r;{const i=t();return n.set(e,i),i}}function jR(n,e,t){const r=t.compareEventOrdering(n,e);return r!==null&&r>=0}function sie(n,e,t){const r=t.compareEventOrdering(n,e);return r!==null&&r>0}function oie(n,e,t){const r=n.findEventById(e),i=n.findEventById(t);if(!r||!i)return null;const s=hv(r),o=hv(i);return s&&o?aie(n,e,t,r,i):cie(e,t,r,i)}function aie(n,e,t,r,i){const s=n.getUnfilteredTimelineSet(),o=s.compareEventOrdering(e,t);return o!==null?o:s.getTimelineForEvent(e)===s.getLiveTimeline()?1:s.getTimelineForEvent(t)===s.getLiveTimeline()?-1:t$(r,i)}function cie(n,e,t,r){const i=qf(t),s=qf(r),o=t.getThread();return o&&i===s?o.timelineSet.compareEventOrdering(n,e):t$(t,r)}function t$(n,e){const t=n.getTs(),r=e.getTs();return t<r?-1:t>r?1:0}class gg extends Error{}gg.prototype.name="InvalidTokenError";function lie(n){return decodeURIComponent(atob(n).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function uie(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return lie(e)}catch{return atob(e)}}function n$(n,e){if(typeof n!="string")throw new gg("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,r=n.split(".")[t];if(typeof r!="string")throw new gg(`Invalid token specified: missing part #${t+1}`);let i;try{i=uie(r)}catch(s){throw new gg(`Invalid token specified: invalid base64 for part #${t+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new gg(`Invalid token specified: invalid json for part #${t+1} (${s.message})`)}}var die={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},la,ua,ov=(n=>(n[n.NONE=0]="NONE",n[n.ERROR=1]="ERROR",n[n.WARN=2]="WARN",n[n.INFO=3]="INFO",n[n.DEBUG=4]="DEBUG",n))(ov||{});(n=>{function e(){la=3,ua=die}n.reset=e;function t(i){if(!(0<=i&&i<=4))throw new Error("Invalid log level");la=i}n.setLevel=t;function r(i){ua=i}n.setLogger=r})(ov||(ov={}));var zn=class sa{constructor(e){this._name=e}debug(...e){la>=4&&ua.debug(sa._format(this._name,this._method),...e)}info(...e){la>=3&&ua.info(sa._format(this._name,this._method),...e)}warn(...e){la>=2&&ua.warn(sa._format(this._name,this._method),...e)}error(...e){la>=1&&ua.error(sa._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(e,t){const r=new sa(`${e}.${t}`);return r.debug("begin"),r}static _format(e,t){const r=`[${e}]`;return t?`${r} ${t}:`:r}static debug(e,...t){la>=4&&ua.debug(sa._format(e),...t)}static info(e,...t){la>=3&&ua.info(sa._format(e),...t)}static warn(e,...t){la>=2&&ua.warn(sa._format(e),...t)}static error(e,...t){la>=1&&ua.error(sa._format(e),...t)}};ov.reset();var kb=class{static decode(n){try{return n$(n)}catch(e){throw zn.error("JwtUtils.decode",e),e}}static async generateSignedJwt(n,e,t){const r=Bo.encodeBase64Url(new TextEncoder().encode(JSON.stringify(n))),i=Bo.encodeBase64Url(new TextEncoder().encode(JSON.stringify(e))),s=`${r}.${i}`,o=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new TextEncoder().encode(s)),a=Bo.encodeBase64Url(new Uint8Array(o));return`${s}.${a}`}},hie="10000000-1000-4000-8000-100000000000",$R=n=>btoa([...new Uint8Array(n)].map(e=>String.fromCharCode(e)).join("")),r$=class oa{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return hie.replace(/[018]/g,t=>(+t^oa._randomWord()&15>>+t/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return oa.generateUUIDv4()+oa.generateUUIDv4()+oa.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r);return $R(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(t){throw zn.error("CryptoUtils.generateCodeChallenge",t),t}}static generateBasicAuth(e,t){const i=new TextEncoder().encode([e,t].join(":"));return $R(i)}static async hash(e,t){const r=new TextEncoder().encode(t),i=await crypto.subtle.digest(e,r);return new Uint8Array(i)}static async customCalculateJwkThumbprint(e){let t;switch(e.kty){case"RSA":t={e:e.e,kty:e.kty,n:e.n};break;case"EC":t={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":t={crv:e.crv,kty:e.kty,x:e.x};break;case"oct":t={crv:e.k,kty:e.kty};break;default:throw new Error("Unknown jwk type")}const r=await oa.hash("SHA-256",JSON.stringify(t));return oa.encodeBase64Url(r)}static async generateDPoPProof({url:e,accessToken:t,httpMethod:r,keyPair:i,nonce:s}){let o,a;const c={jti:window.crypto.randomUUID(),htm:r??"GET",htu:e,iat:Math.floor(Date.now()/1e3)};t&&(o=await oa.hash("SHA-256",t),a=oa.encodeBase64Url(o),c.ath=a),s&&(c.nonce=s);try{const l=await crypto.subtle.exportKey("jwk",i.publicKey),u={alg:"ES256",typ:"dpop+jwt",jwk:{crv:l.crv,kty:l.kty,x:l.x,y:l.y}};return await kb.generateSignedJwt(u,c,i.privateKey)}catch(l){throw l instanceof TypeError?new Error(`Error exporting dpop public key: ${l.message}`):l}}static async generateDPoPJkt(e){try{const t=await crypto.subtle.exportKey("jwk",e.publicKey);return await oa.customCalculateJwkThumbprint(t)}catch(t){throw t instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${t.message}`):t}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};r$.encodeBase64Url=n=>$R(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var Bo=r$,fie=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new zn(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}async raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)await t(...e)}},xb=class g_ extends fie{constructor(){super(...arguments),this._logger=new zn(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-g_.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=g_.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const t=this._logger.create("init");e=Math.max(Math.floor(e),1);const r=g_.getEpochTime()+e;if(this.expiration===r&&this._timerHandle){t.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),t.debug("using duration",e),this._expiration=r;const i=Math.min(e,5);this._timerHandle=setInterval(this._callback,i*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},a5=class{static readParams(n,e="query"){if(!n)throw new TypeError("Invalid URL");const r=new URL(n,"http://127.0.0.1")[e==="fragment"?"hash":"search"];return new URLSearchParams(r.slice(1))}},BR=";",Vf=class extends Error{constructor(n,e){var t,r,i;if(super(n.error_description||n.error||""),this.form=e,this.name="ErrorResponse",!n.error)throw zn.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=n.error,this.error_description=(t=n.error_description)!=null?t:null,this.error_uri=(r=n.error_uri)!=null?r:null,this.state=n.userState,this.session_state=(i=n.session_state)!=null?i:null,this.url_state=n.url_state}},pie=class extends Error{constructor(n){super(n),this.name="ErrorTimeout"}},mie=class{constructor(){this._logger=new zn("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(n){return this._logger.create(`getItem('${n}')`),this._data[n]}setItem(n,e){this._logger.create(`setItem('${n}')`),this._data[n]=e}removeItem(n){this._logger.create(`removeItem('${n}')`),delete this._data[n]}get length(){return Object.getOwnPropertyNames(this._data).length}key(n){return Object.getOwnPropertyNames(this._data)[n]}},HR=class extends Error{constructor(n,e){super(e),this.name="ErrorDPoPNonce",this.nonce=n}},uP=class{constructor(n=[],e=null,t={}){this._jwtHandler=e,this._extraHeaders=t,this._logger=new zn("JsonService"),this._contentTypes=[],this._contentTypes.push(...n,"application/json"),e&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(n,e={}){const{timeoutInSeconds:t,...r}=e;if(!t)return await fetch(n,r);const i=new AbortController,s=setTimeout(()=>i.abort(),t*1e3);try{return await fetch(n,{...e,signal:i.signal})}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new pie("Network timed out"):o}finally{clearTimeout(s)}}async getJson(n,{token:e,credentials:t,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),s={Accept:this._contentTypes.join(", ")};e&&(i.debug("token passed, setting Authorization header"),s.Authorization="Bearer "+e),this.appendExtraHeaders(s);let o;try{i.debug("url:",n),o=await this.fetchWithTimeout(n,{method:"GET",headers:s,timeoutInSeconds:r,credentials:t})}catch(l){throw i.error("Network Error"),l}i.debug("HTTP response received, status",o.status);const a=o.headers.get("Content-Type");if(a&&!this._contentTypes.find(l=>a.startsWith(l))&&i.throw(new Error(`Invalid response Content-Type: ${a??"undefined"}, from URL: ${n}`)),o.ok&&this._jwtHandler&&(a!=null&&a.startsWith("application/jwt")))return await this._jwtHandler(await o.text());let c;try{c=await o.json()}catch(l){throw i.error("Error parsing JSON response",l),o.ok?l:new Error(`${o.statusText} (${o.status})`)}if(!o.ok)throw i.error("Error from server:",c),c.error?new Vf(c):new Error(`${o.statusText} (${o.status}): ${JSON.stringify(c)}`);return c}async postForm(n,{body:e,basicAuth:t,timeoutInSeconds:r,initCredentials:i,extraHeaders:s}){const o=this._logger.create("postForm"),a={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...s};t!==void 0&&(a.Authorization="Basic "+t),this.appendExtraHeaders(a);let c;try{o.debug("url:",n),c=await this.fetchWithTimeout(n,{method:"POST",headers:a,body:e,timeoutInSeconds:r,credentials:i})}catch(p){throw o.error("Network error"),p}o.debug("HTTP response received, status",c.status);const l=c.headers.get("Content-Type");if(l&&!this._contentTypes.find(p=>l.startsWith(p)))throw new Error(`Invalid response Content-Type: ${l??"undefined"}, from URL: ${n}`);const u=await c.text();let h={};if(u)try{h=JSON.parse(u)}catch(p){throw o.error("Error parsing JSON response",p),c.ok?p:new Error(`${c.statusText} (${c.status})`)}if(!c.ok){if(o.error("Error from server:",h),c.headers.has("dpop-nonce")){const p=c.headers.get("dpop-nonce");throw new HR(p,`${JSON.stringify(h)}`)}throw h.error?new Vf(h,e):new Error(`${c.statusText} (${c.status}): ${JSON.stringify(h)}`)}return h}appendExtraHeaders(n){const e=this._logger.create("appendExtraHeaders"),t=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];t.length!==0&&t.forEach(i=>{if(r.includes(i.toLocaleLowerCase())){e.warn("Protected header could not be overridden",i,r);return}const s=typeof this._extraHeaders[i]=="function"?this._extraHeaders[i]():this._extraHeaders[i];s&&s!==""&&(n[i]=s)})}},i$=class{constructor(n){this._settings=n,this._logger=new zn("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new uP(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const n=this._logger.create("getMetadata");if(this._metadata)return n.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw n.throw(new Error("No authority or metadataUrl configured on settings")),null;n.debug("getting metadata from",this._metadataUrl);const e=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return n.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,e),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(n=!0){return this._getMetadataProperty("token_endpoint",n)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(n=!0){return this._getMetadataProperty("revocation_endpoint",n)}getKeysEndpoint(n=!0){return this._getMetadataProperty("jwks_uri",n)}async _getMetadataProperty(n,e=!1){const t=this._logger.create(`_getMetadataProperty('${n}')`),r=await this.getMetadata();if(t.debug("resolved"),r[n]===void 0){if(e===!0){t.warn("Metadata does not contain optional property");return}t.throw(new Error("Metadata does not contain property "+n))}return r[n]}async getSigningKeys(){const n=this._logger.create("getSigningKeys");if(this._signingKeys)return n.debug("returning signingKeys from cache"),this._signingKeys;const e=await this.getKeysEndpoint(!1);n.debug("got jwks_uri",e);const t=await this._jsonService.getJson(e,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(n.debug("got key set",t),!Array.isArray(t.keys))throw n.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=t.keys,this._signingKeys}},cw=class{constructor({prefix:n="oidc.",store:e=localStorage}={}){this._logger=new zn("WebStorageStateStore"),this._store=e,this._prefix=n}async set(n,e){this._logger.create(`set('${n}')`),n=this._prefix+n,await this._store.setItem(n,e)}async get(n){return this._logger.create(`get('${n}')`),n=this._prefix+n,await this._store.getItem(n)}async remove(n){this._logger.create(`remove('${n}')`),n=this._prefix+n;const e=await this._store.getItem(n);return await this._store.removeItem(n),e}async getAllKeys(){this._logger.create("getAllKeys");const n=await this._store.length,e=[];for(let t=0;t<n;t++){const r=await this._store.key(t);r&&r.indexOf(this._prefix)===0&&e.push(r.substr(this._prefix.length))}return e}},gie="code",vie="openid",yie="client_secret_post",_ie=60*15,VR=class{constructor({authority:n,metadataUrl:e,metadata:t,signingKeys:r,metadataSeed:i,client_id:s,client_secret:o,response_type:a=gie,scope:c=vie,redirect_uri:l,post_logout_redirect_uri:u,client_authentication:h=yie,prompt:p,display:m,max_age:v,ui_locales:g,acr_values:S,resource:b,response_mode:R,filterProtocolClaims:k=!0,loadUserInfo:I=!1,requestTimeoutInSeconds:T,staleStateAgeInSeconds:C=_ie,mergeClaimsStrategy:P={array:"replace"},disablePKCE:M=!1,stateStore:D,revokeTokenAdditionalContentTypes:F,fetchRequestCredentials:U,refreshTokenAllowedScope:B,extraQueryParams:V={},extraTokenParams:z={},extraHeaders:H={},dpop:J,omitScopeWhenRequesting:Y=!1}){var G;if(this.authority=n,e?this.metadataUrl=e:(this.metadataUrl=n,n&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=t,this.metadataSeed=i,this.signingKeys=r,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=c,this.redirect_uri=l,this.post_logout_redirect_uri=u,this.client_authentication=h,this.prompt=p,this.display=m,this.max_age=v,this.ui_locales=g,this.acr_values=S,this.resource=b,this.response_mode=R,this.filterProtocolClaims=k??!0,this.loadUserInfo=!!I,this.staleStateAgeInSeconds=C,this.mergeClaimsStrategy=P,this.omitScopeWhenRequesting=Y,this.disablePKCE=!!M,this.revokeTokenAdditionalContentTypes=F,this.fetchRequestCredentials=U||"same-origin",this.requestTimeoutInSeconds=T,D)this.stateStore=D;else{const K=typeof window<"u"?window.localStorage:new mie;this.stateStore=new cw({store:K})}if(this.refreshTokenAllowedScope=B,this.extraQueryParams=V,this.extraTokenParams=z,this.extraHeaders=H,this.dpop=J,this.dpop&&!((G=this.dpop)!=null&&G.store))throw new Error("A DPoPStore is required when dpop is enabled")}},bie=class{constructor(n,e){this._settings=n,this._metadataService=e,this._logger=new zn("UserInfoService"),this._getClaimsFromJwt=async t=>{const r=this._logger.create("_getClaimsFromJwt");try{const i=kb.decode(t);return r.debug("JWT decoding successful"),i}catch(i){throw r.error("Error parsing JWT response"),i}},this._jsonService=new uP(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(n){const e=this._logger.create("getClaims");n||this._logger.throw(new Error("No token passed"));const t=await this._metadataService.getUserInfoEndpoint();e.debug("got userinfo url",t);const r=await this._jsonService.getJson(t,{token:n,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("got claims",r),r}},s$=class{constructor(n,e){this._settings=n,this._metadataService=e,this._logger=new zn("TokenClient"),this._jsonService=new uP(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:n="authorization_code",redirect_uri:e=this._settings.redirect_uri,client_id:t=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...s}){const o=this._logger.create("exchangeCode");t||o.throw(new Error("A client_id is required")),e||o.throw(new Error("A redirect_uri is required")),s.code||o.throw(new Error("A code is required"));const a=new URLSearchParams({grant_type:n,redirect_uri:e});for(const[h,p]of Object.entries(s))p!=null&&a.set(h,p);let c;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw o.throw(new Error("A client_secret is required")),null;c=Bo.generateBasicAuth(t,r);break;case"client_secret_post":a.append("client_id",t),r&&a.append("client_secret",r);break}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const u=await this._jsonService.postForm(l,{body:a,basicAuth:c,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),u}async exchangeCredentials({grant_type:n="password",client_id:e=this._settings.client_id,client_secret:t=this._settings.client_secret,scope:r=this._settings.scope,...i}){const s=this._logger.create("exchangeCredentials");e||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:n});this._settings.omitScopeWhenRequesting||o.set("scope",r);for(const[u,h]of Object.entries(i))h!=null&&o.set(u,h);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!t)throw s.throw(new Error("A client_secret is required")),null;a=Bo.generateBasicAuth(e,t);break;case"client_secret_post":o.append("client_id",e),t&&o.append("client_secret",t);break}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeRefreshToken({grant_type:n="refresh_token",client_id:e=this._settings.client_id,client_secret:t=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...s}){const o=this._logger.create("exchangeRefreshToken");e||o.throw(new Error("A client_id is required")),s.refresh_token||o.throw(new Error("A refresh_token is required"));const a=new URLSearchParams({grant_type:n});for(const[h,p]of Object.entries(s))Array.isArray(p)?p.forEach(m=>a.append(h,m)):p!=null&&a.set(h,p);let c;switch(this._settings.client_authentication){case"client_secret_basic":if(!t)throw o.throw(new Error("A client_secret is required")),null;c=Bo.generateBasicAuth(e,t);break;case"client_secret_post":a.append("client_id",e),t&&a.append("client_secret",t);break}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const u=await this._jsonService.postForm(l,{body:a,basicAuth:c,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),u}async revoke(n){var e;const t=this._logger.create("revoke");n.token||t.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);t.debug(`got revocation endpoint, revoking ${(e=n.token_type_hint)!=null?e:"default token type"}`);const i=new URLSearchParams;for(const[s,o]of Object.entries(n))o!=null&&i.set(s,o);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),t.debug("got response")}},Sie=class{constructor(n,e,t){this._settings=n,this._metadataService=e,this._claimsService=t,this._logger=new zn("ResponseValidator"),this._userInfoService=new bie(this._settings,this._metadataService),this._tokenClient=new s$(this._settings,this._metadataService)}async validateSigninResponse(n,e,t){const r=this._logger.create("validateSigninResponse");this._processSigninState(n,e),r.debug("state processed"),await this._processCode(n,e,t),r.debug("code processed"),n.isOpenId&&this._validateIdTokenAttributes(n),r.debug("tokens validated"),await this._processClaims(n,e==null?void 0:e.skipUserInfo,n.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(n,e){const t=this._logger.create("validateCredentialsResponse");n.isOpenId&&n.id_token&&this._validateIdTokenAttributes(n),t.debug("tokens validated"),await this._processClaims(n,e,n.isOpenId),t.debug("claims processed")}async validateRefreshResponse(n,e){var t,r;const i=this._logger.create("validateRefreshResponse");n.userState=e.data,(t=n.session_state)!=null||(n.session_state=e.session_state),(r=n.scope)!=null||(n.scope=e.scope),n.isOpenId&&n.id_token&&(this._validateIdTokenAttributes(n,e.id_token),i.debug("ID Token validated")),n.id_token||(n.id_token=e.id_token,n.profile=e.profile);const s=n.isOpenId&&!!n.id_token;await this._processClaims(n,!1,s),i.debug("claims processed")}validateSignoutResponse(n,e){const t=this._logger.create("validateSignoutResponse");if(e.id!==n.state&&t.throw(new Error("State does not match")),t.debug("state validated"),n.userState=e.data,n.error)throw t.warn("Response was error",n.error),new Vf(n)}_processSigninState(n,e){var t;const r=this._logger.create("_processSigninState");if(e.id!==n.state&&r.throw(new Error("State does not match")),e.client_id||r.throw(new Error("No client_id on state")),e.authority||r.throw(new Error("No authority on state")),this._settings.authority!==e.authority&&r.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==e.client_id&&r.throw(new Error("client_id mismatch on settings vs. signin state")),r.debug("state validated"),n.userState=e.data,n.url_state=e.url_state,(t=n.scope)!=null||(n.scope=e.scope),n.error)throw r.warn("Response was error",n.error),new Vf(n);e.code_verifier&&!n.code&&r.throw(new Error("Expected code in response"))}async _processClaims(n,e=!1,t=!0){const r=this._logger.create("_processClaims");if(n.profile=this._claimsService.filterProtocolClaims(n.profile),e||!this._settings.loadUserInfo||!n.access_token){r.debug("not loading user info");return}r.debug("loading user info");const i=await this._userInfoService.getClaims(n.access_token);r.debug("user info claims received from user info endpoint"),t&&i.sub!==n.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),n.profile=this._claimsService.mergeClaims(n.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",n.profile)}async _processCode(n,e,t){const r=this._logger.create("_processCode");if(n.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:e.client_id,client_secret:e.client_secret,code:n.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier,extraHeaders:t,...e.extraTokenParams});Object.assign(n,i)}else r.debug("No code to process")}_validateIdTokenAttributes(n,e){var t;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=kb.decode((t=n.id_token)!=null?t:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),e){const s=kb.decode(e);i.sub!==s.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==s.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==s.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&s.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}n.profile=i}},Pb=class GR{constructor(e){this.id=e.id||Bo.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=xb.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new zn("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(e){return zn.createStatic("State","fromStorageString"),Promise.resolve(new GR(JSON.parse(e)))}static async clearStaleState(e,t){const r=zn.createStatic("State","clearStaleState"),i=xb.getEpochTime()-t,s=await e.getAllKeys();r.debug("got keys",s);for(let o=0;o<s.length;o++){const a=s[o],c=await e.get(a);let l=!1;if(c)try{const u=await GR.fromStorageString(c);r.debug("got item from key:",a,u.created),u.created<=i&&(l=!0)}catch(u){r.error("Error parsing state for key:",a,u),l=!0}else r.debug("no item in storage for key:",a),l=!0;l&&(r.debug("removed item for key:",a),e.remove(a))}}},dP=class qR extends Pb{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(e){const t=e.code_verifier===!0?Bo.generateCodeVerifier():e.code_verifier||void 0,r=t?await Bo.generateCodeChallenge(t):void 0;return new qR({...e,code_verifier:t,code_challenge:r})}toStorageString(){return new zn("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){zn.createStatic("SigninState","fromStorageString");const t=JSON.parse(e);return qR.create(t)}},o$=class a${constructor(e){this.url=e.url,this.state=e.state}static async create({url:e,authority:t,client_id:r,redirect_uri:i,response_type:s,scope:o,state_data:a,response_mode:c,request_type:l,client_secret:u,nonce:h,url_state:p,resource:m,skipUserInfo:v,extraQueryParams:g,extraTokenParams:S,disablePKCE:b,dpopJkt:R,omitScopeWhenRequesting:k,...I}){if(!e)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!s)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!o)throw this._logger.error("create: No scope passed"),new Error("scope");if(!t)throw this._logger.error("create: No authority passed"),new Error("authority");const T=await dP.create({data:a,request_type:l,url_state:p,code_verifier:!b,client_id:r,authority:t,redirect_uri:i,response_mode:c,client_secret:u,scope:o,extraTokenParams:S,skipUserInfo:v}),C=new URL(e);C.searchParams.append("client_id",r),C.searchParams.append("redirect_uri",i),C.searchParams.append("response_type",s),k||C.searchParams.append("scope",o),h&&C.searchParams.append("nonce",h),R&&C.searchParams.append("dpop_jkt",R);let P=T.id;p&&(P=`${P}${BR}${p}`),C.searchParams.append("state",P),T.code_challenge&&(C.searchParams.append("code_challenge",T.code_challenge),C.searchParams.append("code_challenge_method","S256")),m&&(Array.isArray(m)?m:[m]).forEach(D=>C.searchParams.append("resource",D));for(const[M,D]of Object.entries({response_mode:c,...I,...g}))D!=null&&C.searchParams.append(M,D.toString());return new a$({url:C.href,state:T})}};o$._logger=new zn("SigninRequest");var wie=o$,Eie="openid",v_=class{constructor(n){if(this.access_token="",this.token_type="",this.profile={},this.state=n.get("state"),this.session_state=n.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(BR);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(BR))}this.error=n.get("error"),this.error_description=n.get("error_description"),this.error_uri=n.get("error_uri"),this.code=n.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-xb.getEpochTime()}set expires_in(n){typeof n=="string"&&(n=Number(n)),n!==void 0&&n>=0&&(this.expires_at=Math.floor(n)+xb.getEpochTime())}get isOpenId(){var n;return((n=this.scope)==null?void 0:n.split(" ").includes(Eie))||!!this.id_token}},Cie=class{constructor({url:n,state_data:e,id_token_hint:t,post_logout_redirect_uri:r,extraQueryParams:i,request_type:s,client_id:o}){if(this._logger=new zn("SignoutRequest"),!n)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(n);t&&a.searchParams.append("id_token_hint",t),o&&a.searchParams.append("client_id",o),r&&(a.searchParams.append("post_logout_redirect_uri",r),e&&(this.state=new Pb({data:e,request_type:s}),a.searchParams.append("state",this.state.id)));for(const[c,l]of Object.entries({...i}))l!=null&&a.searchParams.append(c,l.toString());this.url=a.href}},Tie=class{constructor(n){this.state=n.get("state"),this.error=n.get("error"),this.error_description=n.get("error_description"),this.error_uri=n.get("error_uri")}},Iie=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],Rie=["sub","iss","aud","exp","iat"],kie=class{constructor(n){this._settings=n,this._logger=new zn("ClaimsService")}filterProtocolClaims(n){const e={...n};if(this._settings.filterProtocolClaims){let t;Array.isArray(this._settings.filterProtocolClaims)?t=this._settings.filterProtocolClaims:t=Iie;for(const r of t)Rie.includes(r)||delete e[r]}return e}mergeClaims(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]!==i)if(Array.isArray(t[r])||Array.isArray(i))if(this._settings.mergeClaimsStrategy.array=="replace")t[r]=i;else{const s=Array.isArray(t[r])?t[r]:[t[r]];for(const o of Array.isArray(i)?i:[i])s.includes(o)||s.push(o);t[r]=s}else typeof t[r]=="object"&&typeof i=="object"?t[r]=this.mergeClaims(t[r],i):t[r]=i;return t}},xie=class{constructor(n,e){this.keys=n,this.nonce=e}},hP=class{constructor(n,e){this._logger=new zn("OidcClient"),this.settings=n instanceof VR?n:new VR(n),this.metadataService=e??new i$(this.settings),this._claimsService=new kie(this.settings),this._validator=new Sie(this.settings,this.metadataService,this._claimsService),this._tokenClient=new s$(this.settings,this.metadataService)}async createSigninRequest({state:n,request:e,request_uri:t,request_type:r,id_token_hint:i,login_hint:s,skipUserInfo:o,nonce:a,url_state:c,response_type:l=this.settings.response_type,scope:u=this.settings.scope,redirect_uri:h=this.settings.redirect_uri,prompt:p=this.settings.prompt,display:m=this.settings.display,max_age:v=this.settings.max_age,ui_locales:g=this.settings.ui_locales,acr_values:S=this.settings.acr_values,resource:b=this.settings.resource,response_mode:R=this.settings.response_mode,extraQueryParams:k=this.settings.extraQueryParams,extraTokenParams:I=this.settings.extraTokenParams,dpopJkt:T,omitScopeWhenRequesting:C=this.settings.omitScopeWhenRequesting}){const P=this._logger.create("createSigninRequest");if(l!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");const M=await this.metadataService.getAuthorizationEndpoint();P.debug("Received authorization endpoint",M);const D=await wie.create({url:M,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:h,response_type:l,scope:u,state_data:n,url_state:c,prompt:p,display:m,max_age:v,ui_locales:g,id_token_hint:i,login_hint:s,acr_values:S,dpopJkt:T,resource:b,request:e,request_uri:t,extraQueryParams:k,extraTokenParams:I,request_type:r,response_mode:R,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:C});await this.clearStaleState();const F=D.state;return await this.settings.stateStore.set(F.id,F.toStorageString()),D}async readSigninResponseState(n,e=!1){const t=this._logger.create("readSigninResponseState"),r=new v_(a5.readParams(n,this.settings.response_mode));if(!r.state)throw t.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw t.throw(new Error("No matching state found in storage")),null;return{state:await dP.fromStorageString(i),response:r}}async processSigninResponse(n,e){const t=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(n,!0);if(t.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const s=await this.getDpopProof(this.settings.dpop.store);e={...e,DPoP:s}}try{await this._validator.validateSigninResponse(i,r,e)}catch(s){if(s instanceof HR&&this.settings.dpop){const o=await this.getDpopProof(this.settings.dpop.store,s.nonce);e.DPoP=o,await this._validator.validateSigninResponse(i,r,e)}else throw s}return i}async getDpopProof(n,e){let t,r;return(await n.getAllKeys()).includes(this.settings.client_id)?(r=await n.get(this.settings.client_id),r.nonce!==e&&e&&(r.nonce=e,await n.set(this.settings.client_id,r))):(t=await Bo.generateDPoPKeys(),r=new xie(t,e),await n.set(this.settings.client_id,r)),await Bo.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:n,password:e,skipUserInfo:t=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:n,password:e,...r}),s=new v_(new URLSearchParams);return Object.assign(s,i),await this._validator.validateCredentialsResponse(s,t),s}async useRefreshToken({state:n,redirect_uri:e,resource:t,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:s}){var o;const a=this._logger.create("useRefreshToken");let c;if(this.settings.refreshTokenAllowedScope===void 0)c=n.scope;else{const h=this.settings.refreshTokenAllowedScope.split(" ");c=(((o=n.scope)==null?void 0:o.split(" "))||[]).filter(m=>h.includes(m)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const h=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:h}}let l;try{l=await this._tokenClient.exchangeRefreshToken({refresh_token:n.refresh_token,scope:c,redirect_uri:e,resource:t,timeoutInSeconds:r,extraHeaders:i,...s})}catch(h){if(h instanceof HR&&this.settings.dpop)i.DPoP=await this.getDpopProof(this.settings.dpop.store,h.nonce),l=await this._tokenClient.exchangeRefreshToken({refresh_token:n.refresh_token,scope:c,redirect_uri:e,resource:t,timeoutInSeconds:r,extraHeaders:i,...s});else throw h}const u=new v_(new URLSearchParams);return Object.assign(u,l),a.debug("validating response",u),await this._validator.validateRefreshResponse(u,{...n,scope:c}),u}async createSignoutRequest({state:n,id_token_hint:e,client_id:t,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:s=this.settings.extraQueryParams}={}){const o=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw o.throw(new Error("No end session endpoint")),null;o.debug("Received end session endpoint",a),!t&&i&&!e&&(t=this.settings.client_id);const c=new Cie({url:a,id_token_hint:e,client_id:t,post_logout_redirect_uri:i,state_data:n,extraQueryParams:s,request_type:r});await this.clearStaleState();const l=c.state;return l&&(o.debug("Signout request has state to persist"),await this.settings.stateStore.set(l.id,l.toStorageString())),c}async readSignoutResponseState(n,e=!1){const t=this._logger.create("readSignoutResponseState"),r=new Tie(a5.readParams(n,this.settings.response_mode));if(!r.state){if(t.debug("No state in response"),r.error)throw t.warn("Response was error:",r.error),new Vf(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw t.throw(new Error("No matching state found in storage")),null;return{state:await Pb.fromStorageString(i),response:r}}async processSignoutResponse(n){const e=this._logger.create("processSignoutResponse"),{state:t,response:r}=await this.readSignoutResponseState(n,!0);return t?(e.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,t)):e.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),Pb.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(n,e){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:n,token_type_hint:e})}},de=(n=>(n.Get="GET",n.Put="PUT",n.Post="POST",n.Delete="DELETE",n.Options="OPTIONS",n.Head="HEAD",n.Patch="PATCH",n))(de||{});class Zl extends Error{constructor(e,t,r){super(e),this.httpStatus=t,this.httpHeaders=r}isRateLimitError(){return this.httpStatus===429}getRetryAfterMs(){var t;const e=(t=this.httpHeaders)==null?void 0:t.get("Retry-After");if(e!=null){if(/^\d+$/.test(e)){const i=Number.parseInt(e)*1e3;if(!Number.isFinite(i))throw new Error("Retry-After header integer value is too large");return i}const r=new Date(e);if(r.toUTCString()!==e)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return r.getTime()-Date.now()}return null}}class gn extends Zl{constructor(e={},t,r,i,s){let o=e.error||"Unknown message";t&&(o=`[${t}] ${o}`),r&&(o=`${o} (${r})`),super(`MatrixError: ${o}`,t,s),this.url=r,this.event=i,this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return this.errcode==="M_LIMIT_EXCEEDED"||(this.errcode==="M_UNKNOWN"||this.errcode===void 0)&&super.isRateLimitError()}getRetryAfterMs(){const e=super.getRetryAfterMs();if(e!==null)return e;if(this.errcode==="M_LIMIT_EXCEEDED"&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){const e={};if(this.httpHeaders)for(const[t,r]of this.httpHeaders)e[t]=r;return{http_status:this.httpStatus??400,http_headers:e,url:this.url??"",response:{errcode:this.errcode??"M_UNKNOWN",error:this.data.error??"Unknown message",...this.data}}}static fromWidgetApiErrorData(e){return new gn(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function fP(n,e){if(!(n instanceof Zl)||!n.isRateLimitError())return e;try{return n.getRetryAfterMs()??e}catch{return e}}let Vd=class extends Error{constructor(e,t){super(e+(t?`: ${t.message}`:""))}get name(){return"ConnectionError"}};class c$ extends Error{constructor(e){super((e==null?void 0:e.message)??"")}get name(){return"TokenRefreshError"}}var Lb=(n=>(n.SessionLoggedOut="Session.logged_out",n.NoConsent="no_consent",n))(Lb||{}),t1={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var c5;function Pie(){if(c5)return t1;c5=1;var n=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,e=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,t=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,i=/([\\"])/g,s=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;t1.format=o,t1.parse=a;function o(h){if(!h||typeof h!="object")throw new TypeError("argument obj is required");var p=h.parameters,m=h.type;if(!m||!s.test(m))throw new TypeError("invalid type");var v=m;if(p&&typeof p=="object")for(var g,S=Object.keys(p).sort(),b=0;b<S.length;b++){if(g=S[b],!t.test(g))throw new TypeError("invalid parameter name");v+="; "+g+"="+l(p[g])}return v}function a(h){if(!h)throw new TypeError("argument string is required");var p=typeof h=="object"?c(h):h;if(typeof p!="string")throw new TypeError("argument string is required to be a string");var m=p.indexOf(";"),v=m!==-1?p.slice(0,m).trim():p.trim();if(!s.test(v))throw new TypeError("invalid media type");var g=new u(v.toLowerCase());if(m!==-1){var S,b,R;for(n.lastIndex=m;b=n.exec(p);){if(b.index!==m)throw new TypeError("invalid parameter format");m+=b[0].length,S=b[1].toLowerCase(),R=b[2],R.charCodeAt(0)===34&&(R=R.slice(1,-1),R.indexOf("\\")!==-1&&(R=R.replace(r,"$1"))),g.parameters[S]=R}if(m!==p.length)throw new TypeError("invalid parameter format")}return g}function c(h){var p;if(typeof h.getHeader=="function"?p=h.getHeader("content-type"):typeof h.headers=="object"&&(p=h.headers&&h.headers["content-type"]),typeof p!="string")throw new TypeError("content-type header is missing from object");return p}function l(h){var p=String(h);if(t.test(p))return p;if(p.length>0&&!e.test(p))throw new TypeError("invalid parameter value");return'"'+p.replace(i,"\\$1")+'"'}function u(h){this.parameters=Object.create(null),this.type=h}return t1}var Lie=Pie();function lw(n){const e=new AbortController;return setTimeout(()=>{e.abort()},n),e.signal}function l$(n){const e=new AbortController;function t(){for(const i of n)i.removeEventListener("abort",r)}function r(){e.abort(),t()}for(const i of n){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:e.signal,cleanup:t}}function pP(n,e){const t=l5(n)?new Headers(n.getAllResponseHeaders().trim().split(/[\r\n]+/).map(i=>{const s=i.indexOf(":");return[i.substring(0,s),i.substring(s+1)]})):n.headers;let r;try{r=Aie(t)}catch(i){return i}return(r==null?void 0:r.type)==="application/json"&&e?new gn(JSON.parse(e),n.status,l5(n)?n.responseURL:n.url,void 0,t):(r==null?void 0:r.type)==="text/plain"?new Zl(`Server returned ${n.status} error: ${e}`,n.status,t):new Zl(`Server returned ${n.status} error`,n.status,t)}function l5(n){return"getResponseHeader"in n}function Aie(n){const e=n.get("Content-Type");if(e===null)return null;try{return Lie.parse(e)}catch(t){throw new Error(`Error parsing Content-Type '${e}': ${t}`)}}async function KR(n,e){let t=0,r=null;for(;t<n;)try{if(t>0){const i=1e3*Math.pow(2,t);O.log(`network operation failed ${t} times, retrying in ${i}ms...`),await Td(i)}return await e()}catch(i){if(i instanceof Vd)t+=1,r=i;else throw i}throw r}function u$(n,e,t){return e>4||n instanceof Vd&&!t||n.httpStatus&&Math.floor(n.httpStatus/100)===4&&n.httpStatus!==429||n.name==="AbortError"||n.name==="M_TOO_LARGE"?-1:fP(n,1e3*Math.pow(2,e))}function Mie(n){let e;async function t(...r){if(e)return e;try{return e=n.call(this,...r),await e,e}finally{e=void 0}}return t}var Oie=Object.create,d$=Object.defineProperty,Nie=Object.getOwnPropertyDescriptor,Die=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),h$=n=>{throw TypeError(n)},Fie=(n,e,t)=>e in n?d$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Uie=n=>[,,,Oie(null)],f$=["class","method","getter","setter","accessor","field","value","get","set"],p$=n=>n!==void 0&&typeof n!="function"?h$("Function expected"):n,jie=(n,e,t,r,i)=>({kind:f$[n],name:e,metadata:r,addInitializer:s=>t._?h$("Already initialized"):i.push(p$(s||null))}),$ie=(n,e)=>Fie(e,Die("metadata"),n[3]),Bie=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},Hie=(n,e,t,r,i,s)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,m=2,v=f$[u+5],g=n[m]||(n[m]=[]),S=(i=i.prototype,Nie(i,t)),b=r.length-1;b>=0;b--)c=jie(u,t,a={},n[3],g),c.static=h,c.private=p,l=c.access={has:R=>t in R},l.get=R=>R[t],o=(0,r[b])(S[v],c),a._=1,p$(o)&&(S[v]=o);return S&&d$(i,t,S),i},m$,uw;m$=[Mie];class mP{constructor(e,t){this.eventEmitter=e,this.opts=t,Bie(uw,5,this),this.abortController=new AbortController,this.tokenRefreshPromise=void 0,pj(t,["baseUrl","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=t.useAuthorizationHeader??!0}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,t){return this.opts.fetchFn?this.opts.fetchFn(e,t):globalThis.fetch(e,t)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,t,r,i,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");let o,a;e===de.Get?o=r:a=r;const c=this.getUrl(t,o,i,this.opts.idBaseUrl),l={json:!0,headers:{}};return s&&(l.headers.Authorization=`Bearer ${s}`),this.requestOtherUrl(e,c,a,l)}async authedRequest(e,t,r,i,s={}){r||(r={});const o={...s};this.opts.accessToken&&(this.opts.useAuthorizationHeader?(o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken));try{return await this.tokenRefreshPromise,await this.request(e,t,r,i,o)}catch(a){if(!(a instanceof gn))throw a;if(a.errcode==="M_UNKNOWN_TOKEN"&&!o.doNotAttemptTokenRefresh){const c=this.tryRefreshToken();this.tokenRefreshPromise=Promise.allSettled([c]);const l=await c;if(l==="success")return this.authedRequest(e,t,r,i,{...s,doNotAttemptTokenRefresh:!0});if(l==="failure")throw new c$(a)}throw a.errcode=="M_UNKNOWN_TOKEN"&&!(o!=null&&o.inhibitLogoutEmit)?this.eventEmitter.emit(Lb.SessionLoggedOut,a):a.errcode=="M_CONSENT_NOT_GIVEN"&&this.eventEmitter.emit(Lb.NoConsent,a.message,a.data.consent_uri),a}}async tryRefreshToken(){var e;if(!this.opts.refreshToken||!this.opts.tokenRefreshFunction)return"logout";try{const{accessToken:t,refreshToken:r}=await this.opts.tokenRefreshFunction(this.opts.refreshToken);return this.opts.accessToken=t,this.opts.refreshToken=r,"success"}catch(t){return(e=this.opts.logger)==null||e.warn("Failed to refresh token",t),t instanceof Vf||t instanceof gn?"logout":"failure"}}request(e,t,r,i,s){const o=this.getUrl(t,r,s==null?void 0:s.prefix,s==null?void 0:s.baseUrl);return this.requestOtherUrl(e,o,i,s)}async requestOtherUrl(e,t,r,i={}){var b,R,k,I;const s=this.sanitizeUrlForLogs(t);(b=this.opts.logger)==null||b.debug(`FetchHttpApi: --> ${e} ${s}`);const o=Object.assign({},i.headers||{}),a=i.json??!0,c=a&&((R=r==null?void 0:r.constructor)==null?void 0:R.name)===Object.name;a&&(c&&!o["Content-Type"]&&(o["Content-Type"]="application/json"),o.Accept||(o.Accept="application/json"));const l=i.localTimeoutMs??this.opts.localTimeoutMs,u=i.keepAlive??!1,h=[this.abortController.signal];l!==void 0&&h.push(lw(l)),i.abortSignal&&h.push(i.abortSignal);let p;c?p=JSON.stringify(r):p=r;const{signal:m,cleanup:v}=l$(h);let g;const S=Date.now();try{g=await this.fetch(t,{signal:m,method:e,body:p,headers:o,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:u,priority:i.priority}),(k=this.opts.logger)==null||k.debug(`FetchHttpApi: <-- ${e} ${s} [${Date.now()-S}ms ${g.status}]`)}catch(T){throw(I=this.opts.logger)==null||I.debug(`FetchHttpApi: <-- ${e} ${s} [${Date.now()-S}ms ${T}]`),T.name==="AbortError"?T:new Vd("fetch failed",T)}finally{v()}if(!g.ok)throw pP(g,await g.text());return this.opts.onlyData?a?g.json():g.text():g}sanitizeUrlForLogs(e){try{let t;typeof e=="string"?t=new URL(e):t=e;const r=new URLSearchParams;for(const o of t.searchParams.keys())r.append(o,"xxx");const i=r.toString(),s=i?`?${i}`:"";return t.origin+t.pathname+s}catch{return"??"}}getUrl(e,t,r,i){const s=i??this.opts.baseUrl,o=s.endsWith("/")?s.slice(0,-1):s,a=new URL(o+(r??this.opts.prefix)+e);return t&&kR(t,a.searchParams),a}}uw=Uie();Hie(uw,1,"tryRefreshToken",m$,mP);$ie(uw,mP);var ur=(n=>(n.V1="/_matrix/client/v1",n.V3="/_matrix/client/v3",n.Unstable="/_matrix/client/unstable",n))(ur||{}),da=(n=>(n.V2="/_matrix/identity/v2",n))(da||{}),ld=(n=>(n.V1="/_matrix/media/v1",n.V3="/_matrix/media/v3",n))(ld||{});const Vie=1e3;let Gie=0,PT;const gc=[],qie=function(...n){};function u5(n,e,...t){e=e||0,e<0&&(e=0);const r=Date.now()+e,i=Gie++,s={runAt:r,func:n,params:t,key:i},o=Wie(gc,function(a){return a.runAt-r});return gc.splice(o,0,s),gP(),i}function d5(n){if(gc.length===0)return;let e;for(e=0;e<gc.length;e++)if(gc[e].key==n){gc.splice(e,1);break}e===0&&gP()}function gP(){PT&&globalThis.clearTimeout(PT);const n=gc[0];if(!n)return;const e=Date.now(),t=Math.min(n.runAt-e,Vie);PT=globalThis.setTimeout(Kie,t)}function Kie(){const n=Date.now(),e=[];for(;;){const t=gc[0];if(!t||t.runAt>n)break;const r=gc.shift();qie("runCallbacks: popping",r.key),e.push(r)}gP();for(const t of e)try{t.func.apply(globalThis,t.params)}catch(r){O.error("Uncaught exception in callback function",r)}}function Wie(n,e){let t=0,r=n.length;for(;t<r;){const i=t+r>>1;e(n[i])>0?r=i:t=i+1}return t}class g$ extends mP{constructor(){super(...arguments),this.uploads=[]}uploadContent(e,t={}){const r=t.includeFilename??!0,i=t.abortController??new AbortController,s=(t.type??e.type)||"application/octet-stream",o=t.name??e.name,a={loaded:0,total:0,abortController:i},c=Xl();if(globalThis.XMLHttpRequest){const l=new globalThis.XMLHttpRequest,u=function(){l.abort(),c.reject(new Error("Timeout"))};let h=u5(u,3e4);l.onreadystatechange=function(){switch(l.readyState){case globalThis.XMLHttpRequest.DONE:d5(h);try{if(l.status===0)throw new DOMException(l.statusText,"AbortError");if(!l.responseText)throw new Error("No response body.");l.status>=400?c.reject(pP(l,l.responseText)):c.resolve(JSON.parse(l.responseText))}catch(m){if(m.name==="AbortError"){c.reject(m);return}c.reject(new Vd("request failed",m))}break}},l.upload.onprogress=m=>{var v;d5(h),a.loaded=m.loaded,a.total=m.total,h=u5(u,3e4),(v=t.progressHandler)==null||v.call(t,{loaded:m.loaded,total:m.total})};const p=this.getUrl("/upload",void 0,ld.V3);r&&o&&p.searchParams.set("filename",encodeURIComponent(o)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&p.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),l.open(de.Post,p.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&l.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),l.setRequestHeader("Content-Type",s),l.send(e),i.signal.addEventListener("abort",()=>{l.abort()})}else{const l={};r&&o&&(l.filename=o);const u={"Content-Type":s};this.authedRequest(de.Post,"/upload",l,e,{prefix:ld.V3,headers:u,abortSignal:i.signal}).then(h=>this.opts.onlyData?h:h.json()).then(c.resolve,c.reject)}return a.promise=c.promise.finally(()=>{yb(this.uploads,l=>l===a)}),i.signal.addEventListener("abort",()=>{yb(this.uploads,l=>l===a),c.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(a),a.promise}cancelUpload(e){const t=this.uploads.find(r=>r.promise===e);return t?(t.abortController.abort(),!0):!1}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:ld.V3+"/upload",params:{access_token:this.opts.accessToken}}}}const zie=6*60*60*1e3,Yie=30*1e3;var vP=(n=>(n.Stable="stable",n.Unstable="unstable",n))(vP||{});class v${constructor(e){this.http=e,this.fetchCapabilities=async()=>{const t=await this.http.authedRequest(de.Get,"/capabilities");return this.capabilities=t.capabilities,this.capabilities},this.poll=async()=>{try{await this.fetchCapabilities(),this.clearTimeouts(),this.refreshTimeout=setTimeout(this.poll,zie),O.debug("Fetched new server capabilities")}catch(t){this.clearTimeouts();const r=Math.floor(Yie+Math.random()*5e3);this.retryTimeout=setTimeout(this.poll,r),O.warn(`Failed to refresh capabilities: retrying in ${r}ms`,t)}}}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}const y$="10",Xie=["1","2","3","4","5","6","7","8","9","10"],Jie=30;var sr=(n=>(n.Highlight="highlight",n.Total="total",n))(sr||{}),Je=(n=>(n.MyMembership="Room.myMembership",n.Tags="Room.tags",n.AccountData="Room.accountData",n.Receipt="Room.receipt",n.Name="Room.name",n.Redaction="Room.redaction",n.RedactionCancelled="Room.redactionCancelled",n.LocalEchoUpdated="Room.localEchoUpdated",n.Timeline="Room.timeline",n.TimelineReset="Room.timelineReset",n.TimelineRefresh="Room.TimelineRefresh",n.OldStateUpdated="Room.OldStateUpdated",n.CurrentStateUpdated="Room.CurrentStateUpdated",n.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",n.UnreadNotifications="Room.UnreadNotifications",n.Summary="Room.Summary",n))(Je||{});let dw=class extends Jj{constructor(e,t,r,i={}){super(),this.roomId=e,this.client=t,this.myUserId=r,this.opts=i,this.txnToEvent=new Map,this.notificationCounts={},this.threadNotifications=new Map,this.cachedThreadReadReceipts=new Map,this.oldestThreadedReceiptTs=1/0,this.unthreadedReceipts=new Map,this.polls=new Map,this.threadsTimelineSets=[],this.filteredTimelineSets={},this.timelineNeedsRefresh=!1,this.summaryHeroes=null,this.getTypeWarning=!1,this.getVersionWarning=!1,this.tags={},this.accountData=new Map,this.summary=null,this.threads=new Map,this.visibilityEvents=new Map,this.roomReceipts=new Qre(this),this.threadTimelineSetsPromise=null,this.threadsReady=!1,this.updateThreadRootEvents=(s,o,a)=>{var c,l;s.length&&(this.updateThreadRootEvent((c=this.threadsTimelineSets)==null?void 0:c[0],s,o,a),s.hasCurrentUserParticipated&&this.updateThreadRootEvent((l=this.threadsTimelineSets)==null?void 0:l[1],s,o,a))},this.updateThreadRootEvent=(s,o,a,c)=>{s&&o.rootEvent&&(c&&s.removeEvent(o.id),Gr.hasServerSideSupport?s.addLiveEvent(o.rootEvent,{duplicateStrategy:Ig.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):s.addEventToTimeline(o.rootEvent,s.getLiveTimeline(),{toStartOfTimeline:a,addToState:!1}))},this.applyRedaction=s=>{if(s.isRedaction()){const o=s.event.redacts,a=o?this.findEventById(o):void 0;if(a){const c=a.threadRootId;if(a.makeRedacted(s,this),a.isState()){const l=this.currentState.getStateEvents(a.getType(),a.getStateKey());(l==null?void 0:l.getId())===a.getId()&&this.currentState.setStateEvents([a])}this.emit("Room.redaction",s,this,c),this.visibilityEvents.delete(o),a.isVisibilityEvent()&&this.redactVisibilityChangeEvent(s)}}},this.setMaxListeners(100),this.reEmitter=new sy(this),i.pendingEventOrdering=i.pendingEventOrdering||Rd.Chronological,this.name=e,this.normalizedName=e,this.relations=new Nj(this.client,this),this.on("Room.receipt",this.onReceipt),this.timelineSets=[new cf(this,i)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===Rd.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(s=>{const o=this.client.getEventMapper({toDevice:!1,decrypt:!1});s.forEach(async a=>{const c=o(a);await t.decryptEventIfNeeded(c),c.setStatus(nt.NOT_SENT),this.addPendingEvent(c,c.getTxnId())})})),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}async createThreadsTimelineSets(){var e;if(this.threadTimelineSetsPromise)return this.threadTimelineSetsPromise;if((e=this.client)!=null&&e.supportsThreads())try{this.threadTimelineSetsPromise=Promise.all([this.createThreadTimelineSet(),this.createThreadTimelineSet(To.My)]);const t=await this.threadTimelineSetsPromise;return this.threadsTimelineSets[0]=t[0],this.threadsTimelineSets[1]=t[1],t}catch{return this.threadTimelineSetsPromise=null,null}return null}async decryptCriticalEvents(){if(!this.client.getCrypto())return;const e=this.getEventReadUpTo(this.client.getUserId(),!0),t=this.getLiveTimeline().getEvents(),r=t.findIndex(s=>s.event.event_id===e),i=t.slice(r).reverse().map(s=>this.client.decryptEventIfNeeded(s));await Promise.allSettled(i)}async decryptAllEvents(){if(!this.client.getCrypto())return;const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map(t=>this.client.decryptEventIfNeeded(t));await Promise.allSettled(e)}getCreator(){const e=this.currentState.getStateEvents(ie.RoomCreate,"");return(e==null?void 0:e.getSender())??null}getVersion(){const e=this.currentState.getStateEvents(ie.RoomCreate,"");return e?e.getContent().room_version??"1":(this.getVersionWarning||(O.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}async getRecommendedVersion(){let e={};try{e=await this.client.getCapabilities()}catch{}let t=e["m.room_versions"];if(!t){t={default:y$,available:{}};for(const i of Xie)t.available[i]=vP.Stable}let r=this.checkVersionAgainstCapability(t);if(r.urgent&&r.needsUpgrade){O.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{e=await this.client.fetchCapabilities()}catch(i){O.warn("Failed to refresh room version capabilities",i)}if(t=e["m.room_versions"],t)r=this.checkVersionAgainstCapability(t);else return O.warn("No room version capability - assuming upgrade required."),r}return r}checkVersionAgainstCapability(e){const t=this.getVersion();O.log(`[${this.roomId}] Current version: ${t}`),O.log(`[${this.roomId}] Version capability: `,e);const r={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter(s=>e.available[s]==="stable").includes(t)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?O.warn(`URGENT upgrade required on ${this.roomId}`):O.warn(`Non-urgent upgrade required on ${this.roomId}`)),r}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(ie.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const t=yb(this.pendingEventList,function(r){return r.getId()==e},!1);return this.savePendingEvents(),t}hasPendingEvent(e){var t;return((t=this.pendingEventList)==null?void 0:t.some(r=>r.getId()===e))??!1}getPendingEvent(e){var t;return((t=this.pendingEventList)==null?void 0:t.find(r=>r.getId()===e))??null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){const t=this.getLiveTimeline().getEvents();return t.length?t[t.length-1].getTs():Number.MIN_SAFE_INTEGER}getLastLiveEvent(){const e=this.getLiveTimeline().getEvents(),t=e[e.length-1],r=this.getLastThread();if(!r)return t;const i=r.events[r.events.length-1];return((t==null?void 0:t.getTs())??0)>((i==null?void 0:i.getTs())??0)?t:i}getLastThread(){return this.getThreads().reduce((e,t)=>{if(!e)return t;const r=t.events[t.events.length-1],i=e.events[e.events.length-1];return((r==null?void 0:r.getTs())??0)>=((i==null?void 0:i.getTs())??0)?t:e},void 0)}getMyMembership(){return this.selfMembership??ze.Leave}getDMInviter(){var t;const e=this.getMember(this.myUserId);if(e)return e.getDMInviter();if(this.selfMembership===ze.Invite&&this.getInvitedAndJoinedMemberCount()===2)return(t=this.summaryHeroes)==null?void 0:t[0]}guessDMUserId(){const e=this.getMember(this.myUserId);if(e){const i=e.getDMInviter();if(i)return i}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const r=this.currentState.getMembers().find(i=>i.userId!==this.myUserId);return r?r.userId:this.myUserId}getFunctionalMembers(){const e=this.currentState.getStateEvents(Ej.name,"");return Array.isArray(e==null?void 0:e.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var a;const e=this.getFunctionalMembers();let t=0;if(this.getMembers().forEach(c=>{c.membership!=="join"&&c.membership!=="invite"||e.includes(c.userId)||t++}),t>2)return;const r=(a=this.summaryHeroes)==null?void 0:a.filter(c=>!e.includes(c)),i=Array.isArray(r)&&r.length;if(i){const c=r.map(l=>this.getMember(l)).find(l=>!!l);if(c)return c}const s=this.getMembers(),o=s==null?void 0:s.filter(c=>!e.includes(c.userId));if(o.length<=2){const c=o.find(l=>l.userId!==this.myUserId);if(c)return c}if(i){const c=r.map(l=>this.client.getUser(l)).find(l=>!!l);if(c){const l=new Cb(this.roomId,c.userId);return l.user=c,l}}}updateMyMembership(e){const t=this.selfMembership;this.selfMembership=e,t!==e&&(e===ze.Leave&&this.cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))}async loadMembersFromServer(){const e=this.client.store.getSyncToken();return(await this.client.members(this.roomId,void 0,ze.Leave,e??void 0)).chunk}async loadMembers(){let e=!1,t=await this.client.store.getOutOfBandMembers(this.roomId);return(t===null||this.hasEncryptionStateEvent())&&(e=!0,t=await this.loadMembersFromServer(),O.log(`LL: got ${t.length} members from server for room ${this.roomId}`)),{memberEvents:t.filter(Po).map(this.client.getEventMapper()),fromServer:e}}membersLoaded(){return this.opts.lazyLoadMembers?this.currentState.outOfBandMembersReady():!0}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this.loadMembers().then(t=>(this.currentState.setOutOfBandMembers(t.memberEvents),t.fromServer)).catch(t=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),t});return e.then(t=>{if(t){const r=this.currentState.getMembers().filter(s=>s.isOutOfBand()).map(s=>{var o;return(o=s.events.member)==null?void 0:o.event});return O.log(`LL: telling store to write ${r.length} members for room ${this.roomId}`),this.client.store.setOutOfBandMembers(this.roomId,r).catch(s=>{O.log("LL: storing OOB room members failed, oh well",s)})}}).catch(t=>{O.error(t)}),this.membersPromise=e,this.membersPromise}async clearLoadedMembersIfNeeded(){this.opts.lazyLoadMembers&&this.membersPromise&&(await this.loadMembersIfNeeded(),await this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=void 0)}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(e=>{O.error(`error after clearing loaded members from room ${this.roomId} after leaving`),O.log(e)})}async refreshLiveTimeline(){const e=this.getLiveTimeline(),t=e.getPaginationToken($e.FORWARDS),r=e.getPaginationToken($e.BACKWARDS),i=e.getEvents(),s=i[i.length-1];O.log(`[refreshLiveTimeline for ${this.roomId}] at mostRecentEventInTimeline=${s&&s.getId()} liveTimelineBefore=${e.toString()} forwardPaginationToken=${t} backwardPaginationToken=${r}`);const o=this.getUnfilteredTimelineSet();let a;s?(this.resetLiveTimeline(null,null),this.emit("Room.TimelineRefresh",this,o),a=await this.client.getEventTimeline(o,s.getId())):a=await this.client.getLatestTimeline(o);const c=o.getLiveTimeline();!c||c.getPaginationToken(St.Forward)===null&&c.getPaginationToken(St.Backward)===null&&c.getEvents().length===0?(O.log(`[refreshLiveTimeline for ${this.roomId}] using our new live timeline`),a.setPaginationToken(t,$e.FORWARDS),o.setLiveTimeline(a),this.fixUpLegacyTimelineFields()):O.log(`[refreshLiveTimeline for ${this.roomId}] \`/sync\` or some other request beat us to creating a new live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history.`),this.setTimelineNeedsRefresh(!1),this.emit("Room.TimelineRefresh",this,o)}resetLiveTimeline(e,t){for(const r of this.timelineSets)r.resetLiveTimeline(e??void 0,t??void 0);for(const r of this.threads.values())r.resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){const e=this.oldState,t=this.currentState;this.oldState=this.getLiveTimeline().getState($e.BACKWARDS),this.currentState=this.getLiveTimeline().getState($e.FORWARDS),e!==this.oldState&&this.emit("Room.OldStateUpdated",this,e,this.oldState),t!==this.currentState&&(this.emit("Room.CurrentStateUpdated",this,t,this.currentState),this.reEmitter.stopReEmitting(t,[kt.Events,kt.Members,kt.NewMember,kt.Update,kt.Marker,qn.New,qn.Update,qn.Destroy,qn.LivenessChange]),this.reEmitter.reEmit(this.currentState,[kt.Events,kt.Members,kt.NewMember,kt.Update,kt.Marker,qn.New,qn.Update,qn.Destroy,qn.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var s,o;let t=[],r=!1;const i=e.getContent();for(const a of Object.values(i))for(const[c,l]of Object.entries(a))if(Qx(c)&&l)for(const[u,h]of Object.entries(l)){if(!h||typeof h!="object")continue;const p=h;u===this.client.getUserId()&&(p.thread_id===void 0?r=!0:typeof p.thread_id=="string"&&t.push(p.thread_id))}r&&(t=this.getThreads().filter(a=>this.getThreadUnreadNotificationCount(a.id,"total")>0||this.getThreadUnreadNotificationCount(a.id,"highlight")>0).map(a=>a.id),t.push("main"));for(const a of t){const l=a==="main"?this.getLiveTimeline():(s=this.getThread(a))==null?void 0:s.liveTimeline;if(!l){O.warn(`Couldn't find timeline for thread ID ${a} in room ${this.roomId}`);continue}const u=l.getEvents();let h=0;for(let p=u.length-1;p>=0;p--){if(p===u.length-20)return;const m=u[p];if(this.hasUserReadEvent(this.client.getUserId(),m.getId()))break;const v=this.client.getPushActionsForEvent(m);h+=(o=v==null?void 0:v.tweaks)!=null&&o.highlight?1:0}a==="main"?this.setUnreadNotificationCount("highlight",h):this.setThreadUnreadNotificationCount(a,"highlight",h)}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){const t=this.findEventById(e),r=this.findThreadForEvent(t);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){let t=this.getUnfilteredTimelineSet().findEventById(e);if(!t){const r=this.getThreads();for(let i=0;i<r.length;i++)if(t=r[i].findEventById(e),t)return t}return t}getUnreadNotificationCount(e="total"){let t=this.getRoomUnreadNotificationCount(e);for(const r of this.threadNotifications.values())t+=r[e]??0;return t}getUnreadCountForEventContext(e="total",t){return(!!t.threadRootId&&!t.isThreadRoot?this.getThreadUnreadNotificationCount(t.threadRootId,e):this.getRoomUnreadNotificationCount(e))??0}getRoomUnreadNotificationCount(e="total"){return this.notificationCounts[e]??0}getThreadUnreadNotificationCount(e,t="total"){var r;return((r=this.threadNotifications.get(e))==null?void 0:r[t])??0}hasThreadUnreadNotification(){for(const e of this.threadNotifications.values())if((e.highlight??0)>0||(e.total??0)>0)return!0;return!1}setThreadUnreadNotificationCount(e,t,r){var s,o;const i={highlight:(s=this.threadNotifications.get(e))==null?void 0:s.highlight,total:(o=this.threadNotifications.get(e))==null?void 0:o.total,[t]:r};this.threadNotifications.set(e,i),this.emit("Room.UnreadNotifications",i,e)}get threadsAggregateNotificationType(){let e=null;for(const t of this.threadNotifications.values()){if((t.highlight??0)>0)return"highlight";(t.total??0)>0&&!e&&(e="total")}return e}resetThreadUnreadNotificationCountFromSync(e=[]){const t=this.hasEncryptionStateEvent();for(const[r,i]of this.threadNotifications)e.includes(r)||(i.total=0,t||(i.highlight=0));this.emit("Room.UnreadNotifications")}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t,this.emit("Room.UnreadNotifications",this.notificationCounts)}setUnread(e,t){return this.setUnreadNotificationCount(e,t)}setSummary(e){const t=e["m.heroes"],r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(t)&&(this.summaryHeroes=t.filter(s=>s!==this.myUserId)),this.emit("Room.Summary",e)}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices===void 0?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,t,r,i,s=!0,o=!1){const a=this.currentState.getStateEvents(ie.RoomAvatar,"");if(!a&&!s)return null;const c=a?a.getContent().url:null;return c?sw(e,c,t,r,i,void 0,void 0,o):null}getMxcAvatarUrl(){var e,t;return((t=(e=this.currentState.getStateEvents(ie.RoomAvatar,""))==null?void 0:e.getContent())==null?void 0:t.url)||null}getCanonicalAlias(){const e=this.currentState.getStateEvents(ie.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){const e=this.currentState.getStateEvents(ie.RoomCanonicalAlias,"");return e?e.getContent().alt_aliases||[]:[]}addEventsToTimeline(e,t,r,i,s){i.getTimelineSet().addEventsToTimeline(e,t,r,i,s)}getThread(e){return this.threads.get(e)??null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(ze.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter(function(t){return t.membership===e})}async getEncryptionTargetMembers(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership(ze.Join);return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership(ze.Invite))),e}shouldEncryptForInvitedMembers(){var t;const e=this.currentState.getStateEvents(ie.RoomHistoryVisibility,"");return((t=e==null?void 0:e.getContent())==null?void 0:t.history_visibility)!=="joined"}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){const r=this.getMember(e);return r?r.membership===t:!1}getOrCreateFilteredTimelineSet(e,{prepopulateTimeline:t=!0,useSyncEvents:r=!0,pendingEvents:i=!0}={}){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];const s=Object.assign({filter:e,pendingEvents:i},this.opts),o=new cf(this,s);this.reEmitter.reEmit(o,["Room.timeline","Room.timelineReset"]),r&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));const a=this.getLiveTimeline();if(t){a.getEvents().forEach(function(l){o.addLiveEvent(l,{addToState:!1})});let c=a;for(;c.getNeighbouringTimeline($e.BACKWARDS);)c=c.getNeighbouringTimeline($e.BACKWARDS);o.getLiveTimeline().setPaginationToken(c.getPaginationToken($e.BACKWARDS),$e.BACKWARDS)}else if(r){const c=a.getPaginationToken(St.Forward);o.getLiveTimeline().setPaginationToken(c,St.Backward)}return o}async getThreadListFilter(e=To.All){const t=this.client.getUserId(),r=new ys(t),i={room:{timeline:{[Ef.name]:[tn.name]}}};e===To.My&&(i.room.timeline[wf.name]=[t]),r.setDefinition(i);const s=await this.client.getOrCreateFilter(`THREAD_PANEL_${this.roomId}_${e}`,r);return r.filterId=s,r}async createThreadTimelineSet(e){let t;if(Gr.hasServerSideListSupport)t=new cf(this,{...this.opts,pendingEvents:!1},void 0,void 0,e??To.All),this.reEmitter.reEmit(t,["Room.timeline","Room.timelineReset"]);else if(Gr.hasServerSideSupport){const r=await this.getThreadListFilter(e);t=this.getOrCreateFilteredTimelineSet(r,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else t=new cf(this,{pendingEvents:!1}),Array.from(this.threads).forEach(([,r])=>{if(r.length===0)return;const i=r.timeline.some(s=>s.getSender()===this.client.getUserId());(e!==To.My||i)&&t.getLiveTimeline().addEvent(r.rootEvent,{toStartOfTimeline:!1,addToState:!1})});return t}processThreadRoots(e,t){if(this.client.supportsThreads())for(const r of e)$e.setEventMetadata(r,this.currentState,t),this.getThread(r.getId())||this.createThread(r.getId(),r,[],t)}async fetchRoomThreads(){var e,t;if(!(this.threadsReady||!this.client.supportsThreads())){if(Gr.hasServerSideListSupport)await Promise.all([this.fetchRoomThreadList(To.All),this.fetchRoomThreadList(To.My)]);else{const r=await this.getThreadListFilter(),{chunk:i}=await this.client.createMessagesRequest(this.roomId,"",Number.MAX_SAFE_INTEGER,St.Backward,r);if(!i.length)return;const s=i.map(this.client.getEventMapper()).sort((c,l)=>{const u=c.getServerAggregatedRelation(tn.name),h=l.getServerAggregatedRelation(tn.name);return u.latest_event.origin_server_ts-h.latest_event.origin_server_ts});let o;const a=this.getLiveTimeline().getState($e.FORWARDS);for(const c of s){const l={duplicateStrategy:Ig.Ignore,fromCache:!1,addToState:!1,roomState:a};(e=this.threadsTimelineSets[0])==null||e.addLiveEvent(c,l);const u=c.getServerAggregatedRelation(tn.name);u!=null&&u.current_user_participated&&((t=this.threadsTimelineSets[1])==null||t.addLiveEvent(c,l),o=c)}this.processThreadRoots(s,!0),this.client.decryptEventIfNeeded(s[s.length-1]),o&&this.client.decryptEventIfNeeded(o)}this.on(Ro.NewReply,this.onThreadReply),this.on(Ro.Update,this.onThreadUpdate),this.on(Ro.Delete,this.onThreadDelete),this.threadsReady=!0}}async processPollEvents(e){for(const t of e)try{if(!t.isEncrypted()&&!Qj(t))continue;await this.client.decryptEventIfNeeded(t),this.processPollEvent(t)}catch(r){O.warn("Error processing poll event",t.getId(),r)}}async processPollEvent(e){if(e.isDecryptionFailure()){e.once(mn.Decrypted,r=>{this.processPollEvent(r)});return}if(ss.M_POLL_START.matches(e.getType())){try{const r=new Zj(e,this.client,this);this.polls.set(e.getId(),r),this.emit(cP.New,r),e.once(mn.BeforeRedaction,i=>{this.polls.delete(i.getId())})}catch{}return}const t=e.relationEventId;if(t&&this.polls.has(t)){const r=this.polls.get(t);r==null||r.onNewRelation(e)}}async fetchRoomThreadList(e){if(!this.client.supportsThreads()||this.threadsTimelineSets.length===0)return;const t=e===To.My?this.threadsTimelineSets[1]:this.threadsTimelineSets[0],{chunk:r,end:i}=await this.client.createThreadListMessagesRequest(this.roomId,null,void 0,St.Backward,t.threadListType,t.getFilter());if(t.getLiveTimeline().setPaginationToken(i??null,St.Backward),!r.length)return;const s=r.map(this.client.getEventMapper());this.processThreadRoots(s,!0);const o=this.getLiveTimeline().getState($e.FORWARDS);for(const a of s)t.addLiveEvent(a,{duplicateStrategy:Ig.Replace,fromCache:!1,roomState:o,addToState:!1})}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var i;this.threads.delete(e.id);const t=this.getTimelineForEvent(e.id),r=(i=t==null?void 0:t.getEvents())==null?void 0:i.find(s=>s.getId()===e.id);r?e.clearEventMetadata(r):O.debug("onThreadDelete: Could not find root event in room timeline");for(const s of this.threadsTimelineSets)s.removeEvent(e.id)}removeFilteredTimelineSet(e){const t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];const r=this.timelineSets.indexOf(t);r>-1&&this.timelineSets.splice(r,1)}eventShouldLiveIn(e,t,r){var c;if(!((c=this.client)!=null&&c.supportsThreads()))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||r!=null&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};const i=e.isRelation(tn.name),s=e.getAssociatedId(),o=e.threadRootId;if(s&&!i&&(o===s||r!=null&&r.has(s)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};let a;return s&&(a=this.findEventById(s)??(t==null?void 0:t.find(l=>l.getId()===s))),a&&!i?this.eventShouldLiveIn(a,t,r):o!=null?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:o}:!s||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;const{threadId:t}=this.eventShouldLiveIn(e);return t?this.getThread(t):null}addThreadedEvents(e,t,r=!1){const i=this.getThread(e);if(i)i.addEvents(t,r);else{const s=this.findEventById(e)??t.find(o=>o.getId()===e);this.createThread(e,s,t,r)}}processThreadedEvents(e,t){var i;e.forEach(this.applyRedaction);const r={};for(const s of e){const{threadId:o,shouldLiveInThread:a}=this.eventShouldLiveIn(s);a&&!r[o]&&(r[o]=[]),(i=r[o])==null||i.push(s)}Object.entries(r).map(([s,o])=>this.addThreadedEvents(s,o,t))}createThread(e,t,r=[],i){if(this.threads.has(e))return this.threads.get(e);if(t){const o=this.relations.getAllChildEventsForEvent(t.getId());o!=null&&o.length&&(r=r.concat(o.filter(a=>!a.isRelation(on.Replace))))}const s=new Gr(e,t,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:this.cachedThreadReadReceipts.get(e)??[]});return this.reEmitter.reEmit(s,[Ro.Delete,Ro.Update,Ro.NewReply,"Room.timeline","Room.timelineReset"]),this.cachedThreadReadReceipts.delete(e),this.threads.set(s.id,s),s.addEvents(r,!1),this.threadsReady&&s.initialEventsFetched&&this.updateThreadRootEvents(s,i,!1),this.emit(Ro.New,s,i),s}processLiveEvent(e){if(this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId){for(const[r,i]of this.txnToEvent)if(i.getId()===e.getId()){O.debug("processLiveEvent: found sent event without txn ID: ",r,e.getId());const s=e.getUnsigned();s.transaction_id=r,e.setUnsigned(s);break}}}addLiveEvent(e,t){const{duplicateStrategy:r,timelineWasEmpty:i,fromCache:s,addToState:o}=t;for(const a of this.timelineSets)a.addLiveEvent(e,{duplicateStrategy:r,fromCache:s,timelineWasEmpty:i,addToState:o});e.sender&&e.getType()!==ie.RoomRedaction&&this.addReceipt(Xj(e.sender.userId,e,li.Read),!0)}addPendingEvent(e,t){if(e.status!==nt.SENDING&&e.status!==nt.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(t))throw new Error("addPendingEvent called on an event with known txnId "+t);if($e.setEventMetadata(e,this.getLiveTimeline().getState($e.FORWARDS),!1),this.txnToEvent.set(t,e),this.pendingEventList){if(this.pendingEventList.some(r=>r.status===nt.NOT_SENT)&&(O.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(nt.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){const r=e.event.redacts;let i=this.pendingEventList.find(s=>s.getId()===r);!i&&r&&(i=this.findEventById(r)),i&&(i.markLocallyRedacted(e),this.emit("Room.redaction",e,this,i.threadRootId))}}else for(const r of this.timelineSets)r.getFilter()?r.getFilter().filterRoomTimeline([e]).length&&r.addEventToTimeline(e,r.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):r.addEventToTimeline(e,r.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit("Room.localEchoUpdated",e,this)}savePendingEvents(){if(this.pendingEventList){const e=this.pendingEventList.map(t=>({...t.event,txn_id:t.getTxnId()})).filter(t=>{const r=t.type===ie.RoomMessageEncrypted,i=this.hasEncryptionStateEvent();return r||!i});this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,t){const r=t.getId(),i=e.getId(),s=t.status;O.debug(`Got remote echo for event ${r} -> ${i} old status ${s}`),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(r),t.handleRemoteEcho(e.event);const{shouldLiveInRoom:o,threadId:a}=this.eventShouldLiveIn(e),c=a?this.getThread(a):null;if(c==null||c.setEventMetadata(t),c==null||c.timelineSet.handleRemoteEcho(t,r,i),o)for(const l of this.timelineSets)l.handleRemoteEcho(t,r,i);this.emit("Room.localEchoUpdated",t,this,r,s)}updatePendingEvent(e,t,r){if(O.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${r}`),t==nt.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==nt.SENT&&this.getTimelineForEvent(r)){const c=this.findEventById(r);if(!(c==null?void 0:c.getUnsigned().transaction_id)&&c){const u=c.getUnsigned();u.transaction_id=e.getTxnId(),c.setUnsigned(u),this.removeEvent(c.getId()),this.handleRemoteEcho(c,e)}return}const i=e.status,s=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const o=Zie[i];if(!(o!=null&&o.includes(t)))throw new Error(`Invalid EventStatus transition ${i}->${t}`);if(e.setStatus(t),t==nt.SENT){e.replaceLocalEventId(r);const{shouldLiveInRoom:a,threadId:c}=this.eventShouldLiveIn(e),l=c?this.getThread(c):void 0;if(l==null||l.setEventMetadata(e),l==null||l.timelineSet.replaceEventId(s,r),a)for(const u of this.timelineSets)u.replaceEventId(s,r)}else if(t==nt.CANCELLED){if(this.pendingEventList){const a=this.getPendingEvent(s);this.removePendingEvent(s),a!=null&&a.isRedaction()&&this.revertRedactionLocalEcho(a)}this.removeEvent(s)}this.savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,s,i)}revertRedactionLocalEcho(e){const t=e.event.redacts;if(!t)return;const r=this.getUnfilteredTimelineSet().findEventById(t);r&&(r.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}assertTimelineSetsAreLive(){for(let e=0;e<this.timelineSets.length;e++){const t=this.timelineSets[e].getLiveTimeline();if(t.getPaginationToken($e.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+t.getPaginationToken($e.FORWARDS)+")");if(t.getNeighbouringTimeline($e.FORWARDS))throw new Error(`live timeline ${e} is no longer live - it has a neighbouring timeline`)}}async addLiveEvents(e,t){var h;const{duplicateStrategy:r,fromCache:i,timelineWasEmpty:s=!1,addToState:o}=t;if(r&&["replace","ignore"].indexOf(r)===-1)throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");this.assertTimelineSetsAreLive();const a=this.findThreadRoots(e),c={},l={duplicateStrategy:r,fromCache:i,timelineWasEmpty:s,addToState:o},u=[...e];for(const p of e){if(this.processLiveEvent(p),p.getUnsigned().transaction_id){const S=this.txnToEvent.get(p.getUnsigned().transaction_id);if(S){this.handleRemoteEcho(p,S);continue}}let{shouldLiveInRoom:m,shouldLiveInThread:v,threadId:g=""}=this.eventShouldLiveIn(p,u,a);if(!v&&!m&&p.isRelation())try{const S=new Ji(await this.client.fetchRoomEvent(this.roomId,p.relationEventId));if(u.push(S),S.threadRootId){a.add(S.threadRootId);const b=p.getUnsigned();b[Eb.name]=S.threadRootId,p.setUnsigned(b)}({shouldLiveInRoom:m,shouldLiveInThread:v,threadId:g=""}=this.eventShouldLiveIn(p,u,a))}catch(S){O.error("Failed to load parent event of unhandled relation",S)}v&&!c[g]&&(c[g]=[]),(h=c[g])==null||h.push(p),m?this.addLiveEvent(p,l):!v&&p.isRelation()&&this.relations.aggregateChildEvent(p)}Object.entries(c).forEach(([p,m])=>{this.addThreadedEvents(p,m,!1)})}partitionThreadedEvents(e){if(this.client.supportsThreads()){const s=this.findThreadRoots(e);return e.reduce((o,a)=>{const{shouldLiveInRoom:c,shouldLiveInThread:l,threadId:u}=this.eventShouldLiveIn(a,e,s);return c&&o[0].push(a),l&&(a.setThreadId(u??""),o[1].push(a)),!l&&!c&&o[2].push(a),o},[[],[],[]])}else return[e,[],[]]}findThreadRoots(e){const t=new Set;for(const r of e){const i=r.threadRootId;i!=null&&t.add(i)}return t}addReceipt(e,t=!1){const r=e.getContent();this.roomReceipts.add(r,t),Object.keys(r).forEach(i=>{Object.keys(r[i]).forEach(s=>{Object.keys(r[i][s]).forEach(o=>{var h;const a=r[i][s][o],c=!a.thread_id||a.thread_id===ry,l=c?this:this.threads.get(a.thread_id??"");if(l){if(l.addReceiptToStructure(i,s,o,a,t),!t&&this.client.isInitialSyncComplete()&&o===this.client.getUserId()){const p=l.timeline[l.timeline.length-1];p&&i===p.getId()&&o===p.getSender()&&(l.setUnread("total",0),l.setUnread("highlight",0))}}else this.cachedThreadReadReceipts.set(a.thread_id,[...this.cachedThreadReadReceipts.get(a.thread_id)??[],{eventId:i,receiptType:s,userId:o,receipt:a,synthetic:t}]);const u=this.client.getUserId();o===u&&!c&&a.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=a.ts),!a.thread_id&&a.ts>(((h=this.unthreadedReceipts.get(o))==null?void 0:h.ts)??0)&&this.unthreadedReceipts.set(o,a)})})}),this.emit("Room.receipt",e,this)}addEphemeralEvents(e){for(const t of e)t.getType()===ie.Typing?this.currentState.setTypingEvent(t):t.getType()===ie.Receipt&&this.addReceipt(t)}removeEvents(e){for(const t of e)this.removeEvent(t)}removeEvent(e){let t=!1;for(const r of this.timelineSets){const i=r.removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),t=!0)}return t}recalculate(){const e=this.currentState.getStateEvents(ie.RoomMember,this.myUserId);if(e){const r=e.getContent().membership;this.updateMyMembership(r),r===ze.Invite&&(e.getUnsigned().invite_room_state||[]).forEach(s=>{this.currentState.getStateEvents(s.type,s.state_key)||this.currentState.setStateEvents([new Ji({type:s.type,state_key:s.state_key,content:s.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])})}const t=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=fre(this.name),this.summary=new Dj(this.roomId,{title:this.name}),t!==this.name&&this.emit("Room.name",this)}addTags(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)}addAccountData(e){for(const t of e){t.getType()==="m.tag"&&this.addTags(t);const r=t.getType(),i=this.accountData.get(r);this.accountData.set(r,t),this.emit("Room.accountData",t,this,i)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===ze.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(ie.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(ie.RoomMessage,this.myUserId))}canInvite(e){let t=this.getMyMembership()===ze.Join;const r=this.currentState.getStateEvents(ie.RoomPowerLevels,""),i=r&&r.getContent(),s=this.getMember(e);return i&&s&&i.invite>s.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){const e=this.currentState.getStateEvents(ie.RoomCreate,"");if(!e){this.getTypeWarning||(O.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0);return}return e.getContent()[wb]}isSpaceRoom(){return this.getType()===cd.Space}isCallRoom(){return this.getType()===cd.UnstableCall}isElementVideoRoom(){return this.getType()===cd.ElementVideo}findPredecessor(e=!1){const t=this.getLiveTimeline().getState($e.FORWARDS);return t?t.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){const t=this.client.roomNameGenerator(this.roomId,e);if(t!==null)return t}switch(e.type){case 2:return e.name;case 1:switch(e.subtype){case"Inviting":return`Inviting ${h5(e.names,e.count)}`;default:return h5(e.names,e.count)}case 0:return e.oldName?`Empty room (was ${e.oldName})`:"Empty room"}}calculateRoomName(e,t=!1){if(!t){const p=this.currentState.getStateEvents(ie.RoomName,"");if(p!=null&&p.getContent().name)return this.roomNameGenerator({type:2,name:p.getContent().name})}const r=this.getCanonicalAlias();if(r)return this.roomNameGenerator({type:2,name:r});const i=this.currentState.getJoinedMemberCount(),s=this.currentState.getInvitedMemberCount();let o=i+s-1;const a=this.getFunctionalMembers();let c=[];if(this.summaryHeroes)this.summaryHeroes.forEach(p=>{if(a.includes(p)){o--;return}const m=this.getMember(p);c.push(m?m.name:p)});else{let p=this.currentState.getMembers().filter(v=>v.userId!==e&&(v.membership===ze.Invite||v.membership===ze.Join));p=p.filter(({userId:v})=>a.includes(v)?(o--,!1):!0);const m=new Intl.Collator;p.sort((v,g)=>m.compare(v.userId,g.userId)),p=p.slice(0,5),c=p.map(v=>v.name)}if(o)return this.roomNameGenerator({type:1,names:c,count:o});if(this.getMyMembership()==ze.Join){const p=this.currentState.getStateEvents(ie.RoomThirdPartyInvite);if(p!=null&&p.length){const m=p.map(v=>v.getContent().display_name);return this.roomNameGenerator({type:1,subtype:"Inviting",names:m,count:m.length+1})}}let u=c;u.length||(u=this.currentState.getMembers().filter(p=>p.userId!==e&&p.membership!==ze.Invite&&p.membership!==ze.Join).map(p=>p.name));let h;return u.length&&(h=this.roomNameGenerator({type:1,names:u,count:u.length+1})),this.roomNameGenerator({type:0,oldName:h})}applyNewVisibilityEvent(e){const t=e.asVisibilityChange();if(!t)return;const r=e.getSender();if(!r||!(td.name&&this.currentState.maySendStateEvent(td.name,r)||td.altName&&this.currentState.maySendStateEvent(td.altName,r)))return;const s=this.visibilityEvents.get(t.eventId);if(s){let a=s.length-1;const c=Math.max(0,s.length-Jie);for(;a>=c&&!(s[a].getTs()<e.getTs());--a);a===-1?s.unshift(e):s.splice(a+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);const o=this.findEventById(t.eventId);o&&o.applyVisibilityEvent(t)}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");const t=e.getRelation(),r=t==null?void 0:t.event_id,i=this.visibilityEvents.get(r);if(!i)return;const s=i.findIndex(o=>o.getId()===e.getId());if(s!==-1&&(i.splice(s,1),s===i.length)){const o=this.findEventById(r);if(!o)return;if(s===0)this.visibilityEvents.delete(r),o.applyVisibilityEvent();else{const c=i[i.length-1].asVisibilityChange();if(!c)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(c)}}}applyPendingVisibilityEvents(e){const t=this.visibilityEvents.get(e.getId());if(!t||t.length==0)return;const r=t[t.length-1],i=r.asVisibilityChange();i&&(i.visible,!(r.getTs()<e.getTs())&&e.applyVisibilityEvent(i))}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,t){return this.roomReceipts.hasUserReadEvent(e,t)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);const t=this.getThreads().filter(r=>this.getThreadUnreadNotificationCount(r.id,"total")>0);for(const r of t)r.fixupNotifications(e)}compareEventOrdering(e,t){return oie(this,e,t)}hasEncryptionStateEvent(){var e;return!!((e=this.getLiveTimeline().getState($e.FORWARDS))!=null&&e.getStateEvents(ie.RoomEncryption,""))}};const Zie={[nt.ENCRYPTING]:[nt.SENDING,nt.NOT_SENT,nt.CANCELLED],[nt.SENDING]:[nt.ENCRYPTING,nt.QUEUED,nt.NOT_SENT,nt.SENT],[nt.QUEUED]:[nt.SENDING,nt.NOT_SENT,nt.CANCELLED],[nt.SENT]:[],[nt.NOT_SENT]:[nt.SENDING,nt.QUEUED,nt.CANCELLED],[nt.CANCELLED]:[]};var _$=(n=>(n[n.EmptyRoom=0]="EmptyRoom",n[n.Generated=1]="Generated",n[n.Actual=2]="Actual",n))(_$||{});function h5(n,e){const t=e-1;return n.length?n.length===1&&t<=1?n[0]:n.length===2&&t<=2?`${n[0]} and ${n[1]}`:t>1?`${n[0]} and ${t} others`:`${n[0]} and 1 other`:"Empty room"}var Vr=(n=>(n[n.Stable=0]="Stable",n[n.Unstable=1]="Unstable",n[n.Unsupported=2]="Unsupported",n))(Vr||{}),vs=(n=>(n.Thread="Thread",n.ThreadUnreadNotifications="ThreadUnreadNotifications",n.LoginTokenRequest="LoginTokenRequest",n.RelationBasedRedactions="RelationBasedRedactions",n.AccountDataDeletion="AccountDataDeletion",n.RelationsRecursion="RelationsRecursion",n.IntentionalMentions="IntentionalMentions",n))(vs||{});const Qie={Thread:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},ThreadUnreadNotifications:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},LoginTokenRequest:{unstablePrefixes:["org.matrix.msc3882"]},RelationBasedRedactions:{unstablePrefixes:["org.matrix.msc3912"]},AccountDataDeletion:{unstablePrefixes:["org.matrix.msc3391"]},RelationsRecursion:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},IntentionalMentions:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};async function ese(n){var t,r;const e=new Map;for(const[i,s]of Object.entries(Qie)){const o=((t=n.versions)==null?void 0:t.includes(s.matrixVersion||""))??!1,a=((r=s.unstablePrefixes)==null?void 0:r.every(c=>{var l;return((l=n.unstable_features)==null?void 0:l[c])===!0}))??!1;o?e.set(i,0):a?e.set(i,1):e.set(i,2)}return e}const f5=80*1e3,tse=3;var Lr=(n=>(n.Error="ERROR",n.Prepared="PREPARED",n.Stopped="STOPPED",n.Syncing="SYNCING",n.Catchup="CATCHUP",n.Reconnecting="RECONNECTING",n))(Lr||{});const nse=["org.matrix.msc2716v3"];function p5(n,e){return`FILTER_SYNC_${n}`+(e?"_"+e:"")}function Sn(...n){O.log(...n)}var b$=(n=>(n.Offline="offline",n.Online="online",n.Unavailable="unavailable",n))(b$||{});function S$(n){return{initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:30*1e3,pendingEventOrdering:Rd.Chronological,threadSupport:!1,...n}}function w$(n){return{canResetEntireTimeline:e=>!1,...n}}class nd{constructor(e,t,r){this.client=e,this._peekRoom=null,this.syncState=null,this.catchingUp=!1,this.running=!1,this.notifEvents=[],this.failedSyncCount=0,this.storeIsInvalid=!1,this.getPushRules=async()=>{try{Sn("Getting push rules...");const i=await this.client.getPushRules();Sn("Got push rules"),this.client.pushRules=i}catch(i){return O.error("Getting push rules failed",i),this.shouldAbortSync(i)?void 0:(Sn("Waiting for saved sync before retrying push rules..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,i),this.getPushRules())}},this.buildDefaultFilter=()=>{const i=new ys(this.client.credentials.userId);return this.client.canSupport.get(vs.ThreadUnreadNotifications)!==Vr.Unsupported&&i.setUnreadThreadNotifications(!0),i},this.prepareLazyLoadingForSync=async()=>{Sn("Prepare lazy loading for sync..."),this.client.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(Sn("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=this.buildDefaultFilter()),this.opts.filter.setLazyLoadMembers(!0))},this.storeClientOptions=async()=>{try{Sn("Storing client options..."),await this.client.storeClientOptions(),Sn("Stored client options")}catch(i){throw O.error("Storing client options failed",i),i}},this.getFilter=async()=>{Sn("Getting filter...");let i;this.opts.filter?i=this.opts.filter:i=this.buildDefaultFilter();let s;try{s=await this.client.getOrCreateFilter(p5(this.client.credentials.userId),i)}catch(o){return O.error("Getting filter failed",o),this.shouldAbortSync(o)?{}:(Sn("Waiting for saved sync before retrying filter..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,o),this.getFilter())}return{filter:i,filterId:s}},this.onOnline=()=>{Sn("Browser thinks we are back online"),this.startKeepAlives(0)},this.opts=S$(t),this.syncOpts=w$(r),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[Je.Timeline,Je.TimelineReset])}createRoom(e){const t=E$(this.client,e,this.opts);return t.on(kt.Marker,(r,i)=>{this.onMarkerStateEvent(t,r,i)}),t}onMarkerStateEvent(e,t,{timelineWasEmpty:r}={}){if(r){O.debug(`MarkerState: Ignoring markerEventId=${t.getId()} in roomId=${e.roomId} because the timeline was empty before the marker arrived which means there is nothing to refresh.`);return}nse.includes(e.getVersion())||t.getSender()===e.getCreator()?(O.debug(`MarkerState: Timeline needs to be refreshed because a new markerEventId=${t.getId()} was sent in roomId=${e.roomId}`),e.setTimelineNeedsRefresh(!0),e.emit(Je.HistoryImportedWithinTimeline,t,e)):O.debug(`MarkerState: Ignoring markerEventId=${t.getId()} in roomId=${e.roomId} because MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.`)}async syncLeftRooms(){var l;const e=this.client,t=new ys(this.client.credentials.userId);t.setTimelineLimit(1),t.setIncludeLeaveRooms(!0);const r=this.opts.pollTimeout+f5,s={timeout:0,filter:await e.getOrCreateFilter(p5(e.credentials.userId,"LEFT_ROOMS"),t),"org.matrix.msc4222.use_state_after":!0},o=await e.http.authedRequest(de.Get,"/sync",s,void 0,{localTimeoutMs:r});let a=[];return(l=o.rooms)!=null&&l.leave&&(a=this.mapSyncResponseToRoomArray(o.rooms.leave)),(await Promise.all(a.map(async u=>{const h=u.room;if(!u.isBrandNewRoom)return;u.timeline=u.timeline||{prev_batch:null,events:[]},h.getLiveTimeline().setPaginationToken(u.timeline.prev_batch,$e.BACKWARDS);const{timelineEvents:p}=await this.mapAndInjectRoomEvents(u);return h.recalculate(),e.store.storeRoom(h),e.emit(qe.Room,h),this.processEventsForNotifs(h,p),h}))).filter(Boolean)}peek(e,t=20){var i;if(((i=this._peekRoom)==null?void 0:i.roomId)===e)return Promise.resolve(this._peekRoom);const r=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,t).then(s=>{var l;if(((l=this._peekRoom)==null?void 0:l.roomId)!==e)throw new Error("Peeking aborted");s.messages=s.messages||{chunk:[]},s.messages.chunk=s.messages.chunk||[],s.state=s.state||[];const o=rw(s.state).map(r.getEventMapper()),a=s.state.map(r.getEventMapper()),c=s.messages.chunk.map(r.getEventMapper());return Array.isArray(s.presence)&&s.presence.map(r.getEventMapper()).forEach(function(u){let h=r.store.getUser(u.getContent().user_id);h?h.setPresenceEvent(u):(h=_c.createUser(u.getContent().user_id,r),h.setPresenceEvent(u),r.store.storeUser(h)),r.emit(qe.Event,u)}),s.messages.start&&(this._peekRoom.oldState.paginationToken=s.messages.start),this._peekRoom.oldState.setStateEvents(o),this._peekRoom.currentState.setStateEvents(a),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(c.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),s.messages.start),r.store.storeRoom(this._peekRoom),r.emit(qe.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(e,t){var r;if(this._peekRoom!==e){Sn("Stopped peeking in room %s",e.roomId);return}this.client.http.authedRequest(de.Get,"/events",{room_id:e.roomId,timeout:String(30*1e3),from:t},void 0,{localTimeoutMs:50*1e3,abortSignal:(r=this.abortController)==null?void 0:r.signal}).then(async i=>{if(this._peekRoom!==e){Sn("Stopped peeking in room %s",e.roomId);return}i.chunk.filter(function(o){return o.type==="m.presence"}).map(this.client.getEventMapper()).forEach(o=>{let a=this.client.store.getUser(o.getContent().user_id);a?a.setPresenceEvent(o):(a=_c.createUser(o.getContent().user_id,this.client),a.setPresenceEvent(o),this.client.store.storeUser(a)),this.client.emit(qe.Event,o)});const s=i.chunk.filter(function(o){return o.room_id===e.roomId&&o.event_id}).map(this.client.getEventMapper());await e.addLiveEvents(s,{addToState:!0}),this.peekPoll(e,i.end)},i=>{O.error("[%s] Peek poll failed: %s",e.roomId,i),setTimeout(()=>{this.peekPoll(e,t)},30*1e3)})}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData??null}async recoverFromSyncStartupError(e,t){await e;const r=this.startKeepAlives();this.updateSyncState("ERROR",{error:t}),await r}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(O.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState("ERROR",{error:e}),!0):!1}async sync(){var i,s;if(this.running=!0,this.abortController=new AbortController,(s=(i=globalThis.window)==null?void 0:i.addEventListener)==null||s.call(i,"online",this.onOnline,!1),this.client.isGuest())return this.doSync({});Sn("Getting saved sync token...");const e=this.client.store.getSavedSyncToken().then(o=>(Sn("Got saved sync token"),o));this.savedSyncPromise=this.client.store.getSavedSync().then(o=>{if(Sn(`Got reply from saved sync, exists? ${!!o}`),o)return this.syncFromCache(o)}).catch(o=>{O.error("Getting saved sync failed",o)}),await this.getPushRules(),await this.prepareLazyLoadingForSync(),await this.storeClientOptions();const{filterId:t,filter:r}=await this.getFilter();if(r){if(this.client.resetNotifTimelineSet(),!this.currentSyncRequest){let o=t;const a=await e;if(a)Sn("Sending first sync request...");else{Sn("Sending initial sync request...");const c=this.buildDefaultFilter();c.setDefinition(r.getDefinition()),c.setTimelineLimit(this.opts.initialSyncLimit),o=JSON.stringify(c.getDefinition())}this.currentSyncRequest=this.doSyncRequest({filter:o},a)}return Sn("Waiting for saved sync before starting sync processing..."),await this.savedSyncPromise,this.doSync({filter:t})}}stop(){var e,t,r;Sn("SyncApi.stop"),(t=(e=globalThis.window)==null?void 0:e.removeEventListener)==null||t.call(e,"online",this.onOnline,!1),this.running=!1,(r=this.abortController)==null||r.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return this.connectionReturnedDefer?(this.startKeepAlives(0),!0):!1}async syncFromCache(e){Sn("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const r={nextSyncToken:t,catchingUp:!1,fromCache:!0},i={next_batch:t,rooms:e.roomsData,account_data:{events:e.accountData}};try{await this.processSyncResponse(r,i)}catch(s){O.error("Error processing cached sync",s)}this.storeIsInvalid||this.updateSyncState("PREPARED",r)}async doSync(e){for(;this.running;){const t=this.client.store.getSyncToken();let r;try{this.currentSyncRequest||(this.currentSyncRequest=this.doSyncRequest(e,t)),r=await this.currentSyncRequest}catch(s){if(await this.onSyncError(s))return;continue}finally{this.currentSyncRequest=void 0}this.client.store.setSyncToken(r.next_batch),this.failedSyncCount=0;const i={oldSyncToken:t??void 0,nextSyncToken:r.next_batch,catchingUp:this.catchingUp};try{await this.processSyncResponse(i,r)}catch(s){O.error("Caught /sync error",s),this.client.emit(qe.SyncUnexpectedError,s)}await this.client.store.setSyncData(r),i.catchingUp=this.catchingUp,e.hasSyncedBefore||(this.updateSyncState("PREPARED",i),e.hasSyncedBefore=!0),this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.onSyncCompleted(i),this.updateSyncState("SYNCING",i),this.client.store.wantsSave()&&await this.client.store.save()}this.running||(Sn("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState("STOPPED"))}doSyncRequest(e,t){var i;const r=this.getSyncParams(e,t);return this.client.http.authedRequest(de.Get,"/sync",r,void 0,{localTimeoutMs:r.timeout+f5,abortSignal:(i=this.abortController)==null?void 0:i.signal})}getSyncParams(e,t){let r=this.opts.pollTimeout;(this.getSyncState()!=="SYNCING"||this.catchingUp)&&(this.catchingUp=!0,r=0);let i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());const s={filter:i,timeout:r,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?s.set_presence="offline":this.presence!==void 0&&(s.set_presence=this.presence),t?s.since=t:s._cacheBuster=Date.now(),["RECONNECTING","ERROR"].includes(this.getSyncState())&&(s.timeout=0),s}setPresence(e){this.presence=e}async onSyncError(e){if(!this.running)return Sn("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState("STOPPED"),!0;if(O.error("/sync error %s",e),this.shouldAbortSync(e))return!0;this.failedSyncCount++,O.log("Number of consecutive failed sync requests:",this.failedSyncCount),Sn("Starting keep-alive");const t=this.startKeepAlives();return this.currentSyncRequest=void 0,this.updateSyncState(this.failedSyncCount>=tse?"ERROR":"RECONNECTING",{error:e}),await t&&this.getSyncState()==="ERROR"&&this.updateSyncState("CATCHUP",{catchingUp:!0}),!1}async processSyncResponse(e,t){var c,l,u;const r=this.client;if(Array.isArray((c=t.presence)==null?void 0:c.events)&&t.presence.events.filter(Po).map(r.getEventMapper()).forEach(function(h){let p=r.store.getUser(h.getSender());p?p.setPresenceEvent(h):(p=_c.createUser(h.getSender(),r),p.setPresenceEvent(h),r.store.storeUser(p)),r.emit(qe.Event,h)}),Array.isArray((l=t.account_data)==null?void 0:l.events)){const h=t.account_data.events.filter(Po).map(r.getEventMapper()),p=h.reduce((m,v)=>(m[v.getType()]=r.store.getAccountData(v.getType()),m),{});r.store.storeAccountDataEvents(h),h.forEach(function(m){if(m.getType()===ie.PushRules){const g=m.getContent();r.setPushRules(g)}const v=p[m.getType()];return r.emit(qe.AccountData,m,v),m})}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){let h=t.to_device.events.filter(Po);this.syncOpts.cryptoCallbacks&&(h=await this.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(h));const p=[];h.map(C$).map(m=>{if(m.getType()==="m.key.verification.cancel"){const v=m.getContent().transaction_id;v&&p.push(v)}return m}).forEach(function(m){const v=m.getContent();if(m.getType()=="m.room.message"&&v.msgtype=="m.bad.encrypted"){O.log("Ignoring undecryptable to-device event from "+m.getSender());return}if(m.getType()==="m.key.verification.start"||m.getType()==="m.key.verification.request"){const g=v.transaction_id;p.includes(g)&&m.flagCancelled()}r.emit(qe.ToDeviceEvent,m)})}else this.catchingUp=!1;let i=[],s=[],o=[],a=[];t.rooms&&(t.rooms.invite&&(i=this.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(s=this.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(o=this.mapSyncResponseToRoomArray(t.rooms.leave)),t.rooms.knock&&(a=this.mapSyncResponseToRoomArray(t.rooms.knock))),this.notifEvents=[],await af(i,async h=>{const p=h.room,m=this.mapSyncEventsFormat(h.invite_state,p);await this.injectRoomEvents(p,m,void 0),h.isBrandNewRoom?(p.recalculate(),r.store.storeRoom(p),r.emit(qe.Room,p)):p.recalculate(),m.forEach(function(v){r.emit(qe.Event,v)})}),await af(s,async h=>{const p=h.room,m=this.mapSyncEventsFormat(h.state,p),v=this.mapSyncEventsFormat(h["org.matrix.msc4222.state_after"],p),g=this.mapSyncEventsFormat(h.timeline,p,!1),S=this.mapSyncEventsFormat(h.ephemeral),b=this.mapSyncEventsFormat(h.account_data),R=h["org.matrix.msc4222.state_after"]?v:m.concat(g),k=this.isRoomEncrypted(p,R);h.unread_notifications&&((!k||h.unread_notifications.notification_count===0)&&p.setUnreadNotificationCount(sr.Total,h.unread_notifications.notification_count??0),(!k||p.getUnreadNotificationCount(sr.Highlight)<=0)&&p.setUnreadNotificationCount(sr.Highlight,h.unread_notifications.highlight_count??0));const I=h[iv.name]??h[iv.altName];if(I){p.resetThreadUnreadNotificationCountFromSync(Object.keys(I));for(const[C,P]of Object.entries(I)){(!k||P.notification_count===0)&&p.setThreadUnreadNotificationCount(C,sr.Total,P.notification_count??0);const M=p.getThreadUnreadNotificationCount(C,sr.Highlight)<=0;(!k||k&&M)&&p.setThreadUnreadNotificationCount(C,sr.Highlight,P.highlight_count??0)}}else p.resetThreadUnreadNotificationCountFromSync();if(h.timeline=h.timeline||{},h.isBrandNewRoom)h.timeline.prev_batch!==null&&p.getLiveTimeline().setPaginationToken(h.timeline.prev_batch,$e.BACKWARDS);else if(h.timeline.limited){let C=!0;for(let P=g.length-1;P>=0;P--){const M=g[P].getId();if(p.getTimelineForEvent(M)){Sn(`Already have event ${M} in limited sync - not resetting`),C=!1,g.splice(0,P);break}}C&&(p.resetLiveTimeline(h.timeline.prev_batch,this.syncOpts.canResetEntireTimeline(p.roomId)?null:e.oldSyncToken??null),r.resetNotifTimelineSet())}if(this.syncOpts.cryptoCallbacks)for(const C of R)C.isState()&&C.getType()===ie.RoomEncryption&&C.getStateKey()===""&&await this.syncOpts.cryptoCallbacks.onCryptoEvent(p,C);try{"org.matrix.msc4222.state_after"in h?await this.injectRoomEvents(p,void 0,v,g,e.fromCache):await this.injectRoomEvents(p,m,void 0,g,e.fromCache)}catch(C){O.error(`Failed to process events on room ${p.roomId}:`,C)}h.summary&&p.setSummary(h.summary),p.addEphemeralEvents(S),p.addAccountData(b),p.recalculate(),h.isBrandNewRoom&&(r.store.storeRoom(p),r.emit(qe.Room,p)),this.processEventsForNotifs(p,g);const T=C=>r.emit(qe.Event,C);m.forEach(T),g.forEach(T),S.forEach(T),b.forEach(T),p.decryptCriticalEvents()}),await af(o,async h=>{const p=h.room,{timelineEvents:m,stateEvents:v,stateAfterEvents:g}=await this.mapAndInjectRoomEvents(h),S=this.mapSyncEventsFormat(h.account_data);p.addAccountData(S),p.recalculate(),h.isBrandNewRoom&&(r.store.storeRoom(p),r.emit(qe.Room,p)),this.processEventsForNotifs(p,m),v==null||v.forEach(function(b){r.emit(qe.Event,b)}),g==null||g.forEach(function(b){r.emit(qe.Event,b)}),m.forEach(function(b){r.emit(qe.Event,b)}),S.forEach(function(b){r.emit(qe.Event,b)})}),await af(a,async h=>{const p=h.room,m=this.mapSyncEventsFormat(h.knock_state,p);await this.injectRoomEvents(p,m,void 0),h.isBrandNewRoom?(p.recalculate(),r.store.storeRoom(p),r.emit(qe.Room,p)):p.recalculate(),m.forEach(function(v){r.emit(qe.Event,v)})}),e.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort(function(h,p){return h.getTs()-p.getTs()}),this.notifEvents.forEach(function(h){var p;(p=r.getNotifTimelineSet())==null||p.addLiveEvent(h,{addToState:!0})})),t.device_lists&&this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.processDeviceLists(t.device_lists),await((u=this.syncOpts.cryptoCallbacks)==null?void 0:u.processKeyCounts(t.device_one_time_keys_count,t.device_unused_fallback_key_types??t["org.matrix.msc2732.device_unused_fallback_key_types"]))}startKeepAlives(e){return e===void 0&&(e=2e3+Math.floor(Math.random()*5e3)),this.keepAliveTimer!==null&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=Xl()),this.connectionReturnedDefer.promise}pokeKeepAlive(e=!1){var r;if(!this.running){clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject("SyncApi.stop() was called"),this.connectionReturnedDefer=void 0);return}const t=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(e),this.connectionReturnedDefer=void 0)};this.client.http.request(de.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15*1e3,abortSignal:(r=this.abortController)==null?void 0:r.signal}).then(()=>{t()},i=>{i.httpStatus==400||i.httpStatus==404?this.keepAliveTimer=setTimeout(t,2e3):(e=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,e),5e3+Math.floor(Math.random()*5e3)),this.updateSyncState("ERROR",{error:i}))})}mapSyncResponseToRoomArray(e){const t=this.client;return Object.keys(e).filter(r=>!Tg(r)).map(r=>{let i=t.store.getRoom(r),s=!1;return i||(i=this.createRoom(r),s=!0),{...e[r],room:i,isBrandNewRoom:s}})}mapSyncEventsFormat(e,t,r=!0){if(!e||!Array.isArray(e.events))return[];const i=this.client.getEventMapper({decrypt:r});return e.events.filter(Po).map(function(s){return t&&(s.room_id=t.roomId),i(s)})}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership(ze.Invite).forEach(function(r){if(r.requestedProfileInfo)return;r.requestedProfileInfo=!0;const i=t.getUser(r.userId);let s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=t.getProfileInfo(r.userId),s.then(function(o){const a=r.events.member;(a==null?void 0:a.getContent().membership)===ze.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})})}findEncryptionEvent(e){return e==null?void 0:e.find(t=>t.getType()===ie.RoomEncryption&&t.getStateKey()==="")}isRoomEncrypted(e,t){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(t)}async mapAndInjectRoomEvents(e){const t=this.mapSyncEventsFormat(e.state,e.room),r=this.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),i=this.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?await this.injectRoomEvents(e.room,void 0,r,i):await this.injectRoomEvents(e.room,t,void 0,i),{timelineEvents:i,stateEvents:t,stateAfterEvents:r}}async injectRoomEvents(e,t,r,i,s=!1){const o=r??t,a=e.getLiveTimeline(),c=a.getEvents().length==0;if(c){for(const l of o)this.client.getPushActionsForEvent(l);a.initialiseState(o,{timelineWasEmpty:c})}this.resolveInvites(e),e.recalculate(),c||(e.oldState.setStateEvents(o),e.currentState.setStateEvents(o)),await e.addLiveEvents(i||[],{fromCache:s,timelineWasEmpty:c,addToState:r===void 0}),this.client.processBeaconEvents(e,i)}processEventsForNotifs(e,t){var r;if(this.client.getNotifTimelineSet())for(const i of t){const s=this.client.getPushActionsForEvent(i);s!=null&&s.notify&&((r=s.tweaks)!=null&&r.highlight)&&this.notifEvents.push(i)}}getGuestFilter(){return"{}"}updateSyncState(e,t){const r=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(qe.Sync,this.syncState,r,t)}}function E$(n,e,t){const{timelineSupport:r}=n,i=new dw(e,n,n.getUserId(),{lazyLoadMembers:t.lazyLoadMembers,pendingEventOrdering:t.pendingEventOrdering,timelineSupport:r});return n.reEmitter.reEmit(i,[Je.Name,Je.Redaction,Je.RedactionCancelled,Je.Receipt,Je.Tags,Je.LocalEchoUpdated,Je.AccountData,Je.MyMembership,Je.Timeline,Je.TimelineReset,kt.Events,kt.Members,kt.NewMember,kt.Update,qn.New,qn.Update,qn.Destroy,qn.LivenessChange]),i.on(kt.NewMember,(s,o,a)=>{a.user=n.getUser(a.userId)??void 0,n.reEmitter.reEmit(a,[Fo.Name,Fo.Typing,Fo.PowerLevel,Fo.Membership])}),i}function C$(n){return delete n.room_id,new Ji(n)}class rse{constructor(){this.accountData=new Map,this.fromToken=null}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}setUserCreator(e){}storeEvents(e,t,r,i){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}async getPendingEvents(e){return[]}setPendingEvents(e,t){return Promise.resolve()}async saveToDeviceBatches(e){return Promise.resolve()}getOldestToDeviceBatch(){return Promise.resolve(null)}async removeToDeviceBatch(e){return Promise.resolve()}async destroy(){}}const Br=[];for(let n=0;n<256;++n)Br.push((n+256).toString(16).slice(1));function ise(n,e=0){return(Br[n[e+0]]+Br[n[e+1]]+Br[n[e+2]]+Br[n[e+3]]+"-"+Br[n[e+4]]+Br[n[e+5]]+"-"+Br[n[e+6]]+Br[n[e+7]]+"-"+Br[n[e+8]]+Br[n[e+9]]+"-"+Br[n[e+10]]+Br[n[e+11]]+Br[n[e+12]]+Br[n[e+13]]+Br[n[e+14]]+Br[n[e+15]]).toLowerCase()}let LT;const sse=new Uint8Array(16);function ose(){if(!LT){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");LT=crypto.getRandomValues.bind(crypto)}return LT(sse)}const ase=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),m5={randomUUID:ase};function cse(n,e,t){var i;if(m5.randomUUID&&!n)return m5.randomUUID();n=n||{};const r=n.random??((i=n.rng)==null?void 0:i.call(n))??ose();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ise(r)}var yo={},AT={},MT={exports:{}},g5;function yP(){if(g5)return MT.exports;g5=1;var n=MT.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),MT.exports}var v5;function lse(){return v5||(v5=1,function(n){var e=function(a){return String(Number(a))===a?Number(a):a},t=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},r=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:u?c[a.name]:c;t(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},i=yP(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var p=h[0],m=h.slice(2);p==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var v=0;v<(i[p]||[]).length;v+=1){var g=i[p][v];if(g.reg.test(m))return r(g,u,m)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};n.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(a){return a.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},n.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},n.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,h=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),h=!0),{scid:u,paused:h}})})}}(AT)),AT}var OT,y5;function use(){if(y5)return OT;y5=1;var n=yP(),e=/%[sdv%]/g,t=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var h=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},r=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var p=a.names[h];a.name?u.push(c[a.name][p]):u.push(c[a.names[h]])}else u.push(c[a.name]);return t.apply(null,u)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return OT=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||i,l=a.innerOrder||s,u=[];return c.forEach(function(h){n[h].forEach(function(p){p.name in o&&o[p.name]!=null?u.push(r(h,p,o)):p.push in o&&o[p.push]!=null&&o[p.push].forEach(function(m){u.push(r(h,p,m))})})}),o.media.forEach(function(h){u.push(r("m",n.m[0],h)),l.forEach(function(p){n[p].forEach(function(m){m.name in h&&h[m.name]!=null?u.push(r(p,m,h)):m.push in h&&h[m.push]!=null&&h[m.push].forEach(function(v){u.push(r(p,m,v))})})})}),u.join(`\r
`)+`\r
`},OT}var _5;function dse(){if(_5)return yo;_5=1;var n=lse(),e=use(),t=yP();return yo.grammar=t,yo.write=e,yo.parse=n.parse,yo.parseParams=n.parseParams,yo.parseFmtpConfig=n.parseFmtpConfig,yo.parsePayloads=n.parsePayloads,yo.parseRemoteCandidates=n.parseRemoteCandidates,yo.parseImageAttributes=n.parseImageAttributes,yo.parseSimulcastStreamList=n.parseSimulcastStreamList,yo}var WR=dse();function _P(n,e){if(typeof n.toBase64=="function")return n.toBase64(e);let t=btoa(n.reduce((r,i)=>r+String.fromCharCode(i),""));return e.omitPadding&&(t=t.replace(/={1,2}$/,"")),e.alphabet==="base64url"&&(t=t.replace(/\+/g,"-").replace(/\//g,"_")),t}function y_(n){return _P(n,{alphabet:"base64",omitPadding:!1})}function T$(n){return _P(n,{alphabet:"base64",omitPadding:!0})}function hw(n){return _P(n,{alphabet:"base64url",omitPadding:!0})}function hse(n,e){return typeof Uint8Array.fromBase64=="function"?Uint8Array.fromBase64(n,e):Uint8Array.from(atob(n),t=>t.charCodeAt(0))}function _f(n){return hse(n.replace(/-/g,"+").replace(/_/g,"/"),{alphabet:"base64",lastChunkHandling:"loose"})}const fse="abcdefghijklmnopqrstuvwxyz",pse="ABCDEFGHIJKLMNOPQRSTUVWXYZ",mse="0123456789";function I$(n){const e=new Uint8Array(n);return globalThis.crypto.getRandomValues(e),hw(e)}function Es(n){return gse(n,pse+fse+mse)}function gse(n,e){if(e.length<2||e.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(n<1||n>32768)throw new Error("Requested random string length must be between 1 and 32768");const t=256-256%e.length,r=new Uint8Array(Math.floor(n*1.3));let i=r.length;const s=[];for(;s.length<n;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);const o=r[i++];o<t&&s.push(e[o%e.length])}return s.join("")}const hl="org.matrix.msc3077.sdp_stream_metadata";var en=(n=>(n.Usermedia="m.usermedia",n.Screenshare="m.screenshare",n))(en||{});let rd=null,zR=0;const vse=()=>(rd===null&&(rd=new AudioContext),zR++,rd),yse=()=>{zR--,zR===0&&(rd==null||rd.close(),rd=null)},_se=200,YR=-60,bse=8;var R$=(n=>(n.NewStream="new_stream",n.MuteStateChanged="mute_state_changed",n.LocalVolumeChanged="local_volume_changed",n.VolumeChanged="volume_changed",n.ConnectedChanged="connected_changed",n.Speaking="speaking",n.Disposed="disposed",n))(R$||{});class dc extends Xn{constructor(e){super(),this.localVolume=1,this.measuringVolumeActivity=!1,this.speakingThreshold=YR,this.speaking=!1,this._disposed=!1,this._connected=!1,this.onAddTrack=()=>{this.emit("new_stream",this.stream)},this.onCallState=t=>{t===_s.Connected?this.connected=!0:t===_s.Connecting&&(this.connected=!1)},this.volumeLooper=()=>{if(!this.analyser||!this.measuringVolumeActivity)return;this.analyser.getFloatFrequencyData(this.frequencyBinCount);let t=-1/0;for(const i of this.frequencyBinCount)i>t&&(t=i);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(t),this.emit("volume_changed",t);let r=!1;for(const i of this.speakingVolumeSamples)if(i>this.speakingThreshold){r=!0;break}this.speaking!==r&&(this.speaking=r,this.emit("speaking",this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,_se)},this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(bse).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(Bi.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit("connected_changed",this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){if(t===e)return;const r=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),r&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit("new_stream",this.stream)}initVolumeMeasuring(){if(!this.hasAudioTrack)return;this.audioContext||(this.audioContext=vse()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount)}getMember(){const e=this.client.getRoom(this.roomId);return(e==null?void 0:e.getMember(this.userId))??null}isLocal(){return this.userId===this.client.getUserId()&&(this.deviceId===void 0||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return this.stream.getAudioTracks().length===0||this.audioMuted}isVideoMuted(){return this.stream.getVideoTracks().length===0||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,t){e!==null&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),t!==null&&(this.videoMuted=t),this.emit("mute_state_changed",this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit("volume_changed",-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){const e=this.client.getMediaHandler(),t=this.stream.clone();return O.log(`CallFeed clone() cloning stream (originalStreamId=${this.stream.id}, newStreamId${t.id})`),this.purpose===en.Usermedia?e.userMediaStreams.push(t):e.screensharingStreams.push(t),new dc({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:t,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,t;clearTimeout(this.volumeLooperTimeout),(e=this.stream)==null||e.removeEventListener("addtrack",this.onAddTrack),(t=this.call)==null||t.removeListener(Bi.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,yse()),this._disposed=!0,this.emit("disposed")}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit("local_volume_changed",e)}}const Sse=3e3;var XR=(n=>(n.Incoming="Call.incoming",n))(XR||{});class wse{constructor(e){this.nextSeqByCall=new Map,this.toDeviceEventBuffers=new Map,this.onSync=()=>{const t=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(t)):this.eventBufferPromiseChain=this.evaluateEventBuffer(t)},this.onRoomTimeline=t=>{this.callEventBuffer.push(t)},this.onToDeviceEvent=t=>{const r=t.getContent();if(!r.call_id){this.callEventBuffer.push(t);return}if(this.nextSeqByCall.has(r.call_id)||this.nextSeqByCall.set(r.call_id,0),r.seq===void 0){this.callEventBuffer.push(t);return}const i=this.nextSeqByCall.get(r.call_id)||0;if(r.seq!==i){this.toDeviceEventBuffers.has(r.call_id)||this.toDeviceEventBuffers.set(r.call_id,[]);const s=this.toDeviceEventBuffers.get(r.call_id),o=s.findIndex(a=>a.getContent().seq>r.seq);o===-1?s.push(t):s.splice(o,0,t)}else{const s=r.call_id;this.callEventBuffer.push(t),this.nextSeqByCall.set(s,r.seq+1);const o=this.toDeviceEventBuffers.get(s);let a=o&&o.shift();for(;a&&a.getContent().seq===this.nextSeqByCall.get(s);)this.callEventBuffer.push(a),this.nextSeqByCall.set(s,a.getContent().seq+1),a=o.shift()}},this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(qe.Sync,this.onSync),this.client.on(Je.Timeline,this.onRoomTimeline),this.client.on(qe.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(qe.Sync,this.onSync),this.client.removeListener(Je.Timeline,this.onRoomTimeline),this.client.removeListener(qe.ToDeviceEvent,this.onToDeviceEvent)}async evaluateEventBuffer(e){await Promise.all(e.map(i=>this.client.decryptEventIfNeeded(i)));const t=e.filter(i=>{const s=i.getType();return s.startsWith("m.call.")||s.startsWith("org.matrix.call.")}),r=new Set;for(const i of t){const s=i.getType();(s===ie.CallAnswer||s===ie.CallHangup)&&r.add(i.getContent().call_id)}for(const i of t){const s=i.getType(),o=i.getContent().call_id;if(!(s===ie.CallInvite&&r.has(o)))try{await this.handleCallEvent(i)}catch(a){O.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",a)}}}async handleCallEvent(e){var h,p,m;this.client.emit(qe.ReceivedVoipEvent,e);const t=e.getContent(),r=e.getRoomId()||((p=(h=this.client.groupCallEventHandler.getGroupCallById(t.conf_id))==null?void 0:h.room)==null?void 0:p.roomId),i=t.conf_id,s=e.getType(),o=e.getSender();let a=t.call_id?this.calls.get(t.call_id):void 0,c,l;if(i){if(l=this.client.groupCallEventHandler.getGroupCallById(i),!l){O.warn(`CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=${i}, type=${s})`);return}if(c=t.device_id,!c){O.warn(`CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=${o})`),l.emit(Ab.Error,new L$(o));return}if(t.dest_session_id!==this.client.getSessionId()){O.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring");return}}const u=o===this.client.credentials.userId&&(c===void 0||c===this.client.getDeviceId());if(r){if(s===ie.CallInvite){if(u||e.getLocalAge()>t.lifetime-Sse||a&&a.state===_s.Ended||(a&&O.warn(`CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=${t.call_id})`),t.invitee&&t.invitee!==this.client.getUserId()))return;const v=(this.client.getTurnServersExpiry()??0)-Date.now();if(O.info("CallEventHandler handleCallEvent() current turn creds expire in "+v+" ms"),a=av(this.client,r,{forceTURN:this.client.forceTURN,opponentDeviceId:c,groupCallId:i,opponentSessionId:t.sender_session_id})??void 0,!a){O.log(`CallEventHandler handleCallEvent() this client does not support WebRTC (callId=${t.call_id})`);return}a.callId=t.call_id;const g=l==null?void 0:l.getGroupCallStats();g&&a.initStats(g);try{await a.initWithInvite(e)}catch(b){b instanceof nc&&(b.code===P$.UnknownDevice?l==null||l.emit(Ab.Error,b):O.error(b))}if(this.calls.set(a.callId,a),this.candidateEventsByCall.get(a.callId))for(const b of this.candidateEventsByCall.get(a.callId))a.onRemoteIceCandidatesReceived(b);let S;for(const b of this.calls.values()){const R=[_s.WaitLocalMedia,_s.CreateOffer,_s.InviteSent].includes(b.state);if(a.roomId===b.roomId&&b.direction===A$.Outbound&&((m=a.getOpponentMember())==null?void 0:m.userId)===b.invitee&&R){S=b;break}}S?S.callId>a.callId?(O.log(`CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=${a.callId}, outgoingId=${S.callId})`),S.replacedBy(a)):(O.log(`CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=${a.callId}, outgoingId=${S.callId})`),a.hangup(tc.Replaced,!0)):this.client.emit("Call.incoming",a);return}else if(s===ie.CallCandidates){if(u)return;a?a.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e));return}else if([ie.CallHangup,ie.CallReject].includes(s)){a?a.state!==_s.Ended&&(s===ie.CallHangup?a.onHangupReceived(t):a.onRejectReceived(t),a.state===_s.Ended&&this.calls.delete(t.call_id)):(a=av(this.client,r,{opponentDeviceId:c,opponentSessionId:t.sender_session_id})??void 0,a&&(a.callId=t.call_id,a.initWithHangup(e),this.calls.set(t.call_id,a)));return}if(!a||!a.hasPeerConnection){O.info(`CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=${s})`);return}if(e.getContent().party_id!==a.ourPartyId)switch(s){case ie.CallAnswer:u?a.state===_s.Ringing&&a.onAnsweredElsewhere(t):a.onAnswerReceived(e);break;case ie.CallSelectAnswer:a.onSelectAnswerReceived(e);break;case ie.CallNegotiate:a.onNegotiateReceived(e);break;case ie.CallAssertedIdentity:case ie.CallAssertedIdentityPrefix:a.onAssertedIdentityReceived(e);break;case ie.CallSDPStreamMetadataChanged:case ie.CallSDPStreamMetadataChangedPrefix:a.onSDPStreamMetadataChangedReceived(e);break}}}}var JR=(n=>(n.Incoming="GroupCall.incoming",n.Outgoing="GroupCall.outgoing",n.Ended="GroupCall.ended",n.Participants="GroupCall.participants",n))(JR||{});class Ese{constructor(e){this.client=e,this.groupCalls=new Map,this.roomDeferreds=new Map,this.onRoomsChanged=t=>{this.createGroupCallForRoom(t)},this.onRoomStateChanged=(t,r)=>{if(t.getType()===ie.GroupCallPrefix){const s=t.getStateKey(),o=t.getContent(),a=this.groupCalls.get(r.roomId);!a&&!o["m.terminated"]&&!t.isRedacted()?this.createGroupCallFromRoomStateEvent(t):a&&a.groupCallId===s?o["m.terminated"]||t.isRedacted()?a.terminate(!1):o["m.type"]!==a.type&&O.warn(`GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=${r.roomId})`):a&&a.groupCallId!==s&&O.warn(`GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=${r.roomId})`)}}}async start(){this.client.getSyncState()!==Lr.Syncing&&(O.debug("GroupCallEventHandler start() waiting for client to start syncing"),await new Promise(t=>{const r=()=>{if(this.client.getSyncState()===Lr.Syncing)return this.client.off(qe.Sync,r),t()};this.client.on(qe.Sync,r)}));const e=this.client.getRooms();for(const t of e)this.createGroupCallForRoom(t);this.client.on(qe.Room,this.onRoomsChanged),this.client.on(kt.Events,this.onRoomStateChanged)}stop(){this.client.removeListener(qe.Room,this.onRoomsChanged),this.client.removeListener(kt.Events,this.onRoomStateChanged)}getRoomDeferred(e){let t=this.roomDeferreds.get(e);if(t===void 0){let r;t={prom:new Promise(i=>{r=i})},t.resolve=r,this.roomDeferreds.set(e,t)}return t}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find(t=>t.groupCallId===e)}createGroupCallForRoom(e){const t=e.currentState.getStateEvents(ie.GroupCallPrefix),r=t.sort((i,s)=>s.getTs()-i.getTs());for(const i of r)if(!(i.getContent()["m.terminated"]||i.isRedacted())){O.debug(`GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=${i.getStateKey()}, ts=${i.getTs()}, roomId=${e.roomId}, numOfPossibleCalls=${t.length})`),this.createGroupCallFromRoomStateEvent(i);break}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){const t=e.getRoomId(),r=e.getContent(),i=this.client.getRoom(t);if(!i){O.warn(`GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=${t})`);return}const s=e.getStateKey(),o=r["m.type"];if(!Object.values(fw).includes(o)){O.warn(`GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=${o}, roomId=${t})`);return}const a=r["m.intent"];if(!Object.values(bP).includes(a)){O.warn(`Received invalid group call intent (type=${o}, roomId=${t})`);return}const c=!!r["io.element.ptt"];let l;if(r!=null&&r.dataChannelsEnabled&&(r!=null&&r.dataChannelOptions)){const{ordered:h,maxPacketLifeTime:p,maxRetransmits:m,protocol:v}=r.dataChannelOptions;l={ordered:h,maxPacketLifeTime:p,maxRetransmits:m,protocol:v}}const u=new wP(this.client,i,o,c,a,s,(r==null?void 0:r.dataChannelsEnabled)||this.client.isVoipWithNoMediaAllowed,l,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,r["io.element.livekit_service_url"]);return this.groupCalls.set(i.roomId,u),this.client.emit("GroupCall.incoming",u),u}}class Cse{constructor(){this.bandwidth={},this.bitrate={},this.packetLoss={},this.transport=[]}}class Tse{static buildBandwidthReport(e){const t=e.availableIncomingBitrate,r=e.availableOutgoingBitrate;return{download:t?Math.round(t/1e3):0,upload:r?Math.round(r/1e3):0}}}class Ise{static buildReport(e,t,r,i){const s=e==null?void 0:e.get(t.localCandidateId),o=e==null?void 0:e.get(t.remoteCandidateId);if(o&&s){const a=o.ip!==void 0?o.ip:o.address,c=o.port,l=`${a}:${c}`,u=s.ip!==void 0?s.ip:s.address,h=s.port,p=`${u}:${h}`,m=o.protocol;r.some(v=>v.ip===l&&v.type===m&&v.localIp===p)||r.push({ip:l,type:m,localIp:p,isFocus:i,localCandidateType:s.candidateType,remoteCandidateType:o.candidateType,networkType:s.networkType,rtt:t.currentRoundTripTime?t.currentRoundTripTime*1e3:NaN})}return r}}class Rse{constructor(){this.ssrcToMid={local:new Map,remote:new Map}}findMidBySsrc(e,t){let r;return this.ssrcToMid[t].forEach((i,s)=>{if(i.find(o=>o==e)){r=s;return}}),r}parse(e,t){const r=WR.parse(e),i=new Map;r.media.forEach(s=>{var o;if(s.mid&&s.type==="video"||s.type==="audio"){const a=[];(o=s.ssrcs)==null||o.forEach(c=>{c.attribute==="cname"&&a.push(`${c.id}`)}),i.set(`${s.mid}`,a)}}),this.ssrcToMid[t]=i}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class kse{constructor(e){this.pc=e}getLocalTracks(e){const t=r=>r!==null&&r.kind===e;return this.pc.getTransceivers().filter(r=>r.currentDirection==="sendonly"||r.currentDirection==="sendrecv").filter(r=>r.sender!==null).map(r=>r.sender).map(r=>r.track).filter(t)}getTackById(e){return this.pc.getTransceivers().map(t=>{if((t==null?void 0:t.sender.track)!==null&&t.sender.track.id===e)return t.sender.track;if((t==null?void 0:t.receiver.track)!==null&&t.receiver.track.id===e)return t.receiver.track}).find(t=>t!==void 0)}getLocalTrackIdByMid(e){var r,i;const t=this.pc.getTransceivers().find(s=>s.mid===e);return(i=(r=t==null?void 0:t.sender)==null?void 0:r.track)==null?void 0:i.id}getRemoteTrackIdByMid(e){var r,i;const t=this.pc.getTransceivers().find(s=>s.mid===e);return(i=(r=t==null?void 0:t.receiver)==null?void 0:r.track)==null?void 0:i.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find(t=>t.receiver.track.id===e||t.sender.track!==null&&t.sender.track.id===e)}}class xse{constructor(e,t,r){this.trackId=e,this.type=t,this.kind=r,this.loss={packetsTotal:0,packetsLost:0,isDownloadStream:!1},this.bitrate={download:0,upload:0},this.resolution={width:-1,height:-1},this.audioConcealment={concealedAudio:0,totalAudioDuration:0},this.framerate=0,this.jitter=0,this.codec="",this.isAlive=!0,this.isMuted=!1,this.isEnabled=!0}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,t){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=t}getAudioConcealment(){return this.audioConcealment}}class Pse{constructor(e,t){this.mediaSsrcHandler=e,this.mediaTrackHandler=t,this.track2stats=new Map}findTrack2Stats(e,t){let r;if(e.trackIdentifier)r=e.trackIdentifier;else if(e.mid)r=t==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){if(!this.mediaSsrcHandler.findMidBySsrc(e.ssrc,t))return;r=t==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(!r)return;let i=this.track2stats.get(r);if(!i){const s=this.mediaTrackHandler.getTackById(r);if(s!==void 0){const o=s.kind==="audio"?s.kind:"video";i=new xse(r,t,o),this.track2stats.set(r,i)}else return}return i}findLocalVideoTrackStats(e){if(this.mediaTrackHandler.getLocalTracks("video").length!==0)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class Ku{static getNonNegativeValue(e){let t=e;return typeof t!="number"&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)}}class ms{static buildFramerateResolution(e,t){const r={height:t.frameHeight,width:t.frameWidth},i=t.framesPerSecond;r.height&&r.width&&e.setResolution(r),e.setFramerate(Math.round(i||0))}static calculateSimulcastFramerate(e,t,r,i){let s=e.getFramerate();if(!s){if(r){const o=t.timestamp-r.timestamp;o>0&&t.framesSent&&(s=(t.framesSent-r.framesSent)/o*1e3)}if(!s)return}s=i?Math.round(s/i):0,e.setFramerate(s)}static buildCodec(e,t,r){const i=e==null?void 0:e.get(r.codecId);if(i){const s=i.mimeType.split("/")[1];s&&t.setCodec(s)}}static buildBitrateReceived(e,t,r){e.setBitrate({download:ms.calculateBitrate(t.bytesReceived,r.bytesReceived,t.timestamp,r.timestamp),upload:0})}static buildBitrateSend(e,t,r){e.setBitrate({download:0,upload:this.calculateBitrate(t.bytesSent,r.bytesSent,t.timestamp,r.timestamp)})}static buildPacketsLost(e,t,r){const i=t.type==="outbound-rtp"?"packetsSent":"packetsReceived";let s=t[i];(!s||s<0)&&(s=0);const o=Ku.getNonNegativeValue(r[i]),a=Math.max(0,s-o),c=Ku.getNonNegativeValue(t.packetsLost),l=Ku.getNonNegativeValue(r.packetsLost),u=Math.max(0,c-l);e.setLoss({packetsTotal:a+u,packetsLost:u,isDownloadStream:t.type!=="outbound-rtp"})}static calculateBitrate(e,t,r,i){const s=Ku.getNonNegativeValue(e),o=Ku.getNonNegativeValue(t),a=Math.max(0,s-o),c=r-i;let l=0;return c>0&&(l=Math.round(a*8/c)),l}static setTrackStatsState(e,t){var i;if(t===void 0){e.alive=!1;return}const r=e.getType()==="remote"?t.receiver.track:(i=t==null?void 0:t.sender)==null?void 0:i.track;if(r==null){e.alive=!1;return}if(r.readyState==="ended"){e.alive=!1;return}e.muted=r.muted,e.enabled=r.enabled,e.alive=!0}static buildTrackSummary(e){const t={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},i=e.filter(o=>o.getType()==="remote"),s=i.filter(o=>o.kind==="audio");return i.forEach(o=>{var c,l;const a=o.kind==="video"?t:r;a.count++,o.alive&&o.muted&&a.muted++,a.maxJitter<o.getJitter()&&(a.maxJitter=o.getJitter()),a.maxPacketLoss<o.getLoss().packetsLost&&(a.maxPacketLoss=o.getLoss().packetsLost),s.length>0&&(a.concealedAudio+=(c=o.getAudioConcealment())==null?void 0:c.concealedAudio,a.totalAudio+=(l=o.getAudioConcealment())==null?void 0:l.totalAudioDuration)}),{audioTrackSummary:r,videoTrackSummary:t}}static buildJitter(e,t){if(t.type!=="inbound-rtp")return;const r=t==null?void 0:t.jitter;if(r!==void 0){const i=Ku.getNonNegativeValue(r);e.setJitter(Math.round(i*1e3))}else e.setJitter(-1)}static buildAudioConcealment(e,t){if(t.type!=="inbound-rtp")return;const i=1e3*(t==null?void 0:t.totalSamplesDuration)/(t==null?void 0:t.totalSamplesReceived)*(t==null?void 0:t.concealedSamples),s=1e3*(t==null?void 0:t.totalSamplesDuration);e.setAudioConcealment(i,s)}}class Rg{static build(e){const t={},r={download:0,upload:0},i={download:0,upload:0};let s=0,o=0;const a={local:new Map,remote:new Map},c={local:new Map,remote:new Map},l={local:new Map,remote:new Map},u=new Map,h=new Map;let p=0,m=0,v=0,g=0,S=0,b=0;for(const[R,k]of e){const I=k.getLoss(),T=I.isDownloadStream?"download":"upload";if(r[T]+=I.packetsTotal,i[T]+=I.packetsLost,s+=k.getBitrate().download,o+=k.getBitrate().upload,k.kind==="audio"){const C=k.getAudioConcealment();S+=C.concealedAudio,b+=C.totalAudioDuration,p+=k.getBitrate().download,m+=k.getBitrate().upload}else v+=k.getBitrate().download,g+=k.getBitrate().upload;a[k.getType()].set(R,k.getResolution()),c[k.getType()].set(R,k.getFramerate()),l[k.getType()].set(R,k.getCodec()),k.getType()==="remote"&&(u.set(R,k.getJitter()),k.kind==="audio"&&h.set(R,k.getAudioConcealment())),k.resetBitrate()}return t.bitrate={upload:o,download:s},t.bitrate.audio={upload:m,download:p},t.bitrate.video={upload:g,download:v},t.packetLoss={total:Rg.calculatePacketLoss(i.download+i.upload,r.download+r.upload),download:Rg.calculatePacketLoss(i.download,r.download),upload:Rg.calculatePacketLoss(i.upload,r.upload)},t.audioConcealment=h,t.totalAudioConcealment={concealedAudio:S,totalAudioDuration:b},t.framerate=c,t.resolution=a,t.codec=l,t.jitter=u,t}static calculatePacketLoss(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}}class Al{static buildCallFeedReport(e,t,r){const i=r.getTransceivers(),s=[],o=[];return i.forEach(a=>{var u;const c=(u=a.sender)!=null&&u.track?Al.buildTrackStats(a.sender.track,"sender"):null,l=Al.buildTrackStats(a.receiver.track,"receiver");s.push({mid:a.mid==null?"null":a.mid,direction:a.direction,currentDirection:a.currentDirection==null?"null":a.currentDirection,sender:c,receiver:l})}),{callId:e,opponentMemberId:t,transceiver:s,callFeeds:o}}static buildTrackStats(e,t="--"){var s,o;const r=(s=e.getSettings())==null?void 0:s.deviceId,i=(o=e.getConstraints())==null?void 0:o.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:r??"unknown",constrainDeviceId:i??"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:t}}static expandCallFeedReport(e,t,r="unknown"){return t.forEach(i=>{const s=i.stream.getAudioTracks(),o=i.stream.getVideoTracks(),a=s.length>0?Al.buildTrackStats(i.stream.getAudioTracks()[0],i.purpose):null,c=o.length>0?Al.buildTrackStats(i.stream.getVideoTracks()[0],i.purpose):null,l={stream:i.stream.id,type:i.isLocal()?"local":"remote",audio:a,video:c,purpose:i.purpose,prefix:r,isVideoMuted:i.isVideoMuted(),isAudioMuted:i.isAudioMuted()};e.callFeeds.push(l)}),e}}class Lse{constructor(e,t,r,i,s=!0){this.callId=e,this.opponentMemberId=t,this.pc=r,this.emitter=i,this.isFocus=s,this.isActive=!0,this.connectionStats=new Cse,r.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new Pse(new Rse,new kse(r))}async processStats(e,t){const r={isFirstCollection:this.previousStatsReport===void 0,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(this.isActive){const i=this.pc.getStats();if(typeof(i==null?void 0:i.then)=="function")return i.then(s=>{var a,c;this.currentStatsReport=typeof(s==null?void 0:s.result)=="function"?s.result():s;try{this.processStatsReport(e,t)}catch(l){return this.handleError(l),r}this.previousStatsReport=this.currentStatsReport,r.receivedMedia=this.connectionStats.bitrate.download,r.receivedAudioMedia=((a=this.connectionStats.bitrate.audio)==null?void 0:a.download)||0,r.receivedVideoMedia=((c=this.connectionStats.bitrate.video)==null?void 0:c.download)||0;const o=ms.buildTrackSummary(Array.from(this.trackStats.getTrack2stats().values()));return{...r,audioTrackSummary:o.audioTrackSummary,videoTrackSummary:o.videoTrackSummary}}).catch(s=>(this.handleError(s),r));this.isActive=!1}return Promise.resolve(r)}processStatsReport(e,t){var i;const r=new Map;r.callId=this.callId,r.opponentMemberId=this.opponentMemberId,(i=this.currentStatsReport)==null||i.forEach(s=>{const o=this.previousStatsReport?this.previousStatsReport.get(s.id):null;if(s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded")this.connectionStats.bandwidth=Tse.buildBandwidthReport(s),this.connectionStats.transport=Ise.buildReport(this.currentStatsReport,s,this.connectionStats.transport,this.isFocus);else if(s.type==="inbound-rtp"||s.type==="outbound-rtp"){const a=this.trackStats.findTrack2Stats(s,s.type==="inbound-rtp"?"remote":"local");if(!a)return;if(o&&ms.buildPacketsLost(a,s,o),s.type==="inbound-rtp"){ms.buildFramerateResolution(a,s),o&&ms.buildBitrateReceived(a,s,o);const c=this.trackStats.findTransceiverByTrackId(a.trackId);ms.setTrackStatsState(a,c),ms.buildJitter(a,s),ms.buildAudioConcealment(a,s)}else o&&(r.set(a.trackId,Ku.getNonNegativeValue(s.bytesSent)),ms.buildBitrateSend(a,s,o));ms.buildCodec(this.currentStatsReport,a,s)}else if(s.type==="track"&&s.kind==="video"&&!s.remoteSource){const a=this.trackStats.findLocalVideoTrackStats(s);if(!a)return;ms.buildFramerateResolution(a,s),ms.calculateSimulcastFramerate(a,s,o,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}}),this.emitter.emitByteSendReport(r),this.emitter.emitCallFeedReport(Al.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,O.warn(`CallStatsReportGatherer ${this.callId} processStatsReport fails and set to inactive ${e}`)}processAndEmitConnectionStatsReport(){const e=Rg.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport({...e,transport:this.connectionStats.transport}),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){this.pc.signalingState==="stable"&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var wa=(n=>(n.CONNECTION_STATS="StatsReport.connection_stats",n.CALL_FEED_REPORT="StatsReport.call_feed_report",n.BYTE_SENT_STATS="StatsReport.byte_sent_stats",n.SUMMARY_STATS="StatsReport.summary_stats",n))(wa||{});class Ase extends Xn{emitByteSendReport(e){this.emit(wa.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(wa.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(wa.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(wa.SUMMARY_STATS,e)}}class k${constructor(e){this.emitter=e}build(e){const t=e.filter(u=>!u.isFirstCollection),r=t.length,i=e.length;if(r===0)return;const s={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0};let o=0,a=0;t.forEach(u=>{this.countTrackListReceivedMedia(s,u),this.countConcealedAudio(s,u),o=this.buildMaxJitter(o,u),a=this.buildMaxPacketLoss(a,u)});const c=5,l={percentageReceivedMedia:Number((s.receivedMedia/r).toFixed(c)),percentageReceivedVideoMedia:Number((s.receivedVideo/r).toFixed(c)),percentageReceivedAudioMedia:Number((s.receivedAudio/r).toFixed(c)),maxJitter:o,maxPacketLoss:a,percentageConcealedAudio:Number(s.totalAudio>0?(s.concealedAudio/s.totalAudio).toFixed(c):0),peerConnections:i};this.emitter.emitSummaryStatsReport(l)}static extendSummaryReport(e,t){const r=[],i=[];for(const s of t){i.push(s);for(const o of s[1])r.push(o)}e.opponentDevicesInCall=Math.max(0,r.length-1),e.opponentUsersInCall=Math.max(0,i.length-1),e.diffDevicesToPeerConnections=Math.max(0,r.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=Math.max(0,r.length-1)==0?0:e.peerConnections/(r.length-1)}countTrackListReceivedMedia(e,t){let r=!1,i=!1;(t.receivedAudioMedia>0||t.audioTrackSummary.count===0)&&(e.receivedAudio++,r=!0),(t.receivedVideoMedia>0||t.videoTrackSummary.count===0||t.videoTrackSummary.muted>0&&t.videoTrackSummary.muted===t.videoTrackSummary.count)&&(e.receivedVideo++,i=!0),i&&r&&e.receivedMedia++}buildMaxJitter(e,t){return e<t.videoTrackSummary.maxJitter&&(e=t.videoTrackSummary.maxJitter),e<t.audioTrackSummary.maxJitter&&(e=t.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,t){return e<t.videoTrackSummary.maxPacketLoss&&(e=t.videoTrackSummary.maxPacketLoss),e<t.audioTrackSummary.maxPacketLoss&&(e=t.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,t){e.concealedAudio+=t.audioTrackSummary.concealedAudio,e.totalAudio+=t.audioTrackSummary.totalAudio}}class Mse{constructor(e,t,r=1e4){this.groupCallId=e,this.userId=t,this.interval=r,this.gatherers=new Map,this.reports=new Ase,this.summaryStatsReportGatherer=new k$(this.reports)}start(){this.timer===void 0&&this.interval>0&&(this.timer=setInterval(()=>{this.processStats()},this.interval))}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.gatherers.forEach(e=>e.stopProcessingStats()))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,t,r){return this.hasStatsReportGatherer(e)?!1:(this.gatherers.set(e,new Lse(e,t,r,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,t){var r;(r=this.getStatsReportGatherer(e))==null||r.setOpponentMemberId(t)}processStats(){const e=[];this.gatherers.forEach(t=>{e.push(t.processStats(this.groupCallId,this.userId))}),Promise.all(e).then(t=>this.summaryStatsReportGatherer.build(t)).catch(t=>{O.error("Could not build summary stats report",t)})}setInterval(e){this.interval=e}}var bP=(n=>(n.Ring="m.ring",n.Prompt="m.prompt",n.Room="m.room",n))(bP||{}),fw=(n=>(n.Video="m.video",n.Voice="m.voice",n))(fw||{}),Ab=(n=>(n.GroupCallStateChanged="group_call_state_changed",n.ActiveSpeakerChanged="active_speaker_changed",n.CallsChanged="calls_changed",n.UserMediaFeedsChanged="user_media_feeds_changed",n.ScreenshareFeedsChanged="screenshare_feeds_changed",n.LocalScreenshareStateChanged="local_screenshare_state_changed",n.LocalMuteStateChanged="local_mute_state_changed",n.ParticipantsChanged="participants_changed",n.Error="group_call_error",n))(Ab||{}),x$=(n=>(n.ConnectionStats="GroupCall.connection_stats",n.ByteSentStats="GroupCall.byte_sent_stats",n.SummaryStats="GroupCall.summary_stats",n.CallFeedStats="GroupCall.call_feed_stats",n))(x$||{}),P$=(n=>(n.NoUserMedia="no_user_media",n.UnknownDevice="unknown_device",n.PlaceCallFailed="place_call_failed",n))(P$||{});class ZR extends Error{constructor(e,t,r){r?super(t+": "+r):super(t),this.code=e}}class L$ extends ZR{constructor(e){super("unknown_device","No device found for "+e),this.userId=e}}var SP=(n=>(n.LocalCallFeedUninitialized="local_call_feed_uninitialized",n.InitializingLocalCallFeed="initializing_local_call_feed",n.LocalCallFeedInitialized="local_call_feed_initialized",n.Entered="entered",n.Ended="ended",n))(SP||{});const b5=1e3*60*60;function n1(n){var e;return((e=n.getOpponentMember())==null?void 0:e.userId)||n.invitee||null}class wP extends Xn{constructor(e,t,r,i,s,o,a,c,l,u=!1,h){var p;super(),this.client=e,this.room=t,this.type=r,this.isPtt=i,this.intent=s,this.dataChannelsEnabled=a,this.dataChannelOptions=c,this.useLivekit=u,this.activeSpeakerInterval=1e3,this.retryCallInterval=5e3,this.participantTimeout=1e3*15,this.pttMaxTransmitTime=1e3*20,this.userMediaFeeds=[],this.screenshareFeeds=[],this.calls=new Map,this.callHandlers=new Map,this.retryCallCounts=new Map,this.transmitTimer=null,this.participantsExpirationTimer=null,this.resendMemberStateTimer=null,this.initWithAudioMuted=!1,this.initWithVideoMuted=!1,this.statsCollectIntervalTime=0,this.onConnectionStats=m=>{this.emit("GroupCall.connection_stats",{report:m})},this.onByteSentStats=m=>{this.emit("GroupCall.byte_sent_stats",{report:m})},this.onSummaryStats=m=>{k$.extendSummaryReport(m,this.participants),this.emit("GroupCall.summary_stats",{report:m})},this.onCallFeedReport=m=>{this.localCallFeed&&(m=Al.expandCallFeedReport(m,[this.localCallFeed],"from-local-feed"));const v=[];this.forEachCall(g=>{g.callId===m.callId&&g.getFeeds().forEach(S=>v.push(S))}),m=Al.expandCallFeedReport(m,v,"from-call-feed"),this.emit("GroupCall.call_feed_stats",{report:m})},this._state="local_call_feed_uninitialized",this._participants=new Map,this._creationTs=null,this._enteredViaAnotherSession=!1,this.onIncomingCall=m=>{var R;if(m.roomId!==this.room.roomId)return;if(m.state!==_s.Ringing){O.warn(`GroupCall ${this.groupCallId} onIncomingCall() incoming call no longer in ringing state - ignoring`);return}if(!m.groupCallId||m.groupCallId!==this.groupCallId){O.log(`GroupCall ${this.groupCallId} onIncomingCall() ignored because it doesn't match the current group call`),m.reject();return}const v=(R=m.getOpponentMember())==null?void 0:R.userId;if(v===void 0){O.warn(`GroupCall ${this.groupCallId} onIncomingCall() incoming call with no member - ignoring`);return}if(this.useLivekit){O.info("Received incoming call whilst in signaling-only mode! Ignoring.");return}const g=this.calls.get(v)??new Map,S=g.get(m.getOpponentDeviceId());if((S==null?void 0:S.callId)===m.callId)return;O.log(`GroupCall ${this.groupCallId} onIncomingCall() incoming call (userId=${v}, callId=${m.callId})`),S&&S.hangup(tc.Replaced,!1),g.set(m.getOpponentDeviceId(),m),this.calls.set(v,g),this.initCall(m);const b=this.getLocalFeeds().map(k=>k.clone());if(!this.callExpected(m))for(const k of b)nr(k.stream.getAudioTracks(),!1),nr(k.stream.getVideoTracks(),!1);m.answerWithCallFeeds(b),this.emit("calls_changed",this.calls)},this.onRetryCallLoop=()=>{let m=!1;for(const[{userId:v},g]of this.participants){const S=this.calls.get(v);let b=this.retryCallCounts.get(v);for(const[R,k]of g){const I=S==null?void 0:S.get(R),T=(b==null?void 0:b.get(R))??0;(I==null?void 0:I.getOpponentSessionId())!==k.sessionId&&this.wantsOutgoingCall(v,R)&&T<3&&(b===void 0&&(b=new Map,this.retryCallCounts.set(v,b)),b.set(R,T+1),m=!0)}}m&&this.placeOutgoingCalls()},this.onCallFeedsChanged=m=>{const v=n1(m),g=m.getOpponentDeviceId();if(!v)throw new Error("Cannot change call feeds without user id");const S=this.getUserMediaFeed(v,g),b=m.remoteUsermediaFeed,R=b!==S,k=this.calls.get(v),I=k==null?void 0:k.get(g);if((I==null?void 0:I.callId)!==m.callId)return;R&&(!S&&b?this.addUserMediaFeed(b):S&&b?this.replaceUserMediaFeed(S,b):S&&!b&&this.removeUserMediaFeed(S));const T=this.getScreenshareFeed(v,g),C=m.remoteScreensharingFeed;C!==T&&(!T&&C?this.addScreenshareFeed(C):T&&C?this.replaceScreenshareFeed(T,C):T&&!C&&this.removeScreenshareFeed(T))},this.onCallStateChanged=(m,v,g)=>{var k;if(v===_s.Ended)return;const S=this.localCallFeed.isAudioMuted();m.localUsermediaStream&&m.isMicrophoneMuted()!==S&&m.setMicrophoneMuted(S);const b=this.localCallFeed.isVideoMuted();m.localUsermediaStream&&m.isLocalVideoMuted()!==b&&m.setLocalVideoMuted(b);const R=(k=m.getOpponentMember())==null?void 0:k.userId;if(v===_s.Connected&&R){const I=this.retryCallCounts.get(R);I==null||I.delete(m.getOpponentDeviceId()),(I==null?void 0:I.size)===0&&this.retryCallCounts.delete(R)}},this.onCallHangup=m=>{var S;if(m.hangupReason===tc.Replaced)return;const v=((S=m.getOpponentMember())==null?void 0:S.userId)??this.room.getMember(m.invitee).userId,g=this.calls.get(v);(g==null?void 0:g.get(m.getOpponentDeviceId()))===m&&(this.disposeCall(m,m.hangupReason),g.delete(m.getOpponentDeviceId()),g.size===0&&this.calls.delete(v),this.emit("calls_changed",this.calls))},this.onCallReplaced=(m,v)=>{const g=m.getOpponentMember().userId;let S=this.calls.get(g);S===void 0&&(S=new Map,this.calls.set(g,S)),m.hangup(tc.Replaced,!1),this.initCall(v),S.set(m.getOpponentDeviceId(),v),this.emit("calls_changed",this.calls)},this.onActiveSpeakerLoop=()=>{let m,v;for(const g of this.userMediaFeeds){if(g.isLocal()&&this.userMediaFeeds.length>1)continue;const b=g.speakingVolumeSamples.reduce((R,k)=>R+Math.max(k,YR))/g.speakingVolumeSamples.length;(!m||b>m)&&(m=b,v=g)}v&&this.activeSpeaker!==v&&m&&m>YR&&(this.activeSpeaker=v,this.emit("active_speaker_changed",this.activeSpeaker))},this.onRoomState=()=>this.updateParticipants(),this.onParticipantsChanged=()=>{this.forEachCall(m=>{const v=this.callExpected(m);for(const g of m.getLocalFeeds())nr(g.stream.getAudioTracks(),!g.isAudioMuted()&&v),nr(g.stream.getVideoTracks(),!g.isVideoMuted()&&v)}),this.state==="entered"&&!this.useLivekit&&this.placeOutgoingCalls()},this.onStateChanged=(m,v)=>{(m==="entered"||v==="entered"||m==="ended")&&(this.updateParticipants(),this.updateMemberState().catch(g=>O.error(`GroupCall ${this.groupCallId} onStateChanged() failed to update member state devices"`,g)))},this.onLocalFeedsChanged=()=>{this.state==="entered"&&this.updateMemberState().catch(m=>O.error(`GroupCall ${this.groupCallId} onLocalFeedsChanged() failed to update member state feeds`,m))},this.reEmitter=new Fj(this),this.groupCallId=o??Wu(),this._livekitServiceURL=h,this.creationTs=((p=t.currentState.getStateEvents(ie.GroupCallPrefix,this.groupCallId))==null?void 0:p.getTs())??null,this.updateParticipants(),t.on(kt.Update,this.onRoomState),this.on("participants_changed",this.onParticipantsChanged),this.on("group_call_state_changed",this.onStateChanged),this.on("local_screenshare_state_changed",this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!l}async create(){return this.creationTs=Date.now(),this.client.groupCallEventHandler.groupCalls.set(this.room.roomId,this),this.client.emit(JR.Outgoing,this),await this.sendCallStateEvent(),this}async sendCallStateEvent(){const e={"m.intent":this.intent,"m.type":this.type,"io.element.ptt":this.isPtt,dataChannelsEnabled:this.dataChannelsEnabled,dataChannelOptions:this.dataChannelsEnabled?this.dataChannelOptions:void 0};this.livekitServiceURL&&(e["io.element.livekit_service_url"]=this.livekitServiceURL),await this.client.sendStateEvent(this.room.roomId,ie.GroupCallPrefix,e,this.groupCallId)}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){const t=this._state;e!==t&&(this._state=e,this.emit("group_call_state_changed",e,t))}get participants(){return this._participants}set participants(e){const t=this._participants,r=(s,o)=>s.sessionId===o.sessionId&&s.screensharing===o.screensharing;MO(e,t,(s,o)=>MO(s,o,r))||(this._participants=e,this.emit("participants_changed",e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(const t of this.calls.values())for(const r of t.values())e(r)}getLocalFeeds(){const e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e;return((e=this.participants.get(this.room.getMember(this.client.getUserId())))==null?void 0:e.has(this.client.getDeviceId()))??!1}callExpected(e){var s;const t=n1(e),r=t===null?null:this.room.getMember(t),i=e.getOpponentDeviceId();return r!==null&&i!==void 0&&((s=this.participants.get(r))==null?void 0:s.get(i))!==void 0}async initLocalCallFeed(){if(this.useLivekit){O.info("Livekit group call: not starting local call feed.");return}if(this.state!=="local_call_feed_uninitialized")throw new Error(`Cannot initialize local call feed in the "${this.state}" state.`);if(this.state="initializing_local_call_feed",this.initCallFeedPromise)return this.initCallFeedPromise;try{this.initCallFeedPromise=this.initLocalCallFeedInternal(),await this.initCallFeedPromise}finally{this.initCallFeedPromise=void 0}}async initLocalCallFeedInternal(){O.log(`GroupCall ${this.groupCallId} initLocalCallFeedInternal() running`);let e;try{e=await this.client.getMediaHandler().getUserMediaStream(!0,this.type==="m.video")}catch(r){if(this.allowCallWithoutVideoAndAudio)e=new MediaStream;else throw this.state="local_call_feed_uninitialized",r}if(this._state!=="initializing_local_call_feed")throw this.client.getMediaHandler().stopUserMediaStream(e),new Error("Group call disposed while gathering media stream");const t=new dc({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:e,purpose:en.Usermedia,audioMuted:this.initWithAudioMuted||e.getAudioTracks().length===0||this.isPtt,videoMuted:this.initWithVideoMuted||e.getVideoTracks().length===0});nr(e.getAudioTracks(),!t.isAudioMuted()),nr(e.getVideoTracks(),!t.isVideoMuted()),this.localCallFeed=t,this.addUserMediaFeed(t),this.state="local_call_feed_initialized"}async updateLocalUsermediaStream(e){if(this.localCallFeed){const t=this.localCallFeed.stream;this.localCallFeed.setNewStream(e);const r=this.localCallFeed.isAudioMuted(),i=this.localCallFeed.isVideoMuted();O.log(`GroupCall ${this.groupCallId} updateLocalUsermediaStream() (oldStreamId=${t.id}, newStreamId=${e.id}, micShouldBeMuted=${r}, vidShouldBeMuted=${i})`),nr(e.getAudioTracks(),!r),nr(e.getVideoTracks(),!i),this.client.getMediaHandler().stopUserMediaStream(t)}}async enter(){if(this.state==="local_call_feed_uninitialized")await this.initLocalCallFeed();else if(this.state!=="local_call_feed_initialized")throw new Error(`Cannot enter call in the "${this.state}" state`);O.log(`GroupCall ${this.groupCallId} enter() running`),this.state="entered",this.client.on(XR.Incoming,this.onIncomingCall);for(const e of this.client.callEventHandler.calls.values())this.onIncomingCall(e);this.useLivekit||(this.retryCallLoopInterval=setInterval(this.onRetryCallLoop,this.retryCallInterval),this.activeSpeaker=void 0,this.onActiveSpeakerLoop(),this.activeSpeakerLoopInterval=setInterval(this.onActiveSpeakerLoop,this.activeSpeakerInterval))}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),this.transmitTimer!==null&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),this.retryCallLoopInterval!==void 0&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state==="entered"&&(this.forEachCall(t=>t.hangup(tc.UserHangup,!1)),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(XR.Incoming,this.onIncomingCall),(e=this.stats)==null||e.stop())}leave(){this.dispose(),this.state="local_call_feed_uninitialized"}async terminate(e=!0){if(this.dispose(),this.room.off(kt.Update,this.onRoomState),this.client.groupCallEventHandler.groupCalls.delete(this.room.roomId),this.client.emit(JR.Ended,this),this.state="ended",e){const t=this.room.currentState.getStateEvents(ie.GroupCallPrefix,this.groupCallId);await this.client.sendStateEvent(this.room.roomId,ie.GroupCallPrefix,{...t.getContent(),"m.terminated":"call_ended"},this.groupCallId)}}isLocalVideoMuted(){return this.localCallFeed?this.localCallFeed.isVideoMuted():!0}isMicrophoneMuted(){return this.localCallFeed?this.localCallFeed.isAudioMuted():!0}async setMicrophoneMuted(e){if(!e&&!await this.client.getMediaHandler().hasAudioDevice())return!1;const t=!e&&this.isPtt;this.isPtt&&(!e&&this.isMicrophoneMuted()?this.transmitTimer=setTimeout(()=>{this.setMicrophoneMuted(!0)},this.pttMaxTransmitTime):e&&!this.isMicrophoneMuted()&&(this.transmitTimer!==null&&clearTimeout(this.transmitTimer),this.transmitTimer=null)),this.forEachCall(i=>{var s;return(s=i.localUsermediaFeed)==null?void 0:s.setAudioVideoMuted(e,null)});const r=async()=>{const i=[];this.forEachCall(s=>i.push(s.sendMetadataUpdate())),await Promise.all(i).catch(s=>O.info(`GroupCall ${this.groupCallId} setMicrophoneMuted() failed to send some metadata updates`,s))};if(t&&await r(),this.localCallFeed){if(O.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() (streamId=${this.localCallFeed.stream.id}, muted=${e})`),!await this.checkAudioPermissionIfNecessary(e))return!1;this.localCallFeed.setAudioVideoMuted(e,null),nr(this.localCallFeed.stream.getAudioTracks(),!e)}else O.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() no stream muted (muted=${e})`),this.initWithAudioMuted=e;return this.forEachCall(i=>nr(i.localUsermediaFeed.stream.getAudioTracks(),!e&&this.callExpected(i))),this.emit("local_mute_state_changed",e,this.isLocalVideoMuted()),t||await r(),!0}async checkAudioPermissionIfNecessary(e){try{if(!e&&this.localCallFeed&&!this.localCallFeed.hasAudioTrack){const t=await this.client.getMediaHandler().getUserMediaStream(!0,!this.localCallFeed.isVideoMuted());if((t==null?void 0:t.getTracks().length)===0)return O.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() no device to receive local stream, muted=${e}`),!1}}catch{return O.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() no device or permission to receive local stream, muted=${e}`),!1}return!0}async setLocalVideoMuted(e){if(!e&&!await this.client.getMediaHandler().hasVideoDevice())return!1;if(this.localCallFeed){O.log(`GroupCall ${this.groupCallId} setLocalVideoMuted() (stream=${this.localCallFeed.stream.id}, muted=${e})`);try{const r=await this.client.getMediaHandler().getUserMediaStream(!0,!e);await this.updateLocalUsermediaStream(r),this.localCallFeed.setAudioVideoMuted(null,e),nr(this.localCallFeed.stream.getVideoTracks(),!e)}catch{return O.log(`GroupCall ${this.groupCallId} setLocalVideoMuted() no device or permission to receive local stream, muted=${e}`),!1}}else O.log(`GroupCall ${this.groupCallId} setLocalVideoMuted() no stream muted (muted=${e})`),this.initWithVideoMuted=e;const t=[];return this.forEachCall(r=>t.push(r.setLocalVideoMuted(e))),await Promise.all(t),this.forEachCall(r=>nr(r.localUsermediaFeed.stream.getVideoTracks(),!e&&this.callExpected(r))),this.emit("local_mute_state_changed",this.isMicrophoneMuted(),e),!0}async setScreensharingEnabled(e,t={}){if(e===this.isScreensharing())return e;if(e)try{O.log(`GroupCall ${this.groupCallId} setScreensharingEnabled() is asking for screensharing permissions`);const r=await this.client.getMediaHandler().getScreensharingStream(t);for(const i of r.getTracks()){const s=()=>{this.setScreensharingEnabled(!1),i.removeEventListener("ended",s)};i.addEventListener("ended",s)}return O.log(`GroupCall ${this.groupCallId} setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls`),this.localDesktopCapturerSourceId=t.desktopCapturerSourceId,this.localScreenshareFeed=new dc({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:r,purpose:en.Screenshare,audioMuted:!1,videoMuted:!1}),this.addScreenshareFeed(this.localScreenshareFeed),this.emit("local_screenshare_state_changed",!0,this.localScreenshareFeed,this.localDesktopCapturerSourceId),this.forEachCall(i=>i.pushLocalFeed(this.localScreenshareFeed.clone())),!0}catch(r){if(t.throwOnFail)throw r;return O.error(`GroupCall ${this.groupCallId} setScreensharingEnabled() enabling screensharing error`,r),this.emit("group_call_error",new ZR("no_user_media","Failed to get screen-sharing stream: ",r)),!1}else return this.forEachCall(r=>{r.localScreensharingFeed&&r.removeLocalFeed(r.localScreensharingFeed)}),this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0,this.emit("local_screenshare_state_changed",!1,void 0,void 0),!1}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,t){const r=this.client.getUserId(),i=this.client.getDeviceId();return e>=r&&(e!==r||t>i)}placeOutgoingCalls(){let e=!1;for(const[{userId:t},r]of this.participants){const i=this.calls.get(t)??new Map;for(const[s,o]of r){const a=i.get(s);if((a==null?void 0:a.getOpponentSessionId())!==o.sessionId&&this.wantsOutgoingCall(t,s)){e=!0,a!==void 0&&(O.debug(`GroupCall ${this.groupCallId} placeOutgoingCalls() replacing call (userId=${t}, deviceId=${s}, callId=${a.callId})`),a.hangup(tc.NewSession,!1));const c=av(this.client,this.room.roomId,{invitee:t,opponentDeviceId:s,opponentSessionId:o.sessionId,groupCallId:this.groupCallId});c===null?(O.error(`GroupCall ${this.groupCallId} placeOutgoingCalls() failed to create call (userId=${t}, device=${s})`),i.delete(s)):(this.initCall(c),i.set(s,c),O.debug(`GroupCall ${this.groupCallId} placeOutgoingCalls() placing call (userId=${t}, deviceId=${s}, sessionId=${o.sessionId})`),c.placeCallWithCallFeeds(this.getLocalFeeds().map(l=>l.clone()),o.screensharing).then(()=>{this.dataChannelsEnabled&&c.createDataChannel("datachannel",this.dataChannelOptions)}).catch(l=>{O.warn(`GroupCall ${this.groupCallId} placeOutgoingCalls() failed to place call (userId=${t})`,l),l instanceof nc&&l.code==="unknown_device"?this.emit("group_call_error",l):this.emit("group_call_error",new ZR("place_call_failed",`Failed to place call to ${t}`)),c.hangup(tc.SignallingFailed,!1),i.get(s)===c&&i.delete(s)}))}}i.size>0?this.calls.set(t,i):this.calls.delete(t)}e&&this.emit("calls_changed",this.calls)}getMemberStateEvents(e){return e===void 0?this.room.currentState.getStateEvents(ie.GroupCallMemberPrefix):this.room.currentState.getStateEvents(ie.GroupCallMemberPrefix,e)}initCall(e){const t=n1(e);if(!t)throw new Error("Cannot init call without user id");const r=()=>this.onCallFeedsChanged(e),i=(c,l)=>this.onCallStateChanged(e,c,l),s=this.onCallHangup,o=c=>this.onCallReplaced(e,c);let a=this.callHandlers.get(t);a===void 0&&(a=new Map,this.callHandlers.set(t,a)),a.set(e.getOpponentDeviceId(),{onCallFeedsChanged:r,onCallStateChanged:i,onCallHangup:s,onCallReplaced:o}),e.on(Bi.FeedsChanged,r),e.on(Bi.State,i),e.on(Bi.Hangup,s),e.on(Bi.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(Bi)),e.initStats(this.getGroupCallStats()),r()}disposeCall(e,t){const r=n1(e),i=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");const s=this.callHandlers.get(r),{onCallFeedsChanged:o,onCallStateChanged:a,onCallHangup:c,onCallReplaced:l}=s.get(i);if(e.removeListener(Bi.FeedsChanged,o),e.removeListener(Bi.State,a),e.removeListener(Bi.Hangup,c),e.removeListener(Bi.Replaced,l),s.delete(r),s.size===0&&this.callHandlers.delete(r),e.hangupReason===tc.Replaced)return;const u=this.getUserMediaFeed(r,i);u&&this.removeUserMediaFeed(u);const h=this.getScreenshareFeed(r,i);h&&this.removeScreenshareFeed(h)}getUserMediaFeed(e,t){return this.userMediaFeeds.find(r=>r.userId===e&&r.deviceId===t)}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit("user_media_feeds_changed",this.userMediaFeeds)}replaceUserMediaFeed(e,t){const r=this.userMediaFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,t),e.dispose(),t.measureVolumeActivity(!0),this.emit("user_media_feeds_changed",this.userMediaFeeds)}removeUserMediaFeed(e){const t=this.userMediaFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(t===-1)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(t,1),e.dispose(),this.emit("user_media_feeds_changed",this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit("active_speaker_changed",this.activeSpeaker))}getScreenshareFeed(e,t){return this.screenshareFeeds.find(r=>r.userId===e&&r.deviceId===t)}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit("screenshare_feeds_changed",this.screenshareFeeds)}replaceScreenshareFeed(e,t){const r=this.screenshareFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,t),e.dispose(),this.emit("screenshare_feeds_changed",this.screenshareFeeds)}removeScreenshareFeed(e){const t=this.screenshareFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(t===-1)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(t,1),e.dispose(),this.emit("screenshare_feeds_changed",this.screenshareFeeds)}updateParticipants(){const e=this.room.getMember(this.client.getSafeUserId());if(!e){O.warn(`GroupCall ${this.groupCallId} updateParticipants() tried to update participants before local room member is available`);return}if(this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state==="ended"){this.participants=new Map;return}const t=new Map,r=Date.now(),i=this.state==="entered"||this.enteredViaAnotherSession;let s=1/0;for(const o of this.getMemberStateEvents()){const a=this.room.getMember(o.getStateKey()),c=o.getContent(),u=(Array.isArray(c["m.calls"])?c["m.calls"]:[]).find(m=>m["m.call_id"]===this.groupCallId);let p=(Array.isArray(u==null?void 0:u["m.devices"])?u["m.devices"]:[]).filter(m=>typeof m.device_id=="string"&&typeof m.session_id=="string"&&typeof m.expires_ts=="number"&&m.expires_ts>r&&Array.isArray(m.feeds));if(!i&&(a==null?void 0:a.userId)===this.client.getUserId()&&(p=p.filter(m=>m.device_id!==this.client.getDeviceId())),p.length>0&&(a==null?void 0:a.membership)===ze.Join){const m=new Map;t.set(a,m);for(const v of p)m.set(v.device_id,{sessionId:v.session_id,screensharing:v.feeds.some(g=>g.purpose===en.Screenshare)}),v.expires_ts<s&&(s=v.expires_ts)}}if(i){let o=t.get(e);o===void 0&&(o=new Map,t.set(e,o)),o.has(this.client.getDeviceId())||o.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(a=>a.purpose===en.Screenshare)})}this.participants=t,s<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),s-r))}async updateDevices(e,t=!1){const r=Date.now(),i=this.client.getUserId(),s=this.getMemberStateEvents(i),o=(s==null?void 0:s.getContent())??{},a=Array.isArray(o["m.calls"])?o["m.calls"]:[];let c=null;const l=[];for(const g of a)g["m.call_id"]===this.groupCallId?c=g:l.push(g);c===null&&(c={});const h=(Array.isArray(c["m.devices"])?c["m.devices"]:[]).filter(g=>typeof g.device_id=="string"&&typeof g.session_id=="string"&&typeof g.expires_ts=="number"&&g.expires_ts>r&&Array.isArray(g.feeds)),p=e(h);if(p===null)return;const m=[...l];p.length>0&&m.push({...c,"m.call_id":this.groupCallId,"m.devices":p});const v={"m.calls":m};await this.client.sendStateEvent(this.room.roomId,ie.GroupCallMemberPrefix,v,i,{keepAlive:t})}async addDeviceToMemberState(){await this.updateDevices(e=>[...e.filter(t=>t.device_id!==this.client.getDeviceId()),{device_id:this.client.getDeviceId(),session_id:this.client.getSessionId(),expires_ts:Date.now()+b5,feeds:this.getLocalFeeds().map(t=>({purpose:t.purpose}))}])}async updateMemberState(){this.resendMemberStateTimer!==null&&(clearInterval(this.resendMemberStateTimer),this.resendMemberStateTimer=null),this.state==="entered"?(await this.addDeviceToMemberState(),this.resendMemberStateTimer=setInterval(async()=>{O.log(`GroupCall ${this.groupCallId} updateMemberState() resending call member state"`);try{await this.addDeviceToMemberState()}catch(e){O.error(`GroupCall ${this.groupCallId} updateMemberState() failed to resend call member state`,e)}},b5*3/4)):await this.updateDevices(e=>e.filter(t=>t.device_id!==this.client.getDeviceId()),!0)}async cleanMemberState(){const{devices:e}=await this.client.getDevices(),t=new Map(e.map(r=>[r.device_id,r]));await this.updateDevices(r=>{const i=r.filter(s=>{const o=t.get(s.device_id);return(o==null?void 0:o.last_seen_ts)!==void 0&&!(s.device_id===this.client.getDeviceId()&&this.state!=="entered"&&!this.enteredViaAnotherSession)});return i.length===r.length?null:i})}getGroupCallStats(){if(this.stats===void 0){const e=this.client.getUserId()||"unknown";this.stats=new Mse(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(wa.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(wa.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(wa.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(wa.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,this.stats!==void 0&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}var _s=(n=>(n.Fledgling="fledgling",n.InviteSent="invite_sent",n.WaitLocalMedia="wait_local_media",n.CreateOffer="create_offer",n.CreateAnswer="create_answer",n.Connecting="connecting",n.Connected="connected",n.Ringing="ringing",n.Ended="ended",n))(_s||{}),A$=(n=>(n.Inbound="inbound",n.Outbound="outbound",n))(A$||{}),Bi=(n=>(n.Hangup="hangup",n.State="state",n.Error="error",n.Replaced="replaced",n.LocalHoldUnhold="local_hold_unhold",n.RemoteHoldUnhold="remote_hold_unhold",n.HoldUnhold="hold_unhold",n.FeedsChanged="feeds_changed",n.AssertedIdentityChanged="asserted_identity_changed",n.LengthChanged="length_changed",n.DataChannel="datachannel",n.SendVoipEvent="send_voip_event",n.PeerConnectionCreated="peer_connection_created",n))(Bi||{}),tc=(n=>(n.UserHangup="user_hangup",n.LocalOfferFailed="local_offer_failed",n.NoUserMedia="no_user_media",n.UnknownDevices="unknown_devices",n.SendInvite="send_invite",n.CreateAnswer="create_answer",n.CreateOffer="create_offer",n.SendAnswer="send_answer",n.SetRemoteDescription="set_remote_description",n.SetLocalDescription="set_local_description",n.AnsweredElsewhere="answered_elsewhere",n.IceFailed="ice_failed",n.InviteTimeout="invite_timeout",n.Replaced="replaced",n.SignallingFailed="signalling_timeout",n.UserBusy="user_busy",n.Transferred="transferred",n.NewSession="new_session",n))(tc||{});const Ose="1",Nse="stun:turn.matrix.org",NT=60*1e3,Dse=1e3,Fse=30*1e3,Use=2*1e3;class nc extends Error{constructor(e,t,r){super(t+": "+r),this.code=e}}function Wu(){return Date.now().toString()+Es(16)}function S5(n){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:n?12e3:void 0}]}function _o(n,e){return n+":"+e}class jse extends Xn{constructor(e){if(super(),this.toDeviceSeq=0,this.isPtt=!1,this._state="fledgling",this.candidateSendQueue=[],this.candidateSendTries=0,this.candidatesEnded=!1,this.feeds=[],this.transceivers=new Map,this.inviteOrAnswerSent=!1,this.waitForLocalAVStream=!1,this.removeTrackListeners=new Map,this.remoteOnHold=!1,this.makingOffer=!1,this.ignoreOffer=!1,this.isSettingRemoteAnswerPending=!1,this.remoteCandidateBuffer=new Map,this.gotLocalIceCandidate=t=>{if(t.candidate){if(this.candidatesEnded&&O.warn(`Call ${this.callId} gotLocalIceCandidate() got candidate after candidates have ended!`),O.debug(`Call ${this.callId} got local ICE ${t.candidate.sdpMid} ${t.candidate.candidate}`),this.callHasEnded())return;t.candidate.candidate===""?this.queueCandidate(null):this.queueCandidate(t.candidate)}},this.onIceGatheringStateChange=t=>{var r;O.debug(`Call ${this.callId} onIceGatheringStateChange() ice gathering state changed to ${this.peerConn.iceGatheringState}`),((r=this.peerConn)==null?void 0:r.iceGatheringState)==="complete"&&(this.queueCandidate(null),O.debug(`Call ${this.callId} onIceGatheringStateChange() ice gathering state complete, set candidates have ended`))},this.getLocalOfferFailed=t=>{O.error(`Call ${this.callId} getLocalOfferFailed() running`,t),this.emit("error",new nc("local_offer_failed","Failed to get local offer!",t),this),this.terminate("local","local_offer_failed",!1)},this.getUserMediaFailed=t=>{if(this.successor){this.successor.getUserMediaFailed(t);return}O.warn(`Call ${this.callId} getUserMediaFailed() failed to get user media - ending call`,t),this.emit("error",new nc("no_user_media","Couldn't start capturing media! Is your microphone set up and does this app have permission?",t),this),this.terminate("local","no_user_media",!1)},this.placeCallFailed=t=>{if(this.successor){this.successor.placeCallFailed(t);return}O.warn(`Call ${this.callId} placeCallWithCallFeeds() failed - ending call`,t),this.emit("error",new nc("ice_failed","Couldn't start call! Invalid ICE server configuration.",t),this),this.terminate("local","ice_failed",!1)},this.onIceConnectionStateChanged=()=>{var t,r,i,s,o,a,c;if(!this.callHasEnded()&&(O.debug(`Call ${this.callId} onIceConnectionStateChanged() running (state=${(t=this.peerConn)==null?void 0:t.iceConnectionState}, conn=${(r=this.peerConn)==null?void 0:r.connectionState})`),["connected","completed"].includes(((i=this.peerConn)==null?void 0:i.iceConnectionState)??"")?(clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state="connected",!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit("length_changed",Math.round((Date.now()-this.callStartTime)/1e3),this)},Dse))):((s=this.peerConn)==null?void 0:s.iceConnectionState)=="failed"?(this.candidatesEnded=!1,(o=this.peerConn)!=null&&o.restartIce?(this.candidatesEnded=!1,O.debug(`Call ${this.callId} onIceConnectionStateChanged() ice restart (state=${(a=this.peerConn)==null?void 0:a.iceConnectionState})`),this.peerConn.restartIce()):(O.info(`Call ${this.callId} onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)`),this.hangup("ice_failed",!1))):((c=this.peerConn)==null?void 0:c.iceConnectionState)=="disconnected"&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout(()=>{var l,u,h;O.info(`Call ${this.callId} onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=${(l=this.peerConn)==null?void 0:l.iceConnectionState}, conn=${(u=this.peerConn)==null?void 0:u.connectionState})`),(h=this.peerConn)!=null&&h.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0},Use),this.iceDisconnectedTimeout=setTimeout(()=>{O.info(`Call ${this.callId} onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)`),this.hangup("ice_failed",!1)},Fse),this.state="connecting"),this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState)))for(const l of this.getRemoteFeeds())l.setAudioVideoMuted(!0,!0)},this.onSignallingStateChanged=()=>{var t;O.debug(`Call ${this.callId} onSignallingStateChanged() running (state=${(t=this.peerConn)==null?void 0:t.signalingState})`)},this.onTrack=t=>{if(t.streams.length===0){O.warn(`Call ${this.callId} onTrack() called with streamless track streamless (kind=${t.track.kind})`);return}const r=t.streams[0];if(this.pushRemoteFeed(r),!this.removeTrackListeners.has(r)){const i=()=>{r.getTracks().length===0&&(O.info(`Call ${this.callId} onTrack() removing track (streamId=${r.id})`),this.deleteFeedByStream(r),r.removeEventListener("removetrack",i),this.removeTrackListeners.delete(r))};r.addEventListener("removetrack",i),this.removeTrackListeners.set(r,i)}},this.onDataChannel=t=>{this.emit("datachannel",t.channel,this)},this.onNegotiationNeeded=async()=>{if(O.info(`Call ${this.callId} onNegotiationNeeded() negotiation is needed!`),this.state!=="create_offer"&&this.opponentVersion===0){O.info(`Call ${this.callId} onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event`);return}this.queueGotLocalOffer()},this.onHangupReceived=t=>{O.debug(`Call ${this.callId} onHangupReceived() running`),this.partyIdMatches(t)||this.state==="ringing"?this.terminate("remote",t.reason||"user_hangup",!0):O.info(`Call ${this.callId} onHangupReceived() ignoring message from party ID ${t.party_id}: our partner is ${this.opponentPartyId}`)},this.onRejectReceived=t=>{O.debug(`Call ${this.callId} onRejectReceived() running`),["invite_sent","ringing"].includes(this.state)||this.state==="fledgling"&&this.direction==="inbound"?this.terminate("remote",t.reason||"user_hangup",!0):O.debug(`Call ${this.callId} onRejectReceived() called in wrong state (state=${this.state})`)},this.onAnsweredElsewhere=t=>{O.debug(`Call ${this.callId} onAnsweredElsewhere() running`),this.terminate("remote","answered_elsewhere",!0)},this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=e.forceTURN??!1,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],this.turnServers.length===0&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[Nse]});for(const t of this.turnServers)pj(t,["urls"]);this.callId=Wu(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}async placeVoiceCall(){await this.placeCall(!0,!1)}async placeVideoCall(){await this.placeCall(!0,!0)}createDataChannel(e,t){const r=this.peerConn.createDataChannel(e,t);return this.emit("datachannel",r,this),r}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!!(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!!(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit("state",e,t,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?"video":"voice"}get hasLocalUserMediaVideoTrack(){var e;return!!((e=this.localUsermediaStream)!=null&&e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(e=>{var t;return e.purpose===en.Usermedia&&((t=e.stream)==null?void 0:t.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var e;return!!((e=this.localUsermediaStream)!=null&&e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(e=>{var t;return e.purpose===en.Usermedia&&!!((t=e.stream)!=null&&t.getAudioTracks().length)})}get hasUserMediaAudioSender(){var e;return!!((e=this.transceivers.get(_o(en.Usermedia,"audio")))!=null&&e.sender)}get hasUserMediaVideoSender(){var e;return!!((e=this.transceivers.get(_o(en.Usermedia,"video")))!=null&&e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find(e=>e.purpose===en.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(e=>e.purpose===en.Screenshare)}get localUsermediaStream(){var e;return(e=this.localUsermediaFeed)==null?void 0:e.stream}get localScreensharingStream(){var e;return(e=this.localScreensharingFeed)==null?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(e=>e.purpose===en.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(e=>e.purpose===en.Screenshare)}get remoteUsermediaStream(){var e;return(e=this.remoteUsermediaFeed)==null?void 0:e.stream}get remoteScreensharingStream(){var e;return(e=this.remoteScreensharingFeed)==null?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find(t=>t.stream.id===e)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}async initOpponentCrypto(){var t;if(!this.opponentDeviceId||!this.client.getUseE2eForGroupCall())return;if(!this.client.getCrypto()){this.hasOpponentDeviceInfo=!0;return}const e=this.invitee||((t=this.getOpponentMember())==null?void 0:t.userId);throw e?(this.hasOpponentDeviceInfo=!1,new L$(e)):new Error("Couldn't find opponent user ID to init crypto")}getLocalSDPStreamMetadata(e=!1){const t={};for(const r of this.getLocalFeeds())e&&(r.sdpMetadataStreamId=r.stream.id),t[r.sdpMetadataStreamId]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()};return t}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata()){this.pushRemoteFeedWithoutMetadata(e);return}const t=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,s=this.remoteSDPStreamMetadata[e.id].video_muted;if(!r){O.warn(`Call ${this.callId} pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=${e.id})`);return}if(this.getFeedByStreamId(e.id)){O.warn(`Call ${this.callId} pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=${e.id})`);return}this.feeds.push(new dc({client:this.client,call:this,roomId:this.roomId,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:i,videoMuted:s})),this.emit("feeds_changed",this.feeds,this),O.info(`Call ${this.callId} pushRemoteFeed() pushed stream (streamId=${e.id}, active=${e.active}, purpose=${r})`)}pushRemoteFeedWithoutMetadata(e){var s;const t=this.getOpponentMember().userId,r=en.Usermedia,i=(s=this.feeds.find(o=>!o.isLocal()))==null?void 0:s.stream;if(i&&e.id!==i.id){O.warn(`Call ${this.callId} pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=${e.id})`);return}if(this.getFeedByStreamId(e.id)){O.warn(`Call ${this.callId} pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=${e.id})`);return}this.feeds.push(new dc({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r})),this.emit("feeds_changed",this.feeds,this),O.info(`Call ${this.callId} pushRemoteFeedWithoutMetadata() pushed stream (streamId=${e.id}, active=${e.active})`)}pushNewLocalFeed(e,t,r=!0){const i=this.client.getUserId();if(nr(e.getAudioTracks(),!0),nr(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)){O.warn(`Call ${this.callId} pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=${e.id})`);return}this.pushLocalFeed(new dc({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,deviceId:this.getOpponentDeviceId(),stream:e,purpose:t}),r)}pushLocalFeed(e,t=!0){if(this.feeds.some(r=>e.stream.id===r.stream.id)){O.info(`Call ${this.callId} pushLocalFeed() ignoring duplicate local stream (streamId=${e.stream.id})`);return}if(this.feeds.push(e),t)for(const r of e.stream.getTracks()){O.info(`Call ${this.callId} pushLocalFeed() adding track to peer connection (id=${r.id}, kind=${r.kind}, streamId=${e.stream.id}, streamPurpose=${e.purpose}, enabled=${r.enabled})`);const i=_o(e.purpose,r.kind);if(this.transceivers.has(i)){const s=this.transceivers.get(i);s.sender.replaceTrack(r),s.direction=s.direction==="inactive"?"sendonly":"sendrecv"}else{const s=this.peerConn.addTrack(r,e.stream),o=this.peerConn.getTransceivers().find(a=>a.sender===s);o?this.transceivers.set(i,o):O.warn(`Call ${this.callId} pushLocalFeed() didn't find a matching transceiver after adding track!`)}}O.info(`Call ${this.callId} pushLocalFeed() pushed stream (id=${e.stream.id}, active=${e.stream.active}, purpose=${e.purpose})`),this.emit("feeds_changed",this.feeds,this)}removeLocalFeed(e){const t=_o(e.purpose,"audio"),r=_o(e.purpose,"video");for(const i of[t,r])if(this.transceivers.has(i)){const s=this.transceivers.get(i);s.sender&&this.peerConn.removeTrack(s.sender)}e.purpose===en.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(const e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit("feeds_changed",this.feeds,this)}deleteFeedByStream(e){const t=this.getFeedByStreamId(e.id);if(!t){O.warn(`Call ${this.callId} deleteFeedByStream() didn't find the feed to delete (streamId=${e.id})`);return}this.deleteFeed(t)}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit("feeds_changed",this.feeds,this)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];return e.forEach(r=>{t.push(r)}),t}async initWithInvite(e){var o;const t=e.getContent();this.direction="inbound",await this.client.checkTurnServers()||O.warn(`Call ${this.callId} initWithInvite() failed to get TURN credentials! Proceeding with call anyway...`);const i=t[hl];i?this.updateRemoteSDPStreamMetadata(i):O.debug(`Call ${this.callId} initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams`),this.peerConn=this.createPeerConnection(),this.emit("peer_connection_created",this.peerConn,this),this.chooseOpponent(e),await this.initOpponentCrypto();try{await this.peerConn.setRemoteDescription(t.offer),O.debug(`Call ${this.callId} initWithInvite() set remote description: ${t.offer.type}`),await this.addBufferedIceCandidates()}catch(a){O.debug(`Call ${this.callId} initWithInvite() failed to set remote description`,a),this.terminate("local","set_remote_description",!1);return}const s=(o=this.feeds.find(a=>!a.isLocal()))==null?void 0:o.stream;if(!this.isOnlyDataChannelAllowed&&(!s||s.getTracks().length===0)){O.error(`Call ${this.callId} initWithInvite() no remote stream or no tracks after setting remote description!`),this.terminate("local","set_remote_description",!1);return}if(this.state="ringing",e.getLocalAge()){const a=setTimeout(()=>{var l;this.state=="ringing"&&(O.debug(`Call ${this.callId} initWithInvite() invite has expired. Hanging up.`),this.hangupParty="remote",this.state="ended",this.stopAllMedia(),this.peerConn.signalingState!="closed"&&this.peerConn.close(),(l=this.stats)==null||l.removeStatsReportGatherer(this.callId),this.emit("hangup",this))},t.lifetime-e.getLocalAge()),c=l=>{l!=="ringing"&&(clearTimeout(a),this.off("state",c))};this.on("state",c)}}initWithHangup(e){this.state="ended"}shouldAnswerWithMediaType(e,t,r){return e&&!t?(O.warn(`Call ${this.callId} shouldAnswerWithMediaType() unable to answer with ${r} because the other side isn't sending it either.`),!1):!vj(e)&&e!==t&&!this.opponentSupportsSDPStreamMetadata()?(O.warn(`Call ${this.callId} shouldAnswerWithMediaType() unable to answer with ${r}=${e} because the other side doesn't support it. Answering with ${r}=${t}.`),t):e??t}async answer(e,t){if(!this.inviteOrAnswerSent){if(e===!1&&t===!1)throw new Error("You CANNOT answer a call without media");if(!this.localUsermediaStream&&!this.waitForLocalAVStream){const r=this.state,i=this.shouldAnswerWithMediaType(e,this.hasRemoteUserMediaAudioTrack,"audio"),s=this.shouldAnswerWithMediaType(t,this.hasRemoteUserMediaVideoTrack,"video");this.state="wait_local_media",this.waitForLocalAVStream=!0;try{const o=await this.client.getMediaHandler().getUserMediaStream(i,s);this.waitForLocalAVStream=!1;const c=[new dc({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId()??void 0,stream:o,purpose:en.Usermedia,audioMuted:!1,videoMuted:!1})];this.localScreensharingFeed&&c.push(this.localScreensharingFeed),this.answerWithCallFeeds(c)}catch(o){if(s)O.warn(`Call ${this.callId} answer() failed to getUserMedia(), trying to getUserMedia() without video`),this.state=r,this.waitForLocalAVStream=!1,await this.answer(i,!1);else{this.getUserMediaFailed(o);return}}}else this.waitForLocalAVStream&&(this.state="wait_local_media")}}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){O.debug(`Call ${this.callId} replacedBy() running (newCallId=${e.callId})`),this.state==="wait_local_media"?(O.debug(`Call ${this.callId} replacedBy() telling new call to wait for local media (newCallId=${e.callId})`),e.waitForLocalAVStream=!0):["create_offer","invite_sent"].includes(this.state)&&(e.direction==="outbound"?e.queueGotCallFeedsForAnswer([]):(O.debug(`Call ${this.callId} replacedBy() handing local stream to new call(newCallId=${e.callId})`),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(t=>t.clone())))),this.successor=e,this.emit("replaced",e,this),this.hangup("replaced",!0)}hangup(e,t){if(this.callHasEnded()||(O.debug(`Call ${this.callId} hangup() ending call (reason=${e})`),this.terminate("local",e,!t),["fledgling","wait_local_media"].includes(this.state)))return;const r={};(this.opponentVersion&&this.opponentVersion!==0||e!=="user_hangup")&&(r.reason=e),this.sendVoipEvent(ie.CallHangup,r)}reject(){if(this.state!=="ringing")throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion===0){O.info(`Call ${this.callId} reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=${this.opponentVersion})`),this.hangup("user_hangup",!0);return}O.debug("Rejecting call: "+this.callId),this.terminate("local","user_hangup",!0),this.sendVoipEvent(ie.CallReject,{})}async upgradeCall(e,t){if(!(!e&&!t)&&this.opponentSupportsSDPStreamMetadata())try{O.debug(`Call ${this.callId} upgradeCall() upgrading call (audio=${e}, video=${t})`);const r=e||this.hasLocalUserMediaAudioTrack,i=t||this.hasLocalUserMediaVideoTrack,s=await this.client.getMediaHandler().getUserMediaStream(r,i,!1);await this.updateLocalUsermediaStream(s,e,t)}catch(r){O.error(`Call ${this.callId} upgradeCall() failed to upgrade the call`,r),this.emit("error",new nc("no_user_media","Failed to get camera access: ",r),this)}}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}async setScreensharingEnabled(e,t){if(e&&this.isScreensharing())return O.warn(`Call ${this.callId} setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!`),!0;if(!e&&!this.isScreensharing())return O.warn(`Call ${this.callId} setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!`),!1;if(!this.opponentSupportsSDPStreamMetadata())return this.setScreensharingEnabledWithoutMetadataSupport(e,t);if(O.debug(`Call ${this.callId} setScreensharingEnabled() running (enabled=${e})`),e)try{const r=await this.client.getMediaHandler().getScreensharingStream(t);return r?(this.pushNewLocalFeed(r,en.Screenshare),!0):!1}catch(r){return O.error(`Call ${this.callId} setScreensharingEnabled() failed to get screen-sharing stream:`,r),!1}else{const r=this.transceivers.get(_o(en.Screenshare,"audio")),i=this.transceivers.get(_o(en.Screenshare,"video"));for(const s of[r,i])s&&s.sender&&this.peerConn.removeTrack(s.sender);return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}}async setScreensharingEnabledWithoutMetadataSupport(e,t){var r,i,s;if(O.debug(`Call ${this.callId} setScreensharingEnabledWithoutMetadataSupport() running (enabled=${e})`),e)try{const o=await this.client.getMediaHandler().getScreensharingStream(t);if(!o)return!1;const a=o.getTracks().find(l=>l.kind==="video"),c=(r=this.transceivers.get(_o(en.Usermedia,"video")))==null?void 0:r.sender;return c==null||c.replaceTrack(a??null),this.pushNewLocalFeed(o,en.Screenshare,!1),!0}catch(o){return O.error(`Call ${this.callId} setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:`,o),!1}else{const o=(i=this.localUsermediaStream)==null?void 0:i.getTracks().find(c=>c.kind==="video"),a=(s=this.transceivers.get(_o(en.Usermedia,"video")))==null?void 0:s.sender;return a==null||a.replaceTrack(o??null),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}}async updateLocalUsermediaStream(e,t=!1,r=!1){const i=this.localUsermediaFeed,s=t||!i.isAudioMuted()&&!this.remoteOnHold,o=r||!i.isVideoMuted()&&!this.remoteOnHold;O.log(`Call ${this.callId} updateLocalUsermediaStream() running (streamId=${e.id}, audio=${s}, video=${o})`),nr(e.getAudioTracks(),s),nr(e.getVideoTracks(),o);for(const a of this.localUsermediaStream.getTracks())this.localUsermediaStream.removeTrack(a),a.stop();for(const a of e.getTracks())this.localUsermediaStream.addTrack(a);for(const a of e.getTracks()){const c=_o(en.Usermedia,a.kind),l=this.transceivers.get(c),u=l==null?void 0:l.sender;let h=!1;if(u)try{O.info(`Call ${this.callId} updateLocalUsermediaStream() replacing track (id=${a.id}, kind=${a.kind}, streamId=${e.id}, streamPurpose=${i.purpose})`),await u.replaceTrack(a),l.direction=l.direction==="inactive"?"sendonly":"sendrecv",h=!0}catch(p){O.warn(`Call ${this.callId} updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead`,p)}if(!h){O.info(`Call ${this.callId} updateLocalUsermediaStream() adding track to peer connection (id=${a.id}, kind=${a.kind}, streamId=${e.id}, streamPurpose=${i.purpose})`);const p=this.peerConn.addTrack(a,this.localUsermediaStream),m=this.peerConn.getTransceivers().find(v=>v.sender===p);m?this.transceivers.set(c,m):O.warn(`Call ${this.callId} updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!`)}}}async setLocalVideoMuted(e){var t,r;if(O.log(`Call ${this.callId} setLocalVideoMuted() running ${e}`),!e&&this.stopVideoTrackTimer!==void 0&&(clearTimeout(this.stopVideoTrackTimer),this.stopVideoTrackTimer=void 0),!await this.client.getMediaHandler().hasVideoDevice())return this.isLocalVideoMuted();if(!this.hasUserMediaVideoSender&&!e)return(t=this.localUsermediaFeed)==null||t.setAudioVideoMuted(null,e),await this.upgradeCall(!1,!0),this.isLocalVideoMuted();if(!e&&this.localUsermediaStream.getVideoTracks().length===0){const i=await this.client.getMediaHandler().getUserMediaStream(!0,!0);await this.updateLocalUsermediaStream(i)}return(r=this.localUsermediaFeed)==null||r.setAudioVideoMuted(null,e),this.updateMuteStatus(),await this.sendMetadataUpdate(),e&&(this.stopVideoTrackTimer=setTimeout(()=>{for(const i of this.localUsermediaStream.getVideoTracks())i.stop(),this.localUsermediaStream.removeTrack(i)},120)),this.isLocalVideoMuted()}isLocalVideoMuted(){var e;return((e=this.localUsermediaFeed)==null?void 0:e.isVideoMuted())??!1}async setMicrophoneMuted(e){var t;return O.log(`Call ${this.callId} setMicrophoneMuted() running ${e}`),await this.client.getMediaHandler().hasAudioDevice()?!e&&(!this.hasUserMediaAudioSender||!this.hasLocalUserMediaAudioTrack)?(await this.upgradeCall(!0,!1),this.isMicrophoneMuted()):((t=this.localUsermediaFeed)==null||t.setAudioVideoMuted(e,null),this.updateMuteStatus(),await this.sendMetadataUpdate(),this.isMicrophoneMuted()):this.isMicrophoneMuted()}isMicrophoneMuted(){var e;return((e=this.localUsermediaFeed)==null?void 0:e.isAudioMuted())??!1}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(const t of this.peerConn.getTransceivers())t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit("remote_hold_unhold",this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!=="connected")return!1;let e=!0;for(const t of this.peerConn.getTransceivers())["inactive","recvonly"].includes(t.currentDirection)||(e=!1);return e}sendDtmfDigit(e){var t;for(const r of this.peerConn.getSenders())if(((t=r.track)==null?void 0:t.kind)==="audio"&&r.dtmf){r.dtmf.insertDTMF(e);return}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){const e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;O.log(`Call ${this.callId} updateMuteStatus stream ${this.localUsermediaStream.id} micShouldBeMuted ${e} vidShouldBeMuted ${t}`),nr(this.localUsermediaStream.getAudioTracks(),!e),nr(this.localUsermediaStream.getVideoTracks(),!t)}async sendMetadataUpdate(){await this.sendVoipEvent(ie.CallSDPStreamMetadataChangedPrefix,{[hl]:this.getLocalSDPStreamMetadata()})}gotCallFeedsForInvite(e,t=!1){if(this.successor){this.successor.queueGotCallFeedsForAnswer(e);return}if(this.callHasEnded()){this.stopAllMedia();return}for(const r of e)this.pushLocalFeed(r);t&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state="create_offer",O.debug(`Call ${this.callId} gotUserMediaForInvite() run`)}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type},[hl]:this.getLocalSDPStreamMetadata(!0)};e.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1};const t=this.discardDuplicateCandidates();O.info(`Call ${this.callId} sendAnswer() discarding ${t} candidates that will be sent in answer`);try{await this.sendVoipEvent(ie.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(r){this.state="ringing",r instanceof gn&&r.event&&this.client.cancelPendingEvent(r.event);let i="send_answer",s="Failed to send answer";throw r.name=="UnknownDeviceError"&&(i="unknown_devices",s="Unknown devices present in the room"),this.emit("error",new nc(i,s,r),this),r}this.sendCandidateQueue()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(e)):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,t){const r=WR.parse(e.sdp);r.media.forEach(i=>{const s=new Map,o=new Map;for(const a of i.rtp)s.set(a.payload,a.codec),o.set(a.codec,a.payload);for(const a of t){if(a.mediaType!==i.type)continue;if(!o.has(a.codec)){O.info(`Call ${this.callId} mungeSdp() ignoring SDP modifications for ${a.codec} as it's not present.`);continue}const c=[];a.enableDtx!==void 0&&c.push(`usedtx=${a.enableDtx?"1":"0"}`),a.maxAverageBitrate!==void 0&&c.push(`maxaveragebitrate=${a.maxAverageBitrate}`);let l=!1;for(const u of i.fmtp)s.get(u.payload)===a.codec&&(l=!0,u.config+=";"+c.join(";"));l||i.fmtp.push({payload:o.get(a.codec),config:c.join(";")})}}),e.sdp=WR.write(r)}async createOffer(){const e=await this.peerConn.createOffer();return this.mungeSdp(e,S5(this.isPtt)),e}async createAnswer(){const e=await this.peerConn.createAnswer();return this.mungeSdp(e,S5(this.isPtt)),e}async gotCallFeedsForAnswer(e){if(this.callHasEnded())return;this.waitForLocalAVStream=!1;for(const r of e)this.pushLocalFeed(r);this.state="create_answer";let t;try{this.getRidOfRTXCodecs(),t=await this.createAnswer()}catch(r){O.debug(`Call ${this.callId} gotCallFeedsForAnswer() failed to create answer: `,r),this.terminate("local","create_answer",!0);return}try{if(await this.peerConn.setLocalDescription(t),this.callHasEnded()||(this.state="connecting",await new Promise(r=>{setTimeout(r,200)}),this.callHasEnded()))return;this.sendAnswer()}catch(r){O.debug(`Call ${this.callId} gotCallFeedsForAnswer() error setting local description!`,r),this.terminate("local","set_local_description",!0);return}}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent(),r=t.candidates;if(!r){O.info(`Call ${this.callId} onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!`);return}const i=t.version===0?null:t.party_id||null;if(this.opponentPartyId===void 0){if(i){O.info(`Call ${this.callId} onRemoteIceCandidatesReceived() buffering ${r.length} candidates until we pick an opponent`);const s=this.remoteCandidateBuffer.get(i)||[];s.push(...r),this.remoteCandidateBuffer.set(i,s)}return}if(!this.partyIdMatches(t)){O.info(`Call ${this.callId} onRemoteIceCandidatesReceived() ignoring candidates from party ID ${t.party_id}: we have chosen party ID ${this.opponentPartyId}`);return}await this.addIceCandidates(r)}async onAnswerReceived(e){const t=e.getContent();if(O.debug(`Call ${this.callId} onAnswerReceived() running (hangupParty=${t.party_id})`),this.callHasEnded()){O.debug(`Call ${this.callId} onAnswerReceived() ignoring answer because call has ended`);return}if(this.opponentPartyId!==void 0){O.info(`Call ${this.callId} onAnswerReceived() ignoring answer from party ID ${t.party_id}: we already have an answer/reject from ${this.opponentPartyId}`);return}this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.state="connecting";const r=t[hl];r?this.updateRemoteSDPStreamMetadata(r):O.warn(`Call ${this.callId} onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams`);try{this.isSettingRemoteAnswerPending=!0,await this.peerConn.setRemoteDescription(t.answer),this.isSettingRemoteAnswerPending=!1,O.debug(`Call ${this.callId} onAnswerReceived() set remote description: ${t.answer.type}`)}catch(i){this.isSettingRemoteAnswerPending=!1,O.debug(`Call ${this.callId} onAnswerReceived() failed to set remote description`,i),this.terminate("local","set_remote_description",!1);return}if(this.opponentPartyId!==null)try{await this.sendVoipEvent(ie.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(i){O.warn(`Call ${this.callId} onAnswerReceived() failed to send select_answer event`,i)}}async onSelectAnswerReceived(e){if(this.direction!=="inbound"){O.warn(`Call ${this.callId} onSelectAnswerReceived() got select_answer for an outbound call: ignoring`);return}const t=e.getContent().selected_party_id;if(t==null){O.warn(`Call ${this.callId} onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring`);return}t!==this.ourPartyId&&(O.info(`Call ${this.callId} onSelectAnswerReceived() got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),await this.terminate("remote","answered_elsewhere",!0))}async onNegotiateReceived(e){var u;const t=e.getContent(),r=t.description;if(!r||!r.sdp||!r.type){O.info(`Call ${this.callId} onNegotiateReceived() ignoring invalid m.call.negotiate event`);return}const i=this.direction==="inbound",s=!this.makingOffer&&(this.peerConn.signalingState==="stable"||this.isSettingRemoteAnswerPending),o=r.type==="offer"&&!s;if(this.ignoreOffer=!i&&o,this.ignoreOffer){O.info(`Call ${this.callId} onNegotiateReceived() ignoring colliding negotiate event because we're impolite`);return}const a=this.isLocalOnHold(),c=t[hl];c?this.updateRemoteSDPStreamMetadata(c):O.warn(`Call ${this.callId} onNegotiateReceived() received negotiation event without SDPStreamMetadata!`);try{if(this.isSettingRemoteAnswerPending=r.type=="answer",await this.peerConn.setRemoteDescription(r),this.isSettingRemoteAnswerPending=!1,O.debug(`Call ${this.callId} onNegotiateReceived() set remote description: ${r.type}`),r.type==="offer"){let h;try{this.getRidOfRTXCodecs(),h=await this.createAnswer()}catch(p){O.debug(`Call ${this.callId} onNegotiateReceived() failed to create answer: `,p),this.terminate("local","create_answer",!0);return}await this.peerConn.setLocalDescription(h),O.debug(`Call ${this.callId} onNegotiateReceived() create an answer`),this.sendVoipEvent(ie.CallNegotiate,{lifetime:NT,description:(u=this.peerConn.localDescription)==null?void 0:u.toJSON(),[hl]:this.getLocalSDPStreamMetadata(!0)})}}catch(h){this.isSettingRemoteAnswerPending=!1,O.warn(`Call ${this.callId} onNegotiateReceived() failed to complete negotiation`,h)}const l=this.isLocalOnHold();a!==l&&(this.emit("local_hold_unhold",l,this),this.emit("hold_unhold",l))}updateRemoteSDPStreamMetadata(e){var t;this.remoteSDPStreamMetadata=yj(this.remoteSDPStreamMetadata||{},e,!0);for(const r of this.getRemoteFeeds()){const i=r.stream.id,s=this.remoteSDPStreamMetadata[i];r.setAudioVideoMuted(s==null?void 0:s.audio_muted,s==null?void 0:s.video_muted),r.purpose=(t=this.remoteSDPStreamMetadata[i])==null?void 0:t.purpose}}onSDPStreamMetadataChangedReceived(e){const r=e.getContent()[hl];this.updateRemoteSDPStreamMetadata(r)}async onAssertedIdentityReceived(e){const t=e.getContent();t.asserted_identity&&(this.remoteAssertedIdentity={id:t.asserted_identity.id,displayName:t.asserted_identity.display_name},this.emit("asserted_identity_changed",this))}callHasEnded(){return this.state==="ended"}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.responsePromiseChain=this.wrappedGotLocalOffer()}async wrappedGotLocalOffer(){this.makingOffer=!0;try{await this.gotLocalOffer()}catch(e){this.getLocalOfferFailed(e);return}finally{this.makingOffer=!1}}async gotLocalOffer(){var s,o;if(O.debug(`Call ${this.callId} gotLocalOffer() running`),this.callHasEnded()){O.debug(`Call ${this.callId} gotLocalOffer() ignoring newly created offer because the call has ended"`);return}let e;try{this.getRidOfRTXCodecs(),e=await this.createOffer()}catch(a){O.debug(`Call ${this.callId} gotLocalOffer() failed to create offer: `,a),this.terminate("local","create_offer",!0);return}try{await this.peerConn.setLocalDescription(e)}catch(a){O.debug(`Call ${this.callId} gotLocalOffer() error setting local description!`,a),this.terminate("local","set_local_description",!0);return}if(this.peerConn.iceGatheringState==="gathering"&&await new Promise(a=>{setTimeout(a,200)}),this.callHasEnded())return;const t=this.state==="create_offer"?ie.CallInvite:ie.CallNegotiate,r={lifetime:NT};t===ie.CallInvite&&this.invitee&&(r.invitee=this.invitee),this.state==="create_offer"?r.offer=(s=this.peerConn.localDescription)==null?void 0:s.toJSON():r.description=(o=this.peerConn.localDescription)==null?void 0:o.toJSON(),r.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},r[hl]=this.getLocalSDPStreamMetadata(!0);const i=this.discardDuplicateCandidates();O.info(`Call ${this.callId} gotLocalOffer() discarding ${i} candidates that will be sent in offer`);try{await this.sendVoipEvent(t,r)}catch(a){O.error(`Call ${this.callId} gotLocalOffer() failed to send invite`,a),a instanceof gn&&a.event&&this.client.cancelPendingEvent(a.event);let c="signalling_timeout",l="Signalling failed";this.state==="create_offer"&&(c="send_invite",l="Failed to send invite"),a.name=="UnknownDeviceError"&&(c="unknown_devices",l="Unknown devices present in the room"),this.emit("error",new nc(c,l,a),this),this.terminate("local",c,!1);return}this.sendCandidateQueue(),this.state==="create_offer"&&(this.inviteOrAnswerSent=!0,this.state="invite_sent",this.inviteTimeout=setTimeout(()=>{this.inviteTimeout=void 0,this.state==="invite_sent"&&this.hangup("invite_timeout",!1)},NT))}getRidOfRTXCodecs(){if(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)return;const e=this.transceivers.get(_o(en.Screenshare,"video"));if(!e||!e.setCodecPreferences)return;const t=RTCRtpReceiver.getCapabilities("video").codecs,r=RTCRtpSender.getCapabilities("video").codecs,i=[];for(const s of[...t,...r])if(s.mimeType!=="video/rtx"){i.push(s);try{e.setCodecPreferences(i)}catch(o){O.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",s,o),i.pop()}}}async sendVoipEvent(e,t){var i,s;const r={...t,version:Ose,call_id:this.callId,party_id:this.ourPartyId,conf_id:this.groupCallId};if(this.opponentDeviceId){const o=this.toDeviceSeq++,a={...r,device_id:this.client.deviceId,sender_session_id:this.client.getSessionId(),dest_session_id:this.opponentSessionId,seq:o,[aw]:cse()};this.emit("send_voip_event",{type:"toDevice",eventType:e,userId:this.invitee||((i=this.getOpponentMember())==null?void 0:i.userId),opponentDeviceId:this.opponentDeviceId,content:a},this);const c=this.invitee||this.getOpponentMember().userId;if(this.client.getUseE2eForGroupCall()){if(!this.hasOpponentDeviceInfo){O.warn(`Call ${this.callId} sendVoipEvent() failed: we do not have opponentDeviceInfo`);return}throw new Error("Unimplemented")}else await this.client.sendToDevice(e,new Map([[c,new Map([[this.opponentDeviceId,a]])]]))}else this.emit("send_voip_event",{type:"sendEvent",eventType:e,roomId:this.roomId,content:r,userId:this.invitee||((s=this.getOpponentMember())==null?void 0:s.userId)},this),await this.client.sendEvent(this.roomId,e,r)}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state==="ringing"||!this.inviteOrAnswerSent)return;const t=this.direction==="inbound"?500:2e3;this.candidateSendTries===0&&setTimeout(()=>{this.sendCandidateQueue()},t)}discardDuplicateCandidates(){let e=0;const t=[];for(let r=0;r<this.candidateSendQueue.length;r++){const i=this.candidateSendQueue[r];i.candidate===""?t.push(i):e++}return this.candidateSendQueue=t,e}async transfer(e){const t=await this.client.getProfileInfo(e),r=Wu(),i={replacement_id:Wu(),target_user:{id:e,display_name:t.displayname,avatar_url:t.avatar_url},create_call:r};await this.sendVoipEvent(ie.CallReplaces,i),await this.terminate("local","transferred",!0)}async transferToCall(e){var l,u;const t=(l=e.getOpponentMember())==null?void 0:l.userId,r=t?await this.client.getProfileInfo(t):void 0,i=(u=this.getOpponentMember())==null?void 0:u.userId,s=i?await this.client.getProfileInfo(i):void 0,o=Wu(),a={replacement_id:Wu(),target_user:{id:i,display_name:s==null?void 0:s.displayname,avatar_url:s==null?void 0:s.avatar_url},await_call:o};await e.sendVoipEvent(ie.CallReplaces,a);const c={replacement_id:Wu(),target_user:{id:t,display_name:r==null?void 0:r.displayname,avatar_url:r==null?void 0:r.avatar_url},create_call:o};await this.sendVoipEvent(ie.CallReplaces,c),await this.terminate("local","transferred",!0),await e.terminate("local","transferred",!0)}async terminate(e,t,r){var i;if(!this.callHasEnded()){this.hangupParty=e,this.hangupReason=t,this.state="ended",this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=void 0),this.iceDisconnectedTimeout!==void 0&&(clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=void 0),this.stopVideoTrackTimer!==void 0&&(clearTimeout(this.stopVideoTrackTimer),this.stopVideoTrackTimer=void 0);for(const[s,o]of this.removeTrackListeners)s.removeEventListener("removetrack",o);this.removeTrackListeners.clear(),this.callStatsAtEnd=await this.collectCallStats(),this.stopAllMedia(),this.deleteAllFeeds(),this.peerConn&&this.peerConn.signalingState!=="closed"&&this.peerConn.close(),(i=this.stats)==null||i.removeStatsReportGatherer(this.callId),r&&this.emit("hangup",this),this.client.callEventHandler.calls.delete(this.callId)}}stopAllMedia(){O.debug(`Call ${this.callId} stopAllMedia() running`);for(const e of this.feeds)if(e.isLocal()&&e.purpose===en.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===en.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal()){O.debug(`Call ${this.callId} stopAllMedia() stopping stream (streamId=${e.stream.id})`);for(const t of e.stream.getTracks())t.stop()}}checkForErrorListener(){if(this.listeners(tP.Error).length===0)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(this.candidateSendQueue.length===0||this.callHasEnded())return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e.map(r=>r.toJSON())};this.candidatesEnded&&t.candidates.push({candidate:""}),O.debug(`Call ${this.callId} sendCandidateQueue() attempting to send ${e.length} candidates`);try{await this.sendVoipEvent(ie.CallCandidates,t),this.candidateSendTries=0,this.sendCandidateQueue()}catch(r){if(r instanceof gn&&r.event&&this.client.cancelPendingEvent(r.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){O.debug(`Call ${this.callId} sendCandidateQueue() failed to send candidates on attempt ${this.candidateSendTries}. Giving up on this call.`,r);const s="signalling_timeout",o="Signalling failed";this.emit("error",new nc(s,o,r),this),this.hangup(s,!1);return}const i=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,O.debug(`Call ${this.callId} sendCandidateQueue() failed to send candidates. Retrying in ${i}ms`,r),setTimeout(()=>{this.sendCandidateQueue()},i)}}async placeCall(e,t){if(!e)throw new Error("You CANNOT start a call without audio");this.state="wait_local_media";let r;try{const i=await this.client.getMediaHandler().getUserMediaStream(e,t);nr(i.getAudioTracks(),!0),nr(i.getVideoTracks(),!0),r=new dc({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId()??void 0,stream:i,purpose:en.Usermedia,audioMuted:!1,videoMuted:!1})}catch(i){this.getUserMediaFailed(i);return}try{await this.placeCallWithCallFeeds([r])}catch(i){this.placeCallFailed(i);return}}async placeCallWithCallFeeds(e,t=!1){this.checkForErrorListener(),this.direction="outbound",await this.initOpponentCrypto(),this.client.callEventHandler.calls.set(this.callId,this),await this.client.checkTurnServers()||O.warn(`Call ${this.callId} placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...`),this.peerConn=this.createPeerConnection(),this.emit("peer_connection_created",this.peerConn,this),this.gotCallFeedsForInvite(e,t)}createPeerConnection(){var i;const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel);const t=this.getOpponentMember(),r=t?t.userId:"unknown";return(i=this.stats)==null||i.addStatsReportGatherer(this.callId,r,e),e}partyIdMatches(e){return(e.version===0?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){var r;const t=e.getContent();O.debug(`Call ${this.callId} chooseOpponent() running (partyId=${t.party_id})`),this.opponentVersion=t.version,this.opponentVersion===0?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=this.client.getRoom(this.roomId).getMember(e.getSender())??void 0,this.opponentMember&&((r=this.stats)==null||r.updateOpponentMember(this.callId,this.opponentMember.userId))}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(O.info(`Call ${this.callId} addBufferedIceCandidates() adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer.clear()}async addIceCandidates(e){for(const t of e){(t.sdpMid===null||t.sdpMid===void 0)&&(t.sdpMLineIndex===null||t.sdpMLineIndex===void 0)?O.debug(`Call ${this.callId} addIceCandidates() got remote ICE end-of-candidates`):O.debug(`Call ${this.callId} addIceCandidates() got remote ICE candidate (sdpMid=${t.sdpMid}, candidate=${t.candidate})`);try{await this.peerConn.addIceCandidate(t)}catch(r){this.ignoreOffer?O.debug(`Call ${this.callId} addIceCandidates() failed to add remote ICE candidate because ignoring offer`,r):O.info(`Call ${this.callId} addIceCandidates() failed to add remote ICE candidate`,r)}}}get hasPeerConnection(){return!!this.peerConn}initStats(e,t="unknown"){this.stats=e,this.stats.start()}}function nr(n,e){for(const t of n)t.enabled=e}function QR(){if(typeof window>"u"||typeof document>"u")return!1;try{if(!!!(window.RTCPeerConnection??window.RTCSessionDescription??window.RTCIceCandidate??navigator.mediaDevices))return O.error("WebRTC is not supported in this browser / environment"),!1}catch(n){return O.error("Exception thrown when trying to access WebRTC",n),!1}return!0}function av(n,e,t){if(!QR())return null;const r=t?t.forceTURN:!1,i={client:n,roomId:e,invitee:t==null?void 0:t.invitee,turnServers:n.getTurnServers(),forceTURN:n.forceTURN||r,opponentDeviceId:t==null?void 0:t.opponentDeviceId,opponentSessionId:t==null?void 0:t.opponentSessionId,groupCallId:t==null?void 0:t.groupCallId},s=new jse(i);return n.reEmitter.reEmit(s,Object.values(Bi)),s}var bc=(n=>(n.DontNotify="dont_notify",n.Notify="notify",n.Coalesce="coalesce",n))(bc||{}),pw=(n=>(n.Highlight="highlight",n.Sound="sound",n))(pw||{}),M$=(n=>(n.ExactEquals="==",n.LessThan="<",n.GreaterThan=">",n.GreaterThanOrEqual=">=",n.LessThanOrEqual="<=",n))(M$||{});const $se="2";function Bse(n){return n==="==2"||n==="2"}var Vn=(n=>(n.EventMatch="event_match",n.EventPropertyIs="event_property_is",n.EventPropertyContains="event_property_contains",n.ContainsDisplayName="contains_display_name",n.RoomMemberCount="room_member_count",n.SenderNotificationPermission="sender_notification_permission",n.CallStarted="call_started",n.CallStartedPrefix="org.matrix.msc3914.call_started",n))(Vn||{}),mr=(n=>(n.Override="override",n.ContentSpecific="content",n.RoomSpecific="room",n.SenderSpecific="sender",n.Underride="underride",n))(mr||{}),pr=(n=>(n.Master=".m.rule.master",n.IsUserMention=".m.rule.is_user_mention",n.IsRoomMention=".m.rule.is_room_mention",n.ContainsDisplayName=".m.rule.contains_display_name",n.ContainsUserName=".m.rule.contains_user_name",n.AtRoomNotification=".m.rule.roomnotif",n.DM=".m.rule.room_one_to_one",n.EncryptedDM=".m.rule.encrypted_room_one_to_one",n.Message=".m.rule.message",n.EncryptedMessage=".m.rule.encrypted",n.InviteToSelf=".m.rule.invite_for_me",n.MemberEvent=".m.rule.member_event",n.IncomingCall=".m.rule.call",n.SuppressNotices=".m.rule.suppress_notices",n.Tombstone=".m.rule.tombstone",n.PollStart=".m.rule.poll_start",n.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",n.PollEnd=".m.rule.poll_end",n.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",n.PollStartOneToOne=".m.rule.poll_start_one_to_one",n.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",n.PollEndOneToOne=".m.rule.poll_end_one_to_one",n.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",n))(pr||{});const w5=[mr.Override,mr.ContentSpecific,mr.RoomSpecific,mr.SenderSpecific,mr.Underride],Hse={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:Vn.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:Vn.SenderNotificationPermission,key:"room"}],actions:[bc.Notify,{set_tweak:pw.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:Vn.EventMatch,key:"type",pattern:"m.reaction"}],actions:[bc.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:Vn.EventMatch,key:"type",pattern:ie.RoomServerAcl},{kind:Vn.EventMatch,key:"state_key",pattern:""}],actions:[]}},EP=Symbol("UserDefinedRules"),Vse=[pr.Master,EP,pr.SuppressNotices,pr.InviteToSelf,pr.MemberEvent,pr.IsUserMention,pr.ContainsDisplayName,pr.IsRoomMention,pr.AtRoomNotification,pr.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],Gse={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:Vn.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:Vn.CallStarted}],actions:[bc.Notify,{set_tweak:pw.Sound,value:"default"}]}},qse=[EP,pr.IncomingCall,".org.matrix.msc3914.rule.room.call",pr.EncryptedDM,pr.DM,pr.Message,pr.EncryptedMessage];function E5(n,e,t,r){const i=e.filter(l=>l.default),s=e.filter(l=>!l.default);function o(l){l===EP?c.push(...s):l in t?(O.warn(`Adding default global ${n} push rule ${l}`),c.push(t[l])):O.warn(`Missing default global ${n} push rule ${l}`)}let a=0;const c=[];for(const l of i){const u=r.indexOf(l.rule_id);if(u===-1){c.push(l);continue}for(;u>a;){const h=r[a];o(h),a+=1}c.push(l),a+=1}for(const l of r.slice(a))o(l);return c}const fa=class fa{constructor(e){this.client=e,this.parsedKeys=new Map}static actionListToActionsObject(e){const t={notify:!1,tweaks:{}};for(const r of e)r===bc.Notify?t.notify=!0:typeof r=="object"&&(r.value===void 0&&(r.value=!0),t.tweaks[r.set_tweak]=r.value);return t}static rewriteDefaultRules(e,t=void 0){let r=JSON.parse(JSON.stringify(e));return r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.underride||(r.global.underride=[]),r.global.override=E5(mr.Override,r.global.override,Hse,Vse),r.global.underride=E5(mr.Underride,r.global.underride,Gse,qse),r}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);const t=new Set(this.parsedKeys.keys());for(const r of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(const i of r)if(i.conditions)for(const s of i.conditions)s.kind===Vn.EventMatch&&(t.delete(s.key),this.parsedKeys.set(s.key,fa.partsForDottedKey(s.key)));t.forEach(r=>this.parsedKeys.delete(r))}matchingRuleFromKindSet(e,t){for(const r of w5){const i=t[r];if(i)for(const s of i){if(!s.enabled)continue;const o=this.templateRuleToRaw(r,s);if(o&&this.ruleMatchesEvent(o,e))return{...s,kind:r}}}return null}templateRuleToRaw(e,t){const r={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case mr.Underride:case mr.Override:r.conditions=t.conditions;break;case mr.RoomSpecific:if(!t.rule_id)return null;r.conditions.push({kind:Vn.EventMatch,key:"room_id",value:t.rule_id});break;case mr.SenderSpecific:if(!t.rule_id)return null;r.conditions.push({kind:Vn.EventMatch,key:"user_id",value:t.rule_id});break;case mr.ContentSpecific:if(!t.pattern)return null;r.conditions.push({kind:Vn.EventMatch,key:"content.body",pattern:t.pattern});break}return r}eventFulfillsCondition(e,t){switch(e.kind){case Vn.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case Vn.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,t);case Vn.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,t);case Vn.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case Vn.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case Vn.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t);case Vn.CallStarted:case Vn.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){const r=e.key;if(!r)return!1;const i=this.client.getRoom(t.getRoomId());return i!=null&&i.currentState?i.currentState.mayTriggerNotifOfType(r,t.getSender()):!1}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;const r=this.client.getRoom(t.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;const i=r.currentState.getJoinedMemberCount(),s=e.is.match(/^([=<>]*)(\d*)$/);if(!s)return!1;const o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}}eventFulfillsDisplayNameCondition(e,t){var c;let r=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(r=t.getClearContent()),!r||!r.body||typeof r.body!="string")return!1;const i=this.client.getRoom(t.getRoomId()),s=(c=i==null?void 0:i.currentState)==null?void 0:c.getMember(this.client.credentials.userId);if(!s)return!1;const o=s.name,a=new RegExp("(^|\\W)"+mj(o)+"(\\W|$)","i");return r.body.search(a)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;const r=this.valueForDottedKey(e.key,t);if(typeof r!="string")return!1;if(e.value)return e.value===r;if(typeof e.pattern!="string")return!1;const i=e.key==="content.body"?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$");return!!r.match(i)}eventFulfillsEventPropertyIsCondition(e,t){return!e.key||e.value===void 0?!1:e.value===this.valueForDottedKey(e.key,t)}eventFulfillsEventPropertyContains(e,t){if(!e.key||e.value===void 0)return!1;const r=this.valueForDottedKey(e.key,t);return Array.isArray(r)?r.includes(e.value):!1}eventFulfillsCallStartedCondition(e,t){return["m.ring","m.prompt"].includes(t.getContent()["m.intent"])&&!("m.terminated"in t.getContent())&&(t.getPrevContent()["m.terminated"]!==t.getContent()["m.terminated"]||Cd(t.getPrevContent(),{}))}createCachedRegex(e,t,r){return fa.cachedGlobToRegex[t]||(fa.cachedGlobToRegex[t]=new RegExp(e+gj(t)+r,"i")),fa.cachedGlobToRegex[t]}static partsForDottedKey(e){const t=[];let r="",i=!1;for(const s of e){if(i){s==="\\"||s==="."?r+=s:r+="\\"+s,i=!1;continue}s=="."?(t.push(r),r=""):s=="\\"?i=!0:r+=s}return i&&(r+="\\"),t.push(r),t}valueForDottedKey(e,t){let r=this.parsedKeys.get(e);r===void 0&&(r=fa.partsForDottedKey(e),this.parsedKeys.set(e,r));let i;const s=r[0];let o=0;for(s==="content"?(i=t.getContent(),++o):s==="type"?(i=t.getType(),++o):i=t.event;o<r.length;++o){if(vj(i))return;const a=r[o];i=i[a]}return i}matchingRuleForEventWithRulesets(e,t){return!t||e.getSender()===this.client.getSafeUserId()?null:this.matchingRuleFromKindSet(e,t.global)}pushActionsForEventAndRulesets(e,t){const r=this.matchingRuleForEventWithRulesets(e,t);if(!r)return{};const i=fa.actionListToActionsObject(r.actions);return i.tweaks.highlight===void 0&&(i.tweaks.highlight=r.kind==mr.ContentSpecific),{actions:i,rule:r}}ruleMatchesEvent(e,t){var r;return this.client.supportsIntentionalMentions()&&t.getContent()["m.mentions"]!==void 0&&(e.rule_id===pr.ContainsUserName||e.rule_id===pr.ContainsDisplayName||e.rule_id===pr.AtRoomNotification)?!1:!((r=e.conditions)!=null&&r.some(i=>!this.eventFulfillsCondition(i,t)))}actionsForEvent(e){const{actions:t}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return t||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){const t=this.getPushRuleAndKindById(e);return(t==null?void 0:t.rule)??null}getPushRuleAndKindById(e){var t;for(const r of["global"])if(((t=this.client.pushRules)==null?void 0:t[r])!==void 0){for(const i of w5)if(this.client.pushRules[r][i]!==void 0){for(const s of this.client.pushRules[r][i])if(s.rule_id===e)return{rule:s,kind:i}}}return null}};fa.cachedGlobToRegex={};let Mb=fa;const cv=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],Kse=cv[0],Wse=cv[cv.length-1];var O$=(n=>(n.SUCCESS="SUCCESS",n.IGNORE="IGNORE",n.PROMPT="PROMPT",n.FAIL_PROMPT="FAIL_PROMPT",n.FAIL_ERROR="FAIL_ERROR",n))(O$||{}),CP=(n=>(n.Invalid="Invalid homeserver discovery response",n.GenericFailure="Failed to get autodiscovery configuration from server",n.InvalidHsBaseUrl="Invalid base_url for m.homeserver",n.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",n.InvalidIsBaseUrl="Invalid base_url for m.identity_server",n.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",n.InvalidIs="Invalid identity server discovery response",n.MissingWellknown="No .well-known JSON file found",n.InvalidJson="Invalid JSON",n.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",n))(CP||{});const lt=class lt{static async fromDiscoveryConfig(e){var c;const t={"m.homeserver":{state:lt.FAIL_ERROR,error:lt.ERROR_INVALID,base_url:null},"m.identity_server":{state:lt.PROMPT,error:null,base_url:null}};if(!(e!=null&&e["m.homeserver"]))return O.error("No m.homeserver key in config"),t["m.homeserver"].state=lt.FAIL_PROMPT,t["m.homeserver"].error=lt.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return O.error("No m.homeserver base_url in config"),t["m.homeserver"].state=lt.FAIL_PROMPT,t["m.homeserver"].error=lt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const r=this.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!r)return O.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=lt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const i=await this.fetchWellKnownObject(`${r}/_matrix/client/versions`);if(!i||!Array.isArray((c=i.raw)==null?void 0:c.versions))return O.error("Invalid /versions response"),t["m.homeserver"].error=lt.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=r,Promise.resolve(t);const s=new Set(i.raw.versions);let o=!1;for(const l of cv)if(s.has(l)){o=!0;break}if(!o)return O.error("Homeserver does not meet version requirements"),t["m.homeserver"].error=lt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,t["m.homeserver"].base_url=r,Promise.resolve(t);t["m.homeserver"]={state:lt.SUCCESS,error:null,base_url:r};let a="";if(e["m.identity_server"]){const l={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:lt.FAIL_PROMPT,error:lt.ERROR_INVALID_IS,base_url:null}};if(a=this.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!a)return O.error("Invalid base_url for m.identity_server"),l["m.identity_server"].error=lt.ERROR_INVALID_IS_BASE_URL,Promise.resolve(l);const u=await this.fetchWellKnownObject(`${a}/_matrix/identity/v2`);if(!(u!=null&&u.raw)||u.action!=="SUCCESS")return O.error("Invalid /v2 response"),l["m.identity_server"].error=lt.ERROR_INVALID_IDENTITY_SERVER,l["m.identity_server"].base_url=a,Promise.resolve(l)}return a&&a.toString().length>0&&(t["m.identity_server"]={state:lt.SUCCESS,error:null,base_url:a}),Object.keys(e).forEach(l=>{if(l==="m.homeserver"||l==="m.identity_server"){const u=["error","state","base_url"];for(const h of Object.keys(e[l]))u.includes(h)||(t[l][h]=e[l][h])}else t[l]=e[l]}),Promise.resolve(t)}static async findClientConfig(e){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:lt.FAIL_ERROR,error:lt.ERROR_INVALID,base_url:null},"m.identity_server":{state:lt.PROMPT,error:null,base_url:null}},r=e.includes("://")?e:`https://${e}`,i=await this.fetchWellKnownObject(`${r}/.well-known/matrix/client`);return!i||i.action!=="SUCCESS"?(O.error("No response or error when parsing .well-known"),i.reason&&O.error(i.reason),i.action==="IGNORE"?t["m.homeserver"]={state:lt.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=lt.FAIL_PROMPT,t["m.homeserver"].error=lt.ERROR_INVALID),Promise.resolve(t)):lt.fromDiscoveryConfig(i.raw)}static async getRawClientConfig(e){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");const t=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t?t.raw??{}:{}}static sanitizeWellKnownUrl(e){if(!e)return!1;try{let t;try{t=new URL(e)}catch(o){O.error("Could not parse url",o)}if(!(t!=null&&t.hostname)||t.protocol!=="http:"&&t.protocol!=="https:")return!1;const r=t.port?`:${t.port}`:"",i=t.pathname?t.pathname:"";let s=`${t.protocol}//${t.hostname}${r}${i}`;return s.endsWith("/")&&(s=s.substring(0,s.length-1)),s}catch(t){return O.error(t),!1}}static fetch(e,t){return this.fetchFn?this.fetchFn(e,t):globalThis.fetch(e,t)}static setFetchFn(e){lt.fetchFn=e}static async fetchWellKnownObject(e){let t;try{if(t=await lt.fetch(e,{method:de.Get,signal:lw(5e3)}),t.status===404)return{raw:{},action:"IGNORE",reason:lt.ERROR_MISSING_WELLKNOWN};if(!t.ok)return{raw:{},action:"FAIL_PROMPT",reason:"General failure"}}catch(r){const i=r;let s="";return typeof i=="object"&&(s=i==null?void 0:i.message),{error:i,raw:{},action:"FAIL_PROMPT",reason:s||"General failure"}}try{return{raw:await t.json(),action:"SUCCESS"}}catch(r){const i=r;return{error:i,raw:{},action:"FAIL_PROMPT",reason:(i==null?void 0:i.name)==="SyntaxError"?lt.ERROR_INVALID_JSON:lt.ERROR_INVALID}}}};lt.ERROR_INVALID="Invalid homeserver discovery response",lt.ERROR_GENERIC_FAILURE="Failed to get autodiscovery configuration from server",lt.ERROR_INVALID_HS_BASE_URL="Invalid base_url for m.homeserver",lt.ERROR_INVALID_HOMESERVER="Homeserver URL does not appear to be a valid Matrix homeserver",lt.ERROR_INVALID_IS_BASE_URL="Invalid base_url for m.identity_server",lt.ERROR_INVALID_IDENTITY_SERVER="Identity server URL does not appear to be a valid identity server",lt.ERROR_INVALID_IS="Invalid identity server discovery response",lt.ERROR_MISSING_WELLKNOWN="No .well-known JSON file found",lt.ERROR_INVALID_JSON="Invalid JSON",lt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION="The homeserver does not meet the version requirements",lt.ALL_ERRORS=Object.keys(CP),lt.FAIL_ERROR="FAIL_ERROR",lt.FAIL_PROMPT="FAIL_PROMPT",lt.PROMPT="PROMPT",lt.SUCCESS="SUCCESS";let lv=lt;var Ob=(n=>(n.IS="SERVICE_TYPE_IS",n.IM="SERVICE_TYPE_IM",n))(Ob||{});class zse{constructor(e){this.ourEvent=e,this.ourEventIndex=0,this.paginateTokens={[St.Backward]:null,[St.Forward]:null},this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(e=!1){return this.paginateTokens[e?St.Backward:St.Forward]}setPaginateToken(e,t=!1){this.paginateTokens[t?St.Backward:St.Forward]=e??null}addEvents(e,t=!1){t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class mw{constructor(e,t){this.rank=e,this.context=t}static fromJson(e,t){const r=e.context||{};let i=(r.events_before||[]).map(t),s=(r.events_after||[]).map(t);const o=new zse(t(e.result)),a=o.ourEvent.threadRootId;return i=i.filter(c=>c.threadRootId===a),s=s.filter(c=>c.threadRootId===a),o.setPaginateToken(r.start,!0),o.addEvents(i,!0),o.addEvents(s,!1),o.setPaginateToken(r.end,!1),new mw(e.rank,o)}}var TP=(n=>(n.Public="public",n.Private="private",n))(TP||{}),oy=(n=>(n.PrivateChat="private_chat",n.TrustedPrivateChat="trusted_private_chat",n.PublicChat="public_chat",n))(oy||{}),Sc=(n=>(n.Public="public",n.Invite="invite",n.Private="private",n.Knock="knock",n.Restricted="restricted",n))(Sc||{}),N$=(n=>(n.RoomMembership="m.room_membership",n))(N$||{}),uv=(n=>(n.CanJoin="can_join",n.Forbidden="forbidden",n))(uv||{}),gw=(n=>(n.Invited="invited",n.Joined="joined",n.Shared="shared",n.WorldReadable="world_readable",n))(gw||{});function Yse(n,e){let t=!!e.preventReEmit;const r=e.decrypt!==!1;function i(s){const o=n.getRoom(s.room_id);let a;o&&s.state_key===void 0&&(a=o.findEventById(s.event_id)),!a||a.status?a=new Ji(s):(a.setUnsigned({...a.getUnsigned(),...s.unsigned}),t=!0);const c=a.getServerAggregatedRelation(on.Replace);if(c!=null&&c.content){const u=i(c);a.makeReplaced(u)}const l=o==null?void 0:o.findThreadForEvent(a);return l&&a.setThread(l),a.isEncrypted()&&(t||n.reEmitter.reEmit(a,[mn.Decrypted]),r&&n.decryptEventIfNeeded(a)),t||(n.reEmitter.reEmit(a,[mn.Replaced,mn.VisibilityChange]),o==null||o.reEmitter.reEmit(a,[mn.BeforeRedaction])),a}return i}class C5{constructor(e,t,r){this.client=e,this.indexEvent=t,this.directory=r}get id(){const e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return this.indexEvent.getContent().active===!0}get version(){return this.indexEvent.getContent().version??1}get roomId(){return this.indexEvent.getRoomId()}async delete(){await this.client.sendStateEvent(this.roomId,uc.name,{},this.id),await this.client.redactEvent(this.roomId,this.id);const e=(await this.getVersionHistory())[1];e&&await e.delete()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}async setName(e){await this.client.sendStateEvent(this.roomId,uc.name,{...this.indexEvent.getContent(),name:e},this.id)}isLocked(){return this.indexEvent.getContent().locked||!1}async setLocked(e){await this.client.sendStateEvent(this.roomId,uc.name,{...this.indexEvent.getContent(),locked:e},this.id)}async getFileInfo(){const t=(await this.getFileEvent()).getOriginalContent().file,r=this.client.mxcUrlToHttp(t.url);if(!r)throw new Error(`No HTTP URL available for ${t.url}`);return{info:t,httpUrl:r}}async getFileEvent(){const e=this.client.getRoom(this.roomId);if(!e)throw new Error("Unknown room");let t=e.getUnfilteredTimelineSet().findEventById(this.id);for(;!t&&e.getLiveTimeline().getState($e.BACKWARDS).paginationToken;)await this.client.scrollback(e,100),t=e.getUnfilteredTimelineSet().findEventById(this.id);if(!t)throw new Error("Failed to find event");return await this.client.decryptEventIfNeeded(t),t}async createNewVersion(e,t,r,i){const s=await this.directory.createFile(e,t,r,{...i??{},"m.new_content":!0,"m.relates_to":{rel_type:on.Replace,event_id:this.id}});return await this.client.sendStateEvent(this.roomId,uc.name,{active:!0,name:e,version:this.version+1},s.event_id),await this.client.sendStateEvent(this.roomId,uc.name,{...this.indexEvent.getContent(),active:!1},this.id),s}async getVersionHistory(){const e=[];e.push(this);const t=this.client.getRoom(this.roomId);if(!t)throw new Error("Invalid or unknown room");const r=[...t.getLiveTimeline().getEvents()].reverse();let i,s=await this.getFileEvent();do if(i=r.find(o=>o.replacingEventId()===s.getId()),i){const o=this.directory.getFile(i.getId());if(o)e.push(o),s=i;else break}while(i);return e}}const Xse={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[ie.RoomPowerLevels]:100,[ie.RoomHistoryVisibility]:100,[ie.RoomTombstone]:100,[ie.RoomEncryption]:100,[ie.RoomName]:50,[ie.RoomMessage]:50,[ie.RoomMessageEncrypted]:50,[ie.Sticker]:50},users:{}};class T5{constructor(e,t){if(this.client=e,this.roomId=t,this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const e=this.room.currentState.getStateEvents(ie.SpaceParent);return e!=null&&e.length?e.every(t=>{var r;return!((r=t.getContent())!=null&&r.via)}):!0}async setName(e){await this.client.sendStateEvent(this.roomId,ie.RoomName,{name:e},"")}async invite(e,t=!0){const r=[this.retryInvite(e)];t&&r.push(...this.getDirectories().map(i=>i.invite(e,t))),await Promise.all(r)}retryInvite(e){return gre(async()=>{await this.client.invite(this.roomId,e).catch(t=>{throw(t==null?void 0:t.errcode)==="M_FORBIDDEN"?new fj.AbortError(t):t})})}async setPermissions(e,t){var l;const r=this.room.currentState.getStateEvents(ie.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");const i=(r==null?void 0:r.getContent())||{},s=i.users_default||0,o=i.events_default||50,a=((l=i.events)==null?void 0:l[ie.RoomPowerLevels])||100,c=i.users||{};switch(t){case"viewer":c[e]=s;break;case"editor":c[e]=o;break;case"owner":c[e]=a;break;default:throw new Error("Invalid role: "+t)}i.users=c,await this.client.sendStateEvent(this.roomId,ie.RoomPowerLevels,i,"")}getPermissions(e){var c,l;const t=this.room.currentState.getStateEvents(ie.RoomPowerLevels,"");if(Array.isArray(t))throw new Error("Unexpected return type for power levels");const r=(t==null?void 0:t.getContent())||{},i=r.users_default||0,s=r.events_default||50,o=((c=r.events)==null?void 0:c[ie.RoomPowerLevels])||100,a=((l=r.users)==null?void 0:l[e])||i;return a>=o?"owner":a>=s?"editor":"viewer"}async createDirectory(e){const t=await this.client.unstableCreateFileTree(e);return await this.client.sendStateEvent(this.roomId,ie.SpaceChild,{via:[this.client.getDomain()]},t.roomId),await this.client.sendStateEvent(t.roomId,ie.SpaceParent,{via:[this.client.getDomain()]},this.roomId),t}getDirectories(){const e=[],t=this.room.currentState.getStateEvents(ie.SpaceChild);for(const r of t)try{const i=r.getStateKey();if(i){const s=this.client.unstableGetFileTreeSpace(i);s&&e.push(s)}}catch(i){O.warn("Unable to create tree space instance for listing. Are we joined?",i)}return e}getDirectory(e){return this.getDirectories().find(t=>t.roomId===e)}async delete(){const e=this.getDirectories();for(const i of e)await i.delete();const t=[ze.Invite,ze.Knock,ze.Join],r=this.room.currentState.getStateEvents(ie.RoomMember);for(const i of r)if(i.getStateKey()!==this.client.getUserId()&&t.includes(i.getContent().membership)){const o=i.getStateKey();if(!o)throw new Error("State key not found for branch");await this.client.kick(this.roomId,o,"Room deleted")}await this.client.leave(this.roomId)}getOrderedChildren(e){const t=e.map(r=>({roomId:r.getStateKey(),order:r.getContent().order})).filter(r=>r.roomId);return t.sort((r,i)=>{var s,o;if(r.order&&!i.order)return-1;if(!r.order&&i.order)return 1;if(!r.order&&!i.order){const a=this.client.getRoom(r.roomId),c=this.client.getRoom(i.roomId);if(!a||!c)return p_(r.roomId,i.roomId);const l=((s=a.currentState.getStateEvents(ie.RoomCreate,""))==null?void 0:s.getTs())??0,u=((o=c.currentState.getStateEvents(ie.RoomCreate,""))==null?void 0:o.getTs())??0;return l===u?p_(r.roomId,i.roomId):l-u}else return p_(r.order,i.order)}),t}getParentRoom(){const t=this.room.currentState.getStateEvents(ie.SpaceParent)[0];if(!t)throw new Error("Expected to have a parent in a non-top level space");const r=t.getStateKey();if(!r)throw new Error("No state key found for parent");const i=this.client.getRoom(r);if(!i)throw new Error("Unable to locate room for parent");return i}getOrder(){if(this.isTopLevel)return-1;const t=this.getParentRoom().currentState.getStateEvents(ie.SpaceChild);return this.getOrderedChildren(t).findIndex(i=>i.roomId===this.roomId)}async setOrder(e){if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const t=this.getParentRoom(),r=t.currentState.getStateEvents(ie.SpaceChild),i=this.getOrderedChildren(r);e=Math.max(Math.min(e,i.length-1),0);const o=this.getOrder()<e;o&&e===i.length-1?e--:!o&&e===0&&e++;const a=i[o?e:e-1],c=i[o?e+1:e];let l=Jl[0],u=!1;if(!a)c!=null&&c.order&&(l=LO(c.order));else if(e===i.length-1)c!=null&&c.order&&(l=Tm(c.order));else{const m=a==null?void 0:a.order,v=c==null?void 0:c.order;m&&v?m===v?l=Tm(m):l=vre(m,v):m?l=Tm(m):v?l=LO(v):u=!0}if(u){let m;for(let v=0;v<=e;v++){const g=i[v];if(v===0&&(m=g.order),g.order)m=g.order;else{m=m?Tm(m):Jl[0];const S=t.currentState.getStateEvents(ie.SpaceChild,g.roomId),b=(S==null?void 0:S.getContent())??{via:[this.client.getDomain()]};await this.client.sendStateEvent(t.roomId,ie.SpaceChild,{...b,order:m},g.roomId)}}m&&(l=Tm(m))}const h=t.currentState.getStateEvents(ie.SpaceChild,this.roomId),p=(h==null?void 0:h.getContent())??{via:[this.client.getDomain()]};await this.client.sendStateEvent(t.roomId,ie.SpaceChild,{...p,order:l},this.roomId)}async createFile(e,t,r,i){const{content_uri:s}=await this.client.uploadContent(t,{includeFilename:!1});r.url=s;const o={msgtype:zo.File,body:e,url:s,file:r};i=i??{},i["m.new_content"]&&(i["m.new_content"]=o);const a=await this.client.sendMessage(this.roomId,{...i,...o,[Sj.name]:{}});return await this.client.sendStateEvent(this.roomId,uc.name,{active:!0,name:e},a.event_id),a}getFile(e){const t=this.room.currentState.getStateEvents(uc.name,e);return t?new C5(this.client,t,this):null}listFiles(){return this.listAllFiles().filter(e=>e.isActive)}listAllFiles(){return(this.room.currentState.getStateEvents(uc.name)??[]).map(t=>new C5(this.client,t,this))}}var IP=(n=>(n.Recent="recent",n.Rank="rank",n))(IP||{}),D$=(n=>(n.LocalStreamsChanged="local_streams_changed",n))(D$||{});class Jse extends Xn{constructor(e){super(),this.client=e,this.userMediaStreams=[],this.screensharingStreams=[]}restoreMediaSettings(e,t){this.audioInput=e,this.videoInput=t}async setAudioInput(e){O.info(`MediaHandler setAudioInput() running (deviceId=${e})`),this.audioInput!==e&&(this.audioInput=e,await this.updateLocalUsermediaStreams())}async setAudioSettings(e){O.info(`MediaHandler setAudioSettings() running (opts=${JSON.stringify(e)})`),this.audioSettings=Object.assign({},e),await this.updateLocalUsermediaStreams()}async setVideoInput(e){O.info(`MediaHandler setVideoInput() running (deviceId=${e})`),this.videoInput!==e&&(this.videoInput=e,await this.updateLocalUsermediaStreams())}async setMediaInputs(e,t){O.log(`MediaHandler setMediaInputs() running (audioInput: ${e} videoInput: ${t})`),this.audioInput=e,this.videoInput=t,await this.updateLocalUsermediaStreams()}async updateLocalUsermediaStreams(){if(this.userMediaStreams.length===0)return;const e=new Map;for(const t of this.client.callEventHandler.calls.values())e.set(t.callId,{audio:t.hasLocalUserMediaAudioTrack,video:t.hasLocalUserMediaVideoTrack});for(const t of this.userMediaStreams){O.log(`MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=${t.id})`);for(const r of t.getTracks())r.stop()}this.userMediaStreams=[],this.localUserMediaStream=void 0;for(const t of this.client.callEventHandler.calls.values()){if(t.callHasEnded()||!e.has(t.callId))continue;const{audio:r,video:i}=e.get(t.callId);O.log(`MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=${t.callId})`);const s=await this.getUserMediaStream(r,i);t.callHasEnded()||await t.updateLocalUsermediaStream(s)}for(const t of this.client.groupCallEventHandler.groupCalls.values()){if(!t.localCallFeed)continue;O.log(`MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=${t.groupCallId})`);const r=await this.getUserMediaStream(!0,t.type===fw.Video);t.state!==SP.Ended&&await t.updateLocalUsermediaStream(r)}this.emit("local_streams_changed")}async hasAudioDevice(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="audioinput").length>0}catch(e){return O.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}async hasVideoDevice(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput").length>0}catch(e){return O.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}async getUserMediaStream(e,t,r=!0){return this.getMediaStreamPromise?this.getMediaStreamPromise=this.getMediaStreamPromise.then(()=>this.getUserMediaStreamInternal(e,t,r)):this.getMediaStreamPromise=this.getUserMediaStreamInternal(e,t,r),this.getMediaStreamPromise}async getUserMediaStreamInternal(e,t,r){var c,l,u,h,p;const i=e&&await this.hasAudioDevice(),s=t&&await this.hasVideoDevice();let o,a=!0;if(this.localUserMediaStream?(i!==this.localUserMediaStream.getAudioTracks().length>0&&(a=!1),s!==this.localUserMediaStream.getVideoTracks().length>0&&(a=!1),i&&((l=(c=this.localUserMediaStream.getAudioTracks()[0])==null?void 0:c.getSettings())==null?void 0:l.deviceId)!==this.audioInput&&(a=!1),s&&((h=(u=this.localUserMediaStream.getVideoTracks()[0])==null?void 0:u.getSettings())==null?void 0:h.deviceId)!==this.videoInput&&(a=!1)):a=!1,a){if(o=this.localUserMediaStream.clone(),O.log(`MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=${(p=this.localUserMediaStream)==null?void 0:p.id} newStreamId=${o.id} shouldRequestAudio=${i} shouldRequestVideo=${s})`),!i)for(const m of o.getAudioTracks())o.removeTrack(m);if(!s)for(const m of o.getVideoTracks())o.removeTrack(m)}else{const m=this.getUserMediaContraints(i,s);o=await navigator.mediaDevices.getUserMedia(m),O.log(`MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=${o.id}, shouldRequestAudio=${i}, shouldRequestVideo=${s}, constraints=${JSON.stringify(m)})`);for(const v of o.getTracks()){const g=v.getSettings();v.kind==="audio"?this.audioInput=g.deviceId:v.kind==="video"&&(this.videoInput=g.deviceId)}r&&(this.localUserMediaStream=o)}return r&&this.userMediaStreams.push(o),this.emit("local_streams_changed"),o}stopUserMediaStream(e){var r;O.log(`MediaHandler stopUserMediaStream() stopping (streamId=${e.id})`);for(const i of e.getTracks())i.stop();const t=this.userMediaStreams.indexOf(e);if(t!==-1&&(O.debug(`MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=${e.id})`,e.id),this.userMediaStreams.splice(t,1)),this.emit("local_streams_changed"),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(const i of e.getTracks())if((r=this.localUserMediaStream)!=null&&r.getTrackById(i.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}async getScreensharingStream(e={},t=!0){let r;if(this.screensharingStreams.length===0){const i=this.getScreenshareContraints(e);e.desktopCapturerSourceId?(O.debug(`MediaHandler getScreensharingStream() calling getUserMedia() (opts=${JSON.stringify(e)})`),r=await navigator.mediaDevices.getUserMedia(i)):(O.debug(`MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=${JSON.stringify(e)})`),r=await navigator.mediaDevices.getDisplayMedia(i))}else{const i=this.screensharingStreams[this.screensharingStreams.length-1];O.log(`MediaHandler getScreensharingStream() cloning (streamId=${i.id})`),r=i.clone()}return t&&this.screensharingStreams.push(r),this.emit("local_streams_changed"),r}stopScreensharingStream(e){O.debug(`MediaHandler stopScreensharingStream() stopping stream (streamId=${e.id})`);for(const r of e.getTracks())r.stop();const t=this.screensharingStreams.indexOf(e);t!==-1&&(O.debug(`MediaHandler stopScreensharingStream() splicing stream out (streamId=${e.id})`),this.screensharingStreams.splice(t,1)),this.emit("local_streams_changed")}stopAllStreams(){for(const e of this.userMediaStreams){O.log(`MediaHandler stopAllStreams() stopping (streamId=${e.id})`);for(const t of e.getTracks())t.stop()}for(const e of this.screensharingStreams)for(const t of e.getTracks())t.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit("local_streams_changed")}getUserMediaContraints(e,t){const r=!!navigator.webkitGetUserMedia;return{audio:e?{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0}:!1,video:t?{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}:!1}}getScreenshareContraints(e){const{desktopCapturerSourceId:t,audio:r}=e;return t?{audio:r??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t}}}:{audio:r??!1,video:!0}}}var ek=(n=>(n.RequestFinished="FINISHED",n.Complete="COMPLETE",n))(ek||{}),gp=(n=>(n.PreProcess="ExtState.PreProcess",n.PostProcess="ExtState.PostProcess",n))(gp||{}),Nb=(n=>(n.RoomData="SlidingSync.RoomData",n.Lifecycle="SlidingSync.Lifecycle",n.List="SlidingSync.List",n))(Nb||{});const Zse=3;class Qse{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return gp.PreProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){e.device_lists&&await this.crypto.processDeviceLists(e.device_lists),await this.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),this.crypto.onSyncCompleted({})}}class eoe{constructor(e,t){this.client=e,this.cryptoCallbacks=t,this.nextBatch=null}name(){return"to_device"}when(){return gp.PreProcess}onRequest(e){const t={since:this.nextBatch!==null?this.nextBatch:void 0};return e&&(t.limit=100,t.enabled=!0),t}async onResponse(e){const t=[];let r=e.events||[];r.length>0&&this.cryptoCallbacks&&(r=await this.cryptoCallbacks.preprocessToDeviceMessages(r)),r.map(C$).map(i=>{if(i.getType()==="m.key.verification.cancel"){const s=i.getContent().transaction_id;s&&t.push(s)}return i}).forEach(i=>{const s=i.getContent();if(i.getType()=="m.room.message"&&s.msgtype=="m.bad.encrypted"){O.log("Ignoring undecryptable to-device event from "+i.getSender());return}if(i.getType()==="m.key.verification.start"||i.getType()==="m.key.verification.request"){const o=s.transaction_id;t.includes(o)&&i.flagCancelled()}this.client.emit(qe.ToDeviceEvent,i)}),this.nextBatch=e.next_batch}}class toe{constructor(e){this.client=e}name(){return"account_data"}when(){return gp.PostProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){e.global&&e.global.length>0&&this.processGlobalAccountData(e.global);for(const t in e.rooms){const r=bf(this.client,t,e.rooms[t]),i=this.client.getRoom(t);if(!i){O.warn("got account data for room but room doesn't exist on client:",t);continue}i.addAccountData(r),r.forEach(s=>{this.client.emit(qe.Event,s)})}}processGlobalAccountData(e){const t=bf(this.client,void 0,e),r=t.reduce((i,s)=>(i[s.getType()]=this.client.store.getAccountData(s.getType()),i),{});this.client.store.storeAccountDataEvents(t),t.forEach(i=>{if(i.getType()===ie.PushRules){const o=i.getContent();this.client.setPushRules(o)}const s=r[i.getType()];return this.client.emit(qe.AccountData,i,s),i})}}class noe{constructor(e){this.client=e}name(){return"typing"}when(){return gp.PostProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){if(e!=null&&e.rooms)for(const t in e.rooms)U$(this.client,t,[e.rooms[t]])}}class roe{constructor(e){this.client=e}name(){return"receipts"}when(){return gp.PostProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){if(e!=null&&e.rooms)for(const t in e.rooms)U$(this.client,t,[e.rooms[t]])}}class F${constructor(e,t,r,i){this.slidingSync=e,this.client=t,this.syncState=null,this.lastPos=null,this.failCount=0,this.notifEvents=[],this.opts=S$(r),this.syncOpts=w$(i),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[Je.Timeline,Je.TimelineReset]),this.slidingSync.on(Nb.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(Nb.RoomData,this.onRoomData.bind(this));const s=[new eoe(this.client,this.syncOpts.cryptoCallbacks),new toe(this.client),new noe(this.client),new roe(this.client)];this.syncOpts.cryptoCallbacks&&s.push(new Qse(this.syncOpts.cryptoCallbacks)),s.forEach(o=>{this.slidingSync.registerExtension(o)})}async onRoomData(e,t){let r=this.client.store.getRoom(e);if(!r){if(!t.initial){O.debug("initial flag not set but no stored room exists for room ",e,t);return}r=E$(this.client,e,this.opts)}await this.processRoomData(this.client,r,t)}onLifecycle(e,t,r){switch(r&&O.debug("onLifecycle",e,r),e){case ek.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(Lr.Prepared,{oldSyncToken:void 0,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(Lr.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case ek.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>Zse?Lr.Error:Lr.Reconnecting,{error:new gn(r)}),this.shouldAbortSync(new gn(r)))return}else this.failCount=0;break}}async syncLeftRooms(){return[]}async peek(e){return null}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData??null}createRoom(e){const{timelineSupport:t}=this.client,r=new dw(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:t});return this.client.reEmitter.reEmit(r,[Je.Name,Je.Redaction,Je.RedactionCancelled,Je.Receipt,Je.Tags,Je.LocalEchoUpdated,Je.AccountData,Je.MyMembership,Je.Timeline,Je.TimelineReset]),this.registerStateListeners(r),r}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[kt.Events,kt.Members,kt.NewMember,kt.Update]),e.currentState.on(kt.NewMember,(t,r,i)=>{i.user=this.client.getUser(i.userId)??void 0,this.client.reEmitter.reEmit(i,[Fo.Name,Fo.Typing,Fo.PowerLevel,Fo.Membership])})}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(O.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Lr.Error,{error:e}),!0):!1}async processRoomData(e,t,r){r=ioe(e,t.roomId,r);const i=bf(this.client,t.roomId,r.required_state);let s=bf(this.client,t.roomId,r.timeline,!1);const o=[];if(r.initial){const l=new Set;t.getLiveTimeline().getEvents().forEach(m=>{l.add(m.getId())});const u=[],h=[];let p=!1;for(let m=s.length-1;m>=0;m--){const v=s[m];if(l.has(v.getId())){p=!0;continue}p?u.push(v):h.unshift(v)}s=h,u.length>0&&t.addEventsToTimeline(u,!0,!1,t.getLiveTimeline(),r.prev_batch)}const a=t.hasEncryptionStateEvent();if(r.notification_count!=null&&t.setUnreadNotificationCount(sr.Total,r.notification_count),r.highlight_count!=null&&(!a||a&&t.getUnreadNotificationCount(sr.Highlight)<=0)&&t.setUnreadNotificationCount(sr.Highlight,r.highlight_count),Number.isInteger(r.invited_count)&&t.currentState.setInvitedMemberCount(r.invited_count),Number.isInteger(r.joined_count)&&t.currentState.setJoinedMemberCount(r.joined_count),r.invite_state){const l=bf(this.client,t.roomId,r.invite_state);await this.injectRoomEvents(t,l),r.initial&&(t.recalculate(),this.client.store.storeRoom(t),this.client.emit(qe.Room,t)),l.forEach(u=>{this.client.emit(qe.Event,u)}),t.updateMyMembership(ze.Invite);return}r.initial&&t.getLiveTimeline().setPaginationToken(r.prev_batch??null,$e.BACKWARDS),await this.injectRoomEvents(t,i,s,r.num_live),t.addEphemeralEvents(o),t.updateMyMembership(ze.Join),t.recalculate(),r.initial&&(e.store.storeRoom(t),e.emit(qe.Room,t)),this.addNotifications(s);const c=async l=>{e.emit(qe.Event,l),l.isState()&&l.getType()==ie.RoomEncryption&&this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.onCryptoEvent(t,l)};await af(i,c),await af(s,c),o.forEach(function(l){e.emit(qe.Event,l)}),t.decryptCriticalEvents()}async injectRoomEvents(e,t,r=[],i=0){const s=e.getLiveTimeline(),o=s.getEvents().length==0;if(o){for(const c of t)this.client.getPushActionsForEvent(c);s.initialiseState(t)}o||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t));let a=[];i>0&&(a=r.slice(-1*i),r=r.slice(0,-1*a.length)),await e.addLiveEvents(r,{fromCache:!0,addToState:!1}),a.length>0&&await e.addLiveEvents(a,{fromCache:!1,addToState:!1}),e.recalculate(),this.resolveInvites(e)}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership(ze.Invite).forEach(function(r){if(r.requestedProfileInfo)return;r.requestedProfileInfo=!0;const i=t.getUser(r.userId);let s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=t.getProfileInfo(r.userId),s.then(function(o){const a=r.events.member;a.getContent().membership===ze.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})})}retryImmediately(){return!0}async sync(){for(O.debug("Sliding sync init loop");!this.client.isGuest();)try{O.debug("Getting push rules...");const e=await this.client.getPushRules();O.debug("Got push rules"),this.client.pushRules=e;break}catch(e){if(O.error("Getting push rules failed",e),this.shouldAbortSync(e))return}await this.slidingSync.start()}stop(){O.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,t){const r=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(qe.Sync,this.syncState,r,t)}addNotifications(e){if(this.client.getNotifTimelineSet())for(const t of e){const r=this.client.getPushActionsForEvent(t);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this.notifEvents.push(t)}}purgeNotifications(){this.notifEvents.sort(function(e,t){return e.getTs()-t.getTs()}),this.notifEvents.forEach(e=>{var t;(t=this.client.getNotifTimelineSet())==null||t.addLiveEvent(e,{addToState:!1})}),this.notifEvents=[]}}function ioe(n,e,t){if(!t.name)return t;for(const r of t.required_state)if(r.type===ie.RoomName&&r.state_key==="")return r.content={name:t.name},t;return t.required_state.push({event_id:"$fake-sliding-sync-name-event-"+e,state_key:"",type:ie.RoomName,content:{name:t.name},sender:n.getUserId(),origin_server_ts:new Date().getTime()}),t}function bf(n,e,t,r=!0){const i=n.getEventMapper({decrypt:r});return t.map(function(s){return s.room_id=e,i(s)})}function U$(n,e,t){const r=bf(n,e,t),i=n.getRoom(e);if(!i){O.warn("got ephemeral events for room but room doesn't exist on client:",e);return}i.addEphemeralEvents(r),r.forEach(s=>{n.emit(qe.Event,s)})}const RP=new jn("m.beacon_info","org.matrix.msc3672.beacon_info"),tk=new jn("m.beacon","org.matrix.msc3672.beacon");class Gf{constructor(e=Gf.RETRY_BACKOFF_RATELIMIT,t=Gf.QUEUE_MESSAGES){this.retryAlgorithm=e,this.queueAlgorithm=t,this.queues={},this.activeQueues=[],this.procFn=null,this.processQueue=r=>{const i=this.peekNextEvent(r);if(!i){this.disableQueue(r);return}r1("Queue '%s' has %s pending events",r,this.queues[r].length),Promise.resolve().then(()=>this.procFn(i.event)).then(s=>{this.removeNextEvent(r),r1("Queue '%s' sent event %s",r,i.event.getId()),i.defer.resolve(s),this.processQueue(r)},s=>{i.attempts+=1;const o=this.retryAlgorithm(i.event,i.attempts,s);r1("retry(%s) err=%s event_id=%s waitTime=%s",i.attempts,s,i.event.getId(),o),o===-1?(O.info("Queue '%s' giving up on event %s",r,i.event.getId()),this.clearQueue(r,s)):setTimeout(this.processQueue,o,r)})}}static RETRY_BACKOFF_RATELIMIT(e,t,r){return u$(r,t,!1)}static QUEUE_MESSAGES(e){return e.getType()===ie.RoomMessage||e.hasAssociation()?"message":null}getQueueForEvent(e){const t=this.queueAlgorithm(e);return!t||!this.queues[t]?null:this.queues[t].map(function(r){return r.event})}removeEventFromQueue(e){const t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;let r=!1;return yb(this.queues[t],i=>i.event.getId()===e.getId()?(r=!0,!0):!1),r}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){const t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);const r=Xl();return this.queues[t].push({event:e,defer:r,attempts:0}),r1("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),this.startProcessingQueues(),r.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(e=>this.activeQueues.indexOf(e)===-1&&this.queues[e].length>0).forEach(e=>{this.activeQueues.push(e),this.processQueue(e)})}disableQueue(e){const t=this.activeQueues.indexOf(e);t>=0&&this.activeQueues.splice(t,1),O.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,t){O.info("clearing queue '%s'",e);let r;for(;r=this.removeNextEvent(e);)r.defer.reject(t);this.disableQueue(e)}peekNextEvent(e){const t=this.queues[e];if(Array.isArray(t))return t[0]}removeNextEvent(e){const t=this.queues[e];if(Array.isArray(t))return t.shift()}}function r1(...n){}const I5=20;class soe{constructor(e){this.client=e,this.sending=!1,this.running=!0,this.retryTimeout=null,this.retryAttempts=0,this.sendQueue=async()=>{if(this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.sending||!this.running)return;O.debug("Attempting to send queued to-device messages"),this.sending=!0;let t;try{for(;this.running&&(t=await this.client.store.getOldestToDeviceBatch(),t!==null);)await this.sendBatch(t),await this.client.store.removeToDeviceBatch(t.id),this.retryAttempts=0;if(!this.running)return;O.debug("All queued to-device messages sent")}catch(r){++this.retryAttempts;const i=Gf.RETRY_BACKOFF_RATELIMIT(null,this.retryAttempts,r);if(i===-1){Math.floor(r.httpStatus/100)===4?(O.error("Fatal error when sending to-device message - dropping to-device batch!",r),await this.client.store.removeToDeviceBatch(t.id)):O.info("Automatic retry limit reached for to-device messages.");return}O.info(`Failed to send batch of to-device messages. Will retry in ${i}ms`,r),this.retryTimeout=setTimeout(this.sendQueue,i)}finally{this.sending=!1}},this.onResumedSync=(t,r)=>{t===Lr.Syncing&&r!==Lr.Syncing&&(O.info("Resuming queue after resumed sync"),this.sendQueue())}}start(){this.running=!0,this.sendQueue(),this.client.on(qe.Sync,this.onResumedSync)}stop(){this.running=!1,this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(qe.Sync,this.onResumedSync)}async queueBatch(e){const t=[];for(let r=0;r<e.batch.length;r+=I5){const i={eventType:e.eventType,batch:e.batch.slice(r,r+I5),txnId:this.client.makeTxnId()};t.push(i);const s=i.batch.map(o=>`${o.userId}/${o.deviceId} (msgid ${o.payload[aw]})`);O.info(`Enqueuing batch of to-device messages. type=${e.eventType} txnid=${i.txnId}`,s)}await this.client.store.saveToDeviceBatches(t),this.sendQueue()}async sendBatch(e){const t=new yc(()=>new Map);for(const r of e.batch)t.getOrCreate(r.userId).set(r.deviceId,r.payload);O.info(`Sending batch of ${e.batch.length} to-device messages with ID ${e.id} and txnId ${e.txnId}`),await this.client.sendToDevice(e.eventType,t,e.txnId)}}const DT=new ss.UnstableValue("m.policies","org.matrix.msc3847.policies"),i1=new ss.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites");var nk=(n=>(n.Ban="m.ban",n))(nk||{}),ud=(n=>(n.User="m.policy.user",n.Room="m.policy.room",n.Server="m.policy.server",n))(ud||{});const R5={[ud.User]:ie.PolicyRuleUser,[ud.Room]:ie.PolicyRuleRoom,[ud.Server]:ie.PolicyRuleServer};class ooe{constructor(e){this.client=e}async addRule(e,t,r){const i=await this.getOrCreateTargetRoom();return(await this.client.sendStateEvent(i.roomId,R5[e],{entity:t,reason:r,recommendation:nk.Ban})).event_id}async removeRule(e){await this.client.redactEvent(e.getRoomId(),e.getId())}async addSource(e){await this.client.joinRoom(e);const t=(await this.getOrCreateSourceRooms()).map(r=>r.roomId);return t.includes(e)?!1:(t.push(e),await this.withIgnoreInvitesPolicies(r=>{r.sources=t}),!0)}async getRuleForInvite({sender:e,roomId:t}){const r=await this.getOrCreateSourceRooms(),i=e.split(":")[1],s=t.split(":")[1];for(const o of r){const a=o.getUnfilteredTimelineSet().getLiveTimeline().getState($e.FORWARDS);for(const{scope:c,entities:l}of[{scope:ud.Room,entities:[t]},{scope:ud.User,entities:[e]},{scope:ud.Server,entities:[i,s]}]){const u=a.getStateEvents(R5[c]);for(const h of u){const p=h.getContent();if((p==null?void 0:p.recommendation)!=nk.Ban)continue;const m=p==null?void 0:p.entity;if(!m)continue;let v;try{v=new RegExp(gj(m))}catch{continue}for(const g of l)if(g&&v.test(g))return h}}}return null}async getOrCreateTargetRoom(){let t=this.getIgnoreInvitesPolicies().target;if(typeof t!="string"&&(t=null),t){const r=this.client.getRoom(t);if(r)return r;t=null}return t=(await this.client.createRoom({name:"Individual Policy Room",preset:oy.PrivateChat})).room_id,await this.withIgnoreInvitesPolicies(r=>{r.target=t}),this.client.getRoom(t)}async getOrCreateSourceRooms(){let t=this.getIgnoreInvitesPolicies().sources,r=!1;Array.isArray(t)||(r=!0,t=[]);let i=t.filter(s=>typeof s=="string").map(s=>this.client.getRoom(s)).filter(s=>!!s);if(i.length!=t.length&&(r=!0),i.length==0){const s=await this.getOrCreateTargetRoom();r=!0,i=[s]}return r&&await this.withIgnoreInvitesPolicies(s=>{s.sources=t}),i}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}async withIgnoreInvitesPolicies(e){const{policies:t,ignoreInvitesPolicies:r}=this.getPoliciesAndIgnoreInvitesPolicies();e(r),t[i1.name]=r,await this.client.setAccountData(DT.name,t)}getPoliciesAndIgnoreInvitesPolicies(){var i;let e={};for(const s of[DT.name,DT.altName]){if(!s)continue;const o=(i=this.client.getAccountData(s))==null?void 0:i.getContent();if(o){e=o;break}}let t={},r=!1;for(const s of[i1.name,i1.altName]){if(!s)continue;const o=e[s];if(o&&typeof o=="object"){t=o,r=!0;break}}return r||(e[i1.name]=t),{policies:e,ignoreInvitesPolicies:t}}}const FT="matrix-js-sdk";function aoe(n){if(n.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<n.length;l++){const u=n.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const t=n.length,r=n.charAt(0),i=Math.log(t)/Math.log(256),s=Math.log(256)/Math.log(t);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,p=0;const m=l.length;for(;p!==m&&l[p]===0;)p++,u++;const v=(m-p)*s+1>>>0,g=new Uint8Array(v);for(;p!==m;){let R=l[p],k=0;for(let I=v-1;(R!==0||k<h)&&I!==-1;I--,k++)R+=256*g[I]>>>0,g[I]=R%t>>>0,R=R/t>>>0;if(R!==0)throw new Error("Non-zero carry");h=k,p++}let S=v-h;for(;S!==v&&g[S]===0;)S++;let b=r.repeat(u);for(;S<v;++S)b+=n.charAt(g[S]);return b}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,p=0;for(;l[u]===r;)h++,u++;const m=(l.length-u)*i+1>>>0,v=new Uint8Array(m);for(;l[u];){let R=e[l.charCodeAt(u)];if(R===255)return;let k=0;for(let I=m-1;(R!==0||k<p)&&I!==-1;I--,k++)R+=t*v[I]>>>0,v[I]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");p=k,u++}let g=m-p;for(;g!==m&&v[g]===0;)g++;const S=new Uint8Array(h+(m-g));let b=h;for(;g!==m;)S[b++]=v[g++];return S}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var coe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const zGe=aoe(coe);var lr=(n=>(n.UserTrustStatusChanged="userTrustStatusChanged",n.KeyBackupStatus="crypto.keyBackupStatus",n.KeyBackupFailed="crypto.keyBackupFailed",n.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",n.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",n.VerificationRequestReceived="crypto.verificationRequestReceived",n.WillUpdateDevices="crypto.willUpdateDevices",n.DevicesUpdated="crypto.devicesUpdated",n.KeysChanged="crossSigning.keysChanged",n.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",n.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",n.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",n.RehydrationStarted="dehydration.RehydrationStarted",n.RehydrationProgress="dehydration.RehydrationProgress",n.RehydrationCompleted="dehydration.RehydrationCompleted",n.RehydrationError="dehydration.RehydrationError",n.DehydrationKeyCached="dehydration.DehydrationKeyCached",n.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",n))(lr||{}),rk=(n=>(n.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",n.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",n.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",n.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",n.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",n.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",n.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",n.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",n.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",n.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",n.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",n.UNKNOWN_ERROR="UNKNOWN_ERROR",n.MEGOLM_BAD_ROOM="MEGOLM_BAD_ROOM",n.MEGOLM_MISSING_FIELDS="MEGOLM_MISSING_FIELDS",n.OLM_DECRYPT_GROUP_MESSAGE_ERROR="OLM_DECRYPT_GROUP_MESSAGE_ERROR",n.OLM_BAD_ENCRYPTED_MESSAGE="OLM_BAD_ENCRYPTED_MESSAGE",n.OLM_BAD_RECIPIENT="OLM_BAD_RECIPIENT",n.OLM_BAD_RECIPIENT_KEY="OLM_BAD_RECIPIENT_KEY",n.OLM_BAD_ROOM="OLM_BAD_ROOM",n.OLM_BAD_SENDER_CHECK_FAILED="OLM_BAD_SENDER_CHECK_FAILED",n.OLM_BAD_SENDER="OLM_BAD_SENDER",n.OLM_FORWARDED_MESSAGE="OLM_FORWARDED_MESSAGE",n.OLM_MISSING_CIPHERTEXT="OLM_MISSING_CIPHERTEXT",n.OLM_NOT_INCLUDED_IN_RECIPIENTS="OLM_NOT_INCLUDED_IN_RECIPIENTS",n.UNKNOWN_ENCRYPTION_ALGORITHM="UNKNOWN_ENCRYPTION_ALGORITHM",n))(rk||{}),loe=(n=>(n[n.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",n[n.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",n))(loe||{});class YGe{constructor(e){this.errorOnVerifiedUserProblems=e,this.kind=0}}class XGe{constructor(e,t,r,i=!1){this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=r,this.needsUserApproval=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class JGe{constructor(e){this.signedByOwner=e.signedByOwner??!1,this.crossSigningVerified=e.crossSigningVerified??!1,this.tofu=e.tofu??!1,this.localVerified=e.localVerified??!1,this.trustCrossSignedDevices=e.trustCrossSignedDevices??!1}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var uoe=(n=>(n.Fetch="fetch",n.LoadKeys="load_keys",n))(uoe||{}),doe=(n=>(n.Master="master",n.SelfSigning="self_signing",n.UserSigning="user_signing",n))(doe||{}),hoe=(n=>(n[n.NONE=0]="NONE",n[n.GREY=1]="GREY",n[n.RED=2]="RED",n))(hoe||{}),foe=(n=>(n[n.UNKNOWN=0]="UNKNOWN",n[n.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",n[n.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",n[n.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",n[n.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",n[n.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",n[n.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",n[n.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",n))(foe||{});const poe=new Uint8Array(8);async function j$(n,e){const t=await globalThis.crypto.subtle.importKey("raw",n,{name:"HKDF"},!1,["deriveBits"]),r=await globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:poe,info:new TextEncoder().encode(e),hash:"SHA-256"},t,512),i=r.slice(0,32),s=r.slice(32),o=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([o,a])}async function $$(n,e,t,r){let i;r?i=_f(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);const[s,o]=await j$(e,t),a=new TextEncoder().encode(n),c=await globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},s,a),l=await globalThis.crypto.subtle.sign({name:"HMAC"},o,c);return{iv:y_(i),ciphertext:y_(new Uint8Array(c)),mac:y_(new Uint8Array(l))}}async function moe(n,e,t){const[r,i]=await j$(e,t),s=_f(n.ciphertext);if(!await globalThis.crypto.subtle.verify({name:"HMAC"},i,_f(n.mac),s))throw new Error(`Error decrypting secret ${t}: bad MAC`);const o=await globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:_f(n.iv),length:64},r,s);return new TextDecoder().decode(new Uint8Array(o))}const zu="m.secret_storage.v1.aes-hmac-sha2";class B${constructor(e,t){this.accountDataAdapter=e,this.callbacks=t}async getDefaultKeyId(){const e=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key??null:null}setDefaultKeyId(e){return new Promise((t,r)=>{const i=o=>{if(o.getType()!=="m.secret_storage.default_key")return;const a=o.getContent();(e===null?Object.keys(a).length===0:a.key===e)&&(this.accountDataAdapter.removeListener(qe.AccountData,i),t())};this.accountDataAdapter.on(qe.AccountData,i);const s=e===null?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",s).catch(o=>{this.accountDataAdapter.removeListener(qe.AccountData,i),r(o)})})}async addKey(e,t,r){if(e!==zu)throw new Error(`Unknown key algorithm ${e}`);const i={algorithm:e};t.name&&(i.name=t.name),t.passphrase&&(i.passphrase=t.passphrase);const{iv:s,mac:o}=await sk(t.key);if(i.iv=s,i.mac=o,!r)do r=Es(32);while(await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${r}`));return await this.accountDataAdapter.setAccountData(`m.secret_storage.key.${r}`,i),{keyId:r,keyInfo:i}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${e}`);return t?[e,t]:null}async hasKey(e){return!!await this.getKey(e)}async checkKey(e,t){if(t.algorithm===zu)if(t.mac){const{mac:r}=await sk(e,t.iv);return ik(t.mac)===ik(r)}else return!0;else throw new Error("Unknown algorithm")}async store(e,t,r){if(t===null){await this.accountDataAdapter.setAccountData(e,{});return}const i={};if(!r){const s=await this.getDefaultKeyId();if(!s)throw new Error("No keys specified and no default key present");r=[s]}if(r.length===0)throw new Error("Zero keys given to encrypt with!");for(const s of r){const o=await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${s}`);if(!o)throw new Error("Unknown key: "+s);if(o.algorithm===zu){const a={[s]:o},[,c]=await this.getSecretStorageKey(a,e);i[s]=await c.encrypt(t)}else O.warn("unknown algorithm for secret storage key "+s+": "+o.algorithm)}await this.accountDataAdapter.setAccountData(e,{encrypted:i})}async get(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted)throw new Error("Content is not encrypted!");const r={};for(const a of Object.keys(t.encrypted)){const c=await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${a}`),l=t.encrypted[a];(c==null?void 0:c.algorithm)===zu&&l.iv&&l.ciphertext&&l.mac&&(r[a]=c)}if(Object.keys(r).length===0)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);const[i,s]=await this.getSecretStorageKey(r,e),o=t.encrypted[i];return s.decrypt(o)}async isStored(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(!(t!=null&&t.encrypted))return null;const r={};for(const i of Object.keys(t.encrypted)){const s=await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${i}`);if(!s)continue;const o=t.encrypted[i];s.algorithm===zu&&o.iv&&o.ciphertext&&o.mac&&(r[i]=s)}return Object.keys(r).length?r:null}async getSecretStorageKey(e,t){if(!this.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const r=await this.callbacks.getSecretStorageKey({keys:e},t);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[i,s]=r;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===zu)return[i,{encrypt:function(a){return $$(a,s,t)},decrypt:function(a){return moe(a,s,t)}}];throw new Error("Unknown key type: "+e[i].algorithm)}}function ik(n){let e=n.length;for(;e>=1&&n.charCodeAt(e-1)==61;)e--;return e<n.length?n.substring(0,e):n}const goe="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function sk(n,e){return $$(goe,n,"",e)}const voe=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:zu,ServerSideSecretStorageImpl:B$,calculateKeyCheck:sk,trimTrailingEquals:ik},Symbol.toStringTag,{value:"Module"})),H$=n=>n.type==="livekit"&&"livekit_service_url"in n,ok=n=>H$(n)&&"livekit_alias"in n,kP=n=>n.type==="livekit"&&"focus_selection"in n,xP=1e3*60*60*4,yoe=(n,e)=>{var r;const t="Malformed session membership event: ";return typeof n.device_id!="string"&&e.push(t+"device_id must be string"),typeof n.call_id!="string"&&e.push(t+"call_id must be string"),typeof n.application!="string"&&e.push(t+"application must be a string"),typeof((r=n.focus_active)==null?void 0:r.type)!="string"&&e.push(t+"focus_active.type must be a string"),Array.isArray(n.foci_preferred)||e.push(t+"foci_preferred must be an array"),n.created_ts&&typeof n.created_ts!="number"&&e.push(t+"created_ts must be number"),n.scope&&typeof n.scope!="string"&&e.push(t+"scope must be string"),e.length===0};class k5{constructor(e,t){this.parentEvent=e;const r=[];if(yoe(t,r))this.membershipData=t;else throw Error(`unknown CallMembership data. Does not match MSC4143 call.member (${r.join(" & ")}) events this could be a legacy membership event: (${t})`)}static equal(e,t){return Cd(e.membershipData,t.membershipData)}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return this.createdTs().toString()}createdTs(){return this.membershipData.created_ts??this.parentEvent.getTs()}getAbsoluteExpiry(){return this.createdTs()+(this.membershipData.expires??xP)}getMsUntilExpiry(){return this.getAbsoluteExpiry()-Date.now()}isExpired(){return this.getMsUntilExpiry()<=0}getPreferredFoci(){return this.membershipData.foci_preferred}getFocusSelection(){const e=this.membershipData.focus_active;if(kP(e))return e.focus_selection}}var Bl=(n=>(n.Cancel="cancel",n.Restart="restart",n.Send="send",n))(Bl||{}),PP=(n=>(n.TooNew="TOO_NEW",n))(PP||{});const $4=class $4 extends Error{constructor(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`;super(t),this.reason=e,this.name="InvalidCryptoStoreError"}};$4.TOO_NEW="TOO_NEW";let Db=$4;class _oe extends Error{constructor(e,t){super(e),this.value=t}}class boe extends Error{constructor(){super("MatrixClient has been stopped")}}class Ml extends Error{constructor(e,t){super(e),this.clientEndpoint=t,this.name="UnsupportedDelayedEventsEndpointError"}}const s1=O.getChild("MatrixRTCSession");class Soe{constructor(e){this.membershipLoopHandler=e,this.running=!1,this.wakeup=t=>{s1.error("Cannot call wakeup before calling `startWithJoin()`")},this._actions=[]}get actions(){return this._actions}async startWithJoin(){if(this.running){s1.error("Cannot call startWithJoin() on NewMembershipActionScheduler while already running");return}this.running=!0,this._actions=[{ts:Date.now(),type:__.SendFirstDelayedEvent}];try{for(;this._actions.length>0;){this._actions.sort((o,a)=>o.ts-a.ts);const e=this._actions[0];let t;const r=new Promise(o=>{this.wakeup=a=>{t=a,o()}});e.ts>Date.now()&&await Promise.race([r,Td(e.ts-Date.now())]);let i={};if(!t){s1.debug(`Current MembershipManager processing: ${e.type}
Queue:`,this._actions,`
Date.now: "${Date.now()}`);try{i=await this.membershipLoopHandler(e.type)}catch(o){throw Error(`The MembershipManager shut down because of the end condition: ${o}`)}}this._actions.splice(0,1);const s=t??i;"replace"in s?this._actions=s.replace:"insert"in s&&this._actions.push(...s.insert)}}catch(e){throw this.running=!1,e}this.running=!1,s1.debug("Leave MembershipManager ActionScheduler loop (no more actions)")}initiateJoin(){var e;(e=this.wakeup)==null||e.call(this,{replace:[{ts:Date.now(),type:__.SendFirstDelayedEvent}]})}initiateLeave(){var e;(e=this.wakeup)==null||e.call(this,{replace:[{ts:Date.now(),type:__.SendScheduledDelayedLeaveEvent}]})}}const Tr=O.getChild("MatrixRTCSession");var __=(n=>(n.SendFirstDelayedEvent="SendFirstDelayedEvent",n.SendJoinEvent="SendJoinEvent",n.RestartDelayedEvent="RestartDelayedEvent",n.UpdateExpiry="UpdateExpiry",n.SendMainDelayedEvent="SendMainDelayedEvent",n.SendScheduledDelayedLeaveEvent="SendScheduledDelayedLeaveEvent",n.SendLeaveEvent="SendLeaveEvent",n))(__||{});class Fb{constructor(e,t,r,i){this.joinConfig=e,this.room=t,this.client=r,this.getOldestMembership=i,this.scheduler=new Soe(a=>(this.oldStatus&&Tr.debug(`MembershipManager applied action changes. Status: ${this.oldStatus} -> ${this.status}`),this.oldStatus=this.status,Tr.debug(`MembershipManager before processing action. status=${this.oldStatus}`),this.membershipLoopHandler(a)));const[s,o]=[this.client.getUserId(),this.client.getDeviceId()];if(s===null)throw Error("Missing userId in client");if(o===null)throw Error("Missing deviceId in client");this.deviceId=o,this.stateKey=this.makeMembershipStateKey(s,o),this.state=Fb.defaultState}isJoined(){return this.scheduler.running}join(e,t,r){if(this.isJoined()){Tr.error("MembershipManager is already running. Ignoring join request.");return}this.fociPreferred=e,this.focusActive=t,this.leavePromiseDefer=void 0,this.state=Fb.defaultState,this.scheduler.startWithJoin().then(()=>{var i;(i=this.leavePromiseDefer)==null||i.resolve(!0),this.leavePromiseDefer=void 0}).catch(i=>{Tr.error("MembershipManager stopped because: ",i),r==null||r(i)})}leave(e){return this.scheduler.running?(this.leavePromiseDefer||(this.leavePromiseDefer=Xl(),this.scheduler.initiateLeave(),e&&setTimeout(()=>{var t;return(t=this.leavePromiseDefer)==null?void 0:t.resolve(!1)},e)),this.leavePromiseDefer.promise):Promise.resolve(!0)}async onRTCSessionMemberUpdate(e){const t=r=>r.sender===this.client.getUserId()&&r.deviceId===this.client.getDeviceId();if(this.isJoined()&&!e.some(t)){const r=["SendFirstDelayedEvent","SendJoinEvent"];Tr.warn("Missing own membership: force re-join"),this.scheduler.actions.find(i=>r.includes(i.type))?Tr.error("NewMembershipManger tried adding another `SendFirstDelayedEvent` actions even though we already have one in the Queue\nActionQueueOnMemberUpdate:",this.scheduler.actions):(this.state.hasMemberStateEvent=!1,this.scheduler.initiateJoin())}return Promise.resolve()}getActiveFocus(){if(this.focusActive)if(kP(this.focusActive)){if(this.focusActive.focus_selection==="oldest_membership"){const e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}else Tr.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.");else{const e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}static get defaultState(){return{hasMemberStateEvent:!1,delayId:void 0,startTime:0,rateLimitRetries:new Map,networkErrorRetries:new Map,expireUpdateIterations:1}}get callMemberEventRetryDelayMinimum(){var e;return((e=this.joinConfig)==null?void 0:e.callMemberEventRetryDelayMinimum)??3e3}get membershipEventExpiryTimeout(){var e;return((e=this.joinConfig)==null?void 0:e.membershipExpiryTimeout)??xP}get membershipEventExpiryTimeoutHeadroom(){var e;return((e=this.joinConfig)==null?void 0:e.membershipExpiryTimeoutHeadroom)??5e3}computeNextExpiryActionTs(e){return this.state.startTime+this.membershipEventExpiryTimeout*e-this.membershipEventExpiryTimeoutHeadroom}get membershipServerSideExpiryTimeout(){var e;return this.membershipServerSideExpiryTimeoutOverride??((e=this.joinConfig)==null?void 0:e.membershipServerSideExpiryTimeout)??8e3}get membershipKeepAlivePeriod(){var e;return((e=this.joinConfig)==null?void 0:e.membershipKeepAlivePeriod)??5e3}get maximumRateLimitRetryCount(){var e;return((e=this.joinConfig)==null?void 0:e.maximumRateLimitRetryCount)??10}get maximumNetworkErrorRetryCount(){var e;return((e=this.joinConfig)==null?void 0:e.maximumNetworkErrorRetryCount)??10}async membershipLoopHandler(e){switch(this.oldStatus=this.status,e){case"SendFirstDelayedEvent":return this.state.delayId?this.cancelKnownDelayIdBeforeSendFirstDelayedEvent(this.state.delayId):this.sendFirstDelayedLeaveEvent();case"RestartDelayedEvent":return this.state.delayId?this.restartDelayedEvent(this.state.delayId):fs(this.state.hasMemberStateEvent?"SendMainDelayedEvent":"SendFirstDelayedEvent");case"SendMainDelayedEvent":return this.sendMainDelayedEvent();case"SendScheduledDelayedLeaveEvent":return this.state.hasMemberStateEvent?this.state.delayId?this.sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(this.state.delayId):fs("SendLeaveEvent"):{replace:[]};case"SendJoinEvent":return this.sendJoinEvent();case"UpdateExpiry":return this.updateExpiryOnJoinedEvent();case"SendLeaveEvent":return this.state.hasMemberStateEvent?this.sendFallbackLeaveEvent():{replace:[]}}}async sendFirstDelayedLeaveEvent(){return await this.client._unstable_sendDelayedStateEvent(this.room.roomId,{delay:this.membershipServerSideExpiryTimeout},ie.GroupCallMemberPrefix,{},this.stateKey).then(e=>(this.state.rateLimitRetries.set("SendFirstDelayedEvent",0),this.state.networkErrorRetries.set("SendFirstDelayedEvent",0),this.state.delayId=e.delay_id,fs("SendJoinEvent"))).catch(e=>{const t="SendFirstDelayedEvent";if(this.manageMaxDelayExceededSituation(e))return fs(t);const r=this.actionUpdateFromErrors(e,t,"sendDelayedStateEvent");return r||(this.isUnsupportedDelayedEndpoint(e)?Tr.info("Not using delayed event because the endpoint is not supported"):Tr.info("Not using delayed event because: "+e),fs("SendJoinEvent"))})}async cancelKnownDelayIdBeforeSendFirstDelayedEvent(e){return await this.client._unstable_updateDelayedEvent(e,Bl.Cancel).then(()=>(this.state.delayId=void 0,this.resetRateLimitCounter("SendFirstDelayedEvent"),UT("SendFirstDelayedEvent"))).catch(t=>{const r="SendFirstDelayedEvent",i=this.actionUpdateFromErrors(t,r,"updateDelayedEvent");if(i)return i;if(this.isNotFoundError(t))return this.state.delayId=void 0,UT(r);if(this.isUnsupportedDelayedEndpoint(t))return UT("SendJoinEvent");throw Error("We failed to cancel a delayed event where we already had a delay id with an error we cannot automatically handle")})}async restartDelayedEvent(e){return await this.client._unstable_updateDelayedEvent(e,Bl.Restart).then(()=>(this.resetRateLimitCounter("RestartDelayedEvent"),fs("RestartDelayedEvent",this.membershipKeepAlivePeriod))).catch(t=>{const r="RestartDelayedEvent";if(this.isNotFoundError(t))return this.state.delayId=void 0,fs("SendMainDelayedEvent");if(this.isUnsupportedDelayedEndpoint(t))return{};const i=this.actionUpdateFromErrors(t,r,"updateDelayedEvent");if(i)return i;throw Error("Could not restart delayed event, even though delayed events are supported. "+t)})}async sendMainDelayedEvent(){return await this.client._unstable_sendDelayedStateEvent(this.room.roomId,{delay:this.membershipServerSideExpiryTimeout},ie.GroupCallMemberPrefix,{},this.stateKey).then(e=>(this.state.delayId=e.delay_id,this.resetRateLimitCounter("SendMainDelayedEvent"),fs("RestartDelayedEvent",this.membershipKeepAlivePeriod))).catch(e=>{const t="SendMainDelayedEvent";if(this.isUnsupportedDelayedEndpoint(e))return{};if(this.manageMaxDelayExceededSituation(e))return fs(t);const r=this.actionUpdateFromErrors(e,t,"updateDelayedEvent");if(r)return r;throw Error("Could not send delayed event, even though delayed events are supported. "+e)})}async sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(e){return await this.client._unstable_updateDelayedEvent(e,Bl.Send).then(()=>(this.state.hasMemberStateEvent=!1,this.resetRateLimitCounter("SendScheduledDelayedLeaveEvent"),{replace:[]})).catch(t=>{const r="SendLeaveEvent";if(this.isUnsupportedDelayedEndpoint(t))return{};if(this.isNotFoundError(t))return this.state.delayId=void 0,fs(r);const i=this.actionUpdateFromErrors(t,r,"updateDelayedEvent");return i||(Tr.warn("Encountered unexpected error during SendScheduledDelayedLeaveEvent. Falling back to SendLeaveEvent",t),fs(r))})}async sendJoinEvent(){return await this.client.sendStateEvent(this.room.roomId,ie.GroupCallMemberPrefix,this.makeMyMembership(this.membershipEventExpiryTimeout),this.stateKey).then(()=>(this.state.startTime=Date.now(),this.state.expireUpdateIterations=1,this.state.hasMemberStateEvent=!0,this.resetRateLimitCounter("SendJoinEvent"),{insert:[{ts:Date.now(),type:"RestartDelayedEvent"},{ts:this.computeNextExpiryActionTs(this.state.expireUpdateIterations),type:"UpdateExpiry"}]})).catch(e=>{const t=this.actionUpdateFromErrors(e,"SendJoinEvent","sendStateEvent");if(t)return t;throw e})}async updateExpiryOnJoinedEvent(){const e=this.state.expireUpdateIterations+1;return await this.client.sendStateEvent(this.room.roomId,ie.GroupCallMemberPrefix,this.makeMyMembership(this.membershipEventExpiryTimeout*e),this.stateKey).then(()=>(this.resetRateLimitCounter("UpdateExpiry"),this.state.expireUpdateIterations=e,{insert:[{ts:this.computeNextExpiryActionTs(e),type:"UpdateExpiry"}]})).catch(t=>{const r=this.actionUpdateFromErrors(t,"UpdateExpiry","sendStateEvent");if(r)return r;throw t})}async sendFallbackLeaveEvent(){return await this.client.sendStateEvent(this.room.roomId,ie.GroupCallMemberPrefix,{},this.stateKey).then(()=>(this.resetRateLimitCounter("SendLeaveEvent"),this.state.hasMemberStateEvent=!1,{replace:[]})).catch(e=>{const t=this.actionUpdateFromErrors(e,"SendLeaveEvent","sendStateEvent");if(t)return t;throw e})}makeMembershipStateKey(e,t){const r=`${e}_${t}`;return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?r:`_${r}`}makeMyMembership(e){return{call_id:"",scope:"m.room",application:"m.call",device_id:this.deviceId,expires:e,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:this.fociPreferred??[]}}isNotFoundError(e){return e instanceof gn&&e.errcode==="M_NOT_FOUND"}manageMaxDelayExceededSituation(e){if(e instanceof gn&&e.errcode==="M_UNKNOWN"&&e.data["org.matrix.msc4140.errcode"]==="M_MAX_DELAY_EXCEEDED"){const t=e.data["org.matrix.msc4140.max_delay"];return typeof t=="number"&&this.membershipServerSideExpiryTimeout>t&&(this.membershipServerSideExpiryTimeoutOverride=t),Tr.warn("Retry sending delayed disconnection event due to server timeout limitations:",e),!0}return!1}actionUpdateFromErrors(e,t,r){const i=this.actionUpdateFromRateLimitError(e,r,t);if(i)return i;const s=this.actionUpdateFromNetworkErrorRetry(e,t);if(s)return s}actionUpdateFromRateLimitError(e,t,r){if(!((e instanceof Zl||e instanceof gn)&&e.isRateLimitError()))return;const i=this.state.rateLimitRetries.get(r)??0;if(i<this.maximumRateLimitRetryCount){let s;try{s=e.getRetryAfterMs()??5e3,Tr.info(`Rate limited by server, retrying in ${s}ms`)}catch(a){Tr.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of 5000",a),s=5e3}return this.state.rateLimitRetries.set(r,i+1),fs(r,s)}throw Error("Exceeded maximum retries for "+r+" attempts (client."+t+"): "+e)}actionUpdateFromNetworkErrorRetry(e,t){const r=this.state.networkErrorRetries.get(t)??0,i=this.callMemberEventRetryDelayMinimum/1e3+"s",s="("+r+"/"+this.maximumNetworkErrorRetryCount+")";if(e instanceof Error&&e.name==="AbortError")Tr.warn("Network local timeout error while sending event, retrying in "+i+" "+s,e);else if(e instanceof Error&&e.message.includes("updating delayed event"))Tr.warn("delayed event update timeout error, retrying in "+i+" "+s,e);else if(e instanceof Vd)Tr.warn("Network connection error while sending event, retrying in "+i+" "+s,e);else if((e instanceof Zl||e instanceof gn)&&typeof e.httpStatus=="number"&&e.httpStatus>=500&&e.httpStatus<600)Tr.warn("Server error while sending event, retrying in "+i+" "+s,e);else return;if(r<this.maximumNetworkErrorRetryCount)return this.state.networkErrorRetries.set(t,r+1),fs(t,this.callMemberEventRetryDelayMinimum);throw Error("Reached maximum ("+this.maximumNetworkErrorRetryCount+") retries cause by: "+e)}isUnsupportedDelayedEndpoint(e){return e instanceof Ml}resetRateLimitCounter(e){this.state.rateLimitRetries.set(e,0),this.state.networkErrorRetries.set(e,0)}get status(){const e=this.scheduler.actions;if(e.length===1){const{type:t}=e[0];switch(t){case"SendFirstDelayedEvent":case"SendJoinEvent":case"SendMainDelayedEvent":return"Connecting";case"UpdateExpiry":return"Connected";case"SendScheduledDelayedLeaveEvent":case"SendLeaveEvent":return"Disconnecting"}}else if(e.length===2){const t=e.map(r=>r.type);if((t.includes("RestartDelayedEvent")||t.includes("SendMainDelayedEvent"))&&t.includes("UpdateExpiry"))return"Connected"}else if(e.length===3){const t=e.map(r=>r.type);if(t.filter(r=>r==="RestartDelayedEvent").length===2&&t.includes("UpdateExpiry"))return"Connected"}return this.scheduler.running?(Tr.error("MembershipManager has an unknown state. Actions: ",e),"Unknown"):"Disconnected"}}function fs(n,e){return{insert:[{ts:Date.now()+(e??0),type:n}]}}function UT(n,e){return{replace:[{ts:Date.now()+0,type:n}]}}const Hn=O.getChild("MatrixRTCSession");class woe{constructor(e,t,r,i){this.client=e,this.room=t,this.getMemberships=r,this.onEncryptionKeysChanged=i,this.manageMediaKeys=!1,this.setNewKeyTimeouts=new Set,this.encryptionKeys=new Map,this.currentEncryptionKeyIndex=-1,this.statistics={counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}},this.joined=!1,this.isMyMembership=s=>s.sender===this.client.getUserId()&&s.deviceId===this.client.getDeviceId(),this.sendEncryptionKeysEvent=async s=>{if(this.keysEventUpdateTimeout!==void 0&&(clearTimeout(this.keysEventUpdateTimeout),this.keysEventUpdateTimeout=void 0),this.lastEncryptionKeyUpdateRequest=Date.now(),!this.joined)return;Hn.info(`Sending encryption keys event. indexToSend=${s}`);const o=this.client.getUserId(),a=this.client.getDeviceId();if(!o)throw new Error("No userId");if(!a)throw new Error("No deviceId");const c=this.getKeysForParticipant(o,a);if(!c){Hn.warn("Tried to send encryption keys event but no keys found!");return}if(typeof s!="number"&&this.currentEncryptionKeyIndex===-1){Hn.warn("Tried to send encryption keys event but no current key index found!");return}const l=s??this.currentEncryptionKeyIndex,u=c[l];try{const h={keys:[{index:l,key:T$(u)}],device_id:a,call_id:"",sent_ts:Date.now()};this.statistics.counters.roomEventEncryptionKeysSent+=1,await this.client.sendEvent(this.room.roomId,ie.CallEncryptionKeysPrefix,h),Hn.debug(`Embedded-E2EE-LOG updateEncryptionKeyEvent participantId=${o}:${a} numKeys=${c.length} currentKeyIndex=${this.currentEncryptionKeyIndex} keyIndexToSend=${l}`,this.encryptionKeys)}catch(h){const p=h;if(p.event&&this.client.cancelPendingEvent(p.event),this.keysEventUpdateTimeout===void 0){const m=fP(p,5e3);Hn.warn(`Failed to send m.call.encryption_key, retrying in ${m}`,h),this.keysEventUpdateTimeout=setTimeout(()=>void this.sendEncryptionKeysEvent(),m)}else Hn.info("Not scheduling key resend as another re-send is already pending")}},this.onCallEncryptionEventReceived=s=>{const o=s.getSender(),a=s.getContent(),c=a.device_id,l=a.call_id;if(!o){Hn.warn(`Received m.call.encryption_keys with no userId: callId=${l}`);return}if(l!==""){Hn.warn(`Received m.call.encryption_keys with unsupported callId: userId=${o}, deviceId=${c}, callId=${l}`);return}if(!Array.isArray(a.keys)){Hn.warn(`Received m.call.encryption_keys where keys wasn't an array: callId=${l}`);return}if(o===this.client.getUserId()&&c===this.client.getDeviceId()){Hn.info("Ignoring our own keys event");return}this.statistics.counters.roomEventEncryptionKeysReceived+=1;const u=Date.now()-(typeof a.sent_ts=="number"?a.sent_ts:s.getTs());this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=u;for(const h of a.keys){if(!h){Hn.info("Ignoring false-y key in keys event");continue}const p=h.key,m=h.index;!p||m===void 0||m===null||l===void 0||l===null||typeof c!="string"||typeof l!="string"||typeof p!="string"||typeof m!="number"?Hn.warn(`Malformed call encryption_key: userId=${o}, deviceId=${c}, encryptionKeyIndex=${m} callId=${l}`):(Hn.debug(`Embedded-E2EE-LOG onCallEncryption userId=${o}:${c} encryptionKeyIndex=${m} age=${u}ms`,this.encryptionKeys),this.setEncryptionKey(o,c,m,p,s.getTs()))}},this.onRotateKeyTimeout=()=>{if(!this.manageMediaKeys)return;this.makeNewKeyTimeout=void 0,Hn.info("Making new sender key for key rotation");const s=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(s)}}get updateEncryptionKeyThrottle(){var e;return((e=this.joinConfig)==null?void 0:e.updateEncryptionKeyThrottle)??3e3}get makeKeyDelay(){var e;return((e=this.joinConfig)==null?void 0:e.makeKeyDelay)??3e3}get useKeyDelay(){var e;return((e=this.joinConfig)==null?void 0:e.useKeyDelay)??5e3}getEncryptionKeys(){return this.encryptionKeys}join(e){var t,r;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=((t=this.joinConfig)==null?void 0:t.manageMediaKeys)??this.manageMediaKeys,(r=this.joinConfig)!=null&&r.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){const e=this.client.getUserId(),t=this.client.getDeviceId();if(!e)throw new Error("No userId");if(!t)throw new Error("No deviceId");this.encryptionKeys.set(b_(e,t),[]),this.makeNewKeyTimeout!==void 0&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0);for(const r of this.setNewKeyTimeouts)clearTimeout(r);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){if(this.manageMediaKeys&&this.joined){const t=new Set(e.filter(a=>!this.isMyMembership(a)).map(jT)),r=new Set(this.getMemberships().filter(a=>!this.isMyMembership(a)).map(jT)),i=Array.from(t).some(a=>!r.has(a)),s=Array.from(r).some(a=>!t.has(a)),o=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),i)this.makeNewKeyTimeout||(Hn.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,this.makeKeyDelay));else if(s)Hn.debug("New member(s) have joined: re-sending keys"),this.requestSendCurrentKey();else if(o){const a=this.lastMembershipFingerprints;(Array.from(o).some(l=>!a.has(l))||Array.from(a).some(l=>!o.has(l)))&&(Hn.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestSendCurrentKey())}}}makeNewSenderKey(e=!1){const t=this.client.getUserId(),r=this.client.getDeviceId();if(!t)throw new Error("No userId");if(!r)throw new Error("No deviceId");const i=I$(16),s=this.getNewEncryptionKeyIndex();return Hn.info("Generated new key at index "+s),this.setEncryptionKey(t,r,s,i,Date.now(),e),s}requestSendCurrentKey(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now()){Hn.info("Last encryption key event sent too recently: postponing"),this.keysEventUpdateTimeout===void 0&&(this.keysEventUpdateTimeout=setTimeout(()=>void this.sendEncryptionKeysEvent(),this.updateEncryptionKeyThrottle));return}this.sendEncryptionKeysEvent()}}getKeysForParticipant(e,t){var r;return(r=this.encryptionKeys.get(b_(e,t)))==null?void 0:r.map(i=>i.key)}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter(e=>!this.isMyMembership(e)).map(e=>`${jT(e)}:${e.createdTs()}`))}getNewEncryptionKeyIndex(){return this.currentEncryptionKeyIndex===-1?0:(this.currentEncryptionKeyIndex+1)%256}setEncryptionKey(e,t,r,i,s,o=!1){const a=_f(i),c=b_(e,t);this.encryptionKeys.has(c)||this.encryptionKeys.set(c,[]);const l=this.encryptionKeys.get(c),u=l[r];if(u){if(u.timestamp>s){Hn.info(`Ignoring new key at index ${r} for ${c} as it is older than existing known key`);return}if(Eoe(u.key,a)){u.timestamp=s;return}}if(l[r]={key:a,timestamp:s},o){const h=setTimeout(()=>{this.setNewKeyTimeouts.delete(h),Hn.info(`Delayed-emitting key changed event for ${c} idx ${r}`),e===this.client.getUserId()&&t===this.client.getDeviceId()&&(this.currentEncryptionKeyIndex=r),this.onEncryptionKeysChanged(a,r,c)},this.useKeyDelay);this.setNewKeyTimeouts.add(h)}else e===this.client.getUserId()&&t===this.client.getDeviceId()&&(this.currentEncryptionKeyIndex=r),this.onEncryptionKeysChanged(a,r,c)}}const b_=(n,e)=>`${n}:${e}`;function Eoe(n,e){return n===e?!0:!!n&&!!e&&n.length===e.length&&n.every((t,r)=>t===e[r])}const jT=n=>b_(n.sender,n.deviceId);class Coe{constructor(e,t,r,i){this.joinConfig=e,this.room=t,this.client=r,this.getOldestMembership=i,this.updateCallMembershipRunning=!1,this.needCallMembershipUpdate=!1,this.triggerCallMembershipEventUpdate=async()=>{if(this.updateCallMembershipRunning){this.needCallMembershipUpdate=!0;return}this.updateCallMembershipRunning=!0;try{do this.needCallMembershipUpdate=!1,await this.updateCallMembershipEvent();while(this.needCallMembershipUpdate)}finally{this.updateCallMembershipRunning=!1}},this.delayDisconnection=async()=>{try{const s=this.disconnectDelayId;await Ah(()=>this.client._unstable_updateDelayedEvent(s,Bl.Restart)),this.scheduleDelayDisconnection()}catch(s){O.error("Failed to delay our disconnection event:",s)}}}get callMemberEventRetryDelayMinimum(){var e;return((e=this.joinConfig)==null?void 0:e.callMemberEventRetryDelayMinimum)??3e3}get membershipExpiryTimeout(){var e;return((e=this.joinConfig)==null?void 0:e.membershipExpiryTimeout)??xP}get membershipServerSideExpiryTimeout(){var e;return this.membershipServerSideExpiryTimeoutOverride??((e=this.joinConfig)==null?void 0:e.membershipServerSideExpiryTimeout)??8e3}get membershipKeepAlivePeriod(){var e;return((e=this.joinConfig)==null?void 0:e.membershipKeepAlivePeriod)??5e3}get callMemberEventRetryJitter(){var e;return((e=this.joinConfig)==null?void 0:e.callMemberEventRetryJitter)??2e3}isJoined(){return this.relativeExpiry!==void 0}join(e,t){this.ownFocusActive=t,this.ownFociPreferred=e,this.relativeExpiry=this.membershipExpiryTimeout,this.triggerCallMembershipEventUpdate()}async leave(e=void 0){return this.relativeExpiry=void 0,this.ownFocusActive=void 0,this.memberEventTimeout&&(clearTimeout(this.memberEventTimeout),this.memberEventTimeout=void 0),e?await Promise.race([this.triggerCallMembershipEventUpdate(),Td(e,"timeout")])!=="timeout":(await this.triggerCallMembershipEventUpdate(),!0)}async onRTCSessionMemberUpdate(e){const t=r=>r.sender===this.client.getUserId()&&r.deviceId===this.client.getDeviceId();if(this.isJoined()&&!e.some(t))return O.warn("Missing own membership: force re-join"),this.triggerCallMembershipEventUpdate()}getActiveFocus(){if(this.ownFocusActive)if(kP(this.ownFocusActive)){if(this.ownFocusActive.focus_selection==="oldest_membership"){const e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}else O.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.");else{const e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}makeNewMembership(e){return this.isJoined()?this.makeMyMembership(e):{}}makeMyMembership(e){return{call_id:"",scope:"m.room",application:"m.call",device_id:e,expires:this.relativeExpiry,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:this.ownFociPreferred??[]}}async updateCallMembershipEvent(){if(this.memberEventTimeout&&(clearTimeout(this.memberEventTimeout),this.memberEventTimeout=void 0),!this.room.getLiveTimeline().getState($e.FORWARDS))throw new Error("Couldn't get room state for room "+this.room.roomId);const t=this.client.getUserId(),r=this.client.getDeviceId();if(!t||!r)throw new Error("User ID or device ID was null!");let i={};i=this.makeNewMembership(r);try{if(this.isJoined()){const s=this.makeMembershipStateKey(t,r),o=async()=>{try{const a=await Ah(()=>this.client._unstable_sendDelayedStateEvent(this.room.roomId,{delay:this.membershipServerSideExpiryTimeout},ie.GroupCallMemberPrefix,{},s));this.disconnectDelayId=a.delay_id}catch(a){if(a instanceof gn&&a.errcode==="M_UNKNOWN"&&a.data["org.matrix.msc4140.errcode"]==="M_MAX_DELAY_EXCEEDED"){const c=a.data["org.matrix.msc4140.max_delay"];if(typeof c=="number"&&this.membershipServerSideExpiryTimeout>c)return this.membershipServerSideExpiryTimeoutOverride=c,o()}O.error("Failed to prepare delayed disconnection event:",a)}};if(await o(),await Ah(()=>this.client.sendStateEvent(this.room.roomId,ie.GroupCallMemberPrefix,i,s)),this.disconnectDelayId!==void 0)try{const a=this.disconnectDelayId;await Ah(()=>this.client._unstable_updateDelayedEvent(a,Bl.Restart))}catch(a){a instanceof gn&&a.errcode==="M_NOT_FOUND"&&(O.warn("Failed to update delayed disconnection event, prepare it again:",a),this.disconnectDelayId=void 0,await o())}this.disconnectDelayId!==void 0&&this.scheduleDelayDisconnection()}else{let s=!1;if(this.disconnectDelayId!==void 0){try{const o=this.disconnectDelayId;await Ah(()=>this.client._unstable_updateDelayedEvent(o,Bl.Send)),s=!0}catch(o){O.error("Failed to send our delayed disconnection event:",o)}this.disconnectDelayId=void 0}s||await Ah(()=>this.client.sendStateEvent(this.room.roomId,ie.GroupCallMemberPrefix,{},this.makeMembershipStateKey(t,r)))}O.info("Sent updated call member event.")}catch(s){const o=this.callMemberEventRetryDelayMinimum+Math.random()*this.callMemberEventRetryJitter;O.warn(`Failed to send call member event (retrying in ${o}): ${s}`),await Td(o),await this.triggerCallMembershipEventUpdate()}}scheduleDelayDisconnection(){this.memberEventTimeout=setTimeout(()=>void this.delayDisconnection(),this.membershipKeepAlivePeriod)}makeMembershipStateKey(e,t){const r=`${e}_${t}`;return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?r:`_${r}`}}async function Ah(n,e=1){for(;;)try{return await n()}catch(t){if(e>0&&t instanceof Zl&&t.isRateLimitError()){e--;let r;const i=5e3;try{r=t.getRetryAfterMs()??i,O.info(`Rate limited by server, retrying in ${r}ms`)}catch(s){O.warn(`Error while retrieving a rate-limit retry delay, retrying after default delay of ${i}`,s),r=i}await Td(r)}else throw t}}const ps=O.getChild("MatrixRTCSession");var ts=(n=>(n.MembershipsChanged="memberships_changed",n.JoinStateChanged="join_state_changed",n.EncryptionKeyChanged="encryption_key_changed",n.MembershipManagerError="membership_manager_error",n))(ts||{});class Sf extends Xn{constructor(e,t,r){var s;super(),this.client=e,this.roomSubset=t,this.memberships=r,this.onCallEncryption=o=>{this.encryptionManager.onCallEncryptionEventReceived(o)},this.onMembershipUpdate=()=>{this.recalculateSessionMembers()},this.onRoomMemberUpdate=()=>{this.recalculateSessionMembers()},this.onRTCSessionMemberUpdate=()=>{this.recalculateSessionMembers()},this.recalculateSessionMembers=()=>{var c,l;const o=this.memberships;this.memberships=Sf.callMembershipsForRoom(this.room),this._callId=this._callId??((c=this.memberships[0])==null?void 0:c.callId),(o.length!=this.memberships.length||o.some((u,h)=>!k5.equal(u,this.memberships[h])))&&(ps.info(`Memberships for call in room ${this.roomSubset.roomId} have changed: emitting`),mre(ps,"emit MatrixRTCSessionEvent.MembershipsChanged",()=>{this.emit("memberships_changed",o,this.memberships)}),(l=this.membershipManager)==null||l.onRTCSessionMemberUpdate(this.memberships)),this.encryptionManager.onMembershipsUpdate(o),this.setExpiryTimer()},this._callId=(s=r[0])==null?void 0:s.callId;const i=this.roomSubset.getLiveTimeline().getState($e.FORWARDS);i==null||i.on(kt.Members,this.onRoomMemberUpdate),this.setExpiryTimer(),this.encryptionManager=new woe(this.client,this.roomSubset,()=>this.memberships,(o,a,c)=>{this.emit("encryption_key_changed",o,a,c)})}get statistics(){return this.encryptionManager.statistics}get callId(){return this._callId}static callMembershipsForRoom(e){const t=e.getLiveTimeline().getState($e.FORWARDS);if(!t)throw ps.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);const r=t.getStateEvents(ie.GroupCallMemberPrefix),i=[];for(const s of r){const o=s.getContent(),a=Object.keys(o).length;if(a===0)continue;const c=[];if(a>1&&"focus_active"in o?c.push(o):a===1&&"memberships"in o&&ps.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),c.length!==0)for(const l of c)try{const u=new k5(s,l);if(u.callId!==""||u.scope!=="m.room"){ps.info("Ignoring user-scoped call");continue}if(u.isExpired()){ps.info(`Ignoring expired device membership ${u.sender}/${u.deviceId}`);continue}if(!e.hasMembershipState(u.sender??"",ze.Join)){ps.info(`Ignoring membership of user ${u.sender} who is not in the room.`);continue}i.push(u)}catch(u){ps.warn("Couldn't construct call membership: ",u)}}return i.sort((s,o)=>s.createdTs()-o.createdTs()),i.length>1&&ps.debug(`Call memberships in room ${e.roomId}, in order: `,i.map(s=>[s.createdTs(),s.sender])),i}static roomSessionForRoom(e,t){const r=Sf.callMembershipsForRoom(t);return new Sf(e,t,r)}get room(){return this.roomSubset}isJoined(){var e;return((e=this.membershipManager)==null?void 0:e.isJoined())??!1}async stop(){var t;await((t=this.membershipManager)==null?void 0:t.leave(1e3)),this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0);const e=this.roomSubset.getLiveTimeline().getState($e.FORWARDS);e==null||e.off(kt.Members,this.onRoomMemberUpdate)}joinRoomSession(e,t,r){if(this.isJoined()){ps.info(`Already joined to session in room ${this.roomSubset.roomId}: ignoring join call`);return}else(r==null?void 0:r.useNewMembershipManager)??!1?this.membershipManager=new Fb(r,this.roomSubset,this.client,()=>this.getOldestMembership()):this.membershipManager=new Coe(r,this.roomSubset,this.client,()=>this.getOldestMembership());this.membershipManager.join(e,t,i=>{ps.error("MembershipManager encountered an unrecoverable error: ",i),this.emit("membership_manager_error",i),this.emit("join_state_changed",this.isJoined())}),this.encryptionManager.join(r),this.emit("join_state_changed",!0)}async leaveRoomSession(e=void 0){if(!this.isJoined())return ps.info(`Not joined to session in room ${this.roomSubset.roomId}: ignoring leave call`),!1;ps.info(`Leaving call session in room ${this.roomSubset.roomId}`),this.encryptionManager.leave();const t=this.membershipManager.leave(e);return this.emit("join_state_changed",!1),await t}getActiveFocus(){var e;return(e=this.membershipManager)==null?void 0:e.getActiveFocus()}getOldestMembership(){return this.memberships[0]}getFocusInUse(){const e=this.getOldestMembership();if((e==null?void 0:e.getFocusSelection())==="oldest_membership")return e.getPreferredFoci()[0]}reemitEncryptionKeys(){this.encryptionManager.getEncryptionKeys().forEach((e,t)=>{e.forEach((r,i)=>{this.emit("encryption_key_changed",r.key,i,t)})})}getEncryptionKeys(){const e=this.encryptionManager.getEncryptionKeys()??new Map;return Array.from(e.entries()).map(([t,r])=>[t,r.map(i=>i.key)]).values()}setExpiryTimer(){this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0);let e;for(const t of this.memberships){const r=t.getMsUntilExpiry();r!==void 0&&(e===void 0||r<e)&&(e=r)}e!=null&&(this.expiryTimeout=setTimeout(this.onRTCSessionMemberUpdate,e))}}const Fm=O.getChild("MatrixRTCSessionManager");var ak=(n=>(n.SessionStarted="session_started",n.SessionEnded="session_ended",n))(ak||{});class Toe extends Xn{constructor(e){super(),this.client=e,this.roomSessions=new Map,this.onTimeline=t=>{this.consumeCallEncryptionEvent(t)},this.onRoom=t=>{this.refreshRoom(t)},this.onRoomState=(t,r)=>{const i=this.client.getRoom(t.getRoomId());if(!i){Fm.error(`Got room state event for unknown room ${t.getRoomId()}!`);return}t.getType()==ie.GroupCallMemberPrefix&&this.refreshRoom(i)}}start(){for(const e of this.client.getRooms()??[]){const t=Sf.roomSessionForRoom(this.client,e);t.memberships.length>0&&this.roomSessions.set(e.roomId,t)}this.client.on(qe.Room,this.onRoom),this.client.on(Je.Timeline,this.onTimeline),this.client.on(kt.Events,this.onRoomState)}stop(){for(const e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(qe.Room,this.onRoom),this.client.off(Je.Timeline,this.onTimeline),this.client.off(kt.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,Sf.roomSessionForRoom(this.client,e)),this.roomSessions.get(e.roomId)}async consumeCallEncryptionEvent(e,t=!1){if(await this.client.decryptEventIfNeeded(e),e.isDecryptionFailure()){t?Fm.warn(`Decryption failed for event ${e.getId()}: ${e.decryptionFailureReason}`):(Fm.warn(`Decryption failed for event ${e.getId()}: ${e.decryptionFailureReason} will retry once only`),setTimeout(()=>void this.consumeCallEncryptionEvent(e,!0),1e3));return}else t&&Fm.info(`Decryption succeeded for event ${e.getId()} after retry`);if(e.getType()!==ie.CallEncryptionKeysPrefix)return Promise.resolve();const r=this.client.getRoom(e.getRoomId());if(!r)return Fm.error(`Got room state event for unknown room ${e.getRoomId()}!`),Promise.resolve();this.getRoomSession(r).onCallEncryption(e)}refreshRoom(e){const t=!this.roomSessions.has(e.roomId),r=this.getRoomSession(e),i=r.memberships.length>0&&!t;r.onRTCSessionMemberUpdate();const s=r.memberships.length>0;i&&!s?this.emit("session_ended",e.roomId,this.roomSessions.get(e.roomId)):!i&&s&&this.emit("session_started",e.roomId,this.roomSessions.get(e.roomId))}}function $T(n){return e=>{var t,r,i,s;return((r=(t=e.content)==null?void 0:t["m.relates_to"])==null?void 0:r.event_id)!==n||((s=(i=e.content)==null?void 0:i["m.relates_to"])==null?void 0:s.rel_type)===tn.name}}async function V$(n){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");const e=new TextEncoder().encode(n),t=await globalThis.crypto.subtle.digest("SHA-256",e);return new Uint8Array(t)}var Kr=(n=>(n.NotSupported="OIDC authentication not supported",n.Misconfigured="OIDC is misconfigured",n.General="Something went wrong with OIDC discovery",n.OpSupport="Configured OIDC OP does not support required functions",n.DynamicRegistrationNotSupported="Dynamic registration not supported",n.DynamicRegistrationFailed="Dynamic registration failed",n.DynamicRegistrationInvalid="Dynamic registration invalid response",n.CodeExchangeFailed="Failed to exchange code for token",n.InvalidBearerTokenResponse="Invalid bearer token response",n.InvalidIdToken="Invalid ID token",n.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",n))(Kr||{});const LP=n=>!!n&&typeof n=="object"&&!Array.isArray(n),vc=(n,e)=>!n[e]||!kg(n,e)?(O.error(`Missing or invalid property: ${e}`),!1):!0,kg=(n,e)=>n[e]&&typeof n[e]!="string"?(O.error(`Invalid property: ${e}`),!1):!0,x5=(n,e)=>n[e]&&(!Array.isArray(n[e])||!n[e].every(t=>typeof t=="string"))?(O.error(`Invalid property: ${e}`),!1):!0,BT=(n,e,t)=>{const r=n[e];return!r||!Array.isArray(r)||!r.includes(t)?(O.error(`Invalid property: ${e}. ${t} is required.`),!1):!0},G$=n=>{if(!LP(n))throw O.error("Issuer configuration not found or malformed"),new Error(Kr.OpSupport);if(![vc(n,"issuer"),vc(n,"authorization_endpoint"),vc(n,"token_endpoint"),vc(n,"revocation_endpoint"),kg(n,"registration_endpoint"),kg(n,"account_management_uri"),kg(n,"device_authorization_endpoint"),x5(n,"account_management_actions_supported"),BT(n,"response_types_supported","code"),BT(n,"grant_types_supported","authorization_code"),BT(n,"code_challenge_methods_supported","S256"),x5(n,"prompt_values_supported")].some(t=>!t))return n;throw O.error("Issuer configuration not valid"),new Error(Kr.OpSupport)},q$=n=>{try{return n$(n)}catch(e){throw O.error("Could not decode id_token",e),e}},K$=(n,e,t,r)=>{try{if(!n)throw new Error("No ID token");const i=q$(n);if(i.iss!==e)throw new Error("Invalid issuer");if(!(typeof i.aud=="string"?[i.aud]:i.aud).includes(t))throw new Error("Invalid audience");if(r!==void 0&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>i.exp*1e3)throw new Error("Invalid expiry")}catch(i){throw O.error("Invalid ID token",i),new Error(Kr.InvalidIdToken)}};function W$(n){if(!LP(n))throw O.error("Stored user state not found"),new Error(Kr.MissingOrInvalidStoredState);if([vc(n,"homeserverUrl"),vc(n,"nonce"),kg(n,"identityServerUrl")].some(t=>!t))throw new Error(Kr.MissingOrInvalidStoredState)}const Ioe=n=>LP(n)&&vc(n,"token_type")&&n.token_type.toLowerCase()==="bearer"&&vc(n,"access_token")&&vc(n,"refresh_token")&&(!("expires_in"in n)||typeof n.expires_in=="number");function z$(n){if(!Ioe(n))throw new Error(Kr.InvalidBearerTokenResponse)}const vw=n=>`openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:${n??Es(10)}`,Roe=async n=>{if(!globalThis.crypto.subtle)return O.warn("A secure context is required to generate code challenge. Using plain text code challenge"),n;const e=await V$(n);return hw(e)},koe=({redirectUri:n})=>({scope:vw(),redirectUri:n,state:Es(8),nonce:Es(8),codeVerifier:Es(64)}),xoe=async(n,e,{scope:t,redirectUri:r,state:i,nonce:s,codeVerifier:o})=>{const a=new URL(n);return a.searchParams.append("response_mode","query"),a.searchParams.append("response_type","code"),a.searchParams.append("redirect_uri",r),a.searchParams.append("client_id",e),a.searchParams.append("state",i),a.searchParams.append("scope",t),a.searchParams.append("nonce",s),a.searchParams.append("code_challenge_method","S256"),a.searchParams.append("code_challenge",await Roe(o)),a.toString()},Poe=async({metadata:n,redirectUri:e,clientId:t,homeserverUrl:r,identityServerUrl:i,nonce:s,prompt:o,urlState:a})=>{const c=vw(),l=new hP({...n,client_id:t,redirect_uri:e,authority:n.issuer,response_mode:"query",response_type:"code",scope:c,stateStore:new cw({prefix:"mx_oidc_",store:window.sessionStorage})}),u={homeserverUrl:r,nonce:s,identityServerUrl:i};return(await l.createSigninRequest({state:u,nonce:s,prompt:o,url_state:a})).url},Loe=n=>({id_token:n.id_token,scope:n.scope,expires_at:n.expires_at,refresh_token:n.refresh_token,access_token:n.access_token,token_type:"Bearer"}),Aoe=async(n,e)=>{const t=new URL(window.location.origin);t.searchParams.append("code",n),t.searchParams.append("state",e),ov.setLogger(O);try{const r=new v_(t.searchParams),i=new cw({prefix:"mx_oidc_",store:window.sessionStorage}),s=await i.get(r.state);if(!s)throw new Error(Kr.MissingOrInvalidStoredState);const o=await dP.fromStorageString(s),a=new hP({...o,stateStore:i}),c=await a.processSigninResponse(t.href),l=c.userState;W$(l),z$(c),K$(c.id_token,a.settings.authority,a.settings.client_id,l.nonce);const u=Loe(c);return{oidcClientSettings:{clientId:a.settings.client_id,issuer:a.settings.authority},tokenResponse:u,homeserverUrl:l.homeserverUrl,identityServerUrl:l.identityServerUrl,idTokenClaims:c.profile}}catch(r){O.error("Oidc login failed",r);const i=r.message;throw Object.values(Kr).includes(i)?r:new Error(Kr.CodeExchangeFailed)}},AP=async n=>{const e=new URL(".well-known/openid-configuration",n),r=await(await fetch(e,{method:de.Get,signal:lw(5e3)})).json();return MP(r)},MP=async n=>{const e=G$(n),t=new VR({authority:e.issuer,metadata:e,redirect_uri:"",client_id:""}),r=new i$(t);return{...e,signingKeys:await r.getSigningKeys()}},Moe="urn:ietf:params:oauth:grant-type:device_code",Ooe=async(n,e)=>{if(!n.registration_endpoint)throw new Error(Kr.DynamicRegistrationNotSupported);const t=["authorization_code","refresh_token"];if(t.some(s=>!n.grant_types_supported.includes(s)))throw new Error(Kr.DynamicRegistrationNotSupported);const r={client_name:e.clientName,client_uri:e.clientUri,response_types:["code"],grant_types:t,redirect_uris:e.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:e.applicationType,logo_uri:e.logoUri,contacts:e.contacts,policy_uri:e.policyUri,tos_uri:e.tosUri},i={Accept:"application/json","Content-Type":"application/json"};try{const s=await fetch(n.registration_endpoint,{method:de.Post,headers:i,body:JSON.stringify(r)});if(s.status>=400)throw new Error(Kr.DynamicRegistrationFailed);const a=(await s.json()).client_id;if(!a||typeof a!="string")throw new Error(Kr.DynamicRegistrationInvalid);return a}catch(s){throw Object.values(Kr).includes(s.message)?s:(O.error("Dynamic registration request failed",s),new Error(Kr.DynamicRegistrationFailed))}};class Noe{constructor(e,t,r,i,s){this.idTokenClaims=s,this.oidcClientReady=this.initialiseOidcClient(e,t,i,r)}async initialiseOidcClient(e,t,r,i){try{const s=await AP(e),o=vw(r);this.oidcClient=new hP({metadata:s,signingKeys:s.signingKeys??void 0,client_id:t,scope:o,redirect_uri:i,authority:s.issuer,stateStore:new cw({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(s){throw O.error("Failed to initialise OIDC client.",s),new Error("Failed to initialise OIDC client.")}}async doRefreshAccessToken(e){this.inflightRefreshRequest||(this.inflightRefreshRequest=this.getNewTokens(e));try{return await this.inflightRefreshRequest}finally{this.inflightRefreshRequest=void 0}}async persistTokens(e){}async getNewTokens(e){if(!this.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");const t={refresh_token:e,session_state:"test",data:void 0,profile:this.idTokenClaims},r=await this.oidcClient.useRefreshToken({state:t,timeoutInSeconds:300}),i={accessToken:r.access_token,refreshToken:r.refresh_token};return await this.persistTokens(i),i}}const Doe=3e3,P5=10*60*1e3,Foe=new jn("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent");var Rd=(n=>(n.Chronological="chronological",n.Detached="detached",n))(Rd||{});const Uoe=new tw("m.get_login_token","org.matrix.msc3882.get_login_token"),Y$="uk.half-shot.msc2666",X$="uk.half-shot.msc2666.mutual_rooms",J$="uk.half-shot.msc2666.query_mutual_rooms",ga="org.matrix.msc4140",Z$="uk.tcpip.msc4133",ta="$";var qe=(n=>(n.Sync="sync",n.Event="event",n.ToDeviceEvent="toDeviceEvent",n.AccountData="accountData",n.Room="Room",n.DeleteRoom="deleteRoom",n.SyncUnexpectedError="sync.unexpectedError",n.ClientWellKnown="WellKnown.client",n.ReceivedVoipEvent="received_voip_event",n.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",n.TurnServers="turnServers",n.TurnServersError="turnServers.error",n))(qe||{});const joe=new jn("action","org.matrix.msc3824.action"),B4=class B4 extends Xn{constructor(e){super(),this.reEmitter=new sy(this),this.olmVersion=null,this.usingExternalCrypto=!1,this.clientRunning=!1,this.timelineSupport=!1,this.urlPreviewCache={},this.supportsCallTransfer=!1,this.forceTURN=!1,this.iceCandidatePoolSize=0,this.canSupportVoip=!1,this.peekSync=null,this.isGuestAccount=!1,this.ongoingScrollbacks={},this.notifTimelineSet=null,this.fallbackICEServerAllowed=!1,this.syncedLeftRooms=!1,this.canSupport=new Map,this.pushProcessor=new Mb(this),this.turnServers=[],this.turnServersExpiry=0,this.txnCtr=0,this.mediaHandler=new Jse(this),this.eventsBeingEncrypted=new Set,this.useE2eForGroupCall=!0,this.startCallEventHandler=()=>{this.isInitialSyncComplete()&&(QR()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off("sync",this.startCallEventHandler))},this.startMatrixRTC=()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off("sync",this.startMatrixRTC))},this.fixupRoomNotifications=()=>{if(this.isInitialSyncComplete()){const r=(this.getRooms()??[]).filter(i=>i.getUnreadNotificationCount(sr.Total)>0);for(const i of r){const s=this.getSafeUserId();i.fixupNotifications(s)}this.off("sync",this.fixupRoomNotifications)}},this.logger=e.logger??O,e.baseUrl=IT(e.baseUrl),e.idBaseUrl=IT(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=e.usingExternalCrypto??!1,this.store=e.store||new rse,this.deviceId=e.deviceId||null,this.sessionId=Es(10);const t=e.userId||null;this.credentials={userId:t},this.http=new g$(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:ur.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.pickleKey&&(this.legacyPickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction(async r=>{const i=this.getRoom(r.getRoomId());r.status!==nt.SENDING&&this.updatePendingEventStatus(i,r,nt.SENDING);const s=await this.sendEventHttpRequest(r);return i&&i.updatePendingEvent(r,nt.SENT,s.event_id),s}),QR()&&(this.callEventHandler=new wse(this),this.groupCallEventHandler=new Ese(this),this.canSupportVoip=!0,this.on("sync",this.startCallEventHandler)),this.matrixRTC=new Toe(this),this.serverCapabilitiesService=new v$(this.http),this.on("sync",this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.legacyCryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=e.iceCandidatePoolSize===void 0?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,e.useE2eForGroupCall!==void 0&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new soe(this),this.on(mn.Decrypted,r=>{Q$(this,r)}),this.ignoredInvites=new ooe(this),this._secretStorage=new B$(this,e.cryptoCallbacks??{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator(t=>_c.createUser(t,this))}get store(){return this._store}async startClient(e){if(this.clientRunning)return;this.clientRunning=!0,this.on("sync",this.startMatrixRTC);const t=this.getUserId();t&&this.store.storeUser(new _c(t)),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval(()=>{this.checkTurnServers()},P5),this.checkTurnServers()),this.syncApi&&(this.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop());try{await this.getVersions();const{threads:r,list:i,fwdPagination:s}=await this.doesServerSupportThread();Gr.setServerSideSupport(r),Gr.setServerSideListSupport(i),Gr.setServerSideFwdPaginationSupport(s)}catch(r){this.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",r)}this.clientOpts=e??{},this.clientOpts.slidingSync?this.syncApi=new F$(this.clientOpts.slidingSync,this,this.clientOpts,this.buildSyncApiOptions()):this.syncApi=new nd(this,this.clientOpts,this.buildSyncApiOptions()),this.syncApi.sync().catch(r=>this.logger.info("Sync startup aborted with an error:",r)),this.clientOpts.clientWellKnownPollPeriod!==void 0&&(this.clientWellKnownIntervalID=setInterval(()=>{this.fetchClientWellKnown()},1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.toDeviceMessageQueue.start(),this.serverCapabilitiesService.start()}buildSyncApiOptions(){return{cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>this.canResetTimelineCallback?this.canResetTimelineCallback(e):!1}}stopClient(){var e,t,r,i,s;(e=this.cryptoBackend)==null||e.stop(),this.off("sync",this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,(t=this.syncApi)==null||t.stop(),this.syncApi=void 0,(r=this.peekSync)==null||r.stopPeeking(),(i=this.callEventHandler)==null||i.stop(),(s=this.groupCallEventHandler)==null||s.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.clientWellKnownIntervalID!==void 0&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];e.push(this.store.deleteAllData()),this.legacyCryptoStore&&e.push(this.legacyCryptoStore.deleteAllData());const t=async()=>{let r;try{if(r=globalThis.indexedDB,!r)return}catch{return}for(const i of[`${FT}::matrix-sdk-crypto`,`${FT}::matrix-sdk-crypto-meta`])await new Promise((o,a)=>{this.logger.info(`Removing IndexedDB instance ${i}`);const c=r.deleteDatabase(i);c.onsuccess=l=>{this.logger.info(`Removed IndexedDB instance ${i}`),o(0)},c.onerror=l=>{this.logger.warn(`Failed to remove IndexedDB instance ${i}:`,l),o(0)},c.onblocked=l=>{this.logger.info(`cannot yet remove IndexedDB instance ${i}`)}})};return e.push(t()),Promise.all(e).then()}getUserId(){var e;return((e=this.credentials)==null?void 0:e.userId)??null}getSafeUserId(){const e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return(e=this.credentials)!=null&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,t;return((t=(e=this.credentials)==null?void 0:e.userId)==null?void 0:t.split(":")[0].substring(1))??null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return av(this,e)}async createGroupCall(e,t,r,i,s,o){if(this.getGroupCallForRoom(e))throw new Error(`${e} already has an existing group call`);const a=this.getRoom(e);if(!a)throw new Error(`Cannot find room ${e}`);return new wP(this,a,t,r,i,void 0,s||this.isVoipWithNoMediaAllowed,o,this.isVoipWithNoMediaAllowed,this.useLivekitForGroupCalls,this.livekitServiceURL).create()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e;return((e=this.syncApi)==null?void 0:e.getSyncState())??null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return e?e===Lr.Prepared||e===Lr.Syncing:!1}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e;return this.toDeviceMessageQueue.sendQueue(),((e=this.syncApi)==null?void 0:e.retryImmediately())??!1}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}async getCapabilities(){const e=this.serverCapabilitiesService.getCachedCapabilities();return e||this.serverCapabilitiesService.fetchCapabilities()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}async initRustCrypto(e={}){if(this.cryptoBackend){this.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");return}const t=this.getUserId();if(t===null)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");const r=this.getDeviceId();if(r===null)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");this.logger.debug("Downloading Rust crypto library");const s=await(await rv(()=>import("./index-ClsPfYEg.js"),__vite__mapDeps([0,1]),import.meta.url)).initRustCrypto({logger:this.logger,http:this.http,userId:t,deviceId:r,secretStorage:this.secretStorage,cryptoCallbacks:this.cryptoCallbacks,storePrefix:e.useIndexedDB===!1?null:FT,storeKey:e.storageKey,storePassphrase:e.storagePassword,legacyCryptoStore:this.legacyCryptoStore,legacyPickleKey:this.legacyPickleKey??"DEFAULT_KEY",legacyMigrationProgressListener:(o,a)=>{this.emit(lr.LegacyCryptoStoreMigrationProgress,o,a)}});s.setSupportedVerificationMethods(this.verificationMethods),this.cryptoBackend=s,this.on(Fo.Membership,s.onRoomMembership.bind(s)),this.on("event",o=>{s.onLiveEventFromSync(o)}),this.reEmitter.reEmit(s,[lr.VerificationRequestReceived,lr.UserTrustStatusChanged,lr.KeyBackupStatus,lr.KeyBackupSessionsRemaining,lr.KeyBackupFailed,lr.KeyBackupDecryptionKeyCached,lr.KeysChanged,lr.DevicesUpdated,lr.WillUpdateDevices,lr.DehydratedDeviceCreated,lr.DehydratedDeviceUploaded,lr.RehydrationStarted,lr.RehydrationProgress,lr.RehydrationCompleted,lr.RehydrationError,lr.DehydrationKeyCached,lr.DehydratedDeviceRotationError])}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isRoomEncrypted(e){const t=this.getRoom(e);return t?t.hasEncryptionStateEvent():!1}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}makeKeyBackupPath(e,t,r){let i;return t!==void 0?i=Ae("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):e!==void 0?i=Ae("/room_keys/keys/$roomId",{$roomId:e}):i="/room_keys/keys",{path:i,queryData:r===void 0?void 0:{version:r}}}async deleteKeysFromBackup(e,t,r){const i=this.makeKeyBackupPath(e,t,r);await this.http.authedRequest(de.Delete,i.path,i.queryData,void 0,{prefix:ur.V3})}getMediaConfig(){return this.http.authedRequest(de.Get,"/config",void 0,void 0,{prefix:ld.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(e=!1){var i;const t=this.store.getRooms(),r=new Set;for(const s of t){const o=(i=s.findPredecessor(e))==null?void 0:i.roomId;o&&r.add(o)}return t.filter(s=>!(s.currentState.getStateEvents(ie.RoomTombstone,"")&&r.has(s.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}async setAccountData(e,t){if(!this.clientRunning)return O.warn("Calling `setAccountData` before the client is started: `getAccountData` may return inconsistent results."),await KR(5,()=>this.setAccountDataRaw(e,t));const r=this.store.getAccountData(e);if(r&&Cd(r.event.content,t))return{};const i=Xl();function s(o){o.getType()===e&&i.resolve()}this.addListener("accountData",s);try{const o=await KR(5,()=>this.setAccountDataRaw(e,t));return await i.promise,o}finally{this.removeListener("accountData",s)}}setAccountDataRaw(e,t){const r=Ae("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this.http.authedRequest(de.Put,r,void 0,t)}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){var r;if(this.isInitialSyncComplete()){const i=this.store.getAccountData(e);return i?i.getContent():null}const t=Ae("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(de.Get,t)}catch(i){if(((r=i.data)==null?void 0:r.errcode)==="M_NOT_FOUND")return null;throw i}}async deleteAccountData(e){const t=this.canSupport.get(vs.AccountDataDeletion);if(t===Vr.Unsupported){await this.setAccountData(e,{});return}const r=Ae("/user/$userId/account_data/$type",{$userId:this.getSafeUserId(),$type:e}),i=t===Vr.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return await this.http.authedRequest(de.Delete,r,void 0,void 0,i)}getIgnoredUsers(){const e=this.getAccountData(ie.IgnoredUserList);return e!=null&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){const t={ignored_users:{}};return e.forEach(r=>{t.ignored_users[r]={}}),this.setAccountData(ie.IgnoredUserList,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,t={}){t.syncRoom===void 0&&(t.syncRoom=!0);const r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,ze.Join))return r;let i=Promise.resolve();if(t.inviteSignUrl){const v=new URL(t.inviteSignUrl);v.searchParams.set("mxid",this.credentials.userId),i=this.http.requestOtherUrl(de.Post,v)}const s={};t.viaServers&&(s.server_name=t.viaServers,s.via=t.viaServers);const o={},a=await i;a&&(o.third_party_signed=a);const c=Ae("/join/$roomid",{$roomid:e}),u=(await this.http.authedRequest(de.Post,c,s,o)).room_id,h=this.getRoom(u);if(h!=null&&h.hasMembershipState(this.credentials.userId,ze.Join))return h;const m=new nd(this,this.clientOpts,this.buildSyncApiOptions()).createRoom(u);return t.syncRoom,m}knockRoom(e,t={}){const r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,ze.Knock))return Promise.resolve({room_id:r.roomId});const i=Ae("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),s={};t.viaServers&&(s.server_name=t.viaServers,s.via=t.viaServers);const o={};return t.reason&&(o.reason=t.reason),this.http.authedRequest(de.Post,i,s,o)}resendEvent(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,nt.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![nt.QUEUED,nt.NOT_SENT,nt.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===nt.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===nt.QUEUED&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,nt.CANCELLED)}setRoomName(e,t){return this.sendStateEvent(e,ie.RoomName,{name:t})}setRoomTopic(e,t,r){const i=Wj(t,r);return this.sendStateEvent(e,ie.RoomTopic,i)}getRoomTags(e){const t=Ae("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(de.Get,t)}setRoomTag(e,t,r={}){const i=Ae("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(de.Put,i,void 0,r)}deleteRoomTag(e,t){const r=Ae("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(de.Delete,r)}setRoomAccountData(e,t,r){const i=Ae("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(de.Put,i,void 0,r)}async setPowerLevel(e,t,r){var o,a,c;let i;if(this.clientRunning&&this.isInitialSyncComplete()&&(i=(c=(a=(o=this.getRoom(e))==null?void 0:o.currentState)==null?void 0:a.getStateEvents(ie.RoomPowerLevels,""))==null?void 0:c.getContent()),!i)try{i=await this.getStateEvent(e,ie.RoomPowerLevels,"")}catch(l){if(l instanceof gn&&l.errcode==="M_NOT_FOUND")i={};else throw l}i=rw(i),i!=null&&i.users||(i.users={});const s=Array.isArray(t)?t:[t];for(const l of s)r==null?delete i.users[l]:i.users[l]=r;return this.sendStateEvent(e,ie.RoomPowerLevels,i,"")}async unstable_createLiveBeacon(e,t){return this.unstable_setLiveBeacon(e,t)}async unstable_setLiveBeacon(e,t){return this.sendStateEvent(e,RP.name,t,this.getUserId())}sendEvent(e,t,r,i,s){let o,a,c,l;return!(t!=null&&t.startsWith(ta))&&t!==null?(l=i,c=r,a=t,o=null):(l=s,c=i,a=r,o=t),this.addThreadRelationIfNeeded(c,o,e),this.sendCompleteEvent(e,o,{type:a,content:c},l)}addThreadRelationIfNeeded(e,t,r){var i,s,o,a;if(t&&!((i=e["m.relates_to"])!=null&&i.rel_type)){const c=!!((s=e["m.relates_to"])!=null&&s["m.in_reply_to"]);e["m.relates_to"]={...e["m.relates_to"],rel_type:tn.name,event_id:t,is_falling_back:!c};const l=(o=this.getRoom(r))==null?void 0:o.getThread(t);l&&!c&&(e["m.relates_to"]["m.in_reply_to"]={event_id:((a=l.lastReply(u=>u.isRelation(tn.name)&&!u.status))==null?void 0:a.getId())??t})}}sendCompleteEvent(e,t,r,i,s){let o,a;typeof i=="string"?a=i:(o=i,a=s),a||(a=this.makeTxnId());const c=new Ji(Object.assign(r,{event_id:"~"+e+":"+a,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:new Date().getTime()})),l=this.getRoom(e),u=t?l==null?void 0:l.getThread(t):void 0;u&&c.setThread(u),o||(this.reEmitter.reEmit(c,[mn.Replaced,mn.VisibilityChange]),l==null||l.reEmitter.reEmit(c,[mn.BeforeRedaction]));const h=c.getAssociatedId();if(h!=null&&h.startsWith("~")){const m=l==null?void 0:l.getPendingEvents().find(v=>v.getId()===h);m==null||m.once(mn.LocalEventIdReplaced,()=>{c.updateAssociatedId(m.getId())})}const p=c.getType();return this.logger.debug(`sendEvent of type ${p} in ${e} with txnId ${a}${o?" (delayed event)":""}`),c.setTxnId(a),c.setStatus(nt.SENDING),o?this.encryptAndSendEvent(l,c,o):(l==null||l.addPendingEvent(c,a),c.status===nt.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(l,c))}async encryptAndSendEvent(e,t,r){if(r)return this.sendEventHttpRequest(t,r);try{let i;this.eventsBeingEncrypted.add(t.getId());try{await this.encryptEventIfNeeded(t,e??void 0)}finally{i=!this.eventsBeingEncrypted.delete(t.getId())}if(i)return{};t.status===nt.ENCRYPTING&&this.updatePendingEventStatus(e,t,nt.SENDING);let s=null;return this.scheduler&&(s=this.scheduler.queueEvent(t),s&&this.scheduler.getQueueForEvent(t).length>1&&this.updatePendingEventStatus(e,t,nt.QUEUED)),s||(s=this.sendEventHttpRequest(t),e&&(s=s.then(o=>(e.updatePendingEvent(t,nt.SENT,o.event_id),o)))),await s}catch(i){this.logger.error("Error sending event",i);try{t.error=i,this.updatePendingEventStatus(e,t,nt.NOT_SENT)}catch(s){this.logger.error("Exception in error handler!",s)}throw i instanceof gn&&(i.event=t),i}}async encryptEventIfNeeded(e,t){if(t&&await this.shouldEncryptEventForRoom(e,t)&&!(!this.cryptoBackend&&this.usingExternalCrypto)){if(!this.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");this.updatePendingEventStatus(t,e,nt.ENCRYPTING),await this.cryptoBackend.encryptEvent(e,t)}}async shouldEncryptEventForRoom(e,t){var r;return e.isEncrypted()||e.getType()===ie.Reaction||e.isRedaction()?!1:!!(t.hasEncryptionStateEvent()||await((r=this.cryptoBackend)==null?void 0:r.isEncryptionEnabledInRoom(t.roomId)))}getEncryptedIfNeededEventType(e,t){var r;return t===ie.Reaction?t:(r=this.getRoom(e))!=null&&r.hasEncryptionStateEvent()?ie.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,r){e?e.updatePendingEvent(t,r):t.setStatus(r)}sendEventHttpRequest(e,t){let r=e.getTxnId();r||(r=this.makeTxnId(),e.setTxnId(r));const i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:r};let s;if(e.isState()){let a="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(a="/rooms/$roomId/state/$eventType/$stateKey"),s=Ae(a,i)}else e.isRedaction()&&e.event.redacts?s=Ae("/rooms/$roomId/redact/$redactsEventId/$txnId",{$redactsEventId:e.event.redacts,...i}):s=Ae("/rooms/$roomId/send/$eventType/$txnId",i);const o=e.getWireContent();return t?this.http.authedRequest(de.Put,s,L5(t),o):this.http.authedRequest(de.Put,s,void 0,o).then(a=>(this.logger.debug(`Event sent to ${e.getRoomId()} with event id ${a.event_id}`),a))}redactEvent(e,t,r,i,s){r!=null&&r.startsWith(ta)||(s=i,i=r,r=t,t=null);const a={reason:s==null?void 0:s.reason};if((s==null?void 0:s.with_rel_types)!==void 0){if(this.canSupport.get(vs.RelationBasedRedactions)===Vr.Unsupported)throw new Error(`Server does not support relation based redactions roomId ${e} eventId ${r} txnId: ${i} threadId ${t}`);const c=this.canSupport.get(vs.RelationBasedRedactions)===Vr.Stable?NR.stable:NR.unstable;a[c]=s.with_rel_types}return this.sendCompleteEvent(e,t,{type:ie.RoomRedaction,content:a,redacts:r},i)}sendMessage(e,t,r,i){typeof t!="string"&&t!==null&&(i=r,r=t,t=null);const s=ie.RoomMessage,o=r;return this.sendEvent(e,t,s,o,i)}sendTextMessage(e,t,r,i){!(t!=null&&t.startsWith(ta))&&t!==null&&(i=r,r=t,t=null);const s=Hj(r);return this.sendMessage(e,t,s,i)}sendNotice(e,t,r,i){!(t!=null&&t.startsWith(ta))&&t!==null&&(i=r,r=t,t=null);const s=Vj(r);return this.sendMessage(e,t,s,i)}sendEmoteMessage(e,t,r,i){!(t!=null&&t.startsWith(ta))&&t!==null&&(i=r,r=t,t=null);const s=Gj(r);return this.sendMessage(e,t,s,i)}sendImageMessage(e,t,r,i,s="Image"){!(t!=null&&t.startsWith(ta))&&t!==null&&(s=i||"Image",i=r,r=t,t=null);const o={msgtype:zo.Image,url:r,info:i,body:s};return this.sendMessage(e,t,o)}sendStickerMessage(e,t,r,i,s="Sticker"){!(t!=null&&t.startsWith(ta))&&t!==null&&(s=i||"Sticker",i=r,r=t,t=null);const o={url:r,info:i,body:s};return this.sendEvent(e,t,ie.Sticker,o)}sendHtmlMessage(e,t,r,i){!(t!=null&&t.startsWith(ta))&&t!==null&&(i=r,r=t,t=null);const s=jj(r,i);return this.sendMessage(e,t,s)}sendHtmlNotice(e,t,r,i){!(t!=null&&t.startsWith(ta))&&t!==null&&(i=r,r=t,t=null);const s=$j(r,i);return this.sendMessage(e,t,s)}sendHtmlEmote(e,t,r,i){!(t!=null&&t.startsWith(ta))&&t!==null&&(i=r,r=t,t=null);const s=Bj(r,i);return this.sendMessage(e,t,s)}async _unstable_sendDelayedEvent(e,t,r,i,s,o){if(!await this.doesServerSupportUnstableFeature(ga))throw new Ml("Server does not support the delayed events API","sendDelayedEvent");return this.addThreadRelationIfNeeded(s,r,e),this.sendCompleteEvent(e,r,{type:i,content:s},t,o)}async _unstable_sendDelayedStateEvent(e,t,r,i,s="",o={}){if(!await this.doesServerSupportUnstableFeature(ga))throw new Ml("Server does not support the delayed events API","sendDelayedStateEvent");const a={$roomId:e,$eventType:r,$stateKey:s};let c=Ae("/rooms/$roomId/state/$eventType",a);return s!==void 0&&(c=Ae(c+"/$stateKey",a)),this.http.authedRequest(de.Put,c,L5(t),i,o)}async _unstable_getDelayedEvents(e){if(!await this.doesServerSupportUnstableFeature(ga))throw new Ml("Server does not support the delayed events API","getDelayedEvents");const t=e?{from:e}:void 0;return await this.http.authedRequest(de.Get,"/delayed_events",t,void 0,{prefix:`${ur.Unstable}/${ga}`})}async _unstable_updateDelayedEvent(e,t,r={}){if(!await this.doesServerSupportUnstableFeature(ga))throw new Ml("Server does not support the delayed events API","updateDelayedEvent");const i=Ae("/delayed_events/$delayId",{$delayId:e}),s={action:t};return await this.http.authedRequest(de.Post,i,void 0,s,{...r,prefix:`${ur.Unstable}/${ga}`})}async sendReceipt(e,t,r,i=!1){if(this.isGuest())return Promise.resolve({});const s=Ae("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),a=!i&&this.supportsThreads()?{...r,thread_id:qf(e)}:r,c=this.http.authedRequest(de.Post,s,void 0,a||{}),l=this.getRoom(e.getRoomId());return l&&this.credentials.userId&&l.addLocalEchoReceipt(this.credentials.userId,e,t,i),c}async sendReadReceipt(e,t=li.Read,r=!1){if(!e)return;const i=e.getId(),s=this.getRoom(e.getRoomId());if(s!=null&&s.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);return this.sendReceipt(e,t,{},r)}async setRoomReadMarkers(e,t,r,i){const s=this.getRoom(e);if(s!=null&&s.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let o;if(r){if(o=r.getId(),s!=null&&s.hasPendingEvent(o))throw new Error(`Cannot set read receipt to a pending event (${o})`);s==null||s.addLocalEchoReceipt(this.credentials.userId,r,li.Read)}let a;if(i){if(a=i.getId(),s!=null&&s.hasPendingEvent(a))throw new Error(`Cannot set read receipt to a pending event (${a})`);s==null||s.addLocalEchoReceipt(this.credentials.userId,i,li.ReadPrivate)}return await this.setRoomReadMarkersHttpRequest(e,t,o,a)}getUrlPreview(e,t){t=Math.floor(t/6e4)*6e4;const r=new URL(e);r.hash="",e=r.toString();const i=t+"_"+e;if(i in this.urlPreviewCache)return this.urlPreviewCache[i];const s=this.http.authedRequest(de.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:ld.V3,priority:"low"});return this.urlPreviewCache[i]=s,s}sendTyping(e,t,r){if(this.isGuest())return Promise.resolve({});const i=Ae("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),s={typing:t};return t&&(s.timeout=r||2e4),this.http.authedRequest(de.Put,i,void 0,s)}getRoomUpgradeHistory(e,t=!1,r=!1){const i=this.getRoom(e);if(!i)return[];const s=this.findPredecessorRooms(i,t,r),o=this.findSuccessorRooms(i,t,r);return[...s,i,...o]}findPredecessorRooms(e,t,r){var a,c;const i=[],s=new Set([e.roomId]);let o=(a=e.findPredecessor(r))==null?void 0:a.roomId;for(;o!==null;){if(o){if(s.has(o))break;s.add(o)}const l=this.getRoom(o);if(l===null)break;if(t){const u=l.currentState.getStateEvents(ie.RoomTombstone,"");if(!u||u.getContent().replacement_room!==e.roomId)break}i.splice(0,0,l),e=l,o=(c=e.findPredecessor(r))==null?void 0:c.roomId}return i}findSuccessorRooms(e,t,r){var o;const i=[];let s=e.currentState.getStateEvents(ie.RoomTombstone,"");for(;s;){const a=this.getRoom(s.getContent().replacement_room);if(!a||a.roomId===e.roomId)break;if(t){const l=(o=a.findPredecessor(r))==null?void 0:o.roomId;if(!l||l!==e.roomId)break}if(i.push(a),new Set(i.map(l=>l.roomId)).size<i.length)return i.slice(0,i.length-1);e=a,s=e.currentState.getStateEvents(ie.RoomTombstone,"")}return i}invite(e,t,r){return this.membershipChange(e,t,ze.Invite,r)}inviteByEmail(e,t){return this.inviteByThreePid(e,"email",t)}async inviteByThreePid(e,t,r){var a;const i=Ae("/rooms/$roomId/invite",{$roomId:e}),s=this.getIdentityServerUrl(!0);if(!s)return Promise.reject(new gn({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const o={id_server:s,medium:t,address:r};if((a=this.identityServer)!=null&&a.getAccessToken){const c=await this.identityServer.getAccessToken();c&&(o.id_access_token=c)}return this.http.authedRequest(de.Post,i,void 0,o)}leave(e){return this.membershipChange(e,void 0,ze.Leave)}leaveRoomChain(e,t=!0){const r=this.getRoomUpgradeHistory(e);let i=r;if(!t){i=[];for(const c of r)if(i.push(c),c.roomId===e)break}const s={},o=[],a=c=>this.leave(c).then(()=>{delete s[c]}).catch(l=>{s[c]=l});for(const c of i)o.push(a(c.roomId));return Promise.all(o).then(()=>s)}ban(e,t,r){return this.membershipChange(e,t,ze.Ban,r)}async forget(e,t=!0){const r=Ae("/rooms/$room_id/forget",{$room_id:e}),i=await this.http.authedRequest(de.Post,r);return t&&(this.store.removeRoom(e),this.emit("deleteRoom",e)),i}unban(e,t){const r=Ae("/rooms/$roomId/unban",{$roomId:e}),i={user_id:t};return this.http.authedRequest(de.Post,r,void 0,i)}kick(e,t,r){const i=Ae("/rooms/$roomId/kick",{$roomId:e}),s={user_id:t,reason:r};return this.http.authedRequest(de.Post,i,void 0,s)}membershipChange(e,t,r,i){const s=Ae("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(de.Post,s,void 0,{user_id:t,reason:i})}getPushActionsForEvent(e,t=!1){if(!e.getPushActions()||t){const{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushActions()}getPushDetailsForEvent(e,t=!1){if(!e.getPushDetails()||t){const{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushDetails()}setProfileInfo(e,t){const r=Ae("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(de.Put,r,void 0,t)}async setDisplayName(e){const t=await this.setProfileInfo("displayname",{displayname:e}),r=this.getUser(this.getUserId());return r&&(r.displayName=e,r.emit(Ll.DisplayName,r.events.presence,r)),t}async setAvatarUrl(e){const t=await this.setProfileInfo("avatar_url",{avatar_url:e}),r=this.getUser(this.getUserId());return r&&(r.avatarUrl=e,r.emit(Ll.AvatarUrl,r.events.presence,r)),t}mxcUrlToHttp(e,t,r,i,s,o,a){return sw(this.baseUrl,e,t,r,i,s,o,a)}async setSyncPresence(e){var t;(t=this.syncApi)==null||t.setPresence(e)}async setPresence(e){const t=Ae("/presence/$userId/status",{$userId:this.credentials.userId});if(["offline","online","unavailable"].indexOf(e.presence)===-1)throw new Error("Bad presence value: "+e.presence);await this.http.authedRequest(de.Put,t,void 0,e)}getPresence(e){const t=Ae("/presence/$userId/status",{$userId:e});return this.http.authedRequest(de.Get,t)}scrollback(e,t=30){let r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){const a=Date.now()-i.errorTs;r=Math.max(Doe-a,0)}if(e.oldState.paginationToken===null)return Promise.resolve(e);const s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t=t-s;const o=new Promise((a,c)=>{Td(r).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,St.Backward)).then(l=>{const u=l.chunk.map(this.getEventMapper());if(l.state){const v=l.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(v)}const[h,p,m]=e.partitionThreadedEvents(u);this.processAggregatedTimelineEvents(e,h),e.addEventsToTimeline(h,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,p,!0),m.forEach(v=>e.relations.aggregateChildEvent(v)),e.oldState.paginationToken=l.end??null,l.chunk.length===0&&(e.oldState.paginationToken=null),this.store.storeEvents(e,u,l.end??null,!0),delete this.ongoingScrollbacks[e.roomId],a(e)}).catch(l=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},c(l)})});return i={promise:o},this.ongoingScrollbacks[e.roomId]=i,o}getEventMapper(e){return Yse(this,e||{})}async getEventTimeline(e,t){var m,v;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!(e!=null&&e.room))throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);if(e.thread&&this.supportsThreads())return this.getThreadTimeline(e,t);const r=Ae("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let i;(m=this.clientOpts)!=null&&m.lazyLoadMembers&&(i={filter:JSON.stringify(ys.LAZY_LOADING_MESSAGES_FILTER)});const s=await this.http.authedRequest(de.Get,r,i);if(!s.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);const o=this.getEventMapper(),a=o(s.event);if(a.isRelation(tn.name)){this.logger.warn("Tried loading a regular timeline at the position of a thread event");return}const c=[...s.events_after.reverse().map(o),a,...s.events_before.map(o)];let l=e.getTimelineForEvent(c[0].getId());l?l.getState($e.BACKWARDS).setUnknownStateEvents(s.state.map(o)):(l=e.addTimeline(),l.initialiseState(s.state.map(o)),l.getState($e.FORWARDS).paginationToken=s.end);const[u,h,p]=e.room.partitionThreadedEvents(c);return e.addEventsToTimeline(u,!0,!1,l,s.start),this.processThreadEvents(e.room,h,!0),this.processAggregatedTimelineEvents(e.room,u),p.forEach(g=>e.relations.aggregateChildEvent(g)),e.getTimelineForEvent(t)??((v=e.room.findThreadForEvent(a))==null?void 0:v.liveTimeline)??l}async getThreadTimeline(e,t){var l,u,h;if(!this.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");const r=Ae("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),i={limit:"0"};(l=this.clientOpts)!=null&&l.lazyLoadMembers&&(i.filter=JSON.stringify(ys.LAZY_LOADING_MESSAGES_FILTER));const s=await this.http.authedRequest(de.Get,r,i),o=this.getEventMapper(),a=o(s.event);if(!e.canContain(a))return;const c=this.canSupport.get(vs.RelationsRecursion)!==Vr.Unsupported;if(Gr.hasServerSideSupport)if(Gr.hasServerSideFwdPaginationSupport){if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");const p=e.thread,m=await this.fetchRelations(e.room.roomId,p.id,null,null,{dir:St.Backward,from:s.start,recurse:c||void 0}),v=await this.fetchRelations(e.room.roomId,p.id,null,null,{dir:St.Forward,from:s.end,recurse:c||void 0}),g=[...v.chunk.reverse().filter($T(p.id)).map(o),a,...m.chunk.filter($T(p.id)).map(o)];for(const b of g)await((u=e.thread)==null?void 0:u.processEvent(b));let S=e.getTimelineForEvent(a.getId());if(S?S.getState($e.BACKWARDS).setUnknownStateEvents(s.state.map(o)):(S=e.addTimeline(),S.initialiseState(s.state.map(o))),e.addEventsToTimeline(g,!0,!1,S,v.next_batch),!m.next_batch){const b=await this.fetchRoomEvent(e.room.roomId,p.id);e.addEventsToTimeline([o(b)],!0,!1,S,null)}return S.setPaginationToken(m.next_batch??null,St.Backward),S.setPaginationToken(v.next_batch??null,St.Forward),this.processAggregatedTimelineEvents(e.room,g),e.getTimelineForEvent(t)??S}else{const p=e.thread,m=await this.fetchRelations(e.room.roomId,p.id,tn.name,null,{dir:St.Backward,from:s.start,recurse:c||void 0}),v=[];let g=s.end;for(;g;){const R=await this.fetchRelations(e.room.roomId,p.id,tn.name,null,{dir:St.Forward,from:g,recurse:c||void 0});g=R.next_batch??null,v.push(...R.chunk)}const S=[...v.reverse().map(o),a,...m.chunk.map(o)];for(const R of S)await((h=e.thread)==null?void 0:h.processEvent(R));const b=e.getLiveTimeline();if(b.getState($e.BACKWARDS).setUnknownStateEvents(s.state.map(o)),e.addEventsToTimeline(S,!0,!1,b,null),!m.next_batch){const R=await this.fetchRoomEvent(e.room.roomId,p.id);e.addEventsToTimeline([o(R)],!0,!1,b,null)}return b.setPaginationToken(m.next_batch??null,St.Backward),b.setPaginationToken(null,St.Forward),this.processAggregatedTimelineEvents(e.room,S),b}}async getLatestTimeline(e){var r,i,s,o;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");let t;if(e.threadListType!==null)t=(r=(await this.createThreadListMessagesRequest(e.room.roomId,null,1,St.Backward,e.threadListType,e.getFilter())).chunk)==null?void 0:r[0];else if(e.thread&&Gr.hasServerSideSupport){const a=this.canSupport.get(vs.RelationsRecursion)!==Vr.Unsupported;t=(i=(await this.fetchRelations(e.room.roomId,e.thread.id,tn.name,null,{dir:St.Backward,limit:1,recurse:a||void 0})).chunk)==null?void 0:i[0]}else{const a=Ae("/rooms/$roomId/messages",{$roomId:e.room.roomId}),c={dir:"b"};(s=this.clientOpts)!=null&&s.lazyLoadMembers&&(c.filter=JSON.stringify(ys.LAZY_LOADING_MESSAGES_FILTER)),t=(o=(await this.http.authedRequest(de.Get,a,c)).chunk)==null?void 0:o[0]}if(!t)throw new Error("No message returned when trying to construct getLatestTimeline");return this.getEventTimeline(e,t.event_id)}createMessagesRequest(e,t,r=30,i,s){var l,u;const o=Ae("/rooms/$roomId/messages",{$roomId:e}),a={limit:r.toString(),dir:i};t&&(a.from=t);let c=null;return(l=this.clientOpts)!=null&&l.lazyLoadMembers&&(c=Object.assign({},ys.LAZY_LOADING_MESSAGES_FILTER)),s&&(c=c||{},Object.assign(c,(u=s.getRoomTimelineFilterComponent())==null?void 0:u.toJSON())),c&&(a.filter=JSON.stringify(c)),this.http.authedRequest(de.Get,o,a)}createThreadListMessagesRequest(e,t,r=30,i=St.Backward,s=To.All,o){var h,p;const a=Ae("/rooms/$roomId/threads",{$roomId:e}),c={limit:r.toString(),dir:i,include:eB(s)};t&&(c.from=t);let l={};(h=this.clientOpts)!=null&&h.lazyLoadMembers&&(l={...ys.LAZY_LOADING_MESSAGES_FILTER}),o&&(l={...l,...(p=o.getRoomTimelineFilterComponent())==null?void 0:p.toJSON()}),Object.keys(l).length&&(c.filter=JSON.stringify(l));const u={prefix:Gr.hasServerSideListSupport===ha.Stable?ur.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(de.Get,a,c,void 0,u).then(m=>{var v;return{...m,chunk:(v=m.chunk)==null?void 0:v.reverse(),start:m.prev_batch,end:m.next_batch}})}paginateEventTimeline(e,t){const r=e.getTimelineSet()===this.notifTimelineSet,i=this.getRoom(e.getRoomId()),s=e.getTimelineSet().threadListType,o=e.getTimelineSet().thread;t=t||{};const a=t.backwards||!1;if(r&&!a)throw new Error("paginateNotifTimeline can only paginate backwards");const c=a?$e.BACKWARDS:$e.FORWARDS,l=e.getPaginationToken(c),u=e.paginationRequests[c];if(u)return u;let h,p,m;if(r)h="/notifications",p={limit:(t.limit??30).toString(),only:"highlight"},l&&l!=="end"&&(p.from=l),m=this.http.authedRequest(de.Get,h,p).then(async v=>{const g=v.next_token,S=[];v.notifications=v.notifications.filter(Po);for(let R=0;R<v.notifications.length;R++){const k=v.notifications[R],I=this.getEventMapper()(k.event);this.getPushDetailsForEvent(I,!0),I.event.room_id=k.room_id,S[R]=I}const b=e.getTimelineSet();return b.addEventsToTimeline(S,a,!1,e,g),this.processAggregatedTimelineEvents(b.room,S),a&&!v.next_token&&e.setPaginationToken(null,c),!!v.next_token}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=m;else if(s!==null){if(!i)throw new Error("Unknown room "+e.getRoomId());if(!Gr.hasServerSideFwdPaginationSupport&&c===St.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");m=this.createThreadListMessagesRequest(e.getRoomId(),l,t.limit,c,s,e.getFilter()).then(v=>{if(v.state){const R=e.getState(c),k=v.state.filter(Po).map(this.getEventMapper());R.setUnknownStateEvents(k)}const g=v.end,S=v.chunk.filter(Po).map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(S,a,!1,e,g),this.processAggregatedTimelineEvents(i,S),this.processThreadRoots(i,S,a),a&&v.end==v.start&&e.setPaginationToken(null,c),v.end!==v.start}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=m}else if(o){const v=this.getRoom(e.getRoomId()??void 0);if(!v)throw new Error("Unknown room "+e.getRoomId());const g=this.canSupport.get(vs.RelationsRecursion)!==Vr.Unsupported;m=this.fetchRelations(e.getRoomId()??"",o.id,null,null,{dir:c,limit:t.limit,from:l??void 0,recurse:g||void 0}).then(async S=>{const b=this.getEventMapper(),R=S.chunk.filter(Po).filter($T(o.id)).map(b);for(const T of R.slice().reverse()){await(o==null?void 0:o.processEvent(T));const C=T.getSender();(!a||(o==null?void 0:o.getEventReadUpTo(C))===null)&&v.addLocalEchoReceipt(C,T,li.Read)}const k=S.next_batch,I=e.getTimelineSet();if(I.addEventsToTimeline(R,a,!1,e,k??null),!k&&a){const T=o.rootEvent??b(await this.fetchRoomEvent(e.getRoomId()??"",o.id));I.addEventsToTimeline([T],!0,!1,e,null)}return this.processAggregatedTimelineEvents(I.room,R),a&&!k&&e.setPaginationToken(null,c),!!k}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=m}else{if(!i)throw new Error("Unknown room "+e.getRoomId());m=this.createMessagesRequest(e.getRoomId(),l,t.limit,c,e.getFilter()).then(v=>{if(v.state){const T=e.getState(c),C=v.state.filter(Po).map(this.getEventMapper());T.setUnknownStateEvents(C)}const g=v.end,S=v.chunk.filter(Po).map(this.getEventMapper()),b=e.getTimelineSet(),[R,,k]=i.partitionThreadedEvents(S);b.addEventsToTimeline(R,a,!1,e,g),this.processAggregatedTimelineEvents(i,R),this.processThreadRoots(i,R.filter(T=>T.getServerAggregatedRelation(tn.name)),!1),k.forEach(T=>i.relations.aggregateChildEvent(T));const I=v.end===void 0||v.end===v.start;return a&&I&&e.setPaginationToken(null,c),!I}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=m}return m}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e,t=20){var r;return(r=this.peekSync)==null||r.stopPeeking(),this.peekSync=new nd(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,t)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){const r=this.sendStateEvent(e,ie.RoomGuestAccess,{guest_access:t.allowJoin?uv.CanJoin:uv.Forbidden},"");let i=Promise.resolve();return t.allowRead&&(i=this.sendStateEvent(e,ie.RoomHistoryVisibility,{history_visibility:gw.WorldReadable},"")),Promise.all([i,r]).then()}requestRegisterEmailToken(e,t,r,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:i})}requestRegisterMsisdnToken(e,t,r,i,s){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:i,next_link:s})}requestAdd3pidEmailToken(e,t,r,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:i})}requestAdd3pidMsisdnToken(e,t,r,i,s){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:i,next_link:s})}requestPasswordEmailToken(e,t,r,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:r,next_link:i})}requestPasswordMsisdnToken(e,t,r,i,s){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:r,send_attempt:i,next_link:s})}async requestTokenFromEndpoint(e,t){const r=Object.assign({},t);return this.http.request(de.Post,e,void 0,r)}getRoomPushRule(e,t){var r,i;if(this.pushRules)return(i=(r=this.pushRules[e])==null?void 0:r.room)==null?void 0:i.find(s=>s.rule_id===t);throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,t,r){let i,s=!1;const o=this.getRoomPushRule(e,t);if(o!=null&&o.actions.includes(bc.DontNotify)&&(s=!0),!r)s&&(i=this.deletePushRule(e,mr.RoomSpecific,o.rule_id));else if(!o)i=this.addPushRule(e,mr.RoomSpecific,t,{actions:[bc.DontNotify]});else if(!s){const a=Xl();this.deletePushRule(e,mr.RoomSpecific,o.rule_id).then(()=>{this.addPushRule(e,mr.RoomSpecific,t,{actions:[bc.DontNotify]}).then(()=>{a.resolve()}).catch(c=>{a.reject(c)})}).catch(c=>{a.reject(c)}),i=a.promise}if(i)return new Promise((a,c)=>{i.then(()=>{this.getPushRules().then(l=>{this.pushRules=l,a()}).catch(l=>{c(l)})}).catch(l=>{this.getPushRules().then(u=>{this.pushRules=u,c(l)}).catch(u=>{c(l)})})})}searchMessageText(e){const t={search_term:e.query};return"keys"in e&&(t.keys=e.keys),this.search({body:{search_categories:{room_events:t}}})}searchRoomEvents(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:IP.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:t,results:[],highlights:[]};return this.search({body:t}).then(i=>this.processRoomEventsSearch(r,i))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},r=this.search(t,e.abortSignal).then(i=>this.processRoomEventsSearch(e,i)).finally(()=>{e.pendingRequest=void 0});return e.pendingRequest=r,r}processRoomEventsSearch(e,t){var a;const r=t.search_categories.room_events;e.count=r.count,e.next_batch=r.next_batch;const i=new Set(r.highlights);e.highlights.forEach(c=>{i.add(c)}),e.highlights=Array.from(i);const s=this.getEventMapper(),o=((a=r.results)==null?void 0:a.length)??0;for(let c=0;c<o;c++){const l=mw.fromJson(r.results[c],s),u=this.getRoom(l.context.getEvent().getRoomId());if(u)for(const h of l.context.getTimeline())h.setMetadata(u.currentState,!1);e.results.push(l)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new nd(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(e){const t=Ae("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(de.Post,t,void 0,e).then(r=>{const i=ys.fromJson(this.credentials.userId,r.filter_id,e);return this.store.storeFilter(i),i})}getFilter(e,t,r){if(r){const s=this.store.getFilter(e,t);if(s)return Promise.resolve(s)}const i=Ae("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(de.Get,i).then(s=>{const o=ys.fromJson(e,t,s);return this.store.storeFilter(o),o})}async getOrCreateFilter(e,t){const r=this.store.getFilterIdByName(e);let i;if(r){try{const o=await this.getFilter(this.credentials.userId,r,!0);if(o){const a=o.getDefinition(),c=t.getDefinition();Cd(a,c)&&(i=r)}}catch(o){if(o.errcode!=="M_UNKNOWN"&&o.errcode!=="M_NOT_FOUND")throw o}i||this.store.setFilterIdByName(e,void 0)}if(i)return i;const s=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,s.filterId),s.filterId}getOpenIdToken(){const e=Ae("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(de.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(de.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return this.checkTurnServersIntervalID!==void 0}async checkTurnServers(){if(!this.canSupportVoip)return;let e=!1;const t=this.turnServersExpiry-Date.now();if(t>P5)this.logger.debug("TURN creds are valid for another "+t+" ms: not fetching new ones."),e=!0;else{this.logger.debug("Fetching new TURN credentials");try{const r=await this.turnServer();if(r.uris){this.logger.debug("Got TURN URIs: "+r.uris+" refresh in "+r.ttl+" secs");const i={urls:r.uris,username:r.username,credential:r.password};this.turnServers=[i],this.turnServersExpiry=Date.now()+r.ttl*1e3,e=!0,this.emit("turnServers",this.turnServers)}}catch(r){this.logger.error("Failed to get TURN URIs",r),r.httpStatus===403?(this.logger.info("TURN access unavailable for this account: stopping credentials checks"),this.checkTurnServersIntervalID!==null&&globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.emit("turnServers.error",r,!0)):this.emit("turnServers.error",r,!1)}}return e}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=Ae("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(de.Get,e,void 0,void 0,{prefix:""}).then(t=>t.admin)}whoisSynapseUser(e){const t=Ae("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(de.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const t=Ae("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(de.Post,t,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){this.clientWellKnownPromise=lv.getRawClientConfig(this.getDomain()??void 0),this.clientWellKnown=await this.clientWellKnownPromise,this.emit("WellKnown.client",this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter(([r,i])=>e.includes(typeof i)).reduce((r,[i,s])=>(r[i]=s,r),{});return this.store.storeClientOptions(t)}async _unstable_getSharedRooms(e){const t=await this.doesServerSupportUnstableFeature(Y$),r=await this.doesServerSupportUnstableFeature(X$),i=await this.doesServerSupportUnstableFeature(J$);if(!t&&!r&&!i)throw Error("Server does not support the Mutual Rooms API");let s,o;i?(s="/uk.half-shot.msc2666/user/mutual_rooms",o={user_id:e}):(s=Ae(`/uk.half-shot.msc2666/user/${r?"mutual_rooms":"shared_rooms"}/$userId`,{$userId:e}),o={});const a=[];let c=null;do{const l={};c!=null&&i&&(l.batch_token=c);const u=await this.http.authedRequest(de.Get,s,{...o,...l},void 0,{prefix:ur.Unstable});a.push(...u.joined),u.next_batch_token!==void 0?c=u.next_batch_token:c=null}while(c!=null);return a}async getVersions(){if(this.serverVersionsPromise)return this.serverVersionsPromise;this.serverVersionsPromise=this.http.authedRequest(de.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(t=>{throw this.serverVersionsPromise=void 0,t});const e=await this.serverVersionsPromise;return this.canSupport=await ese(e),this.serverVersionsPromise}async isVersionSupported(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)}async doesServerSupportUnstableFeature(e){const t=await this.getVersions();if(!t)return!1;const r=t.unstable_features;return r&&!!r[e]}async doesServerForceEncryptionForPreset(e){const t=await this.getVersions();if(!t)return!1;const r=t.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return r&&!!r[`io.element.e2ee_forced.${i}`]}async doesServerSupportThread(){if(await this.isVersionSupported("v1.4"))return{threads:ha.Stable,list:ha.Stable,fwdPagination:ha.Stable};try{const[e,t,r,i,s,o]=await Promise.all([this.doesServerSupportUnstableFeature("org.matrix.msc3440"),this.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3856"),this.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3715"),this.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:S_(t,e),list:S_(i,r),fwdPagination:S_(o,s)}}catch{return{threads:ha.None,list:ha.None,fwdPagination:ha.None}}}hasLazyLoadMembersEnabled(){var e;return!!((e=this.clientOpts)!=null&&e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,t,r,i,s={dir:St.Backward}){const o=i?this.getEncryptedIfNeededEventType(e,i):null,[a,c]=await Promise.all([this.fetchRoomEvent(e,t),this.fetchRelations(e,t,r,o,s)]),l=this.getEventMapper(),u=a?l(a):void 0;let h=c.chunk.map(l);if(o===ie.RoomMessageEncrypted){const p=u?h.concat(u):h;await Promise.all(p.map(m=>this.decryptEventIfNeeded(m))),i!==null&&(h=h.filter(m=>m.getType()===i))}return u&&r===on.Replace&&(h=h.filter(p=>p.getSender()===u.getSender())),{originalEvent:u??null,events:h,nextBatch:c.next_batch??null,prevBatch:c.prev_batch??null}}generateClientSecret(){return Es(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&this.getCrypto()&&e.attemptDecryption(this.cryptoBackend,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case Ob.IS:return this.http.getUrl("/terms",void 0,da.V2,t);case Ob.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",t);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(e=!1){var t,r;return e&&((t=this.idBaseUrl)!=null&&t.startsWith("http://")||(r=this.idBaseUrl)!=null&&r.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=IT(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){return this.http.opts.refreshToken??null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return this.http.opts.accessToken!==void 0}makeTxnId(){return"m"+new Date().getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(de.Get,"/register/available",{username:e}).then(t=>t.available).catch(t=>t.errcode==="M_USER_IN_USE"?!1:Promise.reject(t))}register(e,t,r,i,s,o,a){r&&(i.session=r);const c={auth:i,refresh_token:!0};return e!=null&&(c.username=e),t!=null&&(c.password=t),o!=null&&(c.guest_access_token=o),a!=null&&(c.inhibit_login=a),this.registerRequest(c)}registerGuest({body:e}={}){return this.registerRequest(e||{},"guest")}registerRequest(e,t){const r={};return t&&(r.kind=t),this.http.request(de.Post,"/register",r,e)}refreshToken(e){const t=r=>this.http.authedRequest(de.Post,"/refresh",void 0,{refresh_token:e},{prefix:r,inhibitLogoutEmit:!0});return t(ur.V3).catch(r=>{if(r.errcode==="M_UNRECOGNIZED")return t(ur.V1);throw r})}loginFlows(){return this.http.request(de.Get,"/login")}login(e,t){return this.loginRequest({...t,type:e}).then(r=>(r.access_token&&r.user_id&&(this.http.opts.accessToken=r.access_token,this.credentials={userId:r.user_id}),r))}loginWithPassword(e,t){return this.login("m.login.password",{user:e,password:t})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e,t="sso",r,i){let s="/login/"+t+"/redirect";r&&(s+="/"+r);const o={redirectUrl:e,[joe.unstable]:i};return this.http.getUrl(s,o).href}loginWithToken(e){return this.login("m.login.token",{token:e})}async loginRequest(e){return await this.http.authedRequest(de.Post,"/login",void 0,e)}async logout(e=!1){return e&&(this.stopClient(),this.http.abort()),this.http.authedRequest(de.Post,"/logout")}deactivateAccount(e,t){const r={};return e&&(r.auth=e),t!==void 0&&(r.erase=t),this.http.authedRequest(de.Post,"/account/deactivate",void 0,r)}async requestLoginToken(e){const t={auth:e};return this.http.authedRequest(de.Post,"/login/get_token",void 0,t,{prefix:ur.V1})}getFallbackAuthUrl(e,t){const r=Ae("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:t}).href}async createRoom(e){var r;const t=(e.invite_3pid||[]).filter(i=>!i.id_access_token);if(t.length>0&&((r=this.identityServer)!=null&&r.getAccessToken)){const i=await this.identityServer.getAccessToken();if(i)for(const s of t)s.id_access_token=i}return this.http.authedRequest(de.Post,"/createRoom",void 0,e)}fetchRelations(e,t,r,i,s={dir:St.Backward}){let o=s;Gr.hasServerSideFwdPaginationSupport===ha.Experimental&&(o=kO("dir","org.matrix.msc3715.dir",o)),this.canSupport.get(vs.RelationsRecursion)===Vr.Unstable&&(o=kO("recurse","org.matrix.msc3981.recurse",o));const a=kR(o);let c="/rooms/$roomId/relations/$eventId";r!==null?(c+="/$relationType",i!==null&&(c+="/$eventType")):i!==null&&(this.logger.warn(`eventType: ${i} ignored when fetching
            relations as relationType is null`),i=null);const l=Ae(c+"?"+a,{$roomId:e,$eventId:t,$relationType:r,$eventType:i});return this.http.authedRequest(de.Get,l,void 0,void 0,{prefix:ur.V1})}roomState(e){const t=Ae("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(de.Get,t)}fetchRoomEvent(e,t){const r=Ae("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(de.Get,r)}members(e,t,r,i){const s={};t&&(s.membership=t),r&&(s.not_membership=r),i&&(s.at=i);const o=kR(s),a=Ae("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(de.Get,a)}upgradeRoom(e,t){const r=Ae("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(de.Post,r,void 0,{new_version:t})}getStateEvent(e,t,r){const i={$roomId:e,$eventType:t,$stateKey:r};let s=Ae("/rooms/$roomId/state/$eventType",i);return r!==void 0&&(s=Ae(s+"/$stateKey",i)),this.http.authedRequest(de.Get,s)}sendStateEvent(e,t,r,i="",s={}){const o={$roomId:e,$eventType:t,$stateKey:i};let a=Ae("/rooms/$roomId/state/$eventType",o);return i!==void 0&&(a=Ae(a+"/$stateKey",o)),this.http.authedRequest(de.Put,a,void 0,r,s)}roomInitialSync(e,t){const r=Ae("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(de.Get,r,{limit:(t==null?void 0:t.toString())??"30"})}async setRoomReadMarkersHttpRequest(e,t,r,i){const s=Ae("/rooms/$roomId/read_markers",{$roomId:e}),o={[li.FullyRead]:t,[li.Read]:r};return(await this.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")||await this.isVersionSupported("v1.4"))&&(o[li.ReadPrivate]=i),this.http.authedRequest(de.Post,s,void 0,o)}getJoinedRooms(){const e=Ae("/joined_rooms",{});return this.http.authedRequest(de.Get,e)}getJoinedRoomMembers(e){const t=Ae("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(de.Get,t)}publicRooms({server:e,limit:t,since:r,...i}={}){if(Object.keys(i).length===0){const s={server:e,limit:t,since:r};return this.http.authedRequest(de.Get,"/publicRooms",s)}else{const s={server:e},o={limit:t,since:r,...i};return this.http.authedRequest(de.Post,"/publicRooms",s,o)}}createAlias(e,t){const r=Ae("/directory/room/$alias",{$alias:e}),i={room_id:t};return this.http.authedRequest(de.Put,r,void 0,i)}deleteAlias(e){const t=Ae("/directory/room/$alias",{$alias:e});return this.http.authedRequest(de.Delete,t)}getLocalAliases(e){const t=Ae("/rooms/$roomId/aliases",{$roomId:e}),r=ur.V3;return this.http.authedRequest(de.Get,t,void 0,void 0,{prefix:r})}getRoomIdForAlias(e){const t=Ae("/directory/room/$alias",{$alias:e});return this.http.authedRequest(de.Get,t)}getRoomDirectoryVisibility(e){const t=Ae("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(de.Get,t)}setRoomDirectoryVisibility(e,t){const r=Ae("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(de.Put,r,void 0,{visibility:t})}searchUserDirectory({term:e,limit:t}){const r={search_term:e};return t!==void 0&&(r.limit=t),this.http.authedRequest(de.Post,"/user_directory/search",void 0,r)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t){const r=t?Ae("/profile/$userId/$info",{$userId:e,$info:t}):Ae("/profile/$userId",{$userId:e});return this.http.authedRequest(de.Get,r)}async doesServerSupportExtendedProfiles(){return this.doesServerSupportUnstableFeature(Z$)}async getExtendedProfileRequestPrefix(){return await this.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable")?ur.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"}async getExtendedProfile(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");return this.http.authedRequest(de.Get,Ae("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:await this.getExtendedProfileRequestPrefix()})}async getExtendedProfileProperty(e,t){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");return(await this.http.authedRequest(de.Get,Ae("/profile/$userId/$key",{$userId:e,$key:t}),void 0,void 0,{prefix:await this.getExtendedProfileRequestPrefix()}))[t]}async setExtendedProfileProperty(e,t){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const r=this.getUserId();await this.http.authedRequest(de.Put,Ae("/profile/$userId/$key",{$userId:r,$key:e}),void 0,{[e]:t},{prefix:await this.getExtendedProfileRequestPrefix()})}async deleteExtendedProfileProperty(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const t=this.getUserId();await this.http.authedRequest(de.Delete,Ae("/profile/$userId/$key",{$userId:t,$key:e}),void 0,void 0,{prefix:await this.getExtendedProfileRequestPrefix()})}async patchExtendedProfile(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const t=this.getUserId();return this.http.authedRequest(de.Patch,Ae("/profile/$userId",{$userId:t}),{},e,{prefix:await this.getExtendedProfileRequestPrefix()})}async setExtendedProfile(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const t=this.getUserId();await this.http.authedRequest(de.Put,Ae("/profile/$userId",{$userId:t}),{},e,{prefix:await this.getExtendedProfileRequestPrefix()})}getThreePids(){return this.http.authedRequest(de.Get,"/account/3pid")}async addThreePidOnly(e){return this.http.authedRequest(de.Post,"/account/3pid/add",void 0,e)}async bindThreePid(e){return this.http.authedRequest(de.Post,"/account/3pid/bind",void 0,e)}async unbindThreePid(e,t){const r="/account/3pid/unbind",i={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)};return this.http.authedRequest(de.Post,r,void 0,i)}deleteThreePid(e,t){return this.http.authedRequest(de.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}setPassword(e,t,r){const i="/account/password",s={auth:e,new_password:t,logout_devices:r};return this.http.authedRequest(de.Post,i,void 0,s)}getDevices(){return this.http.authedRequest(de.Get,"/devices")}getDevice(e){const t=Ae("/devices/$device_id",{$device_id:e});return this.http.authedRequest(de.Get,t)}setDeviceDetails(e,t){const r=Ae("/devices/$device_id",{$device_id:e});return this.http.authedRequest(de.Put,r,void 0,t)}deleteDevice(e,t){const r=Ae("/devices/$device_id",{$device_id:e}),i={};return t&&(i.auth=t),this.http.authedRequest(de.Delete,r,void 0,i)}deleteMultipleDevices(e,t){const r={devices:e};return t&&(r.auth=t),this.http.authedRequest(de.Post,"/delete_devices",void 0,r)}async getPushers(){const e=await this.http.authedRequest(de.Get,"/pushers");return await this.doesServerSupportUnstableFeature("org.matrix.msc3881")||(e.pushers=e.pushers.map(t=>(t.hasOwnProperty(DR.name)||(t[DR.name]=!0),t))),e}setPusher(e){return this.http.authedRequest(de.Post,"/pushers/set",void 0,e)}removePusher(e,t){const r="/pushers/set",i={pushkey:e,app_id:t,kind:null};return this.http.authedRequest(de.Post,r,void 0,i)}setLocalNotificationSettings(e,t){const r=`${Cj.name}.${e}`;return this.setAccountData(r,t)}getPushRules(){return this.http.authedRequest(de.Get,"/pushrules/").then(e=>(this.setPushRules(e),this.pushRules))}setPushRules(e){this.pushRules=Mb.rewriteDefaultRules(e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,t,r,i){const s=Ae("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this.http.authedRequest(de.Put,s,void 0,i)}deletePushRule(e,t,r){const i=Ae("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:r});return this.http.authedRequest(de.Delete,i)}setPushRuleEnabled(e,t,r,i){const s=Ae("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:r});return this.http.authedRequest(de.Put,s,void 0,{enabled:i})}setPushRuleActions(e,t,r,i){const s=Ae("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:r});return this.http.authedRequest(de.Put,s,void 0,{actions:i})}search({body:e,next_batch:t},r){const i={};return t&&(i.next_batch=t),this.http.authedRequest(de.Post,"/search",i,e,{abortSignal:r})}uploadKeysRequest(e,t){return this.http.authedRequest(de.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(de.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e,{token:t}={}){const r={device_keys:{}};return t!==void 0&&(r.token=t),e.forEach(i=>{r.device_keys[i]=[]}),this.http.authedRequest(de.Post,"/keys/query",void 0,r)}claimOneTimeKeys(e,t="signed_curve25519",r){const i={};t===void 0&&(t="signed_curve25519");for(const[a,c]of e){const l=i[a]||{};Sb(i,a,l),Sb(l,c,t)}const s={one_time_keys:i};return r&&(s.timeout=r),this.http.authedRequest(de.Post,"/keys/claim",void 0,s)}getKeyChanges(e,t){const r={from:e,to:t};return this.http.authedRequest(de.Get,"/keys/changes",r)}uploadDeviceSigningKeys(e,t){const r=Object.assign({},t);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(de.Post,"/keys/device_signing/upload",void 0,r,{prefix:ur.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");const t=this.http.getUrl("/account/register",void 0,da.V2,this.idBaseUrl);return this.http.requestOtherUrl(de.Post,t,e)}requestEmailToken(e,t,r,i,s){const o={client_secret:t,email:e,send_attempt:r==null?void 0:r.toString()};return i&&(o.next_link=i),this.http.idServerRequest(de.Post,"/validate/email/requestToken",o,da.V2,s)}requestMsisdnToken(e,t,r,i,s,o){const a={client_secret:r,country:e,phone_number:t,send_attempt:i==null?void 0:i.toString()};return s&&(a.next_link=s),this.http.idServerRequest(de.Post,"/validate/msisdn/requestToken",a,da.V2,o)}submitMsisdnToken(e,t,r,i){const s={sid:e,client_secret:t,token:r};return this.http.idServerRequest(de.Post,"/validate/msisdn/submitToken",s,da.V2,i??void 0)}submitMsisdnTokenOtherUrl(e,t,r,i){const s={sid:t,client_secret:r,token:i};return this.http.requestOtherUrl(de.Post,e,s)}getIdentityHashDetails(e){return this.http.idServerRequest(de.Get,"/hash_details",void 0,da.V2,e)}async identityHashedLookup(e,t){const r={},i=await this.getIdentityHashDetails(t);if(!i||!i.lookup_pepper||!i.algorithms)throw new Error("Unsupported identity server: bad response");r.pepper=i.lookup_pepper;const s={};if(i.algorithms.includes("sha256"))r.addresses=await Promise.all(e.map(async c=>{const l=c[0].toLowerCase(),u=c[1].toLowerCase(),h=await V$(`${l} ${u} ${r.pepper}`),p=hw(h);return s[p]=c[0],p})),r.algorithm="sha256";else if(i.algorithms.includes("none"))r.addresses=e.map(c=>{const l=c[0].toLowerCase(),u=c[1].toLowerCase(),h=`${l} ${u}`;return s[h]=c[0],h}),r.algorithm="none";else throw new Error("Unsupported identity server: unknown hash algorithm");const o=await this.http.idServerRequest(de.Post,"/lookup",r,da.V2,t);if(!(o!=null&&o.mappings))return[];const a=[];for(const c of Object.keys(o.mappings)){const l=o.mappings[c],u=s[c];if(!u)throw new Error("Identity server returned more results than expected");a.push({address:u,mxid:l})}return a}async lookupThreePid(e,t,r){const s=(await this.identityHashedLookup([[t,e]],r)).find(a=>a.address===t);return s?{address:t,medium:e,mxid:s.mxid}:{}}async bulkLookupThreePids(e,t){const r=await this.identityHashedLookup(e.map(s=>[s[1],s[0]]),t),i=[];for(const s of r){const o=e.find(a=>a[1]===s.address);if(!o)throw new Error("Identity sever returned unexpected results");i.push([o[0],s.address,s.mxid])}return{threepids:i}}getIdentityAccount(e){return this.http.idServerRequest(de.Get,"/account",void 0,da.V2,e)}sendToDevice(e,t,r){const i=Ae("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),s={messages:ed(t)},o=new Map;for(const[a,c]of t)o.set(a,Array.from(c.keys()));return this.logger.debug(`PUT ${i}`,o),this.http.authedRequest(de.Put,i,void 0,s)}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(de.Get,"/thirdparty/protocols").then(e=>{if(!e||typeof e!="object")throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e})}getThirdpartyLocation(e,t){const r=Ae("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(de.Get,r,t)}getThirdpartyUser(e,t){const r=Ae("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(de.Get,r,t)}getTerms(e,t){const r=this.termsUrlForService(e,t);return this.http.requestOtherUrl(de.Get,r)}agreeToTerms(e,t,r,i){const s=this.termsUrlForService(e,t),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(de.Post,s,{user_accepts:i},{headers:o})}reportEvent(e,t,r,i){const s=Ae("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(de.Post,s,void 0,{score:r,reason:i})}getRoomHierarchy(e,t,r,i=!1,s){const o=Ae("/rooms/$roomId/hierarchy",{$roomId:e}),a={suggested_only:String(i),max_depth:r==null?void 0:r.toString(),from:s,limit:t==null?void 0:t.toString()};return this.http.authedRequest(de.Get,o,a,void 0,{prefix:ur.V1}).catch(c=>{if(c.errcode==="M_UNRECOGNIZED")return this.http.authedRequest(de.Get,o,a,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw c})}async unstableCreateFileTree(e){const{room_id:t}=await this.createRoom({name:e,preset:oy.PrivateChat,power_level_content_override:{...Xse,users:{[this.getUserId()]:100}},creation_content:{[wb]:cd.Space},initial_state:[{type:AR.name,state_key:OR.name,content:{[MR.name]:!0}},{type:ie.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new T5(this,t)}unstableGetFileTreeSpace(e){var s,o;const t=this.getRoom(e);if((t==null?void 0:t.getMyMembership())!==ze.Join)return null;const r=t.currentState.getStateEvents(ie.RoomCreate,""),i=t.currentState.getStateEvents(AR.name,OR.name);if(!r)throw new Error("Expected single room create event");return!((s=i==null?void 0:i.getContent())!=null&&s[MR.name])||((o=r.getContent())==null?void 0:o[wb])!==cd.Space?null:new T5(this,e)}slidingSync(e,t,r){const i={};e.pos&&(i.pos=e.pos,delete e.pos),e.timeout&&(i.timeout=e.timeout,delete e.timeout);const s=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(de.Post,"/sync",i,e,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:t,localTimeoutMs:s,abortSignal:r})}supportsThreads(){var e;return((e=this.clientOpts)==null?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(vs.IntentionalMentions)!==Vr.Unsupported}async getRoomSummary(e,t){const r={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{const i=Ae("/summary/$roomid",{$roomid:e});return await this.http.authedRequest(de.Get,i,{via:t},void 0,r)}catch(i){if(i instanceof gn&&i.errcode==="M_UNRECOGNIZED"){const s=Ae("/rooms/$roomid/summary",{$roomid:e});return await this.http.authedRequest(de.Get,s,{via:t},void 0,r)}else throw i}}processThreadEvents(e,t,r){e.processThreadedEvents(t,r)}processThreadRoots(e,t,r){this.supportsThreads()&&e.processThreadRoots(t,r)}processBeaconEvents(e,t){this.processAggregatedTimelineEvents(e,t)}processAggregatedTimelineEvents(e,t){t!=null&&t.length&&e&&(e.currentState.processBeaconEvents(t,this),e.processPollEvents(t))}async whoami(){return this.http.authedRequest(de.Get,"/account/whoami")}async timestampToEvent(e,t,r){const i=Ae("/rooms/$roomId/timestamp_to_event",{$roomId:e}),s={ts:t.toString(),dir:r};try{return await this.http.authedRequest(de.Get,i,s,void 0,{prefix:ur.V1})}catch(o){if(o.errcode==="M_UNRECOGNIZED"&&(o.httpStatus===400||o.httpStatus===404||o.httpStatus===405))return await this.http.authedRequest(de.Get,i,s,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw o}}async getAuthIssuer(){return this.http.request(de.Get,"/auth_issuer",void 0,void 0,{prefix:ur.Unstable+"/org.matrix.msc2965"})}async getAuthMetadata(){let e;try{e=await this.http.request(de.Get,"/auth_metadata",void 0,void 0,{prefix:ur.Unstable+"/org.matrix.msc2965"})}catch(t){if(t instanceof gn&&t.errcode==="M_UNRECOGNIZED"){const{issuer:r}=await this.getAuthIssuer();return AP(r)}throw t}return MP(e)}};B4.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY";let dv=B4;function L5(n){return Object.fromEntries(Object.entries(n).map(([e,t])=>[`${ga}.${e}`,t]))}function Q$(n,e){var u;const t=n.getUserId(),r=e.getId(),i=n.getRoom(e.getRoomId());if(!i||!t||!r)return;if(!i.findEventById(r)){O.info(`Decrypted event ${e.getId()} is not in room ${i.roomId}: ignoring`);return}const s=!!e.threadRootId&&!e.isThreadRoot;let o;if(s){const h=i.getThread(e.threadRootId);o=h?h.hasUserReadEvent(t,r):!0}else o=i.hasUserReadEvent(t,r);if(o)return;const a=n.getPushActionsForEvent(e,!0);if(!!((u=a==null?void 0:a.tweaks)!=null&&u.highlight)){const h=i.getUnreadCountForEventContext(sr.Highlight,e)+1;s?i.setThreadUnreadNotificationCount(e.threadRootId,sr.Highlight,h):i.setUnreadNotificationCount(sr.Highlight,h)}if(!!(a!=null&&a.notify)){const h=i.getUnreadCountForEventContext(sr.Total,e)+1;s?i.setThreadUnreadNotificationCount(e.threadRootId,sr.Total,h):i.setUnreadNotificationCount(sr.Total,h)}}function qf(n){return hv(n)?ry:n.threadRootId}function hv(n){return!n.threadRootId||n.isThreadRoot?!0:n.isRelation()?n.isRelation(tn.name)?!1:n.relationEventId===n.threadRootId:(O.warn(`Event is not a relation or a thread root, but still has a threadRootId! id=${n.getId()}`),!0)}var Ro=(n=>(n.New="Thread.new",n.Update="Thread.update",n.NewReply="Thread.newReply",n.ViewThread="Thread.viewThread",n.Delete="Thread.delete",n))(Ro||{}),ha=(n=>(n[n.None=0]="None",n[n.Experimental=1]="Experimental",n[n.Stable=2]="Stable",n))(ha||{});function S_(n,e){return n?2:e?1:0}const Fs=class Fs extends Jj{constructor(e,t,r){if(super(),this.id=e,this.rootEvent=t,this._currentUserParticipated=!1,this.replyCount=0,this.pendingReplyCount=0,this.initialEventsFetched=!Fs.hasServerSideSupport,this.replayEvents=[],this.onTimelineReset=async()=>{await this.processRootEventPromise,this.processRootEventPromise=void 0},this.onBeforeRedaction=(i,s)=>{i!=null&&i.isRelation(tn.name)&&this.room.eventShouldLiveIn(i).threadId===this.id&&i.getId()!==this.id&&!s.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit("Thread.update",this))},this.onRedaction=async(i,s,o)=>{var a;if(o===this.id)if(this.replyCount<=0){for(const c of this.timeline)this.clearEventMetadata(c);this.lastEvent=this.rootEvent,this._currentUserParticipated=!1,this.emit("Thread.delete",this)}else((a=this.lastEvent)==null?void 0:a.getId())===i.getAssociatedId()&&(await this.processRootEventPromise,this.processRootEventPromise=void 0),await this.updateThreadMetadata()},this.onTimelineEvent=(i,s,o)=>{if(!o){const a=i.getSender();a&&s&&this.shouldSendLocalEchoReceipt(a,i)&&s.addLocalEchoReceipt(a,i,li.Read),i.getId()!==this.id&&i.isRelation(tn.name)&&this.replyCount++}this.onEcho(i,o??!1)},this.onLocalEcho=i=>{this.onEcho(i,!1)},this.onEcho=async(i,s)=>{i.threadRootId===this.id&&this.lastEvent!==i&&(await this.updateThreadMetadata(),i.isRelation(tn.name)&&(s||(this.lastEvent=void 0,this.emit("Thread.newReply",this,i))))},this.setMaxListeners(1e3),!(r!=null&&r.room))throw new Error("element-web#22141: A thread requires a room in order to function");this.room=r.room,this.client=r.client,this.pendingEventOrdering=r.pendingEventOrdering??Rd.Chronological,this.timelineSet=new cf(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new sy(this),this.reEmitter.reEmit(this.timelineSet,[Je.Timeline,Je.TimelineReset]),this.room.on(mn.BeforeRedaction,this.onBeforeRedaction),this.room.on(Je.Redaction,this.onRedaction),this.room.on(Je.LocalEchoUpdated,this.onLocalEcho),this.room.on(Je.TimelineReset,this.onTimelineReset),this.timelineSet.on(Je.Timeline,this.onTimelineEvent),this.processReceipts(r.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}async fetchRootEvent(){try{const e=await this.client.fetchRoomEvent(this.roomId,this.id),t=this.client.getEventMapper();this.rootEvent=t(e)}catch(e){O.error("Failed to fetch thread root to construct thread with",e)}await this.processEvent(this.rootEvent)}static setServerSideSupport(e){Fs.hasServerSideSupport=e,e!==2&&(wf.setPreferUnstable(!0),Ef.setPreferUnstable(!0),tn.setPreferUnstable(!0))}static setServerSideListSupport(e){Fs.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){Fs.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,t){var i;if((this.client.canSupport.get(vs.RelationsRecursion)??Vr.Unsupported)===Vr.Unsupported){const s=(i=this.getReadReceiptForUserId(e))==null?void 0:i.eventId;if(s){const o=this.findEventById(s);if(o&&o.getTs()>t.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState($e.FORWARDS)}addEventToTimeline(e,t){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){const t=e.getId();t&&(this.findEventById(t)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,t){e.forEach(r=>this.addEvent(r,t,!1)),this.updateThreadMetadata()}addEvent(e,t,r=!0){this.setEventMetadata(e);const i=this.lastReply(),s=!i||e.localTimestamp>=i.localTimestamp;if(!Fs.hasServerSideSupport)this.addEventToTimeline(e,t),this.client.decryptEventIfNeeded(e);else if(e.isRelation(on.Annotation)||e.isRelation(on.Replace)){this.addRelatedThreadEvent(e,t);return}else!t&&s?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):t?this.addEventToTimeline(e,t):this.insertEventIntoTimeline(e);e.getId()!==this.id&&e.isRelation(tn.name)&&!t&&s&&(this.lastEvent=void 0),r&&(this.emit("Thread.newReply",this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,t){var r,i,s;this.initialEventsFetched?(this.client.canSupport.get(vs.RelationsRecursion)??Vr.Unsupported)===Vr.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,t):(r=this.replayEvents)==null||r.push(e),(i=this.timelineSet.relations)==null||i.aggregateParentEvent(e),(s=this.timelineSet.relations)==null||s.aggregateChildEvent(e,this.timelineSet)}async processEvent(e){e&&(this.setEventMetadata(e),await this.fetchEditsWhereNeeded(e))}processReceipts(e=[]){for(const{eventId:t,receiptType:r,userId:i,receipt:s,synthetic:o}of e)this.addReceiptToStructure(t,r,i,s,o)}getRootEventBundledRelationship(e=this.rootEvent){return e==null?void 0:e.getServerAggregatedRelation(tn.name)}async processRootEvent(){const e=this.getRootEventBundledRelationship();if(Fs.hasServerSideSupport&&e){this.replyCount=e.count,this._currentUserParticipated=!!e.current_user_participated;const t=this.client.getEventMapper();this.lastEvent=t({...e.latest_event,room_id:this.roomId}),this.updatePendingReplyCount(),await this.processEvent(this.lastEvent)}}updatePendingReplyCount(){const t=(this.pendingEventOrdering===Rd.Detached?this.room.getPendingEvents():this.events).filter(r=>{var i;return r.threadRootId===this.id&&r.isRelation(tn.name)&&r.status!==null&&r.getId()!==((i=this.lastEvent)==null?void 0:i.getId())});this.lastPendingEvent=t.length?t[t.length-1]:void 0,this.pendingReplyCount=t.length}async resetLiveTimeline(e,t){const r=this.liveTimeline;this.timelineSet.resetLiveTimeline(e??void 0,t??void 0);const i=this.liveTimeline;let s,o;e&&(s=(await this.client.createMessagesRequest(this.roomId,e,1,St.Forward)).end),t&&(o=(await this.client.createMessagesRequest(this.roomId,t,1,St.Backward)).start),t&&r.getPaginationToken(St.Forward)===t&&r.setPaginationToken(o??null,St.Forward),e&&i.getPaginationToken(St.Backward)===e&&i.setPaginationToken(s??null,St.Backward)}async updateThreadFromRootEvent(){Fs.hasServerSideSupport&&(!this.initialEventsFetched&&!this.lastEvent&&await this.processRootEvent(),await this.fetchRootEvent()),await this.processRootEvent()}async updateThreadMetadata(){if(this.updatePendingReplyCount(),this.processRootEventPromise||(this.processRootEventPromise=this.updateThreadFromRootEvent()),await this.processRootEventPromise,!this.initialEventsFetched)if(this.initalEventFetchProm)await this.initalEventFetchProm;else try{this.timelineSet.resetLiveTimeline(),this.replyCount===0&&this.rootEvent?(this.timelineSet.addEventsToTimeline([this.rootEvent],!0,!1,this.liveTimeline,null),this.liveTimeline.setPaginationToken(null,St.Backward)):(this.initalEventFetchProm=this.client.paginateEventTimeline(this.liveTimeline,{backwards:!0}),await this.initalEventFetchProm),this.initialEventsFetched=!0;for(const e of this.replayEvents)this.addEvent(e,!1);this.replayEvents=null,this.emit(Je.TimelineReset,this.room,this.timelineSet,!0)}catch(e){O.error("Failed to load start of newly created thread: ",e),this.initialEventsFetched=!1}this.emit("Thread.update",this)}async fetchEditsWhereNeeded(...e){if((this.client.canSupport.get(vs.RelationsRecursion)??Vr.Unsupported)===Vr.Unsupported)return Promise.all(e.filter($oe).map(async r=>{try{const i=await this.client.relations(this.roomId,r.getId(),on.Replace,r.getType(),{limit:1});if(i.events.length){const s=i.events[0];r.makeReplaced(s),this.insertEventIntoTimeline(s)}}catch(i){O.error("Failed to load edits for encrypted thread event",i)}}))}setEventMetadata(e){e&&($e.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){var t,r,i;e&&(e.setThread(void 0),(i=(r=(t=e.event)==null?void 0:t.unsigned)==null?void 0:r["m.relations"])==null||delete i[tn.name])}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(e=t=>t.isRelation(tn.name)){for(let t=this.timeline.length-1;t>=0;t--){const r=this.timeline[t];if(e(r))return r}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){return this.lastPendingEvent??this.lastEvent??this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof Ji}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,t){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,t){var o;const r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){const a=i.getTs()<this.room.getOldestThreadedReceiptTs(),c=i.getId();if(a&&c)return c}const s=super.getEventReadUpTo(e,t);if(i){const a=this.room.getLastUnthreadedReceiptFor(e);if(!a)return s;for(let c=((o=this.timeline)==null?void 0:o.length)-1;c>=0;--c){const l=this.timeline[c];if(l.getId()===s)return s;if(l.getTs()<a.ts)return l.getId()??s}}return s}hasUserReadEvent(e,t){var r,i,s;if(e===this.client.getUserId()){const o=(((r=this.lastReply())==null?void 0:r.getTs())??0)<this.room.getOldestThreadedReceiptTs(),a=((i=this.room.getLastUnthreadedReceiptFor(e))==null?void 0:i.ts)??0,c=(((s=this==null?void 0:this.lastReply())==null?void 0:s.getTs())??0)<a;if(o||c)return!0}return this.room.hasUserReadEvent(e,t)}setUnread(e,t){return this.room.setThreadUnreadNotificationCount(this.id,e,t)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}};Fs.hasServerSideSupport=0,Fs.hasServerSideListSupport=0,Fs.hasServerSideFwdPaginationSupport=0;let Gr=Fs;function $oe(n){return n.isEncrypted()&&(n.isRelation(tn.name)||n.isThreadRoot)}const wf=new nw("related_by_senders","io.element.relation_senders"),Ef=new nw("related_by_rel_types","io.element.relation_types"),tn=new nw("m.thread","io.element.thread");var To=(n=>(n[n.My=0]="My",n[n.All=1]="All",n))(To||{});function eB(n){switch(n){case 0:return"participated";default:return"all"}}class A5 extends Error{constructor(e,t,r){super(t),this.code=e,this.name="DecryptionError",this.detailedString=Boe(this,r)}}function Boe(n,e){let t=n.name+"[msg: "+n.message;return e&&(t+=", "+Object.keys(e).map(r=>r+": "+e[r]).join(", ")),t+="]",t}const M5=Object.freeze({visible:!0});var mn=(n=>(n.Decrypted="Event.decrypted",n.BeforeRedaction="Event.beforeRedaction",n.VisibilityChange="Event.visibilityChange",n.LocalEventIdReplaced="Event.localEventIdReplaced",n.Status="Event.status",n.Replaced="Event.replaced",n.RelationsCreated="Event.relationsCreated",n.SentinelUpdated="Event.sentinelUpdated",n))(mn||{});class Ji extends Xn{constructor(e={}){super(),this.event=e,this.pushDetails={},this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this.visibility=M5,this._hasCachedExtEv=!1,this._cachedExtEv=void 0,this._decryptionFailureReason=null,this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=null,this.decryptionPromise=null,this.retryDecryption=!1,this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,["state_key","type","sender","room_id","membership"].forEach(r=>{typeof e[r]=="string"&&(e[r]=TT(e[r]))}),["membership","avatar_url","displayname"].forEach(r=>{var i;typeof((i=e.content)==null?void 0:i[r])=="string"&&(e.content[r]=TT(e.content[r]))}),["rel_type"].forEach(r=>{var i,s;typeof((s=(i=e.content)==null?void 0:i["m.relates_to"])==null?void 0:s[r])=="string"&&(e.content["m.relates_to"][r]=TT(e.content["m.relates_to"][r]))}),this.txnId=e.txn_id;const t=this.getAge();this.localTimestamp=t!==void 0?Date.now()-t:this.getTs()??Date.now(),this.reEmitter=new sy(this)}setMetadata(e,t){var s,o,a,c;const r=this.isState()&&this.getType()===ie.RoomMember&&this.getSender()===this.getStateKey();let i=!1;if(r||!((o=(s=this.sender)==null?void 0:s.events)!=null&&o.member)){const l=e.getSentinelMember(this.getSender());l!==this.sender&&(i=!0),this.sender=l}if(r||!((c=(a=this.target)==null?void 0:a.events)!=null&&c.member)&&this.getType()===ie.RoomMember){const l=e.getSentinelMember(this.getStateKey());l!==this.target&&(i=!0),this.target=l}this.isState()&&t&&(this.forwardLooking=!1),i&&this.emit("Event.sentinelUpdated")}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=ss.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){const e=Object.assign({},this.getContent());if(this.getWireType()===ie.RoomMessageEncrypted)for(const[t,r]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||e[t]===void 0&&(e[t]=r);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var t;const e=this.getRoomId();return e?`id=${this.getId()} type=${this.getWireType()} sender=${this.getSender()} room=${e} ts=${(t=this.getDate())==null?void 0:t.toISOString()}`:`msgid=${this.getContent()[aw]} type=${this.getWireType()} sender=${this.getSender()}`}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content??{}:this.event.content??{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]??{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var r;if(this.isState())return;const e=(r=this.getWireContent())==null?void 0:r["m.relates_to"];if((e==null?void 0:e.rel_type)===tn.name)return e.event_id;if(this.thread)return this.thread.id;if(this.threadId!==void 0)return this.threadId;const t=this.getUnsigned();if(typeof t[Eb.name]=="string")return t[Eb.name]}get isThreadRoot(){return this.isState()?!1:!!this.getServerAggregatedRelation(tn.name)||this.threadRootId===this.getId()}get replyEventId(){var e,t;return(t=(e=this.getWireContent()["m.relates_to"])==null?void 0:e["m.in_reply_to"])==null?void 0:t.event_id}get relationEventId(){var e,t;return(t=(e=this.getWireContent())==null?void 0:e["m.relates_to"])==null?void 0:t.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return this.event.state_key!==void 0}getMembershipAtEvent(){const e=this.getUnsigned();return Tj.findIn(e)}makeEncrypted(e,t,r,i){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=r,this.claimedEd25519Key=i}isBeingDecrypted(){return this.decryptionPromise!=null}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return this._decryptionFailureReason!==null}get decryptionFailureReason(){return this._decryptionFailureReason}get isEncryptedDisabledForUnverifiedDevices(){return this.decryptionFailureReason===rk.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}async attemptDecryption(e,t={}){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");const r=this.clearEvent&&!this.isDecryptionFailure(),i=t.forceRedecryptIfUntrusted&&this.isKeySourceUntrusted();if(r&&!i)throw new Error("Attempt to decrypt event which has already been decrypted");return this.decryptionPromise?(O.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this.decryptionPromise):(this.decryptionPromise=this.decryptionLoop(e,t),this.decryptionPromise)}getKeyRequestRecipients(e){return[{userId:e,deviceId:"*"}]}async decryptionLoop(e,t={}){for(await Promise.resolve();;){this.retryDecryption=!1;let r;try{const i=await e.decryptEvent(this);t.isRetry===!0&&O.info(`Decrypted event on retry (${this.getDetails()})`),this.setClearData(i),this._decryptionFailureReason=null}catch(i){const s=i instanceof A5?i.detailedString:String(i);if(r=i,this.retryDecryption){O.log(`Error decrypting event (${this.getDetails()}), but retrying: ${s}`);continue}O.warn(`Error decrypting event (${this.getDetails()}): ${s}`),this.setClearDataForDecryptionFailure(String(i)),this._decryptionFailureReason=i instanceof A5?i.code:rk.UNKNOWN_ERROR}this.decryptionPromise=null,this.retryDecryption=!1,this.setPushDetails(),t.emit!==!1&&this.emit("Event.decrypted",this,r);return}}setClearData(e){this.clearEvent=e.clearEvent,this.senderCurve25519Key=e.senderCurve25519Key??null,this.claimedEd25519Key=e.claimedEd25519Key??null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:ie.RoomMessage,content:{msgtype:"m.bad.encrypted",body:`** Unable to decrypt: ${e} **`}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===ie.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){const t=(e==null?void 0:e.visible)??!0,r=(e==null?void 0:e.reason)??null;let i=!1;(this.visibility.visible!==t||!this.visibility.visible&&this.visibility.reason!==r)&&(i=!0),i&&(t?this.visibility=M5:this.visibility=Object.freeze({visible:!1,reason:r}),this.emit("Event.visibilityChange",this,t))}messageVisibility(){return this.visibility}makeRedacted(e,t){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(const s in this.event)this.event.hasOwnProperty(s)&&!Hoe.has(s)&&delete this.event[s];this.isEncrypted()&&(this.clearEvent=void 0);const r=this.getType()in O5?O5[this.getType()]:{},i=this.getContent();for(const s in i)i.hasOwnProperty(s)&&!r[s]&&delete i[s];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(t),e.moveToMainTimeline(t)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var r;const t=this.thread;if(this.moveToMainTimeline(e),t)for(const i of t.events)((r=i.getRelation())==null?void 0:r.event_id)===this.getId()&&i.moveAllRelatedToMainTimeline(e)}moveToMainTimeline(e){var r;(r=this.thread)==null||r.timelineSet.removeEvent(this.getId()),this.setThread(void 0);const t=e.getLiveTimeline();t.getTimelineSet().insertEventIntoTimeline(this,t,t.getState($e.FORWARDS),!1)}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===ie.RoomRedaction}asVisibilityChange(){if(!td.matches(this.getType()))return null;const e=this.getRelation();if(!e||e.rel_type!="m.reference")return null;const t=e.event_id;if(!t)return null;const r=this.getWireContent(),i=!!r.visible,s=r.reason;return s&&typeof s!="string"?null:{visible:i,reason:s,eventId:t}}isVisibilityEvent(){return td.matches(this.getType())}getRedactionEvent(){var e,t,r;return this.isRedacted()?(e=this.clearEvent)!=null&&e.unsigned?((t=this.clearEvent)==null?void 0:t.unsigned.redacted_because)??null:(r=this.event.unsigned)!=null&&r.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,t){this.pushDetails={actions:e,rule:t}}handleRemoteEcho(e){const t=this.getUnsigned(),r=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit("Event.localEventIdReplaced",this),this.localTimestamp=Date.now()-(this.getAge()??0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit("Event.status",this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)}isRelation(e){var r;const t=(r=this.getWireContent())==null?void 0:r["m.relates_to"];return this.isState()&&(t!=null&&t.rel_type)&&[on.Replace,on.Thread].includes(t.rel_type)?!1:!!(t!=null&&t.rel_type&&t.event_id&&(!e||t.rel_type===e))}getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]??null:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit("Event.replaced",this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return(t=this.getUnsigned()["m.relations"])==null?void 0:t[e]}replacingEventId(){const e=this.getServerAggregatedRelation(on.Replace);if(e)return e.event_id;if(this._replacingEvent)return this._replacingEvent.getId()}replacingEvent(){return this._replacingEvent}replacingEventDate(){const e=this.getServerAggregatedRelation(on.Replace);if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()??void 0}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const e=this.getRelation();if(this.replyEventId)return this.replyEventId;if(e)return e.event_id;if(this.isRedaction())return this.event.redacts}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(e=!0){this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){const e=new Ji(JSON.parse(JSON.stringify(this.event)));for(const[t,r]of Object.entries(this))t!=="event"&&(e[t]=r);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;const t=xR(this.event),r=xR(e.event);return JSON.stringify(t)===JSON.stringify(r)}toJSON(){const e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[Ro.Update]),this.thread=e,this.setThreadId(e==null?void 0:e.id),e&&this.reEmitter.reEmit(e,[Ro.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}const Hoe=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),O5={[ie.RoomMember]:{membership:1},[ie.RoomJoinRules]:{join_rule:1},[ie.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}};var kt=(n=>(n.Events="RoomState.events",n.Members="RoomState.members",n.NewMember="RoomState.newMember",n.Update="RoomState.update",n.BeaconLiveness="RoomState.BeaconLiveness",n.Marker="RoomState.Marker",n))(kt||{});class fv extends Xn{constructor(e,t={status:0}){super(),this.roomId=e,this.oobMemberFlags=t,this.reEmitter=new sy(this),this.sentinels={},this.displayNameToUserIds=new Map,this.userIdsToDisplayNames={},this.tokenToInvite={},this.joinedMemberCount=null,this.summaryJoinedMemberCount=null,this.invitedMemberCount=null,this.summaryInvitedMemberCount=null,this.modified=-1,this.members={},this.events=new Map,this.paginationToken=null,this.beacons=new Map,this._liveBeaconIds=[],this.updateModifiedTime()}getJoinedMemberCount(){return this.summaryJoinedMemberCount!==null?this.summaryJoinedMemberCount:(this.joinedMemberCount===null&&(this.joinedMemberCount=this.getMembers().reduce((e,t)=>t.membership===ze.Join?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return this.summaryInvitedMemberCount!==null?this.summaryInvitedMemberCount:(this.invitedMemberCount===null&&(this.invitedMemberCount=this.getMembers().reduce((e,t)=>t.membership===ze.Invite?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(t=>!e.includes(t.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let t=this.sentinels[e];if(t===void 0){t=new Cb(this.roomId,e);const r=this.members[e];r!=null&&r.events.member&&t.setMembershipEvent(r.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){if(!this.events.has(e))return t===void 0?[]:null;if(t===void 0)return Array.from(this.events.get(e).values());const r=this.events.get(e).get(t);return r||null}get hasLiveBeacons(){var e;return!!((e=this.liveBeaconIds)!=null&&e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){const e=new fv(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=0,Array.from(this.events.values()).forEach(r=>{e.setStateEvents(Array.from(r.values()))}),this.oobMemberFlags.status=t,this.summaryInvitedMemberCount!==null&&e.setInvitedMemberCount(this.getInvitedMemberCount()),this.summaryJoinedMemberCount!==null&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==2&&this.getMembers().forEach(r=>{var i;r.isOutOfBand()&&((i=e.getMember(r.userId))==null||i.markOutOfBand())}),e}setUnknownStateEvents(e){const t=e.filter(r=>!this.events.has(r.getType())||!this.events.get(r.getType()).has(r.getStateKey()));this.setStateEvents(t)}setStateEvents(e,t){this.updateModifiedTime(),e.forEach(r=>{if(r.getRoomId()!==this.roomId||!r.isState())return;RP.matches(r.getType())&&this.setBeacon(r);const i=this.getStateEventMatching(r);this.setStateEvent(r),r.getType()===ie.RoomMember&&(this.updateDisplayNameCache(r.getStateKey(),r.getContent().displayname??""),this.updateThirdPartyTokenCache(r)),this.emit("RoomState.events",r,this,i)}),this.onBeaconLivenessChange(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState()))if(r.getType()===ie.RoomMember){const i=r.getStateKey();(r.getContent().membership===ze.Leave||r.getContent().membership===ze.Ban)&&(r.getContent().avatar_url=r.getContent().avatar_url||r.getPrevContent().avatar_url,r.getContent().displayname=r.getContent().displayname||r.getPrevContent().displayname);const s=this.getOrCreateMember(i,r);s.setMembershipEvent(r,this),this.updateMember(s),this.emit("RoomState.members",r,this,s)}else if(r.getType()===ie.RoomPowerLevels){if(r.getStateKey()!=="")return;Object.values(this.members).forEach(s=>{const o=s.getLastModifiedTime();s.setPowerLevelEvent(r),o!==s.getLastModifiedTime()&&this.emit("RoomState.members",r,this,s)}),this.sentinels={}}else wj.matches(r.getType())&&this.emit("RoomState.Marker",r,t)}),this.emit("RoomState.update",this)}async processBeaconEvents(e,t){var s;if(!e.length||!this.beacons.size)return;const r=[...this.beacons.values()].reduce((o,a)=>(o[a.beaconInfoId]=a,o),{}),i=(o,a)=>{if(!tk.matches(a.getType()))return;const c=r[o];c&&c.addLocations([a])};for(const o of e){const a=(s=o.getRelation())==null?void 0:s.event_id;if(!a||!r[a]||!tk.matches(o.getType())&&!o.isEncrypted())return;try{await t.decryptEventIfNeeded(o),i(a,o)}catch{o.isDecryptionFailure()&&o.once(mn.Decrypted,async()=>{i(a,o)})}}}getOrCreateMember(e,t){let r=this.members[e];return r||(r=new Cb(this.roomId,e),this.members[e]=r,this.emit("RoomState.newMember",t,this,r)),r}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var i;const t=Ib(e);if(this.beacons.has(t)){const s=this.beacons.get(t);if(e.isRedacted()){s.beaconInfoId===((i=e.getRedactionEvent())==null?void 0:i.redacts)&&(s.destroy(),this.beacons.delete(t));return}return s.update(e)}if(e.isRedacted())return;const r=new Yj(e);this.reEmitter.reEmit(r,[qn.New,qn.Update,qn.Destroy,qn.LivenessChange]),this.emit(qn.New,e,r),r.on(qn.LivenessChange,this.onBeaconLivenessChange.bind(this)),r.on(qn.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(r.identifier,r)}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit("RoomState.BeaconLiveness",this,this.hasLiveBeacons)}getStateEventMatching(e){var t;return((t=this.events.get(e.getType()))==null?void 0:t.get(e.getStateKey()))??null}updateMember(e){const t=this.getStateEvents(ie.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===0}outOfBandMembersReady(){return this.oobMemberFlags.status===2}markOutOfBandMembersStarted(){this.oobMemberFlags.status===0&&(this.oobMemberFlags.status=1)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===1&&(this.oobMemberFlags.status=0)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach(t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])}),O.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=0}setOutOfBandMembers(e){O.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===1&&(O.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=2,e.forEach(t=>this.setOutOfBandMember(t)),this.emit("RoomState.update",this))}setOutOfBandMember(e){if(e.getType()!==ie.RoomMember)return;const t=e.getStateKey(),r=this.getMember(t);if(r&&!r.isOutOfBand())return;const i=this.getOrCreateMember(t,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit("RoomState.members",e,this,i)}setTypingEvent(e){Object.values(this.members).forEach(function(t){t.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){return this.displayNameToUserIds.get($l(e))??[]}maySendRedactionForEvent(e,t){const r=this.getMember(t);return!r||r.membership===ze.Leave||e.status||e.isRedacted()||!this.maySendEvent(ie.RoomRedaction,t)?!1:e.getSender()===t?!0:this.hasSufficientPowerLevelFor("redact",r.powerLevel)}hasSufficientPowerLevelFor(e,t){const r=this.getStateEvents(ie.RoomPowerLevels,"");let i={};r&&(i=r.getContent());let s=50;return xO(i[e])&&(s=i[e]),t>=s}maySendMessage(e){return this.maySendEventOfType(ie.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return t.isGuest()||!t.credentials.userId?!1:this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,r){const i=this.getStateEvents(ie.RoomPowerLevels,"");let s,o={},a=0,c=0,l=0;if(i){s=i.getContent(),o=s.events||{},Number.isSafeInteger(s.state_default)?a=s.state_default:a=50;const h=s.users&&s.users[t];Number.isSafeInteger(h)?l=h:Number.isSafeInteger(s.users_default)&&(l=s.users_default),Number.isSafeInteger(s.events_default)&&(c=s.events_default)}let u=r?a:c;return Number.isSafeInteger(o[e])&&(u=o[e]),l>=u}mayTriggerNotifOfType(e,t){const r=this.getMember(t);if(!r)return!1;const i=this.getStateEvents(ie.RoomPowerLevels,"");let s=50;return i&&i.getContent()&&i.getContent().notifications&&xO(i.getContent().notifications[e])&&(s=i.getContent().notifications[e]),r.powerLevel>=s}getJoinRule(){const e=this.getStateEvents(ie.RoomJoinRules,"");return((e==null?void 0:e.getContent())??{}).join_rule||Sc.Invite}getHistoryVisibility(){const e=this.getStateEvents(ie.RoomHistoryVisibility,"");return((e==null?void 0:e.getContent())??{}).history_visibility||gw.Shared}getGuestAccess(){const e=this.getStateEvents(ie.RoomGuestAccess,"");return((e==null?void 0:e.getContent())??{}).guest_access||uv.Forbidden}findPredecessor(e=!1){if(e){const r=this.getStateEvents(ie.RoomPredecessor,"");if(r){const i=r.getContent(),s=i.predecessor_room_id;let o=i.last_known_event_id;typeof o!="string"&&(o=void 0);let a=i.via_servers;if(Array.isArray(a)||(a=void 0),typeof s=="string")return{roomId:s,eventId:o,viaServers:a}}}const t=this.getStateEvents(ie.RoomCreate,"");if(t){const r=t.getContent().predecessor;if(r){const i=r.room_id;if(typeof i=="string"){let s=r.event_id;return(typeof s!="string"||s==="")&&(s=void 0),{roomId:i,eventId:s}}}}return null}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const t=(e.getContent().third_party_invite.signed||{}).token;!t||!this.getStateEvents(ie.RoomThirdPartyInvite,t)||(this.tokenToInvite[t]=e)}updateDisplayNameCache(e,t){const r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){const s=$l(r),o=this.displayNameToUserIds.get(s);if(o){const a=o.filter(c=>c!==e);this.displayNameToUserIds.set(s,a)}}this.userIdsToDisplayNames[e]=t;const i=t&&$l(t);if(i){const s=this.displayNameToUserIds.get(i)??[];s.push(e),this.displayNameToUserIds.set(i,s)}}}function N5(n){return typeof n=="string"&&!!n&&n!=="undefined"&&n!=="null"||typeof n=="number"}class pv{constructor(e={}){this.rooms={},this.users={},this.syncToken=null,this.filters=new yc(()=>new Map),this.accountData=new Map,this.oobMembers=new Map,this.pendingEvents={},this.pendingToDeviceBatches=[],this.nextToDeviceBatchId=0,this.onRoomMember=(t,r,i)=>{var o;if(i.membership===ze.Invite)return;const s=this.users[i.userId]||((o=this.createUser)==null?void 0:o.call(this,i.userId));i.name&&(s.setDisplayName(i.name),i.events.member&&s.setRawDisplayName(i.events.member.getDirectionalContent().displayname)),i.events.member&&i.events.member.getContent().avatar_url&&s.setAvatarUrl(i.events.member.getContent().avatar_url),this.users[s.userId]=s},this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(kt.Members,this.onRoomMember),e.currentState.getMembers().forEach(t=>{this.onRoomMember(null,e.currentState,t)})}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(kt.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map(function(e){return e.summary})}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,r,i){}storeFilter(e){!(e!=null&&e.userId)||!(e!=null&&e.filterId)||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,t){var r;return((r=this.filters.get(e))==null?void 0:r.get(t))||null}getFilterIdByName(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const r=this.localStorage.getItem(t);if(N5(r))return r}catch{}return null}setFilterIdByName(e,t){if(!this.localStorage)return;const r="mxjssdk_memory_filter_"+e;try{N5(t)?this.localStorage.setItem(r,t):this.localStorage.removeItem(r)}catch{}}storeAccountDataEvents(e){e.forEach(t=>{!Object.keys(t.getContent()).length?this.accountData.delete(t.getType()):this.accountData.set(t.getType(),t)})}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new yc(()=>new Map),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,t){return this.oobMembers.set(e,t),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}async getPendingEvents(e){return this.pendingEvents[e]??[]}async setPendingEvents(e,t){this.pendingEvents[e]=t}saveToDeviceBatches(e){for(const t of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:t.eventType,txnId:t.txnId,batch:t.batch});return Promise.resolve()}async getOldestToDeviceBatch(){return this.pendingToDeviceBatches.length===0?null:this.pendingToDeviceBatches[0]}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(t=>t.id!==e),Promise.resolve()}async destroy(){}}var tB=(n=>(n.ToWidget="toWidget",n.FromWidget="fromWidget",n))(tB||{});function Voe(n){if(n==="toWidget")return"fromWidget";if(n==="fromWidget")return"toWidget";throw new Error("Invalid direction")}var bl=(n=>(n.MSC2762="org.matrix.msc2762",n.MSC2871="org.matrix.msc2871",n.MSC2873="org.matrix.msc2873",n.MSC2931="org.matrix.msc2931",n.MSC2974="org.matrix.msc2974",n.MSC2876="org.matrix.msc2876",n.MSC3819="org.matrix.msc3819",n.MSC3846="town.robin.msc3846",n.MSC3869="org.matrix.msc3869",n.MSC3973="org.matrix.msc3973",n.MSC4039="org.matrix.msc4039",n))(bl||{});const Goe=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2871","org.matrix.msc2873","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class qoe extends ow.EventEmitter{constructor(e,t,r,i){super(),this.sendDirection=e,this.initialWidgetId=t,this.transportWindow=r,this.inboundWindow=i,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this._widgetId=null,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=t}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let t=0,r=e;for(;this.outboundRequests.has(r);)r=`${e}-${t++}`;return this.outboundRequests.set(r,null),r}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,t){return this.sendInternal({...e,response:t})}send(e,t){return this.sendComplete(e,t).then(r=>r.response)}sendComplete(e,t){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const r={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:t};return e===fr.UpdateVisibility&&(r.visible=t.visible),new Promise((i,s)=>{const o=h=>{u(),i(h)},a=h=>{u(),s(h)},c=setTimeout(()=>a(new Error("Request timed out")),(this.timeoutSeconds||1)*1e3),l=()=>a(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",l);const u=()=>{this.outboundRequests.delete(r.requestId),clearTimeout(c),this.stopController.signal.removeEventListener("abort",l)};this.outboundRequests.set(r.requestId,{request:r,resolve:o,reject:a}),this.sendInternal(r)})}start(){this.inboundWindow.addEventListener("message",e=>{this.handleMessage(e)}),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==window.origin)return;const t=e.data;if(!(!t.action||!t.requestId||!t.widgetId))if(t.response){if(t.api!==this.sendDirection)return;this.handleResponse(t)}else{const r=t;if(r.api!==Voe(this.sendDirection))return;this.handleRequest(r)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const t=this.outboundRequests.get(e.requestId);if(t)if(Woe(e.response)){const{message:r,...i}=e.response.error;t.reject(new Ub(r,i))}else t.resolve(e)}}var fr=(n=>(n.SupportedApiVersions="supported_api_versions",n.Capabilities="capabilities",n.NotifyCapabilities="notify_capabilities",n.ThemeChange="theme_change",n.LanguageChange="language_change",n.TakeScreenshot="screenshot",n.UpdateVisibility="visibility",n.OpenIDCredentials="openid_credentials",n.WidgetConfig="widget_config",n.CloseModalWidget="close_modal",n.ButtonClicked="button_clicked",n.SendEvent="send_event",n.SendToDevice="send_to_device",n.UpdateTurnServers="update_turn_servers",n))(fr||{}),wn=(n=>(n.SupportedApiVersions="supported_api_versions",n.ContentLoaded="content_loaded",n.SendSticker="m.sticker",n.UpdateAlwaysOnScreen="set_always_on_screen",n.GetOpenIDCredentials="get_openid",n.CloseModalWidget="close_modal",n.OpenModalWidget="open_modal",n.SetModalButtonEnabled="set_button_enabled",n.SendEvent="send_event",n.SendToDevice="send_to_device",n.WatchTurnServers="watch_turn_servers",n.UnwatchTurnServers="unwatch_turn_servers",n.BeeperReadRoomAccountData="com.beeper.read_room_account_data",n.MSC2876ReadEvents="org.matrix.msc2876.read_events",n.MSC2931Navigate="org.matrix.msc2931.navigate",n.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",n.MSC3869ReadRelations="org.matrix.msc3869.read_relations",n.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",n.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",n.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",n.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",n.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",n))(wn||{}),ef=(n=>(n.Allowed="allowed",n.Blocked="blocked",n.PendingUserConfirmation="request",n))(ef||{}),nB=(n=>(n.Custom="m.custom",n.JitsiMeet="m.jitsi",n.Stickerpicker="m.stickerpicker",n))(nB||{}),rB=(n=>(n.Close="m.close",n))(rB||{}),aa=(n=>(n.Send="send",n.Receive="receive",n))(aa||{});class ci{constructor(e,t,r,i,s){this.direction=e,this.eventType=t,this.kind=r,this.keyStr=i,this.raw=s}matchesAsStateEvent(e,t,r){return this.kind!=="state_event"||this.direction!==e||this.eventType!==t?!1:this.keyStr===null||this.keyStr===r}matchesAsToDeviceEvent(e,t){return!(this.kind!=="to_device"||this.direction!==e||this.eventType!==t)}matchesAsRoomEvent(e,t,r=null){if(this.kind!=="event"||this.direction!==e||this.eventType!==t)return!1;if(this.eventType==="m.room.message"){if(this.keyStr===null||this.keyStr===r)return!0}else return!0;return!1}matchesAsRoomAccountData(e,t){return!(this.kind!=="room_account"||this.direction!==e||this.eventType!==t)}static forStateEvent(e,t,r){t=t.replace(/#/g,"\\#"),r=r!=null?`#${r}`:"";const i=`org.matrix.msc2762.${e}.state_event:${t}${r}`;return ci.findEventCapabilities([i])[0]}static forToDeviceEvent(e,t){const r=`org.matrix.msc3819.${e}.to_device:${t}`;return ci.findEventCapabilities([r])[0]}static forRoomEvent(e,t){const r=`org.matrix.msc2762.${e}.event:${t}`;return ci.findEventCapabilities([r])[0]}static forRoomMessageEvent(e,t){t=t??"";const r=`org.matrix.msc2762.${e}.event:m.room.message#${t}`;return ci.findEventCapabilities([r])[0]}static forRoomAccountData(e,t){const r=`com.beeper.capabilities.${e}.room_account_data:${t}`;return ci.findEventCapabilities([r])[0]}static findEventCapabilities(e){const t=[];for(const r of e){let i=null,s,o=null;if(r.startsWith("org.matrix.msc2762.send.event:")?(i="send",o="event",s=r.substring(30)):r.startsWith("org.matrix.msc2762.send.state_event:")?(i="send",o="state_event",s=r.substring(36)):r.startsWith("org.matrix.msc3819.send.to_device:")?(i="send",o="to_device",s=r.substring(34)):r.startsWith("org.matrix.msc2762.receive.event:")?(i="receive",o="event",s=r.substring(33)):r.startsWith("org.matrix.msc2762.receive.state_event:")?(i="receive",o="state_event",s=r.substring(39)):r.startsWith("org.matrix.msc3819.receive.to_device:")?(i="receive",o="to_device",s=r.substring(37)):r.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(i="receive",o="room_account",s=r.substring(50)),i===null||o===null||s===void 0)continue;const a=s.startsWith("m.room.message#")||o==="state_event";let c=null;if(s.includes("#")&&a){const l=s.split("#"),u=l.findIndex(h=>!h.endsWith("\\"));s=l.slice(0,u+1).map(h=>h.endsWith("\\")?h.substring(0,h.length-1):h).join("#"),c=l.slice(u+1).join("#")}t.push(new ci(i,s,o,c,r))}return t}}var Yu=(n=>(n.AnyRoom="*",n))(Yu||{});const ew=class ew extends Error{constructor(e,t){super(e),this.data=t}};ew.prototype.name=ew.name;let Ub=ew;class Koe extends ow.EventEmitter{constructor(e=null,t=null){if(super(),this.clientOrigin=t,this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new qoe(tB.FromWidget,e,window.parent,window),this.transport.targetOrigin=t,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){e.forEach(t=>this.requestCapability(t))}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,t){this.requestCapability(ci.forStateEvent(aa.Send,e,t).raw)}requestCapabilityToReceiveState(e,t){this.requestCapability(ci.forStateEvent(aa.Receive,e,t).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(ci.forToDeviceEvent(aa.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(ci.forToDeviceEvent(aa.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(ci.forRoomEvent(aa.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(ci.forRoomEvent(aa.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(ci.forRoomMessageEvent(aa.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(ci.forRoomMessageEvent(aa.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(ci.forRoomAccountData(aa.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise((e,t)=>{this.transport.sendComplete(wn.GetOpenIDCredentials,{}).then(r=>{const i=r.response;if(i.state===ef.Allowed)e(i);else if(i.state===ef.Blocked)t(new Error("User declined to verify their identity"));else if(i.state===ef.PendingUserConfirmation){const s=o=>{o.preventDefault();const a=o.detail;a.data.original_request_id===r.requestId&&(a.data.state===ef.Allowed?(e(a.data),this.transport.reply(a,{})):a.data.state===ef.Blocked?(t(new Error("User declined to verify their identity")),this.transport.reply(a,{})):(t(new Error("Invalid state on reply: "+i.state)),this.transport.reply(a,{error:{message:"Invalid state"}})),this.off(`action:${fr.OpenIDCredentials}`,s))};this.on(`action:${fr.OpenIDCredentials}`,s)}else t(new Error("Invalid state: "+i.state))}).catch(t)})}updateRequestedCapabilities(){return this.transport.send(wn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(wn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(wn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(wn.UpdateAlwaysOnScreen,{value:e}).then(t=>t.success)}openModalWidget(e,t,r=[],i={},s=nB.Custom){return this.transport.send(wn.OpenModalWidget,{type:s,url:e,name:t,buttons:r,data:i}).then()}closeModalWidget(e={}){return this.transport.send(wn.CloseModalWidget,e).then()}sendRoomEvent(e,t,r,i,s){return this.sendEvent(e,void 0,t,r,i,s)}sendStateEvent(e,t,r,i,s,o){return this.sendEvent(e,t,r,i,s,o)}sendEvent(e,t,r,i,s,o){return this.transport.send(wn.SendEvent,{type:e,content:r,...t!==void 0&&{state_key:t},...i!==void 0&&{room_id:i},...s!==void 0&&{delay:s},...o!==void 0&&{parent_delay_id:o}})}updateDelayedEvent(e,t){return this.transport.send(wn.MSC4157UpdateDelayedEvent,{delay_id:e,action:t})}sendToDevice(e,t,r){return this.transport.send(wn.SendToDevice,{type:e,encrypted:t,messages:r})}readRoomAccountData(e,t){const r={type:e};return t&&(t.includes(Yu.AnyRoom)?r.room_ids=Yu.AnyRoom:r.room_ids=t),this.transport.send(wn.BeeperReadRoomAccountData,r).then(i=>i.events)}readRoomEvents(e,t,r,i,s){const o={type:e,msgtype:r};return t!==void 0&&(o.limit=t),i&&(i.includes(Yu.AnyRoom)?o.room_ids=Yu.AnyRoom:o.room_ids=i),s&&(o.since=s),this.transport.send(wn.MSC2876ReadEvents,o).then(a=>a.events)}async readEventRelations(e,t,r,i,s,o,a,c){if(!(await this.getClientVersions()).includes(bl.MSC3869))throw new Error("The read_relations action is not supported by the client.");const u={event_id:e,rel_type:r,event_type:i,room_id:t,to:a,from:o,limit:s,direction:c};return this.transport.send(wn.MSC3869ReadRelations,u)}readStateEvents(e,t,r,i){const s={type:e,state_key:r===void 0?!0:r};return t!==void 0&&(s.limit=t),i&&(i.includes(Yu.AnyRoom)?s.room_ids=Yu.AnyRoom:s.room_ids=i),this.transport.send(wn.MSC2876ReadEvents,s).then(o=>o.events)}setModalButtonEnabled(e,t){if(e===rB.Close)throw new Error("The close button cannot be disabled");return this.transport.send(wn.SetModalButtonEnabled,{button:e,enabled:t}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(wn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const t=async r=>{r.preventDefault(),e(r.detail.data),await this.transport.reply(r.detail,{})};if(this.on(`action:${fr.UpdateTurnServers}`,t),this.turnServerWatchers===0)try{await this.transport.send(wn.WatchTurnServers,{})}catch(r){throw this.off(`action:${fr.UpdateTurnServers}`,t),r}this.turnServerWatchers++;try{for(;;)yield await new Promise(r=>e=r)}finally{this.off(`action:${fr.UpdateTurnServers}`,t),this.turnServerWatchers--,this.turnServerWatchers===0&&await this.transport.send(wn.UnwatchTurnServers,{})}}async searchUserDirectory(e,t){if(!(await this.getClientVersions()).includes(bl.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const i={search_term:e,limit:t};return this.transport.send(wn.MSC3973UserDirectorySearch,i)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(bl.MSC4039))throw new Error("The get_media_config action is not supported by the client.");const t={};return this.transport.send(wn.MSC4039GetMediaConfigAction,t)}async uploadFile(e){if(!(await this.getClientVersions()).includes(bl.MSC4039))throw new Error("The upload_file action is not supported by the client.");const r={file:e};return this.transport.send(wn.MSC4039UploadFileAction,r)}async downloadFile(e){if(!(await this.getClientVersions()).includes(bl.MSC4039))throw new Error("The download_file action is not supported by the client.");const r={content_uri:e};return this.transport.send(wn.MSC4039DownloadFileAction,r)}start(){this.transport.start(),this.getClientVersions().then(e=>{e.includes(bl.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)})}handleMessage(e){const t=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,t),!t.defaultPrevented)switch(e.detail.action){case fr.SupportedApiVersions:return this.replyVersions(e.detail);case fr.Capabilities:return this.handleCapabilities(e.detail);case fr.UpdateVisibility:return this.transport.reply(e.detail,{});case fr.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:Goe})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(wn.SupportedApiVersions,{}).then(e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions)).catch(e=>(console.warn("non-fatal error getting supported client versions: ",e),[]))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(t=>(t.includes(bl.MSC2871)?this.once(`action:${fr.NotifyCapabilities}`,r=>{this.approvedCapabilities=r.detail.data.approved,this.emit("ready")}):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities})))}}var xg=(n=>(n.Screenshots="m.capability.screenshot",n.StickerSending="m.sticker",n.AlwaysOnScreen="m.always_on_screen",n.RequiresClient="io.element.requires_client",n.MSC2931Navigate="org.matrix.msc2931.navigate",n.MSC3846TurnServers="town.robin.msc3846.turn_servers",n.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",n.MSC4039UploadFile="org.matrix.msc4039.upload_file",n.MSC4039DownloadFile="org.matrix.msc4039.download_file",n.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",n.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",n))(xg||{});function Woe(n){const e=n.error;return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}var iB=(n=>(n.PendingEventsChanged="PendingEvent.pendingEventsChanged",n))(iB||{});class sB extends dv{constructor(e,t,r,i,s){var c,l,u,h,p,m,v,g,S,b,R,k;super(i),this.widgetApi=e,this.capabilities=t,this.roomId=r,this.syncState=null,this.pendingSendingEventsTxId=[],this.eventEmitter=new Xn,this.updateTxId=async I=>{var T,C;if(I.getSender()===this.getUserId()&&this.pendingSendingEventsTxId.some(P=>I.getType()===P.type)){let P=(T=this.pendingSendingEventsTxId.find(M=>M.id===I.getId()))==null?void 0:T.txId;for(;!P&&this.pendingSendingEventsTxId.length>0;)await new Promise(M=>this.eventEmitter.once("PendingEvent.pendingEventsChanged",()=>M())),P=(C=this.pendingSendingEventsTxId.find(M=>M.id===I.getId()))==null?void 0:C.txId;P&&(I.setTxnId(P),I.setUnsigned({...I.getUnsigned(),transaction_id:P})),this.pendingSendingEventsTxId=this.pendingSendingEventsTxId.filter(M=>M.id!==I.getId()),this.pendingSendingEventsTxId.length===0&&this.eventEmitter.emit("PendingEvent.pendingEventsChanged")}},this.onEvent=async I=>{if(I.preventDefault(),I.detail.data.room_id===this.roomId){const T=new Ji(I.detail.data);await this.updateTxId(T),this.syncApi instanceof nd?await this.syncApi.injectRoomEvents(this.room,[],void 0,[T]):await this.syncApi.injectRoomEvents(this.room,[],[T]),this.emit(qe.Event,T),this.setSyncState(Lr.Syncing),O.info(`Received event ${T.getId()} ${T.getType()} ${T.getStateKey()}`)}else{const{event_id:T,room_id:C}=I.detail.data;O.info(`Received event ${T} for a different room ${C}; discarding`)}await this.ack(I)},this.onToDevice=async I=>{I.preventDefault();const T=new Ji({type:I.detail.data.type,sender:I.detail.data.sender,content:I.detail.data.content});I.detail.data.encrypted&&T.makeEncrypted(ie.RoomMessageEncrypted,{},"",""),this.emit(qe.ToDeviceEvent,T),this.setSyncState(Lr.Syncing),await this.ack(I)};const o=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=async(I,T)=>{try{return await o(I,T)}catch(C){D5(C)}};const a=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=async(I,T)=>{try{return await a(I,T)}catch(C){D5(C)}},this.widgetApiReady=new Promise(I=>this.widgetApi.once("ready",I)),((c=t.sendEvent)!=null&&c.length||(l=t.receiveEvent)!=null&&l.length||t.sendMessage===!0||Array.isArray(t.sendMessage)&&t.sendMessage.length||t.receiveMessage===!0||Array.isArray(t.receiveMessage)&&t.receiveMessage.length||(u=t.sendState)!=null&&u.length||(h=t.receiveState)!=null&&h.length)&&e.requestCapabilityForRoomTimeline(r),(p=t.sendEvent)==null||p.forEach(I=>e.requestCapabilityToSendEvent(I)),(m=t.receiveEvent)==null||m.forEach(I=>e.requestCapabilityToReceiveEvent(I)),t.sendMessage===!0?e.requestCapabilityToSendMessage():Array.isArray(t.sendMessage)&&t.sendMessage.forEach(I=>e.requestCapabilityToSendMessage(I)),t.receiveMessage===!0?e.requestCapabilityToReceiveMessage():Array.isArray(t.receiveMessage)&&t.receiveMessage.forEach(I=>e.requestCapabilityToReceiveMessage(I)),(v=t.sendState)==null||v.forEach(({eventType:I,stateKey:T})=>e.requestCapabilityToSendState(I,T)),(g=t.receiveState)==null||g.forEach(({eventType:I,stateKey:T})=>e.requestCapabilityToReceiveState(I,T)),(S=t.sendToDevice)==null||S.forEach(I=>e.requestCapabilityToSendToDevice(I)),(b=t.receiveToDevice)==null||b.forEach(I=>e.requestCapabilityToReceiveToDevice(I)),t.sendDelayedEvents&&((R=t.sendEvent)!=null&&R.length||t.sendMessage===!0||Array.isArray(t.sendMessage)&&t.sendMessage.length||(k=t.sendState)!=null&&k.length)&&e.requestCapability(xg.MSC4157SendDelayedEvent),t.updateDelayedEvents&&e.requestCapability(xg.MSC4157UpdateDelayedEvent),t.turnServers&&e.requestCapability(xg.MSC3846TurnServers),e.on(`action:${fr.SendEvent}`,this.onEvent),e.on(`action:${fr.SendToDevice}`,this.onToDevice),e.start(),s&&e.sendContentLoaded()}async startClient(e={}){var r;this.lifecycle=new AbortController;const t=this.getUserId();t&&this.store.storeUser(new _c(t)),e.slidingSync?this.syncApi=new F$(e.slidingSync,this,e,this.buildSyncApiOptions()):this.syncApi=new nd(this,e,this.buildSyncApiOptions()),this.room=this.syncApi.createRoom(this.roomId),this.store.storeRoom(this.room),await this.widgetApiReady,await Promise.all(((r=this.capabilities.receiveState)==null?void 0:r.map(async({eventType:i,stateKey:s})=>{const a=(await this.widgetApi.readStateEvents(i,void 0,s,[this.roomId])).map(c=>new Ji(c));this.syncApi instanceof nd?await this.syncApi.injectRoomEvents(this.room,void 0,a):await this.syncApi.injectRoomEvents(this.room,a),a.forEach(c=>{this.emit(qe.Event,c),O.info(`Backfilled event ${c.getId()} ${c.getType()} ${c.getStateKey()}`)})}))??[]),e.clientWellKnownPollPeriod!==void 0&&(this.clientWellKnownIntervalID=setInterval(()=>{this.fetchClientWellKnown()},1e3*e.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.setSyncState(Lr.Syncing),O.info("Finished backfilling events"),this.matrixRTC.start(),this.capabilities.turnServers&&this.watchTurnServers()}stopClient(){this.widgetApi.off(`action:${fr.SendEvent}`,this.onEvent),this.widgetApi.off(`action:${fr.SendToDevice}`,this.onToDevice),super.stopClient(),this.lifecycle.abort()}async joinRoom(e){if(e===this.roomId)return this.room;throw new Error(`Unknown room: ${e}`)}async encryptAndSendEvent(e,t,r){const i=t.event.redacts?{...t.getContent(),redacts:t.event.redacts}:t.getContent();if(r){const a=await this.widgetApi.sendRoomEvent(t.getType(),i,e.roomId,"delay"in r?r.delay:void 0,"parent_delay_id"in r?r.parent_delay_id:void 0).catch(na);return this.validateSendDelayedEventResponse(a)}const s=t.getTxnId();s&&this.pendingSendingEventsTxId.push({type:t.getType(),id:void 0,txId:s});let o;try{o=await this.widgetApi.sendRoomEvent(t.getType(),i,e.roomId).catch(na)}catch(a){throw this.updatePendingEventStatus(e,t,nt.NOT_SENT),a}return e.updatePendingEvent(t,nt.SENT,o.event_id),this.pendingSendingEventsTxId.forEach(a=>{a.txId===s&&(a.id=o.event_id)}),this.eventEmitter.emit("PendingEvent.pendingEventsChanged"),{event_id:o.event_id}}async sendStateEvent(e,t,r,i=""){const s=await this.widgetApi.sendStateEvent(t,i,r,e).catch(na);if(s.event_id===void 0)throw new Error("'event_id' absent from response to an event request");return{event_id:s.event_id}}async _unstable_sendDelayedStateEvent(e,t,r,i,s=""){if(!await this.doesServerSupportUnstableFeature(ga))throw new Ml("Server does not support the delayed events API","sendDelayedStateEvent");const o=await this.widgetApi.sendStateEvent(r,s,i,e,"delay"in t?t.delay:void 0,"parent_delay_id"in t?t.parent_delay_id:void 0).catch(na);return this.validateSendDelayedEventResponse(o)}validateSendDelayedEventResponse(e){if(e.delay_id===void 0)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}async _unstable_updateDelayedEvent(e,t){if(!await this.doesServerSupportUnstableFeature(ga))throw new Ml("Server does not support the delayed events API","updateDelayedEvent");return await this.widgetApi.updateDelayedEvent(e,t).catch(na),{}}async sendToDevice(e,t){return await this.widgetApi.sendToDevice(e,!1,ed(t)).catch(na),{}}async getOpenIdToken(){const e=await this.widgetApi.requestOpenIDConnectToken().catch(na);return{access_token:e.access_token,expires_in:e.expires_in,matrix_server_name:e.matrix_server_name,token_type:e.token_type}}async queueToDevice({eventType:e,batch:t}){const r=new yc(()=>new Map);for(const{userId:i,deviceId:s,payload:o}of t)r.getOrCreate(i).set(s,o);await this.widgetApi.sendToDevice(e,!1,ed(r)).catch(na)}async encryptAndSendToDevices(e,t){const r=new yc(()=>new Map);for(const{userId:i,deviceId:s}of e)r.getOrCreate(i).set(s,t);await this.widgetApi.sendToDevice(t.type,!0,ed(r)).catch(na)}async sendToDeviceViaWidgetApi(e,t,r){await this.widgetApi.sendToDevice(e,t,ed(r)).catch(na)}async checkTurnServers(){return this.turnServers.length>0}getSyncState(){return this.syncState}setSyncState(e){const t=this.syncState;this.syncState=e,this.emit(qe.Sync,e,t)}async ack(e){await this.widgetApi.transport.reply(e.detail,{})}async watchTurnServers(){const e=this.widgetApi.getTurnServers(),t=()=>{e.return(void 0)};this.lifecycle.signal.addEventListener("abort",t);try{for await(const r of e)this.turnServers=[{urls:r.uris,username:r.username,credential:r.password}],this.emit(qe.TurnServers,this.turnServers),O.log(`Received TURN server: ${r.uris}`)}catch(r){O.warn("Error watching TURN servers",r)}finally{this.lifecycle.signal.removeEventListener("abort",t)}}}function D5(n){throw n instanceof Ub&&n.data.matrix_api_error?gn.fromWidgetApiErrorData(n.data.matrix_api_error):n}function na(n){throw n instanceof Error&&n.message==="Request timed out"?new Vd("widget api timeout"):n}class zoe{constructor(){this.unthreadedReadReceipts=new Map,this.threadedReadReceipts=new yc(()=>new Map)}setUnthreaded(e,t){this.unthreadedReadReceipts.set(e,t)}setThreaded(e,t,r){this.threadedReadReceipts.getOrCreate(e).set(t,r)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(const e of this.threadedReadReceipts.values())for(const t of e.entries())yield t}consumeEphemeralEvents(e){e==null||e.forEach(t=>{t.type!==ie.Receipt||!t.content||Object.keys(t.content).forEach(r=>{Object.entries(t.content[r]).forEach(([i,s])=>{if(Qx(i))for(const o of Object.keys(s)){const a=t.content[r][i][o],c={data:t.content[r][i][o],type:i,eventId:r};a.thread_id?this.setThreaded(a.thread_id,o,c):this.setUnthreaded(o,c)}})})})}buildAccumulatedReceiptEvent(e){const t={type:ie.Receipt,room_id:e,content:{}},r=new yc(()=>new yc(()=>new Map));for(const[i,s]of this.allUnthreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);for(const[i,s]of this.allThreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);return t.content=ed(r),r.size>0?t:null}}var oB=(n=>(n.Invite="invite",n.Leave="leave",n.Join="join",n.Knock="knock",n))(oB||{});function Yoe(n){return"_localTs"in n&&n._localTs!==void 0}class aB{constructor(e={}){this.opts=e,this.accountData={},this.inviteRooms={},this.knockRooms={},this.joinRooms={},this.nextBatch=null,this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e,t=!1){this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach(t=>{this.accountData[t.type]=t})}accumulateRooms(e,t=!1){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(r=>{this.accumulateRoom(r,"invite",e.rooms.invite[r],t)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(r=>{this.accumulateRoom(r,"join",e.rooms.join[r],t)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(r=>{this.accumulateRoom(r,"leave",e.rooms.leave[r],t)}),e.rooms.knock&&Object.keys(e.rooms.knock).forEach(r=>{this.accumulateRoom(r,"knock",e.rooms.knock[r],t)}))}accumulateRoom(e,t,r,i=!1){switch(t){case"invite":this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,r);break;case"knock":this.accumulateKnockState(e,r);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,i);break;case"leave":this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:O.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e]){this.inviteRooms[e]={invite_state:t.invite_state};return}const r=this.inviteRooms[e];t.invite_state.events.forEach(i=>{let s=!1;for(let o=0;o<r.invite_state.events.length;o++){const a=r.invite_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.invite_state.events[o]=i,s=!0)}s||r.invite_state.events.push(i)})}accumulateKnockState(e,t){if(!t.knock_state||!t.knock_state.events)return;if(!this.knockRooms[e]){this.knockRooms[e]={knock_state:t.knock_state};return}const r=this.knockRooms[e];t.knock_state.events.forEach(i=>{let s=!1;for(let o=0;o<r.knock_state.events.length;o++){const a=r.knock_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.knock_state.events[o]=i,s=!0)}s||r.knock_state.events.push(i)})}accumulateJoinState(e,t,r=!1){var s,o,a,c,l,u,h;this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new zoe});const i=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach(p=>{i._accountData[p.type]=p}),t.unread_notifications&&(i._unreadNotifications=t.unread_notifications),i._unreadThreadNotifications=t[iv.stable]??t[iv.unstable]??void 0,t.summary){const p="m.heroes",m="m.invited_member_count",v="m.joined_member_count",g=i._summary,S=t.summary;g[p]=S[p]??g[p],g[v]=S[v]??g[v],g[m]=S[m]??g[m]}if(i._receipts.consumeEphemeralEvents((s=t.ephemeral)==null?void 0:s.events),t.timeline&&t.timeline.limited&&(i._timeline=[]),(a=(o=t.state)==null?void 0:o.events)==null||a.forEach(p=>{o1(i._currentState,p)}),(l=(c=t["org.matrix.msc4222.state_after"])==null?void 0:c.events)==null||l.forEach(p=>{o1(i._currentState,p)}),(h=(u=t.timeline)==null?void 0:u.events)==null||h.forEach((p,m)=>{var g;t["org.matrix.msc4222.state_after"]||o1(i._currentState,p);let v;if(r)v=p;else{v=Object.assign({},p),v.unsigned!==void 0&&(v.unsigned=Object.assign({},v.unsigned));const S=(g=p.unsigned)==null?void 0:g.age;S!==void 0&&(v._localTs=Date.now()-S)}i._timeline.push({event:v,token:m===0?t.timeline.prev_batch??null:null})}),i._timeline.length>this.opts.maxTimelineEntries){const p=i._timeline.length-this.opts.maxTimelineEntries;for(let m=p;m<i._timeline.length;m++)if(i._timeline[m].token){i._timeline=i._timeline.slice(m,i._timeline.length);break}}}getJSON(e=!1){const t={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach(i=>{t.invite[i]=this.inviteRooms[i]}),Object.keys(this.knockRooms).forEach(i=>{t.knock[i]=this.knockRooms[i]}),Object.keys(this.joinRooms).forEach(i=>{const s=this.joinRooms[i],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:s._unreadNotifications,unread_thread_notifications:s._unreadThreadNotifications,summary:s._summary};Object.keys(s._accountData).forEach(l=>{o.account_data.events.push(s._accountData[l])});const a=s._receipts.buildAccumulatedReceiptEvent(i);a&&o.ephemeral.events.push(a),s._timeline.forEach(l=>{if(!o.timeline.prev_batch){if(!l.token)return;o.timeline.prev_batch=l.token}let u;!e&&Yoe(l.event)?(u=Object.assign({},l.event),u.unsigned!==void 0&&(u.unsigned=Object.assign({},u.unsigned)),delete u._localTs,u.unsigned=u.unsigned||{},u.unsigned.age=Date.now()-l.event._localTs):u=l.event,o.timeline.events.push(u)});const c=Object.create(null);for(let l=o.timeline.events.length-1;l>=0;l--){const u=o.timeline.events[l];if(u.state_key===null||u.state_key===void 0)continue;const h=rw(u);h.unsigned&&(h.unsigned.prev_content&&(h.content=h.unsigned.prev_content),h.unsigned.prev_sender&&(h.sender=h.unsigned.prev_sender)),o1(c,h)}Object.keys(s._currentState).forEach(l=>{Object.keys(s._currentState[l]).forEach(u=>{let h=s._currentState[l][u];o["org.matrix.msc4222.state_after"].events.push(h),c[l]&&c[l][u]&&(h=c[l][u]),o.state.events.push(h)})}),t.join[i]=o});const r=[];return Object.keys(this.accountData).forEach(i=>{r.push(this.accountData[i])}),{nextBatch:this.nextBatch,roomsData:t,accountData:r}}getNextBatchToken(){return this.nextBatch}}function o1(n,e){e.state_key===null||e.state_key===void 0||!e.type||(n[e.type]||(n[e.type]=Object.create(null)),n[e.type][e.state_key]=e)}var cB=(n=>(n[n.Blocked=-1]="Blocked",n[n.Unverified=0]="Unverified",n[n.Verified=1]="Verified",n))(cB||{});class Xoe{constructor(e){this.dehydrated=!1,this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||0,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get(`ed25519:${this.deviceId}`)}getIdentityKey(){return this.keys.get(`curve25519:${this.deviceId}`)}}const F5=function(){},Joe=10;class Zoe{constructor(e,t,r={}){var i;this.client=e,this.timelineSet=t,this.eventCount=0,this.windowLimit=r.windowLimit||1e3,(i=t.room)==null||i.on(Je.Timeline,this.onTimelineEvent.bind(this))}load(e,t=20){const r=i=>{if(!i)throw new Error("No timeline given to initFields");let s;const o=i.getEvents();if(!e)s=o.length;else if(s=o.findIndex(l=>l.getId()===e),s<0)throw new Error("getEventTimeline result didn't include requested event");const a=Math.min(o.length,s+Math.ceil(t/2)),c=Math.max(0,a-t);this.start=new ck(i,c-i.getBaseIndex()),this.end=new ck(i,a-i.getBaseIndex()),this.eventCount=a-c};return this.timelineSet.getTimelineForEvent(e)?(r(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){if(e==$e.BACKWARDS)return this.start??null;if(e==$e.FORWARDS)return this.end??null;throw new Error("Invalid direction '"+e+"'")}extend(e,t){const r=this.getTimelineIndex(e);if(!r)return!1;const i=e==$e.BACKWARDS?r.retreat(t):r.advance(t);if(i){this.eventCount+=i,F5("TimelineWindow: increased cap by "+i+" (now "+this.eventCount+")");const s=this.eventCount-this.windowLimit;return s>0&&this.unpaginate(s,e!=$e.BACKWARDS),!0}return!1}onTimelineEvent(e,t,r,i){i&&this.onEventRemoved()}onEventRemoved(){const e=this.getEvents();e.length>0&&e[e.length-1]===void 0&&this.end&&this.end.index--}canPaginate(e){const t=this.getTimelineIndex(e);if(!t)return!1;if(e==$e.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;const r=t.timeline.getNeighbouringTimeline(e),i=t.timeline.getPaginationToken(e);return!!r||!!i}async paginate(e,t,r=!0,i=Joe){const s=this.getTimelineIndex(e);if(!s)return!1;if(s.pendingPaginate)return s.pendingPaginate;if(this.extend(e,t))return!0;if(!r||i===0||!s.timeline.getPaginationToken(e))return!1;const a=this.client.paginateEventTimeline(s.timeline,{backwards:e==$e.BACKWARDS,limit:t}).finally(function(){s.pendingPaginate=void 0}).then(c=>c?this.paginate(e,t,!0,i-1):this.paginate(e,t,!1,0));return s.pendingPaginate=a,a}unpaginate(e,t){const r=t?this.start:this.end;if(!r)throw new Error(`Attempting to unpaginate startOfTimeline=${t} but don't have this direction`);if(e>this.eventCount||e<0)throw new Error(`Attemting to unpaginate ${e} events, but only have ${this.eventCount} in the timeline`);for(;e>0;){const i=t?r.advance(e):r.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,F5("TimelineWindow.unpaginate: dropped "+i+" (now "+this.eventCount+")")}}getEvents(){var r,i;if(!this.start)return[];const e=[];let t=this.start.timeline;for(;t;){const s=t.getEvents();let o=0,a=s.length;t===this.start.timeline&&(o=this.start.index+t.getBaseIndex()),t===((r=this.end)==null?void 0:r.timeline)&&(a=this.end.index+t.getBaseIndex());for(let c=o;c<a;c++)e.push(s[c]);if(t===((i=this.end)==null?void 0:i.timeline))break;t=t.getNeighbouringTimeline($e.FORWARDS)}return e}}class ck{constructor(e,t){this.timeline=e,this.index=t}minIndex(){return this.timeline.getBaseIndex()*-1}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const r=this.timeline.getNeighbouringTimeline(e<0?$e.BACKWARDS:$e.FORWARDS);return r?(this.timeline=r,e<0?this.index=this.maxIndex():this.index=this.minIndex(),this.advance(e)):0}retreat(e){return this.advance(e*-1)*-1}}const Um="m.login.email.identity",U5="m.login.msisdn";var lB=(n=>(n.Password="m.login.password",n.Recaptcha="m.login.recaptcha",n.Terms="m.login.terms",n.Email="m.login.email.identity",n.Msisdn="m.login.msisdn",n.Sso="m.login.sso",n.SsoUnstable="org.matrix.login.sso",n.Dummy="m.login.dummy",n.RegistrationToken="m.login.registration_token",n.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",n))(lB||{});class uB extends Error{constructor(e,t,r){super(e),this.required_stages=t,this.flows=r,this.name="NoAuthFlowFoundError"}}class OP{constructor(e){this.requestingEmailToken=!1,this.attemptAuthDeferred=null,this.chosenFlow=null,this.currentStage=null,this.emailAttempt=1,this.submitPromise=null,this.requestEmailToken=async()=>{if(this.requestingEmailToken)O.warn("Could not request email token: Already requesting");else{O.trace("Requesting email token. Attempt: "+this.emailAttempt),this.requestingEmailToken=!0;try{const t=await this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,this.emailAttempt++,this.data.session);this.emailSid=t.sid,O.trace("Email token request succeeded")}finally{this.requestingEmailToken=!1}}},this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,e.supportedStages!==void 0&&(this.supportedStages=new Set(e.supportedStages))}async attemptAuth(){var t,r,i;this.attemptAuthDeferred=Xl();const e=this.attemptAuthDeferred.promise;if((r=(t=this.data)==null?void 0:t.flows)!=null&&r.length)this.startNextAuthStage();else{(i=this.busyChangedCallback)==null||i.call(this,!0);const s=this.data.session?{session:this.data.session}:null;this.doRequest(s).finally(()=>{var o;(o=this.busyChangedCallback)==null||o.call(this,!1)})}return e}async poll(){if(!this.data.session||!this.attemptAuthDeferred||this.submitPromise)return;let e={};if(this.currentStage==Um&&this.emailSid){const t={sid:this.emailSid,client_secret:this.clientSecret},r=this.matrixClient.getIdentityServerUrl();r&&(t.id_server=new URL(r).host),e={type:Um,threepid_creds:t}}this.submitAuthDict(e,!0)}getSessionId(){var e;return(e=this.data)==null?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var t,r;return(r=(t=this.data)==null?void 0:t.params)==null?void 0:r[e]}getChosenFlow(){return this.chosenFlow}async submitAuthDict(e,t=!1){var i,s,o;if(!this.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");for(t||(i=this.busyChangedCallback)==null||i.call(this,!0);this.submitPromise;)try{await this.submitPromise}catch{}let r;(s=this.data)!=null&&s.session?r=Object.assign({session:this.data.session},e):r=e;try{this.submitPromise=this.doRequest(r,t),await this.submitPromise}finally{this.submitPromise=null,t||(o=this.busyChangedCallback)==null||o.call(this,!1)}}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}async doRequest(e,t=!1){var r,i,s,o;try{const a=await this.requestCallback(e,t);this.attemptAuthDeferred.resolve(a),this.attemptAuthDeferred=null}catch(a){const c=a instanceof gn?a:null,l=((r=c==null?void 0:c.data)==null?void 0:r.flows)??null,u=((i=this.data)==null?void 0:i.flows)||!!l;(!c||c.httpStatus!==401||!c.data||!u)&&(t?O.log("Background poll request failed doing UI auth: ignoring",a):(s=this.attemptAuthDeferred)==null||s.reject(a)),c&&!c.data&&(c.data={}),c&&!c.data.flows&&!c.data.completed&&!c.data.session&&(c.data.flows=this.data.flows,c.data.completed=this.data.completed,c.data.session=this.data.session),c&&(this.data=c.data);try{this.startNextAuthStage()}catch(h){this.attemptAuthDeferred.reject(h),this.attemptAuthDeferred=null;return}if(!this.emailSid&&((o=this.chosenFlow)!=null&&o.stages.includes("m.login.email.identity")))try{await this.requestEmailToken()}catch(h){this.attemptAuthDeferred.reject(h),this.attemptAuthDeferred=null}}}startNextAuthStage(){var t,r,i,s;const e=this.chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this.currentStage=e,e==="m.login.dummy"){this.submitAuthDict({type:"m.login.dummy"});return}if((t=this.data)!=null&&t.errcode||(r=this.data)!=null&&r.error){this.stateUpdatedCallback(e,{errcode:((i=this.data)==null?void 0:i.errcode)||"",error:((s=this.data)==null?void 0:s.error)||""});return}this.stateUpdatedCallback(e,e===Um?{emailSid:this.emailSid}:{})}chooseStage(){this.chosenFlow===null&&(this.chosenFlow=this.chooseFlow()),O.log("Active flow => %s",JSON.stringify(this.chosenFlow));const e=this.firstUncompletedStage(this.chosenFlow);return O.log("Next stage: %s",e),e}scoreFlow(e){let t=e.stages.length;return this.supportedStages!==void 0&&(t+=e.stages.filter(r=>!this.supportedStages.has(r)).length*10),t}chooseFlow(){var s;const e=((s=this.data)==null?void 0:s.flows)||[],t=!!this.inputs.emailAddress||!!this.emailSid,r=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;e.sort((o,a)=>this.scoreFlow(o)-this.scoreFlow(a));for(const o of e){let a=!1,c=!1;for(const l of o.stages)l===Um?a=!0:l==U5&&(c=!0);if(a==t&&c==r)return o}const i=[];throw t&&i.push(Um),r&&i.push(U5),new uB("No appropriate authentication flow found",i,e)}firstUncompletedStage(e){var r;const t=((r=this.data)==null?void 0:r.completed)||[];return e.stages.find(i=>!t.includes(i))}}function dB(n,e){return new Promise((t,r)=>{let i=!0;const s=n.open(e);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>r(s.error),s.onsuccess=()=>{s.result.close(),i||n.deleteDatabase(e),t(i)},s.onerror=()=>r(s.error)})}const hB=[n=>{n.createObjectStore("users",{keyPath:["userId"]}),n.createObjectStore("accountData",{keyPath:["type"]}),n.createObjectStore("sync",{keyPath:["clobber"]})},n=>{n.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},n=>{n.createObjectStore("client_options",{keyPath:["clobber"]})},n=>{n.createObjectStore("to_device_queue",{autoIncrement:!0})}],Qoe=hB.length;function a1(n,e,t){const r=n.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r.error)==null?void 0:a.name)))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(t(a)),a.continue()}})}function $u(n){return new Promise((e,t)=>{n.oncomplete=function(r){e(r)},n.onerror=function(){t(n.error)}})}function fB(n){return new Promise((e,t)=>{n.onsuccess=function(r){e(r)},n.onerror=function(){t(n.error)}})}function eae(n){return new Promise((e,t)=>{n.onsuccess=()=>e(n),n.onerror=r=>t(r)})}function HT(n){return fB(n).then(e=>n.result)}class j5{constructor(e,t="default"){this.indexedDB=e,this.disconnected=!0,this._isNewlyCreated=!1,this.pendingUserPresenceData=[],this.dbName="matrix-js-sdk:"+t,this.syncAccumulator=new aB}static exists(e,t){return t="matrix-js-sdk:"+(t||"default"),dB(e,t)}connect(e){if(!this.disconnected)return O.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,O.log("LocalIndexedDBStoreBackend.connect: connecting...");const t=this.indexedDB.open(this.dbName,Qoe);return t.onupgradeneeded=r=>{const i=t.result,s=r.oldVersion;O.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${s}`),s<1&&(this._isNewlyCreated=!0),hB.forEach((o,a)=>{s<=a&&o(i)})},t.onblocked=()=>{O.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},O.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),fB(t).then(async()=>{O.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=t.result,this.db.onversionchange=()=>{var r;(r=this.db)==null||r.close(),this.disconnected=!0,this.db=void 0},this.db.onclose=()=>{this.disconnected=!0,this.db=void 0,e==null||e()},await this.init()})}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(([e,t])=>{O.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,account_data:{events:e}},!0)})}getOutOfBandMembers(e){return new Promise((t,r)=>{const o=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),a=IDBKeyRange.only(e),c=o.openCursor(a),l=[];let u=!1;c.onsuccess=()=>{const h=c.result;if(!h)return!l.length&&!u?t(null):t(l);const p=h.value;p.oob_written?u=!0:l.push(p),h.continue()},c.onerror=h=>{r(h)}}).then(t=>(O.log(`LL: got ${t==null?void 0:t.length} membershipEvents from storage for room ${e} ...`),t))}async setOutOfBandMembers(e,t){O.log(`LL: backend about to store ${t.length} members for ${e}`);const r=this.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events");t.forEach(o=>{i.put(o)});const s={room_id:e,oob_written:!0,state_key:0};i.put(s),await $u(r),O.log(`LL: backend done storing for ${e}!`)}async clearOutOfBandMembers(e){const i=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),s=IDBKeyRange.only(e),o=HT(i.openKeyCursor(s,"next")).then(m=>(m==null?void 0:m.primaryKey)[1]),a=HT(i.openKeyCursor(s,"prev")).then(m=>(m==null?void 0:m.primaryKey)[1]),[c,l]=await Promise.all([o,a]),h=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),p=IDBKeyRange.bound([e,c],[e,l]);O.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,c],[e,l]),await eae(h.delete(p))}clearDatabase(){return new Promise(e=>{var r;O.log(`Removing indexeddb instance: ${this.dbName}`),(r=this.db)==null||r.close();const t=this.indexedDB.deleteDatabase(this.dbName);t.onblocked=()=>{O.log(`can't yet delete indexeddb ${this.dbName} because it is open elsewhere`)},t.onerror=()=>{var i;O.warn(`unable to delete js-sdk store indexeddb: ${(i=t.error)==null?void 0:i.name}`),e()},t.onsuccess=()=>{O.log(`Removed indexeddb instance: ${this.dbName}`),e()}})}getSavedSync(e=!0){const t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(rw(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(e)})}async syncToDatabase(e){return this.syncToDatabasePromise?(O.warn("Skipping syncToDatabase() as persist already in flight"),this.pendingUserPresenceData.push(...e),this.syncToDatabasePromise):(e.unshift(...this.pendingUserPresenceData),this.syncToDatabasePromise=this.doSyncToDatabase(e),this.syncToDatabasePromise)}async doSyncToDatabase(e){try{const t=this.syncAccumulator.getJSON(!0);await Promise.all([this.persistUserPresenceEvents(e),this.persistAccountData(t.accountData),this.persistSyncData(t.nextBatch,t.roomsData)])}finally{this.syncToDatabasePromise=void 0}}persistSyncData(e,t){return O.log("Persisting sync data up to",e),kh(()=>{const r=this.db.transaction(["sync"],"readwrite");return r.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),$u(r).then(()=>{O.log("Persisted sync data up to",e)})})}persistAccountData(e){return kh(()=>{const t=this.db.transaction(["accountData"],"readwrite"),r=t.objectStore("accountData");for(const i of e)r.put(i);return $u(t).then()})}persistUserPresenceEvents(e){return kh(()=>{const t=this.db.transaction(["users"],"readwrite"),r=t.objectStore("users");for(const i of e)r.put({userId:i[0],event:i[1]});return $u(t).then()})}getUserPresenceEvents(){return kh(()=>{const t=this.db.transaction(["users"],"readonly").objectStore("users");return a1(t,void 0,r=>[r.value.userId,r.value.event])})}loadAccountData(){return O.log("LocalIndexedDBStoreBackend: loading account data..."),kh(()=>{const t=this.db.transaction(["accountData"],"readonly").objectStore("accountData");return a1(t,void 0,r=>r.value).then(r=>(O.log("LocalIndexedDBStoreBackend: loaded account data"),r))})}loadSyncData(){return O.log("LocalIndexedDBStoreBackend: loading sync data..."),kh(()=>{const t=this.db.transaction(["sync"],"readonly").objectStore("sync");return a1(t,void 0,r=>r.value).then(r=>(O.log("LocalIndexedDBStoreBackend: loaded sync data"),r.length>1&&O.warn("loadSyncData: More than 1 sync row found."),r.length>0?r[0]:{}))})}getClientOptions(){return Promise.resolve().then(()=>{const t=this.db.transaction(["client_options"],"readonly").objectStore("client_options");return a1(t,void 0,r=>{var i;return(i=r.value)==null?void 0:i.options}).then(r=>r[0])})}async storeClientOptions(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await $u(t)}async saveToDeviceBatches(e){const t=this.db.transaction(["to_device_queue"],"readwrite"),r=t.objectStore("to_device_queue");for(const i of e)r.add(i);await $u(t)}async getOldestToDeviceBatch(){const t=this.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),r=await HT(t.openCursor());if(!r)return null;const i=r.value;return{id:r.key,txnId:i.txnId,eventType:i.eventType,batch:i.batch}}async removeToDeviceBatch(e){const t=this.db.transaction(["to_device_queue"],"readwrite");t.objectStore("to_device_queue").delete(e),await $u(t)}async destroy(){var e;(e=this.db)==null||e.close()}}class tae{constructor(e,t){this.workerFactory=e,this.dbName=t,this.nextSeq=0,this.inFlight={},this.onWorkerMessage=r=>{var s;const i=r.data;if(i.command=="closed")(s=this.onClose)==null||s.call(this);else if(i.command=="cmd_success"||i.command=="cmd_fail"){if(i.seq===void 0){O.error("Got reply from worker with no seq");return}const o=this.inFlight[i.seq];if(o===void 0){O.error("Got reply for unknown seq "+i.seq);return}if(delete this.inFlight[i.seq],i.command=="cmd_success")o.resolve(i.result);else{const a=new Error(i.error.message);a.name=i.error.name,o.reject(a)}}else O.warn("Unrecognised message from worker: ",i)}}connect(e){return this.onClose=e,this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}async saveToDeviceBatches(e){return this.doCmd("saveToDeviceBatches",[e])}async getOldestToDeviceBatch(){return this.doCmd("getOldestToDeviceBatch")}async removeToDeviceBatch(e){return this.doCmd("removeToDeviceBatch",[e])}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{O.log("IndexedDB worker is ready")})),this.startPromise}doCmd(e,t){return Promise.resolve().then(()=>{var s;const r=this.nextSeq++,i=Xl();return this.inFlight[r]=i,(s=this.worker)==null||s.postMessage({command:e,seq:r,args:t}),i.promise})}async destroy(){var e;(e=this.worker)==null||e.terminate()}}const nae=1e3*60*5;class pB extends pv{constructor(e){if(super(e),this.startedUp=!1,this.syncTs=0,this.userModifiedMap={},this.emitter=new Xn,this.onClose=()=>{this.emitter.emit("closed")},this.getSavedSync=this.degradable(()=>this.backend.getSavedSync(),"getSavedSync"),this.isNewlyCreated=this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated"),this.getSavedSyncToken=this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken"),this.deleteAllData=this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{O.log("Deleted indexeddb data.")},t=>{throw O.error(`Failed to delete indexeddb data: ${t}`),t})),null),this.reallySave=this.degradable(()=>{this.syncTs=Date.now();const t=[];for(const r of this.getUsers())this.userModifiedMap[r.userId]!==r.getLastModifiedTime()&&r.events.presence&&(t.push([r.userId,r.events.presence.event]),this.userModifiedMap[r.userId]=r.getLastModifiedTime());return this.backend.syncToDatabase(t)},null),this.setSyncData=this.degradable(t=>this.backend.setSyncData(t),"setSyncData"),this.getOutOfBandMembers=this.degradable(t=>this.backend.getOutOfBandMembers(t),"getOutOfBandMembers"),this.setOutOfBandMembers=this.degradable((t,r)=>(super.setOutOfBandMembers(t,r),this.backend.setOutOfBandMembers(t,r)),"setOutOfBandMembers"),this.clearOutOfBandMembers=this.degradable(t=>(super.clearOutOfBandMembers(t),this.backend.clearOutOfBandMembers(t)),"clearOutOfBandMembers"),this.getClientOptions=this.degradable(()=>this.backend.getClientOptions(),"getClientOptions"),this.storeClientOptions=this.degradable(t=>(super.storeClientOptions(t),this.backend.storeClientOptions(t)),"storeClientOptions"),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new tae(e.workerFactory,e.dbName):this.backend=new j5(e.indexedDB,e.dbName)}static exists(e,t){return j5.exists(e,t)}on(e,t){this.emitter.on(e,t)}startup(){return this.startedUp?(O.log("IndexedDBStore.startup: already started"),Promise.resolve()):(O.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then(()=>(O.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{O.log("IndexedDBStore.startup: processing presence events"),e.forEach(([t,r])=>{if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");const i=this.createUser(t);r&&i.setPresenceEvent(new Ji(r)),this.userModifiedMap[i.userId]=i.getLastModifiedTime(),this.storeUser(i)}),this.startedUp=!0}))}destroy(){return this.backend.destroy()}wantsSave(){return Date.now()-this.syncTs>nae}save(e=!1){return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){const r=t?super[t]:null;return async(...i)=>{try{return await e.call(this,...i)}catch(s){O.error("IndexedDBStore failure, degrading to MemoryStore",s),this.emitter.emit("degraded",s);try{O.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),O.log("IndexedDBStore delete after degrading succeeded")}catch(o){O.warn("IndexedDBStore delete after degrading failed",o)}if(r)return r.call(this,...i)}}}async getPendingEvents(e){if(!this.localStorage)return super.getPendingEvents(e);const t=this.localStorage.getItem(VT(e));if(t)try{return JSON.parse(t)}catch(r){O.error("Could not parse persisted pending events",r)}return[]}async setPendingEvents(e,t){if(!this.localStorage)return super.setPendingEvents(e,t);t.length>0?this.localStorage.setItem(VT(e),JSON.stringify(t)):this.localStorage.removeItem(VT(e))}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function VT(n){return`mx_pending_events_${n}`}const Ho="crypto.",$5=Ho+"migration",GT=Ho+"account",rae=Ho+"cross_signing_keys",w_=Ho+"inboundgroupsessions/",iae=Ho+"inboundgroupsessions.withheld/",sae=Ho+"rooms/",qT=Ho+"sessionsneedingbackup";function Mh(n){return Ho+"sessions/"+n}function KT(n,e){return w_+n+"/"+e}function oae(n,e){return iae+n+"/"+e}function aae(n){return sae+n}class yw extends iw{constructor(e){super(),this.store=e}static exists(e){var r;const t=e.length;for(let i=0;i<t;i++)if((r=e.key(i))!=null&&r.startsWith(Ho))return!0;return!1}async containsData(){return yw.exists(this.store)}async getMigrationState(){return Ns(this.store,$5)??Id.NOT_STARTED}async setMigrationState(e){Bu(this.store,$5,e)}countEndToEndSessions(e,t){let r=0;for(let i=0;i<this.store.length;++i){const s=this.store.key(i);if(s!=null&&s.startsWith(Mh(""))){const o=Ns(this.store,s);r+=Object.keys(o??{}).length}}t(r)}_getEndToEndSessions(e){const t=Ns(this.store,Mh(e)),r={};for(const[i,s]of Object.entries(t||{}))typeof s=="string"?r[i]={session:s}:r[i]=s;return r}getEndToEndSession(e,t,r,i){const s=this._getEndToEndSessions(e);i(s[t]??{})}getEndToEndSessions(e,t,r){r(this._getEndToEndSessions(e)??{})}storeEndToEndSession(e,t,r,i){const s=this._getEndToEndSessions(e)||{};s[t]=r,Bu(this.store,Mh(e),s)}async getEndToEndSessionsBatch(){var t;const e=[];for(let r=0;r<this.store.length;++r)if((t=this.store.key(r))!=null&&t.startsWith(Mh(""))){const i=this.store.key(r).split("/")[1];for(const s of Object.values(this._getEndToEndSessions(i)))if(e.push(s),e.length>=Hf)return e}return e.length===0?null:e}async deleteEndToEndSessionsBatch(e){for(const{deviceKey:t,sessionId:r}of e){const i=this._getEndToEndSessions(t)||{};delete i[r],Object.keys(i).length===0?this.store.removeItem(Mh(t)):Bu(this.store,Mh(t),i)}}getEndToEndInboundGroupSession(e,t,r,i){i(Ns(this.store,KT(e,t)),Ns(this.store,oae(e,t)))}storeEndToEndInboundGroupSession(e,t,r,i){Bu(this.store,KT(e,t),r)}async countEndToEndInboundGroupSessions(){let e=0;for(let t=0;t<this.store.length;++t){const r=this.store.key(t);r!=null&&r.startsWith(w_)&&(e+=1)}return e}async getEndToEndInboundGroupSessionsBatch(){const e=Ns(this.store,qT)||{},t=[];for(let r=0;r<this.store.length;++r){const i=this.store.key(r);if(i!=null&&i.startsWith(w_)){const s=i.slice(w_.length);if(t.push({senderKey:s.slice(0,43),sessionId:s.slice(44),sessionData:Ns(this.store,i),needsBackup:s in e}),t.length>=Hf)return t}}return t.length===0?null:t}async deleteEndToEndInboundGroupSessionsBatch(e){for(const{senderKey:t,sessionId:r}of e){const i=KT(t,r);this.store.removeItem(i)}}getEndToEndRooms(e,t){const r={},i=aae("");for(let s=0;s<this.store.length;++s){const o=this.store.key(s);if(o!=null&&o.startsWith(i)){const a=o.slice(i.length);r[a]=Ns(this.store,o)}}t(r)}markSessionsNeedingBackup(e){const t=Ns(this.store,qT)||{};for(const r of e)t[r.senderKey+"/"+r.sessionId]=!0;return Bu(this.store,qT,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(GT),Promise.resolve()}getAccount(e,t){const r=Ns(this.store,GT);t(r)}storeAccount(e,t){Bu(this.store,GT,t)}getCrossSigningKeys(e,t){const r=Ns(this.store,rae);t(r)}getSecretStorePrivateKey(e,t,r){const i=Ns(this.store,Ho+`ssss_cache.${r}`);t(i)}storeSecretStorePrivateKey(e,t,r){Bu(this.store,Ho+`ssss_cache.${t}`,r)}doTxn(e,t,r){return Promise.resolve(r(null))}}function Ns(n,e){try{return JSON.parse(n.getItem(e))}catch(t){O.log("Error: Failed to get key %s: %s",e,t.message),O.log(t.stack)}return null}function Bu(n,e,t){n.setItem(e,JSON.stringify(t))}let cae=class{constructor(e){this.db=e,this.nextTxnId=0,e.onversionchange=()=>{O.log(`versionchange for indexeddb ${this.db.name}: closing`),e.close()}}async containsData(){throw Error("Not implemented for Backend")}async startup(){return this}async deleteAllData(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}async getMigrationState(){let e=Id.NOT_STARTED;return await this.doTxn("readonly",[tr.STORE_ACCOUNT],t=>{const i=t.objectStore(tr.STORE_ACCOUNT).get(PR);i.onsuccess=()=>{e=i.result??Id.NOT_STARTED}}),e}async setMigrationState(e){await this.doTxn("readwrite",[tr.STORE_ACCOUNT],t=>{t.objectStore(tr.STORE_ACCOUNT).put(e,PR)})}getAccount(e,t){const i=e.objectStore("account").get("-");i.onsuccess=function(){try{t(i.result||null)}catch(s){Di(e,s)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const i=e.objectStore("account").get("crossSigningKeys");i.onsuccess=function(){try{t(i.result||null)}catch(s){Di(e,s)}}}getSecretStorePrivateKey(e,t,r){const s=e.objectStore("account").get(`ssss_cache:${r}`);s.onsuccess=function(){try{t(s.result||null)}catch(o){Di(e,o)}}}storeSecretStorePrivateKey(e,t,r){e.objectStore("account").put(r,`ssss_cache:${t}`)}countEndToEndSessions(e,t){const i=e.objectStore("sessions").count();i.onsuccess=function(){try{t(i.result)}catch(s){Di(e,s)}}}getEndToEndSessions(e,t,r){const o=t.objectStore("sessions").index("deviceKey").openCursor(e),a={};o.onsuccess=function(){const c=o.result;if(c)a[c.value.sessionId]={session:c.value.session,lastReceivedMessageTs:c.value.lastReceivedMessageTs},c.continue();else try{r(a)}catch(l){Di(t,l)}}}getEndToEndSession(e,t,r,i){const o=r.objectStore("sessions").get([e,t]);o.onsuccess=function(){try{o.result?i({session:o.result.session,lastReceivedMessageTs:o.result.lastReceivedMessageTs}):i(null)}catch(a){Di(r,a)}}}storeEndToEndSession(e,t,r,i){i.objectStore("sessions").put({deviceKey:e,sessionId:t,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}async getEndToEndSessionsBatch(){const e=[];return await this.doTxn("readonly",[tr.STORE_SESSIONS],t=>{const i=t.objectStore(tr.STORE_SESSIONS).openCursor();i.onsuccess=function(){try{const s=i.result;s&&(e.push(s.value),e.length<Hf&&s.continue())}catch(s){Di(t,s)}}}),e.length===0?null:e}async deleteEndToEndSessionsBatch(e){await this.doTxn("readwrite",[tr.STORE_SESSIONS],async t=>{try{const r=t.objectStore(tr.STORE_SESSIONS);for(const{deviceKey:i,sessionId:s}of e){const o=r.delete([i,s]);await new Promise(a=>{o.onsuccess=a})}}catch(r){Di(t,r)}})}getEndToEndInboundGroupSession(e,t,r,i){let s=!1,o=!1;const c=r.objectStore("inbound_group_sessions").get([e,t]);c.onsuccess=function(){try{c.result?s=c.result.session:s=null,o!==!1&&i(s,o)}catch(h){Di(r,h)}};const u=r.objectStore("inbound_group_sessions_withheld").get([e,t]);u.onsuccess=function(){try{u.result?o=u.result.session:o=null,s!==!1&&i(s,o)}catch(h){Di(r,h)}}}storeEndToEndInboundGroupSession(e,t,r,i){i.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:r})}async countEndToEndInboundGroupSessions(){let e=0;return await this.doTxn("readonly",[tr.STORE_INBOUND_GROUP_SESSIONS],t=>{const i=t.objectStore(tr.STORE_INBOUND_GROUP_SESSIONS).count();i.onsuccess=()=>{e=i.result}}),e}async getEndToEndInboundGroupSessionsBatch(){const e=[];return await this.doTxn("readonly",[tr.STORE_INBOUND_GROUP_SESSIONS,tr.STORE_BACKUP],t=>{const r=t.objectStore(tr.STORE_INBOUND_GROUP_SESSIONS),i=t.objectStore(tr.STORE_BACKUP),s=r.openCursor();s.onsuccess=function(){try{const o=s.result;if(o){const a=i.get(o.key);a.onsuccess=()=>{e.push({senderKey:o.value.senderCurve25519Key,sessionId:o.value.sessionId,sessionData:o.value.session,needsBackup:a.result!==void 0}),e.length<Hf&&o.continue()}}}catch(o){Di(t,o)}}}),e.length===0?null:e}async deleteEndToEndInboundGroupSessionsBatch(e){await this.doTxn("readwrite",[tr.STORE_INBOUND_GROUP_SESSIONS],async t=>{try{const r=t.objectStore(tr.STORE_INBOUND_GROUP_SESSIONS);for(const{senderKey:i,sessionId:s}of e){const o=r.delete([i,s]);await new Promise(a=>{o.onsuccess=a})}}catch(r){Di(t,r)}})}getEndToEndDeviceData(e,t){const i=e.objectStore("device_data").get("-");i.onsuccess=function(){try{t(i.result||null)}catch(s){Di(e,s)}}}getEndToEndRooms(e,t){const r={},s=e.objectStore("rooms").openCursor();s.onsuccess=function(){const o=s.result;if(o)r[o.key]=o.value,o.continue();else try{t(r)}catch(a){Di(e,a)}}}async markSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const r=t.objectStore("sessions_needing_backup");await Promise.all(e.map(i=>new Promise((s,o)=>{const a=r.put({senderCurve25519Key:i.senderKey,sessionId:i.sessionId});a.onsuccess=s,a.onerror=o})))}doTxn(e,t,r,i=O){const s=this.db.transaction(t,e),o=dae(s),a=r(s);return o.then(()=>a)}};const mB=[n=>{uae(n)},n=>{n.createObjectStore("account")},n=>{n.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},n=>{n.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},n=>{n.createObjectStore("device_data")},n=>{n.createObjectStore("rooms")},n=>{n.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},n=>{n.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},n=>{n.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),n.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},n=>{n.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},n=>{n.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],gB=mB.length;function lae(n,e){O.log(`Upgrading IndexedDBCryptoStore from version ${e} to ${gB}`),mB.forEach((t,r)=>{e<=r&&t(n)})}function uae(n){const e=n.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});e.createIndex("session",["requestBody.room_id","requestBody.session_id"]),e.createIndex("state","state")}function Di(n,e){n._mx_abortexception=e;try{n.abort()}catch{}}function dae(n){return new Promise((e,t)=>{n.oncomplete=()=>{n._mx_abortexception!==void 0&&t(n._mx_abortexception),e(null)},n.onerror=r=>{n._mx_abortexception!==void 0?t(n._mx_abortexception):(O.log("Error performing indexeddb txn",r),t(n.error))},n.onabort=r=>{n._mx_abortexception!==void 0?t(n._mx_abortexception):(O.log("Error performing indexeddb txn",r),t(n.error))}})}const ai=class ai{constructor(e,t){this.indexedDB=e,this.dbName=t}static exists(e,t){return dB(e,t)}static existsAndIsNotMigrated(e,t){return new Promise((r,i)=>{let s=!0;const o=e.open(t);o.onupgradeneeded=()=>{s=!1},o.onblocked=()=>i(o.error),o.onsuccess=()=>{const a=o.result;if(!s)a.close(),e.deleteDatabase(t),r(!1);else{const u=a.transaction([ai.STORE_ACCOUNT],"readonly").objectStore(ai.STORE_ACCOUNT).get(PR);u.onsuccess=()=>{const h=u.result??Id.NOT_STARTED;r(h===Id.NOT_STARTED)},u.onerror=()=>{i(u.error)},a.close()}},o.onerror=()=>i(o.error)})}async containsData(){return ai.exists(this.indexedDB,this.dbName)}startup(){return this.backendPromise?this.backendPromise:(this.backendPromise=new Promise((e,t)=>{if(!this.indexedDB){t(new Error("no indexeddb support available"));return}O.log(`connecting to indexeddb ${this.dbName}`);const r=this.indexedDB.open(this.dbName,gB);r.onupgradeneeded=i=>{const s=r.result,o=i.oldVersion;lae(s,o)},r.onblocked=()=>{O.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{O.log("Error connecting to indexeddb",i),t(r.error)},r.onsuccess=()=>{const i=r.result;O.log(`connected to indexeddb ${this.dbName}`),e(new cae(i))}}).then(e=>e.doTxn("readonly",[ai.STORE_INBOUND_GROUP_SESSIONS,ai.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],t=>{e.getEndToEndInboundGroupSession("","",t,()=>{})}).then(()=>e)).catch(e=>{if(e.name==="VersionError")throw O.warn("Crypto DB is too new for us to use!",e),new Db(PP.TooNew);O.warn(`unable to connect to indexeddb ${this.dbName}: falling back to localStorage store: ${e}`);try{return new yw(globalThis.localStorage)}catch(t){return O.warn(`unable to open localStorage: falling back to in-memory store: ${t}`),new iw}}).then(e=>(this.backend=e,e)),this.backendPromise)}deleteAllData(){return new Promise((e,t)=>{if(!this.indexedDB){t(new Error("no indexeddb support available"));return}O.log(`Removing indexeddb instance: ${this.dbName}`);const r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{O.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{O.log("Error deleting data from indexeddb",i),t(r.error)},r.onsuccess=()=>{O.log(`Removed indexeddb instance: ${this.dbName}`),e()}}).catch(e=>{O.warn(`unable to delete IndexedDBCryptoStore: ${e}`)})}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,r){this.backend.getSecretStorePrivateKey(e,t,r)}storeSecretStorePrivateKey(e,t,r){this.backend.storeSecretStorePrivateKey(e,t,r)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,r,i){this.backend.getEndToEndSession(e,t,r,i)}getEndToEndSessions(e,t,r){this.backend.getEndToEndSessions(e,t,r)}storeEndToEndSession(e,t,r,i){this.backend.storeEndToEndSession(e,t,r,i)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,t,r,i){this.backend.getEndToEndInboundGroupSession(e,t,r,i)}storeEndToEndInboundGroupSession(e,t,r,i){this.backend.storeEndToEndInboundGroupSession(e,t,r,i)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}doTxn(e,t,r,i){return this.backend.doTxn(e,t,r,i)}};ai.STORE_ACCOUNT="account",ai.STORE_SESSIONS="sessions",ai.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",ai.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",ai.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS="shared_history_inbound_group_sessions",ai.STORE_PARKED_SHARED_HISTORY="parked_shared_history",ai.STORE_DEVICE_DATA="device_data",ai.STORE_ROOMS="rooms",ai.STORE_BACKUP="sessions_needing_backup";let tr=ai;var vB=(n=>(n.Email="email",n.Phone="msisdn",n))(vB||{});const hae=new jn("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility");var yB=(n=>(n.Gitlab="gitlab",n.Github="github",n.Apple="apple",n.Google="google",n.Facebook="facebook",n.Twitter="twitter",n))(yB||{}),_B=(n=>(n.LOGIN="login",n.REGISTER="register",n))(_B||{});const fae="us.cloke.msc4175.tz";class pae{constructor(e){this.relations=e.filter(t=>!!t)}getRelations(){return this.relations.reduce((e,t)=>[...e,...t.getRelations()],[])}on(e,t){this.relations.forEach(r=>r.on(e,t))}off(e,t){this.relations.forEach(r=>r.off(e,t))}}var bB=(n=>(n.Global="Global",n.SetItemError="setItem",n.GetItemError="getItem",n.RemoveItemError="removeItem",n.ClearError="clear",n.QuotaExceededError="QuotaExceededError",n))(bB||{});class mae extends Xn{}const gae=new mae;let SB=()=>new iw;function wB(n){SB=n}function EB(n){return n.store=n.store??new pv({localStorage:globalThis.localStorage}),n.scheduler=n.scheduler??new Gf,n.cryptoStore=n.cryptoStore??SB(),n}function _w(n){return new dv(EB(n))}function CB(n,e,t,r,i=!0){return new sB(n,e,t,EB(r),i)}const vae=Object.freeze(Object.defineProperty({__proto__:null,AuthType:lB,AutoDiscovery:lv,AutoDiscoveryAction:O$,AutoDiscoveryError:CP,Beacon:Yj,BeaconEvent:qn,CallEvent:Bi,CallFeedEvent:R$,Category:oB,ClientEvent:qe,ClientPrefix:ur,ClientStoppedError:boe,ConditionKind:Vn,ConditionOperator:M$,ConnectionError:Vd,ContentHelpers:Yre,DELEGATED_OIDC_COMPATIBILITY:hae,DEVICE_CODE_SCOPE:Moe,DMMemberCountCondition:$se,Device:Xoe,DeviceVerification:cB,Direction:St,DuplicateStrategy:Ig,EVENT_VISIBILITY_CHANGE_TYPE:td,EventEmitterEvents:tP,EventStatus:nt,EventTimeline:$e,EventTimelineSet:cf,EventType:ie,FILTER_RELATED_BY_REL_TYPES:Ef,FILTER_RELATED_BY_SENDERS:wf,FeatureSupport:ha,Filter:ys,GET_LOGIN_TOKEN_CAPABILITY:Uoe,GroupCall:wP,GroupCallEvent:Ab,GroupCallIntent:bP,GroupCallState:SP,GroupCallStatsReportEvent:x$,GroupCallType:fw,GuestAccess:uv,HTTPError:Zl,HistoryVisibility:gw,HttpApiEvent:Lb,IdentityPrefix:da,IdentityProviderBrand:yB,IndexedDBCryptoStore:tr,IndexedDBStore:pB,InteractiveAuth:OP,InvalidCryptoStoreError:Db,InvalidCryptoStoreState:PP,JoinRule:Sc,KNOWN_SAFE_ROOM_VERSION:y$,KeySignatureUploadError:_oe,KnownMembership:ze,LOCAL_NOTIFICATION_SETTINGS_PREFIX:Cj,LocalStorageCryptoStore:yw,LocalStorageErrors:bB,LocationAssetType:Ed,MAIN_ROOM_TIMELINE:ry,MAXIMUM_MATRIX_VERSION:Wse,MINIMUM_MATRIX_VERSION:Kse,MSC3912_RELATION_BASED_REDACTIONS_PROP:NR,M_ASSET:ty,M_BEACON:tk,M_BEACON_INFO:RP,M_HTML:Vre,M_LOCATION:ny,M_MESSAGE:Hre,M_POLL_END:Rb,M_POLL_KIND_DISCLOSED:Xre,M_POLL_KIND_UNDISCLOSED:Jre,M_POLL_RESPONSE:sv,M_POLL_START:Zre,M_TEXT:oP,M_TIMESTAMP:fu,M_TOPIC:aP,MatrixClient:dv,MatrixError:gn,MatrixEvent:Ji,MatrixEventEvent:mn,MatrixHttpApi:g$,MatrixScheduler:Gf,MediaHandlerEvent:D$,MediaPrefix:ld,MemoryCryptoStore:iw,MemoryStore:pv,Method:de,MsgType:zo,NoAuthFlowFoundError:uB,NotificationCountType:sr,OidcError:Kr,OidcTokenRefresher:Noe,PUSHER_DEVICE_ID:xre,PUSHER_ENABLED:DR,PendingEventOrdering:Rd,Poll:Zj,PollEvent:cP,Preset:oy,ProfileKeyMSC4175Timezone:fae,PushRuleActionName:bc,PushRuleKind:mr,REFERENCE_RELATION:Uj,ReceiptType:li,RelatedRelations:pae,RelationType:on,Relations:sP,RelationsEvent:Oj,RestrictedAllowType:N$,Room:dw,RoomCreateTypeField:wb,RoomEvent:Je,RoomMember:Cb,RoomMemberEvent:Fo,RoomNameType:_$,RoomState:fv,RoomStateEvent:kt,RoomSummary:Dj,RoomType:cd,RoomVersionStability:vP,RoomWidgetClient:sB,RoomWidgetClientEvent:iB,RuleId:pr,SERVICE_TYPES:Ob,SSOAction:_B,SUPPORTED_MATRIX_VERSIONS:cv,SearchOrderBy:IP,SearchResult:mw,SecretStorage:voe,ServerCapabilities:v$,SetPresence:b$,SlidingSyncEvent:Nb,StatsReport:wa,SyncAccumulator:aB,SyncState:Lr,THREAD_RELATION_TYPE:tn,Thread:Gr,ThreadEvent:Ro,ThreadFilterType:To,ThreepidMedium:vB,TimelineIndex:ck,TimelineWindow:Zoe,ToDeviceMessageId:aw,TokenRefreshError:c$,TweakName:pw,TypedEventEmitter:Xn,UNSIGNED_MEMBERSHIP_FIELD:Tj,UNSIGNED_THREAD_ID_FIELD:Eb,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:Ej,UNSTABLE_MSC2666_MUTUAL_ROOMS:X$,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:J$,UNSTABLE_MSC2666_SHARED_ROOMS:Y$,UNSTABLE_MSC2716_MARKER:wj,UNSTABLE_MSC3088_ENABLED:MR,UNSTABLE_MSC3088_PURPOSE:AR,UNSTABLE_MSC3089_BRANCH:uc,UNSTABLE_MSC3089_LEAF:Sj,UNSTABLE_MSC3089_TREE_SUBTYPE:OR,UNSTABLE_MSC3852_LAST_SEEN_UA:Foe,UNSTABLE_MSC4133_EXTENDED_PROFILES:Z$,UNSTABLE_MSC4140_DELAYED_EVENTS:ga,UnsupportedDelayedEventsEndpointError:Ml,UpdateDelayedEventAction:Bl,User:_c,UserEvent:Ll,Visibility:TP,anySignal:l$,calculateRetryBackoff:u$,completeAuthorizationCodeGrant:Aoe,createClient:_w,createNewMatrixCall:av,createRoomWidgetClient:CB,decodeBase64:_f,decodeIdToken:q$,determineFeatureSupport:S_,discoverAndValidateOIDCIssuerWellKnown:AP,encodeBase64:y_,encodeUnpaddedBase64:T$,encodeUnpaddedBase64Url:hw,fixNotificationCountOnDecryption:Q$,generateAuthorizationParams:koe,generateAuthorizationUrl:xoe,generateOidcAuthorizationUrl:Poe,generateScope:vw,getBeaconInfoIdentifier:Ib,getHttpUriForMxc:sw,inMainTimelineForReceipt:hv,isDmMemberCountCondition:Bse,isEventTypeSame:Gre,isPollEvent:Qj,isTimestampInDuration:UR,localStorageErrorsEventsEmitter:gae,parseErrorResponse:pP,registerOidcClient:Ooe,retryNetworkOperation:KR,safeGetRetryAfterMs:fP,setCryptoStoreFactory:wB,threadFilterTypeToFilter:eB,threadIdForReceipt:qf,timeoutSignal:lw,validateAuthMetadata:G$,validateAuthMetadataAndKeys:MP,validateBearerTokenResponse:z$,validateIdToken:K$,validateStoredUserState:W$},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");globalThis.__js_sdk_entrypoint=!0;let lk;try{lk=globalThis.indexedDB}catch{}lk&&wB(()=>new tr(lk,"matrix-js-sdk:crypto"));globalThis.matrixcs=vae;var _=Zx();const Re=Wo(_),TB=Zne({__proto__:null,default:Re},[_]);var c1={},WT={exports:{}},Fi={},zT={exports:{}},YT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B5;function yae(){return B5||(B5=1,function(n){function e(G,K){var ee=G.length;G.push(K);e:for(;0<ee;){var q=ee-1>>>1,Q=G[q];if(0<i(Q,K))G[q]=K,G[ee]=Q,ee=q;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var K=G[0],ee=G.pop();if(ee!==K){G[0]=ee;e:for(var q=0,Q=G.length,Se=Q>>>1;q<Se;){var Ie=2*(q+1)-1,Ne=G[Ie],Le=Ie+1,xe=G[Le];if(0>i(Ne,ee))Le<Q&&0>i(xe,Ne)?(G[q]=xe,G[Le]=ee,q=Le):(G[q]=Ne,G[Ie]=ee,q=Ie);else if(Le<Q&&0>i(xe,ee))G[q]=xe,G[Le]=ee,q=Le;else break e}}return K}function i(G,K){var ee=G.sortIndex-K.sortIndex;return ee!==0?ee:G.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,p=3,m=!1,v=!1,g=!1,S=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(G){for(var K=t(l);K!==null;){if(K.callback===null)r(l);else if(K.startTime<=G)r(l),K.sortIndex=K.expirationTime,e(c,K);else break;K=t(l)}}function I(G){if(g=!1,k(G),!v)if(t(c)!==null)v=!0,J(T);else{var K=t(l);K!==null&&Y(I,K.startTime-G)}}function T(G,K){v=!1,g&&(g=!1,b(M),M=-1),m=!0;var ee=p;try{for(k(K),h=t(c);h!==null&&(!(h.expirationTime>K)||G&&!U());){var q=h.callback;if(typeof q=="function"){h.callback=null,p=h.priorityLevel;var Q=q(h.expirationTime<=K);K=n.unstable_now(),typeof Q=="function"?h.callback=Q:h===t(c)&&r(c),k(K)}else r(c);h=t(c)}if(h!==null)var Se=!0;else{var Ie=t(l);Ie!==null&&Y(I,Ie.startTime-K),Se=!1}return Se}finally{h=null,p=ee,m=!1}}var C=!1,P=null,M=-1,D=5,F=-1;function U(){return!(n.unstable_now()-F<D)}function B(){if(P!==null){var G=n.unstable_now();F=G;var K=!0;try{K=P(!0,G)}finally{K?V():(C=!1,P=null)}}else C=!1}var V;if(typeof R=="function")V=function(){R(B)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,H=z.port2;z.port1.onmessage=B,V=function(){H.postMessage(null)}}else V=function(){S(B,0)};function J(G){P=G,C||(C=!0,V())}function Y(G,K){M=S(function(){G(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){v||m||(v=!0,J(T))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(G){switch(p){case 1:case 2:case 3:var K=3;break;default:K=p}var ee=p;p=K;try{return G()}finally{p=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,K){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var ee=p;p=G;try{return K()}finally{p=ee}},n.unstable_scheduleCallback=function(G,K,ee){var q=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?q+ee:q):ee=q,G){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=ee+Q,G={id:u++,callback:K,priorityLevel:G,startTime:ee,expirationTime:Q,sortIndex:-1},ee>q?(G.sortIndex=ee,e(l,G),t(c)===null&&G===t(l)&&(g?(b(M),M=-1):g=!0,Y(I,ee-q))):(G.sortIndex=Q,e(c,G),v||m||(v=!0,J(T))),G},n.unstable_shouldYield=U,n.unstable_wrapCallback=function(G){var K=p;return function(){var ee=p;p=K;try{return G.apply(this,arguments)}finally{p=ee}}}}(YT)),YT}var H5;function _ae(){return H5||(H5=1,zT.exports=yae()),zT.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V5;function bae(){if(V5)return Fi;V5=1;var n=Zx(),e=_ae();function t(d){for(var f="https://reactjs.org/docs/error-decoder.html?invariant="+d,y=1;y<arguments.length;y++)f+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(d,f){o(d,f),o(d+"Capture",f)}function o(d,f){for(i[d]=f,d=0;d<f.length;d++)r.add(f[d])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,l=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function p(d){return c.call(h,d)?!0:c.call(u,d)?!1:l.test(d)?h[d]=!0:(u[d]=!0,!1)}function m(d,f,y,E){if(y!==null&&y.type===0)return!1;switch(typeof f){case"function":case"symbol":return!0;case"boolean":return E?!1:y!==null?!y.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function v(d,f,y,E){if(f===null||typeof f>"u"||m(d,f,y,E))return!0;if(E)return!1;if(y!==null)switch(y.type){case 3:return!f;case 4:return f===!1;case 5:return isNaN(f);case 6:return isNaN(f)||1>f}return!1}function g(d,f,y,E,x,A,j){this.acceptsBooleans=f===2||f===3||f===4,this.attributeName=E,this.attributeNamespace=x,this.mustUseProperty=y,this.propertyName=d,this.type=f,this.sanitizeURL=A,this.removeEmptyString=j}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){S[d]=new g(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var f=d[0];S[f]=new g(f,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){S[d]=new g(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){S[d]=new g(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){S[d]=new g(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){S[d]=new g(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){S[d]=new g(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){S[d]=new g(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){S[d]=new g(d,5,!1,d.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function R(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var f=d.replace(b,R);S[f]=new g(f,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var f=d.replace(b,R);S[f]=new g(f,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var f=d.replace(b,R);S[f]=new g(f,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){S[d]=new g(d,1,!1,d.toLowerCase(),null,!1,!1)}),S.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){S[d]=new g(d,1,!1,d.toLowerCase(),null,!0,!0)});function k(d,f,y,E){var x=S.hasOwnProperty(f)?S[f]:null;(x!==null?x.type!==0:E||!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(v(f,y,x,E)&&(y=null),E||x===null?p(f)&&(y===null?d.removeAttribute(f):d.setAttribute(f,""+y)):x.mustUseProperty?d[x.propertyName]=y===null?x.type===3?!1:"":y:(f=x.attributeName,E=x.attributeNamespace,y===null?d.removeAttribute(f):(x=x.type,y=x===3||x===4&&y===!0?"":""+y,E?d.setAttributeNS(E,f,y):d.setAttribute(f,y))))}var I=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),C=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),U=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),Y=Symbol.for("react.offscreen"),G=Symbol.iterator;function K(d){return d===null||typeof d!="object"?null:(d=G&&d[G]||d["@@iterator"],typeof d=="function"?d:null)}var ee=Object.assign,q;function Q(d){if(q===void 0)try{throw Error()}catch(y){var f=y.stack.trim().match(/\n( *(at )?)/);q=f&&f[1]||""}return`
`+q+d}var Se=!1;function Ie(d,f){if(!d||Se)return"";Se=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(f)if(f=function(){throw Error()},Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(le){var E=le}Reflect.construct(d,[],f)}else{try{f.call()}catch(le){E=le}d.call(f.prototype)}else{try{throw Error()}catch(le){E=le}d()}}catch(le){if(le&&E&&typeof le.stack=="string"){for(var x=le.stack.split(`
`),A=E.stack.split(`
`),j=x.length-1,X=A.length-1;1<=j&&0<=X&&x[j]!==A[X];)X--;for(;1<=j&&0<=X;j--,X--)if(x[j]!==A[X]){if(j!==1||X!==1)do if(j--,X--,0>X||x[j]!==A[X]){var te=`
`+x[j].replace(" at new "," at ");return d.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",d.displayName)),te}while(1<=j&&0<=X);break}}}finally{Se=!1,Error.prepareStackTrace=y}return(d=d?d.displayName||d.name:"")?Q(d):""}function Ne(d){switch(d.tag){case 5:return Q(d.type);case 16:return Q("Lazy");case 13:return Q("Suspense");case 19:return Q("SuspenseList");case 0:case 2:case 15:return d=Ie(d.type,!1),d;case 11:return d=Ie(d.type.render,!1),d;case 1:return d=Ie(d.type,!0),d;default:return""}}function Le(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case P:return"Fragment";case C:return"Portal";case D:return"Profiler";case M:return"StrictMode";case V:return"Suspense";case z:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case U:return(d.displayName||"Context")+".Consumer";case F:return(d._context.displayName||"Context")+".Provider";case B:var f=d.render;return d=d.displayName,d||(d=f.displayName||f.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case H:return f=d.displayName||null,f!==null?f:Le(d.type)||"Memo";case J:f=d._payload,d=d._init;try{return Le(d(f))}catch{}}return null}function xe(d){var f=d.type;switch(d.tag){case 24:return"Cache";case 9:return(f.displayName||"Context")+".Consumer";case 10:return(f._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=f.render,d=d.displayName||d.name||"",f.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return f;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Le(f);case 8:return f===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f}return null}function Ee(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Ce(d){var f=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Ve(d){var f=Ce(d)?"checked":"value",y=Object.getOwnPropertyDescriptor(d.constructor.prototype,f),E=""+d[f];if(!d.hasOwnProperty(f)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var x=y.get,A=y.set;return Object.defineProperty(d,f,{configurable:!0,get:function(){return x.call(this)},set:function(j){E=""+j,A.call(this,j)}}),Object.defineProperty(d,f,{enumerable:y.enumerable}),{getValue:function(){return E},setValue:function(j){E=""+j},stopTracking:function(){d._valueTracker=null,delete d[f]}}}}function vt(d){d._valueTracker||(d._valueTracker=Ve(d))}function Jt(d){if(!d)return!1;var f=d._valueTracker;if(!f)return!0;var y=f.getValue(),E="";return d&&(E=Ce(d)?d.checked?"true":"false":d.value),d=E,d!==y?(f.setValue(d),!0):!1}function Et(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function Be(d,f){var y=f.checked;return ee({},f,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??d._wrapperState.initialChecked})}function Zn(d,f){var y=f.defaultValue==null?"":f.defaultValue,E=f.checked!=null?f.checked:f.defaultChecked;y=Ee(f.value!=null?f.value:y),d._wrapperState={initialChecked:E,initialValue:y,controlled:f.type==="checkbox"||f.type==="radio"?f.checked!=null:f.value!=null}}function In(d,f){f=f.checked,f!=null&&k(d,"checked",f,!1)}function Qn(d,f){In(d,f);var y=Ee(f.value),E=f.type;if(y!=null)E==="number"?(y===0&&d.value===""||d.value!=y)&&(d.value=""+y):d.value!==""+y&&(d.value=""+y);else if(E==="submit"||E==="reset"){d.removeAttribute("value");return}f.hasOwnProperty("value")?pi(d,f.type,y):f.hasOwnProperty("defaultValue")&&pi(d,f.type,Ee(f.defaultValue)),f.checked==null&&f.defaultChecked!=null&&(d.defaultChecked=!!f.defaultChecked)}function os(d,f,y){if(f.hasOwnProperty("value")||f.hasOwnProperty("defaultValue")){var E=f.type;if(!(E!=="submit"&&E!=="reset"||f.value!==void 0&&f.value!==null))return;f=""+d._wrapperState.initialValue,y||f===d.value||(d.value=f),d.defaultValue=f}y=d.name,y!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,y!==""&&(d.name=y)}function pi(d,f,y){(f!=="number"||Et(d.ownerDocument)!==d)&&(y==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+y&&(d.defaultValue=""+y))}var Dr=Array.isArray;function Qr(d,f,y,E){if(d=d.options,f){f={};for(var x=0;x<y.length;x++)f["$"+y[x]]=!0;for(y=0;y<d.length;y++)x=f.hasOwnProperty("$"+d[y].value),d[y].selected!==x&&(d[y].selected=x),x&&E&&(d[y].defaultSelected=!0)}else{for(y=""+Ee(y),f=null,x=0;x<d.length;x++){if(d[x].value===y){d[x].selected=!0,E&&(d[x].defaultSelected=!0);return}f!==null||d[x].disabled||(f=d[x])}f!==null&&(f.selected=!0)}}function br(d,f){if(f.dangerouslySetInnerHTML!=null)throw Error(t(91));return ee({},f,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function ki(d,f){var y=f.value;if(y==null){if(y=f.children,f=f.defaultValue,y!=null){if(f!=null)throw Error(t(92));if(Dr(y)){if(1<y.length)throw Error(t(93));y=y[0]}f=y}f==null&&(f=""),y=f}d._wrapperState={initialValue:Ee(y)}}function xi(d,f){var y=Ee(f.value),E=Ee(f.defaultValue);y!=null&&(y=""+y,y!==d.value&&(d.value=y),f.defaultValue==null&&d.defaultValue!==y&&(d.defaultValue=y)),E!=null&&(d.defaultValue=""+E)}function ei(d){var f=d.textContent;f===d._wrapperState.initialValue&&f!==""&&f!==null&&(d.value=f)}function ht(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $(d,f){return d==null||d==="http://www.w3.org/1999/xhtml"?ht(f):d==="http://www.w3.org/2000/svg"&&f==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var L,N=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(f,y,E,x){MSApp.execUnsafeLocalFunction(function(){return d(f,y,E,x)})}:d}(function(d,f){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=f;else{for(L=L||document.createElement("div"),L.innerHTML="<svg>"+f.valueOf().toString()+"</svg>",f=L.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;f.firstChild;)d.appendChild(f.firstChild)}});function W(d,f){if(f){var y=d.firstChild;if(y&&y===d.lastChild&&y.nodeType===3){y.nodeValue=f;return}}d.textContent=f}var ne={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ce=["Webkit","ms","Moz","O"];Object.keys(ne).forEach(function(d){ce.forEach(function(f){f=f+d.charAt(0).toUpperCase()+d.substring(1),ne[f]=ne[d]})});function ge(d,f,y){return f==null||typeof f=="boolean"||f===""?"":y||typeof f!="number"||f===0||ne.hasOwnProperty(d)&&ne[d]?(""+f).trim():f+"px"}function dt(d,f){d=d.style;for(var y in f)if(f.hasOwnProperty(y)){var E=y.indexOf("--")===0,x=ge(y,f[y],E);y==="float"&&(y="cssFloat"),E?d.setProperty(y,x):d[y]=x}}var Zt=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ft(d,f){if(f){if(Zt[d]&&(f.children!=null||f.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(f.dangerouslySetInnerHTML!=null){if(f.children!=null)throw Error(t(60));if(typeof f.dangerouslySetInnerHTML!="object"||!("__html"in f.dangerouslySetInnerHTML))throw Error(t(61))}if(f.style!=null&&typeof f.style!="object")throw Error(t(62))}}function Qt(d,f){if(d.indexOf("-")===-1)return typeof f.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pt=null;function it(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Lt=null,At=null,yt=null;function _n(d){if(d=cm(d)){if(typeof Lt!="function")throw Error(t(280));var f=d.stateNode;f&&(f=d0(f),Lt(d.stateNode,d.type,f))}}function Fr(d){At?yt?yt.push(d):yt=[d]:At=d}function Sr(){if(At){var d=At,f=yt;if(yt=At=null,_n(d),f)for(d=0;d<f.length;d++)_n(f[d])}}function ao(d,f){return d(f)}function Pi(){}var co=!1;function lo(d,f,y){if(co)return d(f,y);co=!0;try{return ao(d,f,y)}finally{co=!1,(At!==null||yt!==null)&&(Pi(),Sr())}}function ti(d,f){var y=d.stateNode;if(y===null)return null;var E=d0(y);if(E===null)return null;y=E[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(d=d.type,E=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!E;break e;default:d=!1}if(d)return null;if(y&&typeof y!="function")throw Error(t(231,f,typeof y));return y}var qc=!1;if(a)try{var Kc={};Object.defineProperty(Kc,"passive",{get:function(){qc=!0}}),window.addEventListener("test",Kc,Kc),window.removeEventListener("test",Kc,Kc)}catch{qc=!1}function ite(d,f,y,E,x,A,j,X,te){var le=Array.prototype.slice.call(arguments,3);try{f.apply(y,le)}catch(be){this.onError(be)}}var Vp=!1,Vy=null,Gy=!1,FE=null,ste={onError:function(d){Vp=!0,Vy=d}};function ote(d,f,y,E,x,A,j,X,te){Vp=!1,Vy=null,ite.apply(ste,arguments)}function ate(d,f,y,E,x,A,j,X,te){if(ote.apply(this,arguments),Vp){if(Vp){var le=Vy;Vp=!1,Vy=null}else throw Error(t(198));Gy||(Gy=!0,FE=le)}}function Cu(d){var f=d,y=d;if(d.alternate)for(;f.return;)f=f.return;else{d=f;do f=d,(f.flags&4098)!==0&&(y=f.return),d=f.return;while(d)}return f.tag===3?y:null}function H4(d){if(d.tag===13){var f=d.memoizedState;if(f===null&&(d=d.alternate,d!==null&&(f=d.memoizedState)),f!==null)return f.dehydrated}return null}function V4(d){if(Cu(d)!==d)throw Error(t(188))}function cte(d){var f=d.alternate;if(!f){if(f=Cu(d),f===null)throw Error(t(188));return f!==d?null:d}for(var y=d,E=f;;){var x=y.return;if(x===null)break;var A=x.alternate;if(A===null){if(E=x.return,E!==null){y=E;continue}break}if(x.child===A.child){for(A=x.child;A;){if(A===y)return V4(x),d;if(A===E)return V4(x),f;A=A.sibling}throw Error(t(188))}if(y.return!==E.return)y=x,E=A;else{for(var j=!1,X=x.child;X;){if(X===y){j=!0,y=x,E=A;break}if(X===E){j=!0,E=x,y=A;break}X=X.sibling}if(!j){for(X=A.child;X;){if(X===y){j=!0,y=A,E=x;break}if(X===E){j=!0,E=A,y=x;break}X=X.sibling}if(!j)throw Error(t(189))}}if(y.alternate!==E)throw Error(t(190))}if(y.tag!==3)throw Error(t(188));return y.stateNode.current===y?d:f}function G4(d){return d=cte(d),d!==null?q4(d):null}function q4(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var f=q4(d);if(f!==null)return f;d=d.sibling}return null}var K4=e.unstable_scheduleCallback,W4=e.unstable_cancelCallback,lte=e.unstable_shouldYield,ute=e.unstable_requestPaint,$n=e.unstable_now,dte=e.unstable_getCurrentPriorityLevel,UE=e.unstable_ImmediatePriority,z4=e.unstable_UserBlockingPriority,qy=e.unstable_NormalPriority,hte=e.unstable_LowPriority,Y4=e.unstable_IdlePriority,Ky=null,Xo=null;function fte(d){if(Xo&&typeof Xo.onCommitFiberRoot=="function")try{Xo.onCommitFiberRoot(Ky,d,void 0,(d.current.flags&128)===128)}catch{}}var uo=Math.clz32?Math.clz32:gte,pte=Math.log,mte=Math.LN2;function gte(d){return d>>>=0,d===0?32:31-(pte(d)/mte|0)|0}var Wy=64,zy=4194304;function Gp(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Yy(d,f){var y=d.pendingLanes;if(y===0)return 0;var E=0,x=d.suspendedLanes,A=d.pingedLanes,j=y&268435455;if(j!==0){var X=j&~x;X!==0?E=Gp(X):(A&=j,A!==0&&(E=Gp(A)))}else j=y&~x,j!==0?E=Gp(j):A!==0&&(E=Gp(A));if(E===0)return 0;if(f!==0&&f!==E&&(f&x)===0&&(x=E&-E,A=f&-f,x>=A||x===16&&(A&4194240)!==0))return f;if((E&4)!==0&&(E|=y&16),f=d.entangledLanes,f!==0)for(d=d.entanglements,f&=E;0<f;)y=31-uo(f),x=1<<y,E|=d[y],f&=~x;return E}function vte(d,f){switch(d){case 1:case 2:case 4:return f+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yte(d,f){for(var y=d.suspendedLanes,E=d.pingedLanes,x=d.expirationTimes,A=d.pendingLanes;0<A;){var j=31-uo(A),X=1<<j,te=x[j];te===-1?((X&y)===0||(X&E)!==0)&&(x[j]=vte(X,f)):te<=f&&(d.expiredLanes|=X),A&=~X}}function jE(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function X4(){var d=Wy;return Wy<<=1,(Wy&4194240)===0&&(Wy=64),d}function $E(d){for(var f=[],y=0;31>y;y++)f.push(d);return f}function qp(d,f,y){d.pendingLanes|=f,f!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,f=31-uo(f),d[f]=y}function _te(d,f){var y=d.pendingLanes&~f;d.pendingLanes=f,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=f,d.mutableReadLanes&=f,d.entangledLanes&=f,f=d.entanglements;var E=d.eventTimes;for(d=d.expirationTimes;0<y;){var x=31-uo(y),A=1<<x;f[x]=0,E[x]=-1,d[x]=-1,y&=~A}}function BE(d,f){var y=d.entangledLanes|=f;for(d=d.entanglements;y;){var E=31-uo(y),x=1<<E;x&f|d[E]&f&&(d[E]|=f),y&=~x}}var zt=0;function J4(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Z4,HE,Q4,eA,tA,VE=!1,Xy=[],Wc=null,zc=null,Yc=null,Kp=new Map,Wp=new Map,Xc=[],bte="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nA(d,f){switch(d){case"focusin":case"focusout":Wc=null;break;case"dragenter":case"dragleave":zc=null;break;case"mouseover":case"mouseout":Yc=null;break;case"pointerover":case"pointerout":Kp.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wp.delete(f.pointerId)}}function zp(d,f,y,E,x,A){return d===null||d.nativeEvent!==A?(d={blockedOn:f,domEventName:y,eventSystemFlags:E,nativeEvent:A,targetContainers:[x]},f!==null&&(f=cm(f),f!==null&&HE(f)),d):(d.eventSystemFlags|=E,f=d.targetContainers,x!==null&&f.indexOf(x)===-1&&f.push(x),d)}function Ste(d,f,y,E,x){switch(f){case"focusin":return Wc=zp(Wc,d,f,y,E,x),!0;case"dragenter":return zc=zp(zc,d,f,y,E,x),!0;case"mouseover":return Yc=zp(Yc,d,f,y,E,x),!0;case"pointerover":var A=x.pointerId;return Kp.set(A,zp(Kp.get(A)||null,d,f,y,E,x)),!0;case"gotpointercapture":return A=x.pointerId,Wp.set(A,zp(Wp.get(A)||null,d,f,y,E,x)),!0}return!1}function rA(d){var f=Tu(d.target);if(f!==null){var y=Cu(f);if(y!==null){if(f=y.tag,f===13){if(f=H4(y),f!==null){d.blockedOn=f,tA(d.priority,function(){Q4(y)});return}}else if(f===3&&y.stateNode.current.memoizedState.isDehydrated){d.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Jy(d){if(d.blockedOn!==null)return!1;for(var f=d.targetContainers;0<f.length;){var y=qE(d.domEventName,d.eventSystemFlags,f[0],d.nativeEvent);if(y===null){y=d.nativeEvent;var E=new y.constructor(y.type,y);Pt=E,y.target.dispatchEvent(E),Pt=null}else return f=cm(y),f!==null&&HE(f),d.blockedOn=y,!1;f.shift()}return!0}function iA(d,f,y){Jy(d)&&y.delete(f)}function wte(){VE=!1,Wc!==null&&Jy(Wc)&&(Wc=null),zc!==null&&Jy(zc)&&(zc=null),Yc!==null&&Jy(Yc)&&(Yc=null),Kp.forEach(iA),Wp.forEach(iA)}function Yp(d,f){d.blockedOn===f&&(d.blockedOn=null,VE||(VE=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,wte)))}function Xp(d){function f(x){return Yp(x,d)}if(0<Xy.length){Yp(Xy[0],d);for(var y=1;y<Xy.length;y++){var E=Xy[y];E.blockedOn===d&&(E.blockedOn=null)}}for(Wc!==null&&Yp(Wc,d),zc!==null&&Yp(zc,d),Yc!==null&&Yp(Yc,d),Kp.forEach(f),Wp.forEach(f),y=0;y<Xc.length;y++)E=Xc[y],E.blockedOn===d&&(E.blockedOn=null);for(;0<Xc.length&&(y=Xc[0],y.blockedOn===null);)rA(y),y.blockedOn===null&&Xc.shift()}var oh=I.ReactCurrentBatchConfig,Zy=!0;function Ete(d,f,y,E){var x=zt,A=oh.transition;oh.transition=null;try{zt=1,GE(d,f,y,E)}finally{zt=x,oh.transition=A}}function Cte(d,f,y,E){var x=zt,A=oh.transition;oh.transition=null;try{zt=4,GE(d,f,y,E)}finally{zt=x,oh.transition=A}}function GE(d,f,y,E){if(Zy){var x=qE(d,f,y,E);if(x===null)cC(d,f,E,Qy,y),nA(d,E);else if(Ste(x,d,f,y,E))E.stopPropagation();else if(nA(d,E),f&4&&-1<bte.indexOf(d)){for(;x!==null;){var A=cm(x);if(A!==null&&Z4(A),A=qE(d,f,y,E),A===null&&cC(d,f,E,Qy,y),A===x)break;x=A}x!==null&&E.stopPropagation()}else cC(d,f,E,null,y)}}var Qy=null;function qE(d,f,y,E){if(Qy=null,d=it(E),d=Tu(d),d!==null)if(f=Cu(d),f===null)d=null;else if(y=f.tag,y===13){if(d=H4(f),d!==null)return d;d=null}else if(y===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;d=null}else f!==d&&(d=null);return Qy=d,null}function sA(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dte()){case UE:return 1;case z4:return 4;case qy:case hte:return 16;case Y4:return 536870912;default:return 16}default:return 16}}var Jc=null,KE=null,e0=null;function oA(){if(e0)return e0;var d,f=KE,y=f.length,E,x="value"in Jc?Jc.value:Jc.textContent,A=x.length;for(d=0;d<y&&f[d]===x[d];d++);var j=y-d;for(E=1;E<=j&&f[y-E]===x[A-E];E++);return e0=x.slice(d,1<E?1-E:void 0)}function t0(d){var f=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&f===13&&(d=13)):d=f,d===10&&(d=13),32<=d||d===13?d:0}function n0(){return!0}function aA(){return!1}function as(d){function f(y,E,x,A,j){this._reactName=y,this._targetInst=x,this.type=E,this.nativeEvent=A,this.target=j,this.currentTarget=null;for(var X in d)d.hasOwnProperty(X)&&(y=d[X],this[X]=y?y(A):A[X]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?n0:aA,this.isPropagationStopped=aA,this}return ee(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=n0)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=n0)},persist:function(){},isPersistent:n0}),f}var ah={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},WE=as(ah),Jp=ee({},ah,{view:0,detail:0}),Tte=as(Jp),zE,YE,Zp,r0=ee({},Jp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:JE,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Zp&&(Zp&&d.type==="mousemove"?(zE=d.screenX-Zp.screenX,YE=d.screenY-Zp.screenY):YE=zE=0,Zp=d),zE)},movementY:function(d){return"movementY"in d?d.movementY:YE}}),cA=as(r0),Ite=ee({},r0,{dataTransfer:0}),Rte=as(Ite),kte=ee({},Jp,{relatedTarget:0}),XE=as(kte),xte=ee({},ah,{animationName:0,elapsedTime:0,pseudoElement:0}),Pte=as(xte),Lte=ee({},ah,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Ate=as(Lte),Mte=ee({},ah,{data:0}),lA=as(Mte),Ote={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nte={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dte={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fte(d){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(d):(d=Dte[d])?!!f[d]:!1}function JE(){return Fte}var Ute=ee({},Jp,{key:function(d){if(d.key){var f=Ote[d.key]||d.key;if(f!=="Unidentified")return f}return d.type==="keypress"?(d=t0(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Nte[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:JE,charCode:function(d){return d.type==="keypress"?t0(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?t0(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),jte=as(Ute),$te=ee({},r0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uA=as($te),Bte=ee({},Jp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:JE}),Hte=as(Bte),Vte=ee({},ah,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gte=as(Vte),qte=ee({},r0,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Kte=as(qte),Wte=[9,13,27,32],ZE=a&&"CompositionEvent"in window,Qp=null;a&&"documentMode"in document&&(Qp=document.documentMode);var zte=a&&"TextEvent"in window&&!Qp,dA=a&&(!ZE||Qp&&8<Qp&&11>=Qp),hA=" ",fA=!1;function pA(d,f){switch(d){case"keyup":return Wte.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mA(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var ch=!1;function Yte(d,f){switch(d){case"compositionend":return mA(f);case"keypress":return f.which!==32?null:(fA=!0,hA);case"textInput":return d=f.data,d===hA&&fA?null:d;default:return null}}function Xte(d,f){if(ch)return d==="compositionend"||!ZE&&pA(d,f)?(d=oA(),e0=KE=Jc=null,ch=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return dA&&f.locale!=="ko"?null:f.data;default:return null}}var Jte={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gA(d){var f=d&&d.nodeName&&d.nodeName.toLowerCase();return f==="input"?!!Jte[d.type]:f==="textarea"}function vA(d,f,y,E){Fr(E),f=c0(f,"onChange"),0<f.length&&(y=new WE("onChange","change",null,y,E),d.push({event:y,listeners:f}))}var em=null,tm=null;function Zte(d){NA(d,0)}function i0(d){var f=fh(d);if(Jt(f))return d}function Qte(d,f){if(d==="change")return f}var yA=!1;if(a){var QE;if(a){var eC="oninput"in document;if(!eC){var _A=document.createElement("div");_A.setAttribute("oninput","return;"),eC=typeof _A.oninput=="function"}QE=eC}else QE=!1;yA=QE&&(!document.documentMode||9<document.documentMode)}function bA(){em&&(em.detachEvent("onpropertychange",SA),tm=em=null)}function SA(d){if(d.propertyName==="value"&&i0(tm)){var f=[];vA(f,tm,d,it(d)),lo(Zte,f)}}function ene(d,f,y){d==="focusin"?(bA(),em=f,tm=y,em.attachEvent("onpropertychange",SA)):d==="focusout"&&bA()}function tne(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return i0(tm)}function nne(d,f){if(d==="click")return i0(f)}function rne(d,f){if(d==="input"||d==="change")return i0(f)}function ine(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var ho=typeof Object.is=="function"?Object.is:ine;function nm(d,f){if(ho(d,f))return!0;if(typeof d!="object"||d===null||typeof f!="object"||f===null)return!1;var y=Object.keys(d),E=Object.keys(f);if(y.length!==E.length)return!1;for(E=0;E<y.length;E++){var x=y[E];if(!c.call(f,x)||!ho(d[x],f[x]))return!1}return!0}function wA(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function EA(d,f){var y=wA(d);d=0;for(var E;y;){if(y.nodeType===3){if(E=d+y.textContent.length,d<=f&&E>=f)return{node:y,offset:f-d};d=E}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=wA(y)}}function CA(d,f){return d&&f?d===f?!0:d&&d.nodeType===3?!1:f&&f.nodeType===3?CA(d,f.parentNode):"contains"in d?d.contains(f):d.compareDocumentPosition?!!(d.compareDocumentPosition(f)&16):!1:!1}function TA(){for(var d=window,f=Et();f instanceof d.HTMLIFrameElement;){try{var y=typeof f.contentWindow.location.href=="string"}catch{y=!1}if(y)d=f.contentWindow;else break;f=Et(d.document)}return f}function tC(d){var f=d&&d.nodeName&&d.nodeName.toLowerCase();return f&&(f==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||f==="textarea"||d.contentEditable==="true")}function sne(d){var f=TA(),y=d.focusedElem,E=d.selectionRange;if(f!==y&&y&&y.ownerDocument&&CA(y.ownerDocument.documentElement,y)){if(E!==null&&tC(y)){if(f=E.start,d=E.end,d===void 0&&(d=f),"selectionStart"in y)y.selectionStart=f,y.selectionEnd=Math.min(d,y.value.length);else if(d=(f=y.ownerDocument||document)&&f.defaultView||window,d.getSelection){d=d.getSelection();var x=y.textContent.length,A=Math.min(E.start,x);E=E.end===void 0?A:Math.min(E.end,x),!d.extend&&A>E&&(x=E,E=A,A=x),x=EA(y,A);var j=EA(y,E);x&&j&&(d.rangeCount!==1||d.anchorNode!==x.node||d.anchorOffset!==x.offset||d.focusNode!==j.node||d.focusOffset!==j.offset)&&(f=f.createRange(),f.setStart(x.node,x.offset),d.removeAllRanges(),A>E?(d.addRange(f),d.extend(j.node,j.offset)):(f.setEnd(j.node,j.offset),d.addRange(f)))}}for(f=[],d=y;d=d.parentNode;)d.nodeType===1&&f.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<f.length;y++)d=f[y],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var one=a&&"documentMode"in document&&11>=document.documentMode,lh=null,nC=null,rm=null,rC=!1;function IA(d,f,y){var E=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;rC||lh==null||lh!==Et(E)||(E=lh,"selectionStart"in E&&tC(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),rm&&nm(rm,E)||(rm=E,E=c0(nC,"onSelect"),0<E.length&&(f=new WE("onSelect","select",null,f,y),d.push({event:f,listeners:E}),f.target=lh)))}function s0(d,f){var y={};return y[d.toLowerCase()]=f.toLowerCase(),y["Webkit"+d]="webkit"+f,y["Moz"+d]="moz"+f,y}var uh={animationend:s0("Animation","AnimationEnd"),animationiteration:s0("Animation","AnimationIteration"),animationstart:s0("Animation","AnimationStart"),transitionend:s0("Transition","TransitionEnd")},iC={},RA={};a&&(RA=document.createElement("div").style,"AnimationEvent"in window||(delete uh.animationend.animation,delete uh.animationiteration.animation,delete uh.animationstart.animation),"TransitionEvent"in window||delete uh.transitionend.transition);function o0(d){if(iC[d])return iC[d];if(!uh[d])return d;var f=uh[d],y;for(y in f)if(f.hasOwnProperty(y)&&y in RA)return iC[d]=f[y];return d}var kA=o0("animationend"),xA=o0("animationiteration"),PA=o0("animationstart"),LA=o0("transitionend"),AA=new Map,MA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zc(d,f){AA.set(d,f),s(f,[d])}for(var sC=0;sC<MA.length;sC++){var oC=MA[sC],ane=oC.toLowerCase(),cne=oC[0].toUpperCase()+oC.slice(1);Zc(ane,"on"+cne)}Zc(kA,"onAnimationEnd"),Zc(xA,"onAnimationIteration"),Zc(PA,"onAnimationStart"),Zc("dblclick","onDoubleClick"),Zc("focusin","onFocus"),Zc("focusout","onBlur"),Zc(LA,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var im="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lne=new Set("cancel close invalid load scroll toggle".split(" ").concat(im));function OA(d,f,y){var E=d.type||"unknown-event";d.currentTarget=y,ate(E,f,void 0,d),d.currentTarget=null}function NA(d,f){f=(f&4)!==0;for(var y=0;y<d.length;y++){var E=d[y],x=E.event;E=E.listeners;e:{var A=void 0;if(f)for(var j=E.length-1;0<=j;j--){var X=E[j],te=X.instance,le=X.currentTarget;if(X=X.listener,te!==A&&x.isPropagationStopped())break e;OA(x,X,le),A=te}else for(j=0;j<E.length;j++){if(X=E[j],te=X.instance,le=X.currentTarget,X=X.listener,te!==A&&x.isPropagationStopped())break e;OA(x,X,le),A=te}}}if(Gy)throw d=FE,Gy=!1,FE=null,d}function hn(d,f){var y=f[pC];y===void 0&&(y=f[pC]=new Set);var E=d+"__bubble";y.has(E)||(DA(f,d,2,!1),y.add(E))}function aC(d,f,y){var E=0;f&&(E|=4),DA(y,d,E,f)}var a0="_reactListening"+Math.random().toString(36).slice(2);function sm(d){if(!d[a0]){d[a0]=!0,r.forEach(function(y){y!=="selectionchange"&&(lne.has(y)||aC(y,!1,d),aC(y,!0,d))});var f=d.nodeType===9?d:d.ownerDocument;f===null||f[a0]||(f[a0]=!0,aC("selectionchange",!1,f))}}function DA(d,f,y,E){switch(sA(f)){case 1:var x=Ete;break;case 4:x=Cte;break;default:x=GE}y=x.bind(null,f,y,d),x=void 0,!qc||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(x=!0),E?x!==void 0?d.addEventListener(f,y,{capture:!0,passive:x}):d.addEventListener(f,y,!0):x!==void 0?d.addEventListener(f,y,{passive:x}):d.addEventListener(f,y,!1)}function cC(d,f,y,E,x){var A=E;if((f&1)===0&&(f&2)===0&&E!==null)e:for(;;){if(E===null)return;var j=E.tag;if(j===3||j===4){var X=E.stateNode.containerInfo;if(X===x||X.nodeType===8&&X.parentNode===x)break;if(j===4)for(j=E.return;j!==null;){var te=j.tag;if((te===3||te===4)&&(te=j.stateNode.containerInfo,te===x||te.nodeType===8&&te.parentNode===x))return;j=j.return}for(;X!==null;){if(j=Tu(X),j===null)return;if(te=j.tag,te===5||te===6){E=A=j;continue e}X=X.parentNode}}E=E.return}lo(function(){var le=A,be=it(y),we=[];e:{var _e=AA.get(d);if(_e!==void 0){var je=WE,Ge=d;switch(d){case"keypress":if(t0(y)===0)break e;case"keydown":case"keyup":je=jte;break;case"focusin":Ge="focus",je=XE;break;case"focusout":Ge="blur",je=XE;break;case"beforeblur":case"afterblur":je=XE;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":je=cA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":je=Rte;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":je=Hte;break;case kA:case xA:case PA:je=Pte;break;case LA:je=Gte;break;case"scroll":je=Tte;break;case"wheel":je=Kte;break;case"copy":case"cut":case"paste":je=Ate;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":je=uA}var We=(f&4)!==0,Bn=!We&&d==="scroll",se=We?_e!==null?_e+"Capture":null:_e;We=[];for(var re=le,oe;re!==null;){oe=re;var ke=oe.stateNode;if(oe.tag===5&&ke!==null&&(oe=ke,se!==null&&(ke=ti(re,se),ke!=null&&We.push(om(re,ke,oe)))),Bn)break;re=re.return}0<We.length&&(_e=new je(_e,Ge,null,y,be),we.push({event:_e,listeners:We}))}}if((f&7)===0){e:{if(_e=d==="mouseover"||d==="pointerover",je=d==="mouseout"||d==="pointerout",_e&&y!==Pt&&(Ge=y.relatedTarget||y.fromElement)&&(Tu(Ge)||Ge[Va]))break e;if((je||_e)&&(_e=be.window===be?be:(_e=be.ownerDocument)?_e.defaultView||_e.parentWindow:window,je?(Ge=y.relatedTarget||y.toElement,je=le,Ge=Ge?Tu(Ge):null,Ge!==null&&(Bn=Cu(Ge),Ge!==Bn||Ge.tag!==5&&Ge.tag!==6)&&(Ge=null)):(je=null,Ge=le),je!==Ge)){if(We=cA,ke="onMouseLeave",se="onMouseEnter",re="mouse",(d==="pointerout"||d==="pointerover")&&(We=uA,ke="onPointerLeave",se="onPointerEnter",re="pointer"),Bn=je==null?_e:fh(je),oe=Ge==null?_e:fh(Ge),_e=new We(ke,re+"leave",je,y,be),_e.target=Bn,_e.relatedTarget=oe,ke=null,Tu(be)===le&&(We=new We(se,re+"enter",Ge,y,be),We.target=oe,We.relatedTarget=Bn,ke=We),Bn=ke,je&&Ge)t:{for(We=je,se=Ge,re=0,oe=We;oe;oe=dh(oe))re++;for(oe=0,ke=se;ke;ke=dh(ke))oe++;for(;0<re-oe;)We=dh(We),re--;for(;0<oe-re;)se=dh(se),oe--;for(;re--;){if(We===se||se!==null&&We===se.alternate)break t;We=dh(We),se=dh(se)}We=null}else We=null;je!==null&&FA(we,_e,je,We,!1),Ge!==null&&Bn!==null&&FA(we,Bn,Ge,We,!0)}}e:{if(_e=le?fh(le):window,je=_e.nodeName&&_e.nodeName.toLowerCase(),je==="select"||je==="input"&&_e.type==="file")var Ye=Qte;else if(gA(_e))if(yA)Ye=rne;else{Ye=tne;var et=ene}else(je=_e.nodeName)&&je.toLowerCase()==="input"&&(_e.type==="checkbox"||_e.type==="radio")&&(Ye=nne);if(Ye&&(Ye=Ye(d,le))){vA(we,Ye,y,be);break e}et&&et(d,_e,le),d==="focusout"&&(et=_e._wrapperState)&&et.controlled&&_e.type==="number"&&pi(_e,"number",_e.value)}switch(et=le?fh(le):window,d){case"focusin":(gA(et)||et.contentEditable==="true")&&(lh=et,nC=le,rm=null);break;case"focusout":rm=nC=lh=null;break;case"mousedown":rC=!0;break;case"contextmenu":case"mouseup":case"dragend":rC=!1,IA(we,y,be);break;case"selectionchange":if(one)break;case"keydown":case"keyup":IA(we,y,be)}var tt;if(ZE)e:{switch(d){case"compositionstart":var at="onCompositionStart";break e;case"compositionend":at="onCompositionEnd";break e;case"compositionupdate":at="onCompositionUpdate";break e}at=void 0}else ch?pA(d,y)&&(at="onCompositionEnd"):d==="keydown"&&y.keyCode===229&&(at="onCompositionStart");at&&(dA&&y.locale!=="ko"&&(ch||at!=="onCompositionStart"?at==="onCompositionEnd"&&ch&&(tt=oA()):(Jc=be,KE="value"in Jc?Jc.value:Jc.textContent,ch=!0)),et=c0(le,at),0<et.length&&(at=new lA(at,d,null,y,be),we.push({event:at,listeners:et}),tt?at.data=tt:(tt=mA(y),tt!==null&&(at.data=tt)))),(tt=zte?Yte(d,y):Xte(d,y))&&(le=c0(le,"onBeforeInput"),0<le.length&&(be=new lA("onBeforeInput","beforeinput",null,y,be),we.push({event:be,listeners:le}),be.data=tt))}NA(we,f)})}function om(d,f,y){return{instance:d,listener:f,currentTarget:y}}function c0(d,f){for(var y=f+"Capture",E=[];d!==null;){var x=d,A=x.stateNode;x.tag===5&&A!==null&&(x=A,A=ti(d,y),A!=null&&E.unshift(om(d,A,x)),A=ti(d,f),A!=null&&E.push(om(d,A,x))),d=d.return}return E}function dh(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function FA(d,f,y,E,x){for(var A=f._reactName,j=[];y!==null&&y!==E;){var X=y,te=X.alternate,le=X.stateNode;if(te!==null&&te===E)break;X.tag===5&&le!==null&&(X=le,x?(te=ti(y,A),te!=null&&j.unshift(om(y,te,X))):x||(te=ti(y,A),te!=null&&j.push(om(y,te,X)))),y=y.return}j.length!==0&&d.push({event:f,listeners:j})}var une=/\r\n?/g,dne=/\u0000|\uFFFD/g;function UA(d){return(typeof d=="string"?d:""+d).replace(une,`
`).replace(dne,"")}function l0(d,f,y){if(f=UA(f),UA(d)!==f&&y)throw Error(t(425))}function u0(){}var lC=null,uC=null;function dC(d,f){return d==="textarea"||d==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var hC=typeof setTimeout=="function"?setTimeout:void 0,hne=typeof clearTimeout=="function"?clearTimeout:void 0,jA=typeof Promise=="function"?Promise:void 0,fne=typeof queueMicrotask=="function"?queueMicrotask:typeof jA<"u"?function(d){return jA.resolve(null).then(d).catch(pne)}:hC;function pne(d){setTimeout(function(){throw d})}function fC(d,f){var y=f,E=0;do{var x=y.nextSibling;if(d.removeChild(y),x&&x.nodeType===8)if(y=x.data,y==="/$"){if(E===0){d.removeChild(x),Xp(f);return}E--}else y!=="$"&&y!=="$?"&&y!=="$!"||E++;y=x}while(y);Xp(f)}function Qc(d){for(;d!=null;d=d.nextSibling){var f=d.nodeType;if(f===1||f===3)break;if(f===8){if(f=d.data,f==="$"||f==="$!"||f==="$?")break;if(f==="/$")return null}}return d}function $A(d){d=d.previousSibling;for(var f=0;d;){if(d.nodeType===8){var y=d.data;if(y==="$"||y==="$!"||y==="$?"){if(f===0)return d;f--}else y==="/$"&&f++}d=d.previousSibling}return null}var hh=Math.random().toString(36).slice(2),Jo="__reactFiber$"+hh,am="__reactProps$"+hh,Va="__reactContainer$"+hh,pC="__reactEvents$"+hh,mne="__reactListeners$"+hh,gne="__reactHandles$"+hh;function Tu(d){var f=d[Jo];if(f)return f;for(var y=d.parentNode;y;){if(f=y[Va]||y[Jo]){if(y=f.alternate,f.child!==null||y!==null&&y.child!==null)for(d=$A(d);d!==null;){if(y=d[Jo])return y;d=$A(d)}return f}d=y,y=d.parentNode}return null}function cm(d){return d=d[Jo]||d[Va],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function fh(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function d0(d){return d[am]||null}var mC=[],ph=-1;function el(d){return{current:d}}function fn(d){0>ph||(d.current=mC[ph],mC[ph]=null,ph--)}function ln(d,f){ph++,mC[ph]=d.current,d.current=f}var tl={},ni=el(tl),Li=el(!1),Iu=tl;function mh(d,f){var y=d.type.contextTypes;if(!y)return tl;var E=d.stateNode;if(E&&E.__reactInternalMemoizedUnmaskedChildContext===f)return E.__reactInternalMemoizedMaskedChildContext;var x={},A;for(A in y)x[A]=f[A];return E&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=f,d.__reactInternalMemoizedMaskedChildContext=x),x}function Ai(d){return d=d.childContextTypes,d!=null}function h0(){fn(Li),fn(ni)}function BA(d,f,y){if(ni.current!==tl)throw Error(t(168));ln(ni,f),ln(Li,y)}function HA(d,f,y){var E=d.stateNode;if(f=f.childContextTypes,typeof E.getChildContext!="function")return y;E=E.getChildContext();for(var x in E)if(!(x in f))throw Error(t(108,xe(d)||"Unknown",x));return ee({},y,E)}function f0(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||tl,Iu=ni.current,ln(ni,d),ln(Li,Li.current),!0}function VA(d,f,y){var E=d.stateNode;if(!E)throw Error(t(169));y?(d=HA(d,f,Iu),E.__reactInternalMemoizedMergedChildContext=d,fn(Li),fn(ni),ln(ni,d)):fn(Li),ln(Li,y)}var Ga=null,p0=!1,gC=!1;function GA(d){Ga===null?Ga=[d]:Ga.push(d)}function vne(d){p0=!0,GA(d)}function nl(){if(!gC&&Ga!==null){gC=!0;var d=0,f=zt;try{var y=Ga;for(zt=1;d<y.length;d++){var E=y[d];do E=E(!0);while(E!==null)}Ga=null,p0=!1}catch(x){throw Ga!==null&&(Ga=Ga.slice(d+1)),K4(UE,nl),x}finally{zt=f,gC=!1}}return null}var gh=[],vh=0,m0=null,g0=0,xs=[],Ps=0,Ru=null,qa=1,Ka="";function ku(d,f){gh[vh++]=g0,gh[vh++]=m0,m0=d,g0=f}function qA(d,f,y){xs[Ps++]=qa,xs[Ps++]=Ka,xs[Ps++]=Ru,Ru=d;var E=qa;d=Ka;var x=32-uo(E)-1;E&=~(1<<x),y+=1;var A=32-uo(f)+x;if(30<A){var j=x-x%5;A=(E&(1<<j)-1).toString(32),E>>=j,x-=j,qa=1<<32-uo(f)+x|y<<x|E,Ka=A+d}else qa=1<<A|y<<x|E,Ka=d}function vC(d){d.return!==null&&(ku(d,1),qA(d,1,0))}function yC(d){for(;d===m0;)m0=gh[--vh],gh[vh]=null,g0=gh[--vh],gh[vh]=null;for(;d===Ru;)Ru=xs[--Ps],xs[Ps]=null,Ka=xs[--Ps],xs[Ps]=null,qa=xs[--Ps],xs[Ps]=null}var cs=null,ls=null,bn=!1,fo=null;function KA(d,f){var y=Os(5,null,null,0);y.elementType="DELETED",y.stateNode=f,y.return=d,f=d.deletions,f===null?(d.deletions=[y],d.flags|=16):f.push(y)}function WA(d,f){switch(d.tag){case 5:var y=d.type;return f=f.nodeType!==1||y.toLowerCase()!==f.nodeName.toLowerCase()?null:f,f!==null?(d.stateNode=f,cs=d,ls=Qc(f.firstChild),!0):!1;case 6:return f=d.pendingProps===""||f.nodeType!==3?null:f,f!==null?(d.stateNode=f,cs=d,ls=null,!0):!1;case 13:return f=f.nodeType!==8?null:f,f!==null?(y=Ru!==null?{id:qa,overflow:Ka}:null,d.memoizedState={dehydrated:f,treeContext:y,retryLane:1073741824},y=Os(18,null,null,0),y.stateNode=f,y.return=d,d.child=y,cs=d,ls=null,!0):!1;default:return!1}}function _C(d){return(d.mode&1)!==0&&(d.flags&128)===0}function bC(d){if(bn){var f=ls;if(f){var y=f;if(!WA(d,f)){if(_C(d))throw Error(t(418));f=Qc(y.nextSibling);var E=cs;f&&WA(d,f)?KA(E,y):(d.flags=d.flags&-4097|2,bn=!1,cs=d)}}else{if(_C(d))throw Error(t(418));d.flags=d.flags&-4097|2,bn=!1,cs=d}}}function zA(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;cs=d}function v0(d){if(d!==cs)return!1;if(!bn)return zA(d),bn=!0,!1;var f;if((f=d.tag!==3)&&!(f=d.tag!==5)&&(f=d.type,f=f!=="head"&&f!=="body"&&!dC(d.type,d.memoizedProps)),f&&(f=ls)){if(_C(d))throw YA(),Error(t(418));for(;f;)KA(d,f),f=Qc(f.nextSibling)}if(zA(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,f=0;d;){if(d.nodeType===8){var y=d.data;if(y==="/$"){if(f===0){ls=Qc(d.nextSibling);break e}f--}else y!=="$"&&y!=="$!"&&y!=="$?"||f++}d=d.nextSibling}ls=null}}else ls=cs?Qc(d.stateNode.nextSibling):null;return!0}function YA(){for(var d=ls;d;)d=Qc(d.nextSibling)}function yh(){ls=cs=null,bn=!1}function SC(d){fo===null?fo=[d]:fo.push(d)}var yne=I.ReactCurrentBatchConfig;function lm(d,f,y){if(d=y.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(t(309));var E=y.stateNode}if(!E)throw Error(t(147,d));var x=E,A=""+d;return f!==null&&f.ref!==null&&typeof f.ref=="function"&&f.ref._stringRef===A?f.ref:(f=function(j){var X=x.refs;j===null?delete X[A]:X[A]=j},f._stringRef=A,f)}if(typeof d!="string")throw Error(t(284));if(!y._owner)throw Error(t(290,d))}return d}function y0(d,f){throw d=Object.prototype.toString.call(f),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":d))}function XA(d){var f=d._init;return f(d._payload)}function JA(d){function f(se,re){if(d){var oe=se.deletions;oe===null?(se.deletions=[re],se.flags|=16):oe.push(re)}}function y(se,re){if(!d)return null;for(;re!==null;)f(se,re),re=re.sibling;return null}function E(se,re){for(se=new Map;re!==null;)re.key!==null?se.set(re.key,re):se.set(re.index,re),re=re.sibling;return se}function x(se,re){return se=ul(se,re),se.index=0,se.sibling=null,se}function A(se,re,oe){return se.index=oe,d?(oe=se.alternate,oe!==null?(oe=oe.index,oe<re?(se.flags|=2,re):oe):(se.flags|=2,re)):(se.flags|=1048576,re)}function j(se){return d&&se.alternate===null&&(se.flags|=2),se}function X(se,re,oe,ke){return re===null||re.tag!==6?(re=hT(oe,se.mode,ke),re.return=se,re):(re=x(re,oe),re.return=se,re)}function te(se,re,oe,ke){var Ye=oe.type;return Ye===P?be(se,re,oe.props.children,ke,oe.key):re!==null&&(re.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===J&&XA(Ye)===re.type)?(ke=x(re,oe.props),ke.ref=lm(se,re,oe),ke.return=se,ke):(ke=H0(oe.type,oe.key,oe.props,null,se.mode,ke),ke.ref=lm(se,re,oe),ke.return=se,ke)}function le(se,re,oe,ke){return re===null||re.tag!==4||re.stateNode.containerInfo!==oe.containerInfo||re.stateNode.implementation!==oe.implementation?(re=fT(oe,se.mode,ke),re.return=se,re):(re=x(re,oe.children||[]),re.return=se,re)}function be(se,re,oe,ke,Ye){return re===null||re.tag!==7?(re=Du(oe,se.mode,ke,Ye),re.return=se,re):(re=x(re,oe),re.return=se,re)}function we(se,re,oe){if(typeof re=="string"&&re!==""||typeof re=="number")return re=hT(""+re,se.mode,oe),re.return=se,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case T:return oe=H0(re.type,re.key,re.props,null,se.mode,oe),oe.ref=lm(se,null,re),oe.return=se,oe;case C:return re=fT(re,se.mode,oe),re.return=se,re;case J:var ke=re._init;return we(se,ke(re._payload),oe)}if(Dr(re)||K(re))return re=Du(re,se.mode,oe,null),re.return=se,re;y0(se,re)}return null}function _e(se,re,oe,ke){var Ye=re!==null?re.key:null;if(typeof oe=="string"&&oe!==""||typeof oe=="number")return Ye!==null?null:X(se,re,""+oe,ke);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case T:return oe.key===Ye?te(se,re,oe,ke):null;case C:return oe.key===Ye?le(se,re,oe,ke):null;case J:return Ye=oe._init,_e(se,re,Ye(oe._payload),ke)}if(Dr(oe)||K(oe))return Ye!==null?null:be(se,re,oe,ke,null);y0(se,oe)}return null}function je(se,re,oe,ke,Ye){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return se=se.get(oe)||null,X(re,se,""+ke,Ye);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case T:return se=se.get(ke.key===null?oe:ke.key)||null,te(re,se,ke,Ye);case C:return se=se.get(ke.key===null?oe:ke.key)||null,le(re,se,ke,Ye);case J:var et=ke._init;return je(se,re,oe,et(ke._payload),Ye)}if(Dr(ke)||K(ke))return se=se.get(oe)||null,be(re,se,ke,Ye,null);y0(re,ke)}return null}function Ge(se,re,oe,ke){for(var Ye=null,et=null,tt=re,at=re=0,Cr=null;tt!==null&&at<oe.length;at++){tt.index>at?(Cr=tt,tt=null):Cr=tt.sibling;var Ut=_e(se,tt,oe[at],ke);if(Ut===null){tt===null&&(tt=Cr);break}d&&tt&&Ut.alternate===null&&f(se,tt),re=A(Ut,re,at),et===null?Ye=Ut:et.sibling=Ut,et=Ut,tt=Cr}if(at===oe.length)return y(se,tt),bn&&ku(se,at),Ye;if(tt===null){for(;at<oe.length;at++)tt=we(se,oe[at],ke),tt!==null&&(re=A(tt,re,at),et===null?Ye=tt:et.sibling=tt,et=tt);return bn&&ku(se,at),Ye}for(tt=E(se,tt);at<oe.length;at++)Cr=je(tt,se,at,oe[at],ke),Cr!==null&&(d&&Cr.alternate!==null&&tt.delete(Cr.key===null?at:Cr.key),re=A(Cr,re,at),et===null?Ye=Cr:et.sibling=Cr,et=Cr);return d&&tt.forEach(function(dl){return f(se,dl)}),bn&&ku(se,at),Ye}function We(se,re,oe,ke){var Ye=K(oe);if(typeof Ye!="function")throw Error(t(150));if(oe=Ye.call(oe),oe==null)throw Error(t(151));for(var et=Ye=null,tt=re,at=re=0,Cr=null,Ut=oe.next();tt!==null&&!Ut.done;at++,Ut=oe.next()){tt.index>at?(Cr=tt,tt=null):Cr=tt.sibling;var dl=_e(se,tt,Ut.value,ke);if(dl===null){tt===null&&(tt=Cr);break}d&&tt&&dl.alternate===null&&f(se,tt),re=A(dl,re,at),et===null?Ye=dl:et.sibling=dl,et=dl,tt=Cr}if(Ut.done)return y(se,tt),bn&&ku(se,at),Ye;if(tt===null){for(;!Ut.done;at++,Ut=oe.next())Ut=we(se,Ut.value,ke),Ut!==null&&(re=A(Ut,re,at),et===null?Ye=Ut:et.sibling=Ut,et=Ut);return bn&&ku(se,at),Ye}for(tt=E(se,tt);!Ut.done;at++,Ut=oe.next())Ut=je(tt,se,at,Ut.value,ke),Ut!==null&&(d&&Ut.alternate!==null&&tt.delete(Ut.key===null?at:Ut.key),re=A(Ut,re,at),et===null?Ye=Ut:et.sibling=Ut,et=Ut);return d&&tt.forEach(function(Jne){return f(se,Jne)}),bn&&ku(se,at),Ye}function Bn(se,re,oe,ke){if(typeof oe=="object"&&oe!==null&&oe.type===P&&oe.key===null&&(oe=oe.props.children),typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case T:e:{for(var Ye=oe.key,et=re;et!==null;){if(et.key===Ye){if(Ye=oe.type,Ye===P){if(et.tag===7){y(se,et.sibling),re=x(et,oe.props.children),re.return=se,se=re;break e}}else if(et.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===J&&XA(Ye)===et.type){y(se,et.sibling),re=x(et,oe.props),re.ref=lm(se,et,oe),re.return=se,se=re;break e}y(se,et);break}else f(se,et);et=et.sibling}oe.type===P?(re=Du(oe.props.children,se.mode,ke,oe.key),re.return=se,se=re):(ke=H0(oe.type,oe.key,oe.props,null,se.mode,ke),ke.ref=lm(se,re,oe),ke.return=se,se=ke)}return j(se);case C:e:{for(et=oe.key;re!==null;){if(re.key===et)if(re.tag===4&&re.stateNode.containerInfo===oe.containerInfo&&re.stateNode.implementation===oe.implementation){y(se,re.sibling),re=x(re,oe.children||[]),re.return=se,se=re;break e}else{y(se,re);break}else f(se,re);re=re.sibling}re=fT(oe,se.mode,ke),re.return=se,se=re}return j(se);case J:return et=oe._init,Bn(se,re,et(oe._payload),ke)}if(Dr(oe))return Ge(se,re,oe,ke);if(K(oe))return We(se,re,oe,ke);y0(se,oe)}return typeof oe=="string"&&oe!==""||typeof oe=="number"?(oe=""+oe,re!==null&&re.tag===6?(y(se,re.sibling),re=x(re,oe),re.return=se,se=re):(y(se,re),re=hT(oe,se.mode,ke),re.return=se,se=re),j(se)):y(se,re)}return Bn}var _h=JA(!0),ZA=JA(!1),_0=el(null),b0=null,bh=null,wC=null;function EC(){wC=bh=b0=null}function CC(d){var f=_0.current;fn(_0),d._currentValue=f}function TC(d,f,y){for(;d!==null;){var E=d.alternate;if((d.childLanes&f)!==f?(d.childLanes|=f,E!==null&&(E.childLanes|=f)):E!==null&&(E.childLanes&f)!==f&&(E.childLanes|=f),d===y)break;d=d.return}}function Sh(d,f){b0=d,wC=bh=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&f)!==0&&(Mi=!0),d.firstContext=null)}function Ls(d){var f=d._currentValue;if(wC!==d)if(d={context:d,memoizedValue:f,next:null},bh===null){if(b0===null)throw Error(t(308));bh=d,b0.dependencies={lanes:0,firstContext:d}}else bh=bh.next=d;return f}var xu=null;function IC(d){xu===null?xu=[d]:xu.push(d)}function QA(d,f,y,E){var x=f.interleaved;return x===null?(y.next=y,IC(f)):(y.next=x.next,x.next=y),f.interleaved=y,Wa(d,E)}function Wa(d,f){d.lanes|=f;var y=d.alternate;for(y!==null&&(y.lanes|=f),y=d,d=d.return;d!==null;)d.childLanes|=f,y=d.alternate,y!==null&&(y.childLanes|=f),y=d,d=d.return;return y.tag===3?y.stateNode:null}var rl=!1;function RC(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eM(d,f){d=d.updateQueue,f.updateQueue===d&&(f.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function za(d,f){return{eventTime:d,lane:f,tag:0,payload:null,callback:null,next:null}}function il(d,f,y){var E=d.updateQueue;if(E===null)return null;if(E=E.shared,(Mt&2)!==0){var x=E.pending;return x===null?f.next=f:(f.next=x.next,x.next=f),E.pending=f,Wa(d,y)}return x=E.interleaved,x===null?(f.next=f,IC(E)):(f.next=x.next,x.next=f),E.interleaved=f,Wa(d,y)}function S0(d,f,y){if(f=f.updateQueue,f!==null&&(f=f.shared,(y&4194240)!==0)){var E=f.lanes;E&=d.pendingLanes,y|=E,f.lanes=y,BE(d,y)}}function tM(d,f){var y=d.updateQueue,E=d.alternate;if(E!==null&&(E=E.updateQueue,y===E)){var x=null,A=null;if(y=y.firstBaseUpdate,y!==null){do{var j={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};A===null?x=A=j:A=A.next=j,y=y.next}while(y!==null);A===null?x=A=f:A=A.next=f}else x=A=f;y={baseState:E.baseState,firstBaseUpdate:x,lastBaseUpdate:A,shared:E.shared,effects:E.effects},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=f:d.next=f,y.lastBaseUpdate=f}function w0(d,f,y,E){var x=d.updateQueue;rl=!1;var A=x.firstBaseUpdate,j=x.lastBaseUpdate,X=x.shared.pending;if(X!==null){x.shared.pending=null;var te=X,le=te.next;te.next=null,j===null?A=le:j.next=le,j=te;var be=d.alternate;be!==null&&(be=be.updateQueue,X=be.lastBaseUpdate,X!==j&&(X===null?be.firstBaseUpdate=le:X.next=le,be.lastBaseUpdate=te))}if(A!==null){var we=x.baseState;j=0,be=le=te=null,X=A;do{var _e=X.lane,je=X.eventTime;if((E&_e)===_e){be!==null&&(be=be.next={eventTime:je,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Ge=d,We=X;switch(_e=f,je=y,We.tag){case 1:if(Ge=We.payload,typeof Ge=="function"){we=Ge.call(je,we,_e);break e}we=Ge;break e;case 3:Ge.flags=Ge.flags&-65537|128;case 0:if(Ge=We.payload,_e=typeof Ge=="function"?Ge.call(je,we,_e):Ge,_e==null)break e;we=ee({},we,_e);break e;case 2:rl=!0}}X.callback!==null&&X.lane!==0&&(d.flags|=64,_e=x.effects,_e===null?x.effects=[X]:_e.push(X))}else je={eventTime:je,lane:_e,tag:X.tag,payload:X.payload,callback:X.callback,next:null},be===null?(le=be=je,te=we):be=be.next=je,j|=_e;if(X=X.next,X===null){if(X=x.shared.pending,X===null)break;_e=X,X=_e.next,_e.next=null,x.lastBaseUpdate=_e,x.shared.pending=null}}while(!0);if(be===null&&(te=we),x.baseState=te,x.firstBaseUpdate=le,x.lastBaseUpdate=be,f=x.shared.interleaved,f!==null){x=f;do j|=x.lane,x=x.next;while(x!==f)}else A===null&&(x.shared.lanes=0);Au|=j,d.lanes=j,d.memoizedState=we}}function nM(d,f,y){if(d=f.effects,f.effects=null,d!==null)for(f=0;f<d.length;f++){var E=d[f],x=E.callback;if(x!==null){if(E.callback=null,E=y,typeof x!="function")throw Error(t(191,x));x.call(E)}}}var um={},Zo=el(um),dm=el(um),hm=el(um);function Pu(d){if(d===um)throw Error(t(174));return d}function kC(d,f){switch(ln(hm,f),ln(dm,d),ln(Zo,um),d=f.nodeType,d){case 9:case 11:f=(f=f.documentElement)?f.namespaceURI:$(null,"");break;default:d=d===8?f.parentNode:f,f=d.namespaceURI||null,d=d.tagName,f=$(f,d)}fn(Zo),ln(Zo,f)}function wh(){fn(Zo),fn(dm),fn(hm)}function rM(d){Pu(hm.current);var f=Pu(Zo.current),y=$(f,d.type);f!==y&&(ln(dm,d),ln(Zo,y))}function xC(d){dm.current===d&&(fn(Zo),fn(dm))}var Rn=el(0);function E0(d){for(var f=d;f!==null;){if(f.tag===13){var y=f.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===d)break;for(;f.sibling===null;){if(f.return===null||f.return===d)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var PC=[];function LC(){for(var d=0;d<PC.length;d++)PC[d]._workInProgressVersionPrimary=null;PC.length=0}var C0=I.ReactCurrentDispatcher,AC=I.ReactCurrentBatchConfig,Lu=0,kn=null,ar=null,wr=null,T0=!1,fm=!1,pm=0,_ne=0;function ri(){throw Error(t(321))}function MC(d,f){if(f===null)return!1;for(var y=0;y<f.length&&y<d.length;y++)if(!ho(d[y],f[y]))return!1;return!0}function OC(d,f,y,E,x,A){if(Lu=A,kn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,C0.current=d===null||d.memoizedState===null?Ene:Cne,d=y(E,x),fm){A=0;do{if(fm=!1,pm=0,25<=A)throw Error(t(301));A+=1,wr=ar=null,f.updateQueue=null,C0.current=Tne,d=y(E,x)}while(fm)}if(C0.current=k0,f=ar!==null&&ar.next!==null,Lu=0,wr=ar=kn=null,T0=!1,f)throw Error(t(300));return d}function NC(){var d=pm!==0;return pm=0,d}function Qo(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wr===null?kn.memoizedState=wr=d:wr=wr.next=d,wr}function As(){if(ar===null){var d=kn.alternate;d=d!==null?d.memoizedState:null}else d=ar.next;var f=wr===null?kn.memoizedState:wr.next;if(f!==null)wr=f,ar=d;else{if(d===null)throw Error(t(310));ar=d,d={memoizedState:ar.memoizedState,baseState:ar.baseState,baseQueue:ar.baseQueue,queue:ar.queue,next:null},wr===null?kn.memoizedState=wr=d:wr=wr.next=d}return wr}function mm(d,f){return typeof f=="function"?f(d):f}function DC(d){var f=As(),y=f.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=d;var E=ar,x=E.baseQueue,A=y.pending;if(A!==null){if(x!==null){var j=x.next;x.next=A.next,A.next=j}E.baseQueue=x=A,y.pending=null}if(x!==null){A=x.next,E=E.baseState;var X=j=null,te=null,le=A;do{var be=le.lane;if((Lu&be)===be)te!==null&&(te=te.next={lane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),E=le.hasEagerState?le.eagerState:d(E,le.action);else{var we={lane:be,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null};te===null?(X=te=we,j=E):te=te.next=we,kn.lanes|=be,Au|=be}le=le.next}while(le!==null&&le!==A);te===null?j=E:te.next=X,ho(E,f.memoizedState)||(Mi=!0),f.memoizedState=E,f.baseState=j,f.baseQueue=te,y.lastRenderedState=E}if(d=y.interleaved,d!==null){x=d;do A=x.lane,kn.lanes|=A,Au|=A,x=x.next;while(x!==d)}else x===null&&(y.lanes=0);return[f.memoizedState,y.dispatch]}function FC(d){var f=As(),y=f.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=d;var E=y.dispatch,x=y.pending,A=f.memoizedState;if(x!==null){y.pending=null;var j=x=x.next;do A=d(A,j.action),j=j.next;while(j!==x);ho(A,f.memoizedState)||(Mi=!0),f.memoizedState=A,f.baseQueue===null&&(f.baseState=A),y.lastRenderedState=A}return[A,E]}function iM(){}function sM(d,f){var y=kn,E=As(),x=f(),A=!ho(E.memoizedState,x);if(A&&(E.memoizedState=x,Mi=!0),E=E.queue,UC(cM.bind(null,y,E,d),[d]),E.getSnapshot!==f||A||wr!==null&&wr.memoizedState.tag&1){if(y.flags|=2048,gm(9,aM.bind(null,y,E,x,f),void 0,null),Er===null)throw Error(t(349));(Lu&30)!==0||oM(y,f,x)}return x}function oM(d,f,y){d.flags|=16384,d={getSnapshot:f,value:y},f=kn.updateQueue,f===null?(f={lastEffect:null,stores:null},kn.updateQueue=f,f.stores=[d]):(y=f.stores,y===null?f.stores=[d]:y.push(d))}function aM(d,f,y,E){f.value=y,f.getSnapshot=E,lM(f)&&uM(d)}function cM(d,f,y){return y(function(){lM(f)&&uM(d)})}function lM(d){var f=d.getSnapshot;d=d.value;try{var y=f();return!ho(d,y)}catch{return!0}}function uM(d){var f=Wa(d,1);f!==null&&vo(f,d,1,-1)}function dM(d){var f=Qo();return typeof d=="function"&&(d=d()),f.memoizedState=f.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mm,lastRenderedState:d},f.queue=d,d=d.dispatch=wne.bind(null,kn,d),[f.memoizedState,d]}function gm(d,f,y,E){return d={tag:d,create:f,destroy:y,deps:E,next:null},f=kn.updateQueue,f===null?(f={lastEffect:null,stores:null},kn.updateQueue=f,f.lastEffect=d.next=d):(y=f.lastEffect,y===null?f.lastEffect=d.next=d:(E=y.next,y.next=d,d.next=E,f.lastEffect=d)),d}function hM(){return As().memoizedState}function I0(d,f,y,E){var x=Qo();kn.flags|=d,x.memoizedState=gm(1|f,y,void 0,E===void 0?null:E)}function R0(d,f,y,E){var x=As();E=E===void 0?null:E;var A=void 0;if(ar!==null){var j=ar.memoizedState;if(A=j.destroy,E!==null&&MC(E,j.deps)){x.memoizedState=gm(f,y,A,E);return}}kn.flags|=d,x.memoizedState=gm(1|f,y,A,E)}function fM(d,f){return I0(8390656,8,d,f)}function UC(d,f){return R0(2048,8,d,f)}function pM(d,f){return R0(4,2,d,f)}function mM(d,f){return R0(4,4,d,f)}function gM(d,f){if(typeof f=="function")return d=d(),f(d),function(){f(null)};if(f!=null)return d=d(),f.current=d,function(){f.current=null}}function vM(d,f,y){return y=y!=null?y.concat([d]):null,R0(4,4,gM.bind(null,f,d),y)}function jC(){}function yM(d,f){var y=As();f=f===void 0?null:f;var E=y.memoizedState;return E!==null&&f!==null&&MC(f,E[1])?E[0]:(y.memoizedState=[d,f],d)}function _M(d,f){var y=As();f=f===void 0?null:f;var E=y.memoizedState;return E!==null&&f!==null&&MC(f,E[1])?E[0]:(d=d(),y.memoizedState=[d,f],d)}function bM(d,f,y){return(Lu&21)===0?(d.baseState&&(d.baseState=!1,Mi=!0),d.memoizedState=y):(ho(y,f)||(y=X4(),kn.lanes|=y,Au|=y,d.baseState=!0),f)}function bne(d,f){var y=zt;zt=y!==0&&4>y?y:4,d(!0);var E=AC.transition;AC.transition={};try{d(!1),f()}finally{zt=y,AC.transition=E}}function SM(){return As().memoizedState}function Sne(d,f,y){var E=cl(d);if(y={lane:E,action:y,hasEagerState:!1,eagerState:null,next:null},wM(d))EM(f,y);else if(y=QA(d,f,y,E),y!==null){var x=gi();vo(y,d,E,x),CM(y,f,E)}}function wne(d,f,y){var E=cl(d),x={lane:E,action:y,hasEagerState:!1,eagerState:null,next:null};if(wM(d))EM(f,x);else{var A=d.alternate;if(d.lanes===0&&(A===null||A.lanes===0)&&(A=f.lastRenderedReducer,A!==null))try{var j=f.lastRenderedState,X=A(j,y);if(x.hasEagerState=!0,x.eagerState=X,ho(X,j)){var te=f.interleaved;te===null?(x.next=x,IC(f)):(x.next=te.next,te.next=x),f.interleaved=x;return}}catch{}finally{}y=QA(d,f,x,E),y!==null&&(x=gi(),vo(y,d,E,x),CM(y,f,E))}}function wM(d){var f=d.alternate;return d===kn||f!==null&&f===kn}function EM(d,f){fm=T0=!0;var y=d.pending;y===null?f.next=f:(f.next=y.next,y.next=f),d.pending=f}function CM(d,f,y){if((y&4194240)!==0){var E=f.lanes;E&=d.pendingLanes,y|=E,f.lanes=y,BE(d,y)}}var k0={readContext:Ls,useCallback:ri,useContext:ri,useEffect:ri,useImperativeHandle:ri,useInsertionEffect:ri,useLayoutEffect:ri,useMemo:ri,useReducer:ri,useRef:ri,useState:ri,useDebugValue:ri,useDeferredValue:ri,useTransition:ri,useMutableSource:ri,useSyncExternalStore:ri,useId:ri,unstable_isNewReconciler:!1},Ene={readContext:Ls,useCallback:function(d,f){return Qo().memoizedState=[d,f===void 0?null:f],d},useContext:Ls,useEffect:fM,useImperativeHandle:function(d,f,y){return y=y!=null?y.concat([d]):null,I0(4194308,4,gM.bind(null,f,d),y)},useLayoutEffect:function(d,f){return I0(4194308,4,d,f)},useInsertionEffect:function(d,f){return I0(4,2,d,f)},useMemo:function(d,f){var y=Qo();return f=f===void 0?null:f,d=d(),y.memoizedState=[d,f],d},useReducer:function(d,f,y){var E=Qo();return f=y!==void 0?y(f):f,E.memoizedState=E.baseState=f,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:f},E.queue=d,d=d.dispatch=Sne.bind(null,kn,d),[E.memoizedState,d]},useRef:function(d){var f=Qo();return d={current:d},f.memoizedState=d},useState:dM,useDebugValue:jC,useDeferredValue:function(d){return Qo().memoizedState=d},useTransition:function(){var d=dM(!1),f=d[0];return d=bne.bind(null,d[1]),Qo().memoizedState=d,[f,d]},useMutableSource:function(){},useSyncExternalStore:function(d,f,y){var E=kn,x=Qo();if(bn){if(y===void 0)throw Error(t(407));y=y()}else{if(y=f(),Er===null)throw Error(t(349));(Lu&30)!==0||oM(E,f,y)}x.memoizedState=y;var A={value:y,getSnapshot:f};return x.queue=A,fM(cM.bind(null,E,A,d),[d]),E.flags|=2048,gm(9,aM.bind(null,E,A,y,f),void 0,null),y},useId:function(){var d=Qo(),f=Er.identifierPrefix;if(bn){var y=Ka,E=qa;y=(E&~(1<<32-uo(E)-1)).toString(32)+y,f=":"+f+"R"+y,y=pm++,0<y&&(f+="H"+y.toString(32)),f+=":"}else y=_ne++,f=":"+f+"r"+y.toString(32)+":";return d.memoizedState=f},unstable_isNewReconciler:!1},Cne={readContext:Ls,useCallback:yM,useContext:Ls,useEffect:UC,useImperativeHandle:vM,useInsertionEffect:pM,useLayoutEffect:mM,useMemo:_M,useReducer:DC,useRef:hM,useState:function(){return DC(mm)},useDebugValue:jC,useDeferredValue:function(d){var f=As();return bM(f,ar.memoizedState,d)},useTransition:function(){var d=DC(mm)[0],f=As().memoizedState;return[d,f]},useMutableSource:iM,useSyncExternalStore:sM,useId:SM,unstable_isNewReconciler:!1},Tne={readContext:Ls,useCallback:yM,useContext:Ls,useEffect:UC,useImperativeHandle:vM,useInsertionEffect:pM,useLayoutEffect:mM,useMemo:_M,useReducer:FC,useRef:hM,useState:function(){return FC(mm)},useDebugValue:jC,useDeferredValue:function(d){var f=As();return ar===null?f.memoizedState=d:bM(f,ar.memoizedState,d)},useTransition:function(){var d=FC(mm)[0],f=As().memoizedState;return[d,f]},useMutableSource:iM,useSyncExternalStore:sM,useId:SM,unstable_isNewReconciler:!1};function po(d,f){if(d&&d.defaultProps){f=ee({},f),d=d.defaultProps;for(var y in d)f[y]===void 0&&(f[y]=d[y]);return f}return f}function $C(d,f,y,E){f=d.memoizedState,y=y(E,f),y=y==null?f:ee({},f,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var x0={isMounted:function(d){return(d=d._reactInternals)?Cu(d)===d:!1},enqueueSetState:function(d,f,y){d=d._reactInternals;var E=gi(),x=cl(d),A=za(E,x);A.payload=f,y!=null&&(A.callback=y),f=il(d,A,x),f!==null&&(vo(f,d,x,E),S0(f,d,x))},enqueueReplaceState:function(d,f,y){d=d._reactInternals;var E=gi(),x=cl(d),A=za(E,x);A.tag=1,A.payload=f,y!=null&&(A.callback=y),f=il(d,A,x),f!==null&&(vo(f,d,x,E),S0(f,d,x))},enqueueForceUpdate:function(d,f){d=d._reactInternals;var y=gi(),E=cl(d),x=za(y,E);x.tag=2,f!=null&&(x.callback=f),f=il(d,x,E),f!==null&&(vo(f,d,E,y),S0(f,d,E))}};function TM(d,f,y,E,x,A,j){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(E,A,j):f.prototype&&f.prototype.isPureReactComponent?!nm(y,E)||!nm(x,A):!0}function IM(d,f,y){var E=!1,x=tl,A=f.contextType;return typeof A=="object"&&A!==null?A=Ls(A):(x=Ai(f)?Iu:ni.current,E=f.contextTypes,A=(E=E!=null)?mh(d,x):tl),f=new f(y,A),d.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=x0,d.stateNode=f,f._reactInternals=d,E&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=x,d.__reactInternalMemoizedMaskedChildContext=A),f}function RM(d,f,y,E){d=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(y,E),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(y,E),f.state!==d&&x0.enqueueReplaceState(f,f.state,null)}function BC(d,f,y,E){var x=d.stateNode;x.props=y,x.state=d.memoizedState,x.refs={},RC(d);var A=f.contextType;typeof A=="object"&&A!==null?x.context=Ls(A):(A=Ai(f)?Iu:ni.current,x.context=mh(d,A)),x.state=d.memoizedState,A=f.getDerivedStateFromProps,typeof A=="function"&&($C(d,f,A,y),x.state=d.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(f=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),f!==x.state&&x0.enqueueReplaceState(x,x.state,null),w0(d,y,x,E),x.state=d.memoizedState),typeof x.componentDidMount=="function"&&(d.flags|=4194308)}function Eh(d,f){try{var y="",E=f;do y+=Ne(E),E=E.return;while(E);var x=y}catch(A){x=`
Error generating stack: `+A.message+`
`+A.stack}return{value:d,source:f,stack:x,digest:null}}function HC(d,f,y){return{value:d,source:null,stack:y??null,digest:f??null}}function VC(d,f){try{console.error(f.value)}catch(y){setTimeout(function(){throw y})}}var Ine=typeof WeakMap=="function"?WeakMap:Map;function kM(d,f,y){y=za(-1,y),y.tag=3,y.payload={element:null};var E=f.value;return y.callback=function(){D0||(D0=!0,iT=E),VC(d,f)},y}function xM(d,f,y){y=za(-1,y),y.tag=3;var E=d.type.getDerivedStateFromError;if(typeof E=="function"){var x=f.value;y.payload=function(){return E(x)},y.callback=function(){VC(d,f)}}var A=d.stateNode;return A!==null&&typeof A.componentDidCatch=="function"&&(y.callback=function(){VC(d,f),typeof E!="function"&&(ol===null?ol=new Set([this]):ol.add(this));var j=f.stack;this.componentDidCatch(f.value,{componentStack:j!==null?j:""})}),y}function PM(d,f,y){var E=d.pingCache;if(E===null){E=d.pingCache=new Ine;var x=new Set;E.set(f,x)}else x=E.get(f),x===void 0&&(x=new Set,E.set(f,x));x.has(y)||(x.add(y),d=$ne.bind(null,d,f,y),f.then(d,d))}function LM(d){do{var f;if((f=d.tag===13)&&(f=d.memoizedState,f=f!==null?f.dehydrated!==null:!0),f)return d;d=d.return}while(d!==null);return null}function AM(d,f,y,E,x){return(d.mode&1)===0?(d===f?d.flags|=65536:(d.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(f=za(-1,1),f.tag=2,il(y,f,1))),y.lanes|=1),d):(d.flags|=65536,d.lanes=x,d)}var Rne=I.ReactCurrentOwner,Mi=!1;function mi(d,f,y,E){f.child=d===null?ZA(f,null,y,E):_h(f,d.child,y,E)}function MM(d,f,y,E,x){y=y.render;var A=f.ref;return Sh(f,x),E=OC(d,f,y,E,A,x),y=NC(),d!==null&&!Mi?(f.updateQueue=d.updateQueue,f.flags&=-2053,d.lanes&=~x,Ya(d,f,x)):(bn&&y&&vC(f),f.flags|=1,mi(d,f,E,x),f.child)}function OM(d,f,y,E,x){if(d===null){var A=y.type;return typeof A=="function"&&!dT(A)&&A.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(f.tag=15,f.type=A,NM(d,f,A,E,x)):(d=H0(y.type,null,E,f,f.mode,x),d.ref=f.ref,d.return=f,f.child=d)}if(A=d.child,(d.lanes&x)===0){var j=A.memoizedProps;if(y=y.compare,y=y!==null?y:nm,y(j,E)&&d.ref===f.ref)return Ya(d,f,x)}return f.flags|=1,d=ul(A,E),d.ref=f.ref,d.return=f,f.child=d}function NM(d,f,y,E,x){if(d!==null){var A=d.memoizedProps;if(nm(A,E)&&d.ref===f.ref)if(Mi=!1,f.pendingProps=E=A,(d.lanes&x)!==0)(d.flags&131072)!==0&&(Mi=!0);else return f.lanes=d.lanes,Ya(d,f,x)}return GC(d,f,y,E,x)}function DM(d,f,y){var E=f.pendingProps,x=E.children,A=d!==null?d.memoizedState:null;if(E.mode==="hidden")if((f.mode&1)===0)f.memoizedState={baseLanes:0,cachePool:null,transitions:null},ln(Th,us),us|=y;else{if((y&1073741824)===0)return d=A!==null?A.baseLanes|y:y,f.lanes=f.childLanes=1073741824,f.memoizedState={baseLanes:d,cachePool:null,transitions:null},f.updateQueue=null,ln(Th,us),us|=d,null;f.memoizedState={baseLanes:0,cachePool:null,transitions:null},E=A!==null?A.baseLanes:y,ln(Th,us),us|=E}else A!==null?(E=A.baseLanes|y,f.memoizedState=null):E=y,ln(Th,us),us|=E;return mi(d,f,x,y),f.child}function FM(d,f){var y=f.ref;(d===null&&y!==null||d!==null&&d.ref!==y)&&(f.flags|=512,f.flags|=2097152)}function GC(d,f,y,E,x){var A=Ai(y)?Iu:ni.current;return A=mh(f,A),Sh(f,x),y=OC(d,f,y,E,A,x),E=NC(),d!==null&&!Mi?(f.updateQueue=d.updateQueue,f.flags&=-2053,d.lanes&=~x,Ya(d,f,x)):(bn&&E&&vC(f),f.flags|=1,mi(d,f,y,x),f.child)}function UM(d,f,y,E,x){if(Ai(y)){var A=!0;f0(f)}else A=!1;if(Sh(f,x),f.stateNode===null)L0(d,f),IM(f,y,E),BC(f,y,E,x),E=!0;else if(d===null){var j=f.stateNode,X=f.memoizedProps;j.props=X;var te=j.context,le=y.contextType;typeof le=="object"&&le!==null?le=Ls(le):(le=Ai(y)?Iu:ni.current,le=mh(f,le));var be=y.getDerivedStateFromProps,we=typeof be=="function"||typeof j.getSnapshotBeforeUpdate=="function";we||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(X!==E||te!==le)&&RM(f,j,E,le),rl=!1;var _e=f.memoizedState;j.state=_e,w0(f,E,j,x),te=f.memoizedState,X!==E||_e!==te||Li.current||rl?(typeof be=="function"&&($C(f,y,be,E),te=f.memoizedState),(X=rl||TM(f,y,X,E,_e,te,le))?(we||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(f.flags|=4194308)):(typeof j.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=E,f.memoizedState=te),j.props=E,j.state=te,j.context=le,E=X):(typeof j.componentDidMount=="function"&&(f.flags|=4194308),E=!1)}else{j=f.stateNode,eM(d,f),X=f.memoizedProps,le=f.type===f.elementType?X:po(f.type,X),j.props=le,we=f.pendingProps,_e=j.context,te=y.contextType,typeof te=="object"&&te!==null?te=Ls(te):(te=Ai(y)?Iu:ni.current,te=mh(f,te));var je=y.getDerivedStateFromProps;(be=typeof je=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(X!==we||_e!==te)&&RM(f,j,E,te),rl=!1,_e=f.memoizedState,j.state=_e,w0(f,E,j,x);var Ge=f.memoizedState;X!==we||_e!==Ge||Li.current||rl?(typeof je=="function"&&($C(f,y,je,E),Ge=f.memoizedState),(le=rl||TM(f,y,le,E,_e,Ge,te)||!1)?(be||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(E,Ge,te),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(E,Ge,te)),typeof j.componentDidUpdate=="function"&&(f.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof j.componentDidUpdate!="function"||X===d.memoizedProps&&_e===d.memoizedState||(f.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||X===d.memoizedProps&&_e===d.memoizedState||(f.flags|=1024),f.memoizedProps=E,f.memoizedState=Ge),j.props=E,j.state=Ge,j.context=te,E=le):(typeof j.componentDidUpdate!="function"||X===d.memoizedProps&&_e===d.memoizedState||(f.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||X===d.memoizedProps&&_e===d.memoizedState||(f.flags|=1024),E=!1)}return qC(d,f,y,E,A,x)}function qC(d,f,y,E,x,A){FM(d,f);var j=(f.flags&128)!==0;if(!E&&!j)return x&&VA(f,y,!1),Ya(d,f,A);E=f.stateNode,Rne.current=f;var X=j&&typeof y.getDerivedStateFromError!="function"?null:E.render();return f.flags|=1,d!==null&&j?(f.child=_h(f,d.child,null,A),f.child=_h(f,null,X,A)):mi(d,f,X,A),f.memoizedState=E.state,x&&VA(f,y,!0),f.child}function jM(d){var f=d.stateNode;f.pendingContext?BA(d,f.pendingContext,f.pendingContext!==f.context):f.context&&BA(d,f.context,!1),kC(d,f.containerInfo)}function $M(d,f,y,E,x){return yh(),SC(x),f.flags|=256,mi(d,f,y,E),f.child}var KC={dehydrated:null,treeContext:null,retryLane:0};function WC(d){return{baseLanes:d,cachePool:null,transitions:null}}function BM(d,f,y){var E=f.pendingProps,x=Rn.current,A=!1,j=(f.flags&128)!==0,X;if((X=j)||(X=d!==null&&d.memoizedState===null?!1:(x&2)!==0),X?(A=!0,f.flags&=-129):(d===null||d.memoizedState!==null)&&(x|=1),ln(Rn,x&1),d===null)return bC(f),d=f.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((f.mode&1)===0?f.lanes=1:d.data==="$!"?f.lanes=8:f.lanes=1073741824,null):(j=E.children,d=E.fallback,A?(E=f.mode,A=f.child,j={mode:"hidden",children:j},(E&1)===0&&A!==null?(A.childLanes=0,A.pendingProps=j):A=V0(j,E,0,null),d=Du(d,E,y,null),A.return=f,d.return=f,A.sibling=d,f.child=A,f.child.memoizedState=WC(y),f.memoizedState=KC,d):zC(f,j));if(x=d.memoizedState,x!==null&&(X=x.dehydrated,X!==null))return kne(d,f,j,E,X,x,y);if(A){A=E.fallback,j=f.mode,x=d.child,X=x.sibling;var te={mode:"hidden",children:E.children};return(j&1)===0&&f.child!==x?(E=f.child,E.childLanes=0,E.pendingProps=te,f.deletions=null):(E=ul(x,te),E.subtreeFlags=x.subtreeFlags&14680064),X!==null?A=ul(X,A):(A=Du(A,j,y,null),A.flags|=2),A.return=f,E.return=f,E.sibling=A,f.child=E,E=A,A=f.child,j=d.child.memoizedState,j=j===null?WC(y):{baseLanes:j.baseLanes|y,cachePool:null,transitions:j.transitions},A.memoizedState=j,A.childLanes=d.childLanes&~y,f.memoizedState=KC,E}return A=d.child,d=A.sibling,E=ul(A,{mode:"visible",children:E.children}),(f.mode&1)===0&&(E.lanes=y),E.return=f,E.sibling=null,d!==null&&(y=f.deletions,y===null?(f.deletions=[d],f.flags|=16):y.push(d)),f.child=E,f.memoizedState=null,E}function zC(d,f){return f=V0({mode:"visible",children:f},d.mode,0,null),f.return=d,d.child=f}function P0(d,f,y,E){return E!==null&&SC(E),_h(f,d.child,null,y),d=zC(f,f.pendingProps.children),d.flags|=2,f.memoizedState=null,d}function kne(d,f,y,E,x,A,j){if(y)return f.flags&256?(f.flags&=-257,E=HC(Error(t(422))),P0(d,f,j,E)):f.memoizedState!==null?(f.child=d.child,f.flags|=128,null):(A=E.fallback,x=f.mode,E=V0({mode:"visible",children:E.children},x,0,null),A=Du(A,x,j,null),A.flags|=2,E.return=f,A.return=f,E.sibling=A,f.child=E,(f.mode&1)!==0&&_h(f,d.child,null,j),f.child.memoizedState=WC(j),f.memoizedState=KC,A);if((f.mode&1)===0)return P0(d,f,j,null);if(x.data==="$!"){if(E=x.nextSibling&&x.nextSibling.dataset,E)var X=E.dgst;return E=X,A=Error(t(419)),E=HC(A,E,void 0),P0(d,f,j,E)}if(X=(j&d.childLanes)!==0,Mi||X){if(E=Er,E!==null){switch(j&-j){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(E.suspendedLanes|j))!==0?0:x,x!==0&&x!==A.retryLane&&(A.retryLane=x,Wa(d,x),vo(E,d,x,-1))}return uT(),E=HC(Error(t(421))),P0(d,f,j,E)}return x.data==="$?"?(f.flags|=128,f.child=d.child,f=Bne.bind(null,d),x._reactRetry=f,null):(d=A.treeContext,ls=Qc(x.nextSibling),cs=f,bn=!0,fo=null,d!==null&&(xs[Ps++]=qa,xs[Ps++]=Ka,xs[Ps++]=Ru,qa=d.id,Ka=d.overflow,Ru=f),f=zC(f,E.children),f.flags|=4096,f)}function HM(d,f,y){d.lanes|=f;var E=d.alternate;E!==null&&(E.lanes|=f),TC(d.return,f,y)}function YC(d,f,y,E,x){var A=d.memoizedState;A===null?d.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:E,tail:y,tailMode:x}:(A.isBackwards=f,A.rendering=null,A.renderingStartTime=0,A.last=E,A.tail=y,A.tailMode=x)}function VM(d,f,y){var E=f.pendingProps,x=E.revealOrder,A=E.tail;if(mi(d,f,E.children,y),E=Rn.current,(E&2)!==0)E=E&1|2,f.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=f.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&HM(d,y,f);else if(d.tag===19)HM(d,y,f);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===f)break e;for(;d.sibling===null;){if(d.return===null||d.return===f)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}E&=1}if(ln(Rn,E),(f.mode&1)===0)f.memoizedState=null;else switch(x){case"forwards":for(y=f.child,x=null;y!==null;)d=y.alternate,d!==null&&E0(d)===null&&(x=y),y=y.sibling;y=x,y===null?(x=f.child,f.child=null):(x=y.sibling,y.sibling=null),YC(f,!1,x,y,A);break;case"backwards":for(y=null,x=f.child,f.child=null;x!==null;){if(d=x.alternate,d!==null&&E0(d)===null){f.child=x;break}d=x.sibling,x.sibling=y,y=x,x=d}YC(f,!0,y,null,A);break;case"together":YC(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function L0(d,f){(f.mode&1)===0&&d!==null&&(d.alternate=null,f.alternate=null,f.flags|=2)}function Ya(d,f,y){if(d!==null&&(f.dependencies=d.dependencies),Au|=f.lanes,(y&f.childLanes)===0)return null;if(d!==null&&f.child!==d.child)throw Error(t(153));if(f.child!==null){for(d=f.child,y=ul(d,d.pendingProps),f.child=y,y.return=f;d.sibling!==null;)d=d.sibling,y=y.sibling=ul(d,d.pendingProps),y.return=f;y.sibling=null}return f.child}function xne(d,f,y){switch(f.tag){case 3:jM(f),yh();break;case 5:rM(f);break;case 1:Ai(f.type)&&f0(f);break;case 4:kC(f,f.stateNode.containerInfo);break;case 10:var E=f.type._context,x=f.memoizedProps.value;ln(_0,E._currentValue),E._currentValue=x;break;case 13:if(E=f.memoizedState,E!==null)return E.dehydrated!==null?(ln(Rn,Rn.current&1),f.flags|=128,null):(y&f.child.childLanes)!==0?BM(d,f,y):(ln(Rn,Rn.current&1),d=Ya(d,f,y),d!==null?d.sibling:null);ln(Rn,Rn.current&1);break;case 19:if(E=(y&f.childLanes)!==0,(d.flags&128)!==0){if(E)return VM(d,f,y);f.flags|=128}if(x=f.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),ln(Rn,Rn.current),E)break;return null;case 22:case 23:return f.lanes=0,DM(d,f,y)}return Ya(d,f,y)}var GM,XC,qM,KM;GM=function(d,f){for(var y=f.child;y!==null;){if(y.tag===5||y.tag===6)d.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},XC=function(){},qM=function(d,f,y,E){var x=d.memoizedProps;if(x!==E){d=f.stateNode,Pu(Zo.current);var A=null;switch(y){case"input":x=Be(d,x),E=Be(d,E),A=[];break;case"select":x=ee({},x,{value:void 0}),E=ee({},E,{value:void 0}),A=[];break;case"textarea":x=br(d,x),E=br(d,E),A=[];break;default:typeof x.onClick!="function"&&typeof E.onClick=="function"&&(d.onclick=u0)}Ft(y,E);var j;y=null;for(le in x)if(!E.hasOwnProperty(le)&&x.hasOwnProperty(le)&&x[le]!=null)if(le==="style"){var X=x[le];for(j in X)X.hasOwnProperty(j)&&(y||(y={}),y[j]="")}else le!=="dangerouslySetInnerHTML"&&le!=="children"&&le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&le!=="autoFocus"&&(i.hasOwnProperty(le)?A||(A=[]):(A=A||[]).push(le,null));for(le in E){var te=E[le];if(X=x!=null?x[le]:void 0,E.hasOwnProperty(le)&&te!==X&&(te!=null||X!=null))if(le==="style")if(X){for(j in X)!X.hasOwnProperty(j)||te&&te.hasOwnProperty(j)||(y||(y={}),y[j]="");for(j in te)te.hasOwnProperty(j)&&X[j]!==te[j]&&(y||(y={}),y[j]=te[j])}else y||(A||(A=[]),A.push(le,y)),y=te;else le==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,X=X?X.__html:void 0,te!=null&&X!==te&&(A=A||[]).push(le,te)):le==="children"?typeof te!="string"&&typeof te!="number"||(A=A||[]).push(le,""+te):le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&(i.hasOwnProperty(le)?(te!=null&&le==="onScroll"&&hn("scroll",d),A||X===te||(A=[])):(A=A||[]).push(le,te))}y&&(A=A||[]).push("style",y);var le=A;(f.updateQueue=le)&&(f.flags|=4)}},KM=function(d,f,y,E){y!==E&&(f.flags|=4)};function vm(d,f){if(!bn)switch(d.tailMode){case"hidden":f=d.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var E=null;y!==null;)y.alternate!==null&&(E=y),y=y.sibling;E===null?f||d.tail===null?d.tail=null:d.tail.sibling=null:E.sibling=null}}function ii(d){var f=d.alternate!==null&&d.alternate.child===d.child,y=0,E=0;if(f)for(var x=d.child;x!==null;)y|=x.lanes|x.childLanes,E|=x.subtreeFlags&14680064,E|=x.flags&14680064,x.return=d,x=x.sibling;else for(x=d.child;x!==null;)y|=x.lanes|x.childLanes,E|=x.subtreeFlags,E|=x.flags,x.return=d,x=x.sibling;return d.subtreeFlags|=E,d.childLanes=y,f}function Pne(d,f,y){var E=f.pendingProps;switch(yC(f),f.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ii(f),null;case 1:return Ai(f.type)&&h0(),ii(f),null;case 3:return E=f.stateNode,wh(),fn(Li),fn(ni),LC(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(d===null||d.child===null)&&(v0(f)?f.flags|=4:d===null||d.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,fo!==null&&(aT(fo),fo=null))),XC(d,f),ii(f),null;case 5:xC(f);var x=Pu(hm.current);if(y=f.type,d!==null&&f.stateNode!=null)qM(d,f,y,E,x),d.ref!==f.ref&&(f.flags|=512,f.flags|=2097152);else{if(!E){if(f.stateNode===null)throw Error(t(166));return ii(f),null}if(d=Pu(Zo.current),v0(f)){E=f.stateNode,y=f.type;var A=f.memoizedProps;switch(E[Jo]=f,E[am]=A,d=(f.mode&1)!==0,y){case"dialog":hn("cancel",E),hn("close",E);break;case"iframe":case"object":case"embed":hn("load",E);break;case"video":case"audio":for(x=0;x<im.length;x++)hn(im[x],E);break;case"source":hn("error",E);break;case"img":case"image":case"link":hn("error",E),hn("load",E);break;case"details":hn("toggle",E);break;case"input":Zn(E,A),hn("invalid",E);break;case"select":E._wrapperState={wasMultiple:!!A.multiple},hn("invalid",E);break;case"textarea":ki(E,A),hn("invalid",E)}Ft(y,A),x=null;for(var j in A)if(A.hasOwnProperty(j)){var X=A[j];j==="children"?typeof X=="string"?E.textContent!==X&&(A.suppressHydrationWarning!==!0&&l0(E.textContent,X,d),x=["children",X]):typeof X=="number"&&E.textContent!==""+X&&(A.suppressHydrationWarning!==!0&&l0(E.textContent,X,d),x=["children",""+X]):i.hasOwnProperty(j)&&X!=null&&j==="onScroll"&&hn("scroll",E)}switch(y){case"input":vt(E),os(E,A,!0);break;case"textarea":vt(E),ei(E);break;case"select":case"option":break;default:typeof A.onClick=="function"&&(E.onclick=u0)}E=x,f.updateQueue=E,E!==null&&(f.flags|=4)}else{j=x.nodeType===9?x:x.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=ht(y)),d==="http://www.w3.org/1999/xhtml"?y==="script"?(d=j.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof E.is=="string"?d=j.createElement(y,{is:E.is}):(d=j.createElement(y),y==="select"&&(j=d,E.multiple?j.multiple=!0:E.size&&(j.size=E.size))):d=j.createElementNS(d,y),d[Jo]=f,d[am]=E,GM(d,f,!1,!1),f.stateNode=d;e:{switch(j=Qt(y,E),y){case"dialog":hn("cancel",d),hn("close",d),x=E;break;case"iframe":case"object":case"embed":hn("load",d),x=E;break;case"video":case"audio":for(x=0;x<im.length;x++)hn(im[x],d);x=E;break;case"source":hn("error",d),x=E;break;case"img":case"image":case"link":hn("error",d),hn("load",d),x=E;break;case"details":hn("toggle",d),x=E;break;case"input":Zn(d,E),x=Be(d,E),hn("invalid",d);break;case"option":x=E;break;case"select":d._wrapperState={wasMultiple:!!E.multiple},x=ee({},E,{value:void 0}),hn("invalid",d);break;case"textarea":ki(d,E),x=br(d,E),hn("invalid",d);break;default:x=E}Ft(y,x),X=x;for(A in X)if(X.hasOwnProperty(A)){var te=X[A];A==="style"?dt(d,te):A==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,te!=null&&N(d,te)):A==="children"?typeof te=="string"?(y!=="textarea"||te!=="")&&W(d,te):typeof te=="number"&&W(d,""+te):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(i.hasOwnProperty(A)?te!=null&&A==="onScroll"&&hn("scroll",d):te!=null&&k(d,A,te,j))}switch(y){case"input":vt(d),os(d,E,!1);break;case"textarea":vt(d),ei(d);break;case"option":E.value!=null&&d.setAttribute("value",""+Ee(E.value));break;case"select":d.multiple=!!E.multiple,A=E.value,A!=null?Qr(d,!!E.multiple,A,!1):E.defaultValue!=null&&Qr(d,!!E.multiple,E.defaultValue,!0);break;default:typeof x.onClick=="function"&&(d.onclick=u0)}switch(y){case"button":case"input":case"select":case"textarea":E=!!E.autoFocus;break e;case"img":E=!0;break e;default:E=!1}}E&&(f.flags|=4)}f.ref!==null&&(f.flags|=512,f.flags|=2097152)}return ii(f),null;case 6:if(d&&f.stateNode!=null)KM(d,f,d.memoizedProps,E);else{if(typeof E!="string"&&f.stateNode===null)throw Error(t(166));if(y=Pu(hm.current),Pu(Zo.current),v0(f)){if(E=f.stateNode,y=f.memoizedProps,E[Jo]=f,(A=E.nodeValue!==y)&&(d=cs,d!==null))switch(d.tag){case 3:l0(E.nodeValue,y,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&l0(E.nodeValue,y,(d.mode&1)!==0)}A&&(f.flags|=4)}else E=(y.nodeType===9?y:y.ownerDocument).createTextNode(E),E[Jo]=f,f.stateNode=E}return ii(f),null;case 13:if(fn(Rn),E=f.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(bn&&ls!==null&&(f.mode&1)!==0&&(f.flags&128)===0)YA(),yh(),f.flags|=98560,A=!1;else if(A=v0(f),E!==null&&E.dehydrated!==null){if(d===null){if(!A)throw Error(t(318));if(A=f.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(t(317));A[Jo]=f}else yh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;ii(f),A=!1}else fo!==null&&(aT(fo),fo=null),A=!0;if(!A)return f.flags&65536?f:null}return(f.flags&128)!==0?(f.lanes=y,f):(E=E!==null,E!==(d!==null&&d.memoizedState!==null)&&E&&(f.child.flags|=8192,(f.mode&1)!==0&&(d===null||(Rn.current&1)!==0?cr===0&&(cr=3):uT())),f.updateQueue!==null&&(f.flags|=4),ii(f),null);case 4:return wh(),XC(d,f),d===null&&sm(f.stateNode.containerInfo),ii(f),null;case 10:return CC(f.type._context),ii(f),null;case 17:return Ai(f.type)&&h0(),ii(f),null;case 19:if(fn(Rn),A=f.memoizedState,A===null)return ii(f),null;if(E=(f.flags&128)!==0,j=A.rendering,j===null)if(E)vm(A,!1);else{if(cr!==0||d!==null&&(d.flags&128)!==0)for(d=f.child;d!==null;){if(j=E0(d),j!==null){for(f.flags|=128,vm(A,!1),E=j.updateQueue,E!==null&&(f.updateQueue=E,f.flags|=4),f.subtreeFlags=0,E=y,y=f.child;y!==null;)A=y,d=E,A.flags&=14680066,j=A.alternate,j===null?(A.childLanes=0,A.lanes=d,A.child=null,A.subtreeFlags=0,A.memoizedProps=null,A.memoizedState=null,A.updateQueue=null,A.dependencies=null,A.stateNode=null):(A.childLanes=j.childLanes,A.lanes=j.lanes,A.child=j.child,A.subtreeFlags=0,A.deletions=null,A.memoizedProps=j.memoizedProps,A.memoizedState=j.memoizedState,A.updateQueue=j.updateQueue,A.type=j.type,d=j.dependencies,A.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),y=y.sibling;return ln(Rn,Rn.current&1|2),f.child}d=d.sibling}A.tail!==null&&$n()>Ih&&(f.flags|=128,E=!0,vm(A,!1),f.lanes=4194304)}else{if(!E)if(d=E0(j),d!==null){if(f.flags|=128,E=!0,y=d.updateQueue,y!==null&&(f.updateQueue=y,f.flags|=4),vm(A,!0),A.tail===null&&A.tailMode==="hidden"&&!j.alternate&&!bn)return ii(f),null}else 2*$n()-A.renderingStartTime>Ih&&y!==1073741824&&(f.flags|=128,E=!0,vm(A,!1),f.lanes=4194304);A.isBackwards?(j.sibling=f.child,f.child=j):(y=A.last,y!==null?y.sibling=j:f.child=j,A.last=j)}return A.tail!==null?(f=A.tail,A.rendering=f,A.tail=f.sibling,A.renderingStartTime=$n(),f.sibling=null,y=Rn.current,ln(Rn,E?y&1|2:y&1),f):(ii(f),null);case 22:case 23:return lT(),E=f.memoizedState!==null,d!==null&&d.memoizedState!==null!==E&&(f.flags|=8192),E&&(f.mode&1)!==0?(us&1073741824)!==0&&(ii(f),f.subtreeFlags&6&&(f.flags|=8192)):ii(f),null;case 24:return null;case 25:return null}throw Error(t(156,f.tag))}function Lne(d,f){switch(yC(f),f.tag){case 1:return Ai(f.type)&&h0(),d=f.flags,d&65536?(f.flags=d&-65537|128,f):null;case 3:return wh(),fn(Li),fn(ni),LC(),d=f.flags,(d&65536)!==0&&(d&128)===0?(f.flags=d&-65537|128,f):null;case 5:return xC(f),null;case 13:if(fn(Rn),d=f.memoizedState,d!==null&&d.dehydrated!==null){if(f.alternate===null)throw Error(t(340));yh()}return d=f.flags,d&65536?(f.flags=d&-65537|128,f):null;case 19:return fn(Rn),null;case 4:return wh(),null;case 10:return CC(f.type._context),null;case 22:case 23:return lT(),null;case 24:return null;default:return null}}var A0=!1,si=!1,Ane=typeof WeakSet=="function"?WeakSet:Set,He=null;function Ch(d,f){var y=d.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(E){On(d,f,E)}else y.current=null}function JC(d,f,y){try{y()}catch(E){On(d,f,E)}}var WM=!1;function Mne(d,f){if(lC=Zy,d=TA(),tC(d)){if("selectionStart"in d)var y={start:d.selectionStart,end:d.selectionEnd};else e:{y=(y=d.ownerDocument)&&y.defaultView||window;var E=y.getSelection&&y.getSelection();if(E&&E.rangeCount!==0){y=E.anchorNode;var x=E.anchorOffset,A=E.focusNode;E=E.focusOffset;try{y.nodeType,A.nodeType}catch{y=null;break e}var j=0,X=-1,te=-1,le=0,be=0,we=d,_e=null;t:for(;;){for(var je;we!==y||x!==0&&we.nodeType!==3||(X=j+x),we!==A||E!==0&&we.nodeType!==3||(te=j+E),we.nodeType===3&&(j+=we.nodeValue.length),(je=we.firstChild)!==null;)_e=we,we=je;for(;;){if(we===d)break t;if(_e===y&&++le===x&&(X=j),_e===A&&++be===E&&(te=j),(je=we.nextSibling)!==null)break;we=_e,_e=we.parentNode}we=je}y=X===-1||te===-1?null:{start:X,end:te}}else y=null}y=y||{start:0,end:0}}else y=null;for(uC={focusedElem:d,selectionRange:y},Zy=!1,He=f;He!==null;)if(f=He,d=f.child,(f.subtreeFlags&1028)!==0&&d!==null)d.return=f,He=d;else for(;He!==null;){f=He;try{var Ge=f.alternate;if((f.flags&1024)!==0)switch(f.tag){case 0:case 11:case 15:break;case 1:if(Ge!==null){var We=Ge.memoizedProps,Bn=Ge.memoizedState,se=f.stateNode,re=se.getSnapshotBeforeUpdate(f.elementType===f.type?We:po(f.type,We),Bn);se.__reactInternalSnapshotBeforeUpdate=re}break;case 3:var oe=f.stateNode.containerInfo;oe.nodeType===1?oe.textContent="":oe.nodeType===9&&oe.documentElement&&oe.removeChild(oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ke){On(f,f.return,ke)}if(d=f.sibling,d!==null){d.return=f.return,He=d;break}He=f.return}return Ge=WM,WM=!1,Ge}function ym(d,f,y){var E=f.updateQueue;if(E=E!==null?E.lastEffect:null,E!==null){var x=E=E.next;do{if((x.tag&d)===d){var A=x.destroy;x.destroy=void 0,A!==void 0&&JC(f,y,A)}x=x.next}while(x!==E)}}function M0(d,f){if(f=f.updateQueue,f=f!==null?f.lastEffect:null,f!==null){var y=f=f.next;do{if((y.tag&d)===d){var E=y.create;y.destroy=E()}y=y.next}while(y!==f)}}function ZC(d){var f=d.ref;if(f!==null){var y=d.stateNode;switch(d.tag){case 5:d=y;break;default:d=y}typeof f=="function"?f(d):f.current=d}}function zM(d){var f=d.alternate;f!==null&&(d.alternate=null,zM(f)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(f=d.stateNode,f!==null&&(delete f[Jo],delete f[am],delete f[pC],delete f[mne],delete f[gne])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function YM(d){return d.tag===5||d.tag===3||d.tag===4}function XM(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||YM(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function QC(d,f,y){var E=d.tag;if(E===5||E===6)d=d.stateNode,f?y.nodeType===8?y.parentNode.insertBefore(d,f):y.insertBefore(d,f):(y.nodeType===8?(f=y.parentNode,f.insertBefore(d,y)):(f=y,f.appendChild(d)),y=y._reactRootContainer,y!=null||f.onclick!==null||(f.onclick=u0));else if(E!==4&&(d=d.child,d!==null))for(QC(d,f,y),d=d.sibling;d!==null;)QC(d,f,y),d=d.sibling}function eT(d,f,y){var E=d.tag;if(E===5||E===6)d=d.stateNode,f?y.insertBefore(d,f):y.appendChild(d);else if(E!==4&&(d=d.child,d!==null))for(eT(d,f,y),d=d.sibling;d!==null;)eT(d,f,y),d=d.sibling}var Ur=null,mo=!1;function sl(d,f,y){for(y=y.child;y!==null;)JM(d,f,y),y=y.sibling}function JM(d,f,y){if(Xo&&typeof Xo.onCommitFiberUnmount=="function")try{Xo.onCommitFiberUnmount(Ky,y)}catch{}switch(y.tag){case 5:si||Ch(y,f);case 6:var E=Ur,x=mo;Ur=null,sl(d,f,y),Ur=E,mo=x,Ur!==null&&(mo?(d=Ur,y=y.stateNode,d.nodeType===8?d.parentNode.removeChild(y):d.removeChild(y)):Ur.removeChild(y.stateNode));break;case 18:Ur!==null&&(mo?(d=Ur,y=y.stateNode,d.nodeType===8?fC(d.parentNode,y):d.nodeType===1&&fC(d,y),Xp(d)):fC(Ur,y.stateNode));break;case 4:E=Ur,x=mo,Ur=y.stateNode.containerInfo,mo=!0,sl(d,f,y),Ur=E,mo=x;break;case 0:case 11:case 14:case 15:if(!si&&(E=y.updateQueue,E!==null&&(E=E.lastEffect,E!==null))){x=E=E.next;do{var A=x,j=A.destroy;A=A.tag,j!==void 0&&((A&2)!==0||(A&4)!==0)&&JC(y,f,j),x=x.next}while(x!==E)}sl(d,f,y);break;case 1:if(!si&&(Ch(y,f),E=y.stateNode,typeof E.componentWillUnmount=="function"))try{E.props=y.memoizedProps,E.state=y.memoizedState,E.componentWillUnmount()}catch(X){On(y,f,X)}sl(d,f,y);break;case 21:sl(d,f,y);break;case 22:y.mode&1?(si=(E=si)||y.memoizedState!==null,sl(d,f,y),si=E):sl(d,f,y);break;default:sl(d,f,y)}}function ZM(d){var f=d.updateQueue;if(f!==null){d.updateQueue=null;var y=d.stateNode;y===null&&(y=d.stateNode=new Ane),f.forEach(function(E){var x=Hne.bind(null,d,E);y.has(E)||(y.add(E),E.then(x,x))})}}function go(d,f){var y=f.deletions;if(y!==null)for(var E=0;E<y.length;E++){var x=y[E];try{var A=d,j=f,X=j;e:for(;X!==null;){switch(X.tag){case 5:Ur=X.stateNode,mo=!1;break e;case 3:Ur=X.stateNode.containerInfo,mo=!0;break e;case 4:Ur=X.stateNode.containerInfo,mo=!0;break e}X=X.return}if(Ur===null)throw Error(t(160));JM(A,j,x),Ur=null,mo=!1;var te=x.alternate;te!==null&&(te.return=null),x.return=null}catch(le){On(x,f,le)}}if(f.subtreeFlags&12854)for(f=f.child;f!==null;)QM(f,d),f=f.sibling}function QM(d,f){var y=d.alternate,E=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(go(f,d),ea(d),E&4){try{ym(3,d,d.return),M0(3,d)}catch(We){On(d,d.return,We)}try{ym(5,d,d.return)}catch(We){On(d,d.return,We)}}break;case 1:go(f,d),ea(d),E&512&&y!==null&&Ch(y,y.return);break;case 5:if(go(f,d),ea(d),E&512&&y!==null&&Ch(y,y.return),d.flags&32){var x=d.stateNode;try{W(x,"")}catch(We){On(d,d.return,We)}}if(E&4&&(x=d.stateNode,x!=null)){var A=d.memoizedProps,j=y!==null?y.memoizedProps:A,X=d.type,te=d.updateQueue;if(d.updateQueue=null,te!==null)try{X==="input"&&A.type==="radio"&&A.name!=null&&In(x,A),Qt(X,j);var le=Qt(X,A);for(j=0;j<te.length;j+=2){var be=te[j],we=te[j+1];be==="style"?dt(x,we):be==="dangerouslySetInnerHTML"?N(x,we):be==="children"?W(x,we):k(x,be,we,le)}switch(X){case"input":Qn(x,A);break;case"textarea":xi(x,A);break;case"select":var _e=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!A.multiple;var je=A.value;je!=null?Qr(x,!!A.multiple,je,!1):_e!==!!A.multiple&&(A.defaultValue!=null?Qr(x,!!A.multiple,A.defaultValue,!0):Qr(x,!!A.multiple,A.multiple?[]:"",!1))}x[am]=A}catch(We){On(d,d.return,We)}}break;case 6:if(go(f,d),ea(d),E&4){if(d.stateNode===null)throw Error(t(162));x=d.stateNode,A=d.memoizedProps;try{x.nodeValue=A}catch(We){On(d,d.return,We)}}break;case 3:if(go(f,d),ea(d),E&4&&y!==null&&y.memoizedState.isDehydrated)try{Xp(f.containerInfo)}catch(We){On(d,d.return,We)}break;case 4:go(f,d),ea(d);break;case 13:go(f,d),ea(d),x=d.child,x.flags&8192&&(A=x.memoizedState!==null,x.stateNode.isHidden=A,!A||x.alternate!==null&&x.alternate.memoizedState!==null||(rT=$n())),E&4&&ZM(d);break;case 22:if(be=y!==null&&y.memoizedState!==null,d.mode&1?(si=(le=si)||be,go(f,d),si=le):go(f,d),ea(d),E&8192){if(le=d.memoizedState!==null,(d.stateNode.isHidden=le)&&!be&&(d.mode&1)!==0)for(He=d,be=d.child;be!==null;){for(we=He=be;He!==null;){switch(_e=He,je=_e.child,_e.tag){case 0:case 11:case 14:case 15:ym(4,_e,_e.return);break;case 1:Ch(_e,_e.return);var Ge=_e.stateNode;if(typeof Ge.componentWillUnmount=="function"){E=_e,y=_e.return;try{f=E,Ge.props=f.memoizedProps,Ge.state=f.memoizedState,Ge.componentWillUnmount()}catch(We){On(E,y,We)}}break;case 5:Ch(_e,_e.return);break;case 22:if(_e.memoizedState!==null){nO(we);continue}}je!==null?(je.return=_e,He=je):nO(we)}be=be.sibling}e:for(be=null,we=d;;){if(we.tag===5){if(be===null){be=we;try{x=we.stateNode,le?(A=x.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none"):(X=we.stateNode,te=we.memoizedProps.style,j=te!=null&&te.hasOwnProperty("display")?te.display:null,X.style.display=ge("display",j))}catch(We){On(d,d.return,We)}}}else if(we.tag===6){if(be===null)try{we.stateNode.nodeValue=le?"":we.memoizedProps}catch(We){On(d,d.return,We)}}else if((we.tag!==22&&we.tag!==23||we.memoizedState===null||we===d)&&we.child!==null){we.child.return=we,we=we.child;continue}if(we===d)break e;for(;we.sibling===null;){if(we.return===null||we.return===d)break e;be===we&&(be=null),we=we.return}be===we&&(be=null),we.sibling.return=we.return,we=we.sibling}}break;case 19:go(f,d),ea(d),E&4&&ZM(d);break;case 21:break;default:go(f,d),ea(d)}}function ea(d){var f=d.flags;if(f&2){try{e:{for(var y=d.return;y!==null;){if(YM(y)){var E=y;break e}y=y.return}throw Error(t(160))}switch(E.tag){case 5:var x=E.stateNode;E.flags&32&&(W(x,""),E.flags&=-33);var A=XM(d);eT(d,A,x);break;case 3:case 4:var j=E.stateNode.containerInfo,X=XM(d);QC(d,X,j);break;default:throw Error(t(161))}}catch(te){On(d,d.return,te)}d.flags&=-3}f&4096&&(d.flags&=-4097)}function One(d,f,y){He=d,eO(d)}function eO(d,f,y){for(var E=(d.mode&1)!==0;He!==null;){var x=He,A=x.child;if(x.tag===22&&E){var j=x.memoizedState!==null||A0;if(!j){var X=x.alternate,te=X!==null&&X.memoizedState!==null||si;X=A0;var le=si;if(A0=j,(si=te)&&!le)for(He=x;He!==null;)j=He,te=j.child,j.tag===22&&j.memoizedState!==null?rO(x):te!==null?(te.return=j,He=te):rO(x);for(;A!==null;)He=A,eO(A),A=A.sibling;He=x,A0=X,si=le}tO(d)}else(x.subtreeFlags&8772)!==0&&A!==null?(A.return=x,He=A):tO(d)}}function tO(d){for(;He!==null;){var f=He;if((f.flags&8772)!==0){var y=f.alternate;try{if((f.flags&8772)!==0)switch(f.tag){case 0:case 11:case 15:si||M0(5,f);break;case 1:var E=f.stateNode;if(f.flags&4&&!si)if(y===null)E.componentDidMount();else{var x=f.elementType===f.type?y.memoizedProps:po(f.type,y.memoizedProps);E.componentDidUpdate(x,y.memoizedState,E.__reactInternalSnapshotBeforeUpdate)}var A=f.updateQueue;A!==null&&nM(f,A,E);break;case 3:var j=f.updateQueue;if(j!==null){if(y=null,f.child!==null)switch(f.child.tag){case 5:y=f.child.stateNode;break;case 1:y=f.child.stateNode}nM(f,j,y)}break;case 5:var X=f.stateNode;if(y===null&&f.flags&4){y=X;var te=f.memoizedProps;switch(f.type){case"button":case"input":case"select":case"textarea":te.autoFocus&&y.focus();break;case"img":te.src&&(y.src=te.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(f.memoizedState===null){var le=f.alternate;if(le!==null){var be=le.memoizedState;if(be!==null){var we=be.dehydrated;we!==null&&Xp(we)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}si||f.flags&512&&ZC(f)}catch(_e){On(f,f.return,_e)}}if(f===d){He=null;break}if(y=f.sibling,y!==null){y.return=f.return,He=y;break}He=f.return}}function nO(d){for(;He!==null;){var f=He;if(f===d){He=null;break}var y=f.sibling;if(y!==null){y.return=f.return,He=y;break}He=f.return}}function rO(d){for(;He!==null;){var f=He;try{switch(f.tag){case 0:case 11:case 15:var y=f.return;try{M0(4,f)}catch(te){On(f,y,te)}break;case 1:var E=f.stateNode;if(typeof E.componentDidMount=="function"){var x=f.return;try{E.componentDidMount()}catch(te){On(f,x,te)}}var A=f.return;try{ZC(f)}catch(te){On(f,A,te)}break;case 5:var j=f.return;try{ZC(f)}catch(te){On(f,j,te)}}}catch(te){On(f,f.return,te)}if(f===d){He=null;break}var X=f.sibling;if(X!==null){X.return=f.return,He=X;break}He=f.return}}var Nne=Math.ceil,O0=I.ReactCurrentDispatcher,tT=I.ReactCurrentOwner,Ms=I.ReactCurrentBatchConfig,Mt=0,Er=null,er=null,jr=0,us=0,Th=el(0),cr=0,_m=null,Au=0,N0=0,nT=0,bm=null,Oi=null,rT=0,Ih=1/0,Xa=null,D0=!1,iT=null,ol=null,F0=!1,al=null,U0=0,Sm=0,sT=null,j0=-1,$0=0;function gi(){return(Mt&6)!==0?$n():j0!==-1?j0:j0=$n()}function cl(d){return(d.mode&1)===0?1:(Mt&2)!==0&&jr!==0?jr&-jr:yne.transition!==null?($0===0&&($0=X4()),$0):(d=zt,d!==0||(d=window.event,d=d===void 0?16:sA(d.type)),d)}function vo(d,f,y,E){if(50<Sm)throw Sm=0,sT=null,Error(t(185));qp(d,y,E),((Mt&2)===0||d!==Er)&&(d===Er&&((Mt&2)===0&&(N0|=y),cr===4&&ll(d,jr)),Ni(d,E),y===1&&Mt===0&&(f.mode&1)===0&&(Ih=$n()+500,p0&&nl()))}function Ni(d,f){var y=d.callbackNode;yte(d,f);var E=Yy(d,d===Er?jr:0);if(E===0)y!==null&&W4(y),d.callbackNode=null,d.callbackPriority=0;else if(f=E&-E,d.callbackPriority!==f){if(y!=null&&W4(y),f===1)d.tag===0?vne(sO.bind(null,d)):GA(sO.bind(null,d)),fne(function(){(Mt&6)===0&&nl()}),y=null;else{switch(J4(E)){case 1:y=UE;break;case 4:y=z4;break;case 16:y=qy;break;case 536870912:y=Y4;break;default:y=qy}y=fO(y,iO.bind(null,d))}d.callbackPriority=f,d.callbackNode=y}}function iO(d,f){if(j0=-1,$0=0,(Mt&6)!==0)throw Error(t(327));var y=d.callbackNode;if(Rh()&&d.callbackNode!==y)return null;var E=Yy(d,d===Er?jr:0);if(E===0)return null;if((E&30)!==0||(E&d.expiredLanes)!==0||f)f=B0(d,E);else{f=E;var x=Mt;Mt|=2;var A=aO();(Er!==d||jr!==f)&&(Xa=null,Ih=$n()+500,Ou(d,f));do try{Une();break}catch(X){oO(d,X)}while(!0);EC(),O0.current=A,Mt=x,er!==null?f=0:(Er=null,jr=0,f=cr)}if(f!==0){if(f===2&&(x=jE(d),x!==0&&(E=x,f=oT(d,x))),f===1)throw y=_m,Ou(d,0),ll(d,E),Ni(d,$n()),y;if(f===6)ll(d,E);else{if(x=d.current.alternate,(E&30)===0&&!Dne(x)&&(f=B0(d,E),f===2&&(A=jE(d),A!==0&&(E=A,f=oT(d,A))),f===1))throw y=_m,Ou(d,0),ll(d,E),Ni(d,$n()),y;switch(d.finishedWork=x,d.finishedLanes=E,f){case 0:case 1:throw Error(t(345));case 2:Nu(d,Oi,Xa);break;case 3:if(ll(d,E),(E&130023424)===E&&(f=rT+500-$n(),10<f)){if(Yy(d,0)!==0)break;if(x=d.suspendedLanes,(x&E)!==E){gi(),d.pingedLanes|=d.suspendedLanes&x;break}d.timeoutHandle=hC(Nu.bind(null,d,Oi,Xa),f);break}Nu(d,Oi,Xa);break;case 4:if(ll(d,E),(E&4194240)===E)break;for(f=d.eventTimes,x=-1;0<E;){var j=31-uo(E);A=1<<j,j=f[j],j>x&&(x=j),E&=~A}if(E=x,E=$n()-E,E=(120>E?120:480>E?480:1080>E?1080:1920>E?1920:3e3>E?3e3:4320>E?4320:1960*Nne(E/1960))-E,10<E){d.timeoutHandle=hC(Nu.bind(null,d,Oi,Xa),E);break}Nu(d,Oi,Xa);break;case 5:Nu(d,Oi,Xa);break;default:throw Error(t(329))}}}return Ni(d,$n()),d.callbackNode===y?iO.bind(null,d):null}function oT(d,f){var y=bm;return d.current.memoizedState.isDehydrated&&(Ou(d,f).flags|=256),d=B0(d,f),d!==2&&(f=Oi,Oi=y,f!==null&&aT(f)),d}function aT(d){Oi===null?Oi=d:Oi.push.apply(Oi,d)}function Dne(d){for(var f=d;;){if(f.flags&16384){var y=f.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var E=0;E<y.length;E++){var x=y[E],A=x.getSnapshot;x=x.value;try{if(!ho(A(),x))return!1}catch{return!1}}}if(y=f.child,f.subtreeFlags&16384&&y!==null)y.return=f,f=y;else{if(f===d)break;for(;f.sibling===null;){if(f.return===null||f.return===d)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function ll(d,f){for(f&=~nT,f&=~N0,d.suspendedLanes|=f,d.pingedLanes&=~f,d=d.expirationTimes;0<f;){var y=31-uo(f),E=1<<y;d[y]=-1,f&=~E}}function sO(d){if((Mt&6)!==0)throw Error(t(327));Rh();var f=Yy(d,0);if((f&1)===0)return Ni(d,$n()),null;var y=B0(d,f);if(d.tag!==0&&y===2){var E=jE(d);E!==0&&(f=E,y=oT(d,E))}if(y===1)throw y=_m,Ou(d,0),ll(d,f),Ni(d,$n()),y;if(y===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=f,Nu(d,Oi,Xa),Ni(d,$n()),null}function cT(d,f){var y=Mt;Mt|=1;try{return d(f)}finally{Mt=y,Mt===0&&(Ih=$n()+500,p0&&nl())}}function Mu(d){al!==null&&al.tag===0&&(Mt&6)===0&&Rh();var f=Mt;Mt|=1;var y=Ms.transition,E=zt;try{if(Ms.transition=null,zt=1,d)return d()}finally{zt=E,Ms.transition=y,Mt=f,(Mt&6)===0&&nl()}}function lT(){us=Th.current,fn(Th)}function Ou(d,f){d.finishedWork=null,d.finishedLanes=0;var y=d.timeoutHandle;if(y!==-1&&(d.timeoutHandle=-1,hne(y)),er!==null)for(y=er.return;y!==null;){var E=y;switch(yC(E),E.tag){case 1:E=E.type.childContextTypes,E!=null&&h0();break;case 3:wh(),fn(Li),fn(ni),LC();break;case 5:xC(E);break;case 4:wh();break;case 13:fn(Rn);break;case 19:fn(Rn);break;case 10:CC(E.type._context);break;case 22:case 23:lT()}y=y.return}if(Er=d,er=d=ul(d.current,null),jr=us=f,cr=0,_m=null,nT=N0=Au=0,Oi=bm=null,xu!==null){for(f=0;f<xu.length;f++)if(y=xu[f],E=y.interleaved,E!==null){y.interleaved=null;var x=E.next,A=y.pending;if(A!==null){var j=A.next;A.next=x,E.next=j}y.pending=E}xu=null}return d}function oO(d,f){do{var y=er;try{if(EC(),C0.current=k0,T0){for(var E=kn.memoizedState;E!==null;){var x=E.queue;x!==null&&(x.pending=null),E=E.next}T0=!1}if(Lu=0,wr=ar=kn=null,fm=!1,pm=0,tT.current=null,y===null||y.return===null){cr=1,_m=f,er=null;break}e:{var A=d,j=y.return,X=y,te=f;if(f=jr,X.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){var le=te,be=X,we=be.tag;if((be.mode&1)===0&&(we===0||we===11||we===15)){var _e=be.alternate;_e?(be.updateQueue=_e.updateQueue,be.memoizedState=_e.memoizedState,be.lanes=_e.lanes):(be.updateQueue=null,be.memoizedState=null)}var je=LM(j);if(je!==null){je.flags&=-257,AM(je,j,X,A,f),je.mode&1&&PM(A,le,f),f=je,te=le;var Ge=f.updateQueue;if(Ge===null){var We=new Set;We.add(te),f.updateQueue=We}else Ge.add(te);break e}else{if((f&1)===0){PM(A,le,f),uT();break e}te=Error(t(426))}}else if(bn&&X.mode&1){var Bn=LM(j);if(Bn!==null){(Bn.flags&65536)===0&&(Bn.flags|=256),AM(Bn,j,X,A,f),SC(Eh(te,X));break e}}A=te=Eh(te,X),cr!==4&&(cr=2),bm===null?bm=[A]:bm.push(A),A=j;do{switch(A.tag){case 3:A.flags|=65536,f&=-f,A.lanes|=f;var se=kM(A,te,f);tM(A,se);break e;case 1:X=te;var re=A.type,oe=A.stateNode;if((A.flags&128)===0&&(typeof re.getDerivedStateFromError=="function"||oe!==null&&typeof oe.componentDidCatch=="function"&&(ol===null||!ol.has(oe)))){A.flags|=65536,f&=-f,A.lanes|=f;var ke=xM(A,X,f);tM(A,ke);break e}}A=A.return}while(A!==null)}lO(y)}catch(Ye){f=Ye,er===y&&y!==null&&(er=y=y.return);continue}break}while(!0)}function aO(){var d=O0.current;return O0.current=k0,d===null?k0:d}function uT(){(cr===0||cr===3||cr===2)&&(cr=4),Er===null||(Au&268435455)===0&&(N0&268435455)===0||ll(Er,jr)}function B0(d,f){var y=Mt;Mt|=2;var E=aO();(Er!==d||jr!==f)&&(Xa=null,Ou(d,f));do try{Fne();break}catch(x){oO(d,x)}while(!0);if(EC(),Mt=y,O0.current=E,er!==null)throw Error(t(261));return Er=null,jr=0,cr}function Fne(){for(;er!==null;)cO(er)}function Une(){for(;er!==null&&!lte();)cO(er)}function cO(d){var f=hO(d.alternate,d,us);d.memoizedProps=d.pendingProps,f===null?lO(d):er=f,tT.current=null}function lO(d){var f=d;do{var y=f.alternate;if(d=f.return,(f.flags&32768)===0){if(y=Pne(y,f,us),y!==null){er=y;return}}else{if(y=Lne(y,f),y!==null){y.flags&=32767,er=y;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{cr=6,er=null;return}}if(f=f.sibling,f!==null){er=f;return}er=f=d}while(f!==null);cr===0&&(cr=5)}function Nu(d,f,y){var E=zt,x=Ms.transition;try{Ms.transition=null,zt=1,jne(d,f,y,E)}finally{Ms.transition=x,zt=E}return null}function jne(d,f,y,E){do Rh();while(al!==null);if((Mt&6)!==0)throw Error(t(327));y=d.finishedWork;var x=d.finishedLanes;if(y===null)return null;if(d.finishedWork=null,d.finishedLanes=0,y===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var A=y.lanes|y.childLanes;if(_te(d,A),d===Er&&(er=Er=null,jr=0),(y.subtreeFlags&2064)===0&&(y.flags&2064)===0||F0||(F0=!0,fO(qy,function(){return Rh(),null})),A=(y.flags&15990)!==0,(y.subtreeFlags&15990)!==0||A){A=Ms.transition,Ms.transition=null;var j=zt;zt=1;var X=Mt;Mt|=4,tT.current=null,Mne(d,y),QM(y,d),sne(uC),Zy=!!lC,uC=lC=null,d.current=y,One(y),ute(),Mt=X,zt=j,Ms.transition=A}else d.current=y;if(F0&&(F0=!1,al=d,U0=x),A=d.pendingLanes,A===0&&(ol=null),fte(y.stateNode),Ni(d,$n()),f!==null)for(E=d.onRecoverableError,y=0;y<f.length;y++)x=f[y],E(x.value,{componentStack:x.stack,digest:x.digest});if(D0)throw D0=!1,d=iT,iT=null,d;return(U0&1)!==0&&d.tag!==0&&Rh(),A=d.pendingLanes,(A&1)!==0?d===sT?Sm++:(Sm=0,sT=d):Sm=0,nl(),null}function Rh(){if(al!==null){var d=J4(U0),f=Ms.transition,y=zt;try{if(Ms.transition=null,zt=16>d?16:d,al===null)var E=!1;else{if(d=al,al=null,U0=0,(Mt&6)!==0)throw Error(t(331));var x=Mt;for(Mt|=4,He=d.current;He!==null;){var A=He,j=A.child;if((He.flags&16)!==0){var X=A.deletions;if(X!==null){for(var te=0;te<X.length;te++){var le=X[te];for(He=le;He!==null;){var be=He;switch(be.tag){case 0:case 11:case 15:ym(8,be,A)}var we=be.child;if(we!==null)we.return=be,He=we;else for(;He!==null;){be=He;var _e=be.sibling,je=be.return;if(zM(be),be===le){He=null;break}if(_e!==null){_e.return=je,He=_e;break}He=je}}}var Ge=A.alternate;if(Ge!==null){var We=Ge.child;if(We!==null){Ge.child=null;do{var Bn=We.sibling;We.sibling=null,We=Bn}while(We!==null)}}He=A}}if((A.subtreeFlags&2064)!==0&&j!==null)j.return=A,He=j;else e:for(;He!==null;){if(A=He,(A.flags&2048)!==0)switch(A.tag){case 0:case 11:case 15:ym(9,A,A.return)}var se=A.sibling;if(se!==null){se.return=A.return,He=se;break e}He=A.return}}var re=d.current;for(He=re;He!==null;){j=He;var oe=j.child;if((j.subtreeFlags&2064)!==0&&oe!==null)oe.return=j,He=oe;else e:for(j=re;He!==null;){if(X=He,(X.flags&2048)!==0)try{switch(X.tag){case 0:case 11:case 15:M0(9,X)}}catch(Ye){On(X,X.return,Ye)}if(X===j){He=null;break e}var ke=X.sibling;if(ke!==null){ke.return=X.return,He=ke;break e}He=X.return}}if(Mt=x,nl(),Xo&&typeof Xo.onPostCommitFiberRoot=="function")try{Xo.onPostCommitFiberRoot(Ky,d)}catch{}E=!0}return E}finally{zt=y,Ms.transition=f}}return!1}function uO(d,f,y){f=Eh(y,f),f=kM(d,f,1),d=il(d,f,1),f=gi(),d!==null&&(qp(d,1,f),Ni(d,f))}function On(d,f,y){if(d.tag===3)uO(d,d,y);else for(;f!==null;){if(f.tag===3){uO(f,d,y);break}else if(f.tag===1){var E=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(ol===null||!ol.has(E))){d=Eh(y,d),d=xM(f,d,1),f=il(f,d,1),d=gi(),f!==null&&(qp(f,1,d),Ni(f,d));break}}f=f.return}}function $ne(d,f,y){var E=d.pingCache;E!==null&&E.delete(f),f=gi(),d.pingedLanes|=d.suspendedLanes&y,Er===d&&(jr&y)===y&&(cr===4||cr===3&&(jr&130023424)===jr&&500>$n()-rT?Ou(d,0):nT|=y),Ni(d,f)}function dO(d,f){f===0&&((d.mode&1)===0?f=1:(f=zy,zy<<=1,(zy&130023424)===0&&(zy=4194304)));var y=gi();d=Wa(d,f),d!==null&&(qp(d,f,y),Ni(d,y))}function Bne(d){var f=d.memoizedState,y=0;f!==null&&(y=f.retryLane),dO(d,y)}function Hne(d,f){var y=0;switch(d.tag){case 13:var E=d.stateNode,x=d.memoizedState;x!==null&&(y=x.retryLane);break;case 19:E=d.stateNode;break;default:throw Error(t(314))}E!==null&&E.delete(f),dO(d,y)}var hO;hO=function(d,f,y){if(d!==null)if(d.memoizedProps!==f.pendingProps||Li.current)Mi=!0;else{if((d.lanes&y)===0&&(f.flags&128)===0)return Mi=!1,xne(d,f,y);Mi=(d.flags&131072)!==0}else Mi=!1,bn&&(f.flags&1048576)!==0&&qA(f,g0,f.index);switch(f.lanes=0,f.tag){case 2:var E=f.type;L0(d,f),d=f.pendingProps;var x=mh(f,ni.current);Sh(f,y),x=OC(null,f,E,d,x,y);var A=NC();return f.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(f.tag=1,f.memoizedState=null,f.updateQueue=null,Ai(E)?(A=!0,f0(f)):A=!1,f.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,RC(f),x.updater=x0,f.stateNode=x,x._reactInternals=f,BC(f,E,d,y),f=qC(null,f,E,!0,A,y)):(f.tag=0,bn&&A&&vC(f),mi(null,f,x,y),f=f.child),f;case 16:E=f.elementType;e:{switch(L0(d,f),d=f.pendingProps,x=E._init,E=x(E._payload),f.type=E,x=f.tag=Gne(E),d=po(E,d),x){case 0:f=GC(null,f,E,d,y);break e;case 1:f=UM(null,f,E,d,y);break e;case 11:f=MM(null,f,E,d,y);break e;case 14:f=OM(null,f,E,po(E.type,d),y);break e}throw Error(t(306,E,""))}return f;case 0:return E=f.type,x=f.pendingProps,x=f.elementType===E?x:po(E,x),GC(d,f,E,x,y);case 1:return E=f.type,x=f.pendingProps,x=f.elementType===E?x:po(E,x),UM(d,f,E,x,y);case 3:e:{if(jM(f),d===null)throw Error(t(387));E=f.pendingProps,A=f.memoizedState,x=A.element,eM(d,f),w0(f,E,null,y);var j=f.memoizedState;if(E=j.element,A.isDehydrated)if(A={element:E,isDehydrated:!1,cache:j.cache,pendingSuspenseBoundaries:j.pendingSuspenseBoundaries,transitions:j.transitions},f.updateQueue.baseState=A,f.memoizedState=A,f.flags&256){x=Eh(Error(t(423)),f),f=$M(d,f,E,y,x);break e}else if(E!==x){x=Eh(Error(t(424)),f),f=$M(d,f,E,y,x);break e}else for(ls=Qc(f.stateNode.containerInfo.firstChild),cs=f,bn=!0,fo=null,y=ZA(f,null,E,y),f.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(yh(),E===x){f=Ya(d,f,y);break e}mi(d,f,E,y)}f=f.child}return f;case 5:return rM(f),d===null&&bC(f),E=f.type,x=f.pendingProps,A=d!==null?d.memoizedProps:null,j=x.children,dC(E,x)?j=null:A!==null&&dC(E,A)&&(f.flags|=32),FM(d,f),mi(d,f,j,y),f.child;case 6:return d===null&&bC(f),null;case 13:return BM(d,f,y);case 4:return kC(f,f.stateNode.containerInfo),E=f.pendingProps,d===null?f.child=_h(f,null,E,y):mi(d,f,E,y),f.child;case 11:return E=f.type,x=f.pendingProps,x=f.elementType===E?x:po(E,x),MM(d,f,E,x,y);case 7:return mi(d,f,f.pendingProps,y),f.child;case 8:return mi(d,f,f.pendingProps.children,y),f.child;case 12:return mi(d,f,f.pendingProps.children,y),f.child;case 10:e:{if(E=f.type._context,x=f.pendingProps,A=f.memoizedProps,j=x.value,ln(_0,E._currentValue),E._currentValue=j,A!==null)if(ho(A.value,j)){if(A.children===x.children&&!Li.current){f=Ya(d,f,y);break e}}else for(A=f.child,A!==null&&(A.return=f);A!==null;){var X=A.dependencies;if(X!==null){j=A.child;for(var te=X.firstContext;te!==null;){if(te.context===E){if(A.tag===1){te=za(-1,y&-y),te.tag=2;var le=A.updateQueue;if(le!==null){le=le.shared;var be=le.pending;be===null?te.next=te:(te.next=be.next,be.next=te),le.pending=te}}A.lanes|=y,te=A.alternate,te!==null&&(te.lanes|=y),TC(A.return,y,f),X.lanes|=y;break}te=te.next}}else if(A.tag===10)j=A.type===f.type?null:A.child;else if(A.tag===18){if(j=A.return,j===null)throw Error(t(341));j.lanes|=y,X=j.alternate,X!==null&&(X.lanes|=y),TC(j,y,f),j=A.sibling}else j=A.child;if(j!==null)j.return=A;else for(j=A;j!==null;){if(j===f){j=null;break}if(A=j.sibling,A!==null){A.return=j.return,j=A;break}j=j.return}A=j}mi(d,f,x.children,y),f=f.child}return f;case 9:return x=f.type,E=f.pendingProps.children,Sh(f,y),x=Ls(x),E=E(x),f.flags|=1,mi(d,f,E,y),f.child;case 14:return E=f.type,x=po(E,f.pendingProps),x=po(E.type,x),OM(d,f,E,x,y);case 15:return NM(d,f,f.type,f.pendingProps,y);case 17:return E=f.type,x=f.pendingProps,x=f.elementType===E?x:po(E,x),L0(d,f),f.tag=1,Ai(E)?(d=!0,f0(f)):d=!1,Sh(f,y),IM(f,E,x),BC(f,E,x,y),qC(null,f,E,!0,d,y);case 19:return VM(d,f,y);case 22:return DM(d,f,y)}throw Error(t(156,f.tag))};function fO(d,f){return K4(d,f)}function Vne(d,f,y,E){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Os(d,f,y,E){return new Vne(d,f,y,E)}function dT(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Gne(d){if(typeof d=="function")return dT(d)?1:0;if(d!=null){if(d=d.$$typeof,d===B)return 11;if(d===H)return 14}return 2}function ul(d,f){var y=d.alternate;return y===null?(y=Os(d.tag,f,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=f,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&14680064,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,f=d.dependencies,y.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y}function H0(d,f,y,E,x,A){var j=2;if(E=d,typeof d=="function")dT(d)&&(j=1);else if(typeof d=="string")j=5;else e:switch(d){case P:return Du(y.children,x,A,f);case M:j=8,x|=8;break;case D:return d=Os(12,y,f,x|2),d.elementType=D,d.lanes=A,d;case V:return d=Os(13,y,f,x),d.elementType=V,d.lanes=A,d;case z:return d=Os(19,y,f,x),d.elementType=z,d.lanes=A,d;case Y:return V0(y,x,A,f);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case F:j=10;break e;case U:j=9;break e;case B:j=11;break e;case H:j=14;break e;case J:j=16,E=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return f=Os(j,y,f,x),f.elementType=d,f.type=E,f.lanes=A,f}function Du(d,f,y,E){return d=Os(7,d,E,f),d.lanes=y,d}function V0(d,f,y,E){return d=Os(22,d,E,f),d.elementType=Y,d.lanes=y,d.stateNode={isHidden:!1},d}function hT(d,f,y){return d=Os(6,d,null,f),d.lanes=y,d}function fT(d,f,y){return f=Os(4,d.children!==null?d.children:[],d.key,f),f.lanes=y,f.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},f}function qne(d,f,y,E,x){this.tag=f,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$E(0),this.expirationTimes=$E(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$E(0),this.identifierPrefix=E,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function pT(d,f,y,E,x,A,j,X,te){return d=new qne(d,f,y,X,te),f===1?(f=1,A===!0&&(f|=8)):f=0,A=Os(3,null,null,f),d.current=A,A.stateNode=d,A.memoizedState={element:E,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},RC(A),d}function Kne(d,f,y){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:C,key:E==null?null:""+E,children:d,containerInfo:f,implementation:y}}function pO(d){if(!d)return tl;d=d._reactInternals;e:{if(Cu(d)!==d||d.tag!==1)throw Error(t(170));var f=d;do{switch(f.tag){case 3:f=f.stateNode.context;break e;case 1:if(Ai(f.type)){f=f.stateNode.__reactInternalMemoizedMergedChildContext;break e}}f=f.return}while(f!==null);throw Error(t(171))}if(d.tag===1){var y=d.type;if(Ai(y))return HA(d,y,f)}return f}function mO(d,f,y,E,x,A,j,X,te){return d=pT(y,E,!0,d,x,A,j,X,te),d.context=pO(null),y=d.current,E=gi(),x=cl(y),A=za(E,x),A.callback=f??null,il(y,A,x),d.current.lanes=x,qp(d,x,E),Ni(d,E),d}function G0(d,f,y,E){var x=f.current,A=gi(),j=cl(x);return y=pO(y),f.context===null?f.context=y:f.pendingContext=y,f=za(A,j),f.payload={element:d},E=E===void 0?null:E,E!==null&&(f.callback=E),d=il(x,f,j),d!==null&&(vo(d,x,j,A),S0(d,x,j)),j}function q0(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function gO(d,f){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<f?y:f}}function mT(d,f){gO(d,f),(d=d.alternate)&&gO(d,f)}function Wne(){return null}var vO=typeof reportError=="function"?reportError:function(d){console.error(d)};function gT(d){this._internalRoot=d}K0.prototype.render=gT.prototype.render=function(d){var f=this._internalRoot;if(f===null)throw Error(t(409));G0(d,f,null,null)},K0.prototype.unmount=gT.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var f=d.containerInfo;Mu(function(){G0(null,d,null,null)}),f[Va]=null}};function K0(d){this._internalRoot=d}K0.prototype.unstable_scheduleHydration=function(d){if(d){var f=eA();d={blockedOn:null,target:d,priority:f};for(var y=0;y<Xc.length&&f!==0&&f<Xc[y].priority;y++);Xc.splice(y,0,d),y===0&&rA(d)}};function vT(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function W0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function yO(){}function zne(d,f,y,E,x){if(x){if(typeof E=="function"){var A=E;E=function(){var le=q0(j);A.call(le)}}var j=mO(f,E,d,0,null,!1,!1,"",yO);return d._reactRootContainer=j,d[Va]=j.current,sm(d.nodeType===8?d.parentNode:d),Mu(),j}for(;x=d.lastChild;)d.removeChild(x);if(typeof E=="function"){var X=E;E=function(){var le=q0(te);X.call(le)}}var te=pT(d,0,!1,null,null,!1,!1,"",yO);return d._reactRootContainer=te,d[Va]=te.current,sm(d.nodeType===8?d.parentNode:d),Mu(function(){G0(f,te,y,E)}),te}function z0(d,f,y,E,x){var A=y._reactRootContainer;if(A){var j=A;if(typeof x=="function"){var X=x;x=function(){var te=q0(j);X.call(te)}}G0(f,j,d,x)}else j=zne(y,f,d,x,E);return q0(j)}Z4=function(d){switch(d.tag){case 3:var f=d.stateNode;if(f.current.memoizedState.isDehydrated){var y=Gp(f.pendingLanes);y!==0&&(BE(f,y|1),Ni(f,$n()),(Mt&6)===0&&(Ih=$n()+500,nl()))}break;case 13:Mu(function(){var E=Wa(d,1);if(E!==null){var x=gi();vo(E,d,1,x)}}),mT(d,1)}},HE=function(d){if(d.tag===13){var f=Wa(d,134217728);if(f!==null){var y=gi();vo(f,d,134217728,y)}mT(d,134217728)}},Q4=function(d){if(d.tag===13){var f=cl(d),y=Wa(d,f);if(y!==null){var E=gi();vo(y,d,f,E)}mT(d,f)}},eA=function(){return zt},tA=function(d,f){var y=zt;try{return zt=d,f()}finally{zt=y}},Lt=function(d,f,y){switch(f){case"input":if(Qn(d,y),f=y.name,y.type==="radio"&&f!=null){for(y=d;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+f)+'][type="radio"]'),f=0;f<y.length;f++){var E=y[f];if(E!==d&&E.form===d.form){var x=d0(E);if(!x)throw Error(t(90));Jt(E),Qn(E,x)}}}break;case"textarea":xi(d,y);break;case"select":f=y.value,f!=null&&Qr(d,!!y.multiple,f,!1)}},ao=cT,Pi=Mu;var Yne={usingClientEntryPoint:!1,Events:[cm,fh,d0,Fr,Sr,cT]},wm={findFiberByHostInstance:Tu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Xne={bundleType:wm.bundleType,version:wm.version,rendererPackageName:wm.rendererPackageName,rendererConfig:wm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=G4(d),d===null?null:d.stateNode},findFiberByHostInstance:wm.findFiberByHostInstance||Wne,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Y0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Y0.isDisabled&&Y0.supportsFiber)try{Ky=Y0.inject(Xne),Xo=Y0}catch{}}return Fi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yne,Fi.createPortal=function(d,f){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vT(f))throw Error(t(200));return Kne(d,f,null,y)},Fi.createRoot=function(d,f){if(!vT(d))throw Error(t(299));var y=!1,E="",x=vO;return f!=null&&(f.unstable_strictMode===!0&&(y=!0),f.identifierPrefix!==void 0&&(E=f.identifierPrefix),f.onRecoverableError!==void 0&&(x=f.onRecoverableError)),f=pT(d,1,!1,null,null,y,!1,E,x),d[Va]=f.current,sm(d.nodeType===8?d.parentNode:d),new gT(f)},Fi.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var f=d._reactInternals;if(f===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=G4(f),d=d===null?null:d.stateNode,d},Fi.flushSync=function(d){return Mu(d)},Fi.hydrate=function(d,f,y){if(!W0(f))throw Error(t(200));return z0(null,d,f,!0,y)},Fi.hydrateRoot=function(d,f,y){if(!vT(d))throw Error(t(405));var E=y!=null&&y.hydratedSources||null,x=!1,A="",j=vO;if(y!=null&&(y.unstable_strictMode===!0&&(x=!0),y.identifierPrefix!==void 0&&(A=y.identifierPrefix),y.onRecoverableError!==void 0&&(j=y.onRecoverableError)),f=mO(f,null,d,1,y??null,x,!1,A,j),d[Va]=f.current,sm(d),E)for(d=0;d<E.length;d++)y=E[d],x=y._getVersion,x=x(y._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[y,x]:f.mutableSourceEagerHydrationData.push(y,x);return new K0(f)},Fi.render=function(d,f,y){if(!W0(f))throw Error(t(200));return z0(null,d,f,!1,y)},Fi.unmountComponentAtNode=function(d){if(!W0(d))throw Error(t(40));return d._reactRootContainer?(Mu(function(){z0(null,null,d,!1,function(){d._reactRootContainer=null,d[Va]=null})}),!0):!1},Fi.unstable_batchedUpdates=cT,Fi.unstable_renderSubtreeIntoContainer=function(d,f,y,E){if(!W0(y))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return z0(d,f,y,!1,E)},Fi.version="18.3.1-next-f1338f8080-20240426",Fi}var G5;function IB(){if(G5)return WT.exports;G5=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),WT.exports=bae(),WT.exports}var q5;function Sae(){if(q5)return c1;q5=1;var n=IB();return c1.createRoot=n.createRoot,c1.hydrateRoot=n.hydrateRoot,c1}var wae=Sae(),K5={};function Eae(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(n)}var Cae=Object.defineProperty,Tae=(n,e,t)=>e in n?Cae(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,W5=(n,e,t)=>Tae(n,typeof e!="symbol"?e+"":e,t);let Wi=class{constructor(){W5(this,"_locking"),W5(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),r}};function Fn(n,e){if(!n)throw new Error(e)}const Iae=34028234663852886e22,Rae=-34028234663852886e22,kae=4294967295,xae=2147483647,Pae=-2147483648;function E_(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>xae||n<Pae)throw new Error("invalid int 32: "+n)}function uk(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>kae||n<0)throw new Error("invalid uint 32: "+n)}function RB(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Iae||n<Rae))throw new Error("invalid float 32: "+n)}const kB=Symbol("@bufbuild/protobuf/enum-type");function Lae(n){const e=n[kB];return Fn(e,"missing enum type on enum object"),e}function xB(n,e,t,r){n[kB]=PB(e,t.map(i=>({no:i.no,name:i.name,localName:n[i.no]})))}function PB(n,e,t){const r=Object.create(null),i=Object.create(null),s=[];for(const o of e){const a=LB(o);s.push(a),r[o.name]=a,i[o.no]=a}return{typeName:n,values:s,findName(o){return r[o]},findNumber(o){return i[o]}}}function Aae(n,e,t){const r={};for(const i of e){const s=LB(i);r[s.localName]=s.no,r[s.no]=s.localName}return xB(r,n,e),r}function LB(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class NP{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(t);return i.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(t);return i.readMessage(r,e,s,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,t)}toBinary(e){const t=this.getType(),r=t.runtime.bin,i=r.makeWriteOptions(e),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(e){const t=this.getType(),r=t.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var t;const r=this.toJson(e);return JSON.stringify(r,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Mae(n,e,t,r){var i;const s=(i=r==null?void 0:r.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){n.util.initFields(this),n.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new NP),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return n.util.equals(o,a,c)}}),o}function Oae(){let n=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(n|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function XT(n,e,t){for(let s=0;s<28;s=s+7){const o=n>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(t.push(c),!a)return}const r=n>>>28&15|(e&7)<<4,i=e>>3!=0;if(t.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(t.push(c),!a)return}t.push(e>>>31&1)}}const C_=4294967296;function z5(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let r=0,i=0;function s(o,a){const c=Number(n.slice(o,a));i*=t,r=r*t+c,r>=C_&&(i=i+(r/C_|0),r=r%C_)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?MB(r,i):DP(r,i)}function Nae(n,e){let t=DP(n,e);const r=t.hi&2147483648;r&&(t=MB(t.lo,t.hi));const i=AB(t.lo,t.hi);return r?"-"+i:i}function AB(n,e){if({lo:n,hi:e}=Dae(n,e),e<=2097151)return String(C_*e+n);const t=n&16777215,r=(n>>>24|e<<8)&16777215,i=e>>16&65535;let s=t+r*6777216+i*6710656,o=r+i*8147497,a=i*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+Y5(o)+Y5(s)}function Dae(n,e){return{lo:n>>>0,hi:e>>>0}}function DP(n,e){return{lo:n|0,hi:e|0}}function MB(n,e){return e=~e,n?n=~n+1:e+=1,DP(n,e)}const Y5=n=>{const e=String(n);return"0000000".slice(e.length)+e};function X5(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Fae(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Uae(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof K5!="object"||K5.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<i)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return n.setBigInt64(0,this.parse(c),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(c){return n.setBigInt64(0,this.uParse(c),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(c,l){return n.setInt32(0,c,!0),n.setInt32(4,l,!0),n.getBigInt64(0,!0)},uDec(c,l){return n.setInt32(0,c,!0),n.setInt32(4,l,!0),n.getBigUint64(0,!0)}}}const t=i=>Fn(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>Fn(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),t(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),t(i),z5(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),z5(i)},dec(i,s){return Nae(i,s)},uDec(i,s){return AB(i,s)}}}const Tn=Uae();var ve;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(ve||(ve={}));var Ql;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Ql||(Ql={}));function fl(n,e,t){if(e===t)return!0;if(n==ve.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}switch(n){case ve.UINT64:case ve.FIXED64:case ve.INT64:case ve.SFIXED64:case ve.SINT64:return e==t}return!1}function Kf(n,e){switch(n){case ve.BOOL:return!1;case ve.UINT64:case ve.FIXED64:case ve.INT64:case ve.SFIXED64:case ve.SINT64:return e==0?Tn.zero:"0";case ve.DOUBLE:case ve.FLOAT:return 0;case ve.BYTES:return new Uint8Array(0);case ve.STRING:return"";default:return 0}}function OB(n,e){switch(n){case ve.BOOL:return e===!1;case ve.STRING:return e==="";case ve.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Kn;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Kn||(Kn={}));class jae{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(uk(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return E_(e),X5(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){RB(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){uk(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){E_(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return E_(e),e=(e<<1^e>>31)>>>0,X5(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=Tn.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=Tn.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=Tn.enc(e);return XT(t.lo,t.hi,this.buf),this}sint64(e){let t=Tn.enc(e),r=t.hi>>31,i=t.lo<<1^r,s=(t.hi<<1|t.lo>>>31)^r;return XT(i,s,this.buf),this}uint64(e){let t=Tn.uEnc(e);return XT(t.lo,t.hi,this.buf),this}}class $ae{constructor(e,t){this.varint64=Oae,this.uint32=Fae,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case Kn.Varint:for(;this.buf[this.pos++]&128;);break;case Kn.Bit64:this.pos+=4;case Kn.Bit32:this.pos+=4;break;case Kn.LengthDelimited:let i=this.uint32();this.pos+=i;break;case Kn.StartGroup:for(;;){const[s,o]=this.tag();if(o===Kn.EndGroup){if(t!==void 0&&s!==t)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Tn.dec(...this.varint64())}uint64(){return Tn.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,Tn.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Tn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Tn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function Bae(n,e,t,r){let i;return{typeName:e,extendee:t,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),i=n.util.newFieldList([s]).list()[0]}return i},runtime:n}}function NB(n){const e=n.field.localName,t=Object.create(null);return t[e]=Hae(n),[t,()=>t[e]]}function Hae(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Kf(e.T,e.L);case"message":const t=e.T,r=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function Vae(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let hc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),bw=[];for(let n=0;n<hc.length;n++)bw[hc[n].charCodeAt(0)]=n;bw[45]=hc.indexOf("+");bw[95]=hc.indexOf("/");const DB={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,i=0,s,o=0;for(let a=0;a<n.length;a++){if(s=bw[n.charCodeAt(a)],s===void 0)switch(n[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=s,i=1;break;case 1:t[r++]=o<<2|(s&48)>>4,o=s,i=2;break;case 2:t[r++]=(o&15)<<4|(s&60)>>2,o=s,i=3;break;case 3:t[r++]=(o&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return t.subarray(0,r)},enc(n){let e="",t=0,r,i=0;for(let s=0;s<n.length;s++)switch(r=n[s],t){case 0:e+=hc[r>>2],i=(r&3)<<4,t=1;break;case 1:e+=hc[i|r>>4],i=(r&15)<<2,t=2;break;case 2:e+=hc[i|r>>6],e+=hc[r&63],t=0;break}return t&&(e+=hc[i],e+="=",t==1&&(e+="=")),e}};function Gae(n,e,t){UB(e,n);const r=e.runtime.bin.makeReadOptions(t),i=Vae(n.getType().runtime.bin.listUnknownFields(n),e.field),[s,o]=NB(e);for(const a of i)e.runtime.bin.readField(s,r.readerFactory(a.data),e.field,a.wireType,r);return o()}function qae(n,e,t,r){UB(e,n);const i=e.runtime.bin.makeReadOptions(r),s=e.runtime.bin.makeWriteOptions(r);if(FB(n,e)){const l=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of l)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,t,o,s);const c=i.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),h=c.skip(u,l);n.getType().runtime.bin.onUnknownField(n,l,u,h)}}function FB(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(r=>r.no==e.field.no)}function UB(n,e){Fn(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function jB(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!OB(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function J5(n,e){const t=n.localName,r=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=r?n.T.values[0].no:void 0;break;case"scalar":e[t]=r?Kf(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function dd(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(NP.prototype).every(r=>r in n&&typeof n[r]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function $B(n,e){return dd(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}ve.DOUBLE,ve.FLOAT,ve.INT64,ve.UINT64,ve.INT32,ve.UINT32,ve.BOOL,ve.STRING,ve.BYTES;const Z5={ignoreUnknownFields:!1},Q5={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Kae(n){return n?Object.assign(Object.assign({},Z5),n):Z5}function Wae(n){return n?Object.assign(Object.assign({},Q5),n):Q5}const jb=Symbol(),T_=Symbol();function zae(){return{makeReadOptions:Kae,makeWriteOptions:Wae,readMessage(n,e,t,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(pa(e)));r=r??new n;const i=new Map,s=t.typeRegistry;for(const[o,a]of Object.entries(e)){const c=n.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=i.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));i.set(c.oneof,o)}eN(r,a,c,t,n)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==n.typeName){l=!0;const[h,p]=NB(u);eN(h,a,u.field,t,u),qae(r,u,p(),t)}}if(!l&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return r},writeMessage(n,e){const t=n.getType(),r={};let i;try{for(i of t.fields.byNumber()){if(!jB(i,n)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!Xae(i))continue}const o=i.oneof?n[i.oneof.localName].value:n[i.localName],a=tN(i,o,e);a!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of t.runtime.bin.listUnknownFields(n)){const a=s.findExtensionFor(t.typeName,o.no);if(a&&FB(n,a)){const c=Gae(n,a,e),l=tN(a.field,c,e);l!==void 0&&(r[a.field.jsonName]=l)}}}catch(s){const o=i?"cannot encode field ".concat(t.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return r},readScalar(n,e,t){return Pg(n,e,t??Ql.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||OB(n,e)))return I_(n,e)},debug:pa}}function pa(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function eN(n,e,t,r,i){let s=t.localName;if(t.repeated){if(Fn(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(e)));const o=n[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(a)));switch(t.kind){case"message":o.push(t.T.fromJson(a,r));break;case"enum":const c=JT(t.T,a,r.ignoreUnknownFields,!0);c!==T_&&o.push(c);break;case"scalar":try{o.push(Pg(t.T,a,t.L,!0))}catch(l){let u="cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(e)));const o=n[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: map value null"));let l;try{l=Yae(t.K,a)}catch(u){let h="cannot decode map key for field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}switch(t.V.kind){case"message":o[l]=t.V.T.fromJson(c,r);break;case"enum":const u=JT(t.V.T,c,r.ignoreUnknownFields,!0);u!==T_&&(o[l]=u);break;case"scalar":try{o[l]=Pg(t.V.T,c,Ql.BIGINT,!0)}catch(h){let p="cannot decode map value for field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(e));throw h instanceof Error&&h.message.length>0&&(p+=": ".concat(h.message)),new Error(p)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:s},s="value"),t.kind){case"message":const o=t.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=n[s];dd(a)?a.fromJson(e,r):(n[s]=a=o.fromJson(e,r),o.fieldWrapper&&!t.oneof&&(n[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=JT(t.T,e,r.ignoreUnknownFields,!1);switch(c){case jb:J5(t,n);break;case T_:break;default:n[s]=c;break}break;case"scalar":try{const l=Pg(t.T,e,t.L,!1);switch(l){case jb:J5(t,n);break;default:n[s]=l;break}}catch(l){let u="cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(pa(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function Yae(n,e){if(n===ve.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Pg(n,e,Ql.BIGINT,!0).toString()}function Pg(n,e,t,r){if(e===null)return r?Kf(n,t):jb;switch(n){case ve.DOUBLE:case ve.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return n==ve.FLOAT&&RB(i),i;case ve.INT32:case ve.FIXED32:case ve.SFIXED32:case ve.SINT32:case ve.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return n==ve.UINT32||n==ve.FIXED32?uk(s):E_(s),s;case ve.INT64:case ve.SFIXED64:case ve.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Tn.parse(e);return t?o.toString():o;case ve.FIXED64:case ve.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Tn.uParse(e);return t?a.toString():a;case ve.BOOL:if(typeof e!="boolean")break;return e;case ve.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case ve.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return DB.dec(e)}throw new Error}function JT(n,e,t,r){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].no:jb;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=n.findName(e);if(i!==void 0)return i.no;if(t)return T_;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(pa(e)))}function Xae(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function tN(n,e,t){if(n.kind=="map"){Fn(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(n.V.kind){case"scalar":for(const[o,a]of i)r[o.toString()]=I_(n.V.T,a);break;case"message":for(const[o,a]of i)r[o.toString()]=a.toJson(t);break;case"enum":const s=n.V.T;for(const[o,a]of i)r[o.toString()]=ZT(s,a,t.enumAsInteger);break}return t.emitDefaultValues||i.length>0?r:void 0}if(n.repeated){Fn(Array.isArray(e));const r=[];switch(n.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(I_(n.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(ZT(n.T,e[i],t.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(t));break}return t.emitDefaultValues||r.length>0?r:void 0}switch(n.kind){case"scalar":return I_(n.T,e);case"enum":return ZT(n.T,e,t.enumAsInteger);case"message":return $B(n.T,e).toJson(t)}}function ZT(n,e,t){var r;if(Fn(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const i=n.findNumber(e);return(r=i==null?void 0:i.name)!==null&&r!==void 0?r:e}function I_(n,e){switch(n){case ve.INT32:case ve.SFIXED32:case ve.SINT32:case ve.FIXED32:case ve.UINT32:return Fn(typeof e=="number"),e;case ve.FLOAT:case ve.DOUBLE:return Fn(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case ve.STRING:return Fn(typeof e=="string"),e;case ve.BOOL:return Fn(typeof e=="boolean"),e;case ve.UINT64:case ve.FIXED64:case ve.INT64:case ve.SFIXED64:case ve.SINT64:return Fn(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case ve.BYTES:return Fn(e instanceof Uint8Array),DB.enc(e)}}const Oh=Symbol("@bufbuild/protobuf/unknown-fields"),nN={readUnknownFields:!0,readerFactory:n=>new $ae(n)},rN={writeUnknownFields:!0,writerFactory:()=>new jae};function Jae(n){return n?Object.assign(Object.assign({},nN),n):nN}function Zae(n){return n?Object.assign(Object.assign({},rN),n):rN}function Qae(){return{makeReadOptions:Jae,makeWriteOptions:Zae,listUnknownFields(n){var e;return(e=n[Oh])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Oh]},writeUnknownFields(n,e){const r=n[Oh];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(n,e,t,r){const i=n;Array.isArray(i[Oh])||(i[Oh]=[]),i[Oh].push({no:e,wireType:t,data:r})},readMessage(n,e,t,r,i){const s=n.getType(),o=i?e.len:e.pos+t;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(i===!0&&c==Kn.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);r.readUnknownFields&&this.onUnknownField(n,a,c,u);continue}iN(n,e,l,c,r)}if(i&&(c!=Kn.EndGroup||a!==t))throw new Error("invalid end group tag")},readField:iN,writeMessage(n,e,t){const r=n.getType();for(const i of r.fields.byNumber()){if(!jB(i,n)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const s=i.oneof?n[i.oneof.localName].value:n[i.localName];sN(i,s,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,r){e!==void 0&&sN(n,e,t,r)}}}function iN(n,e,t,r,i){let{repeated:s,localName:o}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),t.kind){case"scalar":case"enum":const a=t.kind=="enum"?ve.INT32:t.T;let c=$b;if(t.kind=="scalar"&&t.L>0&&(c=tce),s){let p=n[o];if(r==Kn.LengthDelimited&&a!=ve.STRING&&a!=ve.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)p.push(c(e,a))}else p.push(c(e,a))}else n[o]=c(e,a);break;case"message":const l=t.T;s?n[o].push(R_(e,new l,i,t)):dd(n[o])?R_(e,n[o],i,t):(n[o]=R_(e,new l,i,t),l.fieldWrapper&&!t.oneof&&!t.repeated&&(n[o]=l.fieldWrapper.unwrapField(n[o])));break;case"map":let[u,h]=ece(t,e,i);n[o][u]=h;break}}function R_(n,e,t,r){const i=e.getType().runtime.bin,s=r==null?void 0:r.delimited;return i.readMessage(e,n,s?r.no:n.uint32(),t,s),e}function ece(n,e,t){const r=e.uint32(),i=e.pos+r;let s,o;for(;e.pos<i;){const[a]=e.tag();switch(a){case 1:s=$b(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=$b(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=R_(e,new n.V.T,t,void 0);break}break}}if(s===void 0&&(s=Kf(n.K,Ql.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(n.V.kind){case"scalar":o=Kf(n.V.T,Ql.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[s,o]}function tce(n,e){const t=$b(n,e);return typeof t=="bigint"?t.toString():t}function $b(n,e){switch(e){case ve.STRING:return n.string();case ve.BOOL:return n.bool();case ve.DOUBLE:return n.double();case ve.FLOAT:return n.float();case ve.INT32:return n.int32();case ve.INT64:return n.int64();case ve.UINT64:return n.uint64();case ve.FIXED64:return n.fixed64();case ve.BYTES:return n.bytes();case ve.FIXED32:return n.fixed32();case ve.SFIXED32:return n.sfixed32();case ve.SFIXED64:return n.sfixed64();case ve.SINT64:return n.sint64();case ve.UINT32:return n.uint32();case ve.SINT32:return n.sint32()}}function sN(n,e,t,r){Fn(e!==void 0);const i=n.repeated;switch(n.kind){case"scalar":case"enum":let s=n.kind=="enum"?ve.INT32:n.T;if(i)if(Fn(Array.isArray(e)),n.packed)rce(t,s,n.no,e);else for(const o of e)Lg(t,s,n.no,o);else Lg(t,s,n.no,e);break;case"message":if(i){Fn(Array.isArray(e));for(const o of e)oN(t,r,n,o)}else oN(t,r,n,e);break;case"map":Fn(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))nce(t,r,n,o,a);break}}function nce(n,e,t,r,i){n.tag(t.no,Kn.LengthDelimited),n.fork();let s=r;switch(t.K){case ve.INT32:case ve.FIXED32:case ve.UINT32:case ve.SFIXED32:case ve.SINT32:s=Number.parseInt(r);break;case ve.BOOL:Fn(r=="true"||r=="false"),s=r=="true";break}switch(Lg(n,t.K,1,s),t.V.kind){case"scalar":Lg(n,t.V.T,2,i);break;case"enum":Lg(n,ve.INT32,2,i);break;case"message":Fn(i!==void 0),n.tag(2,Kn.LengthDelimited).bytes(i.toBinary(e));break}n.join()}function oN(n,e,t,r){const i=$B(t.T,r);t.delimited?n.tag(t.no,Kn.StartGroup).raw(i.toBinary(e)).tag(t.no,Kn.EndGroup):n.tag(t.no,Kn.LengthDelimited).bytes(i.toBinary(e))}function Lg(n,e,t,r){Fn(r!==void 0);let[i,s]=BB(e);n.tag(t,i)[s](r)}function rce(n,e,t,r){if(!r.length)return;n.tag(t,Kn.LengthDelimited).fork();let[,i]=BB(e);for(let s=0;s<r.length;s++)n[i](r[s]);n.join()}function BB(n){let e=Kn.Varint;switch(n){case ve.BYTES:case ve.STRING:e=Kn.LengthDelimited;break;case ve.DOUBLE:case ve.FIXED64:case ve.SFIXED64:e=Kn.Bit64;break;case ve.FIXED32:case ve.SFIXED32:case ve.FLOAT:e=Kn.Bit32;break}const t=ve[n].toLowerCase();return[e,t]}function ice(){return{setEnumType:xB,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const r of t.fields.byMember()){const i=r.localName,s=e,o=n;if(o[i]!=null)switch(r.kind){case"oneof":const a=o[i].case;if(a===void 0)continue;const c=r.findField(a);let l=o[i].value;c&&c.kind=="message"&&!dd(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===ve.BYTES&&(l=jm(l)),s[i]={case:a,value:l};break;case"scalar":case"enum":let u=o[i];r.T===ve.BYTES&&(u=r.repeated?u.map(jm):jm(u)),s[i]=u;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===ve.BYTES)for(const[m,v]of Object.entries(o[i]))s[i][m]=jm(v);else Object.assign(s[i],o[i]);break;case"message":const p=r.V.T;for(const m of Object.keys(o[i])){let v=o[i][m];p.fieldWrapper||(v=new p(v)),s[i][m]=v}break}break;case"message":const h=r.T;if(r.repeated)s[i]=o[i].map(p=>dd(p,h)?p:new h(p));else{const p=o[i];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?s[i]=jm(p):s[i]=p:s[i]=dd(p,h)?p:new h(p)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(r=>{const i=e[r.localName],s=t[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((o,a)=>r.T.equals(o,s[a]));case"scalar":return i.every((o,a)=>fl(r.T,o,s[a]));case"enum":return i.every((o,a)=>fl(ve.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(i,s);case"enum":return fl(ve.INT32,i,s);case"scalar":return fl(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const o=r.findField(i.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(i.value,s.value);case"enum":return fl(ve.INT32,i.value,s.value);case"scalar":return fl(o.T,i.value,s.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const c=r.V.T;return a.every(u=>c.equals(i[u],s[u]));case"enum":return a.every(u=>fl(ve.INT32,i[u],s[u]));case"scalar":const l=r.V.T;return a.every(u=>fl(l,i[u],s[u]))}break}})},clone(n){const e=n.getType(),t=new e,r=t;for(const i of e.fields.byMember()){const s=n[i.localName];let o;if(i.repeated)o=s.map(l1);else if(i.kind=="map"){o=r[i.localName];for(const[a,c]of Object.entries(s))o[a]=l1(c)}else i.kind=="oneof"?o=i.findField(s.case)?{case:s.case,value:l1(s.value)}:{case:void 0}:o=l1(s);r[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return t}}}function l1(n){if(n===void 0)return n;if(dd(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function jm(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function sce(n,e,t){return{syntax:n,json:zae(),bin:Qae(),util:Object.assign(Object.assign({},ice()),{newFieldList:e,initFields:t}),makeMessageType(r,i,s){return Mae(this,r,i,s)},makeEnum:Aae,makeEnumType:PB,getEnumType:Lae,makeExtension(r,i,s){return Bae(this,r,i,s)}}}class oce{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const r of this.list())t[r.jsonName]=t[r.name]=r;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const r of this.list())t[r.no]=r;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const r of this.list())r.oneof?r.oneof!==t&&(t=r.oneof,e.push(t)):e.push(r)}return this.members}}function HB(n,e){const t=VB(n);return e?t:hce(dce(t))}function ace(n){return HB(n,!1)}const cce=VB;function VB(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let i=n.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),t.push(i);break}}return t.join("")}const lce=new Set(["constructor","toString","toJSON","valueOf"]),uce=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),GB=n=>"".concat(n,"$"),dce=n=>uce.has(n)?GB(n):n,hce=n=>lce.has(n)?GB(n):n;class fce{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=ace(e)}addField(e){Fn(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function pce(n,e){var t,r,i,s,o,a;const c=[];let l;for(const u of typeof n=="function"?n():n){const h=u;if(h.localName=HB(u.name,u.oneof!==void 0),h.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:cce(u.name),h.repeated=(r=u.repeated)!==null&&r!==void 0?r:!1,u.kind=="scalar"&&(h.L=(i=u.L)!==null&&i!==void 0?i:Ql.BIGINT),h.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,h.req=(o=u.req)!==null&&o!==void 0?o:!1,h.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(h.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=ve.BYTES&&u.T!=ve.STRING),u.oneof!==void 0){const p=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=p)&&(l=new fce(p)),h.oneof=l,l.addField(h)}c.push(h)}return c}const fe=sce("proto3",n=>new oce(n,e=>pce(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,r=n;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"enum":r[t]=0;break;case"map":r[t]={};break;case"scalar":r[t]=Kf(e.T,e.L);break}}});class qi extends NP{constructor(e){super(),this.seconds=Tn.zero,this.nanos=0,fe.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(fe.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Tn.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(t).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return qi.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new qi({seconds:Tn.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new qi().fromBinary(e,t)}static fromJson(e,t){return new qi().fromJson(e,t)}static fromJsonString(e,t){return new qi().fromJsonString(e,t)}static equals(e,t){return fe.util.equals(qi,e,t)}}qi.runtime=fe;qi.typeName="google.protobuf.Timestamp";qi.fields=fe.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const mce=fe.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:qi},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:gce,repeated:!0},{no:5,name:"events",kind:"message",T:yce,repeated:!0}]),gce=fe.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:vce,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),vce=fe.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:qi},{no:3,name:"value",kind:"scalar",T:2}]),yce=fe.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:qi},{no:7,name:"normalized_end_timestamp",kind:"message",T:qi,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),qB=fe.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"REGRESSION"},{no:1,name:"SIMULCAST"}]),Oo=fe.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ir=fe.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),FP=fe.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),vg=fe.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),mv=fe.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Uo=fe.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),Nh=fe.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),_ce=fe.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),va=fe.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),UP=fe.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Bb,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:rH}]),Bb=fe.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),bce=fe.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:fe.getEnumType(ir),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),gv=fe.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:fe.getEnumType(dk)},{no:4,name:"tracks",kind:"message",T:lf,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:bce},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:fe.getEnumType(Hb)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:fe.getEnumType(Uo)}]),dk=fe.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Hb=fe.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),bs=fe.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Sce=fe.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:hd,repeated:!0}]),lf=fe.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:fe.getEnumType(Oo)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:fe.getEnumType(ir)},{no:10,name:"layers",kind:"message",T:hd,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Sce,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:fe.getEnumType(bs)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:rH},{no:19,name:"audio_features",kind:"enum",T:fe.getEnumType(va),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:fe.getEnumType(qB)}]),hd=fe.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:fe.getEnumType(FP)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),$i=fe.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:fe.getEnumType(Nt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:WB,oneof:"value"},{no:3,name:"speaker",kind:"message",T:wce,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:zB,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Ece,oneof:"value"},{no:8,name:"metrics",kind:"message",T:mce,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:hk,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:YB,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:XB,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:JB,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:pk,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:mk,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:gk,oneof:"value"}]),Nt=fe.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),wce=fe.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:KB,repeated:!0}]),KB=fe.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),WB=fe.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),zB=fe.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Ece=fe.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Cce,repeated:!0}]),Cce=fe.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),hk=fe.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),YB=fe.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),XB=fe.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),JB=fe.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:ZB,oneof:"value"}]),ZB=fe.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),QB=fe.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Tce=fe.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:fe.getEnumType(eH)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),eH=fe.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Ice=fe.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:fe.getEnumType(tH)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),tH=fe.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),nH=fe.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:aN},{no:2,name:"screen",kind:"message",T:aN},{no:3,name:"resume_connection",kind:"enum",T:fe.getEnumType(mv)},{no:4,name:"disabled_codecs",kind:"message",T:Rce},{no:5,name:"force_relay",kind:"enum",T:fe.getEnumType(mv)}]),aN=fe.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:fe.getEnumType(mv)}]),Rce=fe.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Bb,repeated:!0},{no:2,name:"publish",kind:"message",T:Bb,repeated:!0}]),rH=fe.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),fk=fe.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),iH=fe.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:fe.getEnumType(fk)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),sH=fe.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),pk=fe.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:fe.getEnumType(bs)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:iH,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:sH,oneof:"content_header"}],{localName:"DataStream_Header"}),mk=fe.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),gk=fe.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),No=fe.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),vk=fe.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),kce=fe.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),xce=fe.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:kd,oneof:"message"},{no:2,name:"answer",kind:"message",T:kd,oneof:"message"},{no:3,name:"trickle",kind:"message",T:jP,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_k,oneof:"message"},{no:5,name:"mute",kind:"message",T:$P,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Sw,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:oH,oneof:"message"},{no:8,name:"leave",kind:"message",T:ww,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:cH,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:hH,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:fH,oneof:"message"},{no:13,name:"simulate",kind:"message",T:ca,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:lH,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:mH,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:aH,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Oce,oneof:"message"}]),cN=fe.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Pce,oneof:"message"},{no:2,name:"answer",kind:"message",T:kd,oneof:"message"},{no:3,name:"offer",kind:"message",T:kd,oneof:"message"},{no:4,name:"trickle",kind:"message",T:jP,oneof:"message"},{no:5,name:"update",kind:"message",T:Mce,oneof:"message"},{no:6,name:"track_published",kind:"message",T:BP,oneof:"message"},{no:8,name:"leave",kind:"message",T:ww,oneof:"message"},{no:9,name:"mute",kind:"message",T:$P,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Nce,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Dce,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Uce,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:$ce,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Hce,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Vce,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Ace,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Lce,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Gce,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Wce,oneof:"message"},{no:22,name:"request_response",kind:"message",T:zce,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Yce,oneof:"message"}]),yk=fe.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),_k=fe.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:fe.getEnumType(Oo)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:fe.getEnumType(ir)},{no:9,name:"layers",kind:"message",T:hd,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:yk,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:fe.getEnumType(bs)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:fe.getEnumType(qB)}]),jP=fe.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:fe.getEnumType(No)},{no:3,name:"final",kind:"scalar",T:8}]),$P=fe.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Pce=fe.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:UP},{no:2,name:"participant",kind:"message",T:gv},{no:3,name:"other_participants",kind:"message",T:gv,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:uH,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:nH},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Tce},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Bb,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Lce=fe.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:uH,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:nH}]),BP=fe.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:lf}]),Ace=fe.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),kd=fe.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),Mce=fe.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:gv,repeated:!0}]),Sw=fe.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:QB,repeated:!0}]),oH=fe.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:fe.getEnumType(FP)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),aH=fe.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:fe.getEnumType(va),repeated:!0}]),Oce=fe.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ww=fe.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:fe.getEnumType(Uo)},{no:3,name:"action",kind:"enum",T:fe.getEnumType(Cf)},{no:4,name:"regions",kind:"message",T:qce}]),Cf=fe.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),cH=fe.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:hd,repeated:!0}]),lH=fe.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),uH=fe.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Nce=fe.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:KB,repeated:!0}]),Dce=fe.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:UP}]),Fce=fe.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:fe.getEnumType(vg)},{no:3,name:"score",kind:"scalar",T:2}]),Uce=fe.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Fce,repeated:!0}]),jce=fe.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:fe.getEnumType(vk)}]),$ce=fe.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:jce,repeated:!0}]),HP=fe.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:fe.getEnumType(FP)},{no:2,name:"enabled",kind:"scalar",T:8}]),Bce=fe.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:HP,repeated:!0}]),Hce=fe.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:HP,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Bce,repeated:!0}]),dH=fe.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),hH=fe.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:dH,repeated:!0}]),Vce=fe.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),fH=fe.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:kd},{no:2,name:"subscription",kind:"message",T:Sw},{no:3,name:"publish_tracks",kind:"message",T:BP,repeated:!0},{no:4,name:"data_channels",kind:"message",T:pH,repeated:!0},{no:5,name:"offer",kind:"message",T:kd},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),pH=fe.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:fe.getEnumType(No)}]),ca=fe.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:fe.getEnumType(kce),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),mH=fe.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Gce=fe.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),qce=fe.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Kce,repeated:!0}]),Kce=fe.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Wce=fe.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:fe.getEnumType(_ce)}]),zce=fe.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:fe.getEnumType(VP)},{no:3,name:"message",kind:"scalar",T:9}]),VP=fe.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Yce=fe.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Xce(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var k_={exports:{}},Jce=k_.exports,lN;function Zce(){return lN||(lN=1,function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(Jce,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(g){return g==="debug"&&(g="log"),typeof console===t?!1:g==="trace"&&r?c:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===t&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==t&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return l(g)||h.apply(this,arguments)}function m(g,S){var b=this,R,k,I,T="loglevel";typeof g=="string"?T+=":"+g:typeof g=="symbol"&&(T=void 0);function C(U){var B=(i[U]||"silent").toUpperCase();if(!(typeof window===t||!T)){try{window.localStorage[T]=B;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+B+";"}catch{}}}function P(){var U;if(!(typeof window===t||!T)){try{U=window.localStorage[T]}catch{}if(typeof U===t)try{var B=window.document.cookie,V=encodeURIComponent(T),z=B.indexOf(V+"=");z!==-1&&(U=/^([^;]+)/.exec(B.slice(z+V.length+1))[1])}catch{}return b.levels[U]===void 0&&(U=void 0),U}}function M(){if(!(typeof window===t||!T)){try{window.localStorage.removeItem(T)}catch{}try{window.document.cookie=encodeURIComponent(T)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var B=U;if(typeof B=="string"&&b.levels[B.toUpperCase()]!==void 0&&(B=b.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=b.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+U)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return I??k??R},b.setLevel=function(U,B){return I=D(U),B!==!1&&C(I),u.call(b)},b.setDefaultLevel=function(U){k=D(U),P()||b.setLevel(U,!1)},b.resetLevel=function(){I=null,M(),u.call(b)},b.enableAll=function(U){b.setLevel(b.levels.TRACE,U)},b.disableAll=function(U){b.setLevel(b.levels.SILENT,U)},b.rebuild=function(){if(o!==b&&(R=D(o.getLevel())),u.call(b),o===b)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var F=P();F!=null&&(I=D(F)),u.call(b)}o=new m,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[S];return b||(b=s[S]=new m(S,o.methodFactory)),b};var v=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(k_)),k_.exports}var ay=Zce(),vv;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(vv||(vv={}));var Go;(function(n){n.Default="livekit",n.Room="livekit-room",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(Go||(Go={}));let wt=ay.getLogger("livekit");const gH=Object.values(Go).map(n=>ay.getLogger(n));wt.setDefaultLevel(vv.info);function Lc(n){const e=ay.getLogger(n);return e.setDefaultLevel(wt.getLevel()),e}function vH(n,e){if(e)ay.getLogger(e).setLevel(n);else for(const t of gH)t.setLevel(n)}function Qce(n,e){gH.forEach(r=>{const i=r.methodFactory;r.methodFactory=(s,o,a)=>{const c=i(s,o,a),l=vv[s],u=l>=o&&l<vv.silent;return(h,p)=>{p?c(h,p):c(h),u&&n(l,h,p)}},r.setLevel(r.getLevel())})}const ele=ay.getLogger("lk-e2ee"),$m=7e3,tle=[0,300,2*2*300,3*3*300,4*4*300,$m,$m,$m,$m,$m];class yH{constructor(e){this._retryDelays=e!==void 0?[...e]:tle}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function nle(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Z(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function uN(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xl(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof uN=="function"?uN(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var u1={exports:{}},dN;function rle(){if(dN)return u1.exports;dN=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(T,C,P){return Function.prototype.apply.call(T,C,P)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:t=function(T){return Object.getOwnPropertyNames(T)};function r(I){console&&console.warn&&console.warn(I)}var i=Number.isNaN||function(T){return T!==T};function s(){s.init.call(this)}u1.exports=s,u1.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");o=I}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this};function c(I){return I._maxListeners===void 0?s.defaultMaxListeners:I._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(T){for(var C=[],P=1;P<arguments.length;P++)C.push(arguments[P]);var M=T==="error",D=this._events;if(D!==void 0)M=M&&D.error===void 0;else if(!M)return!1;if(M){var F;if(C.length>0&&(F=C[0]),F instanceof Error)throw F;var U=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw U.context=F,U}var B=D[T];if(B===void 0)return!1;if(typeof B=="function")e(B,this,C);else for(var V=B.length,z=v(B,V),P=0;P<V;++P)e(z[P],this,C);return!0};function l(I,T,C,P){var M,D,F;if(a(C),D=I._events,D===void 0?(D=I._events=Object.create(null),I._eventsCount=0):(D.newListener!==void 0&&(I.emit("newListener",T,C.listener?C.listener:C),D=I._events),F=D[T]),F===void 0)F=D[T]=C,++I._eventsCount;else if(typeof F=="function"?F=D[T]=P?[C,F]:[F,C]:P?F.unshift(C):F.push(C),M=c(I),M>0&&F.length>M&&!F.warned){F.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=I,U.type=T,U.count=F.length,r(U)}return I}s.prototype.addListener=function(T,C){return l(this,T,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(T,C){return l(this,T,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(I,T,C){var P={fired:!1,wrapFn:void 0,target:I,type:T,listener:C},M=u.bind(P);return M.listener=C,P.wrapFn=M,M}s.prototype.once=function(T,C){return a(C),this.on(T,h(this,T,C)),this},s.prototype.prependOnceListener=function(T,C){return a(C),this.prependListener(T,h(this,T,C)),this},s.prototype.removeListener=function(T,C){var P,M,D,F,U;if(a(C),M=this._events,M===void 0)return this;if(P=M[T],P===void 0)return this;if(P===C||P.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete M[T],M.removeListener&&this.emit("removeListener",T,P.listener||C));else if(typeof P!="function"){for(D=-1,F=P.length-1;F>=0;F--)if(P[F]===C||P[F].listener===C){U=P[F].listener,D=F;break}if(D<0)return this;D===0?P.shift():g(P,D),P.length===1&&(M[T]=P[0]),M.removeListener!==void 0&&this.emit("removeListener",T,U||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(T){var C,P,M;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[T]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[T]),this;if(arguments.length===0){var D=Object.keys(P),F;for(M=0;M<D.length;++M)F=D[M],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=P[T],typeof C=="function")this.removeListener(T,C);else if(C!==void 0)for(M=C.length-1;M>=0;M--)this.removeListener(T,C[M]);return this};function p(I,T,C){var P=I._events;if(P===void 0)return[];var M=P[T];return M===void 0?[]:typeof M=="function"?C?[M.listener||M]:[M]:C?S(M):v(M,M.length)}s.prototype.listeners=function(T){return p(this,T,!0)},s.prototype.rawListeners=function(T){return p(this,T,!1)},s.listenerCount=function(I,T){return typeof I.listenerCount=="function"?I.listenerCount(T):m.call(I,T)},s.prototype.listenerCount=m;function m(I){var T=this._events;if(T!==void 0){var C=T[I];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function v(I,T){for(var C=new Array(T),P=0;P<T;++P)C[P]=I[P];return C}function g(I,T){for(;T+1<I.length;T++)I[T]=I[T+1];I.pop()}function S(I){for(var T=new Array(I.length),C=0;C<T.length;++C)T[C]=I[C].listener||I[C];return T}function b(I,T){return new Promise(function(C,P){function M(F){I.removeListener(T,D),P(F)}function D(){typeof I.removeListener=="function"&&I.removeListener("error",M),C([].slice.call(arguments))}k(I,T,D,{once:!0}),T!=="error"&&R(I,M,{once:!0})})}function R(I,T,C){typeof I.on=="function"&&k(I,"error",T,C)}function k(I,T,C,P){if(typeof I.on=="function")P.once?I.once(T,C):I.on(T,C);else if(typeof I.addEventListener=="function")I.addEventListener(T,function M(D){P.once&&I.removeEventListener(T,M),C(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return u1.exports}var Da=rle();let _H=!0,bH=!0;function x_(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function Gd(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function ile(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(_H=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function sle(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(bH=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function SH(){if(typeof window=="object"){if(_H)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function GP(n,e){bH&&console.warn(n+" is deprecated, please use "+e+" instead.")}function ole(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=x_(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=x_(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=x_(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function hN(n){return Object.prototype.toString.call(n)==="[object Object]"}function wH(n){return hN(n)?Object.keys(n).reduce(function(e,t){const r=hN(n[t]),i=r?wH(n[t]):n[t],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[t]:i})},{}):n}function bk(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?bk(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(i=>{bk(n,n.get(i),t)})}))}function fN(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&bk(n,a,i)})}),i}const pN=SH;function EH(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let p={};typeof u.ideal=="number"?(p[h("min",l)]=u.ideal,c.optional.push(p),p={},p[h("max",l)]=u.ideal,c.optional.push(p)):(p[h("",l)]=u.ideal,c.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(p,l)]=u[p])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,p){h in u&&!(p in u)&&(u[p]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(p=>{p=p.filter(v=>v.kind==="videoinput");let m=p.find(v=>h.some(g=>v.label.toLowerCase().includes(g)));return!m&&p.length&&h.includes("back")&&(m=p[p.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),pN("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return pN("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{t.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function CH(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function TH(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Gd(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function IH(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function RH(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>fN(o,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Gd(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>fN(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function kH(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function xH(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return kH(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new n.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[h.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(p=>{const m=l._reverseStreams[p],v=l._streams[m.id];h=h.replace(new RegExp(v.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(p=>{const m=l._reverseStreams[p],v=l._streams[m.id];h=h.replace(new RegExp(m.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],h={[l](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const g=s(this,v);p[0].apply(null,[g])},v=>{p[1]&&p[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};n.RTCPeerConnection.prototype[l]=h[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>u.track===g)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Sk(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=i[t]})}function PH(n,e){Gd(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}var mN=Object.freeze({__proto__:null,fixNegotiationNeeded:PH,shimAddTrackRemoveTrack:xH,shimAddTrackRemoveTrackWithNative:kH,shimGetSendersWithDtmf:IH,shimGetUserMedia:EH,shimMediaStream:CH,shimOnTrack:TH,shimPeerConnection:Sk,shimSenderReceiverGetStats:RH});function LH(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(i,s,o){GP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function ale(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function AH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wk(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=o[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function MH(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function OH(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Gd(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function NH(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){GP("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function DH(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function FH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function UH(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function jH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function $H(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var gN=Object.freeze({__proto__:null,shimAddTransceiver:FH,shimCreateAnswer:$H,shimCreateOffer:jH,shimGetDisplayMedia:ale,shimGetParameters:UH,shimGetUserMedia:LH,shimOnTrack:AH,shimPeerConnection:wk,shimRTCDataChannel:DH,shimReceiverGetStats:OH,shimRemoveStream:NH,shimSenderGetStats:MH});function BH(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function HH(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function VH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=t.apply(this,[h]);return u?(p.then(l,u),Promise.resolve()):p},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=r.apply(this,[h]);return u?(p.then(l,u),Promise.resolve()):p};let a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function GH(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>r(qH(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function qH(n){return n&&n.video!==void 0?Object.assign({},n,{video:wH(n.video)}):n}function KH(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(GP("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function WH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zH(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function YH(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var vN=Object.freeze({__proto__:null,shimAudioContext:YH,shimCallbacksAPI:VH,shimConstraints:qH,shimCreateOfferLegacy:zH,shimGetUserMedia:GH,shimLocalStreamsAPI:BH,shimRTCIceServerUrls:KH,shimRemoteStreamsAPI:HH,shimTrackEventTransceiver:WH}),QT={exports:{}},yN;function cle(){return yN||(yN=1,function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const i=t.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const s=t.type;return r.push("typ"),r.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const i=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let i;const s=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(t){let r="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?s.push(o+"="+t.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,r),10)},s=t.indexOf(":",r);return s>-1?(i.attribute=t.substring(r+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(r+1),i},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let i="a=setup:"+r+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const i=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let i="";i+="m="+t+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(t){const r=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&l&&(m.rtx={ssrc:l}),r.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(p=>{p.maxBitrate=h})),r},e.parseRtcpParameters=function(t){const r={},i=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const i=e.matchPrefix(t,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,r){let i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,i){let s;const o=r!==void 0?r:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=e}(QT)),QT.exports}var XH=cle(),Tf=Xce(XH),lle=Eae({__proto__:null,default:Tf},[XH]);function P_(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=Tf.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,Gd(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Ek(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Gd(n,"icecandidate",e=>{if(e.candidate){const t=Tf.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function L_(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=Tf.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Tf.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Tf.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return h}}),this._sctp=p}return o.apply(this,arguments)}}function A_(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},Gd(n,"datachannel",r=>(e(r.channel,r.target),r))}function Ck(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Tk(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function M_(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function O_(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}var ule=Object.freeze({__proto__:null,removeExtmapAllowMixed:Tk,shimAddIceCandidateNullOrEmpty:M_,shimConnectionState:Ck,shimMaxMessageSize:L_,shimParameterlessSetLocalDescription:O_,shimRTCIceCandidate:P_,shimRTCIceCandidateRelayProtocol:Ek,shimSendThrowTypeError:A_});function dle(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=SH,r=ole(n),i={browserDetails:r,commonShim:ule,extractVersion:x_,disableLog:ile,disableWarnings:sle,sdp:lle};switch(r.browser){case"chrome":if(!mN||!Sk||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=mN,M_(n,r),O_(n),EH(n,r),CH(n),Sk(n,r),TH(n),xH(n,r),IH(n),RH(n),PH(n,r),P_(n),Ek(n),Ck(n),L_(n,r),A_(n),Tk(n,r);break;case"firefox":if(!gN||!wk||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=gN,M_(n,r),O_(n),LH(n,r),wk(n,r),AH(n),NH(n),MH(n),OH(n),DH(n),FH(n),UH(n),jH(n),$H(n),P_(n),Ck(n),L_(n,r),A_(n);break;case"safari":if(!vN||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=vN,M_(n,r),O_(n),KH(n),zH(n),VH(n),BH(n),HH(n),WH(n),GH(n),YH(n),P_(n),Ek(n),L_(n,r),A_(n),Tk(n,r);break;default:t("Unsupported browser!");break}return i}dle({window:typeof window>"u"?void 0:window});const hle=10,d1="lk_e2ee",fle="LKFrameEncryptionKey",ple={sharedKey:!1,ratchetSalt:fle,ratchetWindowSize:8,failureTolerance:hle,keyringSize:16};var Hl;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(Hl||(Hl={}));var _N;(function(n){n.KeyRatcheted="keyRatcheted"})(_N||(_N={}));var Ol;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(Ol||(Ol={}));var bN;(function(n){n.Error="cryptorError"})(bN||(bN={}));function JH(){return mle()||Ik()}function Ik(){return typeof window.RTCRtpScriptTransform<"u"}function mle(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function gle(n){return Z(this,void 0,void 0,function*(){let e=new TextEncoder;return yield crypto.subtle.importKey("raw",e.encode(n),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function ZH(n){return Z(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",n,"HKDF",!1,["deriveBits","deriveKey"])})}class QH extends Da.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,r)=>{wt.debug("key ratcheted event received",{material:t,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},ple),e),this.on(Hl.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,r){const i={key:e,participantIdentity:t,keyIndex:r};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(r??0),i),this.emit(Hl.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(Hl.RatchetRequest,e,t)}}class vle extends QH{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});super(t)}setKey(e){return Z(this,void 0,void 0,function*(){const t=typeof e=="string"?yield gle(e):yield ZH(e);this.onSetEncryptionKey(t)})}}class pu extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var xt;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest"})(xt||(xt={}));class rn extends pu{constructor(e,t,r,i){super(1,e),this.name="ConnectionError",this.status=r,this.reason=t,this.context=i,this.reasonName=xt[t]}}class qP extends pu{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class fc extends pu{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class yle extends pu{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class dr extends pu{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Rk extends pu{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class _le extends pu{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class SN extends pu{constructor(e,t){super(15,e),this.reason=t,this.reasonName=typeof t=="string"?t:VP[t]}}var Vb;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Vb||(Vb={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Vb||(Vb={}));var wN;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(wN||(wN={}));var he;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(he||(he={}));var ue;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage"})(ue||(ue={}));var Oe;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse"})(Oe||(Oe={}));var Pe;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate"})(Pe||(Pe={}));function ble(n){if(!(typeof n>"u"))return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}const Sle=/version\/(\d+(\.?_?\d+)+)/i;let eI;function ka(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(eI===void 0||e){const r=wle.find(i=>{let{test:s}=i;return s.test(t)});eI=r==null?void 0:r.describe(t)}return eI}const wle=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:N_(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:tI(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:N_(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:tI(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:N_(Sle,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:tI(n)}}}];function N_(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(n);return r&&r.length>=t&&r[t]||""}function tI(n){return n.includes("mac os")?N_(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var Ele="2.9.5";const Cle=Ele,Tle=15;class Yr{}Yr.setTimeout=function(){return setTimeout(...arguments)};Yr.setInterval=function(){return setInterval(...arguments)};Yr.clearTimeout=function(){return clearTimeout(...arguments)};Yr.clearInterval=function(){return clearInterval(...arguments)};const Ile=5e3,Bm=[];var Ks;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(Ks||(Ks={}));let pe=class tf extends Da.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=tf.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=wt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),Ile):this.handleAppVisibilityChanged()},this.log=Lc((i=r.loggerName)!==null&&i!==void 0?i:Go.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=tf.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Yt(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===tf.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===tf.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(Bm.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Bm.splice(Bm.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),uf(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(i?Pe.AudioPlaybackStarted:Pe.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(i?Pe.AudioPlaybackFailed:Pe.VideoPlaybackFailed,s):s.name==="AbortError"?wt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):wt.warn("could not playback ".concat(i?"audio":"video"),s),i&&e&&r.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Pe.ElementAttached,e),e}detach(e){try{if(e){If(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Pe.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(r=>{If(this.mediaStreamTrack,r),t.push(r),this.recycleElement(r),this.emit(Pe.ElementDetached,r)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Lc(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Bm.forEach(r=>{r.parentElement||(t=!1)}),t&&Bm.push(e)}}handleAppVisibilityChanged(){return Z(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===tf.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){zi()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){zi()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function uf(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let r;n.kind==="audio"?r=t.getAudioTracks():r=t.getVideoTracks(),r.includes(n)||(r.forEach(i=>{t.removeTrack(i)}),t.addTrack(n)),(!eu()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(eu()||Wf())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function If(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(t=n.Source||(n.Source={}));let r;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(r=n.StreamState||(n.StreamState={}));function i(l){switch(l){case e.Audio:return Oo.AUDIO;case e.Video:return Oo.VIDEO;default:return Oo.DATA}}n.kindToProto=i;function s(l){switch(l){case Oo.AUDIO:return e.Audio;case Oo.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=s;function o(l){switch(l){case t.Camera:return ir.CAMERA;case t.Microphone:return ir.MICROPHONE;case t.ScreenShare:return ir.SCREEN_SHARE;case t.ScreenShareAudio:return ir.SCREEN_SHARE_AUDIO;default:return ir.UNKNOWN}}n.sourceToProto=o;function a(l){switch(l){case ir.CAMERA:return t.Camera;case ir.MICROPHONE:return t.Microphone;case ir.SCREEN_SHARE:return t.ScreenShare;case ir.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=a;function c(l){switch(l){case vk.ACTIVE:return r.Active;case vk.PAUSED:return r.Paused;default:return r.Unknown}}n.streamStateFromProto=c})(pe);class nn{constructor(e,t,r,i,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&r!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:r,maxFramerate:i,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Rle=["vp8","h264"],kle=["vp8","h264","vp9","av1"];function xle(n){return!!Rle.find(e=>e===n)}var EN;(function(n){n[n.REGRESSION=0]="REGRESSION",n[n.SIMULCAST=1]="SIMULCAST"})(EN||(EN={}));var Gb;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(Gb||(Gb={}));const Ea={h90:new nn(160,90,9e4,20),h180:new nn(320,180,16e4,20),h216:new nn(384,216,18e4,20),h360:new nn(640,360,45e4,20),h540:new nn(960,540,8e5,25),h720:new nn(1280,720,17e5,30),h1080:new nn(1920,1080,3e6,30),h1440:new nn(2560,1440,5e6,30),h2160:new nn(3840,2160,8e6,30)},kk={h120:new nn(160,120,7e4,20),h180:new nn(240,180,125e3,20),h240:new nn(320,240,14e4,20),h360:new nn(480,360,33e4,20),h480:new nn(640,480,5e5,20),h540:new nn(720,540,6e5,25),h720:new nn(960,720,13e5,30),h1080:new nn(1440,1080,23e5,30),h1440:new nn(1920,1440,38e5,30)},Ew={h360fps3:new nn(640,360,2e5,3,"medium"),h360fps15:new nn(640,360,4e5,15,"medium"),h720fps5:new nn(1280,720,8e5,5,"medium"),h720fps15:new nn(1280,720,15e5,15,"medium"),h720fps30:new nn(1280,720,2e6,30,"medium"),h1080fps15:new nn(1920,1080,25e5,15,"medium"),h1080fps30:new nn(1920,1080,5e6,30,"medium"),original:new nn(0,0,7e6,30,"medium")},Ple="|",CN="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Lle(n){const e=n.split(Ple);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Zi(n){return Z(this,void 0,void 0,function*(){return new Promise(e=>Yr.setTimeout(e,n))})}function xk(){return"addTransceiver"in RTCPeerConnection.prototype}function Pk(){return"addTrack"in RTCPeerConnection.prototype}function Ale(){if(!("getCapabilities"in RTCRtpSender)||eu())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/AV1"){e=!0;break}}return e}function Mle(){if(!("getCapabilities"in RTCRtpSender)||Wf())return!1;if(eu()){const t=ka();if(t!=null&&t.version&&zf(t.version,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/VP9"){e=!0;break}}return e}function Ag(n){return n==="av1"||n==="vp9"}function Lk(n){return document?(n||(n=document.createElement("audio")),"setSinkId"in n):!1}function Ole(){return typeof RTCPeerConnection>"u"?!1:xk()||Pk()}function Wf(){var n;return((n=ka())===null||n===void 0?void 0:n.name)==="Firefox"}function eu(){var n;return((n=ka())===null||n===void 0?void 0:n.name)==="Safari"}function Nle(){const n=ka();return(n==null?void 0:n.name)==="Safari"&&n.version.startsWith("17.")}function eV(){var n,e;return zi()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Dle(){const n=ka(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&zf(e,n.osVersion)>=0?!0:n.name==="Safari"&&zf(e,n.version)>=0}function zi(){return typeof document<"u"}function xa(){return navigator.product=="ReactNative"}function Ak(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function tV(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function nV(){if(!xa())return;let n=tV();if(n)return n.platform}function TN(){if(zi())return window.devicePixelRatio;if(xa()){let n=tV();if(n)return n.devicePixelRatio}return 1}function zf(n,e){const t=n.split("."),r=e.split("."),i=Math.min(t.length,r.length);for(let s=0;s<i;++s){const o=parseInt(t[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1;if(s===i-1&&o===a)return 0}return n===""&&e!==""?-1:e===""?1:t.length==r.length?0:t.length<r.length?-1:1}function Fle(n){for(const e of n)e.target.handleResize(e)}function Ule(n){for(const e of n)e.target.handleVisibilityChanged(e)}let nI=null;const IN=()=>(nI||(nI=new ResizeObserver(Fle)),nI);let rI=null;const RN=()=>(rI||(rI=new IntersectionObserver(Ule,{root:null,rootMargin:"0px"})),rI);function jle(){var n;const e=new Ice({sdk:tH.JS,protocol:Tle,version:Cle});return xa()&&(e.os=(n=nV())!==null&&n!==void 0?n:""),e}function kN(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=n,i.height=e;const s=i.getContext("2d");s==null||s.fillRect(0,0,i.width,i.height),r&&s&&(s.beginPath(),s.arc(n/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=i.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=t,a}let Hm;function iI(){if(!Hm){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const r=n.createMediaStreamDestination();if(e.connect(t),t.connect(r),e.start(),[Hm]=r.stream.getAudioTracks(),!Hm)throw Error("Could not get empty media stream audio track");Hm.enabled=!1}return Hm.clone()}class rV{constructor(e,t){this.onFinally=t,this.promise=new Promise((r,i)=>Z(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}function $le(n){return kle.includes(n)}function Vl(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function Ble(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function xN(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function Hle(n,e){return n.segments.map(t=>{let{id:r,text:i,language:s,startTime:o,endTime:a,final:c}=t;var l;const u=(l=e.get(r))!==null&&l!==void 0?l:Date.now(),h=Date.now();return c?e.delete(r):e.set(r,u),{id:r,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:h}})}function Vle(n){const{id:e,timestamp:t,message:r,editTimestamp:i}=n;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function PN(n){switch(n.reason){case xt.LeaveRequest:return n.context;case xt.Cancelled:return Uo.CLIENT_INITIATED;case xt.NotAllowed:return Uo.USER_REJECTED;case xt.ServerUnreachable:return Uo.JOIN_FAILURE;default:return Uo.UNKNOWN_REASON}}function D_(n){return n!==void 0?Number(n):void 0}function Xu(n){return n!==void 0?BigInt(n):void 0}function fd(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function Ac(n){return!!n&&n.kind==pe.Kind.Audio}function vp(n){return!!n&&n.kind==pe.Kind.Video}function pl(n){return fd(n)&&vp(n)}function Ju(n){return fd(n)&&Ac(n)}function Mk(n){return!!n&&!n.isLocal}function Gle(n){return!!n&&!n.isLocal}function sI(n){return Mk(n)&&vp(n)}function qle(n){return n.isLocal}function Kle(n,e){const t=[];let r=new TextEncoder().encode(n);for(;r.length>e;){let i=e;for(;i>0;){const s=r[i];if(s!==void 0&&(s&192)!==128)break;i--}t.push(r.slice(0,i)),r=r.slice(i)}return r.length>0&&t.push(r),t}function iV(n,e,t){var r,i,s,o,a;const{optionsWithoutProcessor:c,audioProcessor:l,videoProcessor:u}=KP(n??{}),h=e==null?void 0:e.processor,p=t==null?void 0:t.processor,m=(r=ble(c))!==null&&r!==void 0?r:{};return m.audio===!0&&(m.audio={}),m.video===!0&&(m.video={}),m.audio&&(Ok(m.audio,e),(i=(o=m.audio).deviceId)!==null&&i!==void 0||(o.deviceId="default"),(l||h)&&(m.audio.processor=l??h)),m.video&&(Ok(m.video,t),(s=(a=m.video).deviceId)!==null&&s!==void 0||(a.deviceId="default"),(u||p)&&(m.video.processor=u??p)),m}function Ok(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function Cw(n){var e,t,r,i;const s={};if(n.video)if(typeof n.video=="object"){const o={},a=o,c=n.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Ok(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(r=s.video).deviceId)!==null&&e!==void 0||(r.deviceId="default")}else s.video=n.video?{deviceId:"default"}:!1;else s.video=!1;return n.audio?typeof n.audio=="object"?(s.audio=n.audio,(t=(i=s.audio).deviceId)!==null&&t!==void 0||(i.deviceId="default")):s.audio={deviceId:"default"}:s.audio=!1,s}function sV(n){return Z(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const r=oV();if(r){const i=r.createAnalyser();i.fftSize=2048;const s=i.frequencyBinCount,o=new Uint8Array(s);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield Zi(t),i.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return r.close(),!c}return!1}()})}function oV(){const n=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(n)return new n({latencyHint:"interactive"})}function LN(n){return n===pe.Source.Microphone?"audioinput":n===pe.Source.Camera?"videoinput":void 0}function Wle(n){var e,t;let r=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(r=typeof r=="boolean"?{}:r,eu()?r=Object.assign(Object.assign({},r),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:r,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function F_(n){return n.split("/")[1].toLowerCase()}function zle(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new BP({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function Yt(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?Yt(n.track):{})}}function Yle(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Xle(n,e){var t;n===void 0&&(n={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(n)],i={};for(const s of r)n[s]!==e[s]&&(i[s]=(t=e[s])!==null&&t!==void 0?t:"");return i}function KP(n){const e=Object.assign({},n);let t,r;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:r,optionsWithoutProcessor:e}}function Jle(n){switch(n){case ir.CAMERA:return pe.Source.Camera;case ir.MICROPHONE:return pe.Source.Microphone;case ir.SCREEN_SHARE:return pe.Source.ScreenShare;case ir.SCREEN_SHARE_AUDIO:return pe.Source.ScreenShareAudio;default:return pe.Source.Unknown}}class Zle extends Da.EventEmitter{constructor(e){super(),this.onWorkerMessage=t=>{var r,i;const{kind:s,data:o}=t.data;switch(s){case"error":wt.error(o.error.message),this.emit(Ol.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Ol.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(i=this.room)===null||i===void 0?void 0:i.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Ol.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Hl.KeyRatcheted,o.material,o.keyIndex);break}},this.onWorkerError=t=>{wt.error("e2ee worker encountered an error:",{error:t.error}),this.emit(Ol.EncryptionError,t.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!JH())throw new qP("tried to setup end-to-end encryption on an unsupported browser");if(wt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:ele.getLevel()}};this.worker&&(wt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){wt.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?wt.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(Oe.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(he.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==bs.NONE,i.identity)),e.on(he.ConnectionStateChanged,r=>{r===Ct.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==bs.NONE,i.identity)})})}).on(he.TrackUnsubscribed,(r,i,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:r.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(he.TrackSubscribed,(r,i,s)=>{this.setupE2EEReceiver(r,s.identity,i.trackInfo)}).on(he.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ue.LocalTrackPublished,r=>Z(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),t.on(Hl.SetKey,r=>this.postKey(r)).on(Hl.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(r)}postKey(e){let{key:t,participantIdentity:r,keyIndex:i}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?F_(r.mimeType):void 0)}}setupE2EESender(e,t){if(!fd(e)||!t){t||wt.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,r,i){return Z(this,void 0,void 0,function*(){if(this.worker){if(Ik()){const s={kind:"decode",participantIdentity:r,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(d1 in e&&i){const c={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:r}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:t,codec:i,participantIdentity:r}};this.worker.postMessage(a,[o,s])}e[d1]=!0}})}handleSender(e,t,r){var i;if(!(d1 in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Ik()){wt.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{wt.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:r,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o,[s.readable,s.writable])}e[d1]=!0}}}const oI="default";class Pr{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Pr),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return Z(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Pr.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){wt.debug("awaiting getUserMedia promise");try{t?yield Pr.userMediaPromiseMap.get(t):yield Promise.all(Pr.userMediaPromiseMap.values())}catch{wt.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(i&&!(eu()&&r.hasDeviceInUse(t))&&(o.filter(c=>c.kind===t).length===0||o.some(c=>{const l=c.label==="",u=t?c.kind===t:!0;return l&&u}))){const c={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:"default"}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return r._previousDevices=o,t&&(o=o.filter(a=>a.kind===t)),o}()})}normalizeDeviceId(e,t,r){return Z(this,void 0,void 0,function*(){if(t!==oI)return t;const i=yield this.getDevices(e),s=i.find(a=>a.deviceId===oI);if(!s){wt.warn("could not reliably determine default device");return}const o=i.find(a=>a.deviceId!==oI&&a.groupId===(r??s.groupId));if(!o){wt.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Pr.userMediaPromiseMap.has(e):Pr.userMediaPromiseMap.size>0}}Pr.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Pr.userMediaPromiseMap=new Map;var Mg;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(Mg||(Mg={}));class Qle{constructor(){this.pendingTasks=new Map,this.taskMutex=new Wi,this.nextTaskIndex=0}run(e){return Z(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Mg.WAITING};this.pendingTasks.set(t.id,t);const r=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Mg.RUNNING,yield e()}finally{t.status=Mg.COMPLETED,this.pendingTasks.delete(t.id),r()}})}flush(){return Z(this,void 0,void 0,function*(){return this.run(()=>Z(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const eue=["syncState","trickle","offer","answer","simulate","leave"];function tue(n){const e=eue.indexOf(n.case)>=0;return wt.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var En;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(En||(En={}));class WP{get currentState(){return this.state}get isDisconnected(){return this.state===En.DISCONNECTING||this.state===En.DISCONNECTED}get isEstablishingConnection(){return this.state===En.CONNECTING||this.state===En.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=En.DISCONNECTED,this.log=wt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Lc((r=t.loggerName)!==null&&r!==void 0?r:Go.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new Qle,this.queuedRequests=[],this.closingLock=new Wi,this.connectionLock=new Wi,this.state=En.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,r,i){return Z(this,void 0,void 0,function*(){return this.state=En.CONNECTING,this.options=r,yield this.connect(e,t,r,i)})}reconnect(e,t,r,i){return Z(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=En.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,t,r,i){this.connectOptions=r,e=Ble(e),e=e.replace(/\/$/,""),e+="/rtc";const s=jle(),o=nue(t,s,r);return new Promise((a,c)=>Z(this,void 0,void 0,function*(){const l=yield this.connectionLock.lock();try{const u=()=>Z(this,void 0,void 0,function*(){this.close(),clearTimeout(h),c(new rn("room connection has been cancelled (signal)",xt.Cancelled))}),h=setTimeout(()=>{this.close(),c(new rn("room connection has timed out (signal)",xt.ServerUnreachable))},r.websocketTimeout);i!=null&&i.aborted&&u(),i==null||i.addEventListener("abort",u),this.log.debug("connecting to ".concat(e+o.replace(/access_token=([^&#$]*)/,"access_token=<redacted>")),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+o),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(h)},this.ws.onerror=p=>Z(this,void 0,void 0,function*(){if(this.state!==En.CONNECTED){this.state=En.DISCONNECTED,clearTimeout(h);try{const m=yield fetch("http".concat(e.substring(2),"/validate").concat(o));if(m.status.toFixed(0).startsWith("4")){const v=yield m.text();c(new rn(v,xt.NotAllowed,m.status))}else c(new rn("Internal error",xt.InternalError,m.status))}catch(m){c(new rn(m instanceof Error?m.message:"server was not reachable",xt.ServerUnreachable))}return}this.handleWSError(p)}),this.ws.onmessage=p=>Z(this,void 0,void 0,function*(){var m,v,g;let S;if(typeof p.data=="string"){const b=JSON.parse(p.data);S=cN.fromJson(b,{ignoreUnknownFields:!0})}else if(p.data instanceof ArrayBuffer)S=cN.fromBinary(new Uint8Array(p.data));else{this.log.error("could not decode websocket message: ".concat(typeof p.data),this.logContext);return}if(this.state!==En.CONNECTED){let b=!1;if(((m=S.message)===null||m===void 0?void 0:m.case)==="join"?(this.state=En.CONNECTED,i==null||i.removeEventListener("abort",u),this.pingTimeoutDuration=S.message.value.pingTimeout,this.pingIntervalDuration=S.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),a(S.message.value)):this.state===En.RECONNECTING&&S.message.case!=="leave"?(this.state=En.CONNECTED,i==null||i.removeEventListener("abort",u),this.startPingInterval(),((v=S.message)===null||v===void 0?void 0:v.case)==="reconnect"?a(S.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),a(void 0),b=!0)):this.isEstablishingConnection&&S.message.case==="leave"?c(new rn("Received leave request while trying to (re)connect",xt.LeaveRequest,void 0,S.message.value.reason)):r.reconnect||c(new rn("did not receive join response, got ".concat((g=S.message)===null||g===void 0?void 0:g.case," instead"),xt.InternalError)),!b)return}this.signalLatency&&(yield Zi(this.signalLatency)),this.handleSignalResponse(S)}),this.ws.onclose=p=>{this.isEstablishingConnection&&c(new rn("Websocket got closed during a (re)connection attempt",xt.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:p.reason,code:p.code,wasClean:p.wasClean,state:this.state})),this.handleOnClose(p.reason)}}finally{l()}}))}close(){return Z(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=En.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const i=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([i,Zi(250)])),e.ws=void 0}}finally{t&&(e.state=En.DISCONNECTED),r()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:qb(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:qb(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new jP({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new $P({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return Z(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new lH({requestId:a,metadata:r,name:i,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new cH({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new hH({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Tn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new mH({timestamp:Tn.parse(Date.now()),rtt:Tn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new aH({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new ww({reason:Uo.CLIENT_INITIATED,action:Cf.DISCONNECT})})}sendRequest(e){return Z(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!i&&!tue(t)&&r.state===En.RECONNECTING){r.queuedRequests.push(()=>Z(r,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield Zi(r.signalLatency)),!r.ws||r.ws.readyState!==r.ws.OPEN){r.log.error("cannot send signal request before connected, type: ".concat(t==null?void 0:t.case),r.logContext);return}const o=new xce({message:t});try{r.useJSON?r.ws.send(o.toJsonString()):r.ws.send(o.toBinary())}catch(a){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:a}))}}()})}handleSignalResponse(e){var t,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(i.case==="answer"){const o=AN(i.value);this.onAnswer&&this.onAnswer(o)}else if(i.case==="offer"){const o=AN(i.value);this.onOffer&&this.onOffer(o)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=i.value.participants)!==null&&t!==void 0?t:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Z(this,void 0,void 0,function*(){if(this.state===En.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Yr.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Yr.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Yr.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Yr.clearInterval(this.pingInterval)}}function AN(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function qb(n){return new kd({sdp:n.sdp,type:n.type})}function nue(n,e,t){var r;const i=new URLSearchParams;return i.set("access_token",n),t.reconnect&&(i.set("reconnect","1"),t.sid&&i.set("sid",t.sid)),i.set("auto_subscribe",t.autoSubscribe?"1":"0"),i.set("sdk",xa()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),t.adaptiveStream&&i.set("adaptive_stream","1"),t.reconnectReason&&i.set("reconnect_reason",t.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),"?".concat(i.toString())}var bo={},aI={},cI={exports:{}},MN;function zP(){if(MN)return cI.exports;MN=1;var n=cI.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),cI.exports}var ON;function rue(){return ON||(ON=1,function(n){var e=function(a){return String(Number(a))===a?Number(a):a},t=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},r=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:u?c[a.name]:c;t(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},i=zP(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var p=h[0],m=h.slice(2);p==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var v=0;v<(i[p]||[]).length;v+=1){var g=i[p][v];if(g.reg.test(m))return r(g,u,m)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};n.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(a){return a.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},n.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},n.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,h=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),h=!0),{scid:u,paused:h}})})}}(aI)),aI}var lI,NN;function iue(){if(NN)return lI;NN=1;var n=zP(),e=/%[sdv%]/g,t=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var h=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},r=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var p=a.names[h];a.name?u.push(c[a.name][p]):u.push(c[a.names[h]])}else u.push(c[a.name]);return t.apply(null,u)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return lI=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||i,l=a.innerOrder||s,u=[];return c.forEach(function(h){n[h].forEach(function(p){p.name in o&&o[p.name]!=null?u.push(r(h,p,o)):p.push in o&&o[p.push]!=null&&o[p.push].forEach(function(m){u.push(r(h,p,m))})})}),o.media.forEach(function(h){u.push(r("m",n.m[0],h)),l.forEach(function(p){n[p].forEach(function(m){m.name in h&&h[m.name]!=null?u.push(r(p,m,h)):m.push in h&&h[m.push]!=null&&h[m.push].forEach(function(v){u.push(r(p,m,v))})})})}),u.join(`\r
`)+`\r
`},lI}var DN;function sue(){if(DN)return bo;DN=1;var n=rue(),e=iue(),t=zP();return bo.grammar=t,bo.write=e,bo.parse=n.parse,bo.parseParams=n.parseParams,bo.parseFmtpConfig=n.parseFmtpConfig,bo.parsePayloads=n.parsePayloads,bo.parseRemoteCandidates=n.parseRemoteCandidates,bo.parseImageAttributes=n.parseImageAttributes,bo.parseSimulcastStreamList=n.parseSimulcastStreamList,bo}var Sl=sue();function YP(n,e,t){var r,i,s;e===void 0&&(e=50),t===void 0&&(t={});var o=(r=t.isImmediate)!=null&&r,a=(i=t.callback)!=null&&i,c=t.maxWait,l=Date.now(),u=[];function h(){if(c!==void 0){var m=Date.now()-l;if(m+e>=c)return c-m}return e}var p=function(){var m=[].slice.call(arguments),v=this;return new Promise(function(g,S){var b=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var k=n.apply(v,m);a&&a(k),u.forEach(function(I){return(0,I.resolve)(k)}),u=[]}},h()),b){var R=n.apply(v,m);return a&&a(R),g(R)}u.push({resolve:g,reject:S})})};return p.cancel=function(m){s!==void 0&&clearTimeout(s),u.forEach(function(v){return(0,v.reject)(m)}),u=[]},p}const oue=.7,aue=20,Rf={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class FN extends Da.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=wt,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=YP(i=>Z(this,void 0,void 0,function*(){this.emit(Rf.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(i)i(s);else throw s}}),aue),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Lc((r=t.loggerName)!==null&&r!==void 0?r:Go.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var r;t.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,t.candidate))},e.onicecandidateerror=t=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,t)},e.ontrack=t=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return Z(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return Z(this,void 0,void 0,function*(){var t;let r;if(e.type==="offer"){let{stereoMids:i,nackMids:s}=cue(e);this.remoteStereoMids=i,this.remoteNackMids=s}else if(e.type==="answer"){const i=Sl.parse((t=e.sdp)!==null&&t!==void 0?t:"");i.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(o=>{if(!o.transceiver||s.mid!=o.transceiver.mid)return!1;let a=0;if(s.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(a=l.payload,!0):!1),a===0)return!0;let c=!1;for(const l of s.fmtp)if(l.payload===a){l.config=l.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),o.maxbr>0&&(l.config+=";maxaveragebitrate=".concat(o.maxbr*1e3)),c=!0;break}return c||o.maxbr>0&&s.fmtp.push({payload:a,config:"maxaveragebitrate=".concat(o.maxbr*1e3)}),!0})}),r=Sl.write(i)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(i=>{this.pc.addIceCandidate(i)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Rf.NegotiationComplete),e.sdp&&Sl.parse(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(Rf.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(e){return Z(this,void 0,void 0,function*(){var t;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&s)yield this._pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const i=Sl.parse((t=r.sdp)!==null&&t!==void 0?t:"");i.media.forEach(s=>{jN(s),s.type==="audio"?UN(s,[],[]):s.type==="video"&&this.trackBitrates.some(o=>{if(!s.msid||!o.cid||!s.msid.includes(o.cid))return!1;let a=0;if(s.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(a=l.payload,!0):!1),a===0||(Ag(o.codec)&&this.ensureVideoDDExtensionForSVC(s,i),o.codec!=="av1"))return!0;const c=Math.round(o.maxbr*oue);for(const l of s.fmtp)if(l.payload===a){l.config.includes("x-google-start-bitrate")||(l.config+=";x-google-start-bitrate=".concat(c));break}return!0})}),yield this.setMungedSDP(r,Sl.write(i)),this.onOffer(r)})}createAndSetAnswer(){return Z(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),r=Sl.parse((e=t.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{jN(i),i.type==="audio"&&UN(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Sl.write(r)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new dr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new dr("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return Z(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":t=a.selectedCandidatePairId;break;case"candidate-pair":t===""&&a.selected&&(t=a.id),r.set(a.id,a);break;case"remote-candidate":i.set(a.id,"".concat(a.address,":").concat(a.port));break}}),t==="")return;const o=(e=r.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return i.get(o)})}setMungedSDP(e,t,r){return Z(this,void 0,void 0,function*(){if(t){const i=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:t})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let s="unknown error";i instanceof Error?s=i.message:typeof i=="string"&&(s=i);const o={error:s,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Rk(s)}})}ensureVideoDDExtensionForSVC(e,t){var r,i;if(!((r=e.ext)===null||r===void 0?void 0:r.some(o=>o.uri===CN))){if(this.ddExtID===0){let o=0;t.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(i=e.ext)===null||i===void 0||i.push({value:this.ddExtID,uri:CN})}}}function UN(n,e,t){let r=0;n.rtp.some(i=>i.codec==="opus"?(r=i.payload,!0):!1),r>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(n.mid)&&!n.rtcpFb.some(i=>i.payload===r&&i.type==="nack")&&n.rtcpFb.push({payload:r,type:"nack"}),e.includes(n.mid)&&n.fmtp.some(i=>i.payload===r?(i.config.includes("stereo=1")||(i.config+=";stereo=1"),!0):!1))}function cue(n){var e;const t=[],r=[],i=Sl.parse((e=n.sdp)!==null&&e!==void 0?e:"");let s=0;return i.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&r.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&t.push(o.mid),!0):!1))}),{stereoMids:t,nackMids:r}}function jN(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}const Nk="vp8",lue={audioPreset:Gb.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Ew.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Nk,backupCodec:!0},aV={deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},cV={deviceId:"default",resolution:Ea.h720.resolution},uue={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new yH,disconnectOnPageLeave:!0,webAudioMix:!1},XP={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Dn;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(Dn||(Dn={}));class due{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,r){var i;this.peerConnectionTimeout=XP.peerConnectionTimeout,this.log=wt,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=Dn.CONNECTED:a.some(c=>c==="failed")?this.state=Dn.FAILED:a.some(c=>c==="connecting")?this.state=Dn.CONNECTING:a.every(c=>c==="closed")?this.state=Dn.CLOSED:a.some(c=>c==="closed")?this.state=Dn.CLOSING:a.every(c=>c==="new")&&(this.state=Dn.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(Dn[o]," to ").concat(Dn[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Lc((i=r.loggerName)!==null&&i!==void 0?i:Go.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new FN(e,r),this.subscriber=new FN(e,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,No.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,No.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=s=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,s)},this.state=Dn.NEW,this.connectionLock=new Wi,this.remoteOfferLock=new Wi}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Z(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return Z(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return Z(this,void 0,void 0,function*(){t===No.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return Z(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const t=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{t()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return Z(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(s=>this.ensureTransportConnected(s,e,t)))}finally{i()}})}negotiate(e){return Z(this,void 0,void 0,function*(){return new Promise((t,r)=>Z(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Rf.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Rf.NegotiationComplete,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(o=>{clearTimeout(i),r(o)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===No.PUBLISHER?this.publisher.getConnectedAddress():e===No.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return Z(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(r.getConnectionState()!=="connected")return new Promise((c,l)=>Z(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Yr.clearTimeout(h),l(new rn("room connection has been cancelled",xt.Cancelled))};i!=null&&i.signal.aborted&&u(),i==null||i.signal.addEventListener("abort",u);const h=Yr.setTimeout(()=>{i==null||i.signal.removeEventListener("abort",u),l(new rn("could not establish pc connection",xt.InternalError))},o);for(;this.state!==Dn.CONNECTED;)if(yield Zi(50),i!=null&&i.signal.aborted){l(new rn("room connection has been cancelled",xt.Cancelled));return}Yr.clearTimeout(h),i==null||i.signal.removeEventListener("abort",u),c()}))}()})}}class Un extends Error{constructor(e,t,r){super(t),this.code=e,this.message=$N(t,Un.MAX_MESSAGE_BYTES),this.data=r?$N(r,Un.MAX_DATA_BYTES):void 0}static fromProto(e){return new Un(e.code,e.message,e.data)}toProto(){return new ZB({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Un(Un.ErrorCode[e],Un.ErrorMessage[e],t)}}Un.MAX_MESSAGE_BYTES=256;Un.MAX_DATA_BYTES=15360;Un.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Un.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const lV=15360;function JP(n){return new TextEncoder().encode(n).length}function $N(n,e){if(JP(n)<=e)return n;let t=0,r=n.length;const i=new TextEncoder;for(;t<r;){const s=Math.floor((t+r+1)/2);i.encode(n.slice(0,s)).length<=e?t=s:r=s-1}return n.slice(0,t)}const ZP=2e3;function Tw(n,e){if(!e)return 0;let t,r;return"bytesReceived"in n?(t=n.bytesReceived,r=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,r=e.bytesSent),t===void 0||r===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-r)*8*1e3/(n.timestamp-e.timestamp)}const hue=1e3;class Iw extends pe{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,t,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=YP(()=>Z(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>Z(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Pe.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new Wi,this.pauseUpstreamLock=new Wi,this.processorLock=new Wi,this.restartLock=new Wi,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==pe.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return Z(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{If(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(uf(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}finally{s()}}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(i??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{uf(i??e,s)}))})}waitForDimensions(){return Z(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hue;return function*(){var r;if(e.kind===pe.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=ka())===null||r===void 0?void 0:r.os)==="iOS"&&(yield Zi(10));const i=Date.now();for(;Date.now()-i<t;){const s=e.dimensions;if(s)return s;yield Zi(50)}throw new fc("unable to get track dimensions after timeout")}()})}setDeviceId(e){return Z(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Vl(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Vl(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return Z(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===pe.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),s=e.kind===pe.Kind.Audio?"audioinput":"videoinput";return t?Pr.getInstance().normalizeDeviceId(s,r,i):r}()})}mute(){return Z(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return Z(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return Z(this,void 0,void 0,function*(){if(!this.sender)throw new fc("unable to replace an unpublished track");let r,i;return typeof t=="boolean"?r=t:t!==void 0&&(r=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return Z(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints);const r=this._constraints,{deviceId:i}=r,s=nle(r,["deviceId"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===pe.Kind.Video?o.video=i?{deviceId:i}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{If(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(Pe.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Pe.Muted:Pe.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Z(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),eV()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return Z(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Pe.UpstreamPaused,this);const r=ka();if((r==null?void 0:r.name)==="Safari"&&zf(r.version,"12.0")<0)throw new qP("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return Z(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Pe.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return Z(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return Z(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield r.processorLock.lock();try{r.log.debug("setting up processor",r.logContext);const a=document.createElement(r.kind),c={kind:r.kind,track:r._mediaStreamTrack,element:a,audioContext:r.audioContext};if(yield t.init(c),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.stopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(uf(r._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:l}))),r.processor=t,r.processorElement=a,r.processor.processedTrack){for(const l of r.attachedElements)l!==r.processorElement&&i&&(If(r._mediaStreamTrack,l),uf(r.processor.processedTrack,l));yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(r.processor.processedTrack)}r.emit(Pe.TrackProcessorUpdate,r.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return Z(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,t||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Pe.TrackProcessorUpdate))}()})}}class Kb extends Iw{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,pe.Kind.Audio,t,r,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>Z(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Tw(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Pe.AudioTrackFeatureUpdate,this,va.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Pe.AudioTrackFeatureUpdate,this,va.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Z(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Z(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Vl(this._constraints.deviceId);return this.source===pe.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return Z(this,void 0,void 0,function*(){let t;if(e){const r=Cw({audio:e});typeof r.audio!="boolean"&&(t=r.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Z(this,void 0,void 0,function*(){const r=yield t.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){zi()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},ZP)))}setProcessor(e){return Z(this,void 0,void 0,function*(){var t;const r=yield this.processorLock.lock();try{if(!xa()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Pe.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return Z(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let r;return t.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return Z(this,void 0,void 0,function*(){const e=yield sV(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Pe.AudioSilenceDetected)),e})}}function uV(n,e,t){switch(n.kind){case"audio":return new Kb(n,e,!1,void 0,t);case"video":return new yv(n,e,!1,t);default:throw new fc("unsupported track type: ".concat(n.kind))}}const fue=Object.values(Ea),pue=Object.values(kk),mue=Object.values(Ew),gue=[Ea.h180,Ea.h360],vue=[kk.h180,kk.h360],yue=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var r,i;return new nn(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((r=n.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((i=t.fps)!==null&&i!==void 0?i:30))))),t.fps,n.encoding.priority)}),Dk=["q","h","f"];function Fk(n,e,t,r){var i,s;let o=r==null?void 0:r.videoEncoding;n&&(o=r==null?void 0:r.screenShareEncoding);const a=r==null?void 0:r.simulcast,c=r==null?void 0:r.scalabilityMode,l=r==null?void 0:r.videoCodec;if(!o&&!a&&!c||!e||!t)return[{}];o||(o=bue(n,e,t,l),wt.debug("using video encoding",o));const u=o.maxFramerate,h=new nn(e,t,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Ag(l)){const v=new dV(c),g=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const S=ka();if(eu()||xa()||(S==null?void 0:S.name)==="Chrome"&&zf(S==null?void 0:S.version,"113")<0){const b=v.suffix=="h"?2:3;for(let R=0;R<v.spatial;R+=1)g.push({rid:Dk[2-R],maxBitrate:o.maxBitrate/Math.pow(b,R),maxFramerate:h.encoding.maxFramerate});g[0].scalabilityMode=c}else g.push({maxBitrate:o.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(g[0].priority=h.encoding.priority,g[0].networkPriority=h.encoding.priority),wt.debug("using svc encoding",{encodings:g}),g}if(!a)return[o];let p=[];n?p=(i=HN(r==null?void 0:r.screenShareSimulcastLayers))!==null&&i!==void 0?i:BN(n,h):p=(s=HN(r==null?void 0:r.videoSimulcastLayers))!==null&&s!==void 0?s:BN(n,h);let m;if(p.length>0){const v=p[0];p.length>1&&([,m]=p);const g=Math.max(e,t);if(g>=960&&m)return uI(e,t,[v,m,h],u);if(g>=480)return uI(e,t,[v,h],u)}return uI(e,t,[h])}function _ue(n,e,t){var r,i,s,o;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&wt.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const a=n.mediaStreamTrack.getSettings(),c=(r=a.width)!==null&&r!==void 0?r:(i=n.dimensions)===null||i===void 0?void 0:i.width,l=(s=a.height)!==null&&s!==void 0?s:(o=n.dimensions)===null||o===void 0?void 0:o.height;return n.source===pe.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),Fk(n.source===pe.Source.ScreenShare,c,l,t)}function bue(n,e,t,r){const i=Sue(n,e,t);let{encoding:s}=i[0];const o=Math.max(e,t);for(let a=0;a<i.length;a+=1){const c=i[a];if(s=c.encoding,c.width>=o)break}if(r)switch(r){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function Sue(n,e,t){if(n)return mue;const r=e>t?e/t:t/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?fue:pue}function BN(n,e){if(n)return yue(e);const{width:t,height:r}=e,i=t>r?t/r:r/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?gue:vue}function uI(n,e,t,r){const i=[];if(t.forEach((s,o)=>{if(o>=Dk.length)return;const a=Math.min(n,e),l={rid:Dk[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=r&&s.encoding.maxFramerate?Math.min(r,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const h=Wf()||o===0;s.encoding.priority&&h&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),i.push(l)}),xa()&&nV()==="ios"){let s;i.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;i.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,wt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),wt.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return i}function HN(n){if(n)return n.sort((e,t)=>{const{encoding:r}=e,{encoding:i}=t;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class dV{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function wue(n){return n.source===pe.Source.ScreenShare||n.constraints.height&&Vl(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const Eue=5e3;class yv extends Iw{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,pe.Kind.Video,t,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>Z(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}const o=new Map(s.map(a=>[a.rid,a]));if(this.prevStats){let a=0;o.forEach((c,l)=>{var u;const h=(u=this.prevStats)===null||u===void 0?void 0:u.get(l);a+=Tw(c,h)}),this._currentBitrate=a}this.prevStats=o}),this.senderLock=new Wi}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!zi())return;const r=(t=this.sender)===null||t===void 0?void 0:t.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},ZP))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return Z(this,void 0,void 0,function*(){var t,r,i,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=xl(this.simulcastCodecs.values()),l;l=yield c.next(),t=l.done,!t;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){r={error:u}}finally{try{!a&&!t&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return Z(this,void 0,void 0,function*(){var t,r,i,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=xl(this.simulcastCodecs.values()),l;l=yield c.next(),t=l.done,!t;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){r={error:u}}finally{try{!a&&!t&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Z(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Z(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return Z(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],r=yield this.sender.getStats();return r.forEach(i=>{var s;if(i.type==="outbound-rtp"){const o={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(s=i.rid)!==null&&s!==void 0?s:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},a=r.get(i.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),t.push(o)}}),t.sort((i,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=i.frameWidth)!==null&&a!==void 0?a:0)}),t})}setPublishingQuality(e){const t=[];for(let r=Ks.LOW;r<=Ks.HIGH;r+=1)t.push(new HP({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}restartTrack(e){return Z(this,void 0,void 0,function*(){var t,r,i,s,o;let a;if(e){const h=Cw({video:e});typeof h.video!="boolean"&&(a=h.video)}yield this.restart(a);try{for(var c=!0,l=xl(this.simulcastCodecs.values()),u;u=yield l.next(),t=u.done,!t;c=!0){s=u.value,c=!1;const h=s;h.sender&&((o=h.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){r={error:h}}finally{try{!c&&!t&&(i=l.return)&&(yield i.call(l))}finally{if(r)throw r.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return Z(this,arguments,void 0,function(r){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,h;if(yield t.setProcessor.call(i,r,s),!((u=i.processor)===null||u===void 0)&&u.processedTrack)try{for(var p=!0,m=xl(i.simulcastCodecs.values()),v;v=yield m.next(),o=v.done,!o;p=!0)l=v.value,p=!1,yield(h=l.sender)===null||h===void 0?void 0:h.replaceTrack(i.processor.processedTrack)}catch(g){a={error:g}}finally{try{!p&&!o&&(c=m.return)&&(yield c.call(m))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return Z(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,t){const r=this.simulcastCodecs.get(e);r&&(r.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Eue))}setPublishingCodecs(e){return Z(this,void 0,void 0,function*(){var t,r,i,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(t=!0,r=xl(e);i=yield r.next(),s=i.done,!s;t=!0){c=i.value,t=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const h=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const p of u.qualities)if(p.enabled){l.push(u.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield VN(h.sender,h.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!t&&!s&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e){return Z(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield VN(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Z(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),eV()&&this.isInBackground&&this.source===pe.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function VN(n,e,t,r,i,s){return Z(this,void 0,void 0,function*(){const o=yield r.lock();i.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:n,qualities:t,senderEncodings:e}));try{const a=n.getParameters(),{encodings:c}=a;if(!c)return;if(c.length!==e.length){i.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:c,senderEncodings:e}));return}let l=!1;!1&&c[0].scalabilityMode||c.forEach((h,p)=>{var m;let v=(m=h.rid)!==null&&m!==void 0?m:"";v===""&&(v="q");const g=hV(v),S=t.find(b=>b.quality===g);S&&h.active!==S.enabled&&(l=!0,h.active=S.enabled,i.debug("setting layer ".concat(S.quality," to ").concat(h.active?"enabled":"disabled"),s),Wf()&&(S.enabled?(h.scaleResolutionDownBy=e[p].scaleResolutionDownBy,h.maxBitrate=e[p].maxBitrate,h.maxFrameRate=e[p].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))}),l&&(a.encodings=c,i.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:a.encodings})),yield n.setParameters(a))}finally{o()}})}function hV(n){switch(n){case"f":return Ks.HIGH;case"h":return Ks.MEDIUM;case"q":return Ks.LOW;default:return Ks.HIGH}}function GN(n,e,t,r){if(!t)return[new hd({quality:Ks.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(r){const i=t[0].scalabilityMode,s=new dV(i),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new hd({quality:Math.min(Ks.HIGH,s.spatial-1)-l,width:Math.ceil(n/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return t.map(i=>{var s,o,a;const c=(s=i.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=hV((o=i.rid)!==null&&o!==void 0?o:"");return new hd({quality:l,width:Math.ceil(n/c),height:Math.ceil(e/c),bitrate:(a=i.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const qN="_lossy",KN="_reliable",Cue=2*1e3,dI="leave-reconnect";var wo;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(wo||(wo={}));class Tue extends Da.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=XP.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=wo.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=wt,this.handleDataChannel=r=>Z(this,[r],void 0,function(i){var s=this;let{channel:o}=i;return function*(){if(o){if(o.label===KN)s.reliableDCSub=o;else if(o.label===qN)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=r=>Z(this,void 0,void 0,function*(){var i,s;const o=yield this.dataProcessLock.lock();try{let a;if(r.data instanceof ArrayBuffer)a=r.data;else if(r.data instanceof Blob)a=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const c=$i.fromBinary(new Uint8Array(a));((i=c.value)===null||i===void 0?void 0:i.case)==="speaker"?this.emit(Oe.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&Rue(c,c.value.value),this.emit(Oe.DataPacketReceived,c))}finally{o()}}),this.handleDataError=r=>{const s=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:o}=r.error;this.log.error("DataChannel error on ".concat(s,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const s=r.currentTarget.maxRetransmits===0?Nt.LOSSY:Nt.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(Oe.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}r===dI&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Yr.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===wo.Connected&&r();const s=()=>{this.off(Oe.Disconnected,o),r()},o=()=>{this.off(Oe.Restarted,s),i()};this.once(Oe.Restarted,s),this.once(Oe.Disconnected,o)}),this.updateAndEmitDCBufferStatus=r=>{const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit(Oe.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===En.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Nh.RR_SIGNAL_DISCONNECTED))},this.log=Lc((t=e.loggerName)!==null&&t!==void 0?t:Go.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new WP(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Wi,this.dataProcessLock=new Wi,this.dcBufferStatus=new Map([[Nt.LOSSY,!0],[Nt.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(Oe.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(Oe.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(Oe.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(Oe.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(Oe.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(Oe.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(Oe.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(Oe.SignalRequestResponse,r)}get logContext(){var e,t,r,i,s,o,a,c;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:(c=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.participant)===null||c===void 0?void 0:c.sid}}join(e,t,r,i){return Z(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,t,r,i);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,s}catch(s){if(s instanceof rn&&s.reason===xt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,r,i);throw s}})}close(){return Z(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(Oe.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return Z(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return Z(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new fc("a track with the same ID has already been published");return new Promise((t,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new rn("publication of local track timed out, no response from server",xt.InternalError))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(i),t(s)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return Z(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return Z(this,void 0,void 0,function*(){var t,r;if(this.pcManager&&this.pcManager.currentState!==Dn.NEW)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new due(i,e.subscriberPrimary,this.loggerOptions),this.emit(Oe.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=s=>{this.client.sendOffer(s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>Z(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===Dn.CONNECTED){const u=this.pcState===wo.New;this.pcState=wo.Connected,u&&this.emit(Oe.Connected,e)}else s===Dn.FAILED&&this.pcState===wo.Connected&&(this.pcState=wo.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?Nh.RR_SUBSCRIBER_FAILED:Nh.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===En.RECONNECTING,l=[Dn.FAILED,Dn.CLOSING,Dn.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(Oe.Offline)}),this.pcManager.onTrack=s=>{this.emit(Oe.MediaTrackAdded,s.track,s.streams[0],s.receiver)},Iue((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>Z(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>Z(this,void 0,void 0,function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Oe.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Oe.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(Oe.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Oe.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Nh.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Cf.DISCONNECT:this.emit(Oe.Disconnected,e==null?void 0:e.reason),this.close();break;case Cf.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(dI);break;case Cf.RESUME:this.handleDisconnect(dI)}}}makeRTCConfiguration(e){var t;const r=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),i.push(o)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===mv.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(qN,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(KN,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,r){return Z(this,void 0,void 0,function*(){if(xk())return yield this.createTransceiverRTCRtpSender(e,t,r);if(Pk())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new dr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,r,i){return Z(this,void 0,void 0,function*(){if(xk())return this.createSimulcastTransceiverSender(e,t,r,i);if(Pk())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new dr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,r){return Z(this,void 0,void 0,function*(){if(!this.pcManager)throw new dr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),vp(e)&&(e.codec=t.videoCodec);const s={direction:"sendonly",streams:i};return r&&(s.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,t,r,i){return Z(this,void 0,void 0,function*(){if(!this.pcManager)throw new dr("publisher is closed");const s={direction:"sendonly"};i&&(s.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,s);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return Z(this,void 0,void 0,function*(){if(!this.pcManager)throw new dr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return Z(this,void 0,void 0,function*(){var t,r,i;if(!this._isClosed){if(this.attemptingReconnect){wt.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===mv.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:Dn.NEW)===Dn.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof dr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Dh||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Nh.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Oe.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return Z(this,void 0,void 0,function*(){var t,r,i;try{if(!this.url||!this.token)throw new dr("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Oe.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Dh;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof rn&&o.reason===xt.NotAllowed?new dr("could not reconnect, token might be expired"):new Dh}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Oe.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==En.CONNECTED)throw new Dh("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(Oe.Restarted)}catch(s){const o=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),s}})}resumeConnection(e){return Z(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new dr("could not reconnect, url or token not saved");if(!this.pcManager)throw new dr("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Oe.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let s="";throw i instanceof Error&&(s=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof rn&&i.reason===xt.NotAllowed?new dr("could not reconnect, token might be expired"):i instanceof rn&&i.reason===xt.LeaveRequest?i:new Dh(s)}if(this.emit(Oe.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==En.CONNECTED)throw new Dh("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(Oe.Resumed)})}waitForPCInitialConnection(e,t){return Z(this,void 0,void 0,function*(){if(!this.pcManager)throw new dr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return Z(this,void 0,void 0,function*(){this.pcState=wo.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Zi(Cue),!this.pcManager)throw new dr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=wo.Connected}catch(e){throw this.pcState=wo.Disconnected,new rn("could not establish PC connection, ".concat(e.message),xt.InternalError)}})}publishRpcResponse(e,t,r,i){return Z(this,void 0,void 0,function*(){const s=new $i({destinationIdentities:[e],kind:Nt.RELIABLE,value:{case:"rpcResponse",value:new JB({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(s,Nt.RELIABLE)})}publishRpcAck(e,t){return Z(this,void 0,void 0,function*(){const r=new $i({destinationIdentities:[e],kind:Nt.RELIABLE,value:{case:"rpcAck",value:new XB({requestId:t})}});yield this.sendDataPacket(r,Nt.RELIABLE)})}sendDataPacket(e,t){return Z(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(t);const i=this.dataChannelForKind(t);i&&i.send(r),this.updateAndEmitDCBufferStatus(t)})}waitForBufferStatusLow(e){return new Promise((t,r)=>Z(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>r("Engine closed");for(this.once(Oe.Closing,i);!this.dcBufferStatus.get(e);)yield Zi(10);this.off(Oe.Closing,i),t()}}))}ensureDataTransportConnected(e){return Z(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!r.pcManager)throw new dr("PC manager is closed");const o=i?r.pcManager.subscriber:r.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new rn("".concat(a," connection not set"),xt.InternalError);let c=!1;!i&&!r.dataChannelForKind(t,i)&&(r.createDataChannels(),c=!0),!c&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&r.negotiate();const l=r.dataChannelForKind(t,i);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=r.dataChannelForKind(t,i))===null||s===void 0?void 0:s.readyState)==="open")return;yield Zi(50)}throw new rn("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),xt.InternalError)}()})}ensurePublisherConnected(e){return Z(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Dn.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return Z(this,void 0,void 0,function*(){return new Promise((e,t)=>Z(this,void 0,void 0,function*(){if(!this.pcManager){t(new Rk("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(Oe.Closing,i),this.pcManager.publisher.once(Rf.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();$le(c)&&o.set(a.payload,c)}),this.emit(Oe.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(r),e()}catch(s){s instanceof Rk&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Nh.RR_UNKNOWN),t(s)}finally{this.off(Oe.Closing,i)}}))})}dataChannelForKind(e,t){if(t){if(e===Nt.LOSSY)return this.lossyDCSub;if(e===Nt.RELIABLE)return this.reliableDCSub}else{if(e===Nt.LOSSY)return this.lossyDC;if(e===Nt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var r,i;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(i=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&i!==void 0?i:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new fH({answer:s?qb({sdp:s.sdp,type:s.type}):void 0,offer:o?qb({sdp:o.sdp,type:o.type}):void 0,subscription:new Sw({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:zle(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(r,i)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new pH({label:r.label,id:r.id,target:i}))};return t(this.dataChannelForKind(Nt.LOSSY),No.PUBLISHER),t(this.dataChannelForKind(Nt.RELIABLE),No.PUBLISHER),t(this.dataChannelForKind(Nt.LOSSY,!0),No.SUBSCRIBER),t(this.dataChannelForKind(Nt.RELIABLE,!0),No.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Yr.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){zi()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){zi()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Dh extends Error{}function Iue(n){return n!==void 0&&n>13}function Rue(n,e){const t=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=t,e.participantIdentity=t;const r=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=r,e.destinationIdentities=r}class Uk{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Ak(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Z(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(i=>i.url===r.url));if(t.length>0){const r=t[0];return this.attemptedRegions.push(r),wt.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return Z(this,void 0,void 0,function*(){const t=yield fetch("".concat(kue(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const r=yield t.json();return this.lastUpdateAt=Date.now(),r}else throw new rn("Could not fetch region settings: ".concat(t.statusText),t.status===401?xt.NotAllowed:xt.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function kue(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class fV{get info(){return this._info}constructor(e,t,r){this.reader=t,this.totalByteSize=r,this._info=e,this.bytesReceived=0}}class xue extends fV{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>Z(this,void 0,void 0,function*(){try{const{done:t,value:r}=yield e.read();return t?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:r.content})}catch{return{done:!0,value:void 0}}}),return(){return Z(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return Z(this,void 0,void 0,function*(){var e,t,r,i;let s=new Set;try{for(var o=!0,a=xl(this),c;c=yield a.next(),e=c.done,!e;o=!0){i=c.value,o=!1;const l=i;s.add(l)}}catch(l){t={error:l}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(t)throw t.error}}return Array.from(s)})}}class Pue extends fV{constructor(e,t,r){super(e,t,r),this.receivedChunks=new Map}handleChunkReceived(e){var t;const r=D_(e.chunkIndex),i=this.receivedChunks.get(r);if(i&&i.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder;return{next:()=>Z(this,void 0,void 0,function*(){try{const{done:r,value:i}=yield e.read();return r?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:t.decode(i.content)})}catch{return{done:!0,value:void 0}}}),return(){return Z(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return Z(this,void 0,void 0,function*(){var e,t,r,i;let s="";try{for(var o=!0,a=xl(this),c;c=yield a.next(),e=c.done,!e;o=!0)i=c.value,o=!1,s+=i}catch(l){t={error:l}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(t)throw t.error}}return s})}}class Lue{constructor(e,t,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return Z(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class Aue extends Lue{}class QP extends pe{constructor(e,t,r,i,s){super(e,r,s),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Pe.Muted:Pe.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Pe.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return Z(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),ZP)),Yle()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:s}=r;s&&this.rtpTimestamp!==s&&(this.emit(Pe.TimeSyncUpdate,{timestamp:i,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class pV extends QP{constructor(e,t,r,i,s,o){super(e,t,pe.Kind.Audio,r,o),this.monitorReceiver=()=>Z(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Tw(a,this.prevStats)),this.prevStats=a}),this.audioContext=i,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var t;for(const r of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):r.volume=e;xa()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(xa())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return Z(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Lk(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Lk(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Pe.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(Pe.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Z(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(r=>{r.type==="inbound-rtp"&&(t={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),t})}}const hI=100;class Mue extends QP{constructor(e,t,r,i,s){super(e,t,pe.Kind.Video,r,s),this.elementInfos=[],this.monitorReceiver=()=>Z(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Tw(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=YP(()=>{this.updateDimensions()},hI),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?If(this._mediaStreamTrack,t):uf(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new Oue(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(r=>r===e);for(const r of t)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const r of t)this.stopObservingElement(r);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return Z(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,r="",i=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(r=s.codecId,t={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&i.set(s.id,s)}),t&&r!==""&&i.get(r)&&(t.mimeType=i.get(r).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(r=>r.element===e);for(const r of t)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Z(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const r=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),i=!((t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&t!==void 0)||t?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!i||s;if(this.lastVisible!==o){if(!o&&Date.now()-r<hI){Yr.setTimeout(()=>{this.updateVisibility()},hI);return}this.lastVisible=o,this.emit(Pe.VisibilityChanged,o,this)}}updateDimensions(){var e,t;let r=0,i=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>r+i&&(r=a,i=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===i||(this.lastDimensions={width:r,height:i},this.emit(Pe.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?TN():t||(TN()>2?2:1)}}class Oue{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=r=>{var i;const{target:s,isIntersecting:o}=r;s===this.element&&(this.isIntersecting=o,this.isPiP=Vm(this.element),this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r,i,s;(i=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Vm(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=Vm(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=t??jk(e),this.isPiP=zi()&&Vm(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,r;this.isIntersecting=jk(this.element),this.isPiP=Vm(this.element),this.element.handleResize=()=>{var i;(i=this.handleResize)===null||i===void 0||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,RN().observe(this.element),IN().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,r,i,s;(e=RN())===null||e===void 0||e.unobserve(this.element),(t=IN())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Vm(n){var e,t;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?jk(n,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function jk(n,e){const t=e||window;let r=n.offsetTop,i=n.offsetLeft;const s=n.offsetWidth,o=n.offsetHeight,{hidden:a}=n,{display:c}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,r+=n.offsetTop,i+=n.offsetLeft;return r<t.pageYOffset+t.innerHeight&&i<t.pageXOffset+t.innerWidth&&r+o>t.pageYOffset&&i+s>t.pageXOffset&&!a&&c!=="none"}class Cl extends Da.EventEmitter{constructor(e,t,r,i){var s;super(),this.metadataMuted=!1,this.encryption=bs.NONE,this.log=wt,this.handleMuted=()=>{this.emit(Pe.Muted)},this.handleUnmuted=()=>{this.emit(Pe.Unmuted)},this.log=Lc((s=i==null?void 0:i.loggerName)!==null&&s!==void 0?s:Go.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=r,this.source=pe.Source.Unknown}setTrack(e){this.track&&(this.track.off(Pe.Muted,this.handleMuted),this.track.off(Pe.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Pe.Muted,this.handleMuted),e.on(Pe.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Yt(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==bs.NONE}get audioTrack(){if(Ac(this.track))return this.track}get videoTrack(){if(vp(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=pe.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===pe.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(n.PermissionStatus||(n.PermissionStatus={}))})(Cl);class $k extends Cl{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,r,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Pe.Ended)},this.updateInfo(t),this.setTrack(r)}setTrack(e){this.track&&this.track.off(Pe.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Pe.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return Z(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return Z(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return Z(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return Z(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Ac(this.track)){const t=this.track.getSourceTrackSettings(),r=new Set;return t.autoGainControl&&r.add(va.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&r.add(va.TF_ECHO_CANCELLATION),t.noiseSuppression&&r.add(va.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&r.add(va.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(va.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(va.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}var Pl;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(Pl||(Pl={}));function Nue(n){switch(n){case vg.EXCELLENT:return Pl.Excellent;case vg.GOOD:return Pl.Good;case vg.POOR:return Pl.Poor;case vg.LOST:return Pl.Lost;default:return Pl.Unknown}}class mV extends Da.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Hb.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,r,i,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Hb.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Pl.Unknown,this.log=wt,this.log=Lc((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Go.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(pe.Source.Camera);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(pe.Source.Microphone);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(pe.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,r=this.metadata;this.metadata=e,t&&this.emit(ue.ParticipantMetadataChanged,r)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ue.ParticipantNameChanged,e)}_setAttributes(e){const t=Xle(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ue.AttributesChanged,t)}setPermissions(e){var t,r,i,s,o,a;const c=this.permissions,l=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,h)=>{var p;return u!==((p=this.permissions)===null||p===void 0?void 0:p.canPublishSources[h])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(ue.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ue.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=Nue(e),t!==this._connectionQuality&&this.emit(ue.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>Ac(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Pe.Muted,()=>{this.emit(ue.TrackMuted,e)}),e.on(Pe.Unmuted,()=>{this.emit(ue.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case pe.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case pe.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function Due(n){var e,t,r;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new dH({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(r=n.allowAll)!==null&&r!==void 0?r:!1,trackSids:n.allowedTrackSids||[]})}const h1=15e3;class Fue extends mV{constructor(e,t,r,i,s){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=bs.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new rV)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(c=>this.log.warn(c.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:c,message:l}=o,u=this.pendingSignalRequests.get(a);u&&(c!==VP.OK&&u.reject(new SN(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=Un.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>Due(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Yt(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Yt(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Yt(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.handleSubscribedQualityUpdate=o=>Z(this,void 0,void 0,function*(){var a,c,l,u,h,p;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const m=this.videoTrackPublications.get(o.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(o.subscribedCodecs.length>0){if(!m.videoTrack)return;const b=yield m.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var v=!0,g=xl(b),S;S=yield g.next(),a=S.done,!a;v=!0){u=S.value,v=!1;const R=u;xle(R)&&(this.log.debug("publish ".concat(R," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Yt(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,R,m.options))}}catch(R){c={error:R}}finally{try{!v&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(c)throw c.error}}}else o.subscribedQualities.length>0&&(yield(p=m.videoTrack)===null||p===void 0?void 0:p.setPublishingLayers(o.subscribedQualities))}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>Z(this,void 0,void 0,function*(){if(o.source===pe.Source.ScreenShare||o.source===pe.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Yt(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(Ju(o)||pl(o))try{if(zi())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===pe.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),Yt(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Yt(o))),Ju(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Yt(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==bs.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(Oe.RemoteMute,(t,r)=>{const i=this.trackPublications.get(t);!i||!i.track||(r?i.mute():i.unmute())}),this.engine.on(Oe.Connected,this.handleReconnected).on(Oe.SignalRestarted,this.handleReconnected).on(Oe.SignalResumed,this.handleReconnected).on(Oe.Restarting,this.handleReconnecting).on(Oe.Resuming,this.handleReconnecting).on(Oe.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Oe.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Oe.Disconnected,this.handleDisconnected).on(Oe.SignalRequestResponse,this.handleSignalRequestResponse).on(Oe.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return Z(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return Z(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return Z(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return Z(this,arguments,void 0,function(t){var r=this;let{metadata:i,name:s,attributes:o}=t;return function*(){return new Promise((a,c)=>Z(r,void 0,void 0,function*(){var l,u;try{let h=!1;const p=yield this.engine.client.sendUpdateLocalMetadata((l=i??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),m=performance.now();for(this.pendingSignalRequests.set(p,{resolve:a,reject:v=>{c(v),h=!0},values:{name:s,metadata:i,attributes:o}});performance.now()-m<5e3&&!h;){if((!s||this.name===s)&&(!i||this.metadata===i)&&(!o||Object.entries(o).every(v=>{let[g,S]=v;return this.attributes[g]===S||S===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(p),a();return}yield Zi(50)}c(new SN("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error&&c(h)}}))}()})}setCameraEnabled(e,t,r){return this.setTrackEnabled(pe.Source.Camera,e,t,r)}setMicrophoneEnabled(e,t,r){return this.setTrackEnabled(pe.Source.Microphone,e,t,r)}setScreenShareEnabled(e,t,r){return this.setTrackEnabled(pe.Source.ScreenShare,e,t,r)}setPermissions(e){const t=this.permissions,r=super.setPermissions(e);return r&&t&&this.emit(ue.ParticipantPermissionsChanged,t),r}setE2EEEnabled(e){return Z(this,void 0,void 0,function*(){this.encryptionType=e?bs.GCM:bs.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,r,i){return Z(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(t)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case pe.Source.Camera:c=yield this.createTracks({video:(s=r)!==null&&s!==void 0?s:!0});break;case pe.Source.Microphone:c=yield this.createTracks({audio:(o=r)!==null&&o!==void 0?o:!0});break;case pe.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},r));break;default:throw new fc(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(ue.MediaDevicesError,l),this.pendingPublishing.delete(e),l}try{const l=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Yt(h))),l.push(this.publishTrack(h,i));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===pe.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(pe.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return Z(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(pe.Source.Camera)||this.pendingPublishing.has(pe.Source.Microphone))){this.pendingPublishing.add(pe.Source.Camera),this.pendingPublishing.add(pe.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(pe.Source.Camera),this.pendingPublishing.delete(pe.Source.Microphone)}}})}createTracks(e){return Z(this,void 0,void 0,function*(){var t,r;e??(e={});const i=iV(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults),{audioProcessor:s,videoProcessor:o,optionsWithoutProcessor:a}=KP(i),c=Cw(a);let l;try{l=yield navigator.mediaDevices.getUserMedia(c)}catch(u){throw u instanceof Error&&(c.audio&&(this.microphoneError=u),c.video&&(this.cameraError=u)),u}return c.audio&&(this.microphoneError=void 0,this.emit(ue.AudioStreamAcquired)),c.video&&(this.cameraError=void 0),Promise.all(l.getTracks().map(u=>Z(this,void 0,void 0,function*(){const h=u.kind==="audio";let p;const m=h?c.audio:c.video;typeof m!="boolean"&&(p=m);const v=uV(u,p,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return v.kind===pe.Kind.Video?v.source=pe.Source.Camera:v.kind===pe.Kind.Audio&&(v.source=pe.Source.Microphone,v.setAudioContext(this.audioContext)),v.mediaStream=l,Ac(v)&&s?yield v.setProcessor(s):vp(v)&&o&&(yield v.setProcessor(o)),v})))})}createScreenTracks(e){return Z(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new qP("getDisplayMedia not supported");e.resolution===void 0&&!Nle()&&(e.resolution=Ew.h1080fps30.resolution);const t=Wle(e),r=yield navigator.mediaDevices.getDisplayMedia(t),i=r.getVideoTracks();if(i.length===0)throw new fc("no video track found");const s=new yv(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=pe.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(r.getAudioTracks().length>0){this.emit(ue.AudioStreamAcquired);const a=new Kb(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=pe.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,t){return Z(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return Z(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;Ju(r)&&r.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),fd(r)&&s.pendingPublishPromises.has(r)&&(yield s.pendingPublishPromises.get(r));let h;if(r instanceof MediaStreamTrack)h=r.getConstraints();else{h=r.constraints;let b;switch(r.source){case pe.Source.Microphone:b="audioinput";break;case pe.Source.Camera:b="videoinput"}b&&s.activeDeviceMap.has(b)&&(h=Object.assign(Object.assign({},h),{deviceId:s.activeDeviceMap.get(b)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new Kb(r,h,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":r=new yv(r,h,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new fc("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let p;if(s.trackPublications.forEach(b=>{b.track&&b.track===r&&(p=b)}),p)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Yt(p))),p;const m="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,v=(c=i==null?void 0:i.forceStereo)!==null&&c!==void 0?c:m;v&&(i||(i={}),i.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Yt(r))),i.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=i.dtx)!==null&&l!==void 0||(i.dtx=!1),(u=i.red)!==null&&u!==void 0||(i.red=!1));const g=Object.assign(Object.assign({},s.roomOptions.publishDefaults),i);!Dle()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),g.simulcast=!1),g.source&&(r.source=g.source);const S=s.publish(r,g,v);s.pendingPublishPromises.set(r,S);try{return yield S}catch(b){throw b}finally{s.pendingPublishPromises.delete(r)}}()})}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Yt(e))),!1;const{canPublish:t,canPublishSources:r}=this.permissions;return t&&(r.length===0||r.map(i=>Jle(i)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Yt(e))),!1)}publish(e,t,r){return Z(this,void 0,void 0,function*(){var i,s,o,a,c,l,u,h,p,m;if(!this.hasPermissionsToPublish(e))throw new _le("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(T=>fd(e)&&T.source===e.source)&&e.source!==pe.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Yt(e))),t.stopMicTrackOnMute&&Ac(e)&&(e.stopOnMute=!0),e.source===pe.Source.ScreenShare&&Wf()&&(t.simulcast=!1),t.videoCodec==="av1"&&!Ale()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!Mle()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=Nk),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(T=>t.videoCodec===F_(T.mime))||(t.videoCodec=F_(this.enabledPublishVideoCodecs[0].mime)));const g=t.videoCodec;e.on(Pe.Muted,this.onTrackMuted),e.on(Pe.Unmuted,this.onTrackUnmuted),e.on(Pe.Ended,this.handleTrackEnded),e.on(Pe.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Pe.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Pe.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const S=new _k({cid:e.mediaStreamTrack.id,name:t.name,type:pe.kindToProto(e.kind),muted:e.isMuted,source:pe.sourceToProto(e.source),disableDtx:!(!((i=t.dtx)!==null&&i!==void 0)||i),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((s=t.red)!==null&&s!==void 0)||s),stream:t==null?void 0:t.stream,backupCodecPolicy:t==null?void 0:t.backupCodecPolicy});let b;if(e.kind===pe.Kind.Video){let T={width:0,height:0};try{T=yield e.waitForDimensions()}catch{const P=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Ea.h720.resolution;T={width:P.width,height:P.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Yt(e)),{dims:T}))}S.width=T.width,S.height=T.height,pl(e)&&(Ag(g)&&(e.source===pe.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Yt(e))))),t.scalabilityMode=(c=t.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new yk({codec:g,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:Nk}),t.backupCodec&&g!==t.backupCodec.codec&&S.encryption===bs.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new yk({codec:t.backupCodec.codec,cid:""})))),b=Fk(e.source===pe.Source.ScreenShare,S.width,S.height,t),S.layers=GN(S.width,S.height,b,Ag(t.videoCodec))}else e.kind===pe.Kind.Audio&&(b=[{maxBitrate:(l=t.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(h=(u=t.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&h!==void 0?h:"high",networkPriority:(m=(p=t.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new dr("cannot publish track when not connected");const R=()=>Z(this,void 0,void 0,function*(){var T,C,P;if(!this.engine.pcManager)throw new dr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,b),pl(e)&&((T=t.degradationPreference)!==null&&T!==void 0||(t.degradationPreference=wue(e)),e.setDegradationPreference(t.degradationPreference)),b)if(Wf()&&e.kind===pe.Kind.Audio){let M;for(const D of this.engine.pcManager.publisher.getTransceivers())if(D.sender===e.sender){M=D;break}M&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:M,codec:"opus",maxbr:!((C=b[0])===null||C===void 0)&&C.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&Ag(e.codec)&&(!((P=b[0])===null||P===void 0)&&P.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;if(this.enabledPublishVideoCodecs.length>0)k=(yield Promise.all([this.engine.addTrack(S),R()]))[0];else{k=yield this.engine.addTrack(S);let T;if(k.codecs.forEach(C=>{T===void 0&&(T=C.mimeType)}),T&&e.kind===pe.Kind.Video){const C=F_(T);C!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Yt(e)),{codec:C})),t.videoCodec=C,b=Fk(e.source===pe.Source.ScreenShare,S.width,S.height,t))}yield R()}const I=new $k(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return I.options=t,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),pl(e)?e.startMonitor(this.engine.client):Ju(e)&&e.startMonitor(),this.addTrackPublication(I),this.emit(ue.LocalTrackPublished,I),I})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,r){return Z(this,void 0,void 0,function*(){var i;if(this.encryptionType!==bs.NONE)return;let s;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(s=m)}),!s)throw new fc("track is not published");if(!pl(e))throw new fc("track is not a video track");const o=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),a=_ue(e,t,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Yt(e)));return}const c=e.addSimulcastTrack(t,a);if(!c)return;const l=new _k({cid:c.mediaStreamTrack.id,type:pe.kindToProto(e.kind),muted:e.isMuted,source:pe.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=GN(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new dr("cannot publish track when not connected");const u=()=>Z(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),p=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:p}))})}unpublishTrack(e,t){return Z(this,void 0,void 0,function*(){var r,i;if(fd(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Yt(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?Yt(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(Pe.Muted,this.onTrackMuted),e.off(Pe.Unmuted,this.onTrackUnmuted),e.off(Pe.Ended,this.handleTrackEnded),e.off(Pe.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Pe.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Pe.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),t?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Dn.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),pl(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case pe.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(ue.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return Z(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return Z(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((s,o)=>Z(r,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(t&&(c.options=Object.assign(Object.assign({},c.options),t)),a.push(c))}),yield Promise.all(a.map(c=>Z(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),i&&!l.isMuted&&l.source!==pe.Source.ScreenShare&&l.source!==pe.Source.ScreenShareAudio&&(Ju(l)||pl(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield r.republishPromise}()})}publishData(e){return Z(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=i.reliable?Nt.RELIABLE:Nt.LOSSY,o=i.destinationIdentities,a=i.topic,c=new $i({kind:s,value:{case:"user",value:new WB({participantIdentity:r.identity,payload:t,destinationIdentities:o,topic:a})}});yield r.engine.sendDataPacket(c,s)}()})}publishDtmf(e,t){return Z(this,void 0,void 0,function*(){const r=new $i({kind:Nt.RELIABLE,value:{case:"sipDtmf",value:new zB({code:e,digit:t})}});yield this.engine.sendDataPacket(r,Nt.RELIABLE)})}sendChatMessage(e,t){return Z(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t==null?void 0:t.attachments},i=new $i({value:{case:"chatMessage",value:new hk(Object.assign(Object.assign({},r),{timestamp:Tn.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(i,Nt.RELIABLE),this.emit(ue.ChatMessage,r),r})}editChatMessage(e,t){return Z(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new $i({value:{case:"chatMessage",value:new hk(Object.assign(Object.assign({},r),{timestamp:Tn.parse(r.timestamp),editTimestamp:Tn.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,Nt.RELIABLE),this.emit(ue.ChatMessage,r),r})}sendText(e,t){return Z(this,void 0,void 0,function*(){var r;const i=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(r=t==null?void 0:t.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(h,p)=>{var m;c[p]=h;const v=c.reduce((g,S)=>g+S,0);(m=t==null?void 0:t.onProgress)===null||m===void 0||m.call(t,v)},u=yield this.streamText({streamId:i,totalSize:o,destinationIdentities:t==null?void 0:t.destinationIdentities,topic:t==null?void 0:t.topic,attachedStreamIds:a});return yield u.write(e),l(1,0),yield u.close(),t!=null&&t.attachments&&a&&(yield Promise.all(t.attachments.map((h,p)=>Z(this,void 0,void 0,function*(){return this._sendFile(a[p],h,{topic:t.topic,mimeType:h.type,onProgress:m=>{l(m,p+1)}})})))),u.info})}streamText(e){return Z(this,void 0,void 0,function*(){var t,r;const i=(t=e==null?void 0:e.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),s={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",size:e==null?void 0:e.totalSize},o=new pk({streamId:i,mimeType:s.mimeType,topic:s.topic,timestamp:Xu(s.timestamp),totalLength:Xu(e==null?void 0:e.totalSize),contentHeader:{case:"textHeader",value:new iH({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?fk.UPDATE:fk.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new $i({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,Nt.RELIABLE);let l=0;const u=this,h=new WritableStream({write(v){return Z(this,void 0,void 0,function*(){for(const g of Kle(v,h1)){yield u.engine.waitForBufferStatusLow(Nt.RELIABLE);const S=new mk({content:g,streamId:i,chunkIndex:Xu(l)}),b=new $i({destinationIdentities:a,value:{case:"streamChunk",value:S}});yield u.engine.sendDataPacket(b,Nt.RELIABLE),l+=1}})},close(){return Z(this,void 0,void 0,function*(){const v=new gk({streamId:i}),g=new $i({destinationIdentities:a,value:{case:"streamTrailer",value:v}});yield u.engine.sendDataPacket(g,Nt.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let p=()=>Z(this,void 0,void 0,function*(){yield m.close()});u.engine.once(Oe.Closing,p);const m=new Aue(h,s,()=>this.engine.off(Oe.Closing,p));return m})}sendFile(e,t){return Z(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,t),{id:r}})}_sendFile(e,t,r){return Z(this,void 0,void 0,function*(){var i,s;const o=t.size,a=new pk({totalLength:Xu(o),mimeType:(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:t.type,streamId:e,topic:r==null?void 0:r.topic,encryptionType:r==null?void 0:r.encryptionType,timestamp:Xu(Date.now()),contentHeader:{case:"byteHeader",value:new sH({name:t.name})}}),c=r==null?void 0:r.destinationIdentities,l=new $i({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,Nt.RELIABLE);function u(v){return new Promise(g=>{const S=new FileReader;S.onload=()=>{g(new Uint8Array(S.result))},S.readAsArrayBuffer(v)})}const h=Math.ceil(o/h1);for(let v=0;v<h;v++){const g=yield u(t.slice(v*h1,Math.min((v+1)*h1,o)));yield this.engine.waitForBufferStatusLow(Nt.RELIABLE);const S=new mk({content:g,streamId:e,chunkIndex:Xu(v)}),b=new $i({destinationIdentities:c,value:{case:"streamChunk",value:S}});yield this.engine.sendDataPacket(b,Nt.RELIABLE),(s=r==null?void 0:r.onProgress)===null||s===void 0||s.call(r,(v+1)/h)}const p=new gk({streamId:e}),m=new $i({destinationIdentities:c,value:{case:"streamTrailer",value:p}});yield this.engine.sendDataPacket(m,Nt.RELIABLE)})}performRpc(e){return Z(this,arguments,void 0,function(t){var r=this;let{destinationIdentity:i,method:s,payload:o,responseTimeout:a=1e4}=t;return function*(){return new Promise((l,u)=>Z(r,void 0,void 0,function*(){var h,p,m,v;if(JP(o)>lV){u(Un.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((p=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||p===void 0)&&p.version&&zf((v=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){u(Un.builtIn("UNSUPPORTED_SERVER"));return}const g=crypto.randomUUID();yield this.publishRpcRequest(i,g,s,o,a-2e3);const S=setTimeout(()=>{this.pendingAcks.delete(g),u(Un.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(b)},2e3);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(S)},participantIdentity:i});const b=setTimeout(()=>{this.pendingResponses.delete(g),u(Un.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(g,{resolve:(R,k)=>{clearTimeout(b),this.pendingAcks.has(g)&&(console.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(S)),k?u(k):l(R??"")},participantIdentity:i})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,r){const i=this.pendingResponses.get(e);i?(i.resolve(t,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,r,i,s){return Z(this,void 0,void 0,function*(){const o=new $i({destinationIdentities:[e],kind:Nt.RELIABLE,value:{case:"rpcRequest",value:new YB({id:t,method:r,payload:i,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,Nt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:r,resolve:i}]of this.pendingResponses)r===e&&(i(null,Un.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(t=>{var r,i;const s=this.trackPublications.get(t.sid);if(s){const o=s.isMuted||((i=(r=s.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);o!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Yt(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(t.sid,o))}}),!0)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(Ju(i)||pl(i))&&i.mediaStreamTrack===e&&(t=r):e===i&&(t=r))}),t}waitForPendingPublicationOfSource(e){return Z(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const i=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(i)return i[1];yield Zi(20)}})}}class Wb extends Cl{constructor(e,t,r,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Ks.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(Pe.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new Sw({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new QB({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Pe.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Cl.SubscriptionStatus.Unsubscribed:super.isSubscribed?Cl.SubscriptionStatus.Subscribed:Cl.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Cl.PermissionStatus.Allowed:Cl.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,r;this.isManualOperationAllowed()&&(((t=this.videoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(sI(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&sI(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Pe.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Pe.VisibilityChanged,this.handleVisibilityChange),i.off(Pe.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Pe.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Pe.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Pe.VisibilityChanged,this.handleVisibilityChange),e.on(Pe.Ended,this.handleEnded),this.emit(Pe.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Pe.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Pe.Muted:Pe.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Pe.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Pe.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===pe.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return sI(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new oH({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=Ks.HIGH,this.emit(Pe.UpdateSettings,e)}}class zb extends mV{static fromParticipantInfo(e,t,r){return new zb(e,t.sid,t.identity,t.name,t.metadata,t.attributes,r,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,r,i,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Hb.STANDARD;super(t,r||"",i,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Pe.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Yt(e))),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Pe.UpdateSubscription,t=>{t.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(Pe.SubscriptionPermissionChanged,t=>{this.emit(ue.TrackSubscriptionPermissionChanged,e,t)}),e.on(Pe.SubscriptionStatusChanged,t=>{this.emit(ue.TrackSubscriptionStatusChanged,e,t)}),e.on(Pe.Subscribed,t=>{this.emit(ue.TrackSubscribed,t,e)}),e.on(Pe.Unsubscribed,t=>{this.emit(ue.TrackUnsubscribed,t,e)}),e.on(Pe.SubscriptionFailed,t=>{this.emit(ue.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe.Source.Microphone;this.volumeMap.set(t,e);const r=this.getTrackPublication(t);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,r,i,s,o){let a=this.getTrackPublicationBySid(t);if(a||t.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(ue.TrackSubscriptionFailed,t);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,r,i,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Yt(a))),this.emit(ue.TrackSubscriptionFailed,t);return}const c=e.kind==="video";let l;return c?l=new Mue(e,t,i,s):l=new pV(e,t,i,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(r),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&Mk(l)&&Ac(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,r=new Map;return e.tracks.forEach(i=>{var s,o;let a=this.getTrackPublicationBySid(i.sid);if(a)a.updateInfo(i);else{const c=pe.kindFromProto(i.type);if(!c)return;a=new Wb(c,i,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(i),r.set(i.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==pe.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Yt(l),newTrack:Yt(a)})),this.addTrackPublication(a)}t.set(i.sid,a)}),this.trackPublications.forEach(i=>{t.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Yt(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(ue.TrackPublished,i)}),!0}unpublishTrack(e,t){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(e);break;case pe.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(ue.TrackUnpublished,r)}setAudioOutput(e){return Z(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(r=>{var i;Ac(r.track)&&Mk(r.track)&&t.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Ct;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(Ct||(Ct={}));const Uue=4*1e3;class Mc extends Da.EventEmitter{constructor(e){var t,r,i,s;if(super(),t=this,this.state=Ct.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=wt,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,c)=>Z(this,void 0,void 0,function*(){var l;if(!Ole())throw xa()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Ct.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Ct.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ak(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Uk(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(m=>{var v;(v=this.regionUrlProvider)===null||v===void 0||v.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const h=(m,v,g)=>Z(this,void 0,void 0,function*(){var S,b;this.abortController&&this.abortController.abort();const R=new AbortController;this.abortController=R,u==null||u();try{yield this.attemptConnection(g??o,a,c,R),this.abortController=void 0,m()}catch(k){if(this.regionUrlProvider&&k instanceof rn&&k.reason!==xt.Cancelled&&k.reason!==xt.NotAllowed){let I=null;try{I=yield this.regionUrlProvider.getNextBestRegionUrl((S=this.abortController)===null||S===void 0?void 0:S.signal)}catch(T){if(T instanceof rn&&(T.status===401||T.reason===xt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),v(T);return}}I&&!(!((b=this.abortController)===null||b===void 0)&&b.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(I),this.logContext),this.recreateEngine(),yield h(m,v,I)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,PN(k)),v(k))}else{let I=Uo.UNKNOWN_REASON;k instanceof rn&&(I=PN(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,I),v(k)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new rV((m,v)=>{h(m,v,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,h)=>Z(this,void 0,void 0,function*(){var p,m,v;const g=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},h.signal);let S=g.serverInfo;if(S||(S={version:g.serverVersion,region:g.serverRegion}),this.serverInfo=S,this.log.debug("connected to Livekit Server ".concat(Object.entries(S).map(b=>{let[R,k]=b;return"".concat(R,": ").concat(k)}).join(", ")),{room:(p=g.room)===null||p===void 0?void 0:p.name,roomSid:(m=g.room)===null||m===void 0?void 0:m.sid,identity:(v=g.participant)===null||v===void 0?void 0:v.identity}),!S.version)throw new yle("unknown server version");return S.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),g}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>Z(this,void 0,void 0,function*(){var u,h;this.state===Ct.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},XP),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(he.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const m=new rn("could not establish signal connection",xt.ServerUnreachable);throw p instanceof Error&&(m.message="".concat(m.message,": ").concat(p.message)),p instanceof rn&&(m.reason=p.reason,m.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),m}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new rn("Connection attempt aborted",xt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}zi()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),zi()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ct.Connected),this.emit(he.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return Z(t,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var h,p,m,v;const g=yield l.disconnectLock.lock();try{if(l.state===Ct.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===Ct.Connecting||l.state===Ct.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(h=l.abortController)===null||h===void 0||h.abort(),(m=(p=l.connectFuture)===null||p===void 0?void 0:p.reject)===null||m===void 0||m.call(p,new rn("Client initiated disconnect",xt.Cancelled)),l.connectFuture=void 0),!((v=l.engine)===null||v===void 0)&&v.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Uo.CLIENT_INITIATED),l.engine=void 0}finally{g()}}()})},this.onPageLeave=()=>Z(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>Z(this,void 0,void 0,function*(){const o=[],a=ka();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=iI();u.enabled=!0;const h=new MediaStream([u]);l.srcObject=h,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(he.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>Z(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Ct.Reconnecting)&&this.emit(he.Reconnecting)},this.handleSignalRestarted=o=>Z(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ct.Connected),this.emit(he.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===dk.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(he.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(he.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=pe.streamStateFromProto(a.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(ue.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(he.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(he.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(ue.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(he.SipDTMFReceived,a,o),o==null||o.emit(ue.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=Hle(a,this.transcriptionReceivedTimes);l==null||l.emit(Pe.TranscriptionReceived,u),c==null||c.emit(ue.TranscriptionReceived,u,l),this.emit(he.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=Vle(a);this.emit(he.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(he.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(he.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(he.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(he.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(he.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Z(this,void 0,void 0,function*(){var o,a;const c=Pr.getInstance().previousDevices,l=yield Pr.getInstance().getDevices(void 0,!1),u=ka();if((u==null?void 0:u.name)==="Chrome"&&u.os!=="iOS")for(let p of l){const m=c.find(v=>v.deviceId===p.deviceId);m&&m.label!==""&&m.kind===p.kind&&m.label!==p.label&&this.getActiveDevice(p.kind)==="default"&&this.emit(he.ActiveDeviceChanged,p.kind,p.deviceId)}const h=["audiooutput","audioinput","videoinput"];for(let p of h){const m=l.filter(g=>g.kind===p),v=this.getActiveDevice(p);if(v===((o=c.filter(g=>g.kind===p)[0])===null||o===void 0?void 0:o.deviceId)&&m.length>0&&((a=m[0])===null||a===void 0?void 0:a.deviceId)!==v){yield this.switchActiveDevice(p,m[0].deviceId);continue}p==="audioinput"&&!eu()||p==="videoinput"||m.length>0&&!m.find(g=>g.deviceId===this.getActiveDevice(p))&&(yield this.switchActiveDevice(p,m[0].deviceId))}this.emit(he.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(he.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(he.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(he.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(he.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(he.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(he.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(he.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>Z(this,void 0,void 0,function*(){var a,c,l,u,h,p;(a=o.track)===null||a===void 0||a.on(Pe.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(Pe.Restarted,this.onLocalTrackRestarted),(h=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||h===void 0||h.call(u,this),this.emit(he.LocalTrackPublished,o,this.localParticipant),Ju(o.track)&&(yield o.track.checkForSilence())&&this.emit(he.LocalAudioSilenceDetected,o);const m=yield(p=o.track)===null||p===void 0?void 0:p.getDeviceId(!1),v=LN(o.source);v&&m&&m!==this.localParticipant.activeDeviceMap.get(v)&&(this.localParticipant.activeDeviceMap.set(v,m),this.emit(he.ActiveDeviceChanged,v,m))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(Pe.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(Pe.Restarted,this.onLocalTrackRestarted),this.emit(he.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>Z(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=LN(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(he.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(he.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=o=>{this.emit(he.MediaDevicesError,o)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(he.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(he.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},uue),e),this.log=Lc((r=this.options.loggerName)!==null&&r!==void 0?r:Go.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},aV),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},cV),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},lue),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Wi,this.localParticipant=new Fue("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Vl(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Vl(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",Vl(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),zi()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Mc.cleanupRegistry&&Mc.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,t,r,i,s,o){return Z(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),o!==1){yield this.engine.publishRpcResponse(e,t,null,Un.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(r);if(!a){yield this.engine.publishRpcResponse(e,t,null,Un.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:s});JP(u)>lV?(c=Un.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):l=u}catch(u){u instanceof Un?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),u),c=Un.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,l,c)})}setE2EEEnabled(e){return Z(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new Zle(this.options.e2ee),this.e2eeManager.on(Ol.ParticipantEncryptionStatusChanged,(t,r)=>{qle(r)&&(this.isE2EEEnabled=t),this.emit(he.ParticipantEncryptionStatusChanged,t,r)}),this.e2eeManager.on(Ol.EncryptionError,t=>this.emit(he.EncryptionError,t)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return Z(this,void 0,void 0,function*(){return this.state===Ct.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,t)=>{const r=i=>{i.sid!==""&&(this.engine.off(Oe.RoomUpdate,r),e(i.sid))};this.engine.on(Oe.RoomUpdate,r),this.once(he.Disconnected,()=>{this.engine.off(Oe.RoomUpdate,r),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Tue(this.options),this.engine.on(Oe.ParticipantUpdate,this.handleParticipantUpdates).on(Oe.RoomUpdate,this.handleRoomUpdate).on(Oe.SpeakersChanged,this.handleSpeakersChanged).on(Oe.StreamStateChanged,this.handleStreamStateUpdate).on(Oe.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Oe.SubscriptionError,this.handleSubscriptionError).on(Oe.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Oe.MediaTrackAdded,(e,t,r)=>{this.onTrackAdded(e,t,r)}).on(Oe.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Oe.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Oe.DataPacketReceived,this.handleDataPacket).on(Oe.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ct.SignalReconnecting)&&this.emit(he.SignalReconnecting)}).on(Oe.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ct.Connected)&&this.emit(he.Reconnected)}).on(Oe.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ct.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Oe.Restarting,this.handleRestarting).on(Oe.SignalRestarted,this.handleSignalRestarted).on(Oe.Offline,()=>{this.setAndEmitConnectionState(Ct.Reconnecting)&&this.emit(he.Reconnecting)}).on(Oe.DCBufferStatusChanged,(e,t)=>{this.emit(he.DCBufferStatusChanged,e,t)}).on(Oe.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ue.LocalTrackSubscribed,t),this.emitWhenConnected(he.LocalTrackSubscribed,t,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Pr.getInstance().getDevices(e,t)}prepareConnection(e,t){return Z(this,void 0,void 0,function*(){if(this.state===Ct.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ak(new URL(e))&&t){this.regionUrlProvider=new Uk(e,t);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Ct.Disconnected&&(this.regionUrl=r,yield fetch(xN(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(xN(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Z(this,void 0,void 0,function*(){let r=()=>{},i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new ca({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new ca({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new ca({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new ca({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>Z(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new ca({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>Z(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new ca({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new ca({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>Z(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new ww({reason:Uo.CLIENT_INITIATED,action:Cf.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new ca({scenario:{case:"subscriberBandwidth",value:Xu(t)}});break;case"leave-full-reconnect":i=new ca({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return Z(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u,h,p,m,v;let g=!0,S=!1;const b=o?{exact:i}:i;if(r==="audioinput"){S=s.localParticipant.audioTrackPublications.size===0;const R=(a=s.getActiveDevice(r))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=b;const k=Array.from(s.localParticipant.audioTrackPublications.values()).filter(I=>I.source===pe.Source.Microphone);try{g=(yield Promise.all(k.map(I=>{var T;return(T=I.audioTrack)===null||T===void 0?void 0:T.setDeviceId(b)}))).every(I=>I===!0)}catch(I){throw s.options.audioCaptureDefaults.deviceId=R,I}}else if(r==="videoinput"){S=s.localParticipant.videoTrackPublications.size===0;const R=(c=s.getActiveDevice(r))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=b;const k=Array.from(s.localParticipant.videoTrackPublications.values()).filter(I=>I.source===pe.Source.Camera);try{g=(yield Promise.all(k.map(I=>{var T;return(T=I.videoTrack)===null||T===void 0?void 0:T.setDeviceId(b)}))).every(I=>I===!0)}catch(I){throw s.options.videoCaptureDefaults.deviceId=R,I}}else if(r==="audiooutput"){if(!Lk()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(i=(l=yield Pr.getInstance().normalizeDeviceId("audiooutput",i))!==null&&l!==void 0?l:""),(u=(v=s.options).audioOutput)!==null&&u!==void 0||(v.audioOutput={});const R=(h=s.getActiveDevice(r))!==null&&h!==void 0?h:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=i;try{s.options.webAudioMix&&((p=s.audioContext)===null||p===void 0||p.setSinkId(i)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:i})))}catch(k){throw s.options.audioOutput.deviceId=R,k}}return(S||r==="audiooutput")&&(s.localParticipant.activeDeviceMap.set(r,r==="audiooutput"&&((m=s.options.audioOutput)===null||m===void 0?void 0:m.deviceId)||i),s.emit(he.ActiveDeviceChanged,r,i)),g}()})}setupLocalParticipantEvents(){this.localParticipant.on(ue.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ue.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ue.AttributesChanged,this.onLocalAttributesChanged).on(ue.TrackMuted,this.onLocalTrackMuted).on(ue.TrackUnmuted,this.onLocalTrackUnmuted).on(ue.LocalTrackPublished,this.onLocalTrackPublished).on(ue.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ue.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ue.MediaDevicesError,this.onMediaDevicesError).on(ue.AudioStreamAcquired,this.startAudio).on(ue.ChatMessage,this.onLocalChatMessageSent).on(ue.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,r){if(this.state===Ct.Connecting||this.state===Ct.Reconnecting){const u=()=>{this.onTrackAdded(e,t,r),h()},h=()=>{this.off(he.Reconnected,u),this.off(he.Connected,u),this.off(he.Disconnected,h)};this.once(he.Reconnected,u),this.once(he.Connected,u),this.once(he.Disconnected,h);return}if(this.state===Ct.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const i=Lle(t.id),s=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,t,r,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Ct.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{i.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var s,o,a;i.track&&this.localParticipant.unpublishTrack(i.track,e),e?((s=i.track)===null||s===void 0||s.detach(),(o=i.track)===null||o===void 0||o.stop()):(a=i.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(ue.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ue.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ue.AttributesChanged,this.onLocalAttributesChanged).off(ue.TrackMuted,this.onLocalTrackMuted).off(ue.TrackUnmuted,this.onLocalTrackUnmuted).off(ue.LocalTrackPublished,this.onLocalTrackPublished).off(ue.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ue.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ue.MediaDevicesError,this.onMediaDevicesError).off(ue.AudioStreamAcquired,this.startAudio).off(ue.ChatMessage,this.onLocalChatMessageSent).off(ue.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),zi()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ct.Disconnected),this.emit(he.Disconnected,t)}}}handleParticipantDisconnected(e,t){var r;this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach(i=>{t.unpublishTrack(i.trackSid,!0)}),this.emit(he.ParticipantDisconnected,t),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(t.identity))}handleStreamHeader(e,t){return Z(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const i=this.byteStreamHandlers.get(e.topic);if(!i){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:D_(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});i(new xue(o,a,D_(e.totalLength)),{identity:t})}else if(e.contentHeader.case==="textHeader"){const i=this.textStreamHandlers.get(e.topic);if(!i){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});i(new Pue(o,a,D_(e.totalLength)),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const r=this.textStreamControllers.get(e.streamId);r&&e.content.length>0&&r.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return Z(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=oV())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Zi(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const r=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(he.AudioPlaybackStatusChanged,r))})}createParticipant(e,t){var r;let i;return t?i=zb.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new zb(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return t&&i.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),i}const r=this.createParticipant(e,t);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(he.ParticipantConnected,r),r.on(ue.TrackPublished,i=>{this.emitWhenConnected(he.TrackPublished,i,r)}).on(ue.TrackSubscribed,(i,s)=>{i.kind===pe.Kind.Audio?(i.on(Pe.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(Pe.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===pe.Kind.Video&&(i.on(Pe.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(Pe.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(he.TrackSubscribed,i,s,r)}).on(ue.TrackUnpublished,i=>{this.emit(he.TrackUnpublished,i,r)}).on(ue.TrackUnsubscribed,(i,s)=>{this.emit(he.TrackUnsubscribed,i,s,r)}).on(ue.TrackMuted,i=>{this.emitWhenConnected(he.TrackMuted,i,r)}).on(ue.TrackUnmuted,i=>{this.emitWhenConnected(he.TrackUnmuted,i,r)}).on(ue.ParticipantMetadataChanged,i=>{this.emitWhenConnected(he.ParticipantMetadataChanged,i,r)}).on(ue.ParticipantNameChanged,i=>{this.emitWhenConnected(he.ParticipantNameChanged,i,r)}).on(ue.AttributesChanged,i=>{this.emitWhenConnected(he.ParticipantAttributesChanged,i,r)}).on(ue.ConnectionQualityChanged,i=>{this.emitWhenConnected(he.ConnectionQualityChanged,i,r)}).on(ue.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(he.ParticipantPermissionsChanged,i,r)}).on(ue.TrackSubscriptionStatusChanged,(i,s)=>{this.emitWhenConnected(he.TrackSubscriptionStatusChanged,i,s,r)}).on(ue.TrackSubscriptionFailed,(i,s)=>{this.emit(he.TrackSubscriptionFailed,i,r,s)}).on(ue.TrackSubscriptionPermissionChanged,(i,s)=>{this.emitWhenConnected(he.TrackSubscriptionPermissionChanged,i,s,r)}),t&&r.updateInfo(t),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&Gle(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Yr.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Uo.STATE_MISMATCH))):e=0},Uue)}clearConnectionReconcile(){this.connectionReconcileInterval&&Yr.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(he.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,r]=e;this.emit(t,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(this.state===Ct.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Ct.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return Z(this,void 0,void 0,function*(){var t,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new UP({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Tn.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new gv({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(he.SignalConnected),this.emit(he.Connected),this.setAndEmitConnectionState(Ct.Connected),i.video){const o=new $k(pe.Kind.Video,new lf({source:ir.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Oo.AUDIO,name:"video-dummy"}),new yv(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:kN(160*((t=s.aspectRatios[0])!==null&&t!==void 0?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(ue.LocalTrackPublished,o)}if(i.audio){const o=new $k(pe.Kind.Audio,new lf({source:ir.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Oo.AUDIO}),new Kb(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:iI(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(ue.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new gv({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:dk.ACTIVE,tracks:[],joinedAt:Tn.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=kN(160*((r=s.aspectRatios[o%s.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),u=new lf({source:ir.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Oo.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=iI(),u=new lf({source:ir.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Oo.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(e!==he.ActiveSpeakersChanged){const s=gV(r).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...r)}}Mc.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function gV(n){return n.map(e=>{if(e)return Array.isArray(e)?gV(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var ko;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(ko||(ko={}));class mu extends Da.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=ko.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Mc(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return Z(this,void 0,void 0,function*(){if(this.status!==ko.IDLE)throw Error("check is running already");this.setStatus(ko.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==ko.SKIPPED&&this.setStatus(this.isSuccess()?ko.SUCCESS:ko.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return Z(this,void 0,void 0,function*(){return this.room.state===Ct.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return Z(this,void 0,void 0,function*(){this.room&&this.room.state!==Ct.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(ko.SKIPPED)}switchProtocol(e){return Z(this,void 0,void 0,function*(){let t=!1,r=!1;if(this.room.on(he.Reconnecting,()=>{t=!0}),this.room.once(he.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!t)return;const i=Date.now()+1e4;for(;Date.now()<i;){if(r)return;yield Zi(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class jue extends mu{get description(){return"Cloud regions"}perform(){return Z(this,void 0,void 0,function*(){const e=new Uk(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],r=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(r.has(o))continue;r.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),t.push(a)}t.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const i=t[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return Z(this,void 0,void 0,function*(){var t,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const i=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!i)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let v=0;v<c;v++)yield s.write(l);yield s.close();const h=Date.now(),p=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),m={region:i,rtt:1e4,duration:h-u};return p==null||p.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(m.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const fI=1e4;class $ue extends mu{get description(){return"Connection via UDP vs TCP"}perform(){return Z(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(fI/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(fI/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return Z(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const r=t.getContext("2d");if(!r)throw new Error("Could not get canvas context");let i=0;const s=()=>{i=(i+1)%360,r.fillStyle="hsl(".concat(i,", 100%, 50%)"),r.fillRect(0,0,t.width,t.height),requestAnimationFrame(s)};s();const a=t.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>Z(this,void 0,void 0,function*(){const p=yield l.getRTCStatsReport();p==null||p.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(p=>setTimeout(p,fI)),clearInterval(h),a.stop(),t.remove(),yield this.disconnect(),u})}}function e6(n){return Z(this,void 0,void 0,function*(){var e,t;n??(n={}),(e=n.audio)!==null&&e!==void 0||(n.audio={deviceId:"default"}),(t=n.video)!==null&&t!==void 0||(n.video={deviceId:"default"});const{audioProcessor:r,videoProcessor:i}=KP(n),s=iV(n,aV,cV),o=Cw(s),a=navigator.mediaDevices.getUserMedia(o);n.audio&&(Pr.userMediaPromiseMap.set("audioinput",a),a.catch(()=>Pr.userMediaPromiseMap.delete("audioinput"))),n.video&&(Pr.userMediaPromiseMap.set("videoinput",a),a.catch(()=>Pr.userMediaPromiseMap.delete("videoinput")));const c=yield a;return Promise.all(c.getTracks().map(l=>Z(this,void 0,void 0,function*(){const u=l.kind==="audio";u?s.audio:s.video;let h;const p=u?o.audio:o.video;typeof p!="boolean"&&(h=p);const m=l.getSettings().deviceId;h!=null&&h.deviceId&&Vl(h.deviceId)!==m?h.deviceId=m:h||(h={deviceId:m});const v=uV(l,h);return v.kind===pe.Kind.Video?v.source=pe.Source.Camera:v.kind===pe.Kind.Audio&&(v.source=pe.Source.Microphone),v.mediaStream=c,Ac(v)&&r?yield v.setProcessor(r):vp(v)&&i&&(yield v.setProcessor(i)),v})))})}function Bue(n){return Z(this,void 0,void 0,function*(){return(yield e6({audio:!1,video:n}))[0]})}function Hue(n){return Z(this,void 0,void 0,function*(){return(yield e6({audio:n,video:!1}))[0]})}class Vue extends mu{get description(){return"Can publish audio"}perform(){return Z(this,void 0,void 0,function*(){var e;const t=yield this.connect(),r=yield Hue();if(yield sV(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(r),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class Gue extends mu{get description(){return"Can publish video"}perform(){return Z(this,void 0,void 0,function*(){var e;const t=yield this.connect(),r=yield Bue();yield this.checkForVideo(r.mediaStreamTrack),t.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return Z(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const r=document.createElement("video");r.srcObject=t,r.muted=!0,yield new Promise(i=>{r.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),h=(o=(s=u.width)!==null&&s!==void 0?s:r.videoWidth)!==null&&o!==void 0?o:1280,p=(c=(a=u.height)!==null&&a!==void 0?a:r.videoHeight)!==null&&c!==void 0?c:720;l.width=h,l.height=p;const m=l.getContext("2d");m.drawImage(r,0,0);const g=m.getImageData(0,0,l.width,l.height).data;let S=!0;for(let b=0;b<g.length;b+=4)if(g[b]!==0||g[b+1]!==0||g[b+2]!==0){S=!1;break}S?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),i()},1e3)},r.play()}),r.remove()})}}class que extends mu{get description(){return"Resuming connection after interruption"}perform(){return Z(this,void 0,void 0,function*(){var e;const t=yield this.connect();let r=!1,i=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{r=!0};t.on(he.SignalReconnecting,a).on(he.Reconnecting,a).on(he.Reconnected,()=>{i=!0,s(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const c=t.engine.client.onClose;if(c&&c(""),yield o,r){if(!i||t.state!==Ct.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Kue extends mu{get description(){return"Can connect via TURN"}perform(){return Z(this,void 0,void 0,function*(){var e,t;const r=new WP,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of i.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((t=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||t===void 0)&&t.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class Wue extends mu{get description(){return"Establishing WebRTC connection"}perform(){return Z(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(he.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,s)=>{if(i.candidate){const o=new RTCIceCandidate(i);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(zue(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(t=!0)),this.appendMessage(a)}r&&r(i,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=i=>{i instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(i.errorCode," ").concat(i.errorText," ").concat(i.url))})});try{yield this.connect(),wt.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function zue(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class Yue extends mu{get description(){return"Connecting to signal connection via WebSocket"}perform(){return Z(this,void 0,void 0,function*(){var e,t,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new WP;const s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===eH.Cloud&&(!((t=s.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=s.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class eqe extends Da.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:ko.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==ko.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return Z(this,void 0,void 0,function*(){const t=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=o=>{this.updateCheck(t,o)};r.on("update",i);const s=yield r.run();return r.off("update",i),s})}checkWebsocket(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(Yue)})}checkWebRTC(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(Wue)})}checkTURN(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(Kue)})}checkReconnect(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(que)})}checkPublishAudio(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(Vue)})}checkPublishVideo(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(Gue)})}checkConnectionProtocol(){return Z(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck($ue);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return Z(this,void 0,void 0,function*(){return this.createAndRunCheck(jue)})}}function t6(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;const r=fd(n)?n.mediaStreamTrack:n,i=r.getSettings();let s={facingMode:(t=e.defaultFacingMode)!==null&&t!==void 0?t:"user",confidence:"low"};if("facingMode"in i){const o=i.facingMode;wt.trace("rawFacingMode",{rawFacingMode:o}),o&&typeof o=="string"&&Zue(o)&&(s={facingMode:o,confidence:"high"})}if(["low","medium"].includes(s.confidence)){wt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const o=Jue(r.label);o!==void 0&&(s=o)}return s}const WN=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),Xue=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function Jue(n){var e;const t=n.trim().toLowerCase();if(t!=="")return WN.has(t)?WN.get(t):(e=Array.from(Xue.entries()).find(r=>{let[i]=r;return t.includes(i)}))===null||e===void 0?void 0:e[1]}function Zue(n){return n===void 0||["user","environment","left","right"].includes(n)}var Gm={},zN;function Que(){if(zN)return Gm;zN=1,Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.parse=o,Gm.serialize=l;const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,s=(()=>{const p=function(){};return p.prototype=Object.create(null),p})();function o(p,m){const v=new s,g=p.length;if(g<2)return v;const S=(m==null?void 0:m.decode)||u;let b=0;do{const R=p.indexOf("=",b);if(R===-1)break;const k=p.indexOf(";",b),I=k===-1?g:k;if(R>I){b=p.lastIndexOf(";",R-1)+1;continue}const T=a(p,b,R),C=c(p,R,T),P=p.slice(T,C);if(v[P]===void 0){let M=a(p,R+1,I),D=c(p,I,M);const F=S(p.slice(M,D));v[P]=F}b=I+1}while(b<g);return v}function a(p,m,v){do{const g=p.charCodeAt(m);if(g!==32&&g!==9)return m}while(++m<v);return v}function c(p,m,v){for(;m>v;){const g=p.charCodeAt(--m);if(g!==32&&g!==9)return m+1}return v}function l(p,m,v){const g=(v==null?void 0:v.encode)||encodeURIComponent;if(!n.test(p))throw new TypeError(`argument name is invalid: ${p}`);const S=g(m);if(!e.test(S))throw new TypeError(`argument val is invalid: ${m}`);let b=p+"="+S;if(!v)return b;if(v.maxAge!==void 0){if(!Number.isInteger(v.maxAge))throw new TypeError(`option maxAge is invalid: ${v.maxAge}`);b+="; Max-Age="+v.maxAge}if(v.domain){if(!t.test(v.domain))throw new TypeError(`option domain is invalid: ${v.domain}`);b+="; Domain="+v.domain}if(v.path){if(!r.test(v.path))throw new TypeError(`option path is invalid: ${v.path}`);b+="; Path="+v.path}if(v.expires){if(!h(v.expires)||!Number.isFinite(v.expires.valueOf()))throw new TypeError(`option expires is invalid: ${v.expires}`);b+="; Expires="+v.expires.toUTCString()}if(v.httpOnly&&(b+="; HttpOnly"),v.secure&&(b+="; Secure"),v.partitioned&&(b+="; Partitioned"),v.priority)switch(typeof v.priority=="string"?v.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${v.priority}`)}if(v.sameSite)switch(typeof v.sameSite=="string"?v.sameSite.toLowerCase():v.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${v.sameSite}`)}return b}function u(p){if(p.indexOf("%")===-1)return p;try{return decodeURIComponent(p)}catch{return p}}function h(p){return i.call(p)==="[object Date]"}return Gm}Que();/**
 * react-router v7.2.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var YN="popstate";function ede(n={}){function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return Bk("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:_v(i)}return nde(e,t,null,n)}function An(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Pa(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function tde(){return Math.random().toString(36).substring(2,10)}function XN(n,e){return{usr:n.state,key:n.key,idx:e}}function Bk(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?yp(e):e,state:t,key:e&&e.key||r||tde()}}function _v({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function yp(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function nde(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",c=null,l=u();l==null&&(l=0,o.replaceState({...o.state,idx:l},""));function u(){return(o.state||{idx:null}).idx}function h(){a="POP";let S=u(),b=S==null?null:S-l;l=S,c&&c({action:a,location:g.location,delta:b})}function p(S,b){a="PUSH";let R=Bk(g.location,S,b);l=u()+1;let k=XN(R,l),I=g.createHref(R);try{o.pushState(k,"",I)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;i.location.assign(I)}s&&c&&c({action:a,location:g.location,delta:1})}function m(S,b){a="REPLACE";let R=Bk(g.location,S,b);l=u();let k=XN(R,l),I=g.createHref(R);o.replaceState(k,"",I),s&&c&&c({action:a,location:g.location,delta:0})}function v(S){let b=i.location.origin!=="null"?i.location.origin:i.location.href,R=typeof S=="string"?S:_v(S);return R=R.replace(/ $/,"%20"),An(b,`No window.location.(origin|href) available to create URL for href: ${R}`),new URL(R,b)}let g={get action(){return a},get location(){return n(i,o)},listen(S){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(YN,h),c=S,()=>{i.removeEventListener(YN,h),c=null}},createHref(S){return e(i,S)},createURL:v,encodeLocation(S){let b=v(S);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:m,go(S){return o.go(S)}};return g}function n6(n,e,t="/"){return rde(n,e,t,!1)}function rde(n,e,t,r){let i=typeof e=="string"?yp(e):e,s=tu(i.pathname||"/",t);if(s==null)return null;let o=vV(n);ide(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=mde(s);a=fde(o[c],l,r)}return a}function vV(n,e=[],t=[],r=""){let i=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(An(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length));let l=wc([r,c.relativePath]),u=t.concat(c);s.children&&s.children.length>0&&(An(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),vV(s.children,e,u,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:dde(l,s.index),routesMeta:u})};return n.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let c of yV(s.path))i(s,o,c)}),e}function yV(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=yV(r.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),i&&a.push(...o),a.map(c=>n.startsWith("/")&&c===""?"/":c)}function ide(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:hde(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var sde=/^:[\w-]+$/,ode=3,ade=2,cde=1,lde=10,ude=-2,JN=n=>n==="*";function dde(n,e){let t=n.split("/"),r=t.length;return t.some(JN)&&(r+=ude),e&&(r+=ade),t.filter(i=>!JN(i)).reduce((i,s)=>i+(sde.test(s)?ode:s===""?cde:lde),r)}function hde(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function fde(n,e,t=!1){let{routesMeta:r}=n,i={},s="/",o=[];for(let a=0;a<r.length;++a){let c=r[a],l=a===r.length-1,u=s==="/"?e:e.slice(s.length)||"/",h=Yb({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},u),p=c.route;if(!h&&l&&t&&!r[r.length-1].route.index&&(h=Yb({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:wc([s,h.pathname]),pathnameBase:_de(wc([s,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(s=wc([s,h.pathnameBase]))}return o}function Yb(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=pde(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((l,{paramName:u,isOptional:h},p)=>{if(u==="*"){let v=a[p]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const m=a[p];return h&&!m?l[u]=void 0:l[u]=(m||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:n}}function pde(n,e=!1,t=!0){Pa(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(r.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function mde(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Pa(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function tu(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function gde(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?yp(n):n;return{pathname:t?t.startsWith("/")?t:vde(t,e):e,search:bde(r),hash:Sde(i)}}function vde(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function pI(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function yde(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function _V(n){let e=yde(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function bV(n,e,t,r=!1){let i;typeof n=="string"?i=yp(n):(i={...n},An(!i.pathname||!i.pathname.includes("?"),pI("?","pathname","search",i)),An(!i.pathname||!i.pathname.includes("#"),pI("#","pathname","hash",i)),An(!i.search||!i.search.includes("#"),pI("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),h-=1;i.pathname=p.join("/")}a=h>=0?e[h]:"/"}let c=gde(i,a),l=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(l||u)&&(c.pathname+="/"),c}var wc=n=>n.join("/").replace(/\/\/+/g,"/"),_de=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),bde=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Sde=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function wde(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var SV=["POST","PUT","PATCH","DELETE"];new Set(SV);var Ede=["GET",...SV];new Set(Ede);var _p=_.createContext(null);_p.displayName="DataRouter";var Rw=_.createContext(null);Rw.displayName="DataRouterState";var wV=_.createContext({isTransitioning:!1});wV.displayName="ViewTransition";var Cde=_.createContext(new Map);Cde.displayName="Fetchers";var Tde=_.createContext(null);Tde.displayName="Await";var Fa=_.createContext(null);Fa.displayName="Navigation";var bp=_.createContext(null);bp.displayName="Location";var Bc=_.createContext({outlet:null,matches:[],isDataRoute:!1});Bc.displayName="Route";var r6=_.createContext(null);r6.displayName="RouteError";function EV(n,{relative:e}={}){An(cy(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=_.useContext(Fa),{hash:i,pathname:s,search:o}=ly(n,{relative:e}),a=s;return t!=="/"&&(a=s==="/"?t:wc([t,s])),r.createHref({pathname:a,search:o,hash:i})}function cy(){return _.useContext(bp)!=null}function hi(){return An(cy(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(bp).location}function Ide(){return _.useContext(bp).navigationType}var CV="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function TV(n){_.useContext(Fa).static||_.useLayoutEffect(n)}function Ua(){let{isDataRoute:n}=_.useContext(Bc);return n?jde():Rde()}function Rde(){An(cy(),"useNavigate() may be used only in the context of a <Router> component.");let n=_.useContext(_p),{basename:e,navigator:t}=_.useContext(Fa),{matches:r}=_.useContext(Bc),{pathname:i}=hi(),s=JSON.stringify(_V(r)),o=_.useRef(!1);return TV(()=>{o.current=!0}),_.useCallback((c,l={})=>{if(Pa(o.current,CV),!o.current)return;if(typeof c=="number"){t.go(c);return}let u=bV(c,JSON.parse(s),i,l.relative==="path");n==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:wc([e,u.pathname])),(l.replace?t.replace:t.push)(u,l.state,l)},[e,t,s,i,n])}_.createContext(null);function ly(n,{relative:e}={}){let{matches:t}=_.useContext(Bc),{pathname:r}=hi(),i=JSON.stringify(_V(t));return _.useMemo(()=>bV(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function kde(n,e){return IV(n,e)}function IV(n,e,t,r){var R;An(cy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i,static:s}=_.useContext(Fa),{matches:o}=_.useContext(Bc),a=o[o.length-1],c=a?a.params:{},l=a?a.pathname:"/",u=a?a.pathnameBase:"/",h=a&&a.route;{let k=h&&h.path||"";RV(l,!h||k.endsWith("*")||k.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${k}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${k}"> to <Route path="${k==="/"?"*":`${k}/*`}">.`)}let p=hi(),m;if(e){let k=typeof e=="string"?yp(e):e;An(u==="/"||((R=k.pathname)==null?void 0:R.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${k.pathname}" was given in the \`location\` prop.`),m=k}else m=p;let v=m.pathname||"/",g=v;if(u!=="/"){let k=u.replace(/^\//,"").split("/");g="/"+v.replace(/^\//,"").split("/").slice(k.length).join("/")}let S=!s&&t&&t.matches&&t.matches.length>0?t.matches:n6(n,{pathname:g});Pa(h||S!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),Pa(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=Mde(S&&S.map(k=>Object.assign({},k,{params:Object.assign({},c,k.params),pathname:wc([u,i.encodeLocation?i.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?u:wc([u,i.encodeLocation?i.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),o,t,r);return e&&b?_.createElement(bp.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},b):b}function xde(){let n=Ude(),e=wde(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:s},"ErrorBoundary")," or"," ",_.createElement("code",{style:s},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),t?_.createElement("pre",{style:i},t):null,o)}var Pde=_.createElement(xde,null),Lde=class extends _.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?_.createElement(Bc.Provider,{value:this.props.routeContext},_.createElement(r6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Ade({routeContext:n,match:e,children:t}){let r=_.useContext(_p);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),_.createElement(Bc.Provider,{value:n},t)}function Mde(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,s=t==null?void 0:t.errors;if(s!=null){let c=i.findIndex(l=>l.route.id&&(s==null?void 0:s[l.route.id])!==void 0);An(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,c+1))}let o=!1,a=-1;if(t)for(let c=0;c<i.length;c++){let l=i[c];if((l.route.HydrateFallback||l.route.hydrateFallbackElement)&&(a=c),l.route.id){let{loaderData:u,errors:h}=t,p=l.route.loader&&!u.hasOwnProperty(l.route.id)&&(!h||h[l.route.id]===void 0);if(l.route.lazy||p){o=!0,a>=0?i=i.slice(0,a+1):i=[i[0]];break}}}return i.reduceRight((c,l,u)=>{let h,p=!1,m=null,v=null;t&&(h=s&&l.route.id?s[l.route.id]:void 0,m=l.route.errorElement||Pde,o&&(a<0&&u===0?(RV("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,v=null):a===u&&(p=!0,v=l.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,u+1)),S=()=>{let b;return h?b=m:p?b=v:l.route.Component?b=_.createElement(l.route.Component,null):l.route.element?b=l.route.element:b=c,_.createElement(Ade,{match:l,routeContext:{outlet:c,matches:g,isDataRoute:t!=null},children:b})};return t&&(l.route.ErrorBoundary||l.route.errorElement||u===0)?_.createElement(Lde,{location:t.location,revalidation:t.revalidation,component:m,error:h,children:S(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):S()},null)}function i6(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ode(n){let e=_.useContext(_p);return An(e,i6(n)),e}function Nde(n){let e=_.useContext(Rw);return An(e,i6(n)),e}function Dde(n){let e=_.useContext(Bc);return An(e,i6(n)),e}function s6(n){let e=Dde(n),t=e.matches[e.matches.length-1];return An(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function Fde(){return s6("useRouteId")}function Ude(){var r;let n=_.useContext(r6),e=Nde("useRouteError"),t=s6("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function jde(){let{router:n}=Ode("useNavigate"),e=s6("useNavigate"),t=_.useRef(!1);return TV(()=>{t.current=!0}),_.useCallback(async(i,s={})=>{Pa(t.current,CV),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...s}))},[n,e])}var ZN={};function RV(n,e,t){!e&&!ZN[n]&&(ZN[n]=!0,Pa(!1,t))}_.memo($de);function $de({routes:n,future:e,state:t}){return IV(n,void 0,t,e)}function kV(n){An(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Bde({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:s=!1}){An(!cy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=_.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof t=="string"&&(t=yp(t));let{pathname:c="/",search:l="",hash:u="",state:h=null,key:p="default"}=t,m=_.useMemo(()=>{let v=tu(c,o);return v==null?null:{location:{pathname:v,search:l,hash:u,state:h,key:p},navigationType:r}},[o,c,l,u,h,p,r]);return Pa(m!=null,`<Router basename="${o}"> is not able to match the URL "${c}${l}${u}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:_.createElement(Fa.Provider,{value:a},_.createElement(bp.Provider,{children:e,value:m}))}function Hde({children:n,location:e}){return kde(Xb(n),e)}function Xb(n,e=[]){let t=[];return _.Children.forEach(n,(r,i)=>{if(!_.isValidElement(r))return;let s=[...e,i];if(r.type===_.Fragment){t.push.apply(t,Xb(r.props.children,s));return}An(r.type===kV,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),An(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Xb(r.props.children,s)),t.push(o)}),t}var U_="get",j_="application/x-www-form-urlencoded";function kw(n){return n!=null&&typeof n.tagName=="string"}function Vde(n){return kw(n)&&n.tagName.toLowerCase()==="button"}function Gde(n){return kw(n)&&n.tagName.toLowerCase()==="form"}function qde(n){return kw(n)&&n.tagName.toLowerCase()==="input"}function Kde(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Wde(n,e){return n.button===0&&(!e||e==="_self")&&!Kde(n)}var f1=null;function zde(){if(f1===null)try{new FormData(document.createElement("form"),0),f1=!1}catch{f1=!0}return f1}var Yde=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function mI(n){return n!=null&&!Yde.has(n)?(Pa(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${j_}"`),null):n}function Xde(n,e){let t,r,i,s,o;if(Gde(n)){let a=n.getAttribute("action");r=a?tu(a,e):null,t=n.getAttribute("method")||U_,i=mI(n.getAttribute("enctype"))||j_,s=new FormData(n)}else if(Vde(n)||qde(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=n.getAttribute("formaction")||a.getAttribute("action");if(r=c?tu(c,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||U_,i=mI(n.getAttribute("formenctype"))||mI(a.getAttribute("enctype"))||j_,s=new FormData(a,n),!zde()){let{name:l,type:u,value:h}=n;if(u==="image"){let p=l?`${l}.`:"";s.append(`${p}x`,"0"),s.append(`${p}y`,"0")}else l&&s.append(l,h)}}else{if(kw(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=U_,r=null,i=j_,o=n}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:o}}function o6(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}async function Jde(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Zde(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Qde(n,e,t){let r=await Promise.all(n.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await Jde(s,t);return o.links?o.links():[]}return[]}));return rhe(r.flat(1).filter(Zde).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function QN(n,e,t,r,i,s){let o=(c,l)=>t[l]?c.route.id!==t[l].route.id:!0,a=(c,l)=>{var u;return t[l].pathname!==c.pathname||((u=t[l].route.path)==null?void 0:u.endsWith("*"))&&t[l].params["*"]!==c.params["*"]};return s==="assets"?e.filter((c,l)=>o(c,l)||a(c,l)):s==="data"?e.filter((c,l)=>{var h;let u=r.routes[c.route.id];if(!u||!u.hasLoader)return!1;if(o(c,l)||a(c,l))return!0;if(c.route.shouldRevalidate){let p=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((h=t[0])==null?void 0:h.params)||{},nextUrl:new URL(n,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function ehe(n,e,{includeHydrateFallback:t}={}){return the(n.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function the(n){return[...new Set(n)]}function nhe(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function rhe(n,e){let t=new Set;return new Set(e),n.reduce((r,i)=>{let s=JSON.stringify(nhe(i));return t.has(s)||(t.add(s),r.push({key:s,link:i})),r},[])}function ihe(n){let e=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function she(){let n=_.useContext(_p);return o6(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function ohe(){let n=_.useContext(Rw);return o6(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var a6=_.createContext(void 0);a6.displayName="FrameworkContext";function xV(){let n=_.useContext(a6);return o6(n,"You must render this element inside a <HydratedRouter> element"),n}function ahe(n,e){let t=_.useContext(a6),[r,i]=_.useState(!1),[s,o]=_.useState(!1),{onFocus:a,onBlur:c,onMouseEnter:l,onMouseLeave:u,onTouchStart:h}=e,p=_.useRef(null);_.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let g=b=>{b.forEach(R=>{o(R.isIntersecting)})},S=new IntersectionObserver(g,{threshold:.5});return p.current&&S.observe(p.current),()=>{S.disconnect()}}},[n]),_.useEffect(()=>{if(r){let g=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(g)}}},[r]);let m=()=>{i(!0)},v=()=>{i(!1),o(!1)};return t?n!=="intent"?[s,p,{}]:[s,p,{onFocus:qm(a,m),onBlur:qm(c,v),onMouseEnter:qm(l,m),onMouseLeave:qm(u,v),onTouchStart:qm(h,m)}]:[!1,p,{}]}function qm(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function che({page:n,...e}){let{router:t}=she(),r=_.useMemo(()=>n6(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?_.createElement(uhe,{page:n,matches:r,...e}):null}function lhe(n){let{manifest:e,routeModules:t}=xV(),[r,i]=_.useState([]);return _.useEffect(()=>{let s=!1;return Qde(n,e,t).then(o=>{s||i(o)}),()=>{s=!0}},[n,e,t]),r}function uhe({page:n,matches:e,...t}){let r=hi(),{manifest:i,routeModules:s}=xV(),{loaderData:o,matches:a}=ohe(),c=_.useMemo(()=>QN(n,e,a,i,r,"data"),[n,e,a,i,r]),l=_.useMemo(()=>QN(n,e,a,i,r,"assets"),[n,e,a,i,r]),u=_.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let m=new Set,v=!1;if(e.forEach(S=>{var R;let b=i.routes[S.route.id];!b||!b.hasLoader||(!c.some(k=>k.route.id===S.route.id)&&S.route.id in o&&((R=s[S.route.id])!=null&&R.shouldRevalidate)||b.hasClientLoader?v=!0:m.add(S.route.id))}),m.size===0)return[];let g=ihe(n);return v&&m.size>0&&g.searchParams.set("_routes",e.filter(S=>m.has(S.route.id)).map(S=>S.route.id).join(",")),[g.pathname+g.search]},[o,r,i,c,e,n,s]),h=_.useMemo(()=>ehe(l,i),[l,i]),p=lhe(l);return _.createElement(_.Fragment,null,u.map(m=>_.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...t})),h.map(m=>_.createElement("link",{key:m,rel:"modulepreload",href:m,...t})),p.map(({key:m,link:v})=>_.createElement("link",{key:m,...v})))}function dhe(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var PV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{PV&&(window.__reactRouterVersion="7.2.0")}catch{}function hhe({basename:n,children:e,window:t}){let r=_.useRef();r.current==null&&(r.current=ede({window:t,v5Compat:!0}));let i=r.current,[s,o]=_.useState({action:i.action,location:i.location}),a=_.useCallback(c=>{_.startTransition(()=>o(c))},[o]);return _.useLayoutEffect(()=>i.listen(a),[i,a]),_.createElement(Bde,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:i})}var LV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xw=_.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:c,to:l,preventScrollReset:u,viewTransition:h,...p},m){let{basename:v}=_.useContext(Fa),g=typeof l=="string"&&LV.test(l),S,b=!1;if(typeof l=="string"&&g&&(S=l,PV))try{let D=new URL(window.location.href),F=l.startsWith("//")?new URL(D.protocol+l):new URL(l),U=tu(F.pathname,v);F.origin===D.origin&&U!=null?l=U+F.search+F.hash:b=!0}catch{Pa(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let R=EV(l,{relative:i}),[k,I,T]=ahe(r,p),C=MV(l,{replace:o,state:a,target:c,preventScrollReset:u,relative:i,viewTransition:h});function P(D){e&&e(D),D.defaultPrevented||C(D)}let M=_.createElement("a",{...p,...T,href:S||R,onClick:b||s?e:P,ref:dhe(m,I),target:c,"data-discover":!g&&t==="render"?"true":void 0});return k&&!g?_.createElement(_.Fragment,null,M,_.createElement(che,{page:R})):M});xw.displayName="Link";var fhe=_.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:c,...l},u){let h=ly(o,{relative:l.relative}),p=hi(),m=_.useContext(Rw),{navigator:v,basename:g}=_.useContext(Fa),S=m!=null&&bhe(h)&&a===!0,b=v.encodeLocation?v.encodeLocation(h).pathname:h.pathname,R=p.pathname,k=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;t||(R=R.toLowerCase(),k=k?k.toLowerCase():null,b=b.toLowerCase()),k&&g&&(k=tu(k,g)||k);const I=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let T=R===b||!i&&R.startsWith(b)&&R.charAt(I)==="/",C=k!=null&&(k===b||!i&&k.startsWith(b)&&k.charAt(b.length)==="/"),P={isActive:T,isPending:C,isTransitioning:S},M=T?e:void 0,D;typeof r=="function"?D=r(P):D=[r,T?"active":null,C?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let F=typeof s=="function"?s(P):s;return _.createElement(xw,{...l,"aria-current":M,className:D,ref:u,style:F,to:o,viewTransition:a},typeof c=="function"?c(P):c)});fhe.displayName="NavLink";var phe=_.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:s,method:o=U_,action:a,onSubmit:c,relative:l,preventScrollReset:u,viewTransition:h,...p},m)=>{let v=yhe(),g=_he(a,{relative:l}),S=o.toLowerCase()==="get"?"get":"post",b=typeof a=="string"&&LV.test(a),R=k=>{if(c&&c(k),k.defaultPrevented)return;k.preventDefault();let I=k.nativeEvent.submitter,T=(I==null?void 0:I.getAttribute("formmethod"))||o;v(I||k.currentTarget,{fetcherKey:e,method:T,navigate:t,replace:i,state:s,relative:l,preventScrollReset:u,viewTransition:h})};return _.createElement("form",{ref:m,method:S,action:g,onSubmit:r?c:R,...p,"data-discover":!b&&n==="render"?"true":void 0})});phe.displayName="Form";function mhe(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AV(n){let e=_.useContext(_p);return An(e,mhe(n)),e}function MV(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=Ua(),c=hi(),l=ly(n,{relative:s});return _.useCallback(u=>{if(Wde(u,e)){u.preventDefault();let h=t!==void 0?t:_v(c)===_v(l);a(n,{replace:h,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[c,a,l,t,r,e,n,i,s,o])}var ghe=0,vhe=()=>`__${String(++ghe)}__`;function yhe(){let{router:n}=AV("useSubmit"),{basename:e}=_.useContext(Fa),t=Fde();return _.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:c,body:l}=Xde(r,e);if(i.navigate===!1){let u=i.fetcherKey||vhe();await n.fetch(u,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function _he(n,{relative:e}={}){let{basename:t}=_.useContext(Fa),r=_.useContext(Bc);An(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...ly(n||".",{relative:e})},o=hi();if(n==null){s.search=o.search;let a=new URLSearchParams(s.search),c=a.getAll("index");if(c.some(u=>u==="")){a.delete("index"),c.filter(h=>h).forEach(h=>a.append("index",h));let u=a.toString();s.search=u?`?${u}`:""}}return(!n||n===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:wc([t,s.pathname])),_v(s)}function bhe(n,e={}){let t=_.useContext(wV);An(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=AV("useViewTransitionState"),i=ly(n,{relative:e.relative});if(!t.isTransitioning)return!1;let s=tu(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=tu(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Yb(i.pathname,o)!=null||Yb(i.pathname,s)!=null}new TextEncoder;var Sp=IB();const OV=Wo(Sp),pt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,pd="8.55.0",jt=globalThis;function Pw(n,e,t){const r=t||jt,i=r.__SENTRY__=r.__SENTRY__||{},s=i[pd]=i[pd]||{};return s[n]||(s[n]=e())}const gu=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,She="Sentry Logger ",Hk=["debug","info","warn","error","log","assert","trace"],Jb={};function qd(n){if(!("console"in jt))return n();const e=jt.console,t={},r=Object.keys(Jb);r.forEach(i=>{const s=Jb[i];t[i]=e[i],e[i]=s});try{return n()}finally{r.forEach(i=>{e[i]=t[i]})}}function whe(){let n=!1;const e={enable:()=>{n=!0},disable:()=>{n=!1},isEnabled:()=>n};return gu?Hk.forEach(t=>{e[t]=(...r)=>{n&&qd(()=>{jt.console[t](`${She}[${t}]:`,...r)})}}):Hk.forEach(t=>{e[t]=()=>{}}),e}const Me=Pw("logger",whe),NV=50,xd="?",e8=/\(error: (.*)\)/,t8=/captureMessage|captureException/;function DV(...n){const e=n.sort((t,r)=>t[0]-r[0]).map(t=>t[1]);return(t,r=0,i=0)=>{const s=[],o=t.split(`
`);for(let a=r;a<o.length;a++){const c=o[a];if(c.length>1024)continue;const l=e8.test(c)?c.replace(e8,"$1"):c;if(!l.match(/\S*Error: /)){for(const u of e){const h=u(l);if(h){s.push(h);break}}if(s.length>=NV+i)break}}return Che(s.slice(i))}}function Ehe(n){return Array.isArray(n)?DV(...n):n}function Che(n){if(!n.length)return[];const e=Array.from(n);return/sentryWrapped/.test(p1(e).function||"")&&e.pop(),e.reverse(),t8.test(p1(e).function||"")&&(e.pop(),t8.test(p1(e).function||"")&&e.pop()),e.slice(0,NV).map(t=>({...t,filename:t.filename||p1(e).filename,function:t.function||xd}))}function p1(n){return n[n.length-1]||{}}const gI="<anonymous>";function Oc(n){try{return!n||typeof n!="function"?gI:n.name||gI}catch{return gI}}function n8(n){const e=n.exception;if(e){const t=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&t.push(...r.stacktrace.frames)}),t}catch{return}}}const $_={},r8={};function vu(n,e){$_[n]=$_[n]||[],$_[n].push(e)}function yu(n,e){if(!r8[n]){r8[n]=!0;try{e()}catch(t){gu&&Me.error(`Error while instrumenting ${n}`,t)}}}function Xs(n,e){const t=n&&$_[n];if(t)for(const r of t)try{r(e)}catch(i){gu&&Me.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${Oc(r)}
Error:`,i)}}let vI=null;function FV(n){const e="error";vu(e,n),yu(e,The)}function The(){vI=jt.onerror,jt.onerror=function(n,e,t,r,i){return Xs("error",{column:r,error:i,line:t,msg:n,url:e}),vI?vI.apply(this,arguments):!1},jt.onerror.__SENTRY_INSTRUMENTED__=!0}let yI=null;function UV(n){const e="unhandledrejection";vu(e,n),yu(e,Ihe)}function Ihe(){yI=jt.onunhandledrejection,jt.onunhandledrejection=function(n){return Xs("unhandledrejection",n),yI?yI.apply(this,arguments):!0},jt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Kd(){return c6(jt),jt}function c6(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||pd,e[pd]=e[pd]||{}}const jV=Object.prototype.toString;function Lw(n){switch(jV.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Nc(n,Error)}}function wp(n,e){return jV.call(n)===`[object ${e}]`}function $V(n){return wp(n,"ErrorEvent")}function i8(n){return wp(n,"DOMError")}function Rhe(n){return wp(n,"DOMException")}function Ec(n){return wp(n,"String")}function l6(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function u6(n){return n===null||l6(n)||typeof n!="object"&&typeof n!="function"}function Yf(n){return wp(n,"Object")}function Aw(n){return typeof Event<"u"&&Nc(n,Event)}function khe(n){return typeof Element<"u"&&Nc(n,Element)}function xhe(n){return wp(n,"RegExp")}function Mw(n){return!!(n&&n.then&&typeof n.then=="function")}function Phe(n){return Yf(n)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n}function Nc(n,e){try{return n instanceof e}catch{return!1}}function BV(n){return!!(typeof n=="object"&&n!==null&&(n.__isVue||n._isVue))}const kf=jt,Lhe=80;function Pd(n,e={}){if(!n)return"<unknown>";try{let t=n;const r=5,i=[];let s=0,o=0;const a=" > ",c=a.length;let l;const u=Array.isArray(e)?e:e.keyAttrs,h=!Array.isArray(e)&&e.maxStringLength||Lhe;for(;t&&s++<r&&(l=Ahe(t,u),!(l==="html"||s>1&&o+i.length*c+l.length>=h));)i.push(l),o+=l.length,t=t.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function Ahe(n,e){const t=n,r=[];if(!t||!t.tagName)return"";if(kf.HTMLElement&&t instanceof HTMLElement&&t.dataset){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}r.push(t.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>t.getAttribute(o)).map(o=>[o,t.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{t.id&&r.push(`#${t.id}`);const o=t.className;if(o&&Ec(o)){const a=o.split(/\s+/);for(const c of a)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const o of s){const a=t.getAttribute(o);a&&r.push(`[${o}="${a}"]`)}return r.join("")}function Mhe(){try{return kf.document.location.href}catch{return""}}function Ohe(n){return kf.document&&kf.document.querySelector?kf.document.querySelector(n):null}function HV(n){if(!kf.HTMLElement)return null;let e=n;const t=5;for(let r=0;r<t;r++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}function xf(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function s8(n,e){if(!Array.isArray(n))return"";const t=[];for(let r=0;r<n.length;r++){const i=n[r];try{BV(i)?t.push("[VueViewModel]"):t.push(String(i))}catch{t.push("[value cannot be serialized]")}}return t.join(e)}function Nhe(n,e,t=!1){return Ec(n)?xhe(e)?e.test(n):Ec(e)?t?n===e:n.includes(e):!1:!1}function md(n,e=[],t=!1){return e.some(r=>Nhe(n,r,t))}function ws(n,e,t){if(!(e in n))return;const r=n[e],i=t(r);typeof i=="function"&&VV(i,r);try{n[e]=i}catch{gu&&Me.log(`Failed to replace method "${e}" in object`,n)}}function no(n,e,t){try{Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0})}catch{gu&&Me.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function VV(n,e){try{const t=e.prototype||{};n.prototype=e.prototype=t,no(n,"__sentry_original__",e)}catch{}}function d6(n){return n.__sentry_original__}function GV(n){if(Lw(n))return{message:n.message,name:n.name,stack:n.stack,...a8(n)};if(Aw(n)){const e={type:n.type,target:o8(n.target),currentTarget:o8(n.currentTarget),...a8(n)};return typeof CustomEvent<"u"&&Nc(n,CustomEvent)&&(e.detail=n.detail),e}else return n}function o8(n){try{return khe(n)?Pd(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}}function a8(n){if(typeof n=="object"&&n!==null){const e={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}else return{}}function Dhe(n,e=40){const t=Object.keys(GV(n));t.sort();const r=t[0];if(!r)return"[object has no keys]";if(r.length>=e)return xf(r,e);for(let i=t.length;i>0;i--){const s=t.slice(0,i).join(", ");if(!(s.length>e))return i===t.length?s:xf(s,e)}return""}function Xr(n){return Vk(n,new Map)}function Vk(n,e){if(Fhe(n)){const t=e.get(n);if(t!==void 0)return t;const r={};e.set(n,r);for(const i of Object.getOwnPropertyNames(n))typeof n[i]<"u"&&(r[i]=Vk(n[i],e));return r}if(Array.isArray(n)){const t=e.get(n);if(t!==void 0)return t;const r=[];return e.set(n,r),n.forEach(i=>{r.push(Vk(i,e))}),r}return n}function Fhe(n){if(!Yf(n))return!1;try{const e=Object.getPrototypeOf(n).constructor.name;return!e||e==="Object"}catch{return!0}}const qV=1e3;function uy(){return Date.now()/qV}function Uhe(){const{performance:n}=jt;if(!n||!n.now)return uy;const e=Date.now()-n.now(),t=n.timeOrigin==null?e:n.timeOrigin;return()=>(t+n.now())/qV}const wi=Uhe(),ns=(()=>{const{performance:n}=jt;if(!n||!n.now)return;const e=3600*1e3,t=n.now(),r=Date.now(),i=n.timeOrigin?Math.abs(n.timeOrigin+t-r):e,s=i<e,o=n.timing&&n.timing.navigationStart,c=typeof o=="number"?Math.abs(o+t-r):e,l=c<e;return s||l?i<=c?n.timeOrigin:o:r})();function Js(){const n=jt,e=n.crypto||n.msCrypto;let t=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(t=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(t()&15)>>r/4).toString(16))}function KV(n){return n.exception&&n.exception.values?n.exception.values[0]:void 0}function Tl(n){const{message:e,event_id:t}=n;if(e)return e;const r=KV(n);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||t||"<unknown>":t||"<unknown>"}function Gk(n,e,t){const r=n.exception=n.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function Xf(n,e){const t=KV(n);if(!t)return;const r={type:"generic",handled:!0},i=t.mechanism;if(t.mechanism={...r,...i,...e},e&&"data"in e){const s={...i&&i.data,...e.data};t.mechanism.data=s}}function c8(n){if(jhe(n))return!0;try{no(n,"__sentry_captured__",!0)}catch{}return!1}function jhe(n){try{return n.__sentry_captured__}catch{}}var rc;(function(n){n[n.PENDING=0]="PENDING";const t=1;n[n.RESOLVED=t]="RESOLVED";const r=2;n[n.REJECTED=r]="REJECTED"})(rc||(rc={}));function Ld(n){return new $s(e=>{e(n)})}function Zb(n){return new $s((e,t)=>{t(n)})}class $s{constructor(e){$s.prototype.__init.call(this),$s.prototype.__init2.call(this),$s.prototype.__init3.call(this),$s.prototype.__init4.call(this),this._state=rc.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(t){this._reject(t)}}then(e,t){return new $s((r,i)=>{this._handlers.push([!1,s=>{if(!e)r(s);else try{r(e(s))}catch(o){i(o)}},s=>{if(!t)i(s);else try{r(t(s))}catch(o){i(o)}}]),this._executeHandlers()})}catch(e){return this.then(t=>t,e)}finally(e){return new $s((t,r)=>{let i,s;return this.then(o=>{s=!1,i=o,e&&e()},o=>{s=!0,i=o,e&&e()}).then(()=>{if(s){r(i);return}t(i)})})}__init(){this._resolve=e=>{this._setResult(rc.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(rc.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{if(this._state===rc.PENDING){if(Mw(t)){t.then(this._resolve,this._reject);return}this._state=e,this._value=t,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===rc.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(t=>{t[0]||(this._state===rc.RESOLVED&&t[1](this._value),this._state===rc.REJECTED&&t[2](this._value),t[0]=!0)})}}}function $he(n){const e=wi(),t={sid:Js(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Hhe(t)};return n&&Jf(t,n),t}function Jf(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),!n.did&&!e.did&&(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||wi(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:Js()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const t=n.timestamp-n.started;n.duration=t>=0?t:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function Bhe(n,e){let t={};n.status==="ok"&&(t={status:"exited"}),Jf(n,t)}function Hhe(n){return Xr({sid:`${n.sid}`,init:n.init,started:new Date(n.started*1e3).toISOString(),timestamp:new Date(n.timestamp*1e3).toISOString(),status:n.status,errors:n.errors,did:typeof n.did=="number"||typeof n.did=="string"?`${n.did}`:void 0,duration:n.duration,abnormal_mechanism:n.abnormal_mechanism,attrs:{release:n.release,environment:n.environment,ip_address:n.ipAddress,user_agent:n.userAgent}})}function nu(){return Js()}function ru(){return Js().substring(16)}function Ow(n,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(n&&e&&Object.keys(e).length===0)return n;const r={...n};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=Ow(r[i],e[i],t-1));return r}const qk="_sentrySpan";function bv(n,e){e?no(n,qk,e):delete n[qk]}function Qb(n){return n[qk]}const Vhe=100;class h6{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:nu(),spanId:ru()}}clone(){const e=new h6;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,bv(e,Qb(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Jf(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,[r,i]=t instanceof iu?[t.getScopeData(),t.getRequestSession()]:Yf(t)?[e,e.requestSession]:[],{tags:s,extra:o,user:a,contexts:c,level:l,fingerprint:u=[],propagationContext:h}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),u.length&&(this._fingerprint=u),h&&(this._propagationContext=h),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,bv(this,void 0),this._attachments=[],this.setPropagationContext({traceId:nu()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const r=typeof t=="number"?t:Vhe;if(r<=0)return this;const i={timestamp:uy(),...e};return this._breadcrumbs.push(i),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Qb(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Ow(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:ru(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,t){const r=t&&t.event_id?t.event_id:Js();if(!this._client)return Me.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...t,event_id:r},this),r}captureMessage(e,t,r){const i=r&&r.event_id?r.event_id:Js();if(!this._client)return Me.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,t){const r=t&&t.event_id?t.event_id:Js();return this._client?(this._client.captureEvent(e,{...t,event_id:r},this),r):(Me.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const iu=h6;function Ghe(){return Pw("defaultCurrentScope",()=>new iu)}function qhe(){return Pw("defaultIsolationScope",()=>new iu)}class Khe{constructor(e,t){let r;e?r=e:r=new iu;let i;t?i=t:i=new iu,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const t=this._pushScope();let r;try{r=e(t)}catch(i){throw this._popScope(),i}return Mw(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function Zf(){const n=Kd(),e=c6(n);return e.stack=e.stack||new Khe(Ghe(),qhe())}function Whe(n){return Zf().withScope(n)}function zhe(n,e){const t=Zf();return t.withScope(()=>(t.getStackTop().scope=n,e(n)))}function l8(n){return Zf().withScope(()=>n(Zf().getIsolationScope()))}function Yhe(){return{withIsolationScope:l8,withScope:Whe,withSetScope:zhe,withSetIsolationScope:(n,e)=>l8(e),getCurrentScope:()=>Zf().getScope(),getIsolationScope:()=>Zf().getIsolationScope()}}function Ep(n){const e=c6(n);return e.acs?e.acs:Yhe()}function cn(){const n=Kd();return Ep(n).getCurrentScope()}function ja(){const n=Kd();return Ep(n).getIsolationScope()}function Xhe(){return Pw("globalScope",()=>new iu)}function Nw(...n){const e=Kd(),t=Ep(e);if(n.length===2){const[r,i]=n;return r?t.withSetScope(r,i):t.withScope(i)}return t.withScope(n[0])}function qt(){return cn().getClient()}function Jhe(n){const e=n.getPropagationContext(),{traceId:t,spanId:r,parentSpanId:i}=e;return Xr({trace_id:t,span_id:r,parent_span_id:i})}const Zhe="_sentryMetrics";function Kk(n){const e=n[Zhe];if(!e)return;const t={};for(const[,[r,i]]of e)(t[r]||(t[r]=[])).push(Xr(i));return t}const Ws="sentry.source",WV="sentry.sample_rate",Dc="sentry.op",or="sentry.origin",Wk="sentry.idle_span_finish_reason",Dw="sentry.measurement_unit",Fw="sentry.measurement_value",u8="sentry.custom_span_name",Qhe="sentry.profile_id",f6="sentry.exclusive_time",efe=0,zV=1,Ir=2;function tfe(n){if(n<400&&n>=100)return{code:zV};if(n>=400&&n<500)switch(n){case 401:return{code:Ir,message:"unauthenticated"};case 403:return{code:Ir,message:"permission_denied"};case 404:return{code:Ir,message:"not_found"};case 409:return{code:Ir,message:"already_exists"};case 413:return{code:Ir,message:"failed_precondition"};case 429:return{code:Ir,message:"resource_exhausted"};case 499:return{code:Ir,message:"cancelled"};default:return{code:Ir,message:"invalid_argument"}}if(n>=500&&n<600)switch(n){case 501:return{code:Ir,message:"unimplemented"};case 503:return{code:Ir,message:"unavailable"};case 504:return{code:Ir,message:"deadline_exceeded"};default:return{code:Ir,message:"internal_error"}}return{code:Ir,message:"unknown_error"}}function YV(n,e){n.setAttribute("http.response.status_code",e);const t=tfe(e);t.message!=="unknown_error"&&n.setStatus(t)}const p6="sentry-",nfe=/^sentry-/,rfe=8192;function XV(n){const e=sfe(n);if(!e)return;const t=Object.entries(e).reduce((r,[i,s])=>{if(i.match(nfe)){const o=i.slice(p6.length);r[o]=s}return r},{});if(Object.keys(t).length>0)return t}function ife(n){if(!n)return;const e=Object.entries(n).reduce((t,[r,i])=>(i&&(t[`${p6}${r}`]=i),t),{});return ofe(e)}function sfe(n){if(!(!n||!Ec(n)&&!Array.isArray(n)))return Array.isArray(n)?n.reduce((e,t)=>{const r=d8(t);return Object.entries(r).forEach(([i,s])=>{e[i]=s}),e},{}):d8(n)}function d8(n){return n.split(",").map(e=>e.split("=").map(t=>decodeURIComponent(t.trim()))).reduce((e,[t,r])=>(t&&r&&(e[t]=r),e),{})}function ofe(n){if(Object.keys(n).length!==0)return Object.entries(n).reduce((e,[t,r],i)=>{const s=`${encodeURIComponent(t)}=${encodeURIComponent(r)}`,o=i===0?s:`${e},${s}`;return o.length>rfe?(gu&&Me.warn(`Not adding key: ${t} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):o},"")}const JV=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function afe(n){if(!n)return;const e=n.match(JV);if(!e)return;let t;return e[3]==="1"?t=!0:e[3]==="0"&&(t=!1),{traceId:e[1],parentSampled:t,parentSpanId:e[2]}}function cfe(n,e){const t=afe(n),r=XV(e);if(!t||!t.traceId)return{traceId:nu(),spanId:ru()};const{traceId:i,parentSpanId:s,parentSampled:o}=t,a=ru();return{traceId:i,parentSpanId:s,spanId:a,sampled:o,dsc:r||{}}}function ZV(n=nu(),e=ru(),t){let r="";return t!==void 0&&(r=t?"-1":"-0"),`${n}-${e}${r}`}const QV=0,eG=1;let h8=!1;function lfe(n){const{spanId:e,traceId:t}=n.spanContext(),{data:r,op:i,parent_span_id:s,status:o,origin:a}=Gt(n);return Xr({parent_span_id:s,span_id:e,trace_id:t,data:r,op:i,status:o,origin:a})}function ufe(n){const{spanId:e,traceId:t,isRemote:r}=n.spanContext(),i=r?e:Gt(n).parent_span_id,s=r?ru():e;return Xr({parent_span_id:i,span_id:s,trace_id:t})}function dfe(n){const{traceId:e,spanId:t}=n.spanContext(),r=Wd(n);return ZV(e,t,r)}function gd(n){return typeof n=="number"?f8(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?f8(n.getTime()):wi()}function f8(n){return n>9999999999?n/1e3:n}function Gt(n){if(ffe(n))return n.getSpanJSON();try{const{spanId:e,traceId:t}=n.spanContext();if(hfe(n)){const{attributes:r,startTime:i,name:s,endTime:o,parentSpanId:a,status:c}=n;return Xr({span_id:e,trace_id:t,data:r,description:s,parent_span_id:a,start_timestamp:gd(i),timestamp:gd(o)||void 0,status:tG(c),op:r[Dc],origin:r[or],_metrics_summary:Kk(n)})}return{span_id:e,trace_id:t}}catch{return{}}}function hfe(n){const e=n;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function ffe(n){return typeof n.getSpanJSON=="function"}function Wd(n){const{traceFlags:e}=n.spanContext();return e===eG}function tG(n){if(!(!n||n.code===efe))return n.code===zV?"ok":n.message||"unknown_error"}const vd="_sentryChildSpans",zk="_sentryRootSpan";function nG(n,e){const t=n[zk]||n;no(e,zk,t),n[vd]?n[vd].add(e):no(n,vd,new Set([e]))}function pfe(n,e){n[vd]&&n[vd].delete(e)}function B_(n){const e=new Set;function t(r){if(!e.has(r)&&Wd(r)){e.add(r);const i=r[vd]?Array.from(r[vd]):[];for(const s of i)t(s)}}return t(n),Array.from(e)}function Jr(n){return n[zk]||n}function Zr(){const n=Kd(),e=Ep(n);return e.getActiveSpan?e.getActiveSpan():Qb(cn())}function rG(){h8||(qd(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),h8=!0)}let p8=!1;function mfe(){p8||(p8=!0,FV(Yk),UV(Yk))}function Yk(){const n=Zr(),e=n&&Jr(n);if(e){const t="internal_error";pt&&Me.log(`[Tracing] Root span: ${t} -> Global error occurred`),e.setStatus({code:Ir,message:t})}}Yk.tag="sentry_tracingErrorCallback";const iG="_sentryScope",sG="_sentryIsolationScope";function gfe(n,e,t){n&&(no(n,sG,t),no(n,iG,e))}function m8(n){return{scope:n[iG],isolationScope:n[sG]}}function su(n){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=qt(),t=n||e&&e.getOptions();return!!t&&(t.enableTracing||"tracesSampleRate"in t||"tracesSampler"in t)}class Cp{constructor(e={}){this._traceId=e.traceId||nu(),this._spanId=e.spanId||ru()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:QV}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}const m6="production",oG="_frozenDsc";function g8(n,e){no(n,oG,e)}function aG(n,e){const t=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=Xr({environment:t.environment||m6,release:t.release,public_key:r,trace_id:n});return e.emit("createDsc",i),i}function cG(n,e){const t=e.getPropagationContext();return t.dsc||aG(t.traceId,n)}function Tp(n){const e=qt();if(!e)return{};const t=Jr(n),r=t[oG];if(r)return r;const i=t.spanContext().traceState,s=i&&i.get("sentry.dsc"),o=s&&XV(s);if(o)return o;const a=aG(n.spanContext().traceId,e),c=Gt(t),l=c.data||{},u=l[WV];u!=null&&(a.sample_rate=`${u}`);const h=l[Ws],p=c.description;return h!=="url"&&p&&(a.transaction=p),su()&&(a.sampled=String(Wd(t))),e.emit("createDsc",a,t),a}function vfe(n){if(!pt)return;const{description:e="< unknown name >",op:t="< unknown op >",parent_span_id:r}=Gt(n),{spanId:i}=n.spanContext(),s=Wd(n),o=Jr(n),a=o===n,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,l=[`op: ${t}`,`name: ${e}`,`ID: ${i}`];if(r&&l.push(`parent ID: ${r}`),!a){const{op:u,description:h}=Gt(o);l.push(`root ID: ${o.spanContext().spanId}`),u&&l.push(`root op: ${u}`),h&&l.push(`root description: ${h}`)}Me.log(`${c}
  ${l.join(`
  `)}`)}function yfe(n){if(!pt)return;const{description:e="< unknown name >",op:t="< unknown op >"}=Gt(n),{spanId:r}=n.spanContext(),s=Jr(n)===n,o=`[Tracing] Finishing "${t}" ${s?"root ":""}span "${e}" with ID ${r}`;Me.log(o)}function lG(n){if(typeof n=="boolean")return Number(n);const e=typeof n=="string"?parseFloat(n):n;if(typeof e!="number"||isNaN(e)||e<0||e>1){pt&&Me.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(n)} of type ${JSON.stringify(typeof n)}.`);return}return e}function _fe(n,e){if(!su(n))return[!1];const t=ja().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...e,normalizedRequest:e.normalizedRequest||t};let i;typeof n.tracesSampler=="function"?i=n.tracesSampler(r):r.parentSampled!==void 0?i=r.parentSampled:typeof n.tracesSampleRate<"u"?i=n.tracesSampleRate:i=1;const s=lG(i);return s===void 0?(pt&&Me.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):s?Math.random()<s?[!0,s]:(pt&&Me.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,s]):(pt&&Me.log(`[Tracing] Discarding transaction because ${typeof n.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s])}const bfe=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Sfe(n){return n==="http"||n==="https"}function Ip(n,e=!1){const{host:t,path:r,pass:i,port:s,projectId:o,protocol:a,publicKey:c}=n;return`${a}://${c}${e&&i?`:${i}`:""}@${t}${s?`:${s}`:""}/${r&&`${r}/`}${o}`}function wfe(n){const e=bfe.exec(n);if(!e){qd(()=>{console.error(`Invalid Sentry Dsn: ${n}`)});return}const[t,r,i="",s="",o="",a=""]=e.slice(1);let c="",l=a;const u=l.split("/");if(u.length>1&&(c=u.slice(0,-1).join("/"),l=u.pop()),l){const h=l.match(/^\d+/);h&&(l=h[0])}return uG({host:s,pass:i,path:c,projectId:l,port:o,protocol:t,publicKey:r})}function uG(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function Efe(n){if(!gu)return!0;const{port:e,projectId:t,protocol:r}=n;return["protocol","publicKey","host","projectId"].find(o=>n[o]?!1:(Me.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:t.match(/^\d+$/)?Sfe(r)?e&&isNaN(parseInt(e,10))?(Me.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(Me.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Me.error(`Invalid Sentry Dsn: Invalid projectId ${t}`),!1)}function dG(n){const e=typeof n=="string"?wfe(n):uG(n);if(!(!e||!Efe(e)))return e}function Cfe(){const n=typeof WeakSet=="function",e=n?new WeakSet:[];function t(i){if(n)return e.has(i)?!0:(e.add(i),!1);for(let s=0;s<e.length;s++)if(e[s]===i)return!0;return e.push(i),!1}function r(i){if(n)e.delete(i);else for(let s=0;s<e.length;s++)if(e[s]===i){e.splice(s,1);break}}return[t,r]}function ic(n,e=100,t=1/0){try{return Xk("",n,e,t)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function hG(n,e=3,t=100*1024){const r=ic(n,e);return kfe(r)>t?hG(n,e-1,t):r}function Xk(n,e,t=1/0,r=1/0,i=Cfe()){const[s,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const a=Tfe(n,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:t;if(c===0)return a.replace("object ","");if(s(e))return"[Circular ~]";const l=e;if(l&&typeof l.toJSON=="function")try{const m=l.toJSON();return Xk("",m,c-1,r,i)}catch{}const u=Array.isArray(e)?[]:{};let h=0;const p=GV(e);for(const m in p){if(!Object.prototype.hasOwnProperty.call(p,m))continue;if(h>=r){u[m]="[MaxProperties ~]";break}const v=p[m];u[m]=Xk(m,v,c-1,r,i),h++}return o(e),u}function Tfe(n,e){try{if(n==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(n==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(BV(e))return"[VueViewModel]";if(Phe(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${Oc(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const t=Ife(e);return/^HTML(\w*)Element$/.test(t)?`[HTMLElement: ${t}]`:`[object ${t}]`}catch(t){return`**non-serializable** (${t})`}}function Ife(n){const e=Object.getPrototypeOf(n);return e?e.constructor.name:"null prototype"}function Rfe(n){return~-encodeURI(n).split(/%..|./).length}function kfe(n){return Rfe(JSON.stringify(n))}function Rp(n,e=[]){return[n,e]}function xfe(n,e){const[t,r]=n;return[t,[...r,e]]}function v8(n,e){const t=n[1];for(const r of t){const i=r[0].type;if(e(r,i))return!0}return!1}function Jk(n){return jt.__SENTRY__&&jt.__SENTRY__.encodePolyfill?jt.__SENTRY__.encodePolyfill(n):new TextEncoder().encode(n)}function Pfe(n){const[e,t]=n;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[Jk(r),s]:r.push(typeof s=="string"?Jk(s):s)}for(const s of t){const[o,a]=s;if(i(`
${JSON.stringify(o)}
`),typeof a=="string"||a instanceof Uint8Array)i(a);else{let c;try{c=JSON.stringify(a)}catch{c=JSON.stringify(ic(a))}i(c)}}return typeof r=="string"?r:Lfe(r)}function Lfe(n){const e=n.reduce((i,s)=>i+s.length,0),t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}function Afe(n){return[{type:"span"},n]}function Mfe(n){const e=typeof n.data=="string"?Jk(n.data):n.data;return[Xr({type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType}),e]}const Ofe={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function y8(n){return Ofe[n]}function fG(n){if(!n||!n.sdk)return;const{name:e,version:t}=n.sdk;return{name:e,version:t}}function Nfe(n,e,t,r){const i=n.sdkProcessingMetadata&&n.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:n.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!t&&r&&{dsn:Ip(r)},...i&&{trace:Xr({...i})}}}function Dfe(n,e){return e&&(n.sdk=n.sdk||{},n.sdk.name=n.sdk.name||e.name,n.sdk.version=n.sdk.version||e.version,n.sdk.integrations=[...n.sdk.integrations||[],...e.integrations||[]],n.sdk.packages=[...n.sdk.packages||[],...e.packages||[]]),n}function Ffe(n,e,t,r){const i=fG(t),s={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:Ip(e)}},o="aggregates"in n?[{type:"sessions"},n]:[{type:"session"},n.toJSON()];return Rp(s,[o])}function Ufe(n,e,t,r){const i=fG(t),s=n.type&&n.type!=="replay_event"?n.type:"event";Dfe(n,t&&t.sdk);const o=Nfe(n,i,r,e);return delete n.sdkProcessingMetadata,Rp(o,[[{type:s},n]])}function jfe(n,e){function t(u){return!!u.trace_id&&!!u.public_key}const r=Tp(n[0]),i=e&&e.getDsn(),s=e&&e.getOptions().tunnel,o={sent_at:new Date().toISOString(),...t(r)&&{trace:r},...!!s&&i&&{dsn:Ip(i)}},a=e&&e.getOptions().beforeSendSpan,c=a?u=>{const h=a(Gt(u));return h||rG(),h}:u=>Gt(u),l=[];for(const u of n){const h=c(u);h&&l.push(Afe(h))}return Rp(o,l)}function $fe(n,e,t,r=Zr()){const i=r&&Jr(r);i&&(pt&&Me.log(`[Measurement] Setting measurement on root span: ${n} = ${e} ${t}`),i.addEvent(n,{[Fw]:e,[Dw]:t}))}function _8(n){if(!n||n.length===0)return;const e={};return n.forEach(t=>{const r=t.attributes||{},i=r[Dw],s=r[Fw];typeof i=="string"&&typeof s=="number"&&(e[t.name]={value:s,unit:i})}),e}const b8=1e3;class g6{constructor(e={}){this._traceId=e.traceId||nu(),this._spanId=e.spanId||ru(),this._startTime=e.startTimestamp||wi(),this._attributes={},this.setAttributes({[or]:"manual",[Dc]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:r}=this;return{spanId:e,traceId:t,traceFlags:r?eG:QV}}setAttribute(e,t){return t===void 0?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=gd(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(Ws,"custom"),this}end(e){this._endTime||(this._endTime=gd(e),yfe(this),this._onSpanEnded())}getSpanJSON(){return Xr({data:this._attributes,description:this._name,op:this._attributes[Dc],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:tG(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[or],_metrics_summary:Kk(this),profile_id:this._attributes[Qhe],exclusive_time:this._attributes[f6],measurements:_8(this._events),is_segment:this._isStandaloneSpan&&Jr(this)===this||void 0,segment_id:this._isStandaloneSpan?Jr(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,r){pt&&Me.log("[Tracing] Adding an event to span:",e);const i=S8(t)?t:r||wi(),s=S8(t)?{}:t||{},o={name:e,time:gd(i),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=qt();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===Jr(this)))return;if(this._isStandaloneSpan){this._sampled?Hfe(jfe([this],e)):(pt&&Me.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(m8(this).scope||cn()).captureEvent(r)}_convertSpanToTransaction(){if(!w8(Gt(this)))return;this._name||(pt&&Me.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=m8(this),i=(e||cn()).getClient()||qt();if(this._sampled!==!0){pt&&Me.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const o=B_(this).filter(h=>h!==this&&!Bfe(h)).map(h=>Gt(h)).filter(w8),a=this._attributes[Ws];delete this._attributes[u8],o.forEach(h=>{h.data&&delete h.data[u8]});const c={contexts:{trace:lfe(this)},spans:o.length>b8?o.sort((h,p)=>h.start_timestamp-p.start_timestamp).slice(0,b8):o,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,...Xr({dynamicSamplingContext:Tp(this)})},_metrics_summary:Kk(this),...a&&{transaction_info:{source:a}}},l=_8(this._events);return l&&Object.keys(l).length&&(pt&&Me.log("[Measurements] Adding measurements to transaction event",JSON.stringify(l,void 0,2)),c.measurements=l),c}}function S8(n){return n&&typeof n=="number"||n instanceof Date||Array.isArray(n)}function w8(n){return!!n.start_timestamp&&!!n.timestamp&&!!n.span_id&&!!n.trace_id}function Bfe(n){return n instanceof g6&&n.isStandaloneSpan()}function Hfe(n){const e=qt();if(!e)return;const t=n[1];if(!t||t.length===0){e.recordDroppedEvent("before_send","span");return}e.sendEnvelope(n)}const pG="__SENTRY_SUPPRESS_TRACING__";function dy(n){const e=gG();if(e.startInactiveSpan)return e.startInactiveSpan(n);const t=Gfe(n),{forceTransaction:r,parentSpan:i}=n;return(n.scope?o=>Nw(n.scope,o):i!==void 0?o=>mG(i,o):o=>o())(()=>{const o=cn(),a=Kfe(o);return n.onlyIfParent&&!a?new Cp:Vfe({parentSpan:a,spanArguments:t,forceTransaction:r,scope:o})})}function mG(n,e){const t=gG();return t.withActiveSpan?t.withActiveSpan(n,e):Nw(r=>(bv(r,n||void 0),e(r)))}function Vfe({parentSpan:n,spanArguments:e,forceTransaction:t,scope:r}){if(!su())return new Cp;const i=ja();let s;if(n&&!t)s=qfe(n,r,e),nG(n,s);else if(n){const o=Tp(n),{traceId:a,spanId:c}=n.spanContext(),l=Wd(n);s=E8({traceId:a,parentSpanId:c,...e},r,l),g8(s,o)}else{const{traceId:o,dsc:a,parentSpanId:c,sampled:l}={...i.getPropagationContext(),...r.getPropagationContext()};s=E8({traceId:o,parentSpanId:c,...e},r,l),a&&g8(s,a)}return vfe(s),gfe(s,r,i),s}function Gfe(n){const t={isStandalone:(n.experimental||{}).standalone,...n};if(n.startTime){const r={...t};return r.startTimestamp=gd(n.startTime),delete r.startTime,r}return t}function gG(){const n=Kd();return Ep(n)}function E8(n,e,t){const r=qt(),i=r&&r.getOptions()||{},{name:s="",attributes:o}=n,[a,c]=e.getScopeData().sdkProcessingMetadata[pG]?[!1]:_fe(i,{name:s,parentSampled:t,attributes:o,transactionContext:{name:s,parentSampled:t}}),l=new g6({...n,attributes:{[Ws]:"custom",...n.attributes},sampled:a});return c!==void 0&&l.setAttribute(WV,c),r&&r.emit("spanStart",l),l}function qfe(n,e,t){const{spanId:r,traceId:i}=n.spanContext(),s=e.getScopeData().sdkProcessingMetadata[pG]?!1:Wd(n),o=s?new g6({...t,parentSpanId:r,traceId:i,sampled:s}):new Cp({traceId:i});nG(n,o);const a=qt();return a&&(a.emit("spanStart",o),t.endTimestamp&&a.emit("spanEnd",o)),o}function Kfe(n){const e=Qb(n);if(!e)return;const t=qt();return(t?t.getOptions():{}).parentSpanIsAlwaysRootSpan?Jr(e):e}const H_={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},Wfe="heartbeatFailed",zfe="idleTimeout",Yfe="finalTimeout",Xfe="externalFinish";function vG(n,e={}){const t=new Map;let r=!1,i,s=Xfe,o=!e.disableAutoFinish;const a=[],{idleTimeout:c=H_.idleTimeout,finalTimeout:l=H_.finalTimeout,childSpanTimeout:u=H_.childSpanTimeout,beforeSpanEnd:h}=e,p=qt();if(!p||!su())return new Cp;const m=cn(),v=Zr(),g=Jfe(n);g.end=new Proxy(g.end,{apply(C,P,M){h&&h(g);const[D,...F]=M,U=D||wi(),B=gd(U),V=B_(g).filter(G=>G!==g);if(!V.length)return T(B),Reflect.apply(C,P,[B,...F]);const z=V.map(G=>Gt(G).timestamp).filter(G=>!!G),H=z.length?Math.max(...z):void 0,J=Gt(g).start_timestamp,Y=Math.min(J?J+l/1e3:1/0,Math.max(J||-1/0,Math.min(B,H||1/0)));return T(Y),Reflect.apply(C,P,[Y,...F])}});function S(){i&&(clearTimeout(i),i=void 0)}function b(C){S(),i=setTimeout(()=>{!r&&t.size===0&&o&&(s=zfe,g.end(C))},c)}function R(C){i=setTimeout(()=>{!r&&o&&(s=Wfe,g.end(C))},u)}function k(C){S(),t.set(C,!0);const P=wi();R(P+u/1e3)}function I(C){if(t.has(C)&&t.delete(C),t.size===0){const P=wi();b(P+c/1e3)}}function T(C){r=!0,t.clear(),a.forEach(B=>B()),bv(m,v);const P=Gt(g),{start_timestamp:M}=P;if(!M)return;(P.data||{})[Wk]||g.setAttribute(Wk,s),Me.log(`[Tracing] Idle span "${P.op}" finished`);const F=B_(g).filter(B=>B!==g);let U=0;F.forEach(B=>{B.isRecording()&&(B.setStatus({code:Ir,message:"cancelled"}),B.end(C),pt&&Me.log("[Tracing] Cancelling span since span ended early",JSON.stringify(B,void 0,2)));const V=Gt(B),{timestamp:z=0,start_timestamp:H=0}=V,J=H<=C,Y=(l+c)/1e3,G=z-H<=Y;if(pt){const K=JSON.stringify(B,void 0,2);J?G||Me.log("[Tracing] Discarding span since it finished after idle span final timeout",K):Me.log("[Tracing] Discarding span since it happened after idle span was finished",K)}(!G||!J)&&(pfe(g,B),U++)}),U>0&&g.setAttribute("sentry.idle_span_discarded_spans",U)}return a.push(p.on("spanStart",C=>{if(r||C===g||Gt(C).timestamp)return;B_(g).includes(C)&&k(C.spanContext().spanId)})),a.push(p.on("spanEnd",C=>{r||I(C.spanContext().spanId)})),a.push(p.on("idleSpanEnableAutoFinish",C=>{C===g&&(o=!0,b(),t.size&&R())})),e.disableAutoFinish||b(),setTimeout(()=>{r||(g.setStatus({code:Ir,message:"deadline_exceeded"}),s=Yfe,g.end())},l),g}function Jfe(n){const e=dy(n);return bv(cn(),e),pt&&Me.log("[Tracing] Started span is an idle span"),e}function Zk(n,e,t,r=0){return new $s((i,s)=>{const o=n[r];if(e===null||typeof o!="function")i(e);else{const a=o({...e},t);pt&&o.id&&a===null&&Me.log(`Event processor "${o.id}" dropped event`),Mw(a)?a.then(c=>Zk(n,c,t,r+1).then(i)).then(null,s):Zk(n,a,t,r+1).then(i).then(null,s)}})}let m1,C8,g1;function Zfe(n){const e=jt._sentryDebugIds;if(!e)return{};const t=Object.keys(e);return g1&&t.length===C8||(C8=t.length,g1=t.reduce((r,i)=>{m1||(m1={});const s=m1[i];if(s)r[s[0]]=s[1];else{const o=n(i);for(let a=o.length-1;a>=0;a--){const c=o[a],l=c&&c.filename,u=e[i];if(l&&u){r[l]=u,m1[i]=[l,u];break}}}return r},{})),g1}function Qfe(n,e){const{fingerprint:t,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;epe(n,e),r&&rpe(n,r),ipe(n,t),tpe(n,i),npe(n,s)}function T8(n,e){const{extra:t,tags:r,user:i,contexts:s,level:o,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:l,eventProcessors:u,attachments:h,propagationContext:p,transactionName:m,span:v}=e;v1(n,"extra",t),v1(n,"tags",r),v1(n,"user",i),v1(n,"contexts",s),n.sdkProcessingMetadata=Ow(n.sdkProcessingMetadata,a,2),o&&(n.level=o),m&&(n.transactionName=m),v&&(n.span=v),c.length&&(n.breadcrumbs=[...n.breadcrumbs,...c]),l.length&&(n.fingerprint=[...n.fingerprint,...l]),u.length&&(n.eventProcessors=[...n.eventProcessors,...u]),h.length&&(n.attachments=[...n.attachments,...h]),n.propagationContext={...n.propagationContext,...p}}function v1(n,e,t){n[e]=Ow(n[e],t,1)}function epe(n,e){const{extra:t,tags:r,user:i,contexts:s,level:o,transactionName:a}=e,c=Xr(t);c&&Object.keys(c).length&&(n.extra={...c,...n.extra});const l=Xr(r);l&&Object.keys(l).length&&(n.tags={...l,...n.tags});const u=Xr(i);u&&Object.keys(u).length&&(n.user={...u,...n.user});const h=Xr(s);h&&Object.keys(h).length&&(n.contexts={...h,...n.contexts}),o&&(n.level=o),a&&n.type!=="transaction"&&(n.transaction=a)}function tpe(n,e){const t=[...n.breadcrumbs||[],...e];n.breadcrumbs=t.length?t:void 0}function npe(n,e){n.sdkProcessingMetadata={...n.sdkProcessingMetadata,...e}}function rpe(n,e){n.contexts={trace:ufe(e),...n.contexts},n.sdkProcessingMetadata={dynamicSamplingContext:Tp(e),...n.sdkProcessingMetadata};const t=Jr(e),r=Gt(t).description;r&&!n.transaction&&n.type==="transaction"&&(n.transaction=r)}function ipe(n,e){n.fingerprint=n.fingerprint?Array.isArray(n.fingerprint)?n.fingerprint:[n.fingerprint]:[],e&&(n.fingerprint=n.fingerprint.concat(e)),n.fingerprint&&!n.fingerprint.length&&delete n.fingerprint}function spe(n,e,t,r,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:a=1e3}=n,c={...e,event_id:e.event_id||t.event_id||Js(),timestamp:e.timestamp||uy()},l=t.integrations||n.integrations.map(S=>S.name);ope(c,n),lpe(c,l),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&ape(c,n.stackParser);const u=dpe(r,t.captureContext);t.mechanism&&Xf(c,t.mechanism);const h=i?i.getEventProcessors():[],p=Xhe().getScopeData();if(s){const S=s.getScopeData();T8(p,S)}if(u){const S=u.getScopeData();T8(p,S)}const m=[...t.attachments||[],...p.attachments];m.length&&(t.attachments=m),Qfe(c,p);const v=[...h,...p.eventProcessors];return Zk(v,c,t).then(S=>(S&&cpe(S),typeof o=="number"&&o>0?upe(S,o,a):S))}function ope(n,e){const{environment:t,release:r,dist:i,maxValueLength:s=250}=e;n.environment=n.environment||t||m6,!n.release&&r&&(n.release=r),!n.dist&&i&&(n.dist=i),n.message&&(n.message=xf(n.message,s));const o=n.exception&&n.exception.values&&n.exception.values[0];o&&o.value&&(o.value=xf(o.value,s));const a=n.request;a&&a.url&&(a.url=xf(a.url,s))}function ape(n,e){const t=Zfe(e);try{n.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{t&&i.filename&&(i.debug_id=t[i.filename])})})}catch{}}function cpe(n){const e={};try{n.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;n.debug_meta=n.debug_meta||{},n.debug_meta.images=n.debug_meta.images||[];const t=n.debug_meta.images;Object.entries(e).forEach(([r,i])=>{t.push({type:"sourcemap",code_file:r,debug_id:i})})}function lpe(n,e){e.length>0&&(n.sdk=n.sdk||{},n.sdk.integrations=[...n.sdk.integrations||[],...e])}function upe(n,e,t){if(!n)return null;const r={...n,...n.breadcrumbs&&{breadcrumbs:n.breadcrumbs.map(i=>({...i,...i.data&&{data:ic(i.data,e,t)}}))},...n.user&&{user:ic(n.user,e,t)},...n.contexts&&{contexts:ic(n.contexts,e,t)},...n.extra&&{extra:ic(n.extra,e,t)}};return n.contexts&&n.contexts.trace&&r.contexts&&(r.contexts.trace=n.contexts.trace,n.contexts.trace.data&&(r.contexts.trace.data=ic(n.contexts.trace.data,e,t))),n.spans&&(r.spans=n.spans.map(i=>({...i,...i.data&&{data:ic(i.data,e,t)}}))),n.contexts&&n.contexts.flags&&r.contexts&&(r.contexts.flags=ic(n.contexts.flags,3,t)),r}function dpe(n,e){if(!e)return n;const t=n?n.clone():new iu;return t.update(e),t}function hpe(n){if(n)return fpe(n)?{captureContext:n}:mpe(n)?{captureContext:n}:n}function fpe(n){return n instanceof iu||typeof n=="function"}const ppe=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function mpe(n){return Object.keys(n).some(e=>ppe.includes(e))}function Uw(n,e){return cn().captureException(n,hpe(e))}function gpe(n,e){const r={captureContext:e};return cn().captureMessage(n,void 0,r)}function yG(n,e){return cn().captureEvent(n,e)}function vpe(n,e){ja().setContext(n,e)}function ype(){return ja().lastEventId()}function _pe(){const n=qt();return!!n&&n.getOptions().enabled!==!1&&!!n.getTransport()}function I8(n){const e=qt(),t=ja(),r=cn(),{release:i,environment:s=m6}=e&&e.getOptions()||{},{userAgent:o}=jt.navigator||{},a=$he({release:i,environment:s,user:r.getUser()||t.getUser(),...o&&{userAgent:o},...n}),c=t.getSession();return c&&c.status==="ok"&&Jf(c,{status:"exited"}),_G(),t.setSession(a),r.setSession(a),a}function _G(){const n=ja(),e=cn(),t=e.getSession()||n.getSession();t&&Bhe(t),bG(),n.setSession(),e.setSession()}function bG(){const n=ja(),e=cn(),t=qt(),r=e.getSession()||n.getSession();r&&t&&t.captureSession(r)}function R8(n=!1){if(n){_G();return}bG()}const bpe="7";function SG(n){const e=n.protocol?`${n.protocol}:`:"",t=n.port?`:${n.port}`:"";return`${e}//${n.host}${t}${n.path?`/${n.path}`:""}/api/`}function Spe(n){return`${SG(n)}${n.projectId}/envelope/`}function wpe(n,e){const t={sentry_version:bpe};return n.publicKey&&(t.sentry_key=n.publicKey),e&&(t.sentry_client=`${e.name}/${e.version}`),new URLSearchParams(t).toString()}function Epe(n,e,t){return e||`${Spe(n)}?${wpe(n,t)}`}function Cpe(n,e){const t=dG(n);if(!t)return"";const r=`${SG(t)}embed/error-page/`;let i=`dsn=${Ip(t)}`;for(const s in e)if(s!=="dsn"&&s!=="onClose")if(s==="user"){const o=e.user;if(!o)continue;o.name&&(i+=`&name=${encodeURIComponent(o.name)}`),o.email&&(i+=`&email=${encodeURIComponent(o.email)}`)}else i+=`&${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`;return`${r}?${i}`}const k8=[];function Tpe(n){const e={};return n.forEach(t=>{const{name:r}=t,i=e[r];i&&!i.isDefaultInstance&&t.isDefaultInstance||(e[r]=t)}),Object.values(e)}function Ipe(n){const e=n.defaultIntegrations||[],t=n.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(t))r=[...e,...t];else if(typeof t=="function"){const o=t(e);r=Array.isArray(o)?o:[o]}else r=e;const i=Tpe(r),s=i.findIndex(o=>o.name==="Debug");if(s>-1){const[o]=i.splice(s,1);i.push(o)}return i}function Rpe(n,e){const t={};return e.forEach(r=>{r&&wG(n,r,t)}),t}function x8(n,e){for(const t of e)t&&t.afterAllSetup&&t.afterAllSetup(n)}function wG(n,e,t){if(t[e.name]){pt&&Me.log(`Integration skipped because it was already installed: ${e.name}`);return}if(t[e.name]=e,k8.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),k8.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);n.on("preprocessEvent",(i,s)=>r(i,s,n))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,o)=>r(s,o,n),{id:e.name});n.addEventProcessor(i)}pt&&Me.log(`Integration installed: ${e.name}`)}function kpe(n,e,t){const r=[{type:"client_report"},{timestamp:uy(),discarded_events:n}];return Rp(e?{dsn:e}:{},[r])}class Lo extends Error{constructor(e,t="warn"){super(e),this.message=e,this.logLevel=t}}const P8="Not capturing exception because it's already been captured.";class xpe{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=dG(e.dsn):pt&&Me.warn("No DSN provided, client will not send events."),this._dsn){const i=Epe(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:i})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find(i=>i in e&&e[i]==null);r&&qd(()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,t,r){const i=Js();if(c8(e))return pt&&Me.log(P8),i;const s={event_id:i,...t};return this._process(this.eventFromException(e,s).then(o=>this._captureEvent(o,s,r))),s.event_id}captureMessage(e,t,r,i){const s={event_id:Js(),...r},o=l6(e)?e:String(e),a=u6(e)?this.eventFromMessage(o,t,s):this.eventFromException(e,s);return this._process(a.then(c=>this._captureEvent(c,s,i))),s.event_id}captureEvent(e,t,r){const i=Js();if(t&&t.originalException&&c8(t.originalException))return pt&&Me.log(P8),i;const s={event_id:i,...t},a=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,a||r)),s.event_id}captureSession(e){typeof e.release!="string"?pt&&Me.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),Jf(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>t.flush(e).then(i=>r&&i))):Ld(!0)}close(e){return this.flush(e).then(t=>(this.getOptions().enabled=!1,this.emit("close"),t))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];wG(this,e,this._integrations),t||x8(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let r=Ufe(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of t.attachments||[])r=xfe(r,Mfe(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const t=Ffe(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${t}`;pt&&Me.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,t){const r=this._hooks[e]=this._hooks[e]||[];return r.push(t),()=>{const i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){const r=this._hooks[e];r&&r.forEach(i=>i(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,t=>(pt&&Me.error("Error while sending envelope:",t),t)):(pt&&Me.error("Transport disabled"),Ld({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=Rpe(this,e),x8(this,e)}_updateSessionFromEvent(e,t){let r=t.level==="fatal",i=!1;const s=t.exception&&t.exception.values;if(s){i=!0;for(const c of s){const l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&r)&&(Jf(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new $s(t=>{let r=0;const i=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),t(!0)):(r+=i,e&&r>=e&&(clearInterval(s),t(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,t,r=cn(),i=ja()){const s=this.getOptions(),o=Object.keys(this._integrations);return!t.integrations&&o.length>0&&(t.integrations=o),this.emit("preprocessEvent",e,t),e.type||i.setLastEventId(e.event_id||t.event_id),spe(s,e,t,r,this,i).then(a=>{if(a===null)return a;a.contexts={trace:Jhe(r),...a.contexts};const c=cG(this,r);return a.sdkProcessingMetadata={dynamicSamplingContext:c,...a.sdkProcessingMetadata},a})}_captureEvent(e,t={},r){return this._processEvent(e,t,r).then(i=>i.event_id,i=>{pt&&(i instanceof Lo&&i.logLevel==="log"?Me.log(i.message):Me.warn(i))})}_processEvent(e,t,r){const i=this.getOptions(),{sampleRate:s}=i,o=CG(e),a=EG(e),c=e.type||"error",l=`before send for type \`${c}\``,u=typeof s>"u"?void 0:lG(s);if(a&&typeof u=="number"&&Math.random()>u)return this.recordDroppedEvent("sample_rate","error",e),Zb(new Lo(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const h=c==="replay_event"?"replay":c,m=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,r,m).then(v=>{if(v===null)throw this.recordDroppedEvent("event_processor",h,e),new Lo("An event processor returned `null`, will not send event.","log");if(t.data&&t.data.__sentry__===!0)return v;const S=Lpe(this,i,v,t);return Ppe(S,l)}).then(v=>{if(v===null){if(this.recordDroppedEvent("before_send",h,e),o){const R=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",R)}throw new Lo(`${l} returned \`null\`, will not send event.`,"log")}const g=r&&r.getSession();if(!o&&g&&this._updateSessionFromEvent(g,v),o){const b=v.sdkProcessingMetadata&&v.sdkProcessingMetadata.spanCountBeforeProcessing||0,R=v.spans?v.spans.length:0,k=b-R;k>0&&this.recordDroppedEvent("before_send","span",k)}const S=v.transaction_info;if(o&&S&&v.transaction!==e.transaction){const b="custom";v.transaction_info={...S,source:b}}return this.sendEvent(v,t),v}).then(null,v=>{throw v instanceof Lo?v:(this.captureException(v,{data:{__sentry__:!0},originalException:v}),new Lo(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${v}`))})}_process(e){this._numProcessing++,e.then(t=>(this._numProcessing--,t),t=>(this._numProcessing--,t))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([t,r])=>{const[i,s]=t.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){pt&&Me.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){pt&&Me.log("No outcomes to send");return}if(!this._dsn){pt&&Me.log("No dsn provided, will not send outcomes");return}pt&&Me.log("Sending outcomes:",e);const t=kpe(e,this._options.tunnel&&Ip(this._dsn));this.sendEnvelope(t)}}function Ppe(n,e){const t=`${e} must return \`null\` or a valid event.`;if(Mw(n))return n.then(r=>{if(!Yf(r)&&r!==null)throw new Lo(t);return r},r=>{throw new Lo(`${e} rejected with ${r}`)});if(!Yf(n)&&n!==null)throw new Lo(t);return n}function Lpe(n,e,t,r){const{beforeSend:i,beforeSendTransaction:s,beforeSendSpan:o}=e;if(EG(t)&&i)return i(t,r);if(CG(t)){if(t.spans&&o){const a=[];for(const c of t.spans){const l=o(c);l?a.push(l):(rG(),n.recordDroppedEvent("before_send","span"))}t.spans=a}if(s){if(t.spans){const a=t.spans.length;t.sdkProcessingMetadata={...t.sdkProcessingMetadata,spanCountBeforeProcessing:a}}return s(t,r)}}return t}function EG(n){return n.type===void 0}function CG(n){return n.type==="transaction"}function Ape(n,e){e.debug===!0&&(pt?Me.enable():qd(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),cn().update(e.initialScope);const r=new n(e);return Mpe(r),r.init(),r}function Mpe(n){cn().setClient(n)}function Ope(n){const e=[];function t(){return n===void 0||e.length<n}function r(o){return e.splice(e.indexOf(o),1)[0]||Promise.resolve(void 0)}function i(o){if(!t())return Zb(new Lo("Not adding Promise because buffer limit was reached."));const a=o();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function s(o){return new $s((a,c)=>{let l=e.length;if(!l)return a(!0);const u=setTimeout(()=>{o&&o>0&&a(!1)},o);e.forEach(h=>{Ld(h).then(()=>{--l||(clearTimeout(u),a(!0))},c)})})}return{$:e,add:i,drain:s}}const Npe=60*1e3;function Dpe(n,e=Date.now()){const t=parseInt(`${n}`,10);if(!isNaN(t))return t*1e3;const r=Date.parse(`${n}`);return isNaN(r)?Npe:r-e}function Fpe(n,e){return n[e]||n.all||0}function Upe(n,e,t=Date.now()){return Fpe(n,e)>t}function jpe(n,{statusCode:e,headers:t},r=Date.now()){const i={...n},s=t&&t["x-sentry-rate-limits"],o=t&&t["retry-after"];if(s)for(const a of s.trim().split(",")){const[c,l,,,u]=a.split(":",5),h=parseInt(c,10),p=(isNaN(h)?60:h)*1e3;if(!l)i.all=r+p;else for(const m of l.split(";"))m==="metric_bucket"?(!u||u.split(";").includes("custom"))&&(i[m]=r+p):i[m]=r+p}else o?i.all=r+Dpe(o,r):e===429&&(i.all=r+60*1e3);return i}const $pe=64;function Bpe(n,e,t=Ope(n.bufferSize||$pe)){let r={};const i=o=>t.drain(o);function s(o){const a=[];if(v8(o,(h,p)=>{const m=y8(p);if(Upe(r,m)){const v=L8(h,p);n.recordDroppedEvent("ratelimit_backoff",m,v)}else a.push(h)}),a.length===0)return Ld({});const c=Rp(o[0],a),l=h=>{v8(c,(p,m)=>{const v=L8(p,m);n.recordDroppedEvent(h,y8(m),v)})},u=()=>e({body:Pfe(c)}).then(h=>(h.statusCode!==void 0&&(h.statusCode<200||h.statusCode>=300)&&pt&&Me.warn(`Sentry responded with status code ${h.statusCode} to sent event.`),r=jpe(r,h),h),h=>{throw l("network_error"),h});return t.add(u).then(h=>h,h=>{if(h instanceof Lo)return pt&&Me.error("Skipped sending event because buffer is full."),l("queue_overflow"),Ld({});throw h})}return{send:s,flush:i}}function L8(n,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(n)?n[1]:void 0}function TG(n,e,t=[e],r="npm"){const i=n._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:t.map(s=>({name:`${r}:@sentry/${s}`,version:pd})),version:pd}),n._metadata=i}function IG(n={}){const e=qt();if(!_pe()||!e)return{};const t=Kd(),r=Ep(t);if(r.getTraceData)return r.getTraceData(n);const i=cn(),s=n.span||Zr(),o=s?dfe(s):Hpe(i),a=s?Tp(s):cG(e,i),c=ife(a);return JV.test(o)?{"sentry-trace":o,baggage:c}:(Me.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function Hpe(n){const{traceId:e,sampled:t,spanId:r}=n.getPropagationContext();return ZV(e,r,t)}const Vpe=100;function Ad(n,e){const t=qt(),r=ja();if(!t)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=Vpe}=t.getOptions();if(s<=0)return;const a={timestamp:uy(),...n},c=i?qd(()=>i(a,e)):a;c!==null&&(t.emit&&t.emit("beforeAddBreadcrumb",c,e),r.addBreadcrumb(c,s))}let A8;const Gpe="FunctionToString",M8=new WeakMap,qpe=()=>({name:Gpe,setupOnce(){A8=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=d6(this),t=M8.has(qt())&&e!==void 0?e:this;return A8.apply(t,n)}}catch{}},setup(n){M8.set(n,!0)}}),Kpe=qpe,Wpe=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],zpe="InboundFilters",Ype=(n={})=>({name:zpe,processEvent(e,t,r){const i=r.getOptions(),s=Jpe(n,i);return Zpe(e,s)?null:e}}),Xpe=Ype;function Jpe(n={},e={}){return{allowUrls:[...n.allowUrls||[],...e.allowUrls||[]],denyUrls:[...n.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...n.ignoreErrors||[],...e.ignoreErrors||[],...n.disableErrorDefaults?[]:Wpe],ignoreTransactions:[...n.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:n.ignoreInternal!==void 0?n.ignoreInternal:!0}}function Zpe(n,e){return e.ignoreInternal&&ime(n)?(pt&&Me.warn(`Event dropped due to being internal Sentry Error.
Event: ${Tl(n)}`),!0):Qpe(n,e.ignoreErrors)?(pt&&Me.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${Tl(n)}`),!0):ome(n)?(pt&&Me.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${Tl(n)}`),!0):eme(n,e.ignoreTransactions)?(pt&&Me.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${Tl(n)}`),!0):tme(n,e.denyUrls)?(pt&&Me.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${Tl(n)}.
Url: ${eS(n)}`),!0):nme(n,e.allowUrls)?!1:(pt&&Me.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${Tl(n)}.
Url: ${eS(n)}`),!0)}function Qpe(n,e){return n.type||!e||!e.length?!1:rme(n).some(t=>md(t,e))}function eme(n,e){if(n.type!=="transaction"||!e||!e.length)return!1;const t=n.transaction;return t?md(t,e):!1}function tme(n,e){if(!e||!e.length)return!1;const t=eS(n);return t?md(t,e):!1}function nme(n,e){if(!e||!e.length)return!0;const t=eS(n);return t?md(t,e):!0}function rme(n){const e=[];n.message&&e.push(n.message);let t;try{t=n.exception.values[n.exception.values.length-1]}catch{}return t&&t.value&&(e.push(t.value),t.type&&e.push(`${t.type}: ${t.value}`)),e}function ime(n){try{return n.exception.values[0].type==="SentryError"}catch{}return!1}function sme(n=[]){for(let e=n.length-1;e>=0;e--){const t=n[e];if(t&&t.filename!=="<anonymous>"&&t.filename!=="[native code]")return t.filename||null}return null}function eS(n){try{let e;try{e=n.exception.values[0].stacktrace.frames}catch{}return e?sme(e):null}catch{return pt&&Me.error(`Cannot extract url for event ${Tl(n)}`),null}}function ome(n){return n.type||!n.exception||!n.exception.values||n.exception.values.length===0?!1:!n.message&&!n.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}function ame(n,e,t=250,r,i,s,o){if(!s.exception||!s.exception.values||!o||!Nc(o.originalException,Error))return;const a=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;a&&(s.exception.values=cme(Qk(n,e,i,o.originalException,r,s.exception.values,a,0),t))}function Qk(n,e,t,r,i,s,o,a){if(s.length>=t+1)return s;let c=[...s];if(Nc(r[i],Error)){O8(o,a);const l=n(e,r[i]),u=c.length;N8(l,i,u,a),c=Qk(n,e,t,r[i],i,[l,...c],l,u)}return Array.isArray(r.errors)&&r.errors.forEach((l,u)=>{if(Nc(l,Error)){O8(o,a);const h=n(e,l),p=c.length;N8(h,`errors[${u}]`,p,a),c=Qk(n,e,t,l,i,[h,...c],h,p)}}),c}function O8(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function N8(n,e,t,r){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:t,parent_id:r}}function cme(n,e){return n.map(t=>(t.value&&(t.value=xf(t.value,e)),t))}function yd(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const t=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:t,hash:r,relative:e[5]+t+r}}function D8(n){return n.split(/\\?\//).filter(e=>e.length>0&&e!==",").length}function lme(n){const e="console";vu(e,n),yu(e,ume)}function ume(){"console"in jt&&Hk.forEach(function(n){n in jt.console&&ws(jt.console,n,function(e){return Jb[n]=e,function(...t){Xs("console",{args:t,level:n});const i=Jb[n];i&&i.apply(jt.console,t)}})})}function dme(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const hme="Dedupe",fme=()=>{let n;return{name:hme,processEvent(e){if(e.type)return e;try{if(mme(e,n))return pt&&Me.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return n=e}}},pme=fme;function mme(n,e){return e?!!(gme(n,e)||vme(n,e)):!1}function gme(n,e){const t=n.message,r=e.message;return!(!t&&!r||t&&!r||!t&&r||t!==r||!kG(n,e)||!RG(n,e))}function vme(n,e){const t=F8(e),r=F8(n);return!(!t||!r||t.type!==r.type||t.value!==r.value||!kG(n,e)||!RG(n,e))}function RG(n,e){let t=n8(n),r=n8(e);if(!t&&!r)return!0;if(t&&!r||!t&&r||(t=t,r=r,r.length!==t.length))return!1;for(let i=0;i<r.length;i++){const s=r[i],o=t[i];if(s.filename!==o.filename||s.lineno!==o.lineno||s.colno!==o.colno||s.function!==o.function)return!1}return!0}function kG(n,e){let t=n.fingerprint,r=e.fingerprint;if(!t&&!r)return!0;if(t&&!r||!t&&r)return!1;t=t,r=r;try{return t.join("")===r.join("")}catch{return!1}}function F8(n){return n.exception&&n.exception.values&&n.exception.values[0]}function yme(n,e,t,r,i="auto.http.browser"){if(!n.fetchData)return;const s=su()&&e(n.fetchData.url);if(n.endTimestamp&&s){const p=n.fetchData.__span;if(!p)return;const m=r[p];m&&(Sme(m,n),delete r[p]);return}const{method:o,url:a}=n.fetchData,c=bme(a),l=c?yd(c).host:void 0,u=!!Zr(),h=s&&u?dy({name:`${o} ${a}`,attributes:{url:a,type:"fetch","http.method":o,"http.url":c,"server.address":l,[or]:i,[Dc]:"http.client"}}):new Cp;if(n.fetchData.__span=h.spanContext().spanId,r[h.spanContext().spanId]=h,t(n.fetchData.url)){const p=n.args[0],m=n.args[1]||{},v=_me(p,m,su()&&u?h:void 0);v&&(n.args[1]=m,m.headers=v)}return h}function _me(n,e,t){const r=IG({span:t}),i=r["sentry-trace"],s=r.baggage;if(!i)return;const o=e.headers||(wme(n)?n.headers:void 0);if(o)if(Eme(o)){const a=new Headers(o);if(a.set("sentry-trace",i),s){const c=a.get("baggage");if(c){const l=y1(c);a.set("baggage",l?`${l},${s}`:s)}else a.set("baggage",s)}return a}else if(Array.isArray(o)){const a=[...o.filter(c=>!(Array.isArray(c)&&c[0]==="sentry-trace")).map(c=>{if(Array.isArray(c)&&c[0]==="baggage"&&typeof c[1]=="string"){const[l,u,...h]=c;return[l,y1(u),...h]}else return c}),["sentry-trace",i]];return s&&a.push(["baggage",s]),a}else{const a="baggage"in o?o.baggage:void 0;let c=[];return Array.isArray(a)?c=a.map(l=>typeof l=="string"?y1(l):l).filter(l=>l===""):a&&c.push(y1(a)),s&&c.push(s),{...o,"sentry-trace":i,baggage:c.length>0?c.join(","):void 0}}else return{...r}}function bme(n){try{return new URL(n).href}catch{return}}function Sme(n,e){if(e.response){YV(n,e.response.status);const t=e.response&&e.response.headers&&e.response.headers.get("content-length");if(t){const r=parseInt(t);r>0&&n.setAttribute("http.response_content_length",r)}}else e.error&&n.setStatus({code:Ir,message:"internal_error"});n.end()}function y1(n){return n.split(",").filter(e=>!e.split("=")[0].startsWith(p6)).join(",")}function wme(n){return typeof Request<"u"&&Nc(n,Request)}function Eme(n){return typeof Headers<"u"&&Nc(n,Headers)}function xG(n){if(n!==void 0)return n>=400&&n<500?"warning":n>=500?"error":void 0}const e3=jt;function PG(){if(!("fetch"in e3))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function t3(n){return n&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(n.toString())}function Cme(){if(typeof EdgeRuntime=="string")return!0;if(!PG())return!1;if(t3(e3.fetch))return!0;let n=!1;const e=e3.document;if(e&&typeof e.createElement=="function")try{const t=e.createElement("iframe");t.hidden=!0,e.head.appendChild(t),t.contentWindow&&t.contentWindow.fetch&&(n=t3(t.contentWindow.fetch)),e.head.removeChild(t)}catch(t){gu&&Me.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return n}function LG(n,e){const t="fetch";vu(t,n),yu(t,()=>AG(void 0,e))}function Tme(n){const e="fetch-body-resolved";vu(e,n),yu(e,()=>AG(Rme))}function AG(n,e=!1){e&&!Cme()||ws(jt,"fetch",function(t){return function(...r){const i=new Error,{method:s,url:o}=kme(r),a={args:r,fetchData:{method:s,url:o},startTimestamp:wi()*1e3,virtualError:i};return n||Xs("fetch",{...a}),t.apply(jt,r).then(async c=>(n?n(c):Xs("fetch",{...a,endTimestamp:wi()*1e3,response:c}),c),c=>{throw Xs("fetch",{...a,endTimestamp:wi()*1e3,error:c}),Lw(c)&&c.stack===void 0&&(c.stack=i.stack,no(c,"framesToPop",1)),c})}})}async function Ime(n,e){if(n&&n.body){const t=n.body,r=t.getReader(),i=setTimeout(()=>{t.cancel().then(null,()=>{})},90*1e3);let s=!0;for(;s;){let o;try{o=setTimeout(()=>{t.cancel().then(null,()=>{})},5e3);const{done:a}=await r.read();clearTimeout(o),a&&(e(),s=!1)}catch{s=!1}finally{clearTimeout(o)}}clearTimeout(i),r.releaseLock(),t.cancel().then(null,()=>{})}}function Rme(n){let e;try{e=n.clone()}catch{return}Ime(e,()=>{Xs("fetch-body-resolved",{endTimestamp:wi()*1e3,response:n})})}function n3(n,e){return!!n&&typeof n=="object"&&!!n[e]}function U8(n){return typeof n=="string"?n:n?n3(n,"url")?n.url:n.toString?n.toString():"":""}function kme(n){if(n.length===0)return{method:"GET",url:""};if(n.length===2){const[t,r]=n;return{url:U8(t),method:n3(r,"method")?String(r.method).toUpperCase():"GET"}}const e=n[0];return{url:U8(e),method:n3(e,"method")?String(e.method).toUpperCase():"GET"}}function xme(){return"npm"}const _1=jt;function Pme(){const n=_1.chrome,e=n&&n.app&&n.app.runtime,t="history"in _1&&!!_1.history.pushState&&!!_1.history.replaceState;return!e&&t}const rt=jt;let r3=0;function MG(){return r3>0}function Lme(){r3++,setTimeout(()=>{r3--})}function Qf(n,e={}){function t(i){return typeof i=="function"}if(!t(n))return n;try{const i=n.__sentry_wrapped__;if(i)return typeof i=="function"?i:n;if(d6(n))return n}catch{return n}const r=function(...i){try{const s=i.map(o=>Qf(o,e));return n.apply(this,s)}catch(s){throw Lme(),Nw(o=>{o.addEventProcessor(a=>(e.mechanism&&(Gk(a,void 0),Xf(a,e.mechanism)),a.extra={...a.extra,arguments:i},a)),Uw(s)}),s}};try{for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}catch{}VV(r,n),no(n,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return n.name}})}catch{}return r}const Cs=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function v6(n,e){const t=y6(n,e),r={type:Dme(e),value:Fme(e)};return t.length&&(r.stacktrace={frames:t}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function Ame(n,e,t,r){const i=qt(),s=i&&i.getOptions().normalizeDepth,o=Hme(e),a={__serialized__:hG(e,s)};if(o)return{exception:{values:[v6(n,o)]},extra:a};const c={exception:{values:[{type:Aw(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:$me(e,{isUnhandledRejection:r})}]},extra:a};if(t){const l=y6(n,t);l.length&&(c.exception.values[0].stacktrace={frames:l})}return c}function _I(n,e){return{exception:{values:[v6(n,e)]}}}function y6(n,e){const t=e.stacktrace||e.stack||"",r=Ome(e),i=Nme(e);try{return n(t,r,i)}catch{}return[]}const Mme=/Minified React error #\d+;/i;function Ome(n){return n&&Mme.test(n.message)?1:0}function Nme(n){return typeof n.framesToPop=="number"?n.framesToPop:0}function OG(n){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?n instanceof WebAssembly.Exception:!1}function Dme(n){const e=n&&n.name;return!e&&OG(n)?n.message&&Array.isArray(n.message)&&n.message.length==2?n.message[0]:"WebAssembly.Exception":e}function Fme(n){const e=n&&n.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:OG(n)&&Array.isArray(n.message)&&n.message.length==2?n.message[1]:e:"No error message"}function Ume(n,e,t,r){const i=t&&t.syntheticException||void 0,s=_6(n,e,i,r);return Xf(s),s.level="error",t&&t.event_id&&(s.event_id=t.event_id),Ld(s)}function jme(n,e,t="info",r,i){const s=r&&r.syntheticException||void 0,o=i3(n,e,s,i);return o.level=t,r&&r.event_id&&(o.event_id=r.event_id),Ld(o)}function _6(n,e,t,r,i){let s;if($V(e)&&e.error)return _I(n,e.error);if(i8(e)||Rhe(e)){const o=e;if("stack"in e)s=_I(n,e);else{const a=o.name||(i8(o)?"DOMError":"DOMException"),c=o.message?`${a}: ${o.message}`:a;s=i3(n,c,t,r),Gk(s,c)}return"code"in o&&(s.tags={...s.tags,"DOMException.code":`${o.code}`}),s}return Lw(e)?_I(n,e):Yf(e)||Aw(e)?(s=Ame(n,e,t,i),Xf(s,{synthetic:!0}),s):(s=i3(n,e,t,r),Gk(s,`${e}`),Xf(s,{synthetic:!0}),s)}function i3(n,e,t,r){const i={};if(r&&t){const s=y6(n,t);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]}),Xf(i,{synthetic:!0})}if(l6(e)){const{__sentry_template_string__:s,__sentry_template_values__:o}=e;return i.logentry={message:s,params:o},i}return i.message=e,i}function $me(n,{isUnhandledRejection:e}){const t=Dhe(n),r=e?"promise rejection":"exception";return $V(n)?`Event \`ErrorEvent\` captured as ${r} with message \`${n.message}\``:Aw(n)?`Event \`${Bme(n)}\` (type=${n.type}) captured as ${r}`:`Object captured as ${r} with keys: ${t}`}function Bme(n){try{const e=Object.getPrototypeOf(n);return e?e.constructor.name:void 0}catch{}}function Hme(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=n[e];if(t instanceof Error)return t}}function Vme(n,{metadata:e,tunnel:t,dsn:r}){const i={event_id:n.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!t&&!!r&&{dsn:Ip(r)}},s=Gme(n);return Rp(i,[s])}function Gme(n){return[{type:"user_report"},n]}class qme extends xpe{constructor(e){const t={parentSpanIsAlwaysRootSpan:!0,...e},r=rt.SENTRY_SDK_SOURCE||xme();TG(t,"browser",["browser"],r),super(t),t.sendClientReports&&rt.document&&rt.document.addEventListener("visibilitychange",()=>{rt.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,t){return Ume(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",r){return jme(this._options.stackParser,e,t,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){Cs&&Me.warn("SDK not enabled, will not capture user feedback.");return}const t=Vme(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(t)}_prepareEvent(e,t,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,r)}}const b6=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Kme=(n,e)=>n>e[1]?"poor":n>e[0]?"needs-improvement":"good",kp=(n,e,t,r)=>{let i,s;return o=>{e.value>=0&&(o||r)&&(s=e.value-(i||0),(s||i===void 0)&&(i=e.value,e.delta=s,e.rating=Kme(e.value,t),n(e)))}},ot=jt,Wme=()=>`v4-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,hy=(n=!0)=>{const e=ot.performance&&ot.performance.getEntriesByType&&ot.performance.getEntriesByType("navigation")[0];if(!n||e&&e.responseStart>0&&e.responseStart<performance.now())return e},fy=()=>{const n=hy();return n&&n.activationStart||0},xp=(n,e)=>{const t=hy();let r="navigate";return t&&(ot.document&&ot.document.prerendering||fy()>0?r="prerender":ot.document&&ot.document.wasDiscarded?r="restore":t.type&&(r=t.type.replace(/_/g,"-"))),{name:n,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:Wme(),navigationType:r}},zd=(n,e,t)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(n)){const r=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return r.observe(Object.assign({type:n,buffered:!0},t||{})),r}}catch{}},Pp=n=>{const e=t=>{(t.type==="pagehide"||ot.document&&ot.document.visibilityState==="hidden")&&n(t)};ot.document&&(addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0))},jw=n=>{let e=!1;return()=>{e||(n(),e=!0)}};let Og=-1;const zme=()=>ot.document.visibilityState==="hidden"&&!ot.document.prerendering?0:1/0,tS=n=>{ot.document.visibilityState==="hidden"&&Og>-1&&(Og=n.type==="visibilitychange"?n.timeStamp:0,Xme())},Yme=()=>{addEventListener("visibilitychange",tS,!0),addEventListener("prerenderingchange",tS,!0)},Xme=()=>{removeEventListener("visibilitychange",tS,!0),removeEventListener("prerenderingchange",tS,!0)},$w=()=>(ot.document&&Og<0&&(Og=zme(),Yme()),{get firstHiddenTime(){return Og}}),py=n=>{ot.document&&ot.document.prerendering?addEventListener("prerenderingchange",()=>n(),!0):n()},Jme=[1800,3e3],Zme=(n,e={})=>{py(()=>{const t=$w(),r=xp("FCP");let i;const o=zd("paint",a=>{a.forEach(c=>{c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<t.firstHiddenTime&&(r.value=Math.max(c.startTime-fy(),0),r.entries.push(c),i(!0)))})});o&&(i=kp(n,r,Jme,e.reportAllChanges))})},Qme=[.1,.25],ege=(n,e={})=>{Zme(jw(()=>{const t=xp("CLS",0);let r,i=0,s=[];const o=c=>{c.forEach(l=>{if(!l.hadRecentInput){const u=s[0],h=s[s.length-1];i&&u&&h&&l.startTime-h.startTime<1e3&&l.startTime-u.startTime<5e3?(i+=l.value,s.push(l)):(i=l.value,s=[l])}}),i>t.value&&(t.value=i,t.entries=s,r())},a=zd("layout-shift",o);a&&(r=kp(n,t,Qme,e.reportAllChanges),Pp(()=>{o(a.takeRecords()),r(!0)}),setTimeout(r,0))}))},tge=[100,300],nge=(n,e={})=>{py(()=>{const t=$w(),r=xp("FID");let i;const s=c=>{c.startTime<t.firstHiddenTime&&(r.value=c.processingStart-c.startTime,r.entries.push(c),i(!0))},o=c=>{c.forEach(s)},a=zd("first-input",o);i=kp(n,r,tge,e.reportAllChanges),a&&Pp(jw(()=>{o(a.takeRecords()),a.disconnect()}))})};let NG=0,bI=1/0,b1=0;const rge=n=>{n.forEach(e=>{e.interactionId&&(bI=Math.min(bI,e.interactionId),b1=Math.max(b1,e.interactionId),NG=b1?(b1-bI)/7+1:0)})};let s3;const ige=()=>s3?NG:performance.interactionCount||0,sge=()=>{"interactionCount"in performance||s3||(s3=zd("event",rge,{type:"event",buffered:!0,durationThreshold:0}))},sc=[],SI=new Map,oge=40;let age=0;const cge=()=>ige()-age,lge=()=>{const n=Math.min(sc.length-1,Math.floor(cge()/50));return sc[n]},wI=10,uge=[],dge=n=>{if(uge.forEach(r=>r(n)),!(n.interactionId||n.entryType==="first-input"))return;const e=sc[sc.length-1],t=SI.get(n.interactionId);if(t||sc.length<wI||e&&n.duration>e.latency){if(t)n.duration>t.latency?(t.entries=[n],t.latency=n.duration):n.duration===t.latency&&n.startTime===(t.entries[0]&&t.entries[0].startTime)&&t.entries.push(n);else{const r={id:n.interactionId,latency:n.duration,entries:[n]};SI.set(r.id,r),sc.push(r)}sc.sort((r,i)=>i.latency-r.latency),sc.length>wI&&sc.splice(wI).forEach(r=>SI.delete(r.id))}},DG=n=>{const e=ot.requestIdleCallback||ot.setTimeout;let t=-1;return n=jw(n),ot.document&&ot.document.visibilityState==="hidden"?n():(t=e(n),Pp(n)),t},hge=[200,500],fge=(n,e={})=>{"PerformanceEventTiming"in ot&&"interactionId"in PerformanceEventTiming.prototype&&py(()=>{sge();const t=xp("INP");let r;const i=o=>{DG(()=>{o.forEach(dge);const a=lge();a&&a.latency!==t.value&&(t.value=a.latency,t.entries=a.entries,r())})},s=zd("event",i,{durationThreshold:e.durationThreshold!=null?e.durationThreshold:oge});r=kp(n,t,hge,e.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),Pp(()=>{i(s.takeRecords()),r(!0)}))})},pge=[2500,4e3],j8={},mge=(n,e={})=>{py(()=>{const t=$w(),r=xp("LCP");let i;const s=a=>{e.reportAllChanges||(a=a.slice(-1)),a.forEach(c=>{c.startTime<t.firstHiddenTime&&(r.value=Math.max(c.startTime-fy(),0),r.entries=[c],i())})},o=zd("largest-contentful-paint",s);if(o){i=kp(n,r,pge,e.reportAllChanges);const a=jw(()=>{j8[r.id]||(s(o.takeRecords()),o.disconnect(),j8[r.id]=!0,i(!0))});["keydown","click"].forEach(c=>{ot.document&&addEventListener(c,()=>DG(a),{once:!0,capture:!0})}),Pp(a)}})},gge=[800,1800],o3=n=>{ot.document&&ot.document.prerendering?py(()=>o3(n)):ot.document&&ot.document.readyState!=="complete"?addEventListener("load",()=>o3(n),!0):setTimeout(n,0)},vge=(n,e={})=>{const t=xp("TTFB"),r=kp(n,t,gge,e.reportAllChanges);o3(()=>{const i=hy();i&&(t.value=Math.max(i.responseStart-fy(),0),t.entries=[i],r(!0))})},Ng={},nS={};let FG,UG,jG,$G,BG;function HG(n,e=!1){return my("cls",n,wge,FG,e)}function yge(n,e=!1){return my("lcp",n,Cge,jG,e)}function _ge(n){return my("fid",n,Ege,UG)}function bge(n){return my("ttfb",n,Tge,$G)}function Sge(n){return my("inp",n,Ige,BG)}function Sv(n,e){return VG(n,e),nS[n]||(Rge(n),nS[n]=!0),GG(n,e)}function Lp(n,e){const t=Ng[n];if(!(!t||!t.length))for(const r of t)try{r(e)}catch(i){b6&&Me.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${Oc(r)}
Error:`,i)}}function wge(){return ege(n=>{Lp("cls",{metric:n}),FG=n},{reportAllChanges:!0})}function Ege(){return nge(n=>{Lp("fid",{metric:n}),UG=n})}function Cge(){return mge(n=>{Lp("lcp",{metric:n}),jG=n},{reportAllChanges:!0})}function Tge(){return vge(n=>{Lp("ttfb",{metric:n}),$G=n})}function Ige(){return fge(n=>{Lp("inp",{metric:n}),BG=n})}function my(n,e,t,r,i=!1){VG(n,e);let s;return nS[n]||(s=t(),nS[n]=!0),r&&e({metric:r}),GG(n,e,i?s:void 0)}function Rge(n){const e={};n==="event"&&(e.durationThreshold=0),zd(n,t=>{Lp(n,{entries:t})},e)}function VG(n,e){Ng[n]=Ng[n]||[],Ng[n].push(e)}function GG(n,e,t){return()=>{t&&t();const r=Ng[n];if(!r)return;const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}function kge(n){return"duration"in n}function EI(n){return typeof n=="number"&&isFinite(n)}function Fc(n,e,t,{...r}){const i=Gt(n).start_timestamp;return i&&i>e&&typeof n.updateStartTime=="function"&&n.updateStartTime(e),mG(n,()=>{const s=dy({startTime:e,...r});return s&&s.end(t),s})}function qG(n){const e=qt();if(!e)return;const{name:t,transaction:r,attributes:i,startTime:s}=n,{release:o,environment:a}=e.getOptions(),c=e.getIntegrationByName("Replay"),l=c&&c.getReplayId(),u=cn(),h=u.getUser(),p=h!==void 0?h.email||h.id||h.ip_address:void 0;let m;try{m=u.getScopeData().contexts.profile.profile_id}catch{}const v={release:o,environment:a,user:p||void 0,profile_id:m||void 0,replay_id:l||void 0,transaction:r,"user_agent.original":ot.navigator&&ot.navigator.userAgent,...i};return dy({name:t,attributes:v,startTime:s,experimental:{standalone:!0}})}function S6(){return ot&&ot.addEventListener&&ot.performance}function Wn(n){return n/1e3}function KG(n){let e="unknown",t="unknown",r="";for(const i of n){if(i==="/"){[e,t]=n.split("/");break}if(!isNaN(Number(i))){e=r==="h"?"http":r,t=n.split(r)[1];break}r+=i}return r===n&&(e=r),{name:e,version:t}}function xge(){let n=0,e,t;if(!Lge())return;let r=!1;function i(){r||(r=!0,t&&Pge(n,e,t),s())}const s=HG(({metric:o})=>{const a=o.entries[o.entries.length-1];a&&(n=o.value,e=a)},!0);Pp(()=>{i()}),setTimeout(()=>{const o=qt();if(!o)return;const a=o.on("startNavigationSpan",()=>{i(),a&&a()}),c=Zr(),l=c&&Jr(c),u=l&&Gt(l);u&&u.op==="pageload"&&(t=l.spanContext().spanId)},0)}function Pge(n,e,t){b6&&Me.log(`Sending CLS span (${n})`);const r=Wn((ns||0)+(e&&e.startTime||0)),i=cn().getScopeData().transactionName,s=e?Pd(e.sources[0]&&e.sources[0].node):"Layout shift",o=Xr({[or]:"auto.http.browser.cls",[Dc]:"ui.webvital.cls",[f6]:e&&e.duration||0,"sentry.pageload.span_id":t}),a=qG({name:s,transaction:i,attributes:o,startTime:r});a&&(a.addEvent("cls",{[Dw]:"",[Fw]:n}),a.end(r))}function Lge(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const Age=2147483647;let $8=0,Hr={},ji,Dg;function Mge({recordClsStandaloneSpans:n}){const e=S6();if(e&&ns){e.mark&&ot.performance.mark("sentry-tracing-init");const t=jge(),r=Uge(),i=$ge(),s=n?xge():Fge();return()=>{t(),r(),i(),s&&s()}}return()=>{}}function Oge(){Sv("longtask",({entries:n})=>{const e=Zr();if(!e)return;const{op:t,start_timestamp:r}=Gt(e);for(const i of n){const s=Wn(ns+i.startTime),o=Wn(i.duration);t==="navigation"&&r&&s<r||Fc(e,s,s+o,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[or]:"auto.ui.browser.metrics"}})}})}function Nge(){new PerformanceObserver(e=>{const t=Zr();if(t)for(const r of e.getEntries()){if(!r.scripts[0])continue;const i=Wn(ns+r.startTime),{start_timestamp:s,op:o}=Gt(t);if(o==="navigation"&&s&&i<s)continue;const a=Wn(r.duration),c={[or]:"auto.ui.browser.metrics"},l=r.scripts[0],{invoker:u,invokerType:h,sourceURL:p,sourceFunctionName:m,sourceCharPosition:v}=l;c["browser.script.invoker"]=u,c["browser.script.invoker_type"]=h,p&&(c["code.filepath"]=p),m&&(c["code.function"]=m),v!==-1&&(c["browser.script.source_char_position"]=v),Fc(t,i,i+a,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:c})}}).observe({type:"long-animation-frame",buffered:!0})}function Dge(){Sv("event",({entries:n})=>{const e=Zr();if(e){for(const t of n)if(t.name==="click"){const r=Wn(ns+t.startTime),i=Wn(t.duration),s={name:Pd(t.target),op:`ui.interaction.${t.name}`,startTime:r,attributes:{[or]:"auto.ui.browser.metrics"}},o=HV(t.target);o&&(s.attributes["ui.component_name"]=o),Fc(e,r,r+i,s)}}})}function Fge(){return HG(({metric:n})=>{const e=n.entries[n.entries.length-1];e&&(Hr.cls={value:n.value,unit:""},Dg=e)},!0)}function Uge(){return yge(({metric:n})=>{const e=n.entries[n.entries.length-1];e&&(Hr.lcp={value:n.value,unit:"millisecond"},ji=e)},!0)}function jge(){return _ge(({metric:n})=>{const e=n.entries[n.entries.length-1];if(!e)return;const t=Wn(ns),r=Wn(e.startTime);Hr.fid={value:n.value,unit:"millisecond"},Hr["mark.fid"]={value:t+r,unit:"second"}})}function $ge(){return bge(({metric:n})=>{n.entries[n.entries.length-1]&&(Hr.ttfb={value:n.value,unit:"millisecond"})})}function Bge(n,e){const t=S6();if(!t||!t.getEntries||!ns)return;const r=Wn(ns),i=t.getEntries(),{op:s,start_timestamp:o}=Gt(n);if(i.slice($8).forEach(a=>{const c=Wn(a.startTime),l=Wn(Math.max(0,a.duration));if(!(s==="navigation"&&o&&r+c<o))switch(a.entryType){case"navigation":{Vge(n,a,r);break}case"mark":case"paint":case"measure":{Hge(n,a,c,l,r);const u=$w(),h=a.startTime<u.firstHiddenTime;a.name==="first-paint"&&h&&(Hr.fp={value:a.startTime,unit:"millisecond"}),a.name==="first-contentful-paint"&&h&&(Hr.fcp={value:a.startTime,unit:"millisecond"});break}case"resource":{Kge(n,a,a.name,c,l,r);break}}}),$8=Math.max(i.length-1,0),Wge(n),s==="pageload"){Yge(Hr);const a=Hr["mark.fid"];a&&Hr.fid&&(Fc(n,a.value,a.value+Wn(Hr.fid.value),{name:"first input delay",op:"ui.action",attributes:{[or]:"auto.ui.browser.metrics"}}),delete Hr["mark.fid"]),(!("fcp"in Hr)||!e.recordClsOnPageloadSpan)&&delete Hr.cls,Object.entries(Hr).forEach(([c,l])=>{$fe(c,l.value,l.unit)}),n.setAttribute("performance.timeOrigin",r),n.setAttribute("performance.activationStart",fy()),zge(n)}ji=void 0,Dg=void 0,Hr={}}function Hge(n,e,t,r,i){const s=hy(!1),o=Wn(s?s.requestStart:0),a=i+Math.max(t,o),c=i+t,l=c+r,u={[or]:"auto.resource.browser.metrics"};return a!==c&&(u["sentry.browser.measure_happened_before_request"]=!0,u["sentry.browser.measure_start_time"]=a),Fc(n,a,l,{name:e.name,op:e.entryType,attributes:u}),a}function Vge(n,e,t){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{S1(n,e,r,t)}),S1(n,e,"secureConnection",t,"TLS/SSL"),S1(n,e,"fetch",t,"cache"),S1(n,e,"domainLookup",t,"DNS"),qge(n,e,t)}function S1(n,e,t,r,i=t){const s=Gge(t),o=e[s],a=e[`${t}Start`];!a||!o||Fc(n,r+Wn(a),r+Wn(o),{op:`browser.${i}`,name:e.name,attributes:{[or]:"auto.ui.browser.metrics"}})}function Gge(n){return n==="secureConnection"?"connectEnd":n==="fetch"?"domainLookupStart":`${n}End`}function qge(n,e,t){const r=t+Wn(e.requestStart),i=t+Wn(e.responseEnd),s=t+Wn(e.responseStart);e.responseEnd&&(Fc(n,r,i,{op:"browser.request",name:e.name,attributes:{[or]:"auto.ui.browser.metrics"}}),Fc(n,s,i,{op:"browser.response",name:e.name,attributes:{[or]:"auto.ui.browser.metrics"}}))}function Kge(n,e,t,r,i,s){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const o=yd(t),a={[or]:"auto.resource.browser.metrics"};CI(a,e,"transferSize","http.response_transfer_size"),CI(a,e,"encodedBodySize","http.response_content_length"),CI(a,e,"decodedBodySize","http.decoded_response_content_length");const c=e.deliveryType;c!=null&&(a["http.response_delivery_type"]=c);const l=e.renderBlockingStatus;l&&(a["resource.render_blocking_status"]=l),o.protocol&&(a["url.scheme"]=o.protocol.split(":").pop()),o.host&&(a["server.address"]=o.host),a["url.same_origin"]=t.includes(ot.location.origin);const{name:u,version:h}=KG(e.nextHopProtocol);a["network.protocol.name"]=u,a["network.protocol.version"]=h;const p=s+r,m=p+i;Fc(n,p,m,{name:t.replace(ot.location.origin,""),op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",attributes:a})}function Wge(n){const e=ot.navigator;if(!e)return;const t=e.connection;t&&(t.effectiveType&&n.setAttribute("effectiveConnectionType",t.effectiveType),t.type&&n.setAttribute("connectionType",t.type),EI(t.rtt)&&(Hr["connection.rtt"]={value:t.rtt,unit:"millisecond"})),EI(e.deviceMemory)&&n.setAttribute("deviceMemory",`${e.deviceMemory} GB`),EI(e.hardwareConcurrency)&&n.setAttribute("hardwareConcurrency",String(e.hardwareConcurrency))}function zge(n){ji&&(ji.element&&n.setAttribute("lcp.element",Pd(ji.element)),ji.id&&n.setAttribute("lcp.id",ji.id),ji.url&&n.setAttribute("lcp.url",ji.url.trim().slice(0,200)),ji.loadTime!=null&&n.setAttribute("lcp.loadTime",ji.loadTime),ji.renderTime!=null&&n.setAttribute("lcp.renderTime",ji.renderTime),n.setAttribute("lcp.size",ji.size)),Dg&&Dg.sources&&Dg.sources.forEach((e,t)=>n.setAttribute(`cls.source.${t+1}`,Pd(e.node)))}function CI(n,e,t,r){const i=e[t];i!=null&&i<Age&&(n[r]=i)}function Yge(n){const e=hy(!1);if(!e)return;const{responseStart:t,requestStart:r}=e;r<=t&&(n["ttfb.requestTime"]={value:t-r,unit:"millisecond"})}const Xge=1e3;let B8,a3,c3;function Jge(n){const e="dom";vu(e,n),yu(e,Zge)}function Zge(){if(!ot.document)return;const n=Xs.bind(null,"dom"),e=H8(n,!0);ot.document.addEventListener("click",e,!1),ot.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(t=>{const i=ot[t],s=i&&i.prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(ws(s,"addEventListener",function(o){return function(a,c,l){if(a==="click"||a=="keypress")try{const u=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},h=u[a]=u[a]||{refCount:0};if(!h.handler){const p=H8(n);h.handler=p,o.call(this,a,p,l)}h.refCount++}catch{}return o.call(this,a,c,l)}}),ws(s,"removeEventListener",function(o){return function(a,c,l){if(a==="click"||a=="keypress")try{const u=this.__sentry_instrumentation_handlers__||{},h=u[a];h&&(h.refCount--,h.refCount<=0&&(o.call(this,a,h.handler,l),h.handler=void 0,delete u[a]),Object.keys(u).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return o.call(this,a,c,l)}}))})}function Qge(n){if(n.type!==a3)return!1;try{if(!n.target||n.target._sentryId!==c3)return!1}catch{}return!0}function eve(n,e){return n!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function H8(n,e=!1){return t=>{if(!t||t._sentryCaptured)return;const r=tve(t);if(eve(t.type,r))return;no(t,"_sentryCaptured",!0),r&&!r._sentryId&&no(r,"_sentryId",Js());const i=t.type==="keypress"?"input":t.type;Qge(t)||(n({event:t,name:i,global:e}),a3=t.type,c3=r?r._sentryId:void 0),clearTimeout(B8),B8=ot.setTimeout(()=>{c3=void 0,a3=void 0},Xge)}}function tve(n){try{return n.target}catch{return null}}let w1;function w6(n){const e="history";vu(e,n),yu(e,nve)}function nve(){if(!Pme())return;const n=ot.onpopstate;ot.onpopstate=function(...t){const r=ot.location.href,i=w1;if(w1=r,Xs("history",{from:i,to:r}),n)try{return n.apply(this,t)}catch{}};function e(t){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const s=w1,o=String(i);w1=o,Xs("history",{from:s,to:o})}return t.apply(this,r)}}ws(ot.history,"pushState",e),ws(ot.history,"replaceState",e)}const V_={};function rve(n){const e=V_[n];if(e)return e;let t=ot[n];if(t3(t))return V_[n]=t.bind(ot);const r=ot.document;if(r&&typeof r.createElement=="function")try{const i=r.createElement("iframe");i.hidden=!0,r.head.appendChild(i);const s=i.contentWindow;s&&s[n]&&(t=s[n]),r.head.removeChild(i)}catch(i){b6&&Me.warn(`Could not create sandbox iframe for ${n} check, bailing to window.${n}: `,i)}return t&&(V_[n]=t.bind(ot))}function V8(n){V_[n]=void 0}const df="__sentry_xhr_v3__";function WG(n){const e="xhr";vu(e,n),yu(e,ive)}function ive(){if(!ot.XMLHttpRequest)return;const n=XMLHttpRequest.prototype;n.open=new Proxy(n.open,{apply(e,t,r){const i=new Error,s=wi()*1e3,o=Ec(r[0])?r[0].toUpperCase():void 0,a=sve(r[1]);if(!o||!a)return e.apply(t,r);t[df]={method:o,url:a,request_headers:{}},o==="POST"&&a.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const c=()=>{const l=t[df];if(l&&t.readyState===4){try{l.status_code=t.status}catch{}const u={endTimestamp:wi()*1e3,startTimestamp:s,xhr:t,virtualError:i};Xs("xhr",u)}};return"onreadystatechange"in t&&typeof t.onreadystatechange=="function"?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply(l,u,h){return c(),l.apply(u,h)}}):t.addEventListener("readystatechange",c),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(l,u,h){const[p,m]=h,v=u[df];return v&&Ec(p)&&Ec(m)&&(v.request_headers[p.toLowerCase()]=m),l.apply(u,h)}}),e.apply(t,r)}}),n.send=new Proxy(n.send,{apply(e,t,r){const i=t[df];if(!i)return e.apply(t,r);r[0]!==void 0&&(i.body=r[0]);const s={startTimestamp:wi()*1e3,xhr:t};return Xs("xhr",s),e.apply(t,r)}})}function sve(n){if(Ec(n))return n;try{return n.toString()}catch{}}const TI=[],G_=new Map;function ove(){if(S6()&&ns){const e=ave();return()=>{e()}}return()=>{}}const G8={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function ave(){return Sge(({metric:n})=>{if(n.value==null)return;const e=n.entries.find(v=>v.duration===n.value&&G8[v.name]);if(!e)return;const{interactionId:t}=e,r=G8[e.name],i=Wn(ns+e.startTime),s=Wn(n.value),o=Zr(),a=o?Jr(o):void 0,l=(t!=null?G_.get(t):void 0)||a,u=l?Gt(l).description:cn().getScopeData().transactionName,h=Pd(e.target),p=Xr({[or]:"auto.http.browser.inp",[Dc]:`ui.interaction.${r}`,[f6]:e.duration}),m=qG({name:h,transaction:u,attributes:p,startTime:i});m&&(m.addEvent("inp",{[Dw]:"millisecond",[Fw]:n.value}),m.end(i+s))})}function cve(n){const e=({entries:t})=>{const r=Zr(),i=r&&Jr(r);t.forEach(s=>{if(!kge(s)||!i)return;const o=s.interactionId;if(o!=null&&!G_.has(o)){if(TI.length>10){const a=TI.shift();G_.delete(a)}TI.push(o),G_.set(o,i)}})};Sv("event",e),Sv("first-input",e)}function lve(n,e=rve("fetch")){let t=0,r=0;function i(s){const o=s.body.length;t+=o,r++;const a={body:s.body,method:"POST",referrerPolicy:"origin",headers:n.headers,keepalive:t<=6e4&&r<15,...n.fetchOptions};if(!e)return V8("fetch"),Zb("No fetch implementation available");try{return e(n.url,a).then(c=>(t-=o,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return V8("fetch"),t-=o,r--,Zb(c)}}return Bpe(n,i)}const uve=30,dve=50;function l3(n,e,t,r){const i={filename:n,function:e==="<anonymous>"?xd:e,in_app:!0};return t!==void 0&&(i.lineno=t),r!==void 0&&(i.colno=r),i}const hve=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,fve=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,pve=/\((\S*)(?::(\d+))(?::(\d+))\)/,mve=n=>{const e=hve.exec(n);if(e){const[,r,i,s]=e;return l3(r,xd,+i,+s)}const t=fve.exec(n);if(t){if(t[2]&&t[2].indexOf("eval")===0){const o=pve.exec(t[2]);o&&(t[2]=o[1],t[3]=o[2],t[4]=o[3])}const[i,s]=zG(t[1]||xd,t[2]);return l3(s,i,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}},gve=[uve,mve],vve=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,yve=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,_ve=n=>{const e=vve.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const s=yve.exec(e[3]);s&&(e[1]=e[1]||"eval",e[3]=s[1],e[4]=s[2],e[5]="")}let r=e[3],i=e[1]||xd;return[i,r]=zG(i,r),l3(r,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},bve=[dve,_ve],Sve=[gve,bve],wve=DV(...Sve),zG=(n,e)=>{const t=n.indexOf("safari-extension")!==-1,r=n.indexOf("safari-web-extension")!==-1;return t||r?[n.indexOf("@")!==-1?n.split("@")[0]:xd,t?`safari-extension:${e}`:`safari-web-extension:${e}`]:[n,e]},E1=1024,Eve="Breadcrumbs",Cve=(n={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...n};return{name:Eve,setup(t){e.console&&lme(kve(t)),e.dom&&Jge(Rve(t,e.dom)),e.xhr&&WG(xve(t)),e.fetch&&LG(Pve(t)),e.history&&w6(Lve(t)),e.sentry&&t.on("beforeSendEvent",Ive(t))}}},Tve=Cve;function Ive(n){return function(t){qt()===n&&Ad({category:`sentry.${t.type==="transaction"?"transaction":"event"}`,event_id:t.event_id,level:t.level,message:Tl(t)},{event:t})}}function Rve(n,e){return function(r){if(qt()!==n)return;let i,s,o=typeof e=="object"?e.serializeAttribute:void 0,a=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;a&&a>E1&&(Cs&&Me.warn(`\`dom.maxStringLength\` cannot exceed ${E1}, but a value of ${a} was configured. Sentry will use ${E1} instead.`),a=E1),typeof o=="string"&&(o=[o]);try{const l=r.event,u=Ave(l)?l.target:l;i=Pd(u,{keyAttrs:o,maxStringLength:a}),s=HV(u)}catch{i="<unknown>"}if(i.length===0)return;const c={category:`ui.${r.name}`,message:i};s&&(c.data={"ui.component_name":s}),Ad(c,{event:r.event,name:r.name,global:r.global})}}function kve(n){return function(t){if(qt()!==n)return;const r={category:"console",data:{arguments:t.args,logger:"console"},level:dme(t.level),message:s8(t.args," ")};if(t.level==="assert")if(t.args[0]===!1)r.message=`Assertion failed: ${s8(t.args.slice(1)," ")||"console.assert"}`,r.data.arguments=t.args.slice(1);else return;Ad(r,{input:t.args,level:t.level})}}function xve(n){return function(t){if(qt()!==n)return;const{startTimestamp:r,endTimestamp:i}=t,s=t.xhr[df];if(!r||!i||!s)return;const{method:o,url:a,status_code:c,body:l}=s,u={method:o,url:a,status_code:c},h={xhr:t.xhr,input:l,startTimestamp:r,endTimestamp:i},p=xG(c);Ad({category:"xhr",data:u,type:"http",level:p},h)}}function Pve(n){return function(t){if(qt()!==n)return;const{startTimestamp:r,endTimestamp:i}=t;if(i&&!(t.fetchData.url.match(/sentry_key/)&&t.fetchData.method==="POST"))if(t.error){const s=t.fetchData,o={data:t.error,input:t.args,startTimestamp:r,endTimestamp:i};Ad({category:"fetch",data:s,level:"error",type:"http"},o)}else{const s=t.response,o={...t.fetchData,status_code:s&&s.status},a={input:t.args,response:s,startTimestamp:r,endTimestamp:i},c=xG(o.status_code);Ad({category:"fetch",data:o,type:"http",level:c},a)}}}function Lve(n){return function(t){if(qt()!==n)return;let r=t.from,i=t.to;const s=yd(rt.location.href);let o=r?yd(r):void 0;const a=yd(i);(!o||!o.path)&&(o=s),s.protocol===a.protocol&&s.host===a.host&&(i=a.relative),s.protocol===o.protocol&&s.host===o.host&&(r=o.relative),Ad({category:"navigation",data:{from:r,to:i}})}}function Ave(n){return!!n&&!!n.target}const Mve=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Ove="BrowserApiErrors",Nve=(n={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...n};return{name:Ove,setupOnce(){e.setTimeout&&ws(rt,"setTimeout",q8),e.setInterval&&ws(rt,"setInterval",q8),e.requestAnimationFrame&&ws(rt,"requestAnimationFrame",Fve),e.XMLHttpRequest&&"XMLHttpRequest"in rt&&ws(XMLHttpRequest.prototype,"send",Uve);const t=e.eventTarget;t&&(Array.isArray(t)?t:Mve).forEach(jve)}}},Dve=Nve;function q8(n){return function(...e){const t=e[0];return e[0]=Qf(t,{mechanism:{data:{function:Oc(n)},handled:!1,type:"instrument"}}),n.apply(this,e)}}function Fve(n){return function(e){return n.apply(this,[Qf(e,{mechanism:{data:{function:"requestAnimationFrame",handler:Oc(n)},handled:!1,type:"instrument"}})])}}function Uve(n){return function(...e){const t=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(i=>{i in t&&typeof t[i]=="function"&&ws(t,i,function(s){const o={mechanism:{data:{function:i,handler:Oc(s)},handled:!1,type:"instrument"}},a=d6(s);return a&&(o.mechanism.data.handler=Oc(a)),Qf(s,o)})}),n.apply(this,e)}}function jve(n){const t=rt[n],r=t&&t.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(ws(r,"addEventListener",function(i){return function(s,o,a){try{$ve(o)&&(o.handleEvent=Qf(o.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Oc(o),target:n},handled:!1,type:"instrument"}}))}catch{}return i.apply(this,[s,Qf(o,{mechanism:{data:{function:"addEventListener",handler:Oc(o),target:n},handled:!1,type:"instrument"}}),a])}}),ws(r,"removeEventListener",function(i){return function(s,o,a){try{const c=o.__sentry_wrapped__;c&&i.call(this,s,c,a)}catch{}return i.call(this,s,o,a)}}))}function $ve(n){return typeof n.handleEvent=="function"}const Bve=()=>({name:"BrowserSession",setupOnce(){if(typeof rt.document>"u"){Cs&&Me.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.");return}I8({ignoreDuration:!0}),R8(),w6(({from:n,to:e})=>{n!==void 0&&n!==e&&(I8({ignoreDuration:!0}),R8())})}}),Hve="GlobalHandlers",Vve=(n={})=>{const e={onerror:!0,onunhandledrejection:!0,...n};return{name:Hve,setupOnce(){Error.stackTraceLimit=50},setup(t){e.onerror&&(qve(t),K8("onerror")),e.onunhandledrejection&&(Kve(t),K8("onunhandledrejection"))}}},Gve=Vve;function qve(n){FV(e=>{const{stackParser:t,attachStacktrace:r}=YG();if(qt()!==n||MG())return;const{msg:i,url:s,line:o,column:a,error:c}=e,l=Yve(_6(t,c||i,void 0,r,!1),s,o,a);l.level="error",yG(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})}function Kve(n){UV(e=>{const{stackParser:t,attachStacktrace:r}=YG();if(qt()!==n||MG())return;const i=Wve(e),s=u6(i)?zve(i):_6(t,i,void 0,r,!0);s.level="error",yG(s,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function Wve(n){if(u6(n))return n;try{if("reason"in n)return n.reason;if("detail"in n&&"reason"in n.detail)return n.detail.reason}catch{}return n}function zve(n){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(n)}`}]}}}function Yve(n,e,t,r){const i=n.exception=n.exception||{},s=i.values=i.values||[],o=s[0]=s[0]||{},a=o.stacktrace=o.stacktrace||{},c=a.frames=a.frames||[],l=r,u=t,h=Ec(e)&&e.length>0?e:Mhe();return c.length===0&&c.push({colno:l,filename:h,function:xd,in_app:!0,lineno:u}),n}function K8(n){Cs&&Me.log(`Global Handler attached: ${n}`)}function YG(){const n=qt();return n&&n.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const Xve=()=>({name:"HttpContext",preprocessEvent(n){if(!rt.navigator&&!rt.location&&!rt.document)return;const e=n.request&&n.request.url||rt.location&&rt.location.href,{referrer:t}=rt.document||{},{userAgent:r}=rt.navigator||{},i={...n.request&&n.request.headers,...t&&{Referer:t},...r&&{"User-Agent":r}},s={...n.request,...e&&{url:e},headers:i};n.request=s}}),Jve="cause",Zve=5,Qve="LinkedErrors",eye=(n={})=>{const e=n.limit||Zve,t=n.key||Jve;return{name:Qve,preprocessEvent(r,i,s){const o=s.getOptions();ame(v6,o.stackParser,o.maxValueLength,t,e,r,i)}}},tye=eye;function nye(n){const e=[Xpe(),Kpe(),Dve(),Tve(),Gve(),tye(),pme(),Xve()];return n.autoSessionTracking!==!1&&e.push(Bve()),e}function rye(n={}){const e={defaultIntegrations:nye(n),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:rt.SENTRY_RELEASE&&rt.SENTRY_RELEASE.id?rt.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return n.defaultIntegrations==null&&delete n.defaultIntegrations,{...e,...n}}function iye(){const n=typeof rt.window<"u"&&rt;if(!n)return!1;const e=n.chrome?"chrome":"browser",t=n[e],r=t&&t.runtime&&t.runtime.id,i=rt.location&&rt.location.href||"",s=["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"],o=!!r&&rt===rt.top&&s.some(c=>i.startsWith(`${c}//`)),a=typeof n.nw<"u";return!!r&&!o&&!a}function sye(n={}){const e=rye(n);if(!e.skipBrowserExtensionCheck&&iye()){qd(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}Cs&&(PG()||Me.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const t={...e,stackParser:Ehe(e.stackParser||wve),integrations:Ipe(e),transport:e.transport||lve};return Ape(qme,t)}function W8(n={}){if(!rt.document){Cs&&Me.error("Global document not defined in showReportDialog call");return}const e=cn(),t=e.getClient(),r=t&&t.getDsn();if(!r){Cs&&Me.error("DSN not configured for showReportDialog call");return}if(e&&(n.user={...e.getUser(),...n.user}),!n.eventId){const a=ype();a&&(n.eventId=a)}const i=rt.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=Cpe(r,n),n.onLoad&&(i.onload=n.onLoad);const{onClose:s}=n;if(s){const a=c=>{if(c.data==="__sentry_reportdialog_closed__")try{s()}finally{rt.removeEventListener("message",a)}};rt.addEventListener("message",a)}const o=rt.document.head||rt.document.body;o?o.appendChild(i):Cs&&Me.error("Not injecting report dialog. No injection point found in HTML")}const z8=new WeakMap,II=new Map,q_={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function oye(n,e){const{traceFetch:t,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:s,enableHTTPTimings:o,tracePropagationTargets:a}={traceFetch:q_.traceFetch,traceXHR:q_.traceXHR,trackFetchStreamPerformance:q_.trackFetchStreamPerformance,...e},c=typeof s=="function"?s:h=>!0,l=h=>lye(h,a),u={};t&&(n.addEventProcessor(h=>(h.type==="transaction"&&h.spans&&h.spans.forEach(p=>{if(p.op==="http.client"){const m=II.get(p.span_id);m&&(p.timestamp=m/1e3,II.delete(p.span_id))}}),h)),i&&Tme(h=>{if(h.response){const p=z8.get(h.response);p&&h.endTimestamp&&II.set(p,h.endTimestamp)}}),LG(h=>{const p=yme(h,c,l,u);if(h.response&&h.fetchData.__span&&z8.set(h.response,h.fetchData.__span),p){const m=XG(h.fetchData.url),v=m?yd(m).host:void 0;p.setAttributes({"http.url":m,"server.address":v})}o&&p&&Y8(p)})),r&&WG(h=>{const p=uye(h,c,l,u);o&&p&&Y8(p)})}function aye(n){return n.entryType==="resource"&&"initiatorType"in n&&typeof n.nextHopProtocol=="string"&&(n.initiatorType==="fetch"||n.initiatorType==="xmlhttprequest")}function Y8(n){const{url:e}=Gt(n).data||{};if(!e||typeof e!="string")return;const t=Sv("resource",({entries:r})=>{r.forEach(i=>{aye(i)&&i.name.endsWith(e)&&(cye(i).forEach(o=>n.setAttribute(...o)),setTimeout(t))})})}function ra(n=0){return((ns||performance.timeOrigin)+n)/1e3}function cye(n){const{name:e,version:t}=KG(n.nextHopProtocol),r=[];return r.push(["network.protocol.version",t],["network.protocol.name",e]),ns?[...r,["http.request.redirect_start",ra(n.redirectStart)],["http.request.fetch_start",ra(n.fetchStart)],["http.request.domain_lookup_start",ra(n.domainLookupStart)],["http.request.domain_lookup_end",ra(n.domainLookupEnd)],["http.request.connect_start",ra(n.connectStart)],["http.request.secure_connection_start",ra(n.secureConnectionStart)],["http.request.connection_end",ra(n.connectEnd)],["http.request.request_start",ra(n.requestStart)],["http.request.response_start",ra(n.responseStart)],["http.request.response_end",ra(n.responseEnd)]]:r}function lye(n,e){const t=rt.location&&rt.location.href;if(t){let r,i;try{r=new URL(n,t),i=new URL(t).origin}catch{return!1}const s=r.origin===i;return e?md(r.toString(),e)||s&&md(r.pathname,e):s}else{const r=!!n.match(/^\/(?!\/)/);return e?md(n,e):r}}function uye(n,e,t,r){const i=n.xhr,s=i&&i[df];if(!i||i.__sentry_own_request__||!s)return;const o=su()&&e(s.url);if(n.endTimestamp&&o){const h=i.__sentry_xhr_span_id__;if(!h)return;const p=r[h];p&&s.status_code!==void 0&&(YV(p,s.status_code),p.end(),delete r[h]);return}const a=XG(s.url),c=a?yd(a).host:void 0,l=!!Zr(),u=o&&l?dy({name:`${s.method} ${s.url}`,attributes:{type:"xhr","http.method":s.method,"http.url":a,url:s.url,"server.address":c,[or]:"auto.http.browser",[Dc]:"http.client"}}):new Cp;return i.__sentry_xhr_span_id__=u.spanContext().spanId,r[i.__sentry_xhr_span_id__]=u,t(s.url)&&dye(i,su()&&l?u:void 0),u}function dye(n,e){const{"sentry-trace":t,baggage:r}=IG({span:e});t&&hye(n,t,r)}function hye(n,e,t){try{n.setRequestHeader("sentry-trace",e),t&&n.setRequestHeader("baggage",t)}catch{}}function XG(n){try{return new URL(n,rt.location.origin).href}catch{return}}function fye(){rt&&rt.document?rt.document.addEventListener("visibilitychange",()=>{const n=Zr();if(!n)return;const e=Jr(n);if(rt.document.hidden&&e){const t="cancelled",{op:r,status:i}=Gt(e);Cs&&Me.log(`[Tracing] Transaction: ${t} -> since tab moved to the background, op: ${r}`),i||e.setStatus({code:Ir,message:t}),e.setAttribute("sentry.cancellation_reason","document.hidden"),e.end()}}):Cs&&Me.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const pye="BrowserTracing",mye={...H_,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...q_},gye=(n={})=>{mfe();const{enableInp:e,enableLongTask:t,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:s},beforeStartSpan:o,idleTimeout:a,finalTimeout:c,childSpanTimeout:l,markBackgroundSpan:u,traceFetch:h,traceXHR:p,trackFetchStreamPerformance:m,shouldCreateSpanForRequest:v,enableHTTPTimings:g,instrumentPageLoad:S,instrumentNavigation:b}={...mye,...n},R=Mge({recordClsStandaloneSpans:s||!1});e&&ove(),r&&jt.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?Nge():t&&Oge(),i&&Dge();const k={name:void 0,source:void 0};function I(T,C){const P=C.op==="pageload",M=o?o(C):C,D=M.attributes||{};C.name!==M.name&&(D[Ws]="custom",M.attributes=D),k.name=M.name,k.source=D[Ws];const F=vG(M,{idleTimeout:a,finalTimeout:c,childSpanTimeout:l,disableAutoFinish:P,beforeSpanEnd:B=>{R(),Bge(B,{recordClsOnPageloadSpan:!s})}});function U(){["interactive","complete"].includes(rt.document.readyState)&&T.emit("idleSpanEnableAutoFinish",F)}return P&&rt.document&&(rt.document.addEventListener("readystatechange",()=>{U()}),U()),F}return{name:pye,afterAllSetup(T){let C,P=rt.location&&rt.location.href;function M(){C&&!Gt(C).timestamp&&(Cs&&Me.log(`[Tracing] Finishing current active span with op: ${Gt(C).op}`),C.end())}T.on("startNavigationSpan",D=>{qt()===T&&(M(),C=I(T,{op:"navigation",...D}))}),T.on("startPageLoadSpan",(D,F={})=>{if(qt()!==T)return;M();const U=F.sentryTrace||X8("sentry-trace"),B=F.baggage||X8("baggage"),V=cfe(U,B);cn().setPropagationContext(V),C=I(T,{op:"pageload",...D})}),T.on("spanEnd",D=>{const F=Gt(D).op;if(D!==Jr(D)||F!=="navigation"&&F!=="pageload")return;const U=cn(),B=U.getPropagationContext();U.setPropagationContext({...B,sampled:B.sampled!==void 0?B.sampled:Wd(D),dsc:B.dsc||Tp(D)})}),rt.location&&(S&&JG(T,{name:rt.location.pathname,startTime:ns?ns/1e3:void 0,attributes:{[Ws]:"url",[or]:"auto.pageload.browser"}}),b&&w6(({to:D,from:F})=>{if(F===void 0&&P&&P.indexOf(D)!==-1){P=void 0;return}F!==D&&(P=void 0,ZG(T,{name:rt.location.pathname,attributes:{[Ws]:"url",[or]:"auto.navigation.browser"}}))})),u&&fye(),i&&vye(a,c,l,k),e&&cve(),oye(T,{traceFetch:h,traceXHR:p,trackFetchStreamPerformance:m,tracePropagationTargets:T.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:v,enableHTTPTimings:g})}}};function JG(n,e,t){n.emit("startPageLoadSpan",e,t),cn().setTransactionName(e.name);const r=Zr();return(r&&Gt(r).op)==="pageload"?r:void 0}function ZG(n,e){ja().setPropagationContext({traceId:nu()}),cn().setPropagationContext({traceId:nu()}),n.emit("startNavigationSpan",e),cn().setTransactionName(e.name);const t=Zr();return(t&&Gt(t).op)==="navigation"?t:void 0}function X8(n){const e=Ohe(`meta[name=${n}]`);return e?e.getAttribute("content"):void 0}function vye(n,e,t,r){let i;const s=()=>{const o="ui.action.click",a=Zr(),c=a&&Jr(a);if(c){const l=Gt(c).op;if(["navigation","pageload"].includes(l)){Cs&&Me.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`);return}}if(i&&(i.setAttribute(Wk,"interactionInterrupted"),i.end(),i=void 0),!r.name){Cs&&Me.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}i=vG({name:r.name,op:o,attributes:{[Ws]:r.source||"url"}},{idleTimeout:n,finalTimeout:e,childSpanTimeout:t})};rt.document&&addEventListener("click",s,{once:!1,capture:!0})}function yye(n){const e={...n};return TG(e,"react"),vpe("react",{version:_.version}),sye(e)}function _ye(n){const e=n.match(/^([^.]+)/);return e!==null&&parseInt(e[0])>=17}function bye(n,e){const t=new WeakSet;function r(i,s){if(!t.has(i)){if(i.cause)return t.add(i),r(i.cause,s);i.cause=s}}r(n,e)}function Sye(n,{componentStack:e},t){if(_ye(_.version)&&Lw(n)&&e){const r=new Error(n.message);r.name=`React ErrorBoundary ${n.name}`,r.stack=e,bye(n,r)}return Uw(n,{...t,captureContext:{contexts:{react:{componentStack:e}}}})}var RI={exports:{}},Kt={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J8;function wye(){if(J8)return Kt;J8=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,t=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,i=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,o=n?Symbol.for("react.provider"):60109,a=n?Symbol.for("react.context"):60110,c=n?Symbol.for("react.async_mode"):60111,l=n?Symbol.for("react.concurrent_mode"):60111,u=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,p=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,S=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,R=n?Symbol.for("react.scope"):60119;function k(T){if(typeof T=="object"&&T!==null){var C=T.$$typeof;switch(C){case e:switch(T=T.type,T){case c:case l:case r:case s:case i:case h:return T;default:switch(T=T&&T.$$typeof,T){case a:case u:case v:case m:case o:return T;default:return C}}case t:return C}}}function I(T){return k(T)===l}return Kt.AsyncMode=c,Kt.ConcurrentMode=l,Kt.ContextConsumer=a,Kt.ContextProvider=o,Kt.Element=e,Kt.ForwardRef=u,Kt.Fragment=r,Kt.Lazy=v,Kt.Memo=m,Kt.Portal=t,Kt.Profiler=s,Kt.StrictMode=i,Kt.Suspense=h,Kt.isAsyncMode=function(T){return I(T)||k(T)===c},Kt.isConcurrentMode=I,Kt.isContextConsumer=function(T){return k(T)===a},Kt.isContextProvider=function(T){return k(T)===o},Kt.isElement=function(T){return typeof T=="object"&&T!==null&&T.$$typeof===e},Kt.isForwardRef=function(T){return k(T)===u},Kt.isFragment=function(T){return k(T)===r},Kt.isLazy=function(T){return k(T)===v},Kt.isMemo=function(T){return k(T)===m},Kt.isPortal=function(T){return k(T)===t},Kt.isProfiler=function(T){return k(T)===s},Kt.isStrictMode=function(T){return k(T)===i},Kt.isSuspense=function(T){return k(T)===h},Kt.isValidElementType=function(T){return typeof T=="string"||typeof T=="function"||T===r||T===l||T===s||T===i||T===h||T===p||typeof T=="object"&&T!==null&&(T.$$typeof===v||T.$$typeof===m||T.$$typeof===o||T.$$typeof===a||T.$$typeof===u||T.$$typeof===S||T.$$typeof===b||T.$$typeof===R||T.$$typeof===g)},Kt.typeOf=k,Kt}var Z8;function Eye(){return Z8||(Z8=1,RI.exports=wye()),RI.exports}var kI,Q8;function Cye(){if(Q8)return kI;Q8=1;var n=Eye(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[n.ForwardRef]=r,s[n.Memo]=i;function o(v){return n.isMemo(v)?i:s[v.$$typeof]||e}var a=Object.defineProperty,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,p=Object.prototype;function m(v,g,S){if(typeof g!="string"){if(p){var b=h(g);b&&b!==p&&m(v,b,S)}var R=c(g);l&&(R=R.concat(l(g)));for(var k=o(v),I=o(g),T=0;T<R.length;++T){var C=R[T];if(!t[C]&&!(S&&S[C])&&!(I&&I[C])&&!(k&&k[C])){var P=u(g,C);try{a(v,C,P)}catch{}}}}return v}return kI=m,kI}var Tye=Cye();const Iye=Wo(Tye),QG=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,e9={componentStack:null,error:null,eventId:null};class Bw extends _.Component{constructor(e){super(e),Bw.prototype.__init.call(this),this.state=e9,this._openFallbackReportDialog=!0;const t=qt();t&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=t.on("afterSendEvent",r=>{!r.type&&this._lastEventId&&r.event_id===this._lastEventId&&W8({...e.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(e,t){const{componentStack:r}=t,i=r??void 0,{beforeCapture:s,onError:o,showDialog:a,dialogOptions:c}=this.props;Nw(l=>{s&&s(l,e,i);const u=this.props.handled!=null?this.props.handled:!!this.props.fallback,h=Sye(e,t,{mechanism:{handled:u}});o&&o(e,i,h),a&&(this._lastEventId=h,this._openFallbackReportDialog&&W8({...c,eventId:h})),this.setState({error:e,componentStack:r,eventId:h})})}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:t,eventId:r}=this.state,{onUnmount:i}=this.props;i&&i(e,t,r),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:t,componentStack:r,eventId:i}=this.state;e&&e(t,r,i),this.setState(e9)}}render(){const{fallback:e,children:t}=this.props,r=this.state;if(r.error){let i;return typeof e=="function"?i=_.createElement(e,{error:r.error,componentStack:r.componentStack,resetError:this.resetErrorBoundary,eventId:r.eventId}):i=e,_.isValidElement(i)?i:(e&&QG&&Me.warn("fallback did not produce a valid ReactElement"),null)}return typeof t=="function"?t():t}}let K_,W_,z_,Y_,Md,hf=!1;const eq=new WeakSet,xI=new Set;function Rye(n,e){const t=gye({...n,instrumentPageLoad:!1,instrumentNavigation:!1}),{useEffect:r,useLocation:i,useNavigationType:s,createRoutesFromChildren:o,matchRoutes:a,stripBasename:c,instrumentPageLoad:l=!0,instrumentNavigation:u=!0}=n;return{...t,setup(){K_=r,W_=i,z_=s,Md=a,Y_=o,hf=c||!1},afterAllSetup(h){t.afterAllSetup(h);const p=rt&&rt.location&&rt.location.pathname;l&&p&&JG(h,{name:p,attributes:{[Ws]:"url",[Dc]:"pageload",[or]:`auto.pageload.react.reactrouter_v${e}`}}),u&&eq.add(h)}}}function kye(n){const{location:e,routes:t,navigationType:r,version:i,matches:s,basename:o,allRoutes:a}=n,c=Array.isArray(s)?s:Md(t,e,o),l=qt();if(!(!l||!eq.has(l))&&(r==="PUSH"||r==="POP")&&c){let u,h="url";const p=nq(e,a||t);p&&(u=wv(E6(a||t,e)),h="route"),(!p||!u)&&([u,h]=iq(t,e,c,o)),ZG(l,{name:u,attributes:{[Ws]:h,[Dc]:"navigation",[or]:`auto.navigation.react.reactrouter_v${i}`}})}}function rS(n,e){if(!e||e==="/"||!n.toLowerCase().startsWith(e.toLowerCase()))return n;const t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?n:n.slice(t)||"/"}function xye(n,e,t){const r=n||hf?rS(e,t):e;return[r[r.length-1]==="/"||r.slice(-2)==="/*"?r.slice(0,-1):r,"route"]}function tq(n){return n.endsWith("*")}function t9(n,e){return tq(n)&&e.route.children&&e.route.children.length>0||!1}function Pye(n){return!!(!n.children&&n.element&&n.path&&n.path.endsWith("/*"))}function nq(n,e){const t=Md(e,n);if(t){for(const r of t)if(Pye(r.route)&&Aye(r))return!0}return!1}function rq(n,e=new Set){return e.has(n)||(e.add(n),n.children&&!n.index&&n.children.forEach(t=>{rq(t,e).forEach(i=>e.add(i))})),e}function Lye(n){return Mye(n.route.path||"")}function Aye(n){return n.params["*"]||""}function Mye(n){return n[n.length-1]==="*"?n.slice(0,-1):n}function Fg(n){return n[n.length-1]==="/"?n.slice(0,-1):n}function wv(n){return n[0]==="/"?n:`/${n}`}function E6(n,e){const t=Md(n,e);if(!t||t.length===0)return"";for(const r of t)if(r.route.path&&r.route.path!=="*"){const i=Lye(r),s=rS(e.pathname,wv(r.pathnameBase));return Fg(Fg(i||"")+wv(E6(n.filter(o=>o!==r.route),{pathname:s})))}return""}function iq(n,e,t,r=""){if(!n||n.length===0)return[hf?rS(e.pathname,r):e.pathname,"url"];let i="";if(t)for(const o of t){const a=o.route;if(a){if(a.index)return xye(i,o.pathname,r);const c=a.path;if(c&&!t9(c,o)){const l=c[0]==="/"||i[i.length-1]==="/"?c:`/${c}`;if(i=Fg(i)+wv(l),Fg(e.pathname)===Fg(r+o.pathname))return D8(i)!==D8(o.pathname)&&!tq(i)?[(hf?"":r)+l,"route"]:(t9(i,o)&&(i=i.slice(0,-1)),[(hf?"":r)+i,"route"])}}}return[hf?rS(e.pathname,r):e.pathname||"/","url"]}function Oye(n,e,t,r,i,s){const o=Array.isArray(r)?r:Md(s||t,e,i);if(o){let a,c="url";const l=nq(e,s||t);l&&(a=wv(E6(s||t,e)),c="route"),(!l||!a)&&([a,c]=iq(t,e,o,i)),cn().setTransactionName(a||"/"),n&&(n.updateName(a),n.setAttribute(Ws,c))}}function Nye(n,e){if(!K_||!W_||!z_||!Y_||!Md)return QG&&Me.warn(`reactRouterV6Instrumentation was unable to wrap Routes because of one or more missing parameters.
      useEffect: ${K_}. useLocation: ${W_}. useNavigationType: ${z_}.
      createRoutesFromChildren: ${Y_}. matchRoutes: ${Md}.`),n;const t=r=>{const i=_.useRef(!0),s=W_(),o=z_();return K_(()=>{const a=Y_(r.children);i.current?(a.forEach(c=>{rq(c).forEach(u=>{xI.add(u)})}),Oye(Dye(),s,a,void 0,void 0,Array.from(xI)),i.current=!1):kye({location:s,routes:a,navigationType:o,version:e,allRoutes:Array.from(xI)})},[s,o]),_.createElement(n,{...r})};return Iye(t,n),t}function Dye(){const n=Zr(),e=n?Jr(n):void 0;if(!e)return;const t=Gt(e).op;return t==="navigation"||t==="pageload"?e:void 0}function Fye(n){return Rye(n,"7")}function Uye(n){return Nye(n,"7")}var PI={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var n9;function jye(){return n9||(n9=1,function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()}(PI)),PI.exports}var $ye=jye();const De=Wo($ye);function sq(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"m10.6 13.8-2.15-2.15a.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275.948.948 0 0 0-.275.7.95.95 0 0 0 .275.7L9.9 15.9c.2.2.433.3.7.3.267 0 .5-.1.7-.3l5.65-5.65a.948.948 0 0 0 .275-.7.948.948 0 0 0-.275-.7.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275L10.6 13.8ZM12 22a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Zm0-2c2.233 0 4.125-.775 5.675-2.325C19.225 16.125 20 14.233 20 12c0-2.233-.775-4.125-2.325-5.675C16.125 4.775 14.233 4 12 4c-2.233 0-4.125.775-5.675 2.325C4.775 7.875 4 9.767 4 12c0 2.233.775 4.125 2.325 5.675C7.875 19.225 9.767 20 12 20Z"})})}sq.displayName="CheckCircleIcon";const Bye=_.forwardRef(sq);function oq(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12 17a.97.97 0 0 0 .713-.288A.968.968 0 0 0 13 16a.968.968 0 0 0-.287-.713A.968.968 0 0 0 12 15a.968.968 0 0 0-.713.287A.968.968 0 0 0 11 16c0 .283.096.52.287.712.192.192.43.288.713.288Zm0-4c.283 0 .52-.096.713-.287A.968.968 0 0 0 13 12V8a.967.967 0 0 0-.287-.713A.968.968 0 0 0 12 7a.968.968 0 0 0-.713.287A.967.967 0 0 0 11 8v4c0 .283.096.52.287.713.192.191.43.287.713.287Zm0 9a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Z"})})}oq.displayName="ErrorIcon";const Hw=_.forwardRef(oq);function aq(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M11.287 7.287A.968.968 0 0 1 12 7c.283 0 .52.096.713.287.191.192.287.43.287.713s-.096.52-.287.713A.968.968 0 0 1 12 9a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 8c0-.283.096-.52.287-.713Zm0 4A.968.968 0 0 1 12 11c.283 0 .52.096.713.287.191.192.287.43.287.713v4a.97.97 0 0 1-.287.712A.968.968 0 0 1 12 17a.968.968 0 0 1-.713-.288A.968.968 0 0 1 11 16v-4c0-.283.096-.52.287-.713Z"}),w.jsx("path",{fillRule:"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 1-16 0 8 8 0 0 1 16 0Z",clipRule:"evenodd"})]})}aq.displayName="InfoIcon";const Hye=_.forwardRef(aq);function cq(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414Z"})})}cq.displayName="CloseIcon";const Vw=_.forwardRef(cq),Vye="_alert_1bz08_19",Gye="_content_1bz08_46",qye="_icon_1bz08_57",Kye="_actions_1bz08_73",Fh={alert:Vye,content:Gye,"text-content":"_text-content_1bz08_53",icon:qye,actions:Kye},Wye="_typography_yh5dq_162",r9={"font-body-xs-regular":"_font-body-xs-regular_yh5dq_21","font-body-xs-semibold":"_font-body-xs-semibold_yh5dq_26","font-body-xs-medium":"_font-body-xs-medium_yh5dq_31","font-body-sm-regular":"_font-body-sm-regular_yh5dq_40","font-body-sm-semibold":"_font-body-sm-semibold_yh5dq_45","font-body-sm-medium":"_font-body-sm-medium_yh5dq_50","font-body-md-regular":"_font-body-md-regular_yh5dq_59","font-body-md-semibold":"_font-body-md-semibold_yh5dq_64","font-body-md-medium":"_font-body-md-medium_yh5dq_69","font-body-lg-regular":"_font-body-lg-regular_yh5dq_78","font-body-lg-semibold":"_font-body-lg-semibold_yh5dq_83","font-body-lg-medium":"_font-body-lg-medium_yh5dq_88","font-heading-sm-regular":"_font-heading-sm-regular_yh5dq_97","font-heading-sm-semibold":"_font-heading-sm-semibold_yh5dq_102","font-heading-sm-medium":"_font-heading-sm-medium_yh5dq_107","font-heading-md-regular":"_font-heading-md-regular_yh5dq_116","font-heading-md-semibold":"_font-heading-md-semibold_yh5dq_121","font-heading-lg-regular":"_font-heading-lg-regular_yh5dq_130","font-heading-lg-semibold":"_font-heading-lg-semibold_yh5dq_135","font-heading-xl-regular":"_font-heading-xl-regular_yh5dq_144","font-heading-xl-semibold":"_font-heading-xl-semibold_yh5dq_149",typography:Wye},lq=({as:n,children:e,type:t="body",weight:r="regular",size:i="md",className:s,...o})=>{const a=n||"p";return w.jsx(a,{...o,className:De(r9.typography,r9[`font-${t}-${i}-${r}`],s),children:e})},Xt=({as:n="p",children:e,...t})=>w.jsx(lq,{as:n,type:"body",...t,children:e}),zye="_destructive_bh2qc_83",LI={"icon-button":"_icon-button_bh2qc_17","subtle-bg":"_subtle-bg_bh2qc_38",destructive:zye},uq=_.forwardRef(function({as:e,children:t,className:r,disabled:i,...s},o){const a=e||"button",{onClick:c,onSubmit:l,onPointerDown:u,onPointerUp:h,onKeyDown:p,onKeyUp:m,onKeyPress:v,...g}=s,S=i?{}:{onClick:c,onSubmit:l,onPointerDown:u,onPointerUp:h,onKeyDown:p,onKeyUp:m,onKeyPress:v};return w.jsx(a,{...g,ref:o,className:r,role:e==="a"?"link":"button",tabIndex:0,...S,"aria-disabled":i,children:t})}),Yye={"indicator-icon":"_indicator-icon_133tf_26"},Xye=_.forwardRef(function({children:e,className:t,size:r="100%",colour:i,indicator:s},o){const a=De(Yye["indicator-icon"],t);return w.jsx("div",{ref:o,className:a,"data-indicator":s,style:{"--cpd-icon-button-size":r,"--cpd-color-icon-tertiary":i},children:Re.Children.only(e)})}),dq=_.createContext(null);function C6(){const n=_.useContext(dq);if(n==null)throw new Error("Tooltip components must be wrapped in <Tooltip />");return n}function Gw(){return typeof window<"u"}function Ap(n){return hq(n)?(n.nodeName||"").toLowerCase():"#document"}function Qi(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function $a(n){var e;return(e=(hq(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function hq(n){return Gw()?n instanceof Node||n instanceof Qi(n).Node:!1}function dn(n){return Gw()?n instanceof Element||n instanceof Qi(n).Element:!1}function Ts(n){return Gw()?n instanceof HTMLElement||n instanceof Qi(n).HTMLElement:!1}function u3(n){return!Gw()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Qi(n).ShadowRoot}function gy(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=Is(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function Jye(n){return["table","td","th"].includes(Ap(n))}function qw(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function T6(n){const e=Kw(),t=dn(n)?Is(n):n;return["transform","translate","scale","rotate","perspective"].some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function Zye(n){let e=Uc(n);for(;Ts(e)&&!Cc(e);){if(T6(e))return e;if(qw(e))return null;e=Uc(e)}return null}function Kw(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Cc(n){return["html","body","#document"].includes(Ap(n))}function Is(n){return Qi(n).getComputedStyle(n)}function Ww(n){return dn(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Uc(n){if(Ap(n)==="html")return n;const e=n.assignedSlot||n.parentNode||u3(n)&&n.host||$a(n);return u3(e)?e.host:e}function fq(n){const e=Uc(n);return Cc(e)?n.ownerDocument?n.ownerDocument.body:n.body:Ts(e)&&gy(e)?e:fq(e)}function Gl(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=fq(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),o=Qi(i);if(s){const a=d3(o);return e.concat(o,o.visualViewport||[],gy(i)?i:[],a&&t?Gl(a):[])}return e.concat(i,Gl(i,[],t))}function d3(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function h3(n){let e=n.activeElement;for(;((t=e)==null||(t=t.shadowRoot)==null?void 0:t.activeElement)!=null;){var t;e=e.shadowRoot.activeElement}return e}function ep(n,e){if(!n||!e)return!1;const t=e.getRootNode==null?void 0:e.getRootNode();if(n.contains(e))return!0;if(t&&u3(t)){let r=e;for(;r;){if(n===r)return!0;r=r.parentNode||r.host}}return!1}function pq(){const n=navigator.userAgentData;return n!=null&&n.platform?n.platform:navigator.platform}function mq(){const n=navigator.userAgentData;return n&&Array.isArray(n.brands)?n.brands.map(e=>{let{brand:t,version:r}=e;return t+"/"+r}).join(" "):navigator.userAgent}function Qye(n){return t0e()?!1:!i9()&&n.width===0&&n.height===0||i9()&&n.width===1&&n.height===1&&n.pressure===0&&n.detail===0&&n.pointerType==="mouse"||n.width<1&&n.height<1&&n.pressure===0&&n.detail===0&&n.pointerType==="touch"}function gq(){return/apple/i.test(navigator.vendor)}function i9(){const n=/android/i;return n.test(pq())||n.test(mq())}function e0e(){return pq().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function t0e(){return mq().includes("jsdom/")}function f3(n,e){const t=["mouse","pen"];return t.push("",void 0),t.includes(n)}function n0e(n){return"nativeEvent"in n}function r0e(n){return n.matches("html,body")}function Nl(n){return(n==null?void 0:n.ownerDocument)||document}function AI(n,e){if(e==null)return!1;if("composedPath"in n)return n.composedPath().includes(e);const t=n;return t.target!=null&&e.contains(t.target)}function nf(n){return"composedPath"in n?n.composedPath()[0]:n.target}const i0e="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function s0e(n){return Ts(n)&&n.matches(i0e)}const o0e=["top","right","bottom","left"],ou=Math.min,Ss=Math.max,iS=Math.round,C1=Math.floor,Ra=n=>({x:n,y:n}),a0e={left:"right",right:"left",bottom:"top",top:"bottom"},c0e={start:"end",end:"start"};function p3(n,e,t){return Ss(n,ou(e,t))}function jc(n,e){return typeof n=="function"?n(e):n}function $c(n){return n.split("-")[0]}function Mp(n){return n.split("-")[1]}function I6(n){return n==="x"?"y":"x"}function R6(n){return n==="y"?"height":"width"}function au(n){return["top","bottom"].includes($c(n))?"y":"x"}function k6(n){return I6(au(n))}function l0e(n,e,t){t===void 0&&(t=!1);const r=Mp(n),i=k6(n),s=R6(i);let o=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=sS(o)),[o,sS(o)]}function u0e(n){const e=sS(n);return[m3(n),e,m3(e)]}function m3(n){return n.replace(/start|end/g,e=>c0e[e])}function d0e(n,e,t){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function h0e(n,e,t,r){const i=Mp(n);let s=d0e($c(n),t==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(m3)))),s}function sS(n){return n.replace(/left|right|bottom|top/g,e=>a0e[e])}function f0e(n){return{top:0,right:0,bottom:0,left:0,...n}}function vq(n){return typeof n!="number"?f0e(n):{top:n,right:n,bottom:n,left:n}}function oS(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var p0e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],g3=p0e.join(","),yq=typeof Element>"u",Ev=yq?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,aS=!yq&&Element.prototype.getRootNode?function(n){var e;return n==null||(e=n.getRootNode)===null||e===void 0?void 0:e.call(n)}:function(n){return n==null?void 0:n.ownerDocument},cS=function n(e,t){var r;t===void 0&&(t=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||t&&e&&n(e.parentNode);return o},m0e=function(e){var t,r=e==null||(t=e.getAttribute)===null||t===void 0?void 0:t.call(e,"contenteditable");return r===""||r==="true"},g0e=function(e,t,r){if(cS(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(g3));return t&&Ev.call(e,g3)&&i.unshift(e),i=i.filter(r),i},v0e=function n(e,t,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!cS(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),c=a.length?a:o.children,l=n(c,!0,r);r.flatten?i.push.apply(i,l):i.push({scopeParent:o,candidates:l})}else{var u=Ev.call(o,g3);u&&r.filter(o)&&(t||!e.includes(o))&&i.push(o);var h=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),p=!cS(h,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(h&&p){var m=n(h===!0?o.children:h.children,!0,r);r.flatten?i.push.apply(i,m):i.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return i},_q=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},bq=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||m0e(e))&&!_q(e)?0:e.tabIndex},y0e=function(e,t){var r=bq(e);return r<0&&t&&!_q(e)?0:r},_0e=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},Sq=function(e){return e.tagName==="INPUT"},b0e=function(e){return Sq(e)&&e.type==="hidden"},S0e=function(e){var t=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return t},w0e=function(e,t){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===t)return e[r]},E0e=function(e){if(!e.name)return!0;var t=e.form||aS(e),r=function(a){return t.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=w0e(i,e.form);return!s||s===e},C0e=function(e){return Sq(e)&&e.type==="radio"},T0e=function(e){return C0e(e)&&!E0e(e)},I0e=function(e){var t,r=e&&aS(e),i=(t=r)===null||t===void 0?void 0:t.host,s=!1;if(r&&r!==e){var o,a,c;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(c=e.ownerDocument)!==null&&c!==void 0&&c.contains(e));!s&&i;){var l,u,h;r=aS(i),i=(l=r)===null||l===void 0?void 0:l.host,s=!!((u=i)!==null&&u!==void 0&&(h=u.ownerDocument)!==null&&h!==void 0&&h.contains(i))}}return s},s9=function(e){var t=e.getBoundingClientRect(),r=t.width,i=t.height;return r===0&&i===0},R0e=function(e,t){var r=t.displayCheck,i=t.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Ev.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Ev.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var c=e.parentElement,l=aS(e);if(c&&!c.shadowRoot&&i(c)===!0)return s9(e);e.assignedSlot?e=e.assignedSlot:!c&&l!==e.ownerDocument?e=l.host:e=c}e=a}if(I0e(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return s9(e);return!1},k0e=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if(t.tagName==="FIELDSET"&&t.disabled){for(var r=0;r<t.children.length;r++){var i=t.children.item(r);if(i.tagName==="LEGEND")return Ev.call(t,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}t=t.parentElement}return!1},x0e=function(e,t){return!(t.disabled||cS(t)||b0e(t)||R0e(t,e)||S0e(t)||k0e(t))},o9=function(e,t){return!(T0e(t)||bq(t)<0||!x0e(e,t))},P0e=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(t)||t>=0)},L0e=function n(e){var t=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,c=y0e(a,o),l=o?n(i.candidates):a;c===0?o?t.push.apply(t,l):t.push(a):r.push({documentOrder:s,tabIndex:c,item:i,isScope:o,content:l})}),r.sort(_0e).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(t)},wq=function(e,t){t=t||{};var r;return t.getShadowRoot?r=v0e([e],t.includeContainer,{filter:o9.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:P0e}):r=g0e(e,t.includeContainer,o9.bind(null,t)),L0e(r)};function a9(n,e,t){let{reference:r,floating:i}=n;const s=au(e),o=k6(e),a=R6(o),c=$c(e),l=s==="y",u=r.x+r.width/2-i.width/2,h=r.y+r.height/2-i.height/2,p=r[a]/2-i[a]/2;let m;switch(c){case"top":m={x:u,y:r.y-i.height};break;case"bottom":m={x:u,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:h};break;case"left":m={x:r.x-i.width,y:h};break;default:m={x:r.x,y:r.y}}switch(Mp(e)){case"start":m[o]-=p*(t&&l?-1:1);break;case"end":m[o]+=p*(t&&l?-1:1);break}return m}const A0e=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:n,floating:e,strategy:i}),{x:u,y:h}=a9(l,r,c),p=r,m={},v=0;for(let g=0;g<a.length;g++){const{name:S,fn:b}=a[g],{x:R,y:k,data:I,reset:T}=await b({x:u,y:h,initialPlacement:r,placement:p,strategy:i,middlewareData:m,rects:l,platform:o,elements:{reference:n,floating:e}});u=R??u,h=k??h,m={...m,[S]:{...m[S],...I}},T&&v<=50&&(v++,typeof T=="object"&&(T.placement&&(p=T.placement),T.rects&&(l=T.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:i}):T.rects),{x:u,y:h}=a9(l,p,c)),g=-1)}return{x:u,y:h,placement:p,strategy:i,middlewareData:m}};async function Cv(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:c}=n,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:p=!1,padding:m=0}=jc(e,n),v=vq(m),S=a[p?h==="floating"?"reference":"floating":h],b=oS(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(S)))==null||t?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),R=h==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,k=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),I=await(s.isElement==null?void 0:s.isElement(k))?await(s.getScale==null?void 0:s.getScale(k))||{x:1,y:1}:{x:1,y:1},T=oS(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:R,offsetParent:k,strategy:c}):R);return{top:(b.top-T.top+v.top)/I.y,bottom:(T.bottom-b.bottom+v.bottom)/I.y,left:(b.left-T.left+v.left)/I.x,right:(T.right-b.right+v.right)/I.x}}const M0e=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:c}=e,{element:l,padding:u=0}=jc(n,e)||{};if(l==null)return{};const h=vq(u),p={x:t,y:r},m=k6(i),v=R6(m),g=await o.getDimensions(l),S=m==="y",b=S?"top":"left",R=S?"bottom":"right",k=S?"clientHeight":"clientWidth",I=s.reference[v]+s.reference[m]-p[m]-s.floating[v],T=p[m]-s.reference[m],C=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l));let P=C?C[k]:0;(!P||!await(o.isElement==null?void 0:o.isElement(C)))&&(P=a.floating[k]||s.floating[v]);const M=I/2-T/2,D=P/2-g[v]/2-1,F=ou(h[b],D),U=ou(h[R],D),B=F,V=P-g[v]-U,z=P/2-g[v]/2+M,H=p3(B,z,V),J=!c.arrow&&Mp(i)!=null&&z!==H&&s.reference[v]/2-(z<B?F:U)-g[v]/2<0,Y=J?z<B?z-B:z-V:0;return{[m]:p[m]+Y,data:{[m]:H,centerOffset:z-H-Y,...J&&{alignmentOffset:Y}},reset:J}}}),O0e=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:g=!0,...S}=jc(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=$c(i),R=au(a),k=$c(a)===a,I=await(c.isRTL==null?void 0:c.isRTL(l.floating)),T=p||(k||!g?[sS(a)]:u0e(a)),C=v!=="none";!p&&C&&T.push(...h0e(a,g,v,I));const P=[a,...T],M=await Cv(e,S),D=[];let F=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&D.push(M[b]),h){const z=l0e(i,o,I);D.push(M[z[0]],M[z[1]])}if(F=[...F,{placement:i,overflows:D}],!D.every(z=>z<=0)){var U,B;const z=(((U=s.flip)==null?void 0:U.index)||0)+1,H=P[z];if(H)return{data:{index:z,overflows:F},reset:{placement:H}};let J=(B=F.filter(Y=>Y.overflows[0]<=0).sort((Y,G)=>Y.overflows[1]-G.overflows[1])[0])==null?void 0:B.placement;if(!J)switch(m){case"bestFit":{var V;const Y=(V=F.filter(G=>{if(C){const K=au(G.placement);return K===R||K==="y"}return!0}).map(G=>[G.placement,G.overflows.filter(K=>K>0).reduce((K,ee)=>K+ee,0)]).sort((G,K)=>G[1]-K[1])[0])==null?void 0:V[0];Y&&(J=Y);break}case"initialPlacement":J=a;break}if(i!==J)return{reset:{placement:J}}}return{}}}};function c9(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function l9(n){return o0e.some(e=>n[e]>=0)}const N0e=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=jc(n,e);switch(r){case"referenceHidden":{const s=await Cv(e,{...i,elementContext:"reference"}),o=c9(s,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:l9(o)}}}case"escaped":{const s=await Cv(e,{...i,altBoundary:!0}),o=c9(s,t.floating);return{data:{escapedOffsets:o,escaped:l9(o)}}}default:return{}}}}};async function D0e(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=$c(t),a=Mp(t),c=au(t)==="y",l=["left","top"].includes(o)?-1:1,u=s&&c?-1:1,h=jc(e,n);let{mainAxis:p,crossAxis:m,alignmentAxis:v}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof v=="number"&&(m=a==="end"?v*-1:v),c?{x:m*u,y:p*l}:{x:p*l,y:m*u}}const F0e=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:o,middlewareData:a}=e,c=await D0e(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+c.x,y:s+c.y,data:{...c,placement:o}}}}},U0e=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:b,y:R}=S;return{x:b,y:R}}},...c}=jc(n,e),l={x:t,y:r},u=await Cv(e,c),h=au($c(i)),p=I6(h);let m=l[p],v=l[h];if(s){const S=p==="y"?"top":"left",b=p==="y"?"bottom":"right",R=m+u[S],k=m-u[b];m=p3(R,m,k)}if(o){const S=h==="y"?"top":"left",b=h==="y"?"bottom":"right",R=v+u[S],k=v-u[b];v=p3(R,v,k)}const g=a.fn({...e,[p]:m,[h]:v});return{...g,data:{x:g.x-t,y:g.y-r,enabled:{[p]:s,[h]:o}}}}}},j0e=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=jc(n,e),u={x:t,y:r},h=au(i),p=I6(h);let m=u[p],v=u[h];const g=jc(a,e),S=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(c){const k=p==="y"?"height":"width",I=s.reference[p]-s.floating[k]+S.mainAxis,T=s.reference[p]+s.reference[k]-S.mainAxis;m<I?m=I:m>T&&(m=T)}if(l){var b,R;const k=p==="y"?"width":"height",I=["top","left"].includes($c(i)),T=s.reference[h]-s.floating[k]+(I&&((b=o.offset)==null?void 0:b[h])||0)+(I?0:S.crossAxis),C=s.reference[h]+s.reference[k]+(I?0:((R=o.offset)==null?void 0:R[h])||0)-(I?S.crossAxis:0);v<T?v=T:v>C&&(v=C)}return{[p]:m,[h]:v}}}},$0e=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:c=()=>{},...l}=jc(n,e),u=await Cv(e,l),h=$c(i),p=Mp(i),m=au(i)==="y",{width:v,height:g}=s.floating;let S,b;h==="top"||h==="bottom"?(S=h,b=p===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(b=h,S=p==="end"?"top":"bottom");const R=g-u.top-u.bottom,k=v-u.left-u.right,I=ou(g-u[S],R),T=ou(v-u[b],k),C=!e.middlewareData.shift;let P=I,M=T;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(M=k),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(P=R),C&&!p){const F=Ss(u.left,0),U=Ss(u.right,0),B=Ss(u.top,0),V=Ss(u.bottom,0);m?M=v-2*(F!==0||U!==0?F+U:Ss(u.left,u.right)):P=g-2*(B!==0||V!==0?B+V:Ss(u.top,u.bottom))}await c({...e,availableWidth:M,availableHeight:P});const D=await o.getDimensions(a.floating);return v!==D.width||g!==D.height?{reset:{rects:!0}}:{}}}};function Eq(n){const e=Is(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Ts(n),s=i?n.offsetWidth:t,o=i?n.offsetHeight:r,a=iS(t)!==s||iS(r)!==o;return a&&(t=s,r=o),{width:t,height:r,$:a}}function x6(n){return dn(n)?n:n.contextElement}function Pf(n){const e=x6(n);if(!Ts(e))return Ra(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=Eq(e);let o=(s?iS(t.width):t.width)/r,a=(s?iS(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const B0e=Ra(0);function Cq(n){const e=Qi(n);return!Kw()||!e.visualViewport?B0e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function H0e(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Qi(n)?!1:e}function Od(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=x6(n);let o=Ra(1);e&&(r?dn(r)&&(o=Pf(r)):o=Pf(n));const a=H0e(s,t,r)?Cq(s):Ra(0);let c=(i.left+a.x)/o.x,l=(i.top+a.y)/o.y,u=i.width/o.x,h=i.height/o.y;if(s){const p=Qi(s),m=r&&dn(r)?Qi(r):r;let v=p,g=d3(v);for(;g&&r&&m!==v;){const S=Pf(g),b=g.getBoundingClientRect(),R=Is(g),k=b.left+(g.clientLeft+parseFloat(R.paddingLeft))*S.x,I=b.top+(g.clientTop+parseFloat(R.paddingTop))*S.y;c*=S.x,l*=S.y,u*=S.x,h*=S.y,c+=k,l+=I,v=Qi(g),g=d3(v)}}return oS({width:u,height:h,x:c,y:l})}function P6(n,e){const t=Ww(n).scrollLeft;return e?e.left+t:Od($a(n)).left+t}function Tq(n,e,t){t===void 0&&(t=!1);const r=n.getBoundingClientRect(),i=r.left+e.scrollLeft-(t?0:P6(n,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function V0e(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",o=$a(r),a=e?qw(e.floating):!1;if(r===o||a&&s)return t;let c={scrollLeft:0,scrollTop:0},l=Ra(1);const u=Ra(0),h=Ts(r);if((h||!h&&!s)&&((Ap(r)!=="body"||gy(o))&&(c=Ww(r)),Ts(r))){const m=Od(r);l=Pf(r),u.x=m.x+r.clientLeft,u.y=m.y+r.clientTop}const p=o&&!h&&!s?Tq(o,c,!0):Ra(0);return{width:t.width*l.x,height:t.height*l.y,x:t.x*l.x-c.scrollLeft*l.x+u.x+p.x,y:t.y*l.y-c.scrollTop*l.y+u.y+p.y}}function G0e(n){return Array.from(n.getClientRects())}function q0e(n){const e=$a(n),t=Ww(n),r=n.ownerDocument.body,i=Ss(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Ss(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+P6(n);const a=-t.scrollTop;return Is(r).direction==="rtl"&&(o+=Ss(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function K0e(n,e){const t=Qi(n),r=$a(n),i=t.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,c=0;if(i){s=i.width,o=i.height;const l=Kw();(!l||l&&e==="fixed")&&(a=i.offsetLeft,c=i.offsetTop)}return{width:s,height:o,x:a,y:c}}function W0e(n,e){const t=Od(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=Ts(n)?Pf(n):Ra(1),o=n.clientWidth*s.x,a=n.clientHeight*s.y,c=i*s.x,l=r*s.y;return{width:o,height:a,x:c,y:l}}function u9(n,e,t){let r;if(e==="viewport")r=K0e(n,t);else if(e==="document")r=q0e($a(n));else if(dn(e))r=W0e(e,t);else{const i=Cq(n);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return oS(r)}function Iq(n,e){const t=Uc(n);return t===e||!dn(t)||Cc(t)?!1:Is(t).position==="fixed"||Iq(t,e)}function z0e(n,e){const t=e.get(n);if(t)return t;let r=Gl(n,[],!1).filter(a=>dn(a)&&Ap(a)!=="body"),i=null;const s=Is(n).position==="fixed";let o=s?Uc(n):n;for(;dn(o)&&!Cc(o);){const a=Is(o),c=T6(o);!c&&a.position==="fixed"&&(i=null),(s?!c&&!i:!c&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||gy(o)&&!c&&Iq(n,o))?r=r.filter(u=>u!==o):i=a,o=Uc(o)}return e.set(n,r),r}function Y0e(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?qw(e)?[]:z0e(e,this._c):[].concat(t),r],a=o[0],c=o.reduce((l,u)=>{const h=u9(e,u,i);return l.top=Ss(h.top,l.top),l.right=ou(h.right,l.right),l.bottom=ou(h.bottom,l.bottom),l.left=Ss(h.left,l.left),l},u9(e,a,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function X0e(n){const{width:e,height:t}=Eq(n);return{width:e,height:t}}function J0e(n,e,t){const r=Ts(e),i=$a(e),s=t==="fixed",o=Od(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=Ra(0);if(r||!r&&!s)if((Ap(e)!=="body"||gy(i))&&(a=Ww(e)),r){const p=Od(e,!0,s,e);c.x=p.x+e.clientLeft,c.y=p.y+e.clientTop}else i&&(c.x=P6(i));const l=i&&!r&&!s?Tq(i,a):Ra(0),u=o.left+a.scrollLeft-c.x-l.x,h=o.top+a.scrollTop-c.y-l.y;return{x:u,y:h,width:o.width,height:o.height}}function MI(n){return Is(n).position==="static"}function d9(n,e){if(!Ts(n)||Is(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return $a(n)===t&&(t=t.ownerDocument.body),t}function Rq(n,e){const t=Qi(n);if(qw(n))return t;if(!Ts(n)){let i=Uc(n);for(;i&&!Cc(i);){if(dn(i)&&!MI(i))return i;i=Uc(i)}return t}let r=d9(n,e);for(;r&&Jye(r)&&MI(r);)r=d9(r,e);return r&&Cc(r)&&MI(r)&&!T6(r)?t:r||Zye(n)||t}const Z0e=async function(n){const e=this.getOffsetParent||Rq,t=this.getDimensions,r=await t(n.floating);return{reference:J0e(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Q0e(n){return Is(n).direction==="rtl"}const e1e={convertOffsetParentRelativeRectToViewportRelativeRect:V0e,getDocumentElement:$a,getClippingRect:Y0e,getOffsetParent:Rq,getElementRects:Z0e,getClientRects:G0e,getDimensions:X0e,getScale:Pf,isElement:dn,isRTL:Q0e};function kq(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function t1e(n,e){let t=null,r;const i=$a(n);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const l=n.getBoundingClientRect(),{left:u,top:h,width:p,height:m}=l;if(a||e(),!p||!m)return;const v=C1(h),g=C1(i.clientWidth-(u+p)),S=C1(i.clientHeight-(h+m)),b=C1(u),k={rootMargin:-v+"px "+-g+"px "+-S+"px "+-b+"px",threshold:Ss(0,ou(1,c))||1};let I=!0;function T(C){const P=C[0].intersectionRatio;if(P!==c){if(!I)return o();P?o(!1,P):r=setTimeout(()=>{o(!1,1e-7)},1e3)}P===1&&!kq(l,n.getBoundingClientRect())&&o(),I=!1}try{t=new IntersectionObserver(T,{...k,root:i.ownerDocument})}catch{t=new IntersectionObserver(T,k)}t.observe(n)}return o(!0),s}function xq(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=x6(n),u=i||s?[...l?Gl(l):[],...Gl(e)]:[];u.forEach(b=>{i&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const h=l&&a?t1e(l,t):null;let p=-1,m=null;o&&(m=new ResizeObserver(b=>{let[R]=b;R&&R.target===l&&m&&(m.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var k;(k=m)==null||k.observe(e)})),t()}),l&&!c&&m.observe(l),m.observe(e));let v,g=c?Od(n):null;c&&S();function S(){const b=Od(n);g&&!kq(g,b)&&t(),g=b,v=requestAnimationFrame(S)}return t(),()=>{var b;u.forEach(R=>{i&&R.removeEventListener("scroll",t),s&&R.removeEventListener("resize",t)}),h==null||h(),(b=m)==null||b.disconnect(),m=null,c&&cancelAnimationFrame(v)}}const n1e=F0e,r1e=U0e,i1e=O0e,s1e=$0e,o1e=N0e,h9=M0e,a1e=j0e,c1e=(n,e,t)=>{const r=new Map,i={platform:e1e,...t},s={...i.platform,_c:r};return A0e(n,e,{...i,platform:s})};var X_=typeof document<"u"?_.useLayoutEffect:_.useEffect;function lS(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!lS(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!lS(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function Pq(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function f9(n,e){const t=Pq(n);return Math.round(e*t)/t}function OI(n){const e=_.useRef(n);return X_(()=>{e.current=n}),e}function Lq(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=n,[u,h]=_.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[p,m]=_.useState(r);lS(p,r)||m(r);const[v,g]=_.useState(null),[S,b]=_.useState(null),R=_.useCallback(G=>{G!==C.current&&(C.current=G,g(G))},[]),k=_.useCallback(G=>{G!==P.current&&(P.current=G,b(G))},[]),I=s||v,T=o||S,C=_.useRef(null),P=_.useRef(null),M=_.useRef(u),D=c!=null,F=OI(c),U=OI(i),B=OI(l),V=_.useCallback(()=>{if(!C.current||!P.current)return;const G={placement:e,strategy:t,middleware:p};U.current&&(G.platform=U.current),c1e(C.current,P.current,G).then(K=>{const ee={...K,isPositioned:B.current!==!1};z.current&&!lS(M.current,ee)&&(M.current=ee,Sp.flushSync(()=>{h(ee)}))})},[p,e,t,U,B]);X_(()=>{l===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,h(G=>({...G,isPositioned:!1})))},[l]);const z=_.useRef(!1);X_(()=>(z.current=!0,()=>{z.current=!1}),[]),X_(()=>{if(I&&(C.current=I),T&&(P.current=T),I&&T){if(F.current)return F.current(I,T,V);V()}},[I,T,V,F,D]);const H=_.useMemo(()=>({reference:C,floating:P,setReference:R,setFloating:k}),[R,k]),J=_.useMemo(()=>({reference:I,floating:T}),[I,T]),Y=_.useMemo(()=>{const G={position:t,left:0,top:0};if(!J.floating)return G;const K=f9(J.floating,u.x),ee=f9(J.floating,u.y);return a?{...G,transform:"translate("+K+"px, "+ee+"px)",...Pq(J.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:K,top:ee}},[t,a,J.floating,u.x,u.y]);return _.useMemo(()=>({...u,update:V,refs:H,elements:J,floatingStyles:Y}),[u,V,H,J,Y])}const l1e=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?h9({element:r.current,padding:i}).fn(t):{}:r?h9({element:r,padding:i}).fn(t):{}}}},Aq=(n,e)=>({...n1e(n),options:[n,e]}),Mq=(n,e)=>({...r1e(n),options:[n,e]}),u1e=(n,e)=>({...a1e(n),options:[n,e]}),Oq=(n,e)=>({...i1e(n),options:[n,e]}),d1e=(n,e)=>({...s1e(n),options:[n,e]}),h1e=(n,e)=>({...o1e(n),options:[n,e]}),Nq=(n,e)=>({...l1e(n),options:[n,e]});function Dq(n){return _.useMemo(()=>n.every(e=>e==null)?null:e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})},n)}const Fq={...TB},f1e=Fq.useInsertionEffect,p1e=f1e||(n=>n());function pc(n){const e=_.useRef(()=>{});return p1e(()=>{e.current=n}),_.useCallback(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var Ei=typeof document<"u"?_.useLayoutEffect:_.useEffect;let p9=!1,m1e=0;const m9=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+m1e++;function g1e(){const[n,e]=_.useState(()=>p9?m9():void 0);return Ei(()=>{n==null&&e(m9())},[]),_.useEffect(()=>{p9=!0},[]),n}const v1e=Fq.useId,tp=v1e||g1e,y1e=_.forwardRef(function(e,t){const{context:{placement:r,elements:{floating:i},middlewareData:{arrow:s,shift:o}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:u=0,staticOffset:h,stroke:p,d:m,style:{transform:v,...g}={},...S}=e,b=tp(),[R,k]=_.useState(!1);if(Ei(()=>{if(!i)return;Is(i).direction==="rtl"&&k(!0)},[i]),!i)return null;const[I,T]=r.split("-"),C=I==="top"||I==="bottom";let P=h;(C&&o!=null&&o.x||!C&&o!=null&&o.y)&&(P=null);const M=u*2,D=M/2,F=a/2*(l/-8+1),U=c/2*l/4,B=!!m,V=P&&T==="end"?"bottom":"top";let z=P&&T==="end"?"right":"left";P&&R&&(z=T==="end"?"left":"right");const H=(s==null?void 0:s.x)!=null?P||s.x:"",J=(s==null?void 0:s.y)!=null?P||s.y:"",Y=m||"M0,0"+(" H"+a)+(" L"+(a-F)+","+(c-U))+(" Q"+a/2+","+c+" "+F+","+(c-U))+" Z",G={top:B?"rotate(180deg)":"",left:B?"rotate(90deg)":"rotate(-90deg)",bottom:B?"":"rotate(180deg)",right:B?"rotate(-90deg)":"rotate(90deg)"}[I];return w.jsxs("svg",{...S,"aria-hidden":!0,ref:t,width:B?a:a+M,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[z]:H,[V]:J,[I]:C||B?"100%":"calc(100% - "+M/2+"px)",transform:[G,v].filter(K=>!!K).join(" "),...g},children:[M>0&&w.jsx("path",{clipPath:"url(#"+b+")",fill:"none",stroke:p,strokeWidth:M+(m?0:1),d:Y}),w.jsx("path",{stroke:M&&!m?S.fill:"none",d:Y}),w.jsx("clipPath",{id:b,children:w.jsx("rect",{x:-D,y:D*(B?-1:1),width:a+M,height:a})})]})});function _1e(){const n=new Map;return{emit(e,t){var r;(r=n.get(e))==null||r.forEach(i=>i(t))},on(e,t){n.set(e,[...n.get(e)||[],t])},off(e,t){var r;n.set(e,((r=n.get(e))==null?void 0:r.filter(i=>i!==t))||[])}}}const b1e=_.createContext(null),S1e=_.createContext(null),L6=()=>{var n;return((n=_.useContext(b1e))==null?void 0:n.id)||null},A6=()=>_.useContext(S1e);function vy(n){return"data-floating-ui-"+n}function NI(n){const e=_.useRef(n);return Ei(()=>{e.current=n}),e}const g9=vy("safe-polygon");function J_(n,e,t){return t&&!f3(t)?0:typeof n=="number"?n:n==null?void 0:n[e]}function w1e(n,e){e===void 0&&(e={});const{open:t,onOpenChange:r,dataRef:i,events:s,elements:o}=n,{enabled:a=!0,delay:c=0,handleClose:l=null,mouseOnly:u=!1,restMs:h=0,move:p=!0}=e,m=A6(),v=L6(),g=NI(l),S=NI(c),b=NI(t),R=_.useRef(),k=_.useRef(-1),I=_.useRef(),T=_.useRef(-1),C=_.useRef(!0),P=_.useRef(!1),M=_.useRef(()=>{}),D=_.useRef(!1),F=_.useCallback(()=>{var Y;const G=(Y=i.current.openEvent)==null?void 0:Y.type;return(G==null?void 0:G.includes("mouse"))&&G!=="mousedown"},[i]);_.useEffect(()=>{if(!a)return;function Y(G){let{open:K}=G;K||(clearTimeout(k.current),clearTimeout(T.current),C.current=!0,D.current=!1)}return s.on("openchange",Y),()=>{s.off("openchange",Y)}},[a,s]),_.useEffect(()=>{if(!a||!g.current||!t)return;function Y(K){F()&&r(!1,K,"hover")}const G=Nl(o.floating).documentElement;return G.addEventListener("mouseleave",Y),()=>{G.removeEventListener("mouseleave",Y)}},[o.floating,t,r,a,g,F]);const U=_.useCallback(function(Y,G,K){G===void 0&&(G=!0),K===void 0&&(K="hover");const ee=J_(S.current,"close",R.current);ee&&!I.current?(clearTimeout(k.current),k.current=window.setTimeout(()=>r(!1,Y,K),ee)):G&&(clearTimeout(k.current),r(!1,Y,K))},[S,r]),B=pc(()=>{M.current(),I.current=void 0}),V=pc(()=>{if(P.current){const Y=Nl(o.floating).body;Y.style.pointerEvents="",Y.removeAttribute(g9),P.current=!1}}),z=pc(()=>i.current.openEvent?["click","mousedown"].includes(i.current.openEvent.type):!1);_.useEffect(()=>{if(!a)return;function Y(q){if(clearTimeout(k.current),C.current=!1,u&&!f3(R.current)||h>0&&!J_(S.current,"open"))return;const Q=J_(S.current,"open",R.current);Q?k.current=window.setTimeout(()=>{b.current||r(!0,q,"hover")},Q):t||r(!0,q,"hover")}function G(q){if(z())return;M.current();const Q=Nl(o.floating);if(clearTimeout(T.current),D.current=!1,g.current&&i.current.floatingContext){t||clearTimeout(k.current),I.current=g.current({...i.current.floatingContext,tree:m,x:q.clientX,y:q.clientY,onClose(){V(),B(),z()||U(q,!0,"safe-polygon")}});const Ie=I.current;Q.addEventListener("mousemove",Ie),M.current=()=>{Q.removeEventListener("mousemove",Ie)};return}(R.current==="touch"?!ep(o.floating,q.relatedTarget):!0)&&U(q)}function K(q){z()||i.current.floatingContext&&(g.current==null||g.current({...i.current.floatingContext,tree:m,x:q.clientX,y:q.clientY,onClose(){V(),B(),z()||U(q)}})(q))}if(dn(o.domReference)){var ee;const q=o.domReference;return t&&q.addEventListener("mouseleave",K),(ee=o.floating)==null||ee.addEventListener("mouseleave",K),p&&q.addEventListener("mousemove",Y,{once:!0}),q.addEventListener("mouseenter",Y),q.addEventListener("mouseleave",G),()=>{var Q;t&&q.removeEventListener("mouseleave",K),(Q=o.floating)==null||Q.removeEventListener("mouseleave",K),p&&q.removeEventListener("mousemove",Y),q.removeEventListener("mouseenter",Y),q.removeEventListener("mouseleave",G)}}},[o,a,n,u,h,p,U,B,V,r,t,b,m,S,g,i,z]),Ei(()=>{var Y;if(a&&t&&(Y=g.current)!=null&&Y.__options.blockPointerEvents&&F()){P.current=!0;const K=o.floating;if(dn(o.domReference)&&K){var G;const ee=Nl(o.floating).body;ee.setAttribute(g9,"");const q=o.domReference,Q=m==null||(G=m.nodesRef.current.find(Se=>Se.id===v))==null||(G=G.context)==null?void 0:G.elements.floating;return Q&&(Q.style.pointerEvents=""),ee.style.pointerEvents="none",q.style.pointerEvents="auto",K.style.pointerEvents="auto",()=>{ee.style.pointerEvents="",q.style.pointerEvents="",K.style.pointerEvents=""}}}},[a,t,v,o,m,g,F]),Ei(()=>{t||(R.current=void 0,D.current=!1,B(),V())},[t,B,V]),_.useEffect(()=>()=>{B(),clearTimeout(k.current),clearTimeout(T.current),V()},[a,o.domReference,B,V]);const H=_.useMemo(()=>{function Y(G){R.current=G.pointerType}return{onPointerDown:Y,onPointerEnter:Y,onMouseMove(G){const{nativeEvent:K}=G;function ee(){!C.current&&!b.current&&r(!0,K,"hover")}u&&!f3(R.current)||t||h===0||D.current&&G.movementX**2+G.movementY**2<2||(clearTimeout(T.current),R.current==="touch"?ee():(D.current=!0,T.current=window.setTimeout(ee,h)))}}},[u,r,t,b,h]),J=_.useMemo(()=>({onMouseEnter(){clearTimeout(k.current)},onMouseLeave(Y){z()||U(Y.nativeEvent,!1)}}),[U,z]);return _.useMemo(()=>a?{reference:H,floating:J}:{},[a,H,J])}const v3=()=>{},Uq=_.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:v3,setState:v3,isInstantPhase:!1}),E1e=()=>_.useContext(Uq);function C1e(n){const{children:e,delay:t,timeoutMs:r=0}=n,[i,s]=_.useReducer((c,l)=>({...c,...l}),{delay:t,timeoutMs:r,initialDelay:t,currentId:null,isInstantPhase:!1}),o=_.useRef(null),a=_.useCallback(c=>{s({currentId:c})},[]);return Ei(()=>{i.currentId?o.current===null?o.current=i.currentId:i.isInstantPhase||s({isInstantPhase:!0}):(i.isInstantPhase&&s({isInstantPhase:!1}),o.current=null)},[i.currentId,i.isInstantPhase]),w.jsx(Uq.Provider,{value:_.useMemo(()=>({...i,setState:s,setCurrentId:a}),[i,a]),children:e})}function T1e(n,e){e===void 0&&(e={});const{open:t,onOpenChange:r,floatingId:i}=n,{id:s,enabled:o=!0}=e,a=s??i,c=E1e(),{currentId:l,setCurrentId:u,initialDelay:h,setState:p,timeoutMs:m}=c;return Ei(()=>{o&&l&&(p({delay:{open:1,close:J_(h,"close")}}),l!==a&&r(!1))},[o,a,r,p,l,h]),Ei(()=>{function v(){r(!1),p({delay:h,currentId:null})}if(o&&l&&!t&&l===a){if(m){const g=window.setTimeout(v,m);return()=>{clearTimeout(g)}}v()}},[o,t,p,l,a,r,h,m]),Ei(()=>{o&&(u===v3||!t||u(a))},[o,t,u,a]),c}function DI(n,e){let t=n.filter(i=>{var s;return i.parentId===e&&((s=i.context)==null?void 0:s.open)}),r=t;for(;r.length;)r=n.filter(i=>{var s;return(s=r)==null?void 0:s.some(o=>{var a;return i.parentId===o.id&&((a=i.context)==null?void 0:a.open)})}),t=t.concat(r);return t}const jq=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function $q(n,e){const t=wq(n,jq());e==="prev"&&t.reverse();const r=t.indexOf(h3(Nl(n)));return t.slice(r+1)[0]}function I1e(){return $q(document.body,"next")}function R1e(){return $q(document.body,"prev")}function FI(n,e){const t=e||n.currentTarget,r=n.relatedTarget;return!r||!ep(t,r)}function k1e(n){wq(n,jq()).forEach(t=>{t.dataset.tabindex=t.getAttribute("tabindex")||"",t.setAttribute("tabindex","-1")})}function v9(n){n.querySelectorAll("[data-tabindex]").forEach(t=>{const r=t.dataset.tabindex;delete t.dataset.tabindex,r?t.setAttribute("tabindex",r):t.removeAttribute("tabindex")})}const Bq={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let x1e;function y9(n){n.key==="Tab"&&(n.target,clearTimeout(x1e))}const _9=_.forwardRef(function(e,t){const[r,i]=_.useState();Ei(()=>(gq()&&i("button"),document.addEventListener("keydown",y9),()=>{document.removeEventListener("keydown",y9)}),[]);const s={ref:t,tabIndex:0,role:r,"aria-hidden":r?void 0:!0,[vy("focus-guard")]:"",style:Bq};return w.jsx("span",{...e,...s})}),Hq=_.createContext(null),b9=vy("portal");function P1e(n){n===void 0&&(n={});const{id:e,root:t}=n,r=tp(),i=A1e(),[s,o]=_.useState(null),a=_.useRef(null);return Ei(()=>()=>{s==null||s.remove(),queueMicrotask(()=>{a.current=null})},[s]),Ei(()=>{if(!r||a.current)return;const c=e?document.getElementById(e):null;if(!c)return;const l=document.createElement("div");l.id=r,l.setAttribute(b9,""),c.appendChild(l),a.current=l,o(l)},[e,r]),Ei(()=>{if(t===null||!r||a.current)return;let c=t||(i==null?void 0:i.portalNode);c&&!dn(c)&&(c=c.current),c=c||document.body;let l=null;e&&(l=document.createElement("div"),l.id=e,c.appendChild(l));const u=document.createElement("div");u.id=r,u.setAttribute(b9,""),c=l||c,c.appendChild(u),a.current=u,o(u)},[e,t,r,i]),s}function L1e(n){const{children:e,id:t,root:r,preserveTabOrder:i=!0}=n,s=P1e({id:t,root:r}),[o,a]=_.useState(null),c=_.useRef(null),l=_.useRef(null),u=_.useRef(null),h=_.useRef(null),p=o==null?void 0:o.modal,m=o==null?void 0:o.open,v=!!o&&!o.modal&&o.open&&i&&!!(r||s);return _.useEffect(()=>{if(!s||!i||p)return;function g(S){s&&FI(S)&&(S.type==="focusin"?v9:k1e)(s)}return s.addEventListener("focusin",g,!0),s.addEventListener("focusout",g,!0),()=>{s.removeEventListener("focusin",g,!0),s.removeEventListener("focusout",g,!0)}},[s,i,p]),_.useEffect(()=>{s&&(m||v9(s))},[m,s]),w.jsxs(Hq.Provider,{value:_.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:u,afterInsideRef:h,portalNode:s,setFocusManagerState:a}),[i,s]),children:[v&&s&&w.jsx(_9,{"data-type":"outside",ref:c,onFocus:g=>{if(FI(g,s)){var S;(S=u.current)==null||S.focus()}else{const b=R1e()||(o==null?void 0:o.domReference);b==null||b.focus()}}}),v&&s&&w.jsx("span",{"aria-owns":s.id,style:Bq}),s&&Sp.createPortal(e,s),v&&s&&w.jsx(_9,{"data-type":"outside",ref:l,onFocus:g=>{if(FI(g,s)){var S;(S=h.current)==null||S.focus()}else{const b=I1e()||(o==null?void 0:o.domReference);b==null||b.focus(),o!=null&&o.closeOnFocusOut&&(o==null||o.onOpenChange(!1,g.nativeEvent,"focus-out"))}}})]})}const A1e=()=>_.useContext(Hq),M1e="data-floating-ui-focusable",O1e={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},N1e={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},S9=n=>{var e,t;return{escapeKey:typeof n=="boolean"?n:(e=n==null?void 0:n.escapeKey)!=null?e:!1,outsidePress:typeof n=="boolean"?n:(t=n==null?void 0:n.outsidePress)!=null?t:!0}};function D1e(n,e){e===void 0&&(e={});const{open:t,onOpenChange:r,elements:i,dataRef:s}=n,{enabled:o=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:u=!1,referencePressEvent:h="pointerdown",ancestorScroll:p=!1,bubbles:m,capture:v}=e,g=A6(),S=pc(typeof c=="function"?c:()=>!1),b=typeof c=="function"?S:c,R=_.useRef(!1),k=_.useRef(!1),{escapeKey:I,outsidePress:T}=S9(m),{escapeKey:C,outsidePress:P}=S9(v),M=_.useRef(!1),D=pc(H=>{var J;if(!t||!o||!a||H.key!=="Escape"||M.current)return;const Y=(J=s.current.floatingContext)==null?void 0:J.nodeId,G=g?DI(g.nodesRef.current,Y):[];if(!I&&(H.stopPropagation(),G.length>0)){let K=!0;if(G.forEach(ee=>{var q;if((q=ee.context)!=null&&q.open&&!ee.context.dataRef.current.__escapeKeyBubbles){K=!1;return}}),!K)return}r(!1,n0e(H)?H.nativeEvent:H,"escape-key")}),F=pc(H=>{var J;const Y=()=>{var G;D(H),(G=nf(H))==null||G.removeEventListener("keydown",Y)};(J=nf(H))==null||J.addEventListener("keydown",Y)}),U=pc(H=>{var J;const Y=R.current;R.current=!1;const G=k.current;if(k.current=!1,l==="click"&&G||Y||typeof b=="function"&&!b(H))return;const K=nf(H),ee="["+vy("inert")+"]",q=Nl(i.floating).querySelectorAll(ee);let Q=dn(K)?K:null;for(;Q&&!Cc(Q);){const Le=Uc(Q);if(Cc(Le)||!dn(Le))break;Q=Le}if(q.length&&dn(K)&&!r0e(K)&&!ep(K,i.floating)&&Array.from(q).every(Le=>!ep(Q,Le)))return;if(Ts(K)&&z){const Le=Cc(K),xe=Is(K),Ee=/auto|scroll/,Ce=Le||Ee.test(xe.overflowX),Ve=Le||Ee.test(xe.overflowY),vt=Ce&&K.clientWidth>0&&K.scrollWidth>K.clientWidth,Jt=Ve&&K.clientHeight>0&&K.scrollHeight>K.clientHeight,Et=xe.direction==="rtl",Be=Jt&&(Et?H.offsetX<=K.offsetWidth-K.clientWidth:H.offsetX>K.clientWidth),Zn=vt&&H.offsetY>K.clientHeight;if(Be||Zn)return}const Se=(J=s.current.floatingContext)==null?void 0:J.nodeId,Ie=g&&DI(g.nodesRef.current,Se).some(Le=>{var xe;return AI(H,(xe=Le.context)==null?void 0:xe.elements.floating)});if(AI(H,i.floating)||AI(H,i.domReference)||Ie)return;const Ne=g?DI(g.nodesRef.current,Se):[];if(Ne.length>0){let Le=!0;if(Ne.forEach(xe=>{var Ee;if((Ee=xe.context)!=null&&Ee.open&&!xe.context.dataRef.current.__outsidePressBubbles){Le=!1;return}}),!Le)return}r(!1,H,"outside-press")}),B=pc(H=>{var J;const Y=()=>{var G;U(H),(G=nf(H))==null||G.removeEventListener(l,Y)};(J=nf(H))==null||J.addEventListener(l,Y)});_.useEffect(()=>{if(!t||!o)return;s.current.__escapeKeyBubbles=I,s.current.__outsidePressBubbles=T;let H=-1;function J(q){r(!1,q,"ancestor-scroll")}function Y(){window.clearTimeout(H),M.current=!0}function G(){H=window.setTimeout(()=>{M.current=!1},Kw()?5:0)}const K=Nl(i.floating);a&&(K.addEventListener("keydown",C?F:D,C),K.addEventListener("compositionstart",Y),K.addEventListener("compositionend",G)),b&&K.addEventListener(l,P?B:U,P);let ee=[];return p&&(dn(i.domReference)&&(ee=Gl(i.domReference)),dn(i.floating)&&(ee=ee.concat(Gl(i.floating))),!dn(i.reference)&&i.reference&&i.reference.contextElement&&(ee=ee.concat(Gl(i.reference.contextElement)))),ee=ee.filter(q=>{var Q;return q!==((Q=K.defaultView)==null?void 0:Q.visualViewport)}),ee.forEach(q=>{q.addEventListener("scroll",J,{passive:!0})}),()=>{a&&(K.removeEventListener("keydown",C?F:D,C),K.removeEventListener("compositionstart",Y),K.removeEventListener("compositionend",G)),b&&K.removeEventListener(l,P?B:U,P),ee.forEach(q=>{q.removeEventListener("scroll",J)}),window.clearTimeout(H)}},[s,i,a,b,l,t,r,p,o,I,T,D,C,F,U,P,B]),_.useEffect(()=>{R.current=!1},[b,l]);const V=_.useMemo(()=>({onKeyDown:D,...u&&{[O1e[h]]:H=>{r(!1,H.nativeEvent,"reference-press")},...h!=="click"&&{onClick(H){r(!1,H.nativeEvent,"reference-press")}}}}),[D,r,u,h]),z=_.useMemo(()=>({onKeyDown:D,onMouseDown(){k.current=!0},onMouseUp(){k.current=!0},[N1e[l]]:()=>{R.current=!0}}),[D,l]);return _.useMemo(()=>o?{reference:V,floating:z}:{},[o,V,z])}function F1e(n){const{open:e=!1,onOpenChange:t,elements:r}=n,i=tp(),s=_.useRef({}),[o]=_.useState(()=>_1e()),a=L6()!=null,[c,l]=_.useState(r.reference),u=pc((m,v,g)=>{s.current.openEvent=m?v:void 0,o.emit("openchange",{open:m,event:v,reason:g,nested:a}),t==null||t(m,v,g)}),h=_.useMemo(()=>({setPositionReference:l}),[]),p=_.useMemo(()=>({reference:c||r.reference||null,floating:r.floating||null,domReference:r.reference}),[c,r.reference,r.floating]);return _.useMemo(()=>({dataRef:s,open:e,onOpenChange:u,elements:p,events:o,floatingId:i,refs:h}),[e,u,p,o,i,h])}function U1e(n){n===void 0&&(n={});const{nodeId:e}=n,t=F1e({...n,elements:{reference:null,floating:null,...n.elements}}),r=n.rootContext||t,i=r.elements,[s,o]=_.useState(null),[a,c]=_.useState(null),u=(i==null?void 0:i.domReference)||s,h=_.useRef(null),p=A6();Ei(()=>{u&&(h.current=u)},[u]);const m=Lq({...n,elements:{...i,...a&&{reference:a}}}),v=_.useCallback(k=>{const I=dn(k)?{getBoundingClientRect:()=>k.getBoundingClientRect(),contextElement:k}:k;c(I),m.refs.setReference(I)},[m.refs]),g=_.useCallback(k=>{(dn(k)||k===null)&&(h.current=k,o(k)),(dn(m.refs.reference.current)||m.refs.reference.current===null||k!==null&&!dn(k))&&m.refs.setReference(k)},[m.refs]),S=_.useMemo(()=>({...m.refs,setReference:g,setPositionReference:v,domReference:h}),[m.refs,g,v]),b=_.useMemo(()=>({...m.elements,domReference:u}),[m.elements,u]),R=_.useMemo(()=>({...m,...r,refs:S,elements:b,nodeId:e}),[m,S,b,e,r]);return Ei(()=>{r.dataRef.current.floatingContext=R;const k=p==null?void 0:p.nodesRef.current.find(I=>I.id===e);k&&(k.context=R)}),_.useMemo(()=>({...m,context:R,refs:S,elements:b}),[m,S,b,R])}function j1e(n,e){e===void 0&&(e={});const{open:t,onOpenChange:r,events:i,dataRef:s,elements:o}=n,{enabled:a=!0,visibleOnly:c=!0}=e,l=_.useRef(!1),u=_.useRef(),h=_.useRef(!0);_.useEffect(()=>{if(!a)return;const m=Qi(o.domReference);function v(){!t&&Ts(o.domReference)&&o.domReference===h3(Nl(o.domReference))&&(l.current=!0)}function g(){h.current=!0}return m.addEventListener("blur",v),m.addEventListener("keydown",g,!0),()=>{m.removeEventListener("blur",v),m.removeEventListener("keydown",g,!0)}},[o.domReference,t,a]),_.useEffect(()=>{if(!a)return;function m(v){let{reason:g}=v;(g==="reference-press"||g==="escape-key")&&(l.current=!0)}return i.on("openchange",m),()=>{i.off("openchange",m)}},[i,a]),_.useEffect(()=>()=>{clearTimeout(u.current)},[]);const p=_.useMemo(()=>({onPointerDown(m){Qye(m.nativeEvent)||(h.current=!1)},onMouseLeave(){l.current=!1},onFocus(m){if(l.current)return;const v=nf(m.nativeEvent);if(c&&dn(v))try{if(gq()&&e0e())throw Error();if(!v.matches(":focus-visible"))return}catch{if(!h.current&&!s0e(v))return}r(!0,m.nativeEvent,"focus")},onBlur(m){l.current=!1;const v=m.relatedTarget,g=m.nativeEvent,S=dn(v)&&v.hasAttribute(vy("focus-guard"))&&v.getAttribute("data-type")==="outside";u.current=window.setTimeout(()=>{var b;const R=h3(o.domReference?o.domReference.ownerDocument:document);!v&&R===o.domReference||ep((b=s.current.floatingContext)==null?void 0:b.refs.floating.current,R)||ep(o.domReference,R)||S||r(!1,g,"focus")})}}),[s,o.domReference,r,c]);return _.useMemo(()=>a?{reference:p}:{},[a,p])}const w9="active",E9="selected";function UI(n,e,t){const r=new Map,i=t==="item";let s=n;if(i&&n){const{[w9]:o,[E9]:a,...c}=n;s=c}return{...t==="floating"&&{tabIndex:-1,[M1e]:""},...s,...e.map(o=>{const a=o?o[t]:null;return typeof a=="function"?n?a(n):null:a}).concat(n).reduce((o,a)=>(a&&Object.entries(a).forEach(c=>{let[l,u]=c;if(!(i&&[w9,E9].includes(l)))if(l.indexOf("on")===0){if(r.has(l)||r.set(l,[]),typeof u=="function"){var h;(h=r.get(l))==null||h.push(u),o[l]=function(){for(var p,m=arguments.length,v=new Array(m),g=0;g<m;g++)v[g]=arguments[g];return(p=r.get(l))==null?void 0:p.map(S=>S(...v)).find(S=>S!==void 0)}}}else o[l]=u}),o),{})}}function $1e(n){n===void 0&&(n=[]);const e=n.map(a=>a==null?void 0:a.reference),t=n.map(a=>a==null?void 0:a.floating),r=n.map(a=>a==null?void 0:a.item),i=_.useCallback(a=>UI(a,n,"reference"),e),s=_.useCallback(a=>UI(a,n,"floating"),t),o=_.useCallback(a=>UI(a,n,"item"),r);return _.useMemo(()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:o}),[i,s,o])}const B1e=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function H1e(n,e){var t;e===void 0&&(e={});const{open:r,floatingId:i}=n,{enabled:s=!0,role:o="dialog"}=e,a=(t=B1e.get(o))!=null?t:o,c=tp(),u=L6()!=null,h=_.useMemo(()=>a==="tooltip"||o==="label"?{["aria-"+(o==="label"?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":a==="alertdialog"?"dialog":a,"aria-controls":r?i:void 0,...a==="listbox"&&{role:"combobox"},...a==="menu"&&{id:c},...a==="menu"&&u&&{role:"menuitem"},...o==="select"&&{"aria-autocomplete":"none"},...o==="combobox"&&{"aria-autocomplete":"list"}},[a,i,u,r,c,o]),p=_.useMemo(()=>{const v={id:i,...a&&{role:a}};return a==="tooltip"||o==="label"?v:{...v,...a==="menu"&&{"aria-labelledby":c}}},[a,i,c,o]),m=_.useCallback(v=>{let{active:g,selected:S}=v;const b={role:"option",...g&&{id:i+"-option"}};switch(o){case"select":return{...b,"aria-selected":g&&S};case"combobox":return{...b,...g&&{"aria-selected":!0}}}return{}},[i,o]);return _.useMemo(()=>s?{reference:h,floating:p,item:m}:{},[s,h,p,m])}const V1e="_tooltip_1pslb_17",G1e="_invisible_1pslb_30",q1e="_caption_1pslb_37",K1e="_arrow_1pslb_42",Z_={tooltip:V1e,invisible:G1e,caption:q1e,arrow:K1e},Vq={open:300,close:0},Gq=({children:n})=>w.jsx(C1e,{delay:Vq,timeoutMs:300,children:n});Gq.displayName="TooltipProvider";function W1e({open:n,disabled:e=!1,onOpenChange:t,placement:r="bottom",isTriggerInteractive:i,caption:s,"aria-atomic":o,"aria-live":a,...c}){const l=tp(),u=tp(),h=_.useRef(null),[p,m]=_.useState(!1),v=e?!1:n??p,g=(V,z,H)=>{t==null||t(V,z,H),n===void 0&&m(V)},S=U1e({placement:r,open:v,onOpenChange:g,whileElementsMounted:xq,middleware:[Aq(6),Oq({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),Mq({padding:5}),Nq({element:h})]}),b=S.context,{delay:R,initialDelay:k}=T1e(b);if(k!==Vq)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const I=w1e(b,{move:!1,enabled:n===void 0,delay:i?R:{},mouseOnly:!0}),T=j1e(b,{enabled:n===void 0}),C=_.useRef(void 0);_.useEffect(()=>()=>window.clearTimeout(C.current),[]);const P=_.useMemo(()=>{const V=()=>{C.current===void 0?C.current=window.setTimeout(()=>{g(!1),C.current=void 0},1500):window.clearTimeout(C.current)};return{reference:{onTouchStart:()=>{C.current!==void 0&&window.clearTimeout(C.current),C.current=window.setTimeout(()=>{g(!0),C.current=void 0},500)},onTouchEnd:V,onTouchCancel:V}}},[]),M=D1e(b),D="label"in c?"label":"description",F=H1e(b,{enabled:D==="description",role:"tooltip"}),U=_.useMemo(()=>D==="label"?{reference:{"aria-labelledby":l,"aria-describedby":s?u:void 0}}:{},[D,l,u]),B=$1e([I,T,P,M,F,U]);return _.useMemo(()=>({labelId:l,captionId:s?u:void 0,caption:s,purpose:D,open:v,setOpen:g,tooltipProps:{"aria-atomic":o,"aria-live":a},...B,...S,arrowRef:h}),[l,u,s,F,v,g,B,S,h])}const z1e=n=>"label"in n&&!!n.label;function di({children:n,isTriggerInteractive:e=!0,nonInteractiveTriggerTabIndex:t=0,...r}){const i=W1e({isTriggerInteractive:e,...r});return w.jsxs(dq.Provider,{value:i,children:[w.jsx(J1e,{isTriggerInteractive:e,nonInteractiveTriggerTabIndex:t,children:n}),w.jsxs(X1e,{children:[w.jsx("span",{id:i.labelId,children:z1e(r)?r.label:r.description}),w.jsx(Y1e,{})]})]})}function Y1e(){const{caption:n,captionId:e}=C6();if(!n)return null;const r=typeof n=="string"?"span":"div";return w.jsx(r,{id:e,className:De(Z_.caption,"cpd-theme-dark"),children:n})}function X1e({children:n}){const{context:e,open:t,arrowRef:r,purpose:i,...s}=C6();return!t&&i!=="label"?null:w.jsx(L1e,{children:w.jsxs("div",{ref:s.refs.setFloating,style:s.floatingStyles,...s.tooltipProps,...s.getFloatingProps(),className:De(Z_.tooltip,{[Z_.invisible]:i==="label"&&!t}),children:[w.jsx(y1e,{ref:r,context:e,width:10,height:6,className:Z_.arrow}),n]})})}const J1e=({children:n,isTriggerInteractive:e,nonInteractiveTriggerTabIndex:t})=>{const r=C6(),i=n==null?void 0:n.ref,s=Dq([r.refs.setReference,i]),o=_.useMemo(()=>{if(_.isValidElement(n))if(e){const a=r.getReferenceProps({ref:s});return _.cloneElement(n,a)}else{const a=r.getReferenceProps({ref:s,tabIndex:t}),{"aria-labelledby":c,"aria-describedby":l,...u}=a;return w.jsx("span",{tabIndex:t,...u,children:_.cloneElement(n,{"aria-labelledby":c,"aria-describedby":l})})}},[r,s,n]);if(!o)throw new Error("Tooltip anchor must be a single valid React element");return o},qq=_.forwardRef(function({children:e,className:t,indicator:r,size:i="32px",style:s,disabled:o,destructive:a,tooltip:c,subtleBackground:l,...u},h){const p=De(LI["icon-button"],t,{[LI.destructive]:a,[LI["subtle-bg"]]:l}),m=w.jsx(uq,{as:"button",ref:h,className:p,style:{"--cpd-icon-button-size":i,...s},disabled:o,...u,"data-indicator":r,children:w.jsx(Xye,{indicator:r,colour:o?"var(--cpd-color-icon-disabled)":void 0,children:Re.Children.only(e)})});return c?w.jsx(di,{label:c,children:m}):m}),Z1e=({type:n,title:e,children:t,className:r,actions:i,onClose:s,...o})=>{const a=De(Fh.alert,r),c=_.useCallback(l=>{switch(n){case"critical":return w.jsx(Hw,{...l});case"info":return w.jsx(Hye,{...l});case"success":return w.jsx(Bye,{...l})}},[n]);return w.jsxs("div",{...o,className:a,"data-type":n,children:[c({width:24,height:24,className:Fh.icon,"aria-hidden":!0}),w.jsxs("div",{className:Fh.content,children:[w.jsxs("div",{className:Fh["text-content"],children:[w.jsx(Xt,{size:"md",weight:"semibold",children:e}),w.jsx(Xt,{size:"sm",weight:"regular",children:t})]}),i&&w.jsx("div",{className:Fh.actions,children:i})]}),s&&w.jsx(qq,{onClick:s,"aria-label":"Close",role:"button",className:Fh.close,children:w.jsx(Vw,{})})]})},Q1e="@",e_e="#",t_e="+",n_e=new Intl.Segmenter;function r_e(n){if(n.length<1)return"";const e=n[0];[Q1e,e_e,t_e].includes(e)&&(n=n.substring(1));const t=n_e.segment(n)[Symbol.iterator]().next();return t.done?"":t.value.segment}const i_e="_avatar_mcap2_17",s_e="_image_mcap2_50",jI={avatar:i_e,image:s_e,"avatar-imageless":"_avatar-imageless_mcap2_61"};function o_e(n){return n.split("").reduce((i,s)=>i+s.charCodeAt(0),0)%6+1}function a_e(n){return!!(n.onClick||n.onKeyDown||n.onKeyUp)}const c_e=_.forwardRef(function({src:e,id:t,name:r="",type:i="round",className:s="",size:o,style:a={},onError:c,...l},u){return Re.createElement(a_e(l)?"button":"span",{ref:u,role:"img","aria-label":t,...l,"data-type":i,"data-color":o_e(t),className:De(jI.avatar,s,{[jI["avatar-imageless"]]:!e}),style:{...a,"--cpd-avatar-size":o}},w.jsx(Re.Fragment,{children:e?w.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:De(jI.image),"data-type":i,style:a,width:o,height:o,onError:c}):r_e(r)}))});function Ze(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function l_e(n,e){const t=_.createContext(e),r=s=>{const{children:o,...a}=s,c=_.useMemo(()=>a,Object.values(a));return w.jsx(t.Provider,{value:c,children:o})};r.displayName=n+"Provider";function i(s){const o=_.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${n}\``)}return[r,i]}function Ba(n,e=[]){let t=[];function r(s,o){const a=_.createContext(o),c=t.length;t=[...t,o];const l=h=>{var b;const{scope:p,children:m,...v}=h,g=((b=p==null?void 0:p[n])==null?void 0:b[c])||a,S=_.useMemo(()=>v,Object.values(v));return w.jsx(g.Provider,{value:S,children:m})};l.displayName=s+"Provider";function u(h,p){var g;const m=((g=p==null?void 0:p[n])==null?void 0:g[c])||a,v=_.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,u]}const i=()=>{const s=t.map(o=>_.createContext(o));return function(a){const c=(a==null?void 0:a[n])||s;return _.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return i.scopeName=n,[r,u_e(i,...e)]}function u_e(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function C9(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Ha(...n){return e=>{let t=!1;const r=n.map(i=>{const s=C9(i,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():C9(n[i],null)}}}}function sn(...n){return _.useCallback(Ha(...n),n)}var np=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(h_e);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(y3,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(y3,{...r,ref:e,children:t})});np.displayName="Slot";var y3=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=p_e(t);return _.cloneElement(t,{...f_e(r,t.props),ref:e?Ha(e,i):i})}return _.Children.count(t)>1?_.Children.only(null):null});y3.displayName="SlotClone";var d_e=({children:n})=>w.jsx(w.Fragment,{children:n});function h_e(n){return _.isValidElement(n)&&n.type===d_e}function f_e(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function p_e(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var m_e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Jn=m_e.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?np:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function g_e(n,e){n&&Sp.flushSync(()=>n.dispatchEvent(e))}function Kq(n){const e=n+"CollectionProvider",[t,r]=Ba(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:v,children:g}=m,S=Re.useRef(null),b=Re.useRef(new Map).current;return w.jsx(i,{scope:v,itemMap:b,collectionRef:S,children:g})};o.displayName=e;const a=n+"CollectionSlot",c=Re.forwardRef((m,v)=>{const{scope:g,children:S}=m,b=s(a,g),R=sn(v,b.collectionRef);return w.jsx(np,{ref:R,children:S})});c.displayName=a;const l=n+"CollectionItemSlot",u="data-radix-collection-item",h=Re.forwardRef((m,v)=>{const{scope:g,children:S,...b}=m,R=Re.useRef(null),k=sn(v,R),I=s(l,g);return Re.useEffect(()=>(I.itemMap.set(R,{ref:R,...b}),()=>void I.itemMap.delete(R))),w.jsx(np,{[u]:"",ref:k,children:S})});h.displayName=l;function p(m){const v=s(n+"CollectionConsumer",m);return Re.useCallback(()=>{const S=v.collectionRef.current;if(!S)return[];const b=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((I,T)=>b.indexOf(I.ref.current)-b.indexOf(T.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:c,ItemSlot:h},p,r]}var v_e=_.createContext(void 0);function M6(n){const e=_.useContext(v_e);return n||e||"ltr"}var Wq=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(__e);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(_3,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(_3,{...r,ref:e,children:t})});Wq.displayName="Slot";var _3=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=S_e(t),s=b_e(r,t.props);return t.type!==_.Fragment&&(s.ref=e?Ha(e,i):i),_.cloneElement(t,s)}return _.Children.count(t)>1?_.Children.only(null):null});_3.displayName="SlotClone";var y_e=({children:n})=>w.jsx(w.Fragment,{children:n});function __e(n){return _.isValidElement(n)&&n.type===y_e}function b_e(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function S_e(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var w_e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],zq=w_e.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Wq:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function E_e(n,e){n&&Sp.flushSync(()=>n.dispatchEvent(e))}function rs(n){const e=_.useRef(n);return _.useEffect(()=>{e.current=n}),_.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function C_e(n,e=globalThis==null?void 0:globalThis.document){const t=rs(n);_.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var T_e="DismissableLayer",b3="dismissableLayer.update",I_e="dismissableLayer.pointerDownOutside",R_e="dismissableLayer.focusOutside",T9,Yq=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),O6=_.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...c}=n,l=_.useContext(Yq),[u,h]=_.useState(null),p=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=_.useState({}),v=sn(e,P=>h(P)),g=Array.from(l.layers),[S]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=g.indexOf(S),R=u?g.indexOf(u):-1,k=l.layersWithOutsidePointerEventsDisabled.size>0,I=R>=b,T=P_e(P=>{const M=P.target,D=[...l.branches].some(F=>F.contains(M));!I||D||(i==null||i(P),o==null||o(P),P.defaultPrevented||a==null||a())},p),C=L_e(P=>{const M=P.target;[...l.branches].some(F=>F.contains(M))||(s==null||s(P),o==null||o(P),P.defaultPrevented||a==null||a())},p);return C_e(P=>{R===l.layers.size-1&&(r==null||r(P),!P.defaultPrevented&&a&&(P.preventDefault(),a()))},p),_.useEffect(()=>{if(u)return t&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(T9=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),I9(),()=>{t&&l.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=T9)}},[u,p,t,l]),_.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),I9())},[u,l]),_.useEffect(()=>{const P=()=>m({});return document.addEventListener(b3,P),()=>document.removeEventListener(b3,P)},[]),w.jsx(zq.div,{...c,ref:v,style:{pointerEvents:k?I?"auto":"none":void 0,...n.style},onFocusCapture:Ze(n.onFocusCapture,C.onFocusCapture),onBlurCapture:Ze(n.onBlurCapture,C.onBlurCapture),onPointerDownCapture:Ze(n.onPointerDownCapture,T.onPointerDownCapture)})});O6.displayName=T_e;var k_e="DismissableLayerBranch",x_e=_.forwardRef((n,e)=>{const t=_.useContext(Yq),r=_.useRef(null),i=sn(e,r);return _.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),w.jsx(zq.div,{...n,ref:i})});x_e.displayName=k_e;function P_e(n,e=globalThis==null?void 0:globalThis.document){const t=rs(n),r=_.useRef(!1),i=_.useRef(()=>{});return _.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){Xq(I_e,t,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function L_e(n,e=globalThis==null?void 0:globalThis.document){const t=rs(n),r=_.useRef(!1);return _.useEffect(()=>{const i=s=>{s.target&&!r.current&&Xq(R_e,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function I9(){const n=new CustomEvent(b3);document.dispatchEvent(n)}function Xq(n,e,t,{discrete:r}){const i=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?E_e(i,s):i.dispatchEvent(s)}var $I=0;function Jq(){_.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??R9()),document.body.insertAdjacentElement("beforeend",n[1]??R9()),$I++,()=>{$I===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),$I--}},[])}function R9(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var BI="focusScope.autoFocusOnMount",HI="focusScope.autoFocusOnUnmount",k9={bubbles:!1,cancelable:!0},A_e="FocusScope",Zq=_.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=n,[a,c]=_.useState(null),l=rs(i),u=rs(s),h=_.useRef(null),p=sn(e,g=>c(g)),m=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let g=function(k){if(m.paused||!a)return;const I=k.target;a.contains(I)?h.current=I:wl(h.current,{select:!0})},S=function(k){if(m.paused||!a)return;const I=k.relatedTarget;I!==null&&(a.contains(I)||wl(h.current,{select:!0}))},b=function(k){if(document.activeElement===document.body)for(const T of k)T.removedNodes.length>0&&wl(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",S);const R=new MutationObserver(b);return a&&R.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",S),R.disconnect()}}},[r,a,m.paused]),_.useEffect(()=>{if(a){P9.add(m);const g=document.activeElement;if(!a.contains(g)){const b=new CustomEvent(BI,k9);a.addEventListener(BI,l),a.dispatchEvent(b),b.defaultPrevented||(M_e(U_e(Qq(a)),{select:!0}),document.activeElement===g&&wl(a))}return()=>{a.removeEventListener(BI,l),setTimeout(()=>{const b=new CustomEvent(HI,k9);a.addEventListener(HI,u),a.dispatchEvent(b),b.defaultPrevented||wl(g??document.body,{select:!0}),a.removeEventListener(HI,u),P9.remove(m)},0)}}},[a,l,u,m]);const v=_.useCallback(g=>{if(!t&&!r||m.paused)return;const S=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,b=document.activeElement;if(S&&b){const R=g.currentTarget,[k,I]=O_e(R);k&&I?!g.shiftKey&&b===I?(g.preventDefault(),t&&wl(k,{select:!0})):g.shiftKey&&b===k&&(g.preventDefault(),t&&wl(I,{select:!0})):b===R&&g.preventDefault()}},[t,r,m.paused]);return w.jsx(Jn.div,{tabIndex:-1,...o,ref:p,onKeyDown:v})});Zq.displayName=A_e;function M_e(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(wl(r,{select:e}),document.activeElement!==t)return}function O_e(n){const e=Qq(n),t=x9(e,n),r=x9(e.reverse(),n);return[t,r]}function Qq(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function x9(n,e){for(const t of n)if(!N_e(t,{upTo:e}))return t}function N_e(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function D_e(n){return n instanceof HTMLInputElement&&"select"in n}function wl(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&D_e(n)&&e&&n.select()}}var P9=F_e();function F_e(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=L9(n,e),n.unshift(e)},remove(e){var t;n=L9(n,e),(t=n[0])==null||t.resume()}}}function L9(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function U_e(n){return n.filter(e=>e.tagName!=="A")}var cu=globalThis!=null&&globalThis.document?_.useLayoutEffect:()=>{},j_e=TB.useId||(()=>{}),$_e=0;function Tc(n){const[e,t]=_.useState(j_e());return cu(()=>{t(r=>r??String($_e++))},[n]),n||(e?`radix-${e}`:"")}var B_e="Arrow",eK=_.forwardRef((n,e)=>{const{children:t,width:r=10,height:i=5,...s}=n;return w.jsx(Jn.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:w.jsx("polygon",{points:"0,0 30,0 15,10"})})});eK.displayName=B_e;var H_e=eK;function tK(n){const[e,t]=_.useState(void 0);return cu(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var N6="Popper",[nK,rK]=Ba(N6),[V_e,iK]=nK(N6),sK=n=>{const{__scopePopper:e,children:t}=n,[r,i]=_.useState(null);return w.jsx(V_e,{scope:e,anchor:r,onAnchorChange:i,children:t})};sK.displayName=N6;var oK="PopperAnchor",aK=_.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,s=iK(oK,t),o=_.useRef(null),a=sn(e,o);return _.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||o.current)}),r?null:w.jsx(Jn.div,{...i,ref:a})});aK.displayName=oK;var D6="PopperContent",[G_e,q_e]=nK(D6),cK=_.forwardRef((n,e)=>{var xe,Ee,Ce,Ve,vt,Jt;const{__scopePopper:t,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:p=!1,updatePositionStrategy:m="optimized",onPlaced:v,...g}=n,S=iK(D6,t),[b,R]=_.useState(null),k=sn(e,Et=>R(Et)),[I,T]=_.useState(null),C=tK(I),P=(C==null?void 0:C.width)??0,M=(C==null?void 0:C.height)??0,D=r+(s!=="center"?"-"+s:""),F=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},U=Array.isArray(l)?l:[l],B=U.length>0,V={padding:F,boundary:U.filter(W_e),altBoundary:B},{refs:z,floatingStyles:H,placement:J,isPositioned:Y,middlewareData:G}=Lq({strategy:"fixed",placement:D,whileElementsMounted:(...Et)=>xq(...Et,{animationFrame:m==="always"}),elements:{reference:S.anchor},middleware:[Aq({mainAxis:i+M,alignmentAxis:o}),c&&Mq({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?u1e():void 0,...V}),c&&Oq({...V}),d1e({...V,apply:({elements:Et,rects:Be,availableWidth:Zn,availableHeight:In})=>{const{width:Qn,height:os}=Be.reference,pi=Et.floating.style;pi.setProperty("--radix-popper-available-width",`${Zn}px`),pi.setProperty("--radix-popper-available-height",`${In}px`),pi.setProperty("--radix-popper-anchor-width",`${Qn}px`),pi.setProperty("--radix-popper-anchor-height",`${os}px`)}}),I&&Nq({element:I,padding:a}),z_e({arrowWidth:P,arrowHeight:M}),p&&h1e({strategy:"referenceHidden",...V})]}),[K,ee]=dK(J),q=rs(v);cu(()=>{Y&&(q==null||q())},[Y,q]);const Q=(xe=G.arrow)==null?void 0:xe.x,Se=(Ee=G.arrow)==null?void 0:Ee.y,Ie=((Ce=G.arrow)==null?void 0:Ce.centerOffset)!==0,[Ne,Le]=_.useState();return cu(()=>{b&&Le(window.getComputedStyle(b).zIndex)},[b]),w.jsx("div",{ref:z.setFloating,"data-radix-popper-content-wrapper":"",style:{...H,transform:Y?H.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ne,"--radix-popper-transform-origin":[(Ve=G.transformOrigin)==null?void 0:Ve.x,(vt=G.transformOrigin)==null?void 0:vt.y].join(" "),...((Jt=G.hide)==null?void 0:Jt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:w.jsx(G_e,{scope:t,placedSide:K,onArrowChange:T,arrowX:Q,arrowY:Se,shouldHideArrow:Ie,children:w.jsx(Jn.div,{"data-side":K,"data-align":ee,...g,ref:k,style:{...g.style,animation:Y?void 0:"none"}})})})});cK.displayName=D6;var lK="PopperArrow",K_e={top:"bottom",right:"left",bottom:"top",left:"right"},uK=_.forwardRef(function(e,t){const{__scopePopper:r,...i}=e,s=q_e(lK,r),o=K_e[s.placedSide];return w.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:w.jsx(H_e,{...i,ref:t,style:{...i.style,display:"block"}})})});uK.displayName=lK;function W_e(n){return n!==null}var z_e=n=>({name:"transformOrigin",options:n,fn(e){var S,b,R;const{placement:t,rects:r,middlewareData:i}=e,o=((S=i.arrow)==null?void 0:S.centerOffset)!==0,a=o?0:n.arrowWidth,c=o?0:n.arrowHeight,[l,u]=dK(t),h={start:"0%",center:"50%",end:"100%"}[u],p=(((b=i.arrow)==null?void 0:b.x)??0)+a/2,m=(((R=i.arrow)==null?void 0:R.y)??0)+c/2;let v="",g="";return l==="bottom"?(v=o?h:`${p}px`,g=`${-c}px`):l==="top"?(v=o?h:`${p}px`,g=`${r.floating.height+c}px`):l==="right"?(v=`${-c}px`,g=o?h:`${m}px`):l==="left"&&(v=`${r.floating.width+c}px`,g=o?h:`${m}px`),{data:{x:v,y:g}}}});function dK(n){const[e,t="center"]=n.split("-");return[e,t]}var Y_e=sK,X_e=aK,J_e=cK,Z_e=uK,Q_e="Portal",hK=_.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[i,s]=_.useState(!1);cu(()=>s(!0),[]);const o=t||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?OV.createPortal(w.jsx(Jn.div,{...r,ref:e}),o):null});hK.displayName=Q_e;function ebe(n,e){return _.useReducer((t,r)=>e[t][r]??t,n)}var _u=n=>{const{present:e,children:t}=n,r=tbe(e),i=typeof t=="function"?t({present:r.isPresent}):_.Children.only(t),s=sn(r.ref,nbe(i));return typeof t=="function"||r.isPresent?_.cloneElement(i,{ref:s}):null};_u.displayName="Presence";function tbe(n){const[e,t]=_.useState(),r=_.useRef({}),i=_.useRef(n),s=_.useRef("none"),o=n?"mounted":"unmounted",[a,c]=ebe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const l=T1(r.current);s.current=a==="mounted"?l:"none"},[a]),cu(()=>{const l=r.current,u=i.current;if(u!==n){const p=s.current,m=T1(l);n?c("MOUNT"):m==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&p!==m?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,c]),cu(()=>{if(e){let l;const u=e.ownerDocument.defaultView??window,h=m=>{const g=T1(r.current).includes(m.animationName);if(m.target===e&&g&&(c("ANIMATION_END"),!i.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",l=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},p=m=>{m.target===e&&(s.current=T1(r.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(l),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(l=>{l&&(r.current=getComputedStyle(l)),t(l)},[])}}function T1(n){return(n==null?void 0:n.animationName)||"none"}function nbe(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function zw({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=rbe({defaultProp:e,onChange:t}),s=n!==void 0,o=s?n:r,a=rs(t),c=_.useCallback(l=>{if(s){const h=typeof l=="function"?l(n):l;h!==n&&a(h)}else i(l)},[s,n,i,a]);return[o,c]}function rbe({defaultProp:n,onChange:e}){const t=_.useState(n),[r]=t,i=_.useRef(r),s=rs(e);return _.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),t}var VI="rovingFocusGroup.onEntryFocus",ibe={bubbles:!1,cancelable:!0},Yw="RovingFocusGroup",[S3,fK,sbe]=Kq(Yw),[obe,pK]=Ba(Yw,[sbe]),[abe,cbe]=obe(Yw),mK=_.forwardRef((n,e)=>w.jsx(S3.Provider,{scope:n.__scopeRovingFocusGroup,children:w.jsx(S3.Slot,{scope:n.__scopeRovingFocusGroup,children:w.jsx(lbe,{...n,ref:e})})}));mK.displayName=Yw;var lbe=_.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:u=!1,...h}=n,p=_.useRef(null),m=sn(e,p),v=M6(s),[g=null,S]=zw({prop:o,defaultProp:a,onChange:c}),[b,R]=_.useState(!1),k=rs(l),I=fK(t),T=_.useRef(!1),[C,P]=_.useState(0);return _.useEffect(()=>{const M=p.current;if(M)return M.addEventListener(VI,k),()=>M.removeEventListener(VI,k)},[k]),w.jsx(abe,{scope:t,orientation:r,dir:v,loop:i,currentTabStopId:g,onItemFocus:_.useCallback(M=>S(M),[S]),onItemShiftTab:_.useCallback(()=>R(!0),[]),onFocusableItemAdd:_.useCallback(()=>P(M=>M+1),[]),onFocusableItemRemove:_.useCallback(()=>P(M=>M-1),[]),children:w.jsx(Jn.div,{tabIndex:b||C===0?-1:0,"data-orientation":r,...h,ref:m,style:{outline:"none",...n.style},onMouseDown:Ze(n.onMouseDown,()=>{T.current=!0}),onFocus:Ze(n.onFocus,M=>{const D=!T.current;if(M.target===M.currentTarget&&D&&!b){const F=new CustomEvent(VI,ibe);if(M.currentTarget.dispatchEvent(F),!F.defaultPrevented){const U=I().filter(J=>J.focusable),B=U.find(J=>J.active),V=U.find(J=>J.id===g),H=[B,V,...U].filter(Boolean).map(J=>J.ref.current);yK(H,u)}}T.current=!1}),onBlur:Ze(n.onBlur,()=>R(!1))})})}),gK="RovingFocusGroupItem",vK=_.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:s,...o}=n,a=Tc(),c=s||a,l=cbe(gK,t),u=l.currentTabStopId===c,h=fK(t),{onFocusableItemAdd:p,onFocusableItemRemove:m}=l;return _.useEffect(()=>{if(r)return p(),()=>m()},[r,p,m]),w.jsx(S3.ItemSlot,{scope:t,id:c,focusable:r,active:i,children:w.jsx(Jn.span,{tabIndex:u?0:-1,"data-orientation":l.orientation,...o,ref:e,onMouseDown:Ze(n.onMouseDown,v=>{r?l.onItemFocus(c):v.preventDefault()}),onFocus:Ze(n.onFocus,()=>l.onItemFocus(c)),onKeyDown:Ze(n.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){l.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const g=hbe(v,l.orientation,l.dir);if(g!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let b=h().filter(R=>R.focusable).map(R=>R.ref.current);if(g==="last")b.reverse();else if(g==="prev"||g==="next"){g==="prev"&&b.reverse();const R=b.indexOf(v.currentTarget);b=l.loop?fbe(b,R+1):b.slice(R+1)}setTimeout(()=>yK(b))}})})})});vK.displayName=gK;var ube={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function dbe(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function hbe(n,e,t){const r=dbe(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return ube[r]}function yK(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function fbe(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var pbe=mK,mbe=vK,gbe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Uh=new WeakMap,I1=new WeakMap,R1={},GI=0,_K=function(n){return n&&(n.host||_K(n.parentNode))},vbe=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=_K(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},ybe=function(n,e,t,r){var i=vbe(e,Array.isArray(n)?n:[n]);R1[t]||(R1[t]=new WeakMap);var s=R1[t],o=[],a=new Set,c=new Set(i),l=function(h){!h||a.has(h)||(a.add(h),l(h.parentNode))};i.forEach(l);var u=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(a.has(p))u(p);else try{var m=p.getAttribute(r),v=m!==null&&m!=="false",g=(Uh.get(p)||0)+1,S=(s.get(p)||0)+1;Uh.set(p,g),s.set(p,S),o.push(p),g===1&&v&&I1.set(p,!0),S===1&&p.setAttribute(t,"true"),v||p.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",p,b)}})};return u(e),a.clear(),GI++,function(){o.forEach(function(h){var p=Uh.get(h)-1,m=s.get(h)-1;Uh.set(h,p),s.set(h,m),p||(I1.has(h)||h.removeAttribute(r),I1.delete(h)),m||h.removeAttribute(t)}),GI--,GI||(Uh=new WeakMap,Uh=new WeakMap,I1=new WeakMap,R1={})}},bK=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=gbe(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),ybe(r,i,t,"aria-hidden")):function(){return null}},w3=function(n,e){return w3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},w3(n,e)};function oo(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");w3(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ar=function(){return Ar=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ar.apply(this,arguments)};function yy(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function SK(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function wK(n,e){return function(t,r){e(t,r,n)}}function EK(n,e,t,r,i,s){function o(b){if(b!==void 0&&typeof b!="function")throw new TypeError("Function expected");return b}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,p=!1,m=t.length-1;m>=0;m--){var v={};for(var g in r)v[g]=g==="access"?{}:r[g];for(var g in r.access)v.access[g]=r.access[g];v.addInitializer=function(b){if(p)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(b||null))};var S=(0,t[m])(a==="accessor"?{get:u.get,set:u.set}:u[c],v);if(a==="accessor"){if(S===void 0)continue;if(S===null||typeof S!="object")throw new TypeError("Object expected");(h=o(S.get))&&(u.get=h),(h=o(S.set))&&(u.set=h),(h=o(S.init))&&i.unshift(h)}else(h=o(S))&&(a==="field"?i.unshift(h):u[c]=h)}l&&Object.defineProperty(l,r.name,u),p=!0}function CK(n,e,t){for(var r=arguments.length>2,i=0;i<e.length;i++)t=r?e[i].call(n,t):e[i].call(n);return r?t:void 0}function TK(n){return typeof n=="symbol"?n:"".concat(n)}function IK(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function RK(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function F6(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function Xw(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var Jw=Object.create?function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]};function kK(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Jw(e,n,t)}function lu(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ro(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function xK(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(ro(arguments[e]));return n}function PK(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function io(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Ic(n){return this instanceof Ic?(this.v=n,this):new Ic(n)}function U6(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(m){return function(v){return Promise.resolve(v).then(m,h)}}function a(m,v){r[m]&&(i[m]=function(g){return new Promise(function(S,b){s.push([m,g,S,b])>1||c(m,g)})},v&&(i[m]=v(i[m])))}function c(m,v){try{l(r[m](v))}catch(g){p(s[0][3],g)}}function l(m){m.value instanceof Ic?Promise.resolve(m.value.v).then(u,h):p(s[0][2],m)}function u(m){c("next",m)}function h(m){c("throw",m)}function p(m,v){m(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function LK(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Ic(n[i](o)),done:!1}:s?s(o):o}:s}}function j6(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof lu=="function"?lu(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function AK(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var _be=Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e},E3=function(n){return E3=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},E3(n)};function MK(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=E3(n),r=0;r<t.length;r++)t[r]!=="default"&&Jw(e,n,t[r]);return _be(e,n),e}function OK(n){return n&&n.__esModule?n:{default:n}}function NK(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function DK(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function FK(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function UK(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var bbe=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function jK(n){function e(s){n.error=n.hasError?new bbe(s,n.error,"An error was suppressed during disposal."):s,n.hasError=!0}var t,r=0;function i(){for(;t=n.stack.pop();)try{if(!t.async&&r===1)return r=0,n.stack.push(t),Promise.resolve().then(i);if(t.dispose){var s=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return i()}function $K(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?t:i+s+"."+o.toLowerCase()+"js"}):n}const Sbe={__extends:oo,__assign:Ar,__rest:yy,__decorate:SK,__param:wK,__esDecorate:EK,__runInitializers:CK,__propKey:TK,__setFunctionName:IK,__metadata:RK,__awaiter:F6,__generator:Xw,__createBinding:Jw,__exportStar:kK,__values:lu,__read:ro,__spread:xK,__spreadArrays:PK,__spreadArray:io,__await:Ic,__asyncGenerator:U6,__asyncDelegator:LK,__asyncValues:j6,__makeTemplateObject:AK,__importStar:MK,__importDefault:OK,__classPrivateFieldGet:NK,__classPrivateFieldSet:DK,__classPrivateFieldIn:FK,__addDisposableResource:UK,__disposeResources:jK,__rewriteRelativeImportExtension:$K},tqe=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:UK,get __assign(){return Ar},__asyncDelegator:LK,__asyncGenerator:U6,__asyncValues:j6,__await:Ic,__awaiter:F6,__classPrivateFieldGet:NK,__classPrivateFieldIn:FK,__classPrivateFieldSet:DK,__createBinding:Jw,__decorate:SK,__disposeResources:jK,__esDecorate:EK,__exportStar:kK,__extends:oo,__generator:Xw,__importDefault:OK,__importStar:MK,__makeTemplateObject:AK,__metadata:RK,__param:wK,__propKey:TK,__read:ro,__rest:yy,__rewriteRelativeImportExtension:$K,__runInitializers:CK,__setFunctionName:IK,__spread:xK,__spreadArray:io,__spreadArrays:PK,__values:lu,default:Sbe},Symbol.toStringTag,{value:"Module"}));var Ug="right-scroll-bar-position",jg="width-before-scroll-bar",wbe="with-scroll-bars-hidden",Ebe="--removed-body-scroll-bar-size";function qI(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Cbe(n,e){var t=_.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var Tbe=typeof window<"u"?_.useLayoutEffect:_.useEffect,A9=new WeakMap;function BK(n,e){var t=Cbe(null,function(r){return n.forEach(function(i){return qI(i,r)})});return Tbe(function(){var r=A9.get(t);if(r){var i=new Set(r),s=new Set(n),o=t.current;i.forEach(function(a){s.has(a)||qI(a,null)}),s.forEach(function(a){i.has(a)||qI(a,o)})}A9.set(t,n)},[n]),t}function Ibe(n){return n}function Rbe(n,e){e===void 0&&(e=Ibe);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var o=e(s,r);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;t.length;){var o=t;t=[],o.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){r=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(s),o=t}var c=function(){var u=o;o=[],u.forEach(s)},l=function(){return Promise.resolve().then(c)};l(),t={push:function(u){o.push(u),l()},filter:function(u){return o=o.filter(u),t}}}};return i}function HK(n){n===void 0&&(n={});var e=Rbe(null);return e.options=Ar({async:!0,ssr:!1},n),e}var VK=function(n){var e=n.sideCar,t=yy(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,Ar({},t))};VK.isSideCarExport=!0;function GK(n,e){return n.useMedium(e),VK}var qK=HK(),KI=function(){},Zw=_.forwardRef(function(n,e){var t=_.useRef(null),r=_.useState({onScrollCapture:KI,onWheelCapture:KI,onTouchMoveCapture:KI}),i=r[0],s=r[1],o=n.forwardProps,a=n.children,c=n.className,l=n.removeScrollBar,u=n.enabled,h=n.shards,p=n.sideCar,m=n.noIsolation,v=n.inert,g=n.allowPinchZoom,S=n.as,b=S===void 0?"div":S,R=n.gapMode,k=yy(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),I=p,T=BK([t,e]),C=Ar(Ar({},k),i);return _.createElement(_.Fragment,null,u&&_.createElement(I,{sideCar:qK,removeScrollBar:l,shards:h,noIsolation:m,inert:v,setCallbacks:s,allowPinchZoom:!!g,lockRef:t,gapMode:R}),o?_.cloneElement(_.Children.only(a),Ar(Ar({},C),{ref:T})):_.createElement(b,Ar({},C,{className:c,ref:T}),a))});Zw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Zw.classNames={fullWidth:jg,zeroRight:Ug};var kbe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xbe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=kbe();return e&&n.setAttribute("nonce",e),n}function Pbe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Lbe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Abe=function(){var n=0,e=null;return{add:function(t){n==0&&(e=xbe())&&(Pbe(e,t),Lbe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Mbe=function(){var n=Abe();return function(e,t){_.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},$6=function(){var n=Mbe(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},Obe={left:0,top:0,right:0,gap:0},WI=function(n){return parseInt(n||"",10)||0},Nbe=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[WI(t),WI(r),WI(i)]},Dbe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Obe;var e=Nbe(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},Fbe=$6(),Lf="data-scroll-locked",Ube=function(n,e,t,r){var i=n.left,s=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(wbe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Lf,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Ug,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(jg,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Ug," .").concat(Ug,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(jg," .").concat(jg,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Lf,`] {
    `).concat(Ebe,": ").concat(a,`px;
  }
`)},M9=function(){var n=parseInt(document.body.getAttribute(Lf)||"0",10);return isFinite(n)?n:0},jbe=function(){_.useEffect(function(){return document.body.setAttribute(Lf,(M9()+1).toString()),function(){var n=M9()-1;n<=0?document.body.removeAttribute(Lf):document.body.setAttribute(Lf,n.toString())}},[])},KK=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;jbe();var s=_.useMemo(function(){return Dbe(i)},[i]);return _.createElement(Fbe,{styles:Ube(s,!e,i,t?"":"!important")})},C3=!1;if(typeof window<"u")try{var k1=Object.defineProperty({},"passive",{get:function(){return C3=!0,!0}});window.addEventListener("test",k1,k1),window.removeEventListener("test",k1,k1)}catch{C3=!1}var jh=C3?{passive:!1}:!1,$be=function(n){return n.tagName==="TEXTAREA"},WK=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!$be(n)&&t[e]==="visible")},Bbe=function(n){return WK(n,"overflowY")},Hbe=function(n){return WK(n,"overflowX")},O9=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=zK(n,r);if(i){var s=YK(n,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},Vbe=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Gbe=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},zK=function(n,e){return n==="v"?Bbe(e):Hbe(e)},YK=function(n,e){return n==="v"?Vbe(e):Gbe(e)},qbe=function(n,e){return n==="h"&&e==="rtl"?-1:1},Kbe=function(n,e,t,r,i){var s=qbe(n,window.getComputedStyle(e).direction),o=s*r,a=t.target,c=e.contains(a),l=!1,u=o>0,h=0,p=0;do{var m=YK(n,a),v=m[0],g=m[1],S=m[2],b=g-S-s*v;(v||b)&&zK(n,a)&&(h+=b,p+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(l=!0),l},x1=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},N9=function(n){return[n.deltaX,n.deltaY]},D9=function(n){return n&&"current"in n?n.current:n},Wbe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},zbe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Ybe=0,$h=[];function Xbe(n){var e=_.useRef([]),t=_.useRef([0,0]),r=_.useRef(),i=_.useState(Ybe++)[0],s=_.useState($6)[0],o=_.useRef(n);_.useEffect(function(){o.current=n},[n]),_.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var g=io([n.lockRef.current],(n.shards||[]).map(D9),!0).filter(Boolean);return g.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),g.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=_.useCallback(function(g,S){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var b=x1(g),R=t.current,k="deltaX"in g?g.deltaX:R[0]-b[0],I="deltaY"in g?g.deltaY:R[1]-b[1],T,C=g.target,P=Math.abs(k)>Math.abs(I)?"h":"v";if("touches"in g&&P==="h"&&C.type==="range")return!1;var M=O9(P,C);if(!M)return!0;if(M?T=P:(T=P==="v"?"h":"v",M=O9(P,C)),!M)return!1;if(!r.current&&"changedTouches"in g&&(k||I)&&(r.current=T),!T)return!0;var D=r.current||T;return Kbe(D,S,g,D==="h"?k:I)},[]),c=_.useCallback(function(g){var S=g;if(!(!$h.length||$h[$h.length-1]!==s)){var b="deltaY"in S?N9(S):x1(S),R=e.current.filter(function(T){return T.name===S.type&&(T.target===S.target||S.target===T.shadowParent)&&Wbe(T.delta,b)})[0];if(R&&R.should){S.cancelable&&S.preventDefault();return}if(!R){var k=(o.current.shards||[]).map(D9).filter(Boolean).filter(function(T){return T.contains(S.target)}),I=k.length>0?a(S,k[0]):!o.current.noIsolation;I&&S.cancelable&&S.preventDefault()}}},[]),l=_.useCallback(function(g,S,b,R){var k={name:g,delta:S,target:b,should:R,shadowParent:Jbe(b)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(I){return I!==k})},1)},[]),u=_.useCallback(function(g){t.current=x1(g),r.current=void 0},[]),h=_.useCallback(function(g){l(g.type,N9(g),g.target,a(g,n.lockRef.current))},[]),p=_.useCallback(function(g){l(g.type,x1(g),g.target,a(g,n.lockRef.current))},[]);_.useEffect(function(){return $h.push(s),n.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,jh),document.addEventListener("touchmove",c,jh),document.addEventListener("touchstart",u,jh),function(){$h=$h.filter(function(g){return g!==s}),document.removeEventListener("wheel",c,jh),document.removeEventListener("touchmove",c,jh),document.removeEventListener("touchstart",u,jh)}},[]);var m=n.removeScrollBar,v=n.inert;return _.createElement(_.Fragment,null,v?_.createElement(s,{styles:zbe(i)}):null,m?_.createElement(KK,{gapMode:n.gapMode}):null)}function Jbe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const Zbe=GK(qK,Xbe);var XK=_.forwardRef(function(n,e){return _.createElement(Zw,Ar({},n,{ref:e,sideCar:Zbe}))});XK.classNames=Zw.classNames;var T3=["Enter"," "],Qbe=["ArrowDown","PageUp","Home"],JK=["ArrowUp","PageDown","End"],eSe=[...Qbe,...JK],tSe={ltr:[...T3,"ArrowRight"],rtl:[...T3,"ArrowLeft"]},nSe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},_y="Menu",[Tv,rSe,iSe]=Kq(_y),[Yd,Qw]=Ba(_y,[iSe,rK,pK]),eE=rK(),ZK=pK(),[sSe,Xd]=Yd(_y),[oSe,by]=Yd(_y),QK=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=n,a=eE(e),[c,l]=_.useState(null),u=_.useRef(!1),h=rs(s),p=M6(i);return _.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),w.jsx(Y_e,{...a,children:w.jsx(sSe,{scope:e,open:t,onOpenChange:h,content:c,onContentChange:l,children:w.jsx(oSe,{scope:e,onClose:_.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:u,dir:p,modal:o,children:r})})})};QK.displayName=_y;var aSe="MenuAnchor",B6=_.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=eE(t);return w.jsx(X_e,{...i,...r,ref:e})});B6.displayName=aSe;var H6="MenuPortal",[cSe,eW]=Yd(H6,{forceMount:void 0}),tW=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,s=Xd(H6,e);return w.jsx(cSe,{scope:e,forceMount:t,children:w.jsx(_u,{present:t||s.open,children:w.jsx(hK,{asChild:!0,container:i,children:r})})})};tW.displayName=H6;var Zs="MenuContent",[lSe,V6]=Yd(Zs),nW=_.forwardRef((n,e)=>{const t=eW(Zs,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=Xd(Zs,n.__scopeMenu),o=by(Zs,n.__scopeMenu);return w.jsx(Tv.Provider,{scope:n.__scopeMenu,children:w.jsx(_u,{present:r||s.open,children:w.jsx(Tv.Slot,{scope:n.__scopeMenu,children:o.modal?w.jsx(uSe,{...i,ref:e}):w.jsx(dSe,{...i,ref:e})})})})}),uSe=_.forwardRef((n,e)=>{const t=Xd(Zs,n.__scopeMenu),r=_.useRef(null),i=sn(e,r);return _.useEffect(()=>{const s=r.current;if(s)return bK(s)},[]),w.jsx(G6,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:Ze(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),dSe=_.forwardRef((n,e)=>{const t=Xd(Zs,n.__scopeMenu);return w.jsx(G6,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),G6=_.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:p,onDismiss:m,disableOutsideScroll:v,...g}=n,S=Xd(Zs,t),b=by(Zs,t),R=eE(t),k=ZK(t),I=rSe(t),[T,C]=_.useState(null),P=_.useRef(null),M=sn(e,P,S.onContentChange),D=_.useRef(0),F=_.useRef(""),U=_.useRef(0),B=_.useRef(null),V=_.useRef("right"),z=_.useRef(0),H=v?XK:_.Fragment,J=v?{as:np,allowPinchZoom:!0}:void 0,Y=K=>{var xe,Ee;const ee=F.current+K,q=I().filter(Ce=>!Ce.disabled),Q=document.activeElement,Se=(xe=q.find(Ce=>Ce.ref.current===Q))==null?void 0:xe.textValue,Ie=q.map(Ce=>Ce.textValue),Ne=ESe(Ie,ee,Se),Le=(Ee=q.find(Ce=>Ce.textValue===Ne))==null?void 0:Ee.ref.current;(function Ce(Ve){F.current=Ve,window.clearTimeout(D.current),Ve!==""&&(D.current=window.setTimeout(()=>Ce(""),1e3))})(ee),Le&&setTimeout(()=>Le.focus())};_.useEffect(()=>()=>window.clearTimeout(D.current),[]),Jq();const G=_.useCallback(K=>{var q,Q;return V.current===((q=B.current)==null?void 0:q.side)&&TSe(K,(Q=B.current)==null?void 0:Q.area)},[]);return w.jsx(lSe,{scope:t,searchRef:F,onItemEnter:_.useCallback(K=>{G(K)&&K.preventDefault()},[G]),onItemLeave:_.useCallback(K=>{var ee;G(K)||((ee=P.current)==null||ee.focus(),C(null))},[G]),onTriggerLeave:_.useCallback(K=>{G(K)&&K.preventDefault()},[G]),pointerGraceTimerRef:U,onPointerGraceIntentChange:_.useCallback(K=>{B.current=K},[]),children:w.jsx(H,{...J,children:w.jsx(Zq,{asChild:!0,trapped:i,onMountAutoFocus:Ze(s,K=>{var ee;K.preventDefault(),(ee=P.current)==null||ee.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:w.jsx(O6,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:p,onDismiss:m,children:w.jsx(pbe,{asChild:!0,...k,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:T,onCurrentTabStopIdChange:C,onEntryFocus:Ze(c,K=>{b.isUsingKeyboardRef.current||K.preventDefault()}),preventScrollOnEntryFocus:!0,children:w.jsx(J_e,{role:"menu","aria-orientation":"vertical","data-state":yW(S.open),"data-radix-menu-content":"",dir:b.dir,...R,...g,ref:M,style:{outline:"none",...g.style},onKeyDown:Ze(g.onKeyDown,K=>{const q=K.target.closest("[data-radix-menu-content]")===K.currentTarget,Q=K.ctrlKey||K.altKey||K.metaKey,Se=K.key.length===1;q&&(K.key==="Tab"&&K.preventDefault(),!Q&&Se&&Y(K.key));const Ie=P.current;if(K.target!==Ie||!eSe.includes(K.key))return;K.preventDefault();const Le=I().filter(xe=>!xe.disabled).map(xe=>xe.ref.current);JK.includes(K.key)&&Le.reverse(),SSe(Le)}),onBlur:Ze(n.onBlur,K=>{K.currentTarget.contains(K.target)||(window.clearTimeout(D.current),F.current="")}),onPointerMove:Ze(n.onPointerMove,Iv(K=>{const ee=K.target,q=z.current!==K.clientX;if(K.currentTarget.contains(ee)&&q){const Q=K.clientX>z.current?"right":"left";V.current=Q,z.current=K.clientX}}))})})})})})})});nW.displayName=Zs;var hSe="MenuGroup",q6=_.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return w.jsx(Jn.div,{role:"group",...r,ref:e})});q6.displayName=hSe;var fSe="MenuLabel",rW=_.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return w.jsx(Jn.div,{...r,ref:e})});rW.displayName=fSe;var uS="MenuItem",F9="menu.itemSelect",tE=_.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,s=_.useRef(null),o=by(uS,n.__scopeMenu),a=V6(uS,n.__scopeMenu),c=sn(e,s),l=_.useRef(!1),u=()=>{const h=s.current;if(!t&&h){const p=new CustomEvent(F9,{bubbles:!0,cancelable:!0});h.addEventListener(F9,m=>r==null?void 0:r(m),{once:!0}),g_e(h,p),p.defaultPrevented?l.current=!1:o.onClose()}};return w.jsx(iW,{...i,ref:c,disabled:t,onClick:Ze(n.onClick,u),onPointerDown:h=>{var p;(p=n.onPointerDown)==null||p.call(n,h),l.current=!0},onPointerUp:Ze(n.onPointerUp,h=>{var p;l.current||(p=h.currentTarget)==null||p.click()}),onKeyDown:Ze(n.onKeyDown,h=>{const p=a.searchRef.current!=="";t||p&&h.key===" "||T3.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});tE.displayName=uS;var iW=_.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...s}=n,o=V6(uS,t),a=ZK(t),c=_.useRef(null),l=sn(e,c),[u,h]=_.useState(!1),[p,m]=_.useState("");return _.useEffect(()=>{const v=c.current;v&&m((v.textContent??"").trim())},[s.children]),w.jsx(Tv.ItemSlot,{scope:t,disabled:r,textValue:i??p,children:w.jsx(mbe,{asChild:!0,...a,focusable:!r,children:w.jsx(Jn.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:l,onPointerMove:Ze(n.onPointerMove,Iv(v=>{r?o.onItemLeave(v):(o.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ze(n.onPointerLeave,Iv(v=>o.onItemLeave(v))),onFocus:Ze(n.onFocus,()=>h(!0)),onBlur:Ze(n.onBlur,()=>h(!1))})})})}),pSe="MenuCheckboxItem",sW=_.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return w.jsx(uW,{scope:n.__scopeMenu,checked:t,children:w.jsx(tE,{role:"menuitemcheckbox","aria-checked":dS(t)?"mixed":t,...i,ref:e,"data-state":W6(t),onSelect:Ze(i.onSelect,()=>r==null?void 0:r(dS(t)?!0:!t),{checkForDefaultPrevented:!1})})})});sW.displayName=pSe;var oW="MenuRadioGroup",[mSe,gSe]=Yd(oW,{value:void 0,onValueChange:()=>{}}),aW=_.forwardRef((n,e)=>{const{value:t,onValueChange:r,...i}=n,s=rs(r);return w.jsx(mSe,{scope:n.__scopeMenu,value:t,onValueChange:s,children:w.jsx(q6,{...i,ref:e})})});aW.displayName=oW;var cW="MenuRadioItem",lW=_.forwardRef((n,e)=>{const{value:t,...r}=n,i=gSe(cW,n.__scopeMenu),s=t===i.value;return w.jsx(uW,{scope:n.__scopeMenu,checked:s,children:w.jsx(tE,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":W6(s),onSelect:Ze(r.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,t)},{checkForDefaultPrevented:!1})})})});lW.displayName=cW;var K6="MenuItemIndicator",[uW,vSe]=Yd(K6,{checked:!1}),dW=_.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,s=vSe(K6,t);return w.jsx(_u,{present:r||dS(s.checked)||s.checked===!0,children:w.jsx(Jn.span,{...i,ref:e,"data-state":W6(s.checked)})})});dW.displayName=K6;var ySe="MenuSeparator",hW=_.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return w.jsx(Jn.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});hW.displayName=ySe;var _Se="MenuArrow",fW=_.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=eE(t);return w.jsx(Z_e,{...i,...r,ref:e})});fW.displayName=_Se;var bSe="MenuSub",[nqe,pW]=Yd(bSe),yg="MenuSubTrigger",mW=_.forwardRef((n,e)=>{const t=Xd(yg,n.__scopeMenu),r=by(yg,n.__scopeMenu),i=pW(yg,n.__scopeMenu),s=V6(yg,n.__scopeMenu),o=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:n.__scopeMenu},u=_.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return _.useEffect(()=>u,[u]),_.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),c(null)}},[a,c]),w.jsx(B6,{asChild:!0,...l,children:w.jsx(iW,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":yW(t.open),...n,ref:Ha(e,i.onTriggerChange),onClick:h=>{var p;(p=n.onClick)==null||p.call(n,h),!(n.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:Ze(n.onPointerMove,Iv(h=>{s.onItemEnter(h),!h.defaultPrevented&&!n.disabled&&!t.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:Ze(n.onPointerLeave,Iv(h=>{var m,v;u();const p=(m=t.content)==null?void 0:m.getBoundingClientRect();if(p){const g=(v=t.content)==null?void 0:v.dataset.side,S=g==="right",b=S?-5:5,R=p[S?"left":"right"],k=p[S?"right":"left"];s.onPointerGraceIntentChange({area:[{x:h.clientX+b,y:h.clientY},{x:R,y:p.top},{x:k,y:p.top},{x:k,y:p.bottom},{x:R,y:p.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(h),h.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Ze(n.onKeyDown,h=>{var m;const p=s.searchRef.current!=="";n.disabled||p&&h.key===" "||tSe[r.dir].includes(h.key)&&(t.onOpenChange(!0),(m=t.content)==null||m.focus(),h.preventDefault())})})})});mW.displayName=yg;var gW="MenuSubContent",vW=_.forwardRef((n,e)=>{const t=eW(Zs,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=Xd(Zs,n.__scopeMenu),o=by(Zs,n.__scopeMenu),a=pW(gW,n.__scopeMenu),c=_.useRef(null),l=sn(e,c);return w.jsx(Tv.Provider,{scope:n.__scopeMenu,children:w.jsx(_u,{present:r||s.open,children:w.jsx(Tv.Slot,{scope:n.__scopeMenu,children:w.jsx(G6,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var h;o.isUsingKeyboardRef.current&&((h=c.current)==null||h.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Ze(n.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Ze(n.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:Ze(n.onKeyDown,u=>{var m;const h=u.currentTarget.contains(u.target),p=nSe[o.dir].includes(u.key);h&&p&&(s.onOpenChange(!1),(m=a.trigger)==null||m.focus(),u.preventDefault())})})})})})});vW.displayName=gW;function yW(n){return n?"open":"closed"}function dS(n){return n==="indeterminate"}function W6(n){return dS(n)?"indeterminate":n?"checked":"unchecked"}function SSe(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function wSe(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function ESe(n,e,t){const i=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let o=wSe(n,Math.max(s,0));i.length===1&&(o=o.filter(l=>l!==t));const c=o.find(l=>l.toLowerCase().startsWith(i.toLowerCase()));return c!==t?c:void 0}function CSe(n,e){const{x:t,y:r}=n;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,c=e[s].y,l=e[o].x,u=e[o].y;c>r!=u>r&&t<(l-a)*(r-c)/(u-c)+a&&(i=!i)}return i}function TSe(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return CSe(t,e)}function Iv(n){return e=>e.pointerType==="mouse"?n(e):void 0}var _W=QK,bW=B6,SW=tW,wW=nW,EW=q6,CW=rW,TW=tE,IW=sW,RW=aW,kW=lW,xW=dW,PW=hW,LW=fW,AW=mW,MW=vW,z6="ContextMenu",[ISe,rqe]=Ba(z6,[Qw]),Ti=Qw(),[RSe,OW]=ISe(z6),NW=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:s=!0}=n,[o,a]=_.useState(!1),c=Ti(e),l=rs(r),u=_.useCallback(h=>{a(h),l(h)},[l]);return w.jsx(RSe,{scope:e,open:o,onOpenChange:u,modal:s,children:w.jsx(_W,{...c,dir:i,open:o,onOpenChange:u,modal:s,children:t})})};NW.displayName=z6;var DW="ContextMenuTrigger",FW=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,s=OW(DW,t),o=Ti(t),a=_.useRef({x:0,y:0}),c=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=_.useRef(0),u=_.useCallback(()=>window.clearTimeout(l.current),[]),h=p=>{a.current={x:p.clientX,y:p.clientY},s.onOpenChange(!0)};return _.useEffect(()=>u,[u]),_.useEffect(()=>void(r&&u()),[r,u]),w.jsxs(w.Fragment,{children:[w.jsx(bW,{...o,virtualRef:c}),w.jsx(Jn.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:Ze(n.onContextMenu,p=>{u(),h(p),p.preventDefault()}),onPointerDown:r?n.onPointerDown:Ze(n.onPointerDown,P1(p=>{u(),l.current=window.setTimeout(()=>h(p),700)})),onPointerMove:r?n.onPointerMove:Ze(n.onPointerMove,P1(u)),onPointerCancel:r?n.onPointerCancel:Ze(n.onPointerCancel,P1(u)),onPointerUp:r?n.onPointerUp:Ze(n.onPointerUp,P1(u))})]})});FW.displayName=DW;var kSe="ContextMenuPortal",UW=n=>{const{__scopeContextMenu:e,...t}=n,r=Ti(e);return w.jsx(SW,{...r,...t})};UW.displayName=kSe;var jW="ContextMenuContent",$W=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=OW(jW,t),s=Ti(t),o=_.useRef(!1);return w.jsx(wW,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=n.onCloseAutoFocus)==null||c.call(n,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var c;(c=n.onInteractOutside)==null||c.call(n,a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$W.displayName=jW;var xSe="ContextMenuGroup",PSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(EW,{...i,...r,ref:e})});PSe.displayName=xSe;var LSe="ContextMenuLabel",ASe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(CW,{...i,...r,ref:e})});ASe.displayName=LSe;var MSe="ContextMenuItem",BW=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(TW,{...i,...r,ref:e})});BW.displayName=MSe;var OSe="ContextMenuCheckboxItem",NSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(IW,{...i,...r,ref:e})});NSe.displayName=OSe;var DSe="ContextMenuRadioGroup",FSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(RW,{...i,...r,ref:e})});FSe.displayName=DSe;var USe="ContextMenuRadioItem",jSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(kW,{...i,...r,ref:e})});jSe.displayName=USe;var $Se="ContextMenuItemIndicator",BSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(xW,{...i,...r,ref:e})});BSe.displayName=$Se;var HSe="ContextMenuSeparator",VSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(PW,{...i,...r,ref:e})});VSe.displayName=HSe;var GSe="ContextMenuArrow",qSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(LW,{...i,...r,ref:e})});qSe.displayName=GSe;var KSe="ContextMenuSubTrigger",WSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(AW,{...i,...r,ref:e})});WSe.displayName=KSe;var zSe="ContextMenuSubContent",YSe=_.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return w.jsx(MW,{...i,...r,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});YSe.displayName=zSe;function P1(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var U9=NW,XSe=FW,JSe=UW,ZSe=$W;const QSe="_menu_1x5h1_17",ewe="_title_1x5h1_83",HW={menu:QSe,title:ewe},twe=({title:n,id:e})=>w.jsx(Xt,{as:"h3",id:e,className:HW.title,size:"sm",weight:"semibold",children:n}),Y6=_.forwardRef(({title:n,showTitle:e=!0,className:t,children:r,...i},s)=>{const o=_.useId();return w.jsxs("div",{role:"menu",ref:s,"aria-label":e?void 0:n,"aria-labelledby":e?o:void 0,className:De(t,HW.menu),...i,children:[e&&w.jsx(twe,{title:n,id:o}),r]})});Y6.displayName="FloatingMenu";var VW=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(rwe);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(I3,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(I3,{...r,ref:e,children:t})});VW.displayName="Slot";var I3=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=swe(t),s=iwe(r,t.props);return t.type!==_.Fragment&&(s.ref=e?Ha(e,i):i),_.cloneElement(t,s)}return _.Children.count(t)>1?_.Children.only(null):null});I3.displayName="SlotClone";var nwe=({children:n})=>w.jsx(w.Fragment,{children:n});function rwe(n){return _.isValidElement(n)&&n.type===nwe}function iwe(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function swe(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var owe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],awe=owe.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?VW:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{}),zI="focusScope.autoFocusOnMount",YI="focusScope.autoFocusOnUnmount",j9={bubbles:!1,cancelable:!0},cwe="FocusScope",GW=_.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=n,[a,c]=_.useState(null),l=rs(i),u=rs(s),h=_.useRef(null),p=sn(e,g=>c(g)),m=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let g=function(k){if(m.paused||!a)return;const I=k.target;a.contains(I)?h.current=I:El(h.current,{select:!0})},S=function(k){if(m.paused||!a)return;const I=k.relatedTarget;I!==null&&(a.contains(I)||El(h.current,{select:!0}))},b=function(k){if(document.activeElement===document.body)for(const T of k)T.removedNodes.length>0&&El(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",S);const R=new MutationObserver(b);return a&&R.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",S),R.disconnect()}}},[r,a,m.paused]),_.useEffect(()=>{if(a){B9.add(m);const g=document.activeElement;if(!a.contains(g)){const b=new CustomEvent(zI,j9);a.addEventListener(zI,l),a.dispatchEvent(b),b.defaultPrevented||(lwe(pwe(qW(a)),{select:!0}),document.activeElement===g&&El(a))}return()=>{a.removeEventListener(zI,l),setTimeout(()=>{const b=new CustomEvent(YI,j9);a.addEventListener(YI,u),a.dispatchEvent(b),b.defaultPrevented||El(g??document.body,{select:!0}),a.removeEventListener(YI,u),B9.remove(m)},0)}}},[a,l,u,m]);const v=_.useCallback(g=>{if(!t&&!r||m.paused)return;const S=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,b=document.activeElement;if(S&&b){const R=g.currentTarget,[k,I]=uwe(R);k&&I?!g.shiftKey&&b===I?(g.preventDefault(),t&&El(k,{select:!0})):g.shiftKey&&b===k&&(g.preventDefault(),t&&El(I,{select:!0})):b===R&&g.preventDefault()}},[t,r,m.paused]);return w.jsx(awe.div,{tabIndex:-1,...o,ref:p,onKeyDown:v})});GW.displayName=cwe;function lwe(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(El(r,{select:e}),document.activeElement!==t)return}function uwe(n){const e=qW(n),t=$9(e,n),r=$9(e.reverse(),n);return[t,r]}function qW(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function $9(n,e){for(const t of n)if(!dwe(t,{upTo:e}))return t}function dwe(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function hwe(n){return n instanceof HTMLInputElement&&"select"in n}function El(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&hwe(n)&&e&&n.select()}}var B9=fwe();function fwe(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=H9(n,e),n.unshift(e)},remove(e){var t;n=H9(n,e),(t=n[0])==null||t.resume()}}}function H9(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function pwe(n){return n.filter(e=>e.tagName!=="A")}var KW=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(gwe);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(R3,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(R3,{...r,ref:e,children:t})});KW.displayName="Slot";var R3=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=ywe(t),s=vwe(r,t.props);return t.type!==_.Fragment&&(s.ref=e?Ha(e,i):i),_.cloneElement(t,s)}return _.Children.count(t)>1?_.Children.only(null):null});R3.displayName="SlotClone";var mwe=({children:n})=>w.jsx(w.Fragment,{children:n});function gwe(n){return _.isValidElement(n)&&n.type===mwe}function vwe(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function ywe(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var _we=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],bwe=_we.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?KW:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{}),Swe="Portal",WW=_.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[i,s]=_.useState(!1);cu(()=>s(!0),[]);const o=t||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?OV.createPortal(w.jsx(bwe.div,{...r,ref:e}),o):null});WW.displayName=Swe;var X6=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(Ewe);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(k3,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(k3,{...r,ref:e,children:t})});X6.displayName="Slot";var k3=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=Twe(t),s=Cwe(r,t.props);return t.type!==_.Fragment&&(s.ref=e?Ha(e,i):i),_.cloneElement(t,s)}return _.Children.count(t)>1?_.Children.only(null):null});k3.displayName="SlotClone";var wwe=({children:n})=>w.jsx(w.Fragment,{children:n});function Ewe(n){return _.isValidElement(n)&&n.type===wwe}function Cwe(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function Twe(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Iwe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Sy=Iwe.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?X6:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{}),zW=HK(),XI=function(){},nE=_.forwardRef(function(n,e){var t=_.useRef(null),r=_.useState({onScrollCapture:XI,onWheelCapture:XI,onTouchMoveCapture:XI}),i=r[0],s=r[1],o=n.forwardProps,a=n.children,c=n.className,l=n.removeScrollBar,u=n.enabled,h=n.shards,p=n.sideCar,m=n.noIsolation,v=n.inert,g=n.allowPinchZoom,S=n.as,b=S===void 0?"div":S,R=n.gapMode,k=yy(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),I=p,T=BK([t,e]),C=Ar(Ar({},k),i);return _.createElement(_.Fragment,null,u&&_.createElement(I,{sideCar:zW,removeScrollBar:l,shards:h,noIsolation:m,inert:v,setCallbacks:s,allowPinchZoom:!!g,lockRef:t,gapMode:R}),o?_.cloneElement(_.Children.only(a),Ar(Ar({},C),{ref:T})):_.createElement(b,Ar({},C,{className:c,ref:T}),a))});nE.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nE.classNames={fullWidth:jg,zeroRight:Ug};var x3=!1;if(typeof window<"u")try{var L1=Object.defineProperty({},"passive",{get:function(){return x3=!0,!0}});window.addEventListener("test",L1,L1),window.removeEventListener("test",L1,L1)}catch{x3=!1}var Bh=x3?{passive:!1}:!1,Rwe=function(n){return n.tagName==="TEXTAREA"},YW=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Rwe(n)&&t[e]==="visible")},kwe=function(n){return YW(n,"overflowY")},xwe=function(n){return YW(n,"overflowX")},V9=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=XW(n,r);if(i){var s=JW(n,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},Pwe=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Lwe=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},XW=function(n,e){return n==="v"?kwe(e):xwe(e)},JW=function(n,e){return n==="v"?Pwe(e):Lwe(e)},Awe=function(n,e){return n==="h"&&e==="rtl"?-1:1},Mwe=function(n,e,t,r,i){var s=Awe(n,window.getComputedStyle(e).direction),o=s*r,a=t.target,c=e.contains(a),l=!1,u=o>0,h=0,p=0;do{var m=JW(n,a),v=m[0],g=m[1],S=m[2],b=g-S-s*v;(v||b)&&XW(n,a)&&(h+=b,p+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(l=!0),l},A1=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},G9=function(n){return[n.deltaX,n.deltaY]},q9=function(n){return n&&"current"in n?n.current:n},Owe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Nwe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Dwe=0,Hh=[];function Fwe(n){var e=_.useRef([]),t=_.useRef([0,0]),r=_.useRef(),i=_.useState(Dwe++)[0],s=_.useState($6)[0],o=_.useRef(n);_.useEffect(function(){o.current=n},[n]),_.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var g=io([n.lockRef.current],(n.shards||[]).map(q9),!0).filter(Boolean);return g.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),g.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=_.useCallback(function(g,S){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var b=A1(g),R=t.current,k="deltaX"in g?g.deltaX:R[0]-b[0],I="deltaY"in g?g.deltaY:R[1]-b[1],T,C=g.target,P=Math.abs(k)>Math.abs(I)?"h":"v";if("touches"in g&&P==="h"&&C.type==="range")return!1;var M=V9(P,C);if(!M)return!0;if(M?T=P:(T=P==="v"?"h":"v",M=V9(P,C)),!M)return!1;if(!r.current&&"changedTouches"in g&&(k||I)&&(r.current=T),!T)return!0;var D=r.current||T;return Mwe(D,S,g,D==="h"?k:I)},[]),c=_.useCallback(function(g){var S=g;if(!(!Hh.length||Hh[Hh.length-1]!==s)){var b="deltaY"in S?G9(S):A1(S),R=e.current.filter(function(T){return T.name===S.type&&(T.target===S.target||S.target===T.shadowParent)&&Owe(T.delta,b)})[0];if(R&&R.should){S.cancelable&&S.preventDefault();return}if(!R){var k=(o.current.shards||[]).map(q9).filter(Boolean).filter(function(T){return T.contains(S.target)}),I=k.length>0?a(S,k[0]):!o.current.noIsolation;I&&S.cancelable&&S.preventDefault()}}},[]),l=_.useCallback(function(g,S,b,R){var k={name:g,delta:S,target:b,should:R,shadowParent:Uwe(b)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(I){return I!==k})},1)},[]),u=_.useCallback(function(g){t.current=A1(g),r.current=void 0},[]),h=_.useCallback(function(g){l(g.type,G9(g),g.target,a(g,n.lockRef.current))},[]),p=_.useCallback(function(g){l(g.type,A1(g),g.target,a(g,n.lockRef.current))},[]);_.useEffect(function(){return Hh.push(s),n.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Bh),document.addEventListener("touchmove",c,Bh),document.addEventListener("touchstart",u,Bh),function(){Hh=Hh.filter(function(g){return g!==s}),document.removeEventListener("wheel",c,Bh),document.removeEventListener("touchmove",c,Bh),document.removeEventListener("touchstart",u,Bh)}},[]);var m=n.removeScrollBar,v=n.inert;return _.createElement(_.Fragment,null,v?_.createElement(s,{styles:Nwe(i)}):null,m?_.createElement(KK,{gapMode:n.gapMode}):null)}function Uwe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const jwe=GK(zW,Fwe);var ZW=_.forwardRef(function(n,e){return _.createElement(nE,Ar({},n,{ref:e,sideCar:jwe}))});ZW.classNames=nE.classNames;var J6="Dialog",[QW,iqe]=Ba(J6),[$we,Yo]=QW(J6),ez=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=n,a=_.useRef(null),c=_.useRef(null),[l=!1,u]=zw({prop:r,defaultProp:i,onChange:s});return w.jsx($we,{scope:e,triggerRef:a,contentRef:c,contentId:Tc(),titleId:Tc(),descriptionId:Tc(),open:l,onOpenChange:u,onOpenToggle:_.useCallback(()=>u(h=>!h),[u]),modal:o,children:t})};ez.displayName=J6;var tz="DialogTrigger",nz=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=Yo(tz,t),s=sn(e,i.triggerRef);return w.jsx(Sy.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":eL(i.open),...r,ref:s,onClick:Ze(n.onClick,i.onOpenToggle)})});nz.displayName=tz;var Z6="DialogPortal",[Bwe,rz]=QW(Z6,{forceMount:void 0}),iz=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,s=Yo(Z6,e);return w.jsx(Bwe,{scope:e,forceMount:t,children:_.Children.map(r,o=>w.jsx(_u,{present:t||s.open,children:w.jsx(WW,{asChild:!0,container:i,children:o})}))})};iz.displayName=Z6;var hS="DialogOverlay",sz=_.forwardRef((n,e)=>{const t=rz(hS,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=Yo(hS,n.__scopeDialog);return s.modal?w.jsx(_u,{present:r||s.open,children:w.jsx(Hwe,{...i,ref:e})}):null});sz.displayName=hS;var Hwe=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=Yo(hS,t);return w.jsx(ZW,{as:X6,allowPinchZoom:!0,shards:[i.contentRef],children:w.jsx(Sy.div,{"data-state":eL(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Nd="DialogContent",oz=_.forwardRef((n,e)=>{const t=rz(Nd,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=Yo(Nd,n.__scopeDialog);return w.jsx(_u,{present:r||s.open,children:s.modal?w.jsx(Vwe,{...i,ref:e}):w.jsx(Gwe,{...i,ref:e})})});oz.displayName=Nd;var Vwe=_.forwardRef((n,e)=>{const t=Yo(Nd,n.__scopeDialog),r=_.useRef(null),i=sn(e,t.contentRef,r);return _.useEffect(()=>{const s=r.current;if(s)return bK(s)},[]),w.jsx(az,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ze(n.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Ze(n.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Ze(n.onFocusOutside,s=>s.preventDefault())})}),Gwe=_.forwardRef((n,e)=>{const t=Yo(Nd,n.__scopeDialog),r=_.useRef(!1),i=_.useRef(!1);return w.jsx(az,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var c,l;(c=n.onInteractOutside)==null||c.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((l=t.triggerRef.current)==null?void 0:l.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),az=_.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=n,a=Yo(Nd,t),c=_.useRef(null),l=sn(e,c);return Jq(),w.jsxs(w.Fragment,{children:[w.jsx(GW,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:w.jsx(O6,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":eL(a.open),...o,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),w.jsxs(w.Fragment,{children:[w.jsx(Kwe,{titleId:a.titleId}),w.jsx(zwe,{contentRef:c,descriptionId:a.descriptionId})]})]})}),Q6="DialogTitle",cz=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=Yo(Q6,t);return w.jsx(Sy.h2,{id:i.titleId,...r,ref:e})});cz.displayName=Q6;var lz="DialogDescription",qwe=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=Yo(lz,t);return w.jsx(Sy.p,{id:i.descriptionId,...r,ref:e})});qwe.displayName=lz;var uz="DialogClose",dz=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=Yo(uz,t);return w.jsx(Sy.button,{type:"button",...r,ref:e,onClick:Ze(n.onClick,()=>i.onOpenChange(!1))})});dz.displayName=uz;function eL(n){return n?"open":"closed"}var hz="DialogTitleWarning",[sqe,fz]=l_e(hz,{contentName:Nd,titleName:Q6,docsSlug:"dialog"}),Kwe=({titleId:n})=>{const e=fz(hz),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return _.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},Wwe="DialogDescriptionWarning",zwe=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${fz(Wwe).contentName}}.`;return _.useEffect(()=>{var s;const i=(s=n.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},tL=ez,Ywe=nz,nL=iz,rL=sz,iL=oz,sL=cz,pz=dz;function Xwe(n){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.appendChild(t),t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n))}const mz=Re.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),wy=()=>{const n=Re.useContext(mz);if(!n)throw new Error("useDrawerContext must be used within a Drawer.Root");return n};Xwe(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function Jwe(){const n=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(n)&&/Mobile/.test(n)||/FxiOS/.test(n))}function Zwe(){return oL(/^Mac/)}function Qwe(){return oL(/^iPhone/)}function K9(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function eEe(){return oL(/^iPad/)||Zwe()&&navigator.maxTouchPoints>1}function gz(){return Qwe()||eEe()}function oL(n){return typeof window<"u"&&window.navigator!=null?n.test(window.navigator.platform):void 0}const tEe=24,nEe=typeof window<"u"?_.useLayoutEffect:_.useEffect;function W9(...n){return(...e)=>{for(let t of n)typeof t=="function"&&t(...e)}}const JI=typeof document<"u"&&window.visualViewport;function z9(n){let e=window.getComputedStyle(n);return/(auto|scroll)/.test(e.overflow+e.overflowX+e.overflowY)}function vz(n){for(z9(n)&&(n=n.parentElement);n&&!z9(n);)n=n.parentElement;return n||document.scrollingElement||document.documentElement}const rEe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let M1=0,ZI;function iEe(n={}){let{isDisabled:e}=n;nEe(()=>{if(!e)return M1++,M1===1&&gz()&&(ZI=sEe()),()=>{M1--,M1===0&&(ZI==null||ZI())}},[e])}function sEe(){let n,e=0,t=h=>{n=vz(h.target),!(n===document.documentElement&&n===document.body)&&(e=h.changedTouches[0].pageY)},r=h=>{if(!n||n===document.documentElement||n===document.body){h.preventDefault();return}let p=h.changedTouches[0].pageY,m=n.scrollTop,v=n.scrollHeight-n.clientHeight;v!==0&&((m<=0&&p>e||m>=v&&p<e)&&h.preventDefault(),e=p)},i=h=>{let p=h.target;P3(p)&&p!==document.activeElement&&(h.preventDefault(),p.style.transform="translateY(-2000px)",p.focus(),requestAnimationFrame(()=>{p.style.transform=""}))},s=h=>{let p=h.target;P3(p)&&(p.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{p.style.transform="",JI&&(JI.height<window.innerHeight?requestAnimationFrame(()=>{Y9(p)}):JI.addEventListener("resize",()=>Y9(p),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},a=window.pageXOffset,c=window.pageYOffset,l=W9(oEe(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let u=W9(Km(document,"touchstart",t,{passive:!1,capture:!0}),Km(document,"touchmove",r,{passive:!1,capture:!0}),Km(document,"touchend",i,{passive:!1,capture:!0}),Km(document,"focus",s,!0),Km(window,"scroll",o));return()=>{l(),u(),window.scrollTo(a,c)}}function oEe(n,e,t){let r=n.style[e];return n.style[e]=t,()=>{n.style[e]=r}}function Km(n,e,t,r){return n.addEventListener(e,t,r),()=>{n.removeEventListener(e,t,r)}}function Y9(n){let e=document.scrollingElement||document.documentElement;for(;n&&n!==e;){let t=vz(n);if(t!==document.documentElement&&t!==document.body&&t!==n){let r=t.getBoundingClientRect().top,i=n.getBoundingClientRect().top,s=n.getBoundingClientRect().bottom;const o=t.getBoundingClientRect().bottom+tEe;s>o&&(t.scrollTop+=i-r)}n=t.parentElement}}function P3(n){return n instanceof HTMLInputElement&&!rEe.has(n.type)||n instanceof HTMLTextAreaElement||n instanceof HTMLElement&&n.isContentEditable}function aEe(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function cEe(...n){return e=>n.forEach(t=>aEe(t,e))}function yz(...n){return _.useCallback(cEe(...n),n)}const _z=new WeakMap;function hr(n,e,t=!1){if(!n||!(n instanceof HTMLElement))return;let r={};Object.entries(e).forEach(([i,s])=>{if(i.startsWith("--")){n.style.setProperty(i,s);return}r[i]=n.style[i],n.style[i]=s}),!t&&_z.set(n,r)}function lEe(n,e){if(!n||!(n instanceof HTMLElement))return;let t=_z.get(n);t&&(n.style[e]=t[e])}const rr=n=>{switch(n){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return n}};function O1(n,e){if(!n)return null;const t=window.getComputedStyle(n),r=t.transform||t.webkitTransform||t.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[rr(e)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[rr(e)?5:4]):null)}function uEe(n){return 8*(Math.log(n+1)-2)}function QI(n,e){if(!n)return()=>{};const t=n.style.cssText;return Object.assign(n.style,e),()=>{n.style.cssText=t}}function dEe(...n){return(...e)=>{for(const t of n)typeof t=="function"&&t(...e)}}const Pn={DURATION:.5,EASE:[.32,.72,0,1]},bz=.4,hEe=.25,fEe=100,Sz=8,N1=16,L3=26,e2="vaul-dragging";function wz(n){const e=Re.useRef(n);return Re.useEffect(()=>{e.current=n}),Re.useMemo(()=>(...t)=>e.current==null?void 0:e.current.call(e,...t),[])}function pEe({defaultProp:n,onChange:e}){const t=Re.useState(n),[r]=t,i=Re.useRef(r),s=wz(e);return Re.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),t}function Ez({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=pEe({defaultProp:e,onChange:t}),s=n!==void 0,o=s?n:r,a=wz(t),c=Re.useCallback(l=>{if(s){const h=typeof l=="function"?l(n):l;h!==n&&a(h)}else i(l)},[s,n,i,a]);return[o,c]}function mEe({activeSnapPointProp:n,setActiveSnapPointProp:e,snapPoints:t,drawerRef:r,overlayRef:i,fadeFromIndex:s,onSnapPointChange:o,direction:a="bottom",container:c,snapToSequentialPoint:l}){const[u,h]=Ez({prop:n,defaultProp:t==null?void 0:t[0],onChange:e}),[p,m]=Re.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Re.useEffect(()=>{function P(){m({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[]);const v=Re.useMemo(()=>u===(t==null?void 0:t[t.length-1])||null,[t,u]),g=Re.useMemo(()=>{var P;return(P=t==null?void 0:t.findIndex(M=>M===u))!=null?P:null},[t,u]),S=t&&t.length>0&&(s||s===0)&&!Number.isNaN(s)&&t[s]===u||!t,b=Re.useMemo(()=>{const P=c?{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var M;return(M=t==null?void 0:t.map(D=>{const F=typeof D=="string";let U=0;if(F&&(U=parseInt(D,10)),rr(a)){const V=F?U:p?D*P.height:0;return p?a==="bottom"?P.height-V:-P.height+V:V}const B=F?U:p?D*P.width:0;return p?a==="right"?P.width-B:-P.width+B:B}))!=null?M:[]},[t,p,c]),R=Re.useMemo(()=>g!==null?b==null?void 0:b[g]:null,[b,g]),k=Re.useCallback(P=>{var M;const D=(M=b==null?void 0:b.findIndex(F=>F===P))!=null?M:null;o(D),hr(r.current,{transition:`transform ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`,transform:rr(a)?`translate3d(0, ${P}px, 0)`:`translate3d(${P}px, 0, 0)`}),b&&D!==b.length-1&&s!==void 0&&D!==s&&D<s?hr(i.current,{transition:`opacity ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`,opacity:"0"}):hr(i.current,{transition:`opacity ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`,opacity:"1"}),h(t==null?void 0:t[Math.max(D,0)])},[r.current,t,b,s,i,h]);Re.useEffect(()=>{if(u||n){var P;const M=(P=t==null?void 0:t.findIndex(D=>D===n||D===u))!=null?P:-1;b&&M!==-1&&typeof b[M]=="number"&&k(b[M])}},[u,n,t,b,k]);function I({draggedDistance:P,closeDrawer:M,velocity:D,dismissible:F}){if(s===void 0)return;const U=a==="bottom"||a==="right"?(R??0)-P:(R??0)+P,B=g===s-1,V=g===0,z=P>0;if(B&&hr(i.current,{transition:`opacity ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`}),!l&&D>2&&!z){F?M():k(b[0]);return}if(!l&&D>2&&z&&b&&t){k(b[t.length-1]);return}const H=b==null?void 0:b.reduce((Y,G)=>typeof Y!="number"||typeof G!="number"?Y:Math.abs(G-U)<Math.abs(Y-U)?G:Y),J=rr(a)?window.innerHeight:window.innerWidth;if(D>bz&&Math.abs(P)<J*.4){const Y=z?1:-1;if(Y>0&&v&&t){k(b[t.length-1]);return}if(V&&Y<0&&F&&M(),g===null)return;k(b[g+Y]);return}k(H)}function T({draggedDistance:P}){if(R===null)return;const M=a==="bottom"||a==="right"?R-P:R+P;(a==="bottom"||a==="right")&&M<b[b.length-1]||(a==="top"||a==="left")&&M>b[b.length-1]||hr(r.current,{transform:rr(a)?`translate3d(0, ${M}px, 0)`:`translate3d(${M}px, 0, 0)`})}function C(P,M){if(!t||typeof g!="number"||!b||s===void 0)return null;const D=g===s-1;if(g>=s&&M)return 0;if(D&&!M)return 1;if(!S&&!D)return null;const U=D?g+1:g-1,B=D?b[U]-b[U-1]:b[U+1]-b[U],V=P/Math.abs(B);return D?1-V:V}return{isLastSnapPoint:v,activeSnapPoint:u,shouldFade:S,getPercentageDragged:C,setActiveSnapPoint:h,activeSnapPointIndex:g,onRelease:I,onDrag:T,snapPointsOffset:b}}const gEe=()=>()=>{};function vEe(){const{direction:n,isOpen:e,shouldScaleBackground:t,setBackgroundColorOnScale:r,noBodyStyles:i}=wy(),s=Re.useRef(null),o=_.useMemo(()=>document.body.style.backgroundColor,[]);function a(){return(window.innerWidth-L3)/window.innerWidth}Re.useEffect(()=>{if(e&&t){s.current&&clearTimeout(s.current);const c=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!c)return;dEe(r&&!i?QI(document.body,{background:"black"}):gEe,QI(c,{transformOrigin:rr(n)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Pn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Pn.EASE.join(",")})`}));const l=QI(c,{borderRadius:`${Sz}px`,overflow:"hidden",...rr(n)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{l(),s.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},Pn.DURATION*1e3)}}},[e,t,o])}let Wm=null;function yEe({isOpen:n,modal:e,nested:t,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:s}){const[o,a]=Re.useState(()=>typeof window<"u"?window.location.href:""),c=Re.useRef(0),l=Re.useCallback(()=>{if(K9()&&Wm===null&&n&&!s){Wm={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:h,innerHeight:p}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-c.current}px`,left:`${-h}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const m=p-window.innerHeight;m&&c.current>=p&&(document.body.style.top=`${-(c.current+m)}px`)}),300)}},[n]),u=Re.useCallback(()=>{if(K9()&&Wm!==null&&!s){const h=-parseInt(document.body.style.top,10),p=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Wm),window.requestAnimationFrame(()=>{if(i&&o!==window.location.href){a(window.location.href);return}window.scrollTo(p,h)}),Wm=null}},[o]);return Re.useEffect(()=>{function h(){c.current=window.scrollY}return h(),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[]),Re.useEffect(()=>{if(e)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||u()}},[e,u]),Re.useEffect(()=>{t||!r||(n?(!window.matchMedia("(display-mode: standalone)").matches&&l(),e||window.setTimeout(()=>{u()},500)):u())},[n,r,o,e,t,l,u]),{restorePositionSetting:u}}function _Ee({open:n,onOpenChange:e,children:t,onDrag:r,onRelease:i,snapPoints:s,shouldScaleBackground:o=!1,setBackgroundColorOnScale:a=!0,closeThreshold:c=hEe,scrollLockTimeout:l=fEe,dismissible:u=!0,handleOnly:h=!1,fadeFromIndex:p=s&&s.length-1,activeSnapPoint:m,setActiveSnapPoint:v,fixed:g,modal:S=!0,onClose:b,nested:R,noBodyStyles:k=!1,direction:I="bottom",defaultOpen:T=!1,disablePreventScroll:C=!0,snapToSequentialPoint:P=!1,preventScrollRestoration:M=!1,repositionInputs:D=!0,onAnimationEnd:F,container:U,autoFocus:B=!1}){var V,z;const[H=!1,J]=Ez({defaultProp:T,prop:n,onChange:it=>{e==null||e(it),!it&&!R&&$(),setTimeout(()=>{F==null||F(it)},Pn.DURATION*1e3),it&&!S&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),it||(document.body.style.pointerEvents="auto")}}),[Y,G]=Re.useState(!1),[K,ee]=Re.useState(!1),[q,Q]=Re.useState(!1),Se=Re.useRef(null),Ie=Re.useRef(null),Ne=Re.useRef(null),Le=Re.useRef(null),xe=Re.useRef(null),Ee=Re.useRef(!1),Ce=Re.useRef(null),Ve=Re.useRef(0),vt=Re.useRef(!1),Jt=Re.useRef(!T),Et=Re.useRef(0),Be=Re.useRef(null),Zn=Re.useRef(((V=Be.current)==null?void 0:V.getBoundingClientRect().height)||0),In=Re.useRef(((z=Be.current)==null?void 0:z.getBoundingClientRect().width)||0),Qn=Re.useRef(0),os=Re.useCallback(it=>{s&&it===ki.length-1&&(Ie.current=new Date)},[]),{activeSnapPoint:pi,activeSnapPointIndex:Dr,setActiveSnapPoint:Qr,onRelease:br,snapPointsOffset:ki,onDrag:xi,shouldFade:ei,getPercentageDragged:ht}=mEe({snapPoints:s,activeSnapPointProp:m,setActiveSnapPointProp:v,drawerRef:Be,fadeFromIndex:p,overlayRef:Se,onSnapPointChange:os,direction:I,container:U,snapToSequentialPoint:P});iEe({isDisabled:!H||K||!S||q||!Y||!D||!C});const{restorePositionSetting:$}=yEe({isOpen:H,modal:S,nested:R??!1,hasBeenOpened:Y,preventScrollRestoration:M,noBodyStyles:k});function L(){return(window.innerWidth-L3)/window.innerWidth}function N(it){var Lt,At;!u&&!s||Be.current&&!Be.current.contains(it.target)||(Zn.current=((Lt=Be.current)==null?void 0:Lt.getBoundingClientRect().height)||0,In.current=((At=Be.current)==null?void 0:At.getBoundingClientRect().width)||0,ee(!0),Ne.current=new Date,gz()&&window.addEventListener("touchend",()=>Ee.current=!1,{once:!0}),it.target.setPointerCapture(it.pointerId),Ve.current=rr(I)?it.pageY:it.pageX)}function W(it,Lt){var At;let yt=it;const _n=(At=window.getSelection())==null?void 0:At.toString(),Fr=Be.current?O1(Be.current,I):null,Sr=new Date;if(yt.tagName==="SELECT"||yt.hasAttribute("data-vaul-no-drag")||yt.closest("[data-vaul-no-drag]"))return!1;if(I==="right"||I==="left")return!0;if(Ie.current&&Sr.getTime()-Ie.current.getTime()<500)return!1;if(Fr!==null&&(I==="bottom"?Fr>0:Fr<0))return!0;if(_n&&_n.length>0)return!1;if(xe.current&&Sr.getTime()-xe.current.getTime()<l&&Fr===0||Lt)return xe.current=Sr,!1;for(;yt;){if(yt.scrollHeight>yt.clientHeight){if(yt.scrollTop!==0)return xe.current=new Date,!1;if(yt.getAttribute("role")==="dialog")return!0}yt=yt.parentNode}return!0}function ne(it){if(Be.current&&K){const Lt=I==="bottom"||I==="right"?1:-1,At=(Ve.current-(rr(I)?it.pageY:it.pageX))*Lt,yt=At>0,_n=s&&!u&&!yt;if(_n&&Dr===0)return;const Fr=Math.abs(At),Sr=document.querySelector("[data-vaul-drawer-wrapper]"),ao=I==="bottom"||I==="top"?Zn.current:In.current;let Pi=Fr/ao;const co=ht(Fr,yt);if(co!==null&&(Pi=co),_n&&Pi>=1||!Ee.current&&!W(it.target,yt))return;if(Be.current.classList.add(e2),Ee.current=!0,hr(Be.current,{transition:"none"}),hr(Se.current,{transition:"none"}),s&&xi({draggedDistance:At}),yt&&!s){const ti=uEe(At),qc=Math.min(ti*-1,0)*Lt;hr(Be.current,{transform:rr(I)?`translate3d(0, ${qc}px, 0)`:`translate3d(${qc}px, 0, 0)`});return}const lo=1-Pi;if((ei||p&&Dr===p-1)&&(r==null||r(it,Pi),hr(Se.current,{opacity:`${lo}`,transition:"none"},!0)),Sr&&Se.current&&o){const ti=Math.min(L()+Pi*(1-L()),1),qc=8-Pi*8,Kc=Math.max(0,14-Pi*14);hr(Sr,{borderRadius:`${qc}px`,transform:rr(I)?`scale(${ti}) translate3d(0, ${Kc}px, 0)`:`scale(${ti}) translate3d(${Kc}px, 0, 0)`,transition:"none"},!0)}if(!s){const ti=Fr*Lt;hr(Be.current,{transform:rr(I)?`translate3d(0, ${ti}px, 0)`:`translate3d(${ti}px, 0, 0)`})}}}Re.useEffect(()=>{window.requestAnimationFrame(()=>{Jt.current=!0})},[]),Re.useEffect(()=>{var it;function Lt(){if(!Be.current||!D)return;const At=document.activeElement;if(P3(At)||vt.current){var yt;const _n=((yt=window.visualViewport)==null?void 0:yt.height)||0,Fr=window.innerHeight;let Sr=Fr-_n;const ao=Be.current.getBoundingClientRect().height||0,Pi=ao>Fr*.8;Qn.current||(Qn.current=ao);const co=Be.current.getBoundingClientRect().top;if(Math.abs(Et.current-Sr)>60&&(vt.current=!vt.current),s&&s.length>0&&ki&&Dr){const lo=ki[Dr]||0;Sr+=lo}if(Et.current=Sr,ao>_n||vt.current){const lo=Be.current.getBoundingClientRect().height;let ti=lo;lo>_n&&(ti=_n-(Pi?co:L3)),g?Be.current.style.height=`${lo-Math.max(Sr,0)}px`:Be.current.style.height=`${Math.max(ti,_n-co)}px`}else Jwe()||(Be.current.style.height=`${Qn.current}px`);s&&s.length>0&&!vt.current?Be.current.style.bottom="0px":Be.current.style.bottom=`${Math.max(Sr,0)}px`}}return(it=window.visualViewport)==null||it.addEventListener("resize",Lt),()=>{var At;return(At=window.visualViewport)==null?void 0:At.removeEventListener("resize",Lt)}},[Dr,s,ki]);function ce(it){dt(),b==null||b(),it||J(!1),setTimeout(()=>{s&&Qr(s[0])},Pn.DURATION*1e3)}function ge(){if(!Be.current)return;const it=document.querySelector("[data-vaul-drawer-wrapper]"),Lt=O1(Be.current,I);hr(Be.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`}),hr(Se.current,{transition:`opacity ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`,opacity:"1"}),o&&Lt&&Lt>0&&H&&hr(it,{borderRadius:`${Sz}px`,overflow:"hidden",...rr(I)?{transform:`scale(${L()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${L()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Pn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Pn.EASE.join(",")})`},!0)}function dt(){!K||!Be.current||(Be.current.classList.remove(e2),Ee.current=!1,ee(!1),Le.current=new Date)}function Zt(it){if(!K||!Be.current)return;Be.current.classList.remove(e2),Ee.current=!1,ee(!1),Le.current=new Date;const Lt=O1(Be.current,I);if(!it||!W(it.target,!1)||!Lt||Number.isNaN(Lt)||Ne.current===null)return;const At=Le.current.getTime()-Ne.current.getTime(),yt=Ve.current-(rr(I)?it.pageY:it.pageX),_n=Math.abs(yt)/At;if(_n>.05&&(Q(!0),setTimeout(()=>{Q(!1)},200)),s){br({draggedDistance:yt*(I==="bottom"||I==="right"?1:-1),closeDrawer:ce,velocity:_n,dismissible:u}),i==null||i(it,!0);return}if(I==="bottom"||I==="right"?yt>0:yt<0){ge(),i==null||i(it,!0);return}if(_n>bz){ce(),i==null||i(it,!1);return}var Fr;const Sr=Math.min((Fr=Be.current.getBoundingClientRect().height)!=null?Fr:0,window.innerHeight);var ao;const Pi=Math.min((ao=Be.current.getBoundingClientRect().width)!=null?ao:0,window.innerWidth),co=I==="left"||I==="right";if(Math.abs(Lt)>=(co?Pi:Sr)*c){ce(),i==null||i(it,!1);return}i==null||i(it,!0),ge()}Re.useEffect(()=>(H&&(hr(document.documentElement,{scrollBehavior:"auto"}),Ie.current=new Date),()=>{lEe(document.documentElement,"scrollBehavior")}),[H]);function Ft(it){const Lt=it?(window.innerWidth-N1)/window.innerWidth:1,At=it?-16:0;Ce.current&&window.clearTimeout(Ce.current),hr(Be.current,{transition:`transform ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`,transform:rr(I)?`scale(${Lt}) translate3d(0, ${At}px, 0)`:`scale(${Lt}) translate3d(${At}px, 0, 0)`}),!it&&Be.current&&(Ce.current=setTimeout(()=>{const yt=O1(Be.current,I);hr(Be.current,{transition:"none",transform:rr(I)?`translate3d(0, ${yt}px, 0)`:`translate3d(${yt}px, 0, 0)`})},500))}function Qt(it,Lt){if(Lt<0)return;const At=(window.innerWidth-N1)/window.innerWidth,yt=At+Lt*(1-At),_n=-16+Lt*N1;hr(Be.current,{transform:rr(I)?`scale(${yt}) translate3d(0, ${_n}px, 0)`:`scale(${yt}) translate3d(${_n}px, 0, 0)`,transition:"none"})}function Pt(it,Lt){const At=rr(I)?window.innerHeight:window.innerWidth,yt=Lt?(At-N1)/At:1,_n=Lt?-16:0;Lt&&hr(Be.current,{transition:`transform ${Pn.DURATION}s cubic-bezier(${Pn.EASE.join(",")})`,transform:rr(I)?`scale(${yt}) translate3d(0, ${_n}px, 0)`:`scale(${yt}) translate3d(${_n}px, 0, 0)`})}return Re.useEffect(()=>{S||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[S]),Re.createElement(tL,{defaultOpen:T,onOpenChange:it=>{!u&&!it||(it?G(!0):ce(!0),J(it))},open:H},Re.createElement(mz.Provider,{value:{activeSnapPoint:pi,snapPoints:s,setActiveSnapPoint:Qr,drawerRef:Be,overlayRef:Se,onOpenChange:e,onPress:N,onRelease:Zt,onDrag:ne,dismissible:u,shouldAnimate:Jt,handleOnly:h,isOpen:H,isDragging:K,shouldFade:ei,closeDrawer:ce,onNestedDrag:Qt,onNestedOpenChange:Ft,onNestedRelease:Pt,keyboardIsOpen:vt,modal:S,snapPointsOffset:ki,activeSnapPointIndex:Dr,direction:I,shouldScaleBackground:o,setBackgroundColorOnScale:a,noBodyStyles:k,container:U,autoFocus:B}},t))}const Cz=Re.forwardRef(function({...n},e){const{overlayRef:t,snapPoints:r,onRelease:i,shouldFade:s,isOpen:o,modal:a,shouldAnimate:c}=wy(),l=yz(e,t),u=r&&r.length>0;if(!a)return null;const h=Re.useCallback(p=>i(p),[i]);return Re.createElement(rL,{onMouseUp:h,ref:l,"data-vaul-overlay":"","data-vaul-snap-points":o&&u?"true":"false","data-vaul-snap-points-overlay":o&&s?"true":"false","data-vaul-animate":c!=null&&c.current?"true":"false",...n})});Cz.displayName="Drawer.Overlay";const Tz=Re.forwardRef(function({onPointerDownOutside:n,style:e,onOpenAutoFocus:t,...r},i){const{drawerRef:s,onPress:o,onRelease:a,onDrag:c,keyboardIsOpen:l,snapPointsOffset:u,activeSnapPointIndex:h,modal:p,isOpen:m,direction:v,snapPoints:g,container:S,handleOnly:b,shouldAnimate:R,autoFocus:k}=wy(),[I,T]=Re.useState(!1),C=yz(i,s),P=Re.useRef(null),M=Re.useRef(null),D=Re.useRef(!1),F=g&&g.length>0;vEe();const U=(V,z,H=0)=>{if(D.current)return!0;const J=Math.abs(V.y),Y=Math.abs(V.x),G=Y>J,K=["bottom","right"].includes(z)?1:-1;if(z==="left"||z==="right"){if(!(V.x*K<0)&&Y>=0&&Y<=H)return G}else if(!(V.y*K<0)&&J>=0&&J<=H)return!G;return D.current=!0,!0};Re.useEffect(()=>{F&&window.requestAnimationFrame(()=>{T(!0)})},[]);function B(V){P.current=null,D.current=!1,a(V)}return Re.createElement(iL,{"data-vaul-drawer-direction":v,"data-vaul-drawer":"","data-vaul-delayed-snap-points":I?"true":"false","data-vaul-snap-points":m&&F?"true":"false","data-vaul-custom-container":S?"true":"false","data-vaul-animate":R!=null&&R.current?"true":"false",...r,ref:C,style:u&&u.length>0?{"--snap-point-height":`${u[h??0]}px`,...e}:e,onPointerDown:V=>{b||(r.onPointerDown==null||r.onPointerDown.call(r,V),P.current={x:V.pageX,y:V.pageY},o(V))},onOpenAutoFocus:V=>{t==null||t(V),k||V.preventDefault()},onPointerDownOutside:V=>{if(n==null||n(V),!p||V.defaultPrevented){V.preventDefault();return}l.current&&(l.current=!1)},onFocusOutside:V=>{if(!p){V.preventDefault();return}},onPointerMove:V=>{if(M.current=V,b||(r.onPointerMove==null||r.onPointerMove.call(r,V),!P.current))return;const z=V.pageY-P.current.y,H=V.pageX-P.current.x,J=V.pointerType==="touch"?10:2;U({x:H,y:z},v,J)?c(V):(Math.abs(H)>J||Math.abs(z)>J)&&(P.current=null)},onPointerUp:V=>{r.onPointerUp==null||r.onPointerUp.call(r,V),P.current=null,D.current=!1,a(V)},onPointerOut:V=>{r.onPointerOut==null||r.onPointerOut.call(r,V),B(M.current)},onContextMenu:V=>{r.onContextMenu==null||r.onContextMenu.call(r,V),M.current&&B(M.current)}})});Tz.displayName="Drawer.Content";const bEe=250,SEe=120,wEe=Re.forwardRef(function({preventCycle:n=!1,children:e,...t},r){const{closeDrawer:i,isDragging:s,snapPoints:o,activeSnapPoint:a,setActiveSnapPoint:c,dismissible:l,handleOnly:u,isOpen:h,onPress:p,onDrag:m}=wy(),v=Re.useRef(null),g=Re.useRef(!1);function S(){if(g.current){k();return}window.setTimeout(()=>{b()},SEe)}function b(){if(s||n||g.current){k();return}if(k(),!o||o.length===0){l||i();return}if(a===o[o.length-1]&&l){i();return}const T=o.findIndex(P=>P===a);if(T===-1)return;const C=o[T+1];c(C)}function R(){v.current=window.setTimeout(()=>{g.current=!0},bEe)}function k(){v.current&&window.clearTimeout(v.current),g.current=!1}return Re.createElement("div",{onClick:S,onPointerCancel:k,onPointerDown:I=>{u&&p(I),R()},onPointerMove:I=>{u&&m(I)},ref:r,"data-vaul-drawer-visible":h?"true":"false","data-vaul-handle":"","aria-hidden":"true",...t},Re.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},e))});wEe.displayName="Drawer.Handle";function EEe(n){const e=wy(),{container:t=e.container,...r}=n;return Re.createElement(nL,{container:t,...r})}const Ki={Root:_Ee,Content:Tz,Overlay:Cz,Trigger:Ywe,Portal:EEe,Title:sL},CEe="_bg_gd68h_17",TEe="_drawer_gd68h_26",IEe="_body_gd68h_60",fS={bg:CEe,drawer:TEe,body:IEe},aL=_.createContext(null);function cL(){var e;const n=(e=globalThis.navigator)==null?void 0:e.userAgent;return/android/i.test(n)?"android":/iPad|iPhone|iPod|Mac/.test(n)&&"ontouchend"in document?"ios":"other"}const lL=_.forwardRef(({title:n,children:e,className:t,...r},i)=>w.jsx("div",{ref:i,className:De(t,fS.drawer),"aria-label":n,"data-platform":cL(),...r,role:"menu",children:w.jsx("div",{className:fS.body,children:e})}));lL.displayName="DrawerMenu";const REe=({onSelect:n,children:e})=>w.jsx(BW,{onSelect:n??void 0,asChild:!0,children:e}),kEe=({title:n,onOpenChange:e,trigger:t,hasAccessibleAlternative:r,children:i})=>{const[s,o]=_.useState(!1),a=_.useCallback(m=>{o(m),e==null||e(m)},[o,e]),c=cL(),l=c==="android"||c==="ios",u=_.useMemo(()=>({MenuItemWrapper:l?null:REe,onOpenChange:a}),[a]),h=w.jsx(aL.Provider,{value:u,children:i}),p=w.jsx(XSe,{"aria-haspopup":"menu",tabIndex:r?void 0:0,asChild:!0,children:t});return l?w.jsxs(w.Fragment,{children:[w.jsx(U9,{onOpenChange:a,children:p}),w.jsx(Ki.Root,{open:s,onOpenChange:a,children:w.jsxs(Ki.Portal,{children:[w.jsx(Ki.Overlay,{className:De(fS.bg)}),w.jsx(Ki.Content,{asChild:!0,children:w.jsx(lL,{title:n,children:h})})]})})]}):w.jsxs(U9,{onOpenChange:a,children:[p,w.jsx(JSe,{children:w.jsx(ZSe,{asChild:!0,children:w.jsx(Y6,{title:n,children:h})})})]})},xEe="_glass_1x9g9_17",PEe={glass:xEe},Iz=_.forwardRef(({children:n,className:e,...t},r)=>w.jsx("div",{ref:r,className:De(e,PEe.glass),...t,children:_.Children.only(n)}));Iz.displayName="Glass";const bu=({as:n="h1",children:e,...t})=>w.jsx(lq,{as:n,type:"heading",...t,children:e}),LEe="_link_ue21z_17",AEe={link:LEe},MEe=_.forwardRef(function({children:e,className:t,kind:r="primary",size:i="medium",...s},o){return w.jsx("a",{ref:o,...s,rel:"noreferrer noopener",className:De(AEe.link,t),"data-kind":r,"data-size":i,children:e})});var uL="DropdownMenu",[OEe,oqe]=Ba(uL,[Qw]),Ii=Qw(),[NEe,Rz]=OEe(uL),kz=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=n,c=Ii(e),l=_.useRef(null),[u=!1,h]=zw({prop:i,defaultProp:s,onChange:o});return w.jsx(NEe,{scope:e,triggerId:Tc(),triggerRef:l,contentId:Tc(),open:u,onOpenChange:h,onOpenToggle:_.useCallback(()=>h(p=>!p),[h]),modal:a,children:w.jsx(_W,{...c,open:u,onOpenChange:h,dir:r,modal:a,children:t})})};kz.displayName=uL;var xz="DropdownMenuTrigger",Pz=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,s=Rz(xz,t),o=Ii(t);return w.jsx(bW,{asChild:!0,...o,children:w.jsx(Jn.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:Ha(e,s.triggerRef),onPointerDown:Ze(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Ze(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});Pz.displayName=xz;var DEe="DropdownMenuPortal",Lz=n=>{const{__scopeDropdownMenu:e,...t}=n,r=Ii(e);return w.jsx(SW,{...r,...t})};Lz.displayName=DEe;var Az="DropdownMenuContent",Mz=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Rz(Az,t),s=Ii(t),o=_.useRef(!1);return w.jsx(wW,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:Ze(n.onCloseAutoFocus,a=>{var c;o.current||(c=i.triggerRef.current)==null||c.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:Ze(n.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;(!i.modal||u)&&(o.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Mz.displayName=Az;var FEe="DropdownMenuGroup",UEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(EW,{...i,...r,ref:e})});UEe.displayName=FEe;var jEe="DropdownMenuLabel",$Ee=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(CW,{...i,...r,ref:e})});$Ee.displayName=jEe;var BEe="DropdownMenuItem",Oz=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(TW,{...i,...r,ref:e})});Oz.displayName=BEe;var HEe="DropdownMenuCheckboxItem",VEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(IW,{...i,...r,ref:e})});VEe.displayName=HEe;var GEe="DropdownMenuRadioGroup",qEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(RW,{...i,...r,ref:e})});qEe.displayName=GEe;var KEe="DropdownMenuRadioItem",WEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(kW,{...i,...r,ref:e})});WEe.displayName=KEe;var zEe="DropdownMenuItemIndicator",YEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(xW,{...i,...r,ref:e})});YEe.displayName=zEe;var XEe="DropdownMenuSeparator",JEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(PW,{...i,...r,ref:e})});JEe.displayName=XEe;var ZEe="DropdownMenuArrow",QEe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(LW,{...i,...r,ref:e})});QEe.displayName=ZEe;var eCe="DropdownMenuSubTrigger",tCe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(AW,{...i,...r,ref:e})});tCe.displayName=eCe;var nCe="DropdownMenuSubContent",rCe=_.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=Ii(t);return w.jsx(MW,{...i,...r,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});rCe.displayName=nCe;var iCe=kz,sCe=Pz,oCe=Lz,aCe=Mz;const cCe=({onSelect:n,children:e})=>w.jsx(Oz,{onSelect:n??void 0,asChild:!0,children:e}),dL=({title:n,showTitle:e=!0,open:t,onOpenChange:r,trigger:i,children:s,side:o="bottom",align:a="center"})=>{const c=cL(),l=c==="android"||c==="ios",u=_.useMemo(()=>({MenuItemWrapper:l?null:cCe,onOpenChange:r}),[r]),h=w.jsx(aL.Provider,{value:u,children:s});return l?w.jsxs(Ki.Root,{open:t,onOpenChange:r,children:[w.jsx(Ki.Trigger,{asChild:!0,children:i}),w.jsxs(Ki.Portal,{children:[w.jsx(Ki.Overlay,{className:De(fS.bg)}),w.jsx(Ki.Content,{asChild:!0,children:w.jsx(lL,{title:n,children:h})})]})]}):w.jsxs(iCe,{open:t,onOpenChange:r,children:[w.jsx(sCe,{asChild:!0,children:i}),w.jsx(oCe,{children:w.jsx(aCe,{asChild:!0,side:o,align:a,sideOffset:8,onCloseAutoFocus:p=>{p.preventDefault()},children:w.jsx(Y6,{title:n,showTitle:e,children:h})})})]})},lCe="_item_8j2l6_17",uCe="_interactive_8j2l6_35",dCe="_icon_8j2l6_43",hCe="_label_8j2l6_52",fCe="_disabled_8j2l6_118",ml={item:lCe,interactive:uCe,"no-label":"_no-label_8j2l6_39",icon:dCe,label:hCe,"nav-hint":"_nav-hint_8j2l6_59",disabled:fCe};function Nz(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M8.7 17.3a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l3.9-3.9-3.9-3.9a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l4.6 4.6c.1.1.17.208.213.325.041.117.062.242.062.375s-.02.258-.063.375a.877.877 0 0 1-.212.325l-4.6 4.6a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}Nz.displayName="ChevronRightIcon";const Dz=_.forwardRef(Nz),rp=({as:n,className:e,Icon:t,label:r,labelProps:i,onSelect:s,kind:o="primary",children:a,onClick:c,disabled:l,...u})=>{const h=n??"button",p=_.useContext(aL),m=_.useCallback(R=>{if(c==null||c(R),s!==null&&(p==null?void 0:p.MenuItemWrapper)==null){const k=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});s(k),k.defaultPrevented||p==null||p.onOpenChange(!1)}},[p,s]),v=_.isValidElement(t),g=t,S=t,b=w.jsxs(h,{role:"menuitem",...u,className:De(e,ml.item,{[ml.interactive]:s!==null,[ml["no-label"]]:r===null,[ml.disabled]:l}),"data-kind":o,onClick:m,disabled:h==="button"?l:void 0,"aria-disabled":h==="button"?void 0:l,children:[v?w.jsx(np,{className:ml.icon,children:g}):w.jsx(S,{width:24,height:24,className:ml.icon,"aria-hidden":!0}),r!==null&&w.jsx(Xt,{className:ml.label,size:"md",weight:"medium",as:"span",...i,children:r}),(h==="button"||h==="a")&&w.jsx(Dz,{width:8,height:24,className:ml["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return(p==null?void 0:p.MenuItemWrapper)==null||s===null?b:w.jsx(p.MenuItemWrapper,{onSelect:s,children:b})};var pCe="Label",Fz=_.forwardRef((n,e)=>w.jsx(Jn.label,{...n,ref:e,onMouseDown:t=>{var i;t.target.closest("button, input, select, textarea")||((i=n.onMouseDown)==null||i.call(n,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Fz.displayName=pCe;var[hL,aqe]=Ba("Form"),fL="Form",[mCe,Ey]=hL(fL),[gCe,Uz]=hL(fL),jz=_.forwardRef((n,e)=>{const{__scopeForm:t,onClearServerErrors:r=()=>{},...i}=n,s=_.useRef(null),o=sn(e,s),[a,c]=_.useState({}),l=_.useCallback(F=>a[F],[a]),u=_.useCallback((F,U)=>c(B=>({...B,[F]:{...B[F]??{},...U}})),[]),h=_.useCallback(F=>{c(U=>({...U,[F]:void 0})),R(U=>({...U,[F]:{}}))},[]),[p,m]=_.useState({}),v=_.useCallback(F=>p[F]??[],[p]),g=_.useCallback((F,U)=>{m(B=>({...B,[F]:[...B[F]??[],U]}))},[]),S=_.useCallback((F,U)=>{m(B=>({...B,[F]:(B[F]??[]).filter(V=>V.id!==U)}))},[]),[b,R]=_.useState({}),k=_.useCallback(F=>b[F]??{},[b]),I=_.useCallback((F,U)=>{R(B=>({...B,[F]:{...B[F]??{},...U}}))},[]),[T,C]=_.useState({}),P=_.useCallback((F,U)=>{C(B=>{const V=new Set(B[F]).add(U);return{...B,[F]:V}})},[]),M=_.useCallback((F,U)=>{C(B=>{const V=new Set(B[F]);return V.delete(U),{...B,[F]:V}})},[]),D=_.useCallback(F=>Array.from(T[F]??[]).join(" ")||void 0,[T]);return w.jsx(mCe,{scope:t,getFieldValidity:l,onFieldValidityChange:u,getFieldCustomMatcherEntries:v,onFieldCustomMatcherEntryAdd:g,onFieldCustomMatcherEntryRemove:S,getFieldCustomErrors:k,onFieldCustomErrorsChange:I,onFieldValiditionClear:h,children:w.jsx(gCe,{scope:t,onFieldMessageIdAdd:P,onFieldMessageIdRemove:M,getFieldDescription:D,children:w.jsx(Jn.form,{...i,ref:o,onInvalid:Ze(n.onInvalid,F=>{const U=Vz(F.currentTarget);U===F.target&&U.focus(),F.preventDefault()}),onSubmit:Ze(n.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:Ze(n.onReset,r)})})})});jz.displayName=fL;var pL="FormField",[vCe,mL]=hL(pL),$z=_.forwardRef((n,e)=>{const{__scopeForm:t,name:r,serverInvalid:i=!1,...s}=n,a=Ey(pL,t).getFieldValidity(r),c=Tc();return w.jsx(vCe,{scope:t,id:c,name:r,serverInvalid:i,children:w.jsx(Jn.div,{"data-valid":vL(a,i),"data-invalid":yL(a,i),...s,ref:e})})});$z.displayName=pL;var A3="FormLabel",Bz=_.forwardRef((n,e)=>{const{__scopeForm:t,...r}=n,i=Ey(A3,t),s=mL(A3,t),o=r.htmlFor||s.id,a=i.getFieldValidity(s.name);return w.jsx(Fz,{"data-valid":vL(a,s.serverInvalid),"data-invalid":yL(a,s.serverInvalid),...r,ref:e,htmlFor:o})});Bz.displayName=A3;var Q_="FormControl",Hz=_.forwardRef((n,e)=>{const{__scopeForm:t,...r}=n,i=Ey(Q_,t),s=mL(Q_,t),o=Uz(Q_,t),a=_.useRef(null),c=sn(e,a),l=r.name||s.name,u=r.id||s.id,h=i.getFieldCustomMatcherEntries(l),{onFieldValidityChange:p,onFieldCustomErrorsChange:m,onFieldValiditionClear:v}=i,g=_.useCallback(async R=>{if(Gz(R.validity)){const B=t2(R.validity);p(l,B);return}const k=R.form?new FormData(R.form):new FormData,I=[R.value,k],T=[],C=[];h.forEach(B=>{RCe(B,I)?C.push(B):kCe(B)&&T.push(B)});const P=T.map(({id:B,match:V})=>[B,V(...I)]),M=Object.fromEntries(P),D=Object.values(M).some(Boolean),F=D;R.setCustomValidity(F?Rv:"");const U=t2(R.validity);if(p(l,U),m(l,M),!D&&C.length>0){const B=C.map(({id:G,match:K})=>K(...I).then(ee=>[G,ee])),V=await Promise.all(B),z=Object.fromEntries(V),J=Object.values(z).some(Boolean);R.setCustomValidity(J?Rv:"");const Y=t2(R.validity);p(l,Y),m(l,z)}},[h,l,m,p]);_.useEffect(()=>{const R=a.current;if(R){const k=()=>g(R);return R.addEventListener("change",k),()=>R.removeEventListener("change",k)}},[g]);const S=_.useCallback(()=>{const R=a.current;R&&(R.setCustomValidity(""),v(l))},[l,v]);_.useEffect(()=>{var k;const R=(k=a.current)==null?void 0:k.form;if(R)return R.addEventListener("reset",S),()=>R.removeEventListener("reset",S)},[S]),_.useEffect(()=>{const R=a.current,k=R==null?void 0:R.closest("form");if(k&&s.serverInvalid){const I=Vz(k);I===R&&I.focus()}},[s.serverInvalid]);const b=i.getFieldValidity(l);return w.jsx(Jn.input,{"data-valid":vL(b,s.serverInvalid),"data-invalid":yL(b,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(l),title:"",...r,ref:c,id:u,name:l,onInvalid:Ze(n.onInvalid,R=>{const k=R.currentTarget;g(k)}),onChange:Ze(n.onChange,R=>{S()})})});Hz.displayName=Q_;var Rv="This value is not valid",yCe={badInput:Rv,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},Cy="FormMessage",_Ce=_.forwardRef((n,e)=>{const{match:t,name:r,...i}=n,s=mL(Cy,n.__scopeForm),o=r??s.name;return t===void 0?w.jsx(gL,{...i,ref:e,name:o,children:n.children||Rv}):typeof t=="function"?w.jsx(SCe,{match:t,...i,ref:e,name:o}):w.jsx(bCe,{match:t,...i,ref:e,name:o})});_Ce.displayName=Cy;var bCe=_.forwardRef((n,e)=>{const{match:t,forceMatch:r=!1,name:i,children:s,...o}=n,c=Ey(Cy,o.__scopeForm).getFieldValidity(i);return r||(c==null?void 0:c[t])?w.jsx(gL,{ref:e,...o,name:i,children:s??yCe[t]}):null}),SCe=_.forwardRef((n,e)=>{const{match:t,forceMatch:r=!1,name:i,id:s,children:o,...a}=n,c=Ey(Cy,a.__scopeForm),l=_.useRef(null),u=sn(e,l),h=Tc(),p=s??h,m=_.useMemo(()=>({id:p,match:t}),[p,t]),{onFieldCustomMatcherEntryAdd:v,onFieldCustomMatcherEntryRemove:g}=c;_.useEffect(()=>(v(i,m),()=>g(i,m.id)),[m,i,v,g]);const S=c.getFieldValidity(i),R=c.getFieldCustomErrors(i)[p];return r||S&&!Gz(S)&&R?w.jsx(gL,{id:p,ref:u,...a,name:i,children:o??Rv}):null}),gL=_.forwardRef((n,e)=>{const{__scopeForm:t,id:r,name:i,...s}=n,o=Uz(Cy,t),a=Tc(),c=r??a,{onFieldMessageIdAdd:l,onFieldMessageIdRemove:u}=o;return _.useEffect(()=>(l(i,c),()=>u(i,c)),[i,c,l,u]),w.jsx(Jn.span,{id:c,...s,ref:e})}),wCe="FormSubmit",ECe=_.forwardRef((n,e)=>{const{__scopeForm:t,...r}=n;return w.jsx(Jn.button,{type:"submit",...r,ref:e})});ECe.displayName=wCe;function t2(n){const e={};for(const t in n)e[t]=n[t];return e}function CCe(n){return n instanceof HTMLElement}function TCe(n){return"validity"in n}function ICe(n){return TCe(n)&&(n.validity.valid===!1||n.getAttribute("aria-invalid")==="true")}function Vz(n){const e=n.elements,[t]=Array.from(e).filter(CCe).filter(ICe);return t}function RCe(n,e){return n.match.constructor.name==="AsyncFunction"||xCe(n.match,e)}function kCe(n){return n.match.constructor.name==="Function"}function xCe(n,e){return n(...e)instanceof Promise}function Gz(n){let e=!1;for(const t in n){const r=t;if(r!=="valid"&&r!=="customError"&&n[r]){e=!0;break}}return e}function vL(n,e){if((n==null?void 0:n.valid)===!0&&!e)return!0}function yL(n,e){if((n==null?void 0:n.valid)===!1||e)return!0}var PCe=jz,LCe=$z,ACe=Bz,qz=Hz;const MCe="_root_ssths_24",OCe="_label_ssths_67",$g={root:MCe,"inline-field":"_inline-field_ssths_40","inline-field-body":"_inline-field-body_ssths_46","inline-field-control":"_inline-field-control_ssths_52",label:OCe},NCe=_.forwardRef(function({children:e,...t},r){const i=De($g.label,t.className);return w.jsx(ACe,{ref:r,...t,className:i,children:e})});var DCe="Separator",X9="horizontal",FCe=["horizontal","vertical"],Kz=_.forwardRef((n,e)=>{const{decorative:t,orientation:r=X9,...i}=n,s=UCe(r)?r:X9,a=t?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return w.jsx(Jn.div,{"data-orientation":s,...a,...i,ref:e})});Kz.displayName=DCe;function UCe(n){return FCe.includes(n)}var jCe=Kz;const $Ce="_separator_144s5_17",BCe={separator:$Ce},J9="--cpd-separator-spacing",Wz=_.forwardRef(({className:n,spacing:e,kind:t="primary",...r},i)=>{const s=De(BCe.separator,n),o=_.useRef(null),a=Dq([o,i]);return _.useEffect(()=>{var l;const c=(l=o.current)==null?void 0:l.style;e?c==null||c.setProperty(J9,e):c==null||c.removeProperty(J9)},[e]),w.jsx(jCe,{...r,className:s,ref:a,"data-kind":t})});Wz.displayName="Separator";const HCe="_container_qnvru_18",VCe="_input_qnvru_32",GCe="_ui_qnvru_42",n2={container:HCe,input:VCe,ui:GCe},zz=_.forwardRef(function({className:e,...t},r){const i=De(n2.container,e);return w.jsxs("div",{className:i,children:[w.jsx("input",{ref:r,className:n2.input,...t,type:"checkbox"}),w.jsx("div",{className:n2.ui})]})});_.forwardRef(function(e,t){return w.jsx(qz,{asChild:!0,children:w.jsx(zz,{ref:t,...e})})});const _L=_.forwardRef(function({className:e,Icon:t,label:r,onSelect:i,checked:s,disabled:o},a){const c=_.useId(),l=_.useCallback(()=>{},[]);return w.jsx(rp,{as:"div",role:"menuitemcheckbox","aria-checked":s,className:e,Icon:t,label:r,onSelect:i,disabled:o,children:w.jsx(zz,{id:c,ref:a,"aria-hidden":!0,checked:s,disabled:o,onChange:l})})}),Z9=_.forwardRef(function({children:e,...t},r){const i=De($g.root,t.className);return w.jsx(PCe,{ref:r,...t,className:i,children:e})}),qCe=_.forwardRef(function({className:e,control:t,children:r,...i},s){const o=De($g["inline-field"],e);return w.jsxs(LCe,{ref:s,...i,className:o,children:[w.jsx("div",{className:$g["inline-field-control"],children:t}),w.jsx("div",{className:$g["inline-field-body"],children:r})]})}),KCe="_icon_1ye7b_27",WCe={icon:KCe};function Yz(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2Z",clipRule:"evenodd"})})}Yz.displayName="SpinnerIcon";const zCe=_.forwardRef(Yz),YCe=_.forwardRef(function({size:e=20,...t},r){return w.jsx(zCe,{ref:r,className:WCe.icon,style:{width:e,height:e},...t})}),XCe="_button_i91xf_17",JCe="_destructive_i91xf_116",zm={button:XCe,"icon-only":"_icon-only_i91xf_59","has-icon":"_has-icon_i91xf_66",destructive:JCe},Dt=_.forwardRef(function({as:e,kind:t="primary",size:r="lg",children:i,className:s,iconOnly:o,Icon:a,destructive:c,disabled:l,...u},h){const[p,m]=t==="destructive"?["secondary",!0]:[t,c],v=De(zm.button,s,{[zm["has-icon"]]:a,[zm["icon-only"]]:o,[zm.destructive]:m}),g=o&&r==="lg"?24:20;return w.jsxs(uq,{...u,as:e||"button",ref:h,className:v,"data-size":r,"data-kind":p,tabIndex:0,disabled:l,children:[a&&w.jsx(a,{width:g,height:g,className:zm.icon,"aria-hidden":!0}),i]})});function Xz(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12 16c1.25 0 2.313-.438 3.188-1.313.874-.874 1.312-1.937 1.312-3.187 0-1.25-.438-2.313-1.313-3.188C14.313 7.439 13.25 7 12 7c-1.25 0-2.312.438-3.187 1.313C7.938 9.187 7.5 10.25 7.5 11.5c0 1.25.438 2.313 1.313 3.188C9.688 15.562 10.75 16 12 16Zm0-1.8c-.75 0-1.387-.262-1.912-.787A2.604 2.604 0 0 1 9.3 11.5c0-.75.263-1.387.787-1.912A2.604 2.604 0 0 1 12 8.8c.75 0 1.387.262 1.912.787.525.526.788 1.163.788 1.913s-.262 1.387-.787 1.912A2.604 2.604 0 0 1 12 14.2Zm0 4.8c-2.317 0-4.433-.613-6.35-1.837-1.917-1.226-3.367-2.88-4.35-4.963a.812.812 0 0 1-.1-.313 2.93 2.93 0 0 1 0-.774.812.812 0 0 1 .1-.313c.983-2.083 2.433-3.738 4.35-4.963C7.567 4.614 9.683 4 12 4c2.317 0 4.433.612 6.35 1.838 1.917 1.224 3.367 2.879 4.35 4.962a.81.81 0 0 1 .1.313 2.925 2.925 0 0 1 0 .774.81.81 0 0 1-.1.313c-.983 2.083-2.433 3.738-4.35 4.963C16.433 18.387 14.317 19 12 19Zm0-2a9.544 9.544 0 0 0 5.188-1.488A9.773 9.773 0 0 0 20.8 11.5a9.773 9.773 0 0 0-3.613-4.013A9.544 9.544 0 0 0 12 6a9.545 9.545 0 0 0-5.187 1.487A9.773 9.773 0 0 0 3.2 11.5a9.773 9.773 0 0 0 3.613 4.012A9.544 9.544 0 0 0 12 17Z"})})}Xz.displayName="VisibilityOnIcon";const ZCe=_.forwardRef(Xz);function Jz(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M9.55 17.575c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212L4.55 13c-.183-.183-.27-.42-.263-.713.009-.291.105-.529.288-.712a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275L9.55 15.15l8.475-8.475c.183-.183.42-.275.713-.275.291 0 .529.092.712.275.183.183.275.42.275.713 0 .291-.092.529-.275.712l-9.2 9.2c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}Jz.displayName="CheckIcon";const Zz=_.forwardRef(Jz),QCe="_container_1vw5h_18",eTe="_input_1vw5h_26",tTe="_ui_1vw5h_27",r2={container:QCe,input:eTe,ui:tTe},nTe=_.forwardRef(function({className:e,...t},r){const i=De(r2.container,e);return w.jsxs("div",{className:i,children:[w.jsx("input",{ref:r,...t,className:r2.input,type:"radio"}),w.jsx("div",{className:r2.ui})]})}),rTe=_.forwardRef(function(e,t){return w.jsx(qz,{asChild:!0,children:w.jsx(nTe,{ref:t,...e})})}),iTe="_content_md016_17",sTe="_destructive_md016_43",oTe="_success_md016_48",i2={content:iTe,destructive:sTe,success:oTe};function aTe({className:n,size:e="large",destructive:t=!1,success:r=!1,children:i}){return w.jsx("div",{className:De(i2.content,n,{[i2.destructive]:t,[i2.success]:r}),"data-size":e,children:Re.Children.only(i)})}const kv={"nav-bar":"_nav-bar_135dy_16","nav-bar-items":"_nav-bar-items_135dy_22","nav-tab":"_nav-tab_135dy_33","nav-item":"_nav-item_135dy_55"},cTe=({children:n,className:e,role:t,"aria-label":r,...i})=>{const s=De(e,kv["nav-bar"]),o=t!=="tablist"?{role:"navigation","aria-label":r}:{role:"presentation"},a=t==="tablist"?{role:"tablist","aria-label":r}:{};return w.jsx("nav",{...o,...i,className:s,children:w.jsx("ul",{...a,className:kv["nav-bar-items"],children:n})})},lTe=_.forwardRef(function({children:e,href:t,onClick:r,...i},s){return w.jsx("a",{href:t,onClick:r,className:kv["nav-item"],...i,ref:s,children:e})}),uTe=_.forwardRef(function({children:e,disabled:t,onClick:r,...i},s){return w.jsx("button",{onClick:r,className:kv["nav-item"],disabled:t,ref:s,...i,children:e})}),dTe=n=>"href"in n&&!!n.href,hTe=_.forwardRef(function(e,t){const r=e["aria-controls"],s=!!r?{"aria-controls":r,role:"tab","aria-selected":e.active}:{"aria-current":e.active?!0:void 0},o={...e};delete o.active;let a;if(dTe(o)){const c=t;a=w.jsx(lTe,{...o,...s,ref:c})}else{const c=t;a=w.jsx(uTe,{...o,...s,ref:c})}return w.jsx("li",{className:kv["nav-tab"],"data-current":e.active?!0:void 0,role:"presentation",children:a})});function Qz(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12 14.95c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212l-4.6-4.6a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l3.9 3.9 3.9-3.9a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7l-4.6 4.6c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}Qz.displayName="ChevronDownIcon";const fTe=_.forwardRef(Qz);function eY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"m13.3 17.3-4.6-4.6a.877.877 0 0 1-.213-.325A1.106 1.106 0 0 1 8.425 12c0-.133.02-.258.062-.375A.878.878 0 0 1 8.7 11.3l4.6-4.6a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7L10.8 12l3.9 3.9a.949.949 0 0 1 .275.7.948.948 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}eY.displayName="ChevronLeftIcon";const pTe=_.forwardRef(eY);var s2,Q9;function mTe(){return Q9||(Q9=1,s2={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),s2}var gTe=mTe();const vTe=Wo(gTe);var yTe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function e7(n){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},t=n.match(/<\/?([^\s]+?)[/\s>]/);if(t&&(e.name=t[1],(vTe[t[1]]||n.charAt(n.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var r=n.indexOf("-->");return{type:"comment",comment:r!==-1?n.slice(4,r):""}}for(var i=new RegExp(yTe),s=null;(s=i.exec(n))!==null;)if(s[0].trim())if(s[1]){var o=s[1].trim(),a=[o,""];o.indexOf("=")>-1&&(a=o.split("=")),e.attrs[a[0]]=a[1],i.lastIndex--}else s[2]&&(e.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return e}var _Te=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,bTe=/^\s*$/,STe=Object.create(null);function tY(n,e){switch(e.type){case"text":return n+e.content;case"tag":return n+="<"+e.name+(e.attrs?function(t){var r=[];for(var i in t)r.push(i+'="'+t[i]+'"');return r.length?" "+r.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?n:n+e.children.reduce(tY,"")+"</"+e.name+">";case"comment":return n+"<!--"+e.comment+"-->"}}var wTe={parse:function(n,e){e||(e={}),e.components||(e.components=STe);var t,r=[],i=[],s=-1,o=!1;if(n.indexOf("<")!==0){var a=n.indexOf("<");r.push({type:"text",content:a===-1?n:n.substring(0,a)})}return n.replace(_Te,function(c,l){if(o){if(c!=="</"+t.name+">")return;o=!1}var u,h=c.charAt(1)!=="/",p=c.startsWith("<!--"),m=l+c.length,v=n.charAt(m);if(p){var g=e7(c);return s<0?(r.push(g),r):((u=i[s]).children.push(g),r)}if(h&&(s++,(t=e7(c)).type==="tag"&&e.components[t.name]&&(t.type="component",o=!0),t.voidElement||o||!v||v==="<"||t.children.push({type:"text",content:n.slice(m,n.indexOf("<",m))}),s===0&&r.push(t),(u=i[s-1])&&u.children.push(t),i[s]=t),(!h||t.voidElement)&&(s>-1&&(t.voidElement||t.name===c.slice(2,-1))&&(s--,t=s===-1?r:i[s]),!o&&v!=="<"&&v)){u=s===-1?r:i[s].children;var S=n.indexOf("<",m),b=n.slice(m,S===-1?void 0:S);bTe.test(b)&&(b=" "),(S>-1&&s+u.length>=0||b!==" ")&&u.push({type:"text",content:b})}}),r},stringify:function(n){return n.reduce(function(e,t){return e+tY("",t)},"")}};const eb=(n,e,t,r)=>{var s,o,a,c;const i=[t,{code:e,...r||{}}];if((o=(s=n==null?void 0:n.services)==null?void 0:s.logger)!=null&&o.forward)return n.services.logger.forward(i,"warn","react-i18next::",!0);Qs(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),(c=(a=n==null?void 0:n.services)==null?void 0:a.logger)!=null&&c.warn?n.services.logger.warn(...i):console!=null&&console.warn&&console.warn(...i)},t7={},xv=(n,e,t,r)=>{Qs(t)&&t7[t]||(Qs(t)&&(t7[t]=new Date),eb(n,e,t,r))},nY=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},M3=(n,e,t)=>{n.loadNamespaces(e,nY(n,t))},n7=(n,e,t,r)=>{if(Qs(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(e)>-1)return M3(n,t,r);t.forEach(i=>{n.options.ns.indexOf(i)<0&&n.options.ns.push(i)}),n.loadLanguages(e,nY(n,r))},ETe=(n,e,t={})=>!e.languages||!e.languages.length?(xv(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(n,{lng:t.lng,precheck:(r,i)=>{var s;if(((s=t.bindI18n)==null?void 0:s.indexOf("languageChanging"))>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,n))return!1}}),Qs=n=>typeof n=="string",id=n=>typeof n=="object"&&n!==null,CTe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,TTe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},ITe=n=>TTe[n],RTe=n=>n.replace(CTe,ITe);let O3={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:RTe};const kTe=(n={})=>{O3={...O3,...n}},rY=()=>O3;let iY;const xTe=n=>{iY=n},bL=()=>iY,o2=(n,e)=>{var r;if(!n)return!1;const t=((r=n.props)==null?void 0:r.children)??n.children;return e?t.length>0:!!t},a2=n=>{var t,r;if(!n)return[];const e=((t=n.props)==null?void 0:t.children)??n.children;return(r=n.props)!=null&&r.i18nIsDynamicList?ff(e):e},PTe=n=>Array.isArray(n)&&n.every(_.isValidElement),ff=n=>Array.isArray(n)?n:[n],LTe=(n,e)=>{const t={...e};return t.props=Object.assign(n.props,e.props),t},sY=(n,e,t,r)=>{if(!n)return"";let i="";const s=ff(n),o=e!=null&&e.transSupportBasicHtmlNodes?e.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((a,c)=>{if(Qs(a)){i+=`${a}`;return}if(_.isValidElement(a)){const{props:l,type:u}=a,h=Object.keys(l).length,p=o.indexOf(u)>-1,m=l.children;if(!m&&p&&!h){i+=`<${u}/>`;return}if(!m&&(!p||h)||l.i18nIsDynamicList){i+=`<${c}></${c}>`;return}if(p&&h===1&&Qs(m)){i+=`<${u}>${m}</${u}>`;return}const v=sY(m,e,t,r);i+=`<${c}>${v}</${c}>`;return}if(a===null){eb(t,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:r});return}if(id(a)){const{format:l,...u}=a,h=Object.keys(u);if(h.length===1){const p=l?`${h[0]}, ${l}`:h[0];i+=`{{${p}}}`;return}eb(t,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:r,child:a});return}eb(t,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:r,child:a})}),i},ATe=(n,e,t,r,i,s)=>{if(e==="")return[];const o=r.transKeepBasicHtmlNodesFor||[],a=e&&new RegExp(o.map(S=>`<${S}`).join("|")).test(e);if(!n&&!a&&!s)return[e];const c={},l=S=>{ff(S).forEach(R=>{Qs(R)||(o2(R)?l(a2(R)):id(R)&&!_.isValidElement(R)&&Object.assign(c,R))})};l(n);const u=wTe.parse(`<0>${e}</0>`),h={...c,...i},p=(S,b,R)=>{var T;const k=a2(S),I=v(k,b.children,R);return PTe(k)&&I.length===0||(T=S.props)!=null&&T.i18nIsDynamicList?k:I},m=(S,b,R,k,I)=>{S.dummy?(S.children=b,R.push(_.cloneElement(S,{key:k},I?void 0:b))):R.push(..._.Children.map([S],T=>{const C={...T.props};return delete C.i18nIsDynamicList,_.createElement(T.type,{...C,key:k,ref:T.ref},I?null:b)}))},v=(S,b,R)=>{const k=ff(S);return ff(b).reduce((T,C,P)=>{var D,F;const M=((F=(D=C.children)==null?void 0:D[0])==null?void 0:F.content)&&t.services.interpolator.interpolate(C.children[0].content,h,t.language);if(C.type==="tag"){let U=k[parseInt(C.name,10)];R.length===1&&!U&&(U=R[0][C.name]),U||(U={});const B=Object.keys(C.attrs).length!==0?LTe({props:C.attrs},U):U,V=_.isValidElement(B),z=V&&o2(C,!0)&&!C.voidElement,H=a&&id(B)&&B.dummy&&!V,J=id(n)&&Object.hasOwnProperty.call(n,C.name);if(Qs(B)){const Y=t.services.interpolator.interpolate(B,h,t.language);T.push(Y)}else if(o2(B)||z){const Y=p(B,C,R);m(B,Y,T,P)}else if(H){const Y=v(k,C.children,R);m(B,Y,T,P)}else if(Number.isNaN(parseFloat(C.name)))if(J){const Y=p(B,C,R);m(B,Y,T,P,C.voidElement)}else if(r.transSupportBasicHtmlNodes&&o.indexOf(C.name)>-1)if(C.voidElement)T.push(_.createElement(C.name,{key:`${C.name}-${P}`}));else{const Y=v(k,C.children,R);T.push(_.createElement(C.name,{key:`${C.name}-${P}`},Y))}else if(C.voidElement)T.push(`<${C.name} />`);else{const Y=v(k,C.children,R);T.push(`<${C.name}>${Y}</${C.name}>`)}else if(id(B)&&!V){const Y=C.children[0]?M:null;Y&&T.push(Y)}else m(B,M,T,P,C.children.length!==1||!M)}else if(C.type==="text"){const U=r.transWrapTextNodes,B=s?r.unescape(t.services.interpolator.interpolate(C.content,h,t.language)):t.services.interpolator.interpolate(C.content,h,t.language);U?T.push(_.createElement(U,{key:`${C.name}-${P}`},B)):T.push(B)}return T},[])},g=v([{dummy:!0,children:n||[]}],u,ff(n||[]));return a2(g[0])},oY=(n,e,t)=>{const r=n.key||e,i=_.cloneElement(n,{key:r});if(!i.props||!i.props.children||t.indexOf(`${e}/>`)<0&&t.indexOf(`${e} />`)<0)return i;function s(){return _.createElement(_.Fragment,null,i)}return _.createElement(s,{key:r})},MTe=(n,e)=>n.map((t,r)=>oY(t,r,e)),OTe=(n,e)=>{const t={};return Object.keys(n).forEach(r=>{Object.assign(t,{[r]:oY(n[r],r,e)})}),t},NTe=(n,e,t,r)=>n?Array.isArray(n)?MTe(n,e):id(n)?OTe(n,e):(xv(t,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:r}),null):null;function DTe({children:n,count:e,parent:t,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:u,t:h,shouldUnescape:p,...m}){var B,V,z,H,J,Y;const v=u||bL();if(!v)return xv(v,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:r}),n;const g=h||v.t.bind(v)||(G=>G),S={...rY(),...(B=v.options)==null?void 0:B.react};let b=l||g.ns||((V=v.options)==null?void 0:V.defaultNS);b=Qs(b)?[b]:b||["translation"];const R=sY(n,S,v,r),k=a||R||S.transEmptyNodeValue||r,{hashTransKey:I}=S,T=r||(I?I(R||k):R||k);(H=(z=v.options)==null?void 0:z.interpolation)!=null&&H.defaultVariables&&(o=o&&Object.keys(o).length>0?{...o,...v.options.interpolation.defaultVariables}:{...v.options.interpolation.defaultVariables});const C=o||e!==void 0&&!((Y=(J=v.options)==null?void 0:J.interpolation)!=null&&Y.alwaysFormat)||!n?s.interpolation:{interpolation:{...s.interpolation,prefix:"#$?",suffix:"?$#"}},P={...s,context:i||s.context,count:e,...o,...C,defaultValue:k,ns:b},M=T?g(T,P):k,D=NTe(c,M,v,r),F=ATe(D||n,M,v,S,P,p),U=t??S.defaultTransParent;return U?_.createElement(U,m,F):F}const FTe={type:"3rdParty",init(n){kTe(n.options.react),xTe(n)}},aY=_.createContext();class UTe{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function Ci({children:n,count:e,parent:t,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:u,t:h,shouldUnescape:p,...m}){var R;const{i18n:v,defaultNS:g}=_.useContext(aY)||{},S=u||v||bL(),b=h||(S==null?void 0:S.t.bind(S));return DTe({children:n,count:e,parent:t,i18nKey:r,context:i,tOptions:s,values:o,defaults:a,components:c,ns:l||(b==null?void 0:b.ns)||g||((R=S==null?void 0:S.options)==null?void 0:R.defaultNS),i18n:S,t:h,shouldUnescape:p,...m})}const jTe=(n,e)=>{const t=_.useRef();return _.useEffect(()=>{t.current=n},[n,e]),t.current},cY=(n,e,t,r)=>n.getFixedT(e,t,r),$Te=(n,e,t,r)=>_.useCallback(cY(n,e,t,r),[n,e,t,r]),Xe=(n,e={})=>{var I,T,C,P;const{i18n:t}=e,{i18n:r,defaultNS:i}=_.useContext(aY)||{},s=t||r||bL();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new UTe),!s){xv(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const M=(F,U)=>Qs(U)?U:id(U)&&Qs(U.defaultValue)?U.defaultValue:Array.isArray(F)?F[F.length-1]:F,D=[M,{},!1];return D.t=M,D.i18n={},D.ready=!1,D}(I=s.options.react)!=null&&I.wait&&xv(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...rY(),...s.options.react,...e},{useSuspense:a,keyPrefix:c}=o;let l=i||((T=s.options)==null?void 0:T.defaultNS);l=Qs(l)?[l]:l||["translation"],(P=(C=s.reportNamespaces).addUsedNamespaces)==null||P.call(C,l);const u=(s.isInitialized||s.initializedStoreOnce)&&l.every(M=>ETe(M,s,o)),h=$Te(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),p=()=>h,m=()=>cY(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),[v,g]=_.useState(p);let S=l.join();e.lng&&(S=`${e.lng}${S}`);const b=jTe(S),R=_.useRef(!0);_.useEffect(()=>{const{bindI18n:M,bindI18nStore:D}=o;R.current=!0,!u&&!a&&(e.lng?n7(s,e.lng,l,()=>{R.current&&g(m)}):M3(s,l,()=>{R.current&&g(m)})),u&&b&&b!==S&&R.current&&g(m);const F=()=>{R.current&&g(m)};return M&&(s==null||s.on(M,F)),D&&(s==null||s.store.on(D,F)),()=>{R.current=!1,s&&(M==null||M.split(" ").forEach(U=>s.off(U,F))),D&&s&&D.split(" ").forEach(U=>s.store.off(U,F))}},[s,S]),_.useEffect(()=>{R.current&&u&&g(p)},[s,c,u]);const k=[v,s,u];if(k.t=v,k.i18n=s,k.ready=u,u||!u&&!a)return k;throw new Promise(M=>{e.lng?n7(s,e.lng,l,()=>M()):M3(s,l,()=>M())})};function lY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{fillRule:"evenodd",d:"m12 4.236-6 3V12c0 5.156 4.239 7.254 6 7.898 1.761-.644 6-2.742 6-7.898V7.236l-6-3Zm-.894-1.789a2 2 0 0 1 1.788 0l6 3A2 2 0 0 1 20 7.236V12c0 6.742-5.773 9.246-7.51 9.846-.32.111-.66.111-.98 0C9.774 21.246 4 18.742 4 12V7.236a2 2 0 0 1 1.106-1.789l6-3Z",clipRule:"evenodd"})})}lY.displayName="AdminIcon";const BTe=_.forwardRef(lY);function uY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"m12 10.775-3.9 3.9a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l4.6-4.6c.1-.1.208-.17.325-.213.117-.041.242-.062.375-.062s.258.02.375.062a.877.877 0 0 1 .325.213l4.6 4.6a.948.948 0 0 1 .275.7.949.949 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275l-3.9-3.9Z"})})}uY.displayName="ChevronUpIcon";const HTe=_.forwardRef(uY);function dY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12 11.034a.996.996 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 1 0 0-2h-5.586L22 3.446a1 1 0 0 0-1.414-1.415L14 8.617V3.031a1 1 0 1 0-2 0v8.003Zm0 1.963a.997.997 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 11 12H3a1 1 0 0 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 1 0 2 0v-8.003Z"})})}dY.displayName="CollapseIcon";const VTe=_.forwardRef(dY);function hY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M7 21c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 5 19V6a.968.968 0 0 1-.713-.287A.968.968 0 0 1 4 5c0-.283.096-.52.287-.713A.968.968 0 0 1 5 4h4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 10 3h4a.97.97 0 0 1 .713.288A.968.968 0 0 1 15 4h4a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 19 6v13c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 17 21H7ZM7 6v13h10V6H7Zm2 10c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 11 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 10 8a.968.968 0 0 0-.713.287A.968.968 0 0 0 9 9v7Zm4 0c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 15 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 14 8a.968.968 0 0 0-.713.287A.967.967 0 0 0 13 9v7Z"})})}hY.displayName="DeleteIcon";const GTe=_.forwardRef(hY);function fY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.212l1.414-5.657a1 1 0 0 1 .263-.465L15.706 2.637Zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.77 3.771-.942L16.93 9.9Z",clipRule:"evenodd"})})}fY.displayName="EditIcon";const r7=_.forwardRef(fY);function pY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.018 1.018 0 0 1 0 12.852c0-.304.098-.555.295-.751a15.64 15.64 0 0 1 5.316-3.786A15.89 15.89 0 0 1 12 7c2.237 0 4.367.443 6.39 1.329a15.977 15.977 0 0 1 5.315 3.772c.197.196.295.447.295.751 0 .305-.098.555-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.067 1.067 0 0 1-.322-.376 1.066 1.066 0 0 1-.108-.483v-2.27a13.593 13.593 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.175.175c-.715.116-1.422.29-2.12.523v2.271c0 .179-.036.34-.108.483a1.066 1.066 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107Z"})})}pY.displayName="EndCallIcon";const mY=_.forwardRef(pY);function gY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M21 3.997a.996.996 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a.997.997 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0V3.997Z"})})}gY.displayName="ExpandIcon";const vY=_.forwardRef(gY);function yY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M4 11a.967.967 0 0 1-.712-.287A.968.968 0 0 1 3 10V4c0-.283.096-.52.288-.712A.968.968 0 0 1 4 3h6a.97.97 0 0 1 .713.288A.968.968 0 0 1 11 4v6c0 .283-.096.52-.287.713A.968.968 0 0 1 10 11H4Zm5-2V5H5v4h4Zm5 12a.968.968 0 0 1-.713-.288A.968.968 0 0 1 13 20v-6c0-.283.096-.52.287-.713A.968.968 0 0 1 14 13h6a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v6c0 .283-.096.52-.288.712A.968.968 0 0 1 20 21h-6Zm5-2v-4h-4v4h4ZM4 21a.967.967 0 0 1-.712-.288A.968.968 0 0 1 3 20v-6a.97.97 0 0 1 .288-.713A.967.967 0 0 1 4 13h6c.283 0 .52.096.713.287.191.192.287.43.287.713v6a.97.97 0 0 1-.287.712A.968.968 0 0 1 10 21H4Zm5-2v-4H5v4h4Zm5-8a.968.968 0 0 1-.713-.287A.968.968 0 0 1 13 10V4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 14 3h6c.283 0 .52.096.712.288A.965.965 0 0 1 21 4v6a.97.97 0 0 1-.288.713A.968.968 0 0 1 20 11h-6Zm5-2V5h-4v4h4Z"})})}yY.displayName="GridIcon";const qTe=_.forwardRef(yY);function _Y(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M16.712 6.713A.968.968 0 0 1 16 7a.968.968 0 0 1-.713-.287A.967.967 0 0 1 15 6c0-.283.096-.52.287-.713A.968.968 0 0 1 16 5a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713Z"}),w.jsx("path",{fillRule:"evenodd",d:"M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H6Zm12 2H6v4h12V4ZM6 12v-2h12v2H6Zm0 2v2h12v-2H6Zm0 6v-2h12v2H6Z",clipRule:"evenodd"})]})}_Y.displayName="HostIcon";const bY=_.forwardRef(_Y);function SY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12 19.071c-.978.978-2.157 1.467-3.536 1.467-1.378 0-2.557-.489-3.535-1.467-.978-.978-1.467-2.157-1.467-3.536 0-1.378.489-2.557 1.467-3.535L7.05 9.879c.2-.2.436-.3.707-.3.271 0 .507.1.707.3.2.2.301.436.301.707 0 .27-.1.506-.3.707l-2.122 2.121a2.893 2.893 0 0 0-.884 2.122c0 .824.295 1.532.884 2.12.59.59 1.296.885 2.121.885s1.533-.295 2.122-.884l2.121-2.121c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707L12 19.07Zm-1.414-4.243c-.2.2-.436.3-.707.3a.967.967 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l4.243-4.242c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707l-4.242 4.242Zm6.364-.707c-.2.2-.436.3-.707.3a.968.968 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l2.122-2.121c.59-.59.884-1.297.884-2.122s-.295-1.532-.884-2.12a2.893 2.893 0 0 0-2.121-.885c-.825 0-1.532.295-2.122.884l-2.121 2.121c-.2.2-.436.301-.707.301a.968.968 0 0 1-.707-.3.97.97 0 0 1-.3-.708c0-.27.1-.506.3-.707L12 4.93c.978-.978 2.157-1.467 3.536-1.467 1.378 0 2.557.489 3.535 1.467.978.978 1.467 2.157 1.467 3.535 0 1.38-.489 2.558-1.467 3.536l-2.121 2.121Z"})})}SY.displayName="LinkIcon";const KTe=_.forwardRef(SY);function wY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.587-1.412.212-.212.446-.366.703-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 0 1-1.414 1.414l-.896-.896A1.935 1.935 0 0 1 18 22H6Zm14-4.834V10c0-.55-.196-1.02-.587-1.412A1.926 1.926 0 0 0 18 8h-1V6c0-1.383-.488-2.563-1.463-3.538C14.563 1.487 13.383 1 12 1s-2.563.488-3.538 1.462A4.876 4.876 0 0 0 7.243 4.41L9 6.166V6c0-.833.292-1.542.875-2.125A2.893 2.893 0 0 1 12 3c.833 0 1.542.292 2.125.875S15 5.167 15 6v2h-4.166L20 17.166Z"})})}wY.displayName="LockOffIcon";const WTe=_.forwardRef(wY);function EY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 8h1V6c0-1.383.487-2.563 1.463-3.538C9.438 1.487 10.617 1 12 1s2.563.488 3.537 1.462C16.512 3.438 17 4.617 17 6v2h1c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v10c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 22H6ZM9 8h6V6c0-.833-.292-1.542-.875-2.125A2.893 2.893 0 0 0 12 3c-.833 0-1.542.292-2.125.875A2.893 2.893 0 0 0 9 6v2Z"})})}EY.displayName="LockSolidIcon";const zTe=_.forwardRef(EY);function CY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.949 7.949 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Zm9.417 6.583 1.478 1.477A7.963 7.963 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583ZM8.073 5.238l7.793 7.793c.087-.329.134-.674.134-1.031V6a4 4 0 0 0-7.927-.762Z"})})}CY.displayName="MicOffSolidIcon";const TY=_.forwardRef(CY);function IY(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.947 7.947 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Z",clipRule:"evenodd"}),w.jsx("path",{d:"M14 6v5.166l1.866 1.866c.087-.33.134-.675.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0Zm3.417 8.583 1.477 1.477A7.963 7.963 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583Z"})]})}IY.displayName="MicOffIcon";const YTe=_.forwardRef(IY);function RY(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0V6Z"}),w.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8.001 8.001 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 0 1 1-1Z"})]})}RY.displayName="MicOnSolidIcon";const SL=_.forwardRef(RY);function kY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414l4.113 4.114a5.484 5.484 0 0 0-.184 1.069A5.002 5.002 0 0 0 7 20h10.172l1.914 1.914A1 1 0 0 0 20.5 20.5l-.979-.979.004-.002L7.145 7.14l-.002.004L3.5 3.5Zm18.5 12a4.48 4.48 0 0 1-.928 2.738L8.637 5.803A5.474 5.474 0 0 1 11.5 5a5.49 5.49 0 0 1 4.25 2.008 4 4 0 0 1 4.187 4.708A4.497 4.497 0 0 1 22 15.5Z"})})}kY.displayName="OfflineIcon";const XTe=_.forwardRef(kY);function xY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M6 14c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 4 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 6 14Zm6 0c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 12 14Zm6 0c-.55 0-1.02-.196-1.413-.588A1.926 1.926 0 0 1 16 12c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 18 10c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412 0 .55-.196 1.02-.587 1.412A1.926 1.926 0 0 1 18 14Z"})})}xY.displayName="OverflowHorizontalIcon";const JTe=_.forwardRef(xY);function PY(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"}),w.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2Z"})]})}PY.displayName="PopOutIcon";const LY=_.forwardRef(PY);function AY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M11 3a1 1 0 1 1 2 0v8.5a.5.5 0 0 0 1 0V4a1 1 0 1 1 2 0v10.2l3.284-2.597a1.081 1.081 0 0 1 1.47 1.577c-.613.673-1.214 1.367-1.818 2.064-1.267 1.463-2.541 2.934-3.944 4.235A6 6 0 0 1 5 15V7a1 1 0 0 1 2 0v5.5a.5.5 0 0 0 1 0V4a1 1 0 0 1 2 0v7.5a.5.5 0 0 0 1 0V3Z"})})}AY.displayName="RaisedHandSolidIcon";const MY=_.forwardRef(AY);function OY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{fillRule:"evenodd",d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Zm3.536-6.464a1 1 0 0 0-1.415-1.415A2.988 2.988 0 0 1 12 15a2.988 2.988 0 0 1-2.121-.879 1 1 0 1 0-1.414 1.415A4.987 4.987 0 0 0 12 17c1.38 0 2.632-.56 3.536-1.464ZM10 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm5.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z",clipRule:"evenodd"})})}OY.displayName="ReactionSolidIcon";const ZTe=_.forwardRef(OY);function NY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286.085.034.17.07.253.106.531.23 1.162.16 1.572-.25a1.269 1.269 0 0 1 1.794 0l1.034 1.035a1.269 1.269 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572.036.084.07.168.105.253.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935-.033.085-.068.17-.104.253-.232.531-.161 1.162.248 1.572a1.269 1.269 0 0 1 0 1.794l-1.034 1.034a1.269 1.269 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a7.935 7.935 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a7.975 7.975 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.269 1.269 0 0 1-1.794 0l-1.034-1.034a1.269 1.269 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a7.89 7.89 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935.034-.085.07-.17.106-.253.23-.531.16-1.162-.25-1.572a1.269 1.269 0 0 1 0-1.794l1.035-1.034a1.269 1.269 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a7.93 7.93 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2h1.462ZM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"})})}NY.displayName="SettingsSolidIcon";const QTe=_.forwardRef(NY);function DY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M1.288 20.712A.965.965 0 0 0 2 21h20c.283 0 .52-.096.712-.288A.968.968 0 0 0 23 20a.968.968 0 0 0-.288-.712A.968.968 0 0 0 22 19H2a.967.967 0 0 0-.712.288A.968.968 0 0 0 1 20c0 .283.096.52.288.712Zm1.299-3.299A1.926 1.926 0 0 1 2 16V5c0-.55.196-1.02.587-1.413A1.926 1.926 0 0 1 4 3h16c.55 0 1.02.196 1.413.587.39.393.587.863.587 1.413v11c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 18H4c-.55 0-1.02-.196-1.413-.587Zm10.12-10.12a1 1 0 0 0-1.414 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414l-2.5-2.5Z"})})}DY.displayName="ShareScreenSolidIcon";const eIe=_.forwardRef(DY);function FY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12 16a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 15V7.85L9.125 9.725c-.2.2-.433.3-.7.3-.267 0-.508-.108-.725-.325a.93.93 0 0 1-.288-.712A.977.977 0 0 1 7.7 8.3l3.6-3.6c.1-.1.208-.17.325-.212.117-.042.242-.063.375-.063s.258.02.375.063a.877.877 0 0 1 .325.212l3.6 3.6c.2.2.296.438.287.713a.977.977 0 0 1-.287.687c-.2.2-.438.304-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15c0 .283-.096.52-.287.713A.968.968 0 0 1 12 16Zm-6 4c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 18v-2c0-.283.096-.52.287-.713A.968.968 0 0 1 5 15c.283 0 .52.096.713.287.191.192.287.43.287.713v2h12v-2a.97.97 0 0 1 .288-.713A.968.968 0 0 1 19 15a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v2c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 20H6Z"})})}FY.displayName="ShareIcon";const tIe=_.forwardRef(FY);function UY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5V5Zm10 14v-4h4v4h-4ZM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2Z"})})}UY.displayName="SpotlightIcon";const nIe=_.forwardRef(UY);function jY(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M16.293 2.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-2 2a1 1 0 1 1-1.414-1.414L16.586 6H6a2 2 0 0 0-2 2v7a1 1 0 1 1-2 0V8a4 4 0 0 1 4-4h10.586l-.293-.293a1 1 0 0 1 0-1.414ZM18 18H7.414l.293-.293a1 1 0 1 0-1.414-1.414l-2 2a1 1 0 0 0 0 1.414l2 2a1 1 0 0 0 1.414-1.414L7.414 20H18a4 4 0 0 0 4-4V9a1 1 0 1 0-2 0v7a2 2 0 0 1-2 2Z"}),w.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"})]})}jY.displayName="SwitchCameraSolidIcon";const rIe=_.forwardRef(jY);function $Y(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M12.999 13.011v-.004.005Zm-9.412 7.402C3.98 20.803 4.45 21 5 21h14c.55 0 1.02-.196 1.413-.587A1.93 1.93 0 0 0 21 19V5c0-.55-.196-1.02-.587-1.413A1.926 1.926 0 0 0 19 3H5c-.55 0-1.02.196-1.413.587A1.926 1.926 0 0 0 3 5v14c0 .55.196 1.02.587 1.413ZM12 9a1 1 0 0 0-1 1 1 1 0 1 1-2 0 3 3 0 1 1 4.44 2.633 1.404 1.404 0 0 0-.383.288.3.3 0 0 0-.057.085A1 1 0 0 1 11 13c0-.58.253-1.047.539-1.38.281-.33.63-.572.94-.742A1 1 0 0 0 12 9Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})})}$Y.displayName="UnknownSolidIcon";const iIe=_.forwardRef($Y);function BY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M10 12c-1.1 0-2.042-.392-2.825-1.175C6.392 10.042 6 9.1 6 8s.392-2.042 1.175-2.825C7.958 4.392 8.9 4 10 4s2.042.392 2.825 1.175C13.608 5.958 14 6.9 14 8s-.392 2.042-1.175 2.825C12.042 11.608 11.1 12 10 12Zm-8 6v-.8c0-.567.146-1.087.438-1.563A2.911 2.911 0 0 1 3.6 14.55a14.843 14.843 0 0 1 3.15-1.163A13.76 13.76 0 0 1 10 13c1.1 0 2.183.13 3.25.387 1.067.259 2.117.646 3.15 1.163.483.25.87.612 1.163 1.087.291.476.437.996.437 1.563v.8c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 16 20H4c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18Zm2 0h12v-.8a.973.973 0 0 0-.5-.85c-.9-.45-1.808-.787-2.725-1.012a11.6 11.6 0 0 0-5.55 0c-.917.225-1.825.562-2.725 1.012a.973.973 0 0 0-.5.85v.8Zm6-8c.55 0 1.02-.196 1.412-.588C11.804 9.021 12 8.55 12 8c0-.55-.196-1.02-.588-1.412A1.926 1.926 0 0 0 10 6c-.55 0-1.02.196-1.412.588A1.926 1.926 0 0 0 8 8c0 .55.196 1.02.588 1.412.391.392.862.588 1.412.588Zm7 1h2v2c0 .283.096.52.288.713.191.191.429.287.712.287s.52-.096.712-.287A.968.968 0 0 0 21 13v-2h2a.97.97 0 0 0 .712-.287A.968.968 0 0 0 24 10a.967.967 0 0 0-.288-.713A.968.968 0 0 0 23 9h-2V7a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 6a.968.968 0 0 0-.712.287A.967.967 0 0 0 19 7v2h-2a.968.968 0 0 0-.712.287A.967.967 0 0 0 16 10c0 .283.096.52.288.713A.968.968 0 0 0 17 11Z"})})}BY.displayName="UserAddIcon";const sIe=_.forwardRef(BY);function HY(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M9.175 13.825C9.958 14.608 10.9 15 12 15s2.042-.392 2.825-1.175C15.608 13.042 16 12.1 16 11s-.392-2.042-1.175-2.825C14.042 7.392 13.1 7 12 7s-2.042.392-2.825 1.175C8.392 8.958 8 9.9 8 11s.392 2.042 1.175 2.825Zm4.237-1.412A1.926 1.926 0 0 1 12 13c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 11c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 9c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412Z"}),w.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"}),w.jsx("path",{d:"M16.23 18.792a12.47 12.47 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0c-.487.12-.972.271-1.455.455a8.04 8.04 0 0 1-1.729-1.454c.89-.412 1.794-.729 2.709-.95A13.76 13.76 0 0 1 12 16c1.1 0 2.183.13 3.25.387a14.78 14.78 0 0 1 2.709.95 8.042 8.042 0 0 1-1.73 1.455Z"})]})}HY.displayName="UserProfileIcon";const VY=_.forwardRef(HY);function GY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A1.992 1.992 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414ZM18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715v1.45Z"})})}GY.displayName="VideoCallOffSolidIcon";const oIe=_.forwardRef(GY);function qY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4Z"})})}qY.displayName="VideoCallSolidIcon";const KY=_.forwardRef(qY);function WY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2l3.293 3.293c.63.63 1.707.184 1.707-.707v-3.758l7.086 7.086A1 1 0 0 0 20.5 20.5l-2.136-2.136.003-.003-1.414-1.414-.003.003-1.414-1.414.003-.003-1.415-1.415-.002.003L12 12v-.006L7.503 7.497 7.5 7.5l-4-4Zm11.496 8.662 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}WY.displayName="VolumeOffSolidIcon";const aIe=_.forwardRef(WY);function zY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5ZM7.172 10H5v4h2.828L10 16.17v-3.343L7.172 10Zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}zY.displayName="VolumeOffIcon";const cIe=_.forwardRef(zY);function YY(n,e){return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:[w.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4Zm4.828 4L10 16.172V7.828L7.828 10H5v4h2.828Zm6.293-5.536a1 1 0 0 1 1.415 0A4.988 4.988 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 2.987 2.987 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414Z"}),w.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.975 6.975 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.975 8.975 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364Z"})]})}YY.displayName="VolumeOnIcon";const lIe=_.forwardRef(YY);function XY(n,e){return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...n,children:w.jsx("path",{d:"M4 20c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18V6c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 4 4h16c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v12c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 20H4Zm0-2h16V8H4v10Z"})})}XY.displayName="WebBrowserIcon";const uIe=_.forwardRef(XY),dIe="_header_p1omj_8",hIe="_nav_p1omj_18",fIe="_headerLogo_p1omj_26",pIe="_leftNav_p1omj_33",mIe="_hideMobile_p1omj_33",gIe="_rightNav_p1omj_45",vIe="_roomHeaderInfo_p1omj_61",yIe="_roomAvatar_p1omj_76",_Ie="_nameLine_p1omj_81",bIe="_participantsLine_p1omj_100",zs={header:dIe,nav:hIe,headerLogo:fIe,leftNav:pIe,hideMobile:mIe,rightNav:gIe,roomHeaderInfo:vIe,roomAvatar:yIe,nameLine:_Ie,participantsLine:bIe},SIe=(n,e)=>_.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("desc",null,"Element Call (Beta)"),_.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),_.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),_.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),_.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),_.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),_.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),_.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),_.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),wIe=_.forwardRef(SIe);var Op=(n=>(n.XS="xs",n.SM="sm",n.MD="md",n.LG="lg",n.XL="xl",n))(Op||{});const EIe=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]);function CIe(n,e,t=96){const r=Math.floor(t*window.devicePixelRatio),i=Math.floor(t*window.devicePixelRatio),s=t<=96?"crop":"scale";return e?n.mxcUrlToHttp(e,r,i,s,!1,!0,!0):null}const Np=({className:n,id:e,name:t,src:r,size:i="md",style:s,...o})=>{const a=jp(),c=_.useMemo(()=>Object.values(Op).includes(i)?EIe.get(i):i,[i]),[l,u]=_.useState(void 0);return _.useEffect(()=>{if((a==null?void 0:a.state)!=="valid")return;const{authenticated:h,supportedFeatures:p}=a,m=h==null?void 0:h.client;if(!m||!r||!c||!p.thumbnails)return;const v=m.getAccessToken();if(!v)return;const g=CIe(m,r,c);if(!g){u(void 0);return}let S;return fetch(g,{headers:{Authorization:`Bearer ${v}`}}).then(async b=>b.blob()).then(b=>{S=URL.createObjectURL(b),u(S)}).catch(b=>{u(void 0)}),()=>{S&&URL.revokeObjectURL(S)}},[a,r,c]),w.jsx(c_e,{className:n,id:e,name:t,size:`${c}px`,src:l,style:s,...o})},TIe="_lock_zf62g_8",IIe={lock:TIe},RIe=({encrypted:n})=>{const{t:e}=Xe(),t=n?zTe:WTe,r=e(n?"common.encrypted":"common.unencrypted");return w.jsx(di,{label:r,placement:"right",isTriggerInteractive:!1,children:w.jsx(t,{width:16,height:16,className:IIe.lock,"data-encrypted":n})})};function Bg(n,e,t,r){_.useEffect(()=>{if(n)return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)},[n,e,t,r])}function wL(n,e,t){_.useEffect(()=>(n.on(e,t),()=>{n.off(e,t)}),[n,e,t])}function rE(n){const e=_.useMemo(()=>window.matchMedia(n),[n]),[t,r]=_.useState(0);return Bg(e,"change",_.useCallback(()=>r(i=>i+1),[r])),_.useMemo(()=>e.matches,[e,t])}const Su=_.forwardRef(({children:n,className:e,...t},r)=>w.jsx("header",{ref:r,className:De(zs.header,e),...t,children:n}));Su.displayName="Header";const Jd=({children:n,className:e,hideMobile:t,...r})=>w.jsx("div",{className:De(zs.nav,zs.leftNav,{[zs.hideMobile]:t},e),...r,children:n}),Zd=({children:n,className:e,hideMobile:t,...r})=>w.jsx("div",{className:De(zs.nav,zs.rightNav,{[zs.hideMobile]:t},e),...r,children:n}),Dd=({className:n})=>{const{t:e}=Xe();return w.jsx(xw,{className:De(zs.headerLogo,n),to:"/","aria-label":e("header_label"),children:w.jsx(wIe,{})})},JY=({id:n,name:e,avatarUrl:t,encrypted:r,participantCount:i})=>{const{t:s}=Xe(),o=rE("(max-width: 550px)")?"sm":"lg";return w.jsxs("div",{className:zs.roomHeaderInfo,"data-size":o,children:[w.jsx(Np,{className:zs.roomAvatar,id:n,name:e,size:o==="sm"?Op.SM:56,src:t??void 0}),w.jsxs("div",{className:zs.nameLine,children:[w.jsx(bu,{type:o==="sm"?"body":"heading",size:o==="sm"?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:e}),w.jsx(RIe,{encrypted:r})]}),(i??0)>0&&w.jsxs("div",{className:zs.participantsLine,children:[w.jsx(VY,{width:20,height:20,"aria-label":s("header_participants_label")}),w.jsx(Xt,{as:"span",size:"sm",weight:"medium",children:s("participant_count",{count:i??0})})]})]})},kIe="_page_fvtgn_8",xIe="_container_fvtgn_20",PIe="_content_fvtgn_28",c2={page:kIe,container:xIe,content:PIe};var ZY=typeof global=="object"&&global&&global.Object===Object&&global,LIe=typeof self=="object"&&self&&self.Object===Object&&self,Qd=ZY||LIe||Function("return this")(),pS=Qd.Symbol,QY=Object.prototype,AIe=QY.hasOwnProperty,MIe=QY.toString,Ym=pS?pS.toStringTag:void 0;function OIe(n){var e=AIe.call(n,Ym),t=n[Ym];try{n[Ym]=void 0;var r=!0}catch{}var i=MIe.call(n);return r&&(e?n[Ym]=t:delete n[Ym]),i}var NIe=Object.prototype,DIe=NIe.toString;function FIe(n){return DIe.call(n)}var UIe="[object Null]",jIe="[object Undefined]",i7=pS?pS.toStringTag:void 0;function Ty(n){return n==null?n===void 0?jIe:UIe:i7&&i7 in Object(n)?OIe(n):FIe(n)}function Dp(n){return n!=null&&typeof n=="object"}var $Ie="[object Symbol]";function BIe(n){return typeof n=="symbol"||Dp(n)&&Ty(n)==$Ie}var N3=Array.isArray,HIe=/\s/;function VIe(n){for(var e=n.length;e--&&HIe.test(n.charAt(e)););return e}var GIe=/^\s+/;function qIe(n){return n&&n.slice(0,VIe(n)+1).replace(GIe,"")}function qo(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var s7=NaN,KIe=/^[-+]0x[0-9a-f]+$/i,WIe=/^0b[01]+$/i,zIe=/^0o[0-7]+$/i,YIe=parseInt;function o7(n){if(typeof n=="number")return n;if(BIe(n))return s7;if(qo(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=qo(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=qIe(n);var t=WIe.test(n);return t||zIe.test(n)?YIe(n.slice(2),t?2:8):KIe.test(n)?s7:+n}function eX(n){return n}var XIe="[object AsyncFunction]",JIe="[object Function]",ZIe="[object GeneratorFunction]",QIe="[object Proxy]";function EL(n){if(!qo(n))return!1;var e=Ty(n);return e==JIe||e==ZIe||e==XIe||e==QIe}var l2=Qd["__core-js_shared__"],a7=function(){var n=/[^.]+$/.exec(l2&&l2.keys&&l2.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function e2e(n){return!!a7&&a7 in n}var t2e=Function.prototype,n2e=t2e.toString;function r2e(n){if(n!=null){try{return n2e.call(n)}catch{}try{return n+""}catch{}}return""}var i2e=/[\\^$.*+?()[\]{}|]/g,s2e=/^\[object .+?Constructor\]$/,o2e=Function.prototype,a2e=Object.prototype,c2e=o2e.toString,l2e=a2e.hasOwnProperty,u2e=RegExp("^"+c2e.call(l2e).replace(i2e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function d2e(n){if(!qo(n)||e2e(n))return!1;var e=EL(n)?u2e:s2e;return e.test(r2e(n))}function h2e(n,e){return n==null?void 0:n[e]}function CL(n,e){var t=h2e(n,e);return d2e(t)?t:void 0}var c7=Object.create,f2e=function(){function n(){}return function(e){if(!qo(e))return{};if(c7)return c7(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}();function p2e(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function m2e(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var g2e=800,v2e=16,y2e=Date.now;function _2e(n){var e=0,t=0;return function(){var r=y2e(),i=v2e-(r-t);if(t=r,i>0){if(++e>=g2e)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function b2e(n){return function(){return n}}var mS=function(){try{var n=CL(Object,"defineProperty");return n({},"",{}),n}catch{}}(),S2e=mS?function(n,e){return mS(n,"toString",{configurable:!0,enumerable:!1,value:b2e(e),writable:!0})}:eX,w2e=_2e(S2e),E2e=9007199254740991,C2e=/^(?:0|[1-9]\d*)$/;function tX(n,e){var t=typeof n;return e=e??E2e,!!e&&(t=="number"||t!="symbol"&&C2e.test(n))&&n>-1&&n%1==0&&n<e}function TL(n,e,t){e=="__proto__"&&mS?mS(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function iE(n,e){return n===e||n!==n&&e!==e}var T2e=Object.prototype,I2e=T2e.hasOwnProperty;function R2e(n,e,t){var r=n[e];(!(I2e.call(n,e)&&iE(r,t))||t===void 0&&!(e in n))&&TL(n,e,t)}function k2e(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=n[a]),i?TL(t,a,c):R2e(t,a,c)}return t}var l7=Math.max;function x2e(n,e,t){return e=l7(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=l7(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),p2e(n,this,a)}}function P2e(n,e){return w2e(x2e(n,e,eX),n+"")}var L2e=9007199254740991;function nX(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=L2e}function IL(n){return n!=null&&nX(n.length)&&!EL(n)}function A2e(n,e,t){if(!qo(t))return!1;var r=typeof e;return(r=="number"?IL(t)&&tX(e,t.length):r=="string"&&e in t)?iE(t[e],n):!1}function M2e(n){return P2e(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&A2e(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var O2e=Object.prototype;function rX(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||O2e;return n===t}function N2e(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var D2e="[object Arguments]";function u7(n){return Dp(n)&&Ty(n)==D2e}var iX=Object.prototype,F2e=iX.hasOwnProperty,U2e=iX.propertyIsEnumerable,D3=u7(function(){return arguments}())?u7:function(n){return Dp(n)&&F2e.call(n,"callee")&&!U2e.call(n,"callee")};function j2e(){return!1}var sX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,d7=sX&&typeof module=="object"&&module&&!module.nodeType&&module,$2e=d7&&d7.exports===sX,h7=$2e?Qd.Buffer:void 0,B2e=h7?h7.isBuffer:void 0,oX=B2e||j2e,H2e="[object Arguments]",V2e="[object Array]",G2e="[object Boolean]",q2e="[object Date]",K2e="[object Error]",W2e="[object Function]",z2e="[object Map]",Y2e="[object Number]",X2e="[object Object]",J2e="[object RegExp]",Z2e="[object Set]",Q2e="[object String]",eRe="[object WeakMap]",tRe="[object ArrayBuffer]",nRe="[object DataView]",rRe="[object Float32Array]",iRe="[object Float64Array]",sRe="[object Int8Array]",oRe="[object Int16Array]",aRe="[object Int32Array]",cRe="[object Uint8Array]",lRe="[object Uint8ClampedArray]",uRe="[object Uint16Array]",dRe="[object Uint32Array]",pn={};pn[rRe]=pn[iRe]=pn[sRe]=pn[oRe]=pn[aRe]=pn[cRe]=pn[lRe]=pn[uRe]=pn[dRe]=!0;pn[H2e]=pn[V2e]=pn[tRe]=pn[G2e]=pn[nRe]=pn[q2e]=pn[K2e]=pn[W2e]=pn[z2e]=pn[Y2e]=pn[X2e]=pn[J2e]=pn[Z2e]=pn[Q2e]=pn[eRe]=!1;function hRe(n){return Dp(n)&&nX(n.length)&&!!pn[Ty(n)]}function fRe(n){return function(e){return n(e)}}var aX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hg=aX&&typeof module=="object"&&module&&!module.nodeType&&module,pRe=Hg&&Hg.exports===aX,u2=pRe&&ZY.process,f7=function(){try{var n=Hg&&Hg.require&&Hg.require("util").types;return n||u2&&u2.binding&&u2.binding("util")}catch{}}(),p7=f7&&f7.isTypedArray,cX=p7?fRe(p7):hRe;function mRe(n,e){var t=N3(n),r=!t&&D3(n),i=!t&&!r&&oX(n),s=!t&&!r&&!i&&cX(n),o=t||r||i||s,a=o?N2e(n.length,String):[],c=a.length;for(var l in n)o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||tX(l,c))||a.push(l);return a}function gRe(n,e){return function(t){return n(e(t))}}function vRe(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var yRe=Object.prototype,_Re=yRe.hasOwnProperty;function bRe(n){if(!qo(n))return vRe(n);var e=rX(n),t=[];for(var r in n)r=="constructor"&&(e||!_Re.call(n,r))||t.push(r);return t}function lX(n){return IL(n)?mRe(n):bRe(n)}var Pv=CL(Object,"create");function SRe(){this.__data__=Pv?Pv(null):{},this.size=0}function wRe(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var ERe="__lodash_hash_undefined__",CRe=Object.prototype,TRe=CRe.hasOwnProperty;function IRe(n){var e=this.__data__;if(Pv){var t=e[n];return t===ERe?void 0:t}return TRe.call(e,n)?e[n]:void 0}var RRe=Object.prototype,kRe=RRe.hasOwnProperty;function xRe(n){var e=this.__data__;return Pv?e[n]!==void 0:kRe.call(e,n)}var PRe="__lodash_hash_undefined__";function LRe(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Pv&&e===void 0?PRe:e,this}function Fd(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Fd.prototype.clear=SRe;Fd.prototype.delete=wRe;Fd.prototype.get=IRe;Fd.prototype.has=xRe;Fd.prototype.set=LRe;function ARe(){this.__data__=[],this.size=0}function sE(n,e){for(var t=n.length;t--;)if(iE(n[t][0],e))return t;return-1}var MRe=Array.prototype,ORe=MRe.splice;function NRe(n){var e=this.__data__,t=sE(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():ORe.call(e,t,1),--this.size,!0}function DRe(n){var e=this.__data__,t=sE(e,n);return t<0?void 0:e[t][1]}function FRe(n){return sE(this.__data__,n)>-1}function URe(n,e){var t=this.__data__,r=sE(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function Hc(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Hc.prototype.clear=ARe;Hc.prototype.delete=NRe;Hc.prototype.get=DRe;Hc.prototype.has=FRe;Hc.prototype.set=URe;var uX=CL(Qd,"Map");function jRe(){this.size=0,this.__data__={hash:new Fd,map:new(uX||Hc),string:new Fd}}function $Re(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function oE(n,e){var t=n.__data__;return $Re(e)?t[typeof e=="string"?"string":"hash"]:t.map}function BRe(n){var e=oE(this,n).delete(n);return this.size-=e?1:0,e}function HRe(n){return oE(this,n).get(n)}function VRe(n){return oE(this,n).has(n)}function GRe(n,e){var t=oE(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function Fp(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Fp.prototype.clear=jRe;Fp.prototype.delete=BRe;Fp.prototype.get=HRe;Fp.prototype.has=VRe;Fp.prototype.set=GRe;var dX=gRe(Object.getPrototypeOf,Object),qRe="[object Object]",KRe=Function.prototype,WRe=Object.prototype,hX=KRe.toString,zRe=WRe.hasOwnProperty,YRe=hX.call(Object);function XRe(n){if(!Dp(n)||Ty(n)!=qRe)return!1;var e=dX(n);if(e===null)return!0;var t=zRe.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&hX.call(t)==YRe}function JRe(){this.__data__=new Hc,this.size=0}function ZRe(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function QRe(n){return this.__data__.get(n)}function eke(n){return this.__data__.has(n)}var tke=200;function nke(n,e){var t=this.__data__;if(t instanceof Hc){var r=t.__data__;if(!uX||r.length<tke-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new Fp(r)}return t.set(n,e),this.size=t.size,this}function Up(n){var e=this.__data__=new Hc(n);this.size=e.size}Up.prototype.clear=JRe;Up.prototype.delete=ZRe;Up.prototype.get=QRe;Up.prototype.has=eke;Up.prototype.set=nke;var fX=typeof exports=="object"&&exports&&!exports.nodeType&&exports,m7=fX&&typeof module=="object"&&module&&!module.nodeType&&module,rke=m7&&m7.exports===fX,g7=rke?Qd.Buffer:void 0;g7&&g7.allocUnsafe;function ike(n,e){return n.slice()}var v7=Qd.Uint8Array;function ske(n){var e=new n.constructor(n.byteLength);return new v7(e).set(new v7(n)),e}function oke(n,e){var t=ske(n.buffer);return new n.constructor(t,n.byteOffset,n.length)}function ake(n){return typeof n.constructor=="function"&&!rX(n)?f2e(dX(n)):{}}function cke(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(t(s[c],c,s)===!1)break}return e}}var lke=cke(),d2=function(){return Qd.Date.now()},uke="Expected a function",dke=Math.max,hke=Math.min;function fke(n,e,t){var r,i,s,o,a,c,l=0,u=!1,h=!1,p=!0;if(typeof n!="function")throw new TypeError(uke);e=o7(e)||0,qo(t)&&(u=!!t.leading,h="maxWait"in t,s=h?dke(o7(t.maxWait)||0,e):s,p="trailing"in t?!!t.trailing:p);function m(C){var P=r,M=i;return r=i=void 0,l=C,o=n.apply(M,P),o}function v(C){return l=C,a=setTimeout(b,e),u?m(C):o}function g(C){var P=C-c,M=C-l,D=e-P;return h?hke(D,s-M):D}function S(C){var P=C-c,M=C-l;return c===void 0||P>=e||P<0||h&&M>=s}function b(){var C=d2();if(S(C))return R(C);a=setTimeout(b,g(C))}function R(C){return a=void 0,p&&r?m(C):(r=i=void 0,o)}function k(){a!==void 0&&clearTimeout(a),l=0,r=c=i=a=void 0}function I(){return a===void 0?o:R(d2())}function T(){var C=d2(),P=S(C);if(r=arguments,i=this,c=C,P){if(a===void 0)return v(c);if(h)return clearTimeout(a),a=setTimeout(b,e),m(c)}return a===void 0&&(a=setTimeout(b,e)),o}return T.cancel=k,T.flush=I,T}function F3(n,e,t){(t!==void 0&&!iE(n[e],t)||t===void 0&&!(e in n))&&TL(n,e,t)}function pke(n){return Dp(n)&&IL(n)}function U3(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}function mke(n){return k2e(n,lX(n))}function gke(n,e,t,r,i,s,o){var a=U3(n,t),c=U3(e,t),l=o.get(c);if(l){F3(n,t,l);return}var u=s?s(a,c,t+"",n,e,o):void 0,h=u===void 0;if(h){var p=N3(c),m=!p&&oX(c),v=!p&&!m&&cX(c);u=c,p||m||v?N3(a)?u=a:pke(a)?u=m2e(a):m?(h=!1,u=ike(c)):v?(h=!1,u=oke(c)):u=[]:XRe(c)||D3(c)?(u=a,D3(a)?u=mke(a):(!qo(a)||EL(a))&&(u=ake(c))):h=!1}h&&(o.set(c,u),i(u,c,r,s,o),o.delete(c)),F3(n,t,u)}function pX(n,e,t,r,i){n!==e&&lke(e,function(s,o){if(i||(i=new Up),qo(s))gke(n,e,o,t,pX,r,i);else{var a=r?r(U3(n,o),s,o+"",n,e,i):void 0;a===void 0&&(a=s),F3(n,o,a)}},lX)}var vke=M2e(function(n,e,t){pX(n,e,t)}),yke="Expected a function";function _ke(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(yke);return qo(t)&&(r="leading"in t?!1:r,i="trailing"in t?!0:i),fke(n,e,{leading:r,maxWait:e,trailing:i})}const j3={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},features:{feature_use_device_session_member_events:!0},eula:"https://static.element.io/legal/online-EULA.pdf",media_devices:{enable_audio:!0,enable_video:!0},app_prompt:!0};function RL(n){return!(n.ok||n.url.startsWith("file:")&&n.status===0)}class gt{static get(){var e;if(!((e=this.internalInstance)!=null&&e.config))throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){var e;if(!((e=gt.internalInstance)!=null&&e.initPromise)){const t=new gt;gt.internalInstance=t;let r;window.location.pathname.endsWith("/room/")||window.location.pathname.endsWith("/room")?r=new URL("/config.json",window.location.href).href:r="config.json",gt.internalInstance.initPromise=bke(r).then(i=>{t.config=vke({},j3,i)})}return gt.internalInstance.initPromise}static initDefault(){gt.internalInstance=new gt,gt.internalInstance.config={...j3}}static defaultHomeserverUrl(){var e;return Rs().homeserver??((e=gt.get().default_server_config)==null?void 0:e["m.homeserver"].base_url)}static defaultServerName(){var t;const e=Rs().homeserver;return e?new URL(e).hostname:(t=gt.get().default_server_config)==null?void 0:t["m.homeserver"].server_name}}async function bke(n){const e=await fetch(n);return RL(e)?j3:e.json()}var Vt=(n=>(n[n.NONE=0]="NONE",n[n.PER_PARTICIPANT=1]="PER_PARTICIPANT",n[n.SHARED_KEY=2]="SHARED_KEY",n))(Vt||{}),mX=(n=>(n.StartNewCall="start_call",n.JoinExistingCall="join_existing",n.Unknown="unknown",n))(mX||{});function Ske(n,e){const t=n.indexOf("?"),r=e(new URLSearchParams(t===-1?"":n.substring(t)));return`${n.substring(0,t)}?${r.toString()}`}class gX{constructor(e,t){this.queryParams=new URLSearchParams(e);const r=t.indexOf("?");this.fragmentParams=new URLSearchParams(r===-1?"":t.substring(r))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,t=!1){const r=this.getParam(e);return r===null?t:r!=="false"}}const Rs=(n=window.location.search,e=window.location.hash)=>{const t=new gX(n,e),r=parseFloat(t.getParam("fontScale")??"");let i=t.getParam("intent");(!i||!Object.values(mX).includes(i))&&(i="unknown");const s=t.getParam("widgetId"),o=t.getParam("parentUrl"),a=!!s&&!!o;return{widgetId:s,parentUrl:o,roomId:t.getParam("roomId"),password:t.getParam("password"),confineToRoom:t.getFlagParam("confineToRoom")||t.getFlagParam("embed"),appPrompt:t.getFlagParam("appPrompt",!0),preload:a?t.getFlagParam("preload"):!1,hideHeader:t.getFlagParam("hideHeader"),showControls:t.getFlagParam("showControls",!0),hideScreensharing:t.getFlagParam("hideScreensharing"),e2eEnabled:t.getFlagParam("enableE2EE",!0),userId:a?t.getParam("userId"):null,displayName:t.getParam("displayName"),deviceId:a?t.getParam("deviceId"):null,baseUrl:a?t.getParam("baseUrl"):null,lang:t.getParam("lang"),fonts:t.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,analyticsID:t.getParam("analyticsID"),allowIceFallback:t.getFlagParam("allowIceFallback"),perParticipantE2EE:t.getFlagParam("perParticipantE2EE"),skipLobby:t.getFlagParam("skipLobby",a&&i==="start_call"),returnToLobby:a?t.getFlagParam("returnToLobby"):!1,theme:t.getParam("theme"),viaServers:a?null:t.getParam("viaServers"),homeserver:a?null:t.getParam("homeserver"),intent:i}},eh=()=>{const{search:n,hash:e}=hi();return _.useMemo(()=>Rs(n,e),[n,e])};function wke(n,e,t){let r=null;n=n.substring(1);const i=n.split("/"),s=i[0]=="room",o=i.length>1;t===""||t.startsWith("#?")?(o&&s&&(r=i[1]),s||(r=i[0])):r=t,r=(r==null?void 0:r.split("?")[0])??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${gt.defaultServerName()}`)));const a=new gX(e,t);let c=a.getParam("roomId");return c!=null&&c.startsWith("!")&&c.includes("")||(c=null),{roomAlias:r,roomId:c,viaServers:a.getAllParams("viaServers")}}const Eke=()=>{const{pathname:n,search:e,hash:t}=hi();return _.useMemo(()=>wke(n,e,t),[n,e,t])};function Cke(n,e,t){const r=new URLSearchParams;switch(e==null?void 0:e.kind){case Vt.SHARED_KEY:{const i=encodeURIComponent(e.secret);i!==e.secret&&O.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",i);break}case Vt.PER_PARTICIPANT:r.set("perParticipantE2EE","true");break}return r.set("roomId",n),r}const Tke="_rageshakeControl_65ekp_8",y7={rageshakeControl:Tke},_7=1024*1024*5,Ike=2*1e3,Rke=3;class kke extends eP{constructor(){super(...arguments),this.logs="",this.log=(e,...t)=>{const r=new Date().toISOString();t=t.map(s=>s instanceof DOMException?s.message+` (${s.name} | ${s.code})`:s instanceof Error?s.message+(s.stack?`
${s.stack}`:""):typeof s=="object"?JSON.stringify(s,Oke()):s);let i=`${r} ${e} ${t.join(" ")}
`;i=i.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=i,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class xke{constructor(e,t){this.indexedDB=e,this.loggerInstance=t,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=_ke(()=>this.flush,Ike,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?this.flushAgainPromise?this.flushAgainPromise:(this.flushAgainPromise=this.flushPromise.then(this.flush).then(()=>{this.flushAgainPromise=void 0}),this.flushAgainPromise):(this.flushPromise=new Promise((r,i)=>{if(!this.db){i(new Error("No connected database"));return}const s=this.loggerInstance.popLogs();if(s.length===0){r();return}const o=this.db.transaction(["logs","logslastmod"],"readwrite"),a=o.objectStore("logs");o.oncomplete=()=>{r()},o.onerror=l=>{var u;O.error("Failed to flush logs : ",l),i(new Error("Failed to write logs: "+((u=o==null?void 0:o.error)==null?void 0:u.message)))},a.add(this.generateLogEntry(s)),o.objectStore("logslastmod").put(this.generateLastModifiedTime())}).then(()=>{this.flushPromise=void 0}),this.flushPromise),this.id="instance-"+Es(16),t.on("log",this.onLoggerLog),window.addEventListener("beforeunload",()=>{this.flush().catch(r=>O.error("Failed to flush logs before unload",r))})}async connect(){const e=this.indexedDB.open("logs");return new Promise((t,r)=>{e.onsuccess=()=>{this.db=e.result,t()},e.onerror=()=>{var s;const i="Failed to open log database: "+((s=e==null?void 0:e.error)==null?void 0:s.name);O.error(i),r(new Error(i))},e.onupgradeneeded=()=>{const i=e.result,s=i.createObjectStore("logs",{keyPath:["id","index"]});s.createIndex("id","id",{unique:!1}),s.add(this.generateLogEntry(new Date+" ::: Log database was created.")),i.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}})}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function t(l,u){const h=e.transaction("logs","readonly").objectStore("logs");return new Promise((p,m)=>{const v=h.index("id").openCursor(IDBKeyRange.only(l),"prev");let g="";v.onerror=()=>{var S;m(new Error("Query failed: "+((S=v==null?void 0:v.error)==null?void 0:S.message)))},v.onsuccess=()=>{const S=v.result;if(!S){p(g);return}g=S.value.lines+g,g.length>=u?p(g):S.continue()}})}async function r(){const l=e.transaction("logslastmod","readonly").objectStore("logslastmod");return Pke(l,void 0,u=>({id:u.value.id,ts:u.value.ts})).then(u=>u.sort((h,p)=>p.ts-h.ts).map(h=>h.id))}async function i(l){return new Promise((u,h)=>{const p=e.transaction(["logs","logslastmod"],"readwrite"),m=p.objectStore("logs"),v=m.index("id").openKeyCursor(IDBKeyRange.only(l));v.onsuccess=()=>{const S=v.result;S&&(m.delete(S.primaryKey),S.continue())},p.oncomplete=()=>{u()},p.onerror=()=>{var S;h(new Error(`Failed to delete logs for '${l}' : ${(S=p==null?void 0:p.error)==null?void 0:S.message}`))},p.objectStore("logslastmod").delete(l)})}const s=await r();let o=[];const a=[];let c=0;for(let l=0;l<s.length;l++){const u=await t(s[l],_7-c);if(a.push({lines:u,id:s[l]}),c+=u.length,c>=_7){o=s.slice(l+1).map(h=>parseInt(h,10));break}}return o.length>0&&(O.log("Removing logs: ",o),Promise.all(o.map(async l=>i(l))).then(()=>{O.log(`Removed ${o.length} old logs.`)},l=>{O.error(l)})),a}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function Pke(n,e,t){const r=n.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r==null?void 0:r.error)==null?void 0:a.message)))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(t(a)),a.continue()}})}async function Lke(){return global.mx_rage_logger=new kke,b7(O,global.mx_rage_logger.log),["MatrixRTCSession","MatrixRTCSessionManager"].forEach(n=>{b7(O.getChild(n),global.mx_rage_logger.log)}),["trace","debug","info","warn","error"].forEach(n=>{const e=window.console[n];if(!e)return;const t=`${n.toUpperCase()} matrix_sdk`;window.console[n]=(...r)=>{e(...r),typeof r[0]=="string"&&r[0].startsWith(t)&&global.mx_rage_logger.log(kL[n],"matrix_sdk",...r)}}),Ake()}async function Ake(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;O.log("Configuring rageshake persistence...");let n;try{n=window.indexedDB}catch(e){O.warn("Could not get indexDB from window.",e)}return n?(global.mx_rage_store=new xke(n,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function Mke(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const Oke=()=>{const n=new WeakSet,e=new WeakMap;return function(t,r){if(typeof r=="object"&&r!==null){if(n.has(r))return"<$ cycle-trimmed $>";n.add(r);let i=0;if(this&&(i=e.get(this)??0),e.set(r,i+1),i>Rke)return"<$ object-pruned $>"}return r}};var kL=(n=>(n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent",n))(kL||{});function b7(n,e){const t=n,r=t.methodFactory;t.methodFactory=function(i,s,o){const a=r(i,s,o),c=kL[i],l=c>=s&&c<5;return(...u)=>{a.apply(this,u),l&&e(c,o==null?void 0:o.toString(),...u)}},t.setLevel(t.getLevel())}var Nke=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},sd="1.9.0",S7=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Dke(n){var e=new Set([n]),t=new Set,r=n.match(S7);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(c){return c===n};function s(a){return t.add(a),!1}function o(a){return e.add(a),!0}return function(c){if(e.has(c))return!0;if(t.has(c))return!1;var l=c.match(S7);if(!l)return s(c);var u={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return u.prerelease!=null||i.major!==u.major?s(c):i.major===0?i.minor===u.minor&&i.patch<=u.patch?o(c):s(c):i.minor<=u.minor?o(c):s(c)}}var Fke=Dke(sd),Uke=sd.split(".")[0],Lv=Symbol.for("opentelemetry.js.api."+Uke),Av=Nke;function aE(n,e,t,r){var i;r===void 0&&(r=!1);var s=Av[Lv]=(i=Av[Lv])!==null&&i!==void 0?i:{version:sd};if(!r&&s[n]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+n);return t.error(o.stack||o.message),!1}if(s.version!==sd){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+n+" does not match previously registered API v"+sd);return t.error(o.stack||o.message),!1}return s[n]=e,t.debug("@opentelemetry/api: Registered a global for "+n+" v"+sd+"."),!0}function ip(n){var e,t,r=(e=Av[Lv])===null||e===void 0?void 0:e.version;if(!(!r||!Fke(r)))return(t=Av[Lv])===null||t===void 0?void 0:t[n]}function cE(n,e){e.debug("@opentelemetry/api: Unregistering a global for "+n+" v"+sd+".");var t=Av[Lv];t&&delete t[n]}var jke=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},$ke=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Bke=function(){function n(e){this._namespace=e.namespace||"DiagComponentLogger"}return n.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Xm("debug",this._namespace,e)},n.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Xm("error",this._namespace,e)},n.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Xm("info",this._namespace,e)},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Xm("warn",this._namespace,e)},n.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Xm("verbose",this._namespace,e)},n}();function Xm(n,e,t){var r=ip("diag");if(r)return t.unshift(e),r[n].apply(r,$ke([],jke(t),!1))}var Gn;(function(n){n[n.NONE=0]="NONE",n[n.ERROR=30]="ERROR",n[n.WARN=50]="WARN",n[n.INFO=60]="INFO",n[n.DEBUG=70]="DEBUG",n[n.VERBOSE=80]="VERBOSE",n[n.ALL=9999]="ALL"})(Gn||(Gn={}));function Hke(n,e){n<Gn.NONE?n=Gn.NONE:n>Gn.ALL&&(n=Gn.ALL),e=e||{};function t(r,i){var s=e[r];return typeof s=="function"&&n>=i?s.bind(e):function(){}}return{error:t("error",Gn.ERROR),warn:t("warn",Gn.WARN),info:t("info",Gn.INFO),debug:t("debug",Gn.DEBUG),verbose:t("verbose",Gn.VERBOSE)}}var Vke=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},Gke=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},qke="diag",uu=function(){function n(){function e(i){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=ip("diag");if(a)return a[i].apply(a,Gke([],Vke(s),!1))}}var t=this,r=function(i,s){var o,a,c;if(s===void 0&&(s={logLevel:Gn.INFO}),i===t){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof s=="number"&&(s={logLevel:s});var u=ip("diag"),h=Hke((a=s.logLevel)!==null&&a!==void 0?a:Gn.INFO,i);if(u&&!s.suppressOverrideMessage){var p=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";u.warn("Current logger will be overwritten from "+p),h.warn("Current logger will overwrite one already registered from "+p)}return aE("diag",h,t,!0)};t.setLogger=r,t.disable=function(){cE(qke,t)},t.createComponentLogger=function(i){return new Bke(i)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return n.instance=function(){return this._instance||(this._instance=new n),this._instance},n}(),Kke=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},Wke=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},zke=function(){function n(e){this._entries=e?new Map(e):new Map}return n.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},n.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=Kke(e,2),r=t[0],i=t[1];return[r,i]})},n.prototype.setEntry=function(e,t){var r=new n(this._entries);return r._entries.set(e,t),r},n.prototype.removeEntry=function(e){var t=new n(this._entries);return t._entries.delete(e),t},n.prototype.removeEntries=function(){for(var e,t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=new n(this._entries);try{for(var o=Wke(r),a=o.next();!a.done;a=o.next()){var c=a.value;s._entries.delete(c)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return s},n.prototype.clear=function(){return new n},n}(),Yke=Symbol("BaggageEntryMetadata"),Xke=uu.instance();function Jke(n){return n===void 0&&(n={}),new zke(new Map(Object.entries(n)))}function Zke(n){return typeof n!="string"&&(Xke.error("Cannot create baggage metadata from unknown type: "+typeof n),n=""),{__TYPE__:Yke,toString:function(){return n}}}function xL(n){return Symbol.for(n)}var Qke=function(){function n(e){var t=this;t._currentContext=e?new Map(e):new Map,t.getValue=function(r){return t._currentContext.get(r)},t.setValue=function(r,i){var s=new n(t._currentContext);return s._currentContext.set(r,i),s},t.deleteValue=function(r){var i=new n(t._currentContext);return i._currentContext.delete(r),i}}return n}(),rf=new Qke,e3e={get:function(n,e){if(n!=null)return n[e]},keys:function(n){return n==null?[]:Object.keys(n)}},t3e={set:function(n,e,t){n!=null&&(n[e]=t)}},n3e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},r3e=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},i3e=function(){function n(){}return n.prototype.active=function(){return rf},n.prototype.with=function(e,t,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return t.call.apply(t,r3e([r],n3e(i),!1))},n.prototype.bind=function(e,t){return t},n.prototype.enable=function(){return this},n.prototype.disable=function(){return this},n}(),s3e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},o3e=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},h2="context",a3e=new i3e,lE=function(){function n(){}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalContextManager=function(e){return aE(h2,e,uu.instance())},n.prototype.active=function(){return this._getContextManager().active()},n.prototype.with=function(e,t,r){for(var i,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(i=this._getContextManager()).with.apply(i,o3e([e,t,r],s3e(s),!1))},n.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},n.prototype._getContextManager=function(){return ip(h2)||a3e},n.prototype.disable=function(){this._getContextManager().disable(),cE(h2,uu.instance())},n}(),La;(function(n){n[n.NONE=0]="NONE",n[n.SAMPLED=1]="SAMPLED"})(La||(La={}));var vX="0000000000000000",yX="00000000000000000000000000000000",_X={traceId:yX,spanId:vX,traceFlags:La.NONE},Vg=function(){function n(e){e===void 0&&(e=_X),this._spanContext=e}return n.prototype.spanContext=function(){return this._spanContext},n.prototype.setAttribute=function(e,t){return this},n.prototype.setAttributes=function(e){return this},n.prototype.addEvent=function(e,t){return this},n.prototype.addLink=function(e){return this},n.prototype.addLinks=function(e){return this},n.prototype.setStatus=function(e){return this},n.prototype.updateName=function(e){return this},n.prototype.end=function(e){},n.prototype.isRecording=function(){return!1},n.prototype.recordException=function(e,t){},n}(),PL=xL("OpenTelemetry Context Key SPAN");function LL(n){return n.getValue(PL)||void 0}function c3e(){return LL(lE.getInstance().active())}function AL(n,e){return n.setValue(PL,e)}function l3e(n){return n.deleteValue(PL)}function u3e(n,e){return AL(n,new Vg(e))}function bX(n){var e;return(e=LL(n))===null||e===void 0?void 0:e.spanContext()}var d3e=/^([0-9a-f]{32})$/i,h3e=/^[0-9a-f]{16}$/i;function SX(n){return d3e.test(n)&&n!==yX}function f3e(n){return h3e.test(n)&&n!==vX}function uE(n){return SX(n.traceId)&&f3e(n.spanId)}function p3e(n){return new Vg(n)}var f2=lE.getInstance(),wX=function(){function n(){}return n.prototype.startSpan=function(e,t,r){r===void 0&&(r=f2.active());var i=!!(t!=null&&t.root);if(i)return new Vg;var s=r&&bX(r);return m3e(s)&&uE(s)?new Vg(s):new Vg},n.prototype.startActiveSpan=function(e,t,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=t:arguments.length===3?(s=t,a=r):(s=t,o=r,a=i);var c=o??f2.active(),l=this.startSpan(e,s,c),u=AL(c,l);return f2.with(u,a,void 0,l)}},n}();function m3e(n){return typeof n=="object"&&typeof n.spanId=="string"&&typeof n.traceId=="string"&&typeof n.traceFlags=="number"}var g3e=new wX,v3e=function(){function n(e,t,r,i){this._provider=e,this.name=t,this.version=r,this.options=i}return n.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},n.prototype.startActiveSpan=function(e,t,r,i){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},n.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):g3e},n}(),y3e=function(){function n(){}return n.prototype.getTracer=function(e,t,r){return new wX},n}(),_3e=new y3e,w7=function(){function n(){}return n.prototype.getTracer=function(e,t,r){var i;return(i=this.getDelegateTracer(e,t,r))!==null&&i!==void 0?i:new v3e(this,e,t,r)},n.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:_3e},n.prototype.setDelegate=function(e){this._delegate=e},n.prototype.getDelegateTracer=function(e,t,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,t,r)},n}(),gS;(function(n){n[n.NOT_RECORD=0]="NOT_RECORD",n[n.RECORD=1]="RECORD",n[n.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(gS||(gS={}));var $3;(function(n){n[n.INTERNAL=0]="INTERNAL",n[n.SERVER=1]="SERVER",n[n.CLIENT=2]="CLIENT",n[n.PRODUCER=3]="PRODUCER",n[n.CONSUMER=4]="CONSUMER"})($3||($3={}));var B3;(function(n){n[n.UNSET=0]="UNSET",n[n.OK=1]="OK",n[n.ERROR=2]="ERROR"})(B3||(B3={}));var ql=lE.getInstance(),Rt=uu.instance(),b3e=function(){function n(){}return n.prototype.inject=function(e,t){},n.prototype.extract=function(e,t){return e},n.prototype.fields=function(){return[]},n}(),ML=xL("OpenTelemetry Baggage Key");function EX(n){return n.getValue(ML)||void 0}function S3e(){return EX(lE.getInstance().active())}function w3e(n,e){return n.setValue(ML,e)}function E3e(n){return n.deleteValue(ML)}var p2="propagation",C3e=new b3e,T3e=function(){function n(){this.createBaggage=Jke,this.getBaggage=EX,this.getActiveBaggage=S3e,this.setBaggage=w3e,this.deleteBaggage=E3e}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalPropagator=function(e){return aE(p2,e,uu.instance())},n.prototype.inject=function(e,t,r){return r===void 0&&(r=t3e),this._getGlobalPropagator().inject(e,t,r)},n.prototype.extract=function(e,t,r){return r===void 0&&(r=e3e),this._getGlobalPropagator().extract(e,t,r)},n.prototype.fields=function(){return this._getGlobalPropagator().fields()},n.prototype.disable=function(){cE(p2,uu.instance())},n.prototype._getGlobalPropagator=function(){return ip(p2)||C3e},n}(),tb=T3e.getInstance(),m2="trace",I3e=function(){function n(){this._proxyTracerProvider=new w7,this.wrapSpanContext=p3e,this.isSpanContextValid=uE,this.deleteSpan=l3e,this.getSpan=LL,this.getActiveSpan=c3e,this.getSpanContext=bX,this.setSpan=AL,this.setSpanContext=u3e}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalTracerProvider=function(e){var t=aE(m2,this._proxyTracerProvider,uu.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},n.prototype.getTracerProvider=function(){return ip(m2)||this._proxyTracerProvider},n.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},n.prototype.disable=function(){cE(m2,uu.instance()),this._proxyTracerProvider=new w7},n}(),Ao=I3e.getInstance();const g2={trace:Ao};var CX=xL("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function TX(n){return n.setValue(CX,!0)}function OL(n){return n.getValue(CX)===!0}var R3e="=",H3=";",V3=",",v2="baggage",k3e=180,x3e=4096,P3e=8192,L3e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s};function A3e(n){return n.reduce(function(e,t){var r=""+e+(e!==""?V3:"")+t;return r.length>P3e?e:r},"")}function M3e(n){return n.getAllEntries().map(function(e){var t=L3e(e,2),r=t[0],i=t[1],s=encodeURIComponent(r)+"="+encodeURIComponent(i.value);return i.metadata!==void 0&&(s+=H3+i.metadata.toString()),s})}function O3e(n){var e=n.split(H3);if(!(e.length<=0)){var t=e.shift();if(t){var r=t.indexOf(R3e);if(!(r<=0)){var i=decodeURIComponent(t.substring(0,r).trim()),s=decodeURIComponent(t.substring(r+1).trim()),o;return e.length>0&&(o=Zke(e.join(H3))),{key:i,value:s,metadata:o}}}}}var N3e=function(){function n(){}return n.prototype.inject=function(e,t,r){var i=tb.getBaggage(e);if(!(!i||OL(e))){var s=M3e(i).filter(function(a){return a.length<=x3e}).slice(0,k3e),o=A3e(s);o.length>0&&r.set(t,v2,o)}},n.prototype.extract=function(e,t,r){var i=r.get(t,v2),s=Array.isArray(i)?i.join(V3):i;if(!s)return e;var o={};if(s.length===0)return e;var a=s.split(V3);return a.forEach(function(c){var l=O3e(c);if(l){var u={value:l.value};l.metadata&&(u.metadata=l.metadata),o[l.key]=u}}),Object.entries(o).length===0?e:tb.setBaggage(e,tb.createBaggage(o))},n.prototype.fields=function(){return[v2]},n}(),IX=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},D3e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s};function nb(n){var e,t,r={};if(typeof n!="object"||n==null)return r;try{for(var i=IX(Object.entries(n)),s=i.next();!s.done;s=i.next()){var o=D3e(s.value,2),a=o[0],c=o[1];if(!F3e(a)){Rt.warn("Invalid attribute key: "+a);continue}if(!RX(c)){Rt.warn("Invalid attribute value set for key: "+a);continue}Array.isArray(c)?r[a]=c.slice():r[a]=c}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r}function F3e(n){return typeof n=="string"&&n.length>0}function RX(n){return n==null?!0:Array.isArray(n)?U3e(n):kX(n)}function U3e(n){var e,t,r;try{for(var i=IX(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!=null){if(!r){if(kX(o)){r=typeof o;continue}return!1}if(typeof o!==r)return!1}}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return!0}function kX(n){switch(typeof n){case"number":case"boolean":case"string":return!0}return!1}function j3e(){return function(n){Rt.error($3e(n))}}function $3e(n){return typeof n=="string"?n:JSON.stringify(B3e(n))}function B3e(n){for(var e={},t=n;t!==null;)Object.getOwnPropertyNames(t).forEach(function(r){if(!e[r]){var i=t[r];i&&(e[r]=String(i))}}),t=Object.getPrototypeOf(t);return e}var H3e=j3e();function Rc(n){try{H3e(n)}catch{}}var ya;(function(n){n.AlwaysOff="always_off",n.AlwaysOn="always_on",n.ParentBasedAlwaysOff="parentbased_always_off",n.ParentBasedAlwaysOn="parentbased_always_on",n.ParentBasedTraceIdRatio="parentbased_traceidratio",n.TraceIdRatio="traceidratio"})(ya||(ya={}));var V3e=",",G3e=["OTEL_SDK_DISABLED"];function q3e(n){return G3e.indexOf(n)>-1}var K3e=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function W3e(n){return K3e.indexOf(n)>-1}var z3e=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS","OTEL_SEMCONV_STABILITY_OPT_IN"];function Y3e(n){return z3e.indexOf(n)>-1}var rb=1/0,ib=128,X3e=128,J3e=128,xX={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Gn.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:rb,OTEL_ATTRIBUTE_COUNT_LIMIT:ib,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:rb,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:ib,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:rb,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:ib,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:X3e,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:J3e,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:ya.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative",OTEL_SEMCONV_STABILITY_OPT_IN:[]};function Z3e(n,e,t){if(!(typeof t[n]>"u")){var r=String(t[n]);e[n]=r.toLowerCase()==="true"}}function Q3e(n,e,t,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof t[n]<"u"){var s=Number(t[n]);isNaN(s)||(s<r?e[n]=r:s>i?e[n]=i:e[n]=s)}}function exe(n,e,t,r){r===void 0&&(r=V3e);var i=t[n];typeof i=="string"&&(e[n]=i.split(r).map(function(s){return s.trim()}))}var txe={ALL:Gn.ALL,VERBOSE:Gn.VERBOSE,DEBUG:Gn.DEBUG,INFO:Gn.INFO,WARN:Gn.WARN,ERROR:Gn.ERROR,NONE:Gn.NONE};function nxe(n,e,t){var r=t[n];if(typeof r=="string"){var i=txe[r.toUpperCase()];i!=null&&(e[n]=i)}}function PX(n){var e={};for(var t in xX){var r=t;switch(r){case"OTEL_LOG_LEVEL":nxe(r,e,n);break;default:if(q3e(r))Z3e(r,e,n);else if(W3e(r))Q3e(r,e,n);else if(Y3e(r))exe(r,e,n);else{var i=n[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}var LX=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{};function Mv(){var n=PX(LX);return Object.assign({},xX,n)}function rxe(){return PX(LX)}function E7(n){return n>=48&&n<=57?n-48:n>=97&&n<=102?n-87:n-55}function NL(n){for(var e=new Uint8Array(n.length/2),t=0,r=0;r<n.length;r+=2){var i=E7(n.charCodeAt(r)),s=E7(n.charCodeAt(r+1));e[t++]=i<<4|s}return e}var Af=performance,ixe="1.30.1",sxe="process.runtime.name",oxe="telemetry.sdk.name",axe="telemetry.sdk.language",cxe="telemetry.sdk.version",lxe=sxe,uxe=oxe,dxe=axe,hxe=cxe,fxe="webjs",pxe=fxe,Vh,y2=(Vh={},Vh[uxe]="opentelemetry",Vh[lxe]="browser",Vh[dxe]=pxe,Vh[hxe]=ixe,Vh);var mxe=9,gxe=6,vxe=Math.pow(10,gxe),vS=Math.pow(10,mxe);function pf(n){var e=n/1e3,t=Math.trunc(e),r=Math.round(n%1e3*vxe);return[t,r]}function AX(){var n=Af.timeOrigin;if(typeof n!="number"){var e=Af;n=e.timing&&e.timing.fetchStart}return n}function yxe(n){var e=pf(AX()),t=pf(typeof n=="number"?n:Af.now());return OX(e,t)}function _xe(n,e){var t=e[0]-n[0],r=e[1]-n[1];return r<0&&(t-=1,r+=vS),[t,r]}function bxe(n){return n[0]*vS+n[1]}function C7(n){return n[0]*1e3+n[1]/1e6}function _2(n){return n[0]*1e6+n[1]/1e3}function MX(n){return Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"}function T7(n){return MX(n)||typeof n=="number"||n instanceof Date}function OX(n,e){var t=[n[0]+e[0],n[1]+e[1]];return t[1]>=vS&&(t[1]-=vS,t[0]+=1),t}var xo;(function(n){n[n.SUCCESS=0]="SUCCESS",n[n.FAILED=1]="FAILED"})(xo||(xo={}));var Sxe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wxe=function(){function n(e){e===void 0&&(e={});var t;this._propagators=(t=e.propagators)!==null&&t!==void 0?t:[],this._fields=Array.from(new Set(this._propagators.map(function(r){return typeof r.fields=="function"?r.fields():[]}).reduce(function(r,i){return r.concat(i)},[])))}return n.prototype.inject=function(e,t,r){var i,s;try{for(var o=Sxe(this._propagators),a=o.next();!a.done;a=o.next()){var c=a.value;try{c.inject(e,t,r)}catch(l){Rt.warn("Failed to inject with "+c.constructor.name+". Err: "+l.message)}}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype.extract=function(e,t,r){return this._propagators.reduce(function(i,s){try{return s.extract(i,t,r)}catch(o){Rt.warn("Failed to extract with "+s.constructor.name+". Err: "+o.message)}return i},e)},n.prototype.fields=function(){return this._fields.slice()},n}(),G3="[_0-9a-z-*/]",Exe="[a-z]"+G3+"{0,255}",Cxe="[a-z0-9]"+G3+"{0,240}@[a-z]"+G3+"{0,13}",Txe=new RegExp("^(?:"+Exe+"|"+Cxe+")$"),Ixe=/^[ -~]{0,255}[!-~]$/,Rxe=/,|=/;function kxe(n){return Txe.test(n)}function xxe(n){return Ixe.test(n)&&!Rxe.test(n)}var I7=32,Pxe=512,R7=",",k7="=",Lxe=function(){function n(e){this._internalState=new Map,e&&this._parse(e)}return n.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},n.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},n.prototype.get=function(e){return this._internalState.get(e)},n.prototype.serialize=function(){var e=this;return this._keys().reduce(function(t,r){return t.push(r+k7+e.get(r)),t},[]).join(R7)},n.prototype._parse=function(e){e.length>Pxe||(this._internalState=e.split(R7).reverse().reduce(function(t,r){var i=r.trim(),s=i.indexOf(k7);if(s!==-1){var o=i.slice(0,s),a=i.slice(s+1,r.length);kxe(o)&&xxe(a)&&t.set(o,a)}return t},new Map),this._internalState.size>I7&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,I7))))},n.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},n.prototype._clone=function(){var e=new n;return e._internalState=new Map(this._internalState),e},n}(),b2="traceparent",S2="tracestate",Axe="00",Mxe="(?!ff)[\\da-f]{2}",Oxe="(?![0]{32})[\\da-f]{32}",Nxe="(?![0]{16})[\\da-f]{16}",Dxe="[\\da-f]{2}",Fxe=new RegExp("^\\s?("+Mxe+")-("+Oxe+")-("+Nxe+")-("+Dxe+")(-.*)?\\s?$");function Uxe(n){var e=Fxe.exec(n);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var jxe=function(){function n(){}return n.prototype.inject=function(e,t,r){var i=Ao.getSpanContext(e);if(!(!i||OL(e)||!uE(i))){var s=Axe+"-"+i.traceId+"-"+i.spanId+"-0"+Number(i.traceFlags||La.NONE).toString(16);r.set(t,b2,s),i.traceState&&r.set(t,S2,i.traceState.serialize())}},n.prototype.extract=function(e,t,r){var i=r.get(t,b2);if(!i)return e;var s=Array.isArray(i)?i[0]:i;if(typeof s!="string")return e;var o=Uxe(s);if(!o)return e;o.isRemote=!0;var a=r.get(t,S2);if(a){var c=Array.isArray(a)?a.join(","):a;o.traceState=new Lxe(typeof c=="string"?c:void 0)}return Ao.setSpanContext(e,o)},n.prototype.fields=function(){return[b2,S2]},n}(),$xe="[object Object]",Bxe="[object Null]",Hxe="[object Undefined]",Vxe=Function.prototype,NX=Vxe.toString,Gxe=NX.call(Object),qxe=Kxe(Object.getPrototypeOf,Object),DX=Object.prototype,FX=DX.hasOwnProperty,Zu=Symbol?Symbol.toStringTag:void 0,UX=DX.toString;function Kxe(n,e){return function(t){return n(e(t))}}function x7(n){if(!Wxe(n)||zxe(n)!==$xe)return!1;var e=qxe(n);if(e===null)return!0;var t=FX.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&NX.call(t)===Gxe}function Wxe(n){return n!=null&&typeof n=="object"}function zxe(n){return n==null?n===void 0?Hxe:Bxe:Zu&&Zu in Object(n)?Yxe(n):Xxe(n)}function Yxe(n){var e=FX.call(n,Zu),t=n[Zu],r=!1;try{n[Zu]=void 0,r=!0}catch{}var i=UX.call(n);return r&&(e?n[Zu]=t:delete n[Zu]),i}function Xxe(n){return UX.call(n)}var Jxe=20;function Zxe(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t=n.shift(),r=new WeakMap;n.length>0;)t=jX(t,n.shift(),0,r);return t}function w2(n){return yS(n)?n.slice():n}function jX(n,e,t,r){t===void 0&&(t=0);var i;if(!(t>Jxe)){if(t++,sb(n)||sb(e)||$X(e))i=w2(e);else if(yS(n)){if(i=n.slice(),yS(e))for(var s=0,o=e.length;s<o;s++)i.push(w2(e[s]));else if(Jm(e))for(var a=Object.keys(e),s=0,o=a.length;s<o;s++){var c=a[s];i[c]=w2(e[c])}}else if(Jm(n))if(Jm(e)){if(!Qxe(n,e))return e;i=Object.assign({},n);for(var a=Object.keys(e),s=0,o=a.length;s<o;s++){var c=a[s],l=e[c];if(sb(l))typeof l>"u"?delete i[c]:i[c]=l;else{var u=i[c],h=l;if(P7(n,c,r)||P7(e,c,r))delete i[c];else{if(Jm(u)&&Jm(h)){var p=r.get(u)||[],m=r.get(h)||[];p.push({obj:n,key:c}),m.push({obj:e,key:c}),r.set(u,p),r.set(h,m)}i[c]=jX(i[c],l,t,r)}}}}else i=e;return i}}function P7(n,e,t){for(var r=t.get(n[e])||[],i=0,s=r.length;i<s;i++){var o=r[i];if(o.key===e&&o.obj===n)return!0}return!1}function yS(n){return Array.isArray(n)}function $X(n){return typeof n=="function"}function Jm(n){return!sb(n)&&!yS(n)&&!$X(n)&&typeof n=="object"}function sb(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n>"u"||n instanceof Date||n instanceof RegExp||n===null}function Qxe(n,e){return!(!x7(n)||!x7(e))}var ePe=function(){function n(){var e=this;this._promise=new Promise(function(t,r){e._resolve=t,e._reject=r})}return Object.defineProperty(n.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),n.prototype.resolve=function(e){this._resolve(e)},n.prototype.reject=function(e){this._reject(e)},n}(),tPe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},nPe=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},BX=function(){function n(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new ePe}return Object.defineProperty(n.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),n.prototype.call=function(){for(var e,t=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,nPe([this._that],tPe(r),!1))).then(function(s){return t._deferred.resolve(s)},function(s){return t._deferred.reject(s)})}catch(s){this._deferred.reject(s)}}return this._deferred.promise},n}();function rPe(n,e){return new Promise(function(t){ql.with(TX(ql.active()),function(){n.export(e,function(r){t(r)})})})}var iPe={_export:rPe},sPe="exception.type",oPe="exception.message",aPe="exception.stacktrace",E2=sPe,C2=oPe,cPe=aPe,lPe="exception",q3=function(){return q3=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},q3.apply(this,arguments)},uPe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},L7=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},dPe=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},hPe=function(){function n(e,t,r,i,s,o,a,c,l,u){a===void 0&&(a=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:B3.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=i,this.parentSpanId=o,this.kind=s,this.links=a;var h=Date.now();this._performanceStartTime=Af.now(),this._performanceOffset=h-(this._performanceStartTime+AX()),this._startTimeProvided=c!=null,this.startTime=this._getTime(c??h),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,u!=null&&this.setAttributes(u),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t)}return n.prototype.spanContext=function(){return this._spanContext},n.prototype.setAttribute=function(e,t){return t==null||this._isSpanEnded()?this:e.length===0?(Rt.warn("Invalid attribute key: "+e),this):RX(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this):(Rt.warn("Invalid attribute value set for key: "+e),this)},n.prototype.setAttributes=function(e){var t,r;try{for(var i=uPe(Object.entries(e)),s=i.next();!s.done;s=i.next()){var o=L7(s.value,2),a=o[0],c=o[1];this.setAttribute(a,c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return this},n.prototype.addEvent=function(e,t,r){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return Rt.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(this._droppedEventsCount===0&&Rt.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),T7(t)&&(T7(r)||(r=t),t=void 0);var i=nb(t);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this},n.prototype.addLink=function(e){return this.links.push(e),this},n.prototype.addLinks=function(e){var t;return(t=this.links).push.apply(t,dPe([],L7(e),!1)),this},n.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=q3({},e),this.status.message!=null&&typeof e.message!="string"&&(Rt.warn("Dropping invalid status.message of type '"+typeof e.message+"', expected 'string'"),delete this.status.message),this)},n.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},n.prototype.end=function(e){if(this._isSpanEnded()){Rt.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=_xe(this.startTime,this.endTime),this._duration[0]<0&&(Rt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&Rt.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this)},n.prototype._getTime=function(e){if(typeof e=="number"&&e<=Af.now())return yxe(e+this._performanceOffset);if(typeof e=="number")return pf(e);if(e instanceof Date)return pf(e.getTime());if(MX(e))return e;if(this._startTimeProvided)return pf(Date.now());var t=Af.now()-this._performanceStartTime;return OX(this.startTime,pf(t))},n.prototype.isRecording=function(){return this._ended===!1},n.prototype.recordException=function(e,t){var r={};typeof e=="string"?r[C2]=e:e&&(e.code?r[E2]=e.code.toString():e.name&&(r[E2]=e.name),e.message&&(r[C2]=e.message),e.stack&&(r[cPe]=e.stack)),r[E2]||r[C2]?this.addEvent(lPe,r,t):Rt.warn("Failed to record an exception "+e)},Object.defineProperty(n.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),n.prototype._isSpanEnded=function(){return this._ended&&Rt.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},n.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substring(0,t)},n.prototype._truncateToSize=function(e){var t=this,r=this._attributeValueLengthLimit;return r<=0?(Rt.warn("Attribute value limit must be positive, got "+r),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(i){return typeof i=="string"?t._truncateToLimitUtil(i,r):i}):e},n}(),sp;(function(n){n[n.NOT_RECORD=0]="NOT_RECORD",n[n.RECORD=1]="RECORD",n[n.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(sp||(sp={}));var _S=function(){function n(){}return n.prototype.shouldSample=function(){return{decision:sp.NOT_RECORD}},n.prototype.toString=function(){return"AlwaysOffSampler"},n}(),Mf=function(){function n(){}return n.prototype.shouldSample=function(){return{decision:sp.RECORD_AND_SAMPLED}},n.prototype.toString=function(){return"AlwaysOnSampler"},n}(),T2=function(){function n(e){var t,r,i,s;this._root=e.root,this._root||(Rc(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Mf),this._remoteParentSampled=(t=e.remoteParentSampled)!==null&&t!==void 0?t:new Mf,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new _S,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new Mf,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new _S}return n.prototype.shouldSample=function(e,t,r,i,s,o){var a=Ao.getSpanContext(e);return!a||!uE(a)?this._root.shouldSample(e,t,r,i,s,o):a.isRemote?a.traceFlags&La.SAMPLED?this._remoteParentSampled.shouldSample(e,t,r,i,s,o):this._remoteParentNotSampled.shouldSample(e,t,r,i,s,o):a.traceFlags&La.SAMPLED?this._localParentSampled.shouldSample(e,t,r,i,s,o):this._localParentNotSampled.shouldSample(e,t,r,i,s,o)},n.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},n}(),A7=function(){function n(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return n.prototype.shouldSample=function(e,t){return{decision:SX(t)&&this._accumulate(t)<this._upperBound?sp.RECORD_AND_SAMPLED:sp.NOT_RECORD}},n.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},n.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},n.prototype._accumulate=function(e){for(var t=0,r=0;r<e.length/8;r++){var i=r*8,s=parseInt(e.slice(i,i+8),16);t=(t^s)>>>0}return t},n}(),fPe=ya.AlwaysOn,Gh=1;function HX(){var n=Mv();return{sampler:VX(n),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:n.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:n.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:n.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:n.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:n.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:n.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:n.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:n.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT},mergeResourceWithDefaults:!0}}function VX(n){switch(n===void 0&&(n=Mv()),n.OTEL_TRACES_SAMPLER){case ya.AlwaysOn:return new Mf;case ya.AlwaysOff:return new _S;case ya.ParentBasedAlwaysOn:return new T2({root:new Mf});case ya.ParentBasedAlwaysOff:return new T2({root:new _S});case ya.TraceIdRatio:return new A7(M7(n));case ya.ParentBasedTraceIdRatio:return new T2({root:new A7(M7(n))});default:return Rt.error('OTEL_TRACES_SAMPLER value "'+n.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+fPe+'".'),new Mf}}function M7(n){if(n.OTEL_TRACES_SAMPLER_ARG===void 0||n.OTEL_TRACES_SAMPLER_ARG==="")return Rt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+Gh+"."),Gh;var e=Number(n.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Rt.error("OTEL_TRACES_SAMPLER_ARG="+n.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+Gh+"."),Gh):e<0||e>1?(Rt.error("OTEL_TRACES_SAMPLER_ARG="+n.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+Gh+"."),Gh):e}function pPe(n){var e={sampler:VX()},t=HX(),r=Object.assign({},t,e,n);return r.generalLimits=Object.assign({},t.generalLimits,n.generalLimits||{}),r.spanLimits=Object.assign({},t.spanLimits,n.spanLimits||{}),r}function mPe(n){var e,t,r,i,s,o,a,c,l,u,h,p,m=Object.assign({},n.spanLimits),v=rxe();return m.attributeCountLimit=(o=(s=(i=(t=(e=n.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&t!==void 0?t:(r=n.generalLimits)===null||r===void 0?void 0:r.attributeCountLimit)!==null&&i!==void 0?i:v.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&s!==void 0?s:v.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&o!==void 0?o:ib,m.attributeValueLengthLimit=(p=(h=(u=(c=(a=n.spanLimits)===null||a===void 0?void 0:a.attributeValueLengthLimit)!==null&&c!==void 0?c:(l=n.generalLimits)===null||l===void 0?void 0:l.attributeValueLengthLimit)!==null&&u!==void 0?u:v.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&h!==void 0?h:v.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&p!==void 0?p:rb,Object.assign({},n,{spanLimits:m})}var gPe=function(){function n(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=Mv();this._maxExportBatchSize=typeof(t==null?void 0:t.maxExportBatchSize)=="number"?t.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(t==null?void 0:t.maxQueueSize)=="number"?t.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(t==null?void 0:t.scheduledDelayMillis)=="number"?t.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(t==null?void 0:t.exportTimeoutMillis)=="number"?t.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new BX(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Rt.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return n.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},n.prototype.onStart=function(e,t){},n.prototype.onEnd=function(e){this._shutdownOnce.isCalled||(e.spanContext().traceFlags&La.SAMPLED)!==0&&this._addToBuffer(e)},n.prototype.shutdown=function(){return this._shutdownOnce.call()},n.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},n.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&Rt.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(Rt.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},n.prototype._flushAll=function(){var e=this;return new Promise(function(t,r){for(var i=[],s=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),o=0,a=s;o<a;o++)i.push(e._flushOneBatch());Promise.all(i).then(function(){t()}).catch(r)})},n.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(t,r){var i=setTimeout(function(){r(new Error("Timeout"))},e._exportTimeoutMillis);ql.with(TX(ql.active()),function(){var s;e._finishedSpans.length<=e._maxExportBatchSize?(s=e._finishedSpans,e._finishedSpans=[]):s=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var o=function(){return e._exporter.export(s,function(h){var p;clearTimeout(i),h.code===xo.SUCCESS?t():r((p=h.error)!==null&&p!==void 0?p:new Error("BatchSpanProcessor: span export failed"))})},a=null,c=0,l=s.length;c<l;c++){var u=s[c];u.resource.asyncAttributesPending&&u.resource.waitForAsyncAttributes&&(a??(a=[]),a.push(u.resource.waitForAsyncAttributes()))}a===null?o():Promise.all(a).then(o,function(h){Rc(h),r(h)})})})},n.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var t=function(){e._isExporting=!0,e._flushOneBatch().finally(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){e._isExporting=!1,Rc(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();this._timer===void 0&&(this._timer=setTimeout(function(){return t()},this._scheduledDelayMillis),this._timer,void 0)}},n.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},n}(),vPe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),yPe=function(n){vPe(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.onInit(r),i}return e.prototype.onInit=function(t){var r=this;(t==null?void 0:t.disableAutoFlushOnDocumentHide)!==!0&&typeof document<"u"&&(this._visibilityChangeListener=function(){document.visibilityState==="hidden"&&r.forceFlush().catch(function(i){Rc(i)})},this._pageHideListener=function(){r.forceFlush().catch(function(i){Rc(i)})},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},e.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},e}(gPe),_Pe=8,bPe=16,SPe=function(){function n(){this.generateTraceId=O7(bPe),this.generateSpanId=O7(_Pe)}return n}(),D1=Array(32);function O7(n){return function(){for(var t=0;t<n*2;t++)D1[t]=Math.floor(Math.random()*16)+48,D1[t]>=58&&(D1[t]+=39);return String.fromCharCode.apply(null,D1.slice(0,n*2))}}var wPe=function(){function n(e,t,r){this._tracerProvider=r;var i=pPe(t);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=t.idGenerator||new SPe,this.resource=r.resource,this.instrumentationLibrary=e}return n.prototype.startSpan=function(e,t,r){var i,s,o;t===void 0&&(t={}),r===void 0&&(r=ql.active()),t.root&&(r=Ao.deleteSpan(r));var a=Ao.getSpan(r);if(OL(r)){Rt.debug("Instrumentation suppressed, returning Noop Span");var c=Ao.wrapSpanContext(_X);return c}var l=a==null?void 0:a.spanContext(),u=this._idGenerator.generateSpanId(),h,p,m;!l||!Ao.isSpanContextValid(l)?h=this._idGenerator.generateTraceId():(h=l.traceId,p=l.traceState,m=l.spanId);var v=(i=t.kind)!==null&&i!==void 0?i:$3.INTERNAL,g=((s=t.links)!==null&&s!==void 0?s:[]).map(function(C){return{context:C.context,attributes:nb(C.attributes)}}),S=nb(t.attributes),b=this._sampler.shouldSample(r,h,e,v,S,g);p=(o=b.traceState)!==null&&o!==void 0?o:p;var R=b.decision===gS.RECORD_AND_SAMPLED?La.SAMPLED:La.NONE,k={traceId:h,spanId:u,traceFlags:R,traceState:p};if(b.decision===gS.NOT_RECORD){Rt.debug("Recording is off, propagating context in a non-recording span");var c=Ao.wrapSpanContext(k);return c}var I=nb(Object.assign(S,b.attributes)),T=new hPe(this,r,e,k,v,m,g,t.startTime,void 0,I);return T},n.prototype.startActiveSpan=function(e,t,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=t:arguments.length===3?(s=t,a=r):(s=t,o=r,a=i);var c=o??ql.active(),l=this.startSpan(e,s,c),u=Ao.setSpan(c,l);return ql.with(u,a,void 0,l)}},n.prototype.getGeneralLimits=function(){return this._generalLimits},n.prototype.getSpanLimits=function(){return this._spanLimits},n.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},n}(),EPe="service.name",CPe="telemetry.sdk.name",TPe="telemetry.sdk.language",IPe="telemetry.sdk.version",RPe=EPe,N7=CPe,D7=TPe,F7=IPe;function kPe(){return"unknown_service"}var Il=function(){return Il=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Il.apply(this,arguments)},xPe=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})},PPe=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},LPe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},K3=function(){function n(e,t){var r=this,i;this._attributes=e,this.asyncAttributesPending=t!=null,this._syncAttributes=(i=this._attributes)!==null&&i!==void 0?i:{},this._asyncAttributesPromise=t==null?void 0:t.then(function(s){return r._attributes=Object.assign({},r._attributes,s),r.asyncAttributesPending=!1,s},function(s){return Rt.debug("a resource's async attributes promise rejected: %s",s),r.asyncAttributesPending=!1,{}})}return n.empty=function(){return n.EMPTY},n.default=function(){var e;return new n((e={},e[RPe]=kPe(),e[D7]=y2[D7],e[N7]=y2[N7],e[F7]=y2[F7],e))},Object.defineProperty(n.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&Rt.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),n.prototype.waitForAsyncAttributes=function(){return xPe(this,void 0,void 0,function(){return PPe(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},n.prototype.merge=function(e){var t=this,r;if(!e)return this;var i=Il(Il({},this._syncAttributes),(r=e._syncAttributes)!==null&&r!==void 0?r:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new n(i);var s=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(o){var a,c=LPe(o,2),l=c[0],u=c[1];return Il(Il(Il(Il({},t._syncAttributes),l),(a=e._syncAttributes)!==null&&a!==void 0?a:e.attributes),u)});return new n(i,s)},n.EMPTY=new n({}),n}(),F1=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},U7=function(){function n(e){this._spanProcessors=e}return n.prototype.forceFlush=function(){var e,t,r=[];try{for(var i=F1(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;r.push(o.forceFlush())}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return new Promise(function(a){Promise.all(r).then(function(){a()}).catch(function(c){Rc(c||new Error("MultiSpanProcessor: forceFlush failed")),a()})})},n.prototype.onStart=function(e,t){var r,i;try{for(var s=F1(this._spanProcessors),o=s.next();!o.done;o=s.next()){var a=o.value;a.onStart(e,t)}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},n.prototype.onEnd=function(e){var t,r;try{for(var i=F1(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;o.onEnd(e)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.shutdown=function(){var e,t,r=[];try{for(var i=F1(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;r.push(o.shutdown())}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return new Promise(function(a,c){Promise.all(r).then(function(){a()},c)})},n}(),APe=function(){function n(){}return n.prototype.onStart=function(e,t){},n.prototype.onEnd=function(e){},n.prototype.shutdown=function(){return Promise.resolve()},n.prototype.forceFlush=function(){return Promise.resolve()},n}(),MPe=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},OPe=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Qu;(function(n){n[n.resolved=0]="resolved",n[n.timeout=1]="timeout",n[n.error=2]="error",n[n.unresolved=3]="unresolved"})(Qu||(Qu={}));var NPe=function(){function n(e){e===void 0&&(e={});var t,r;this._registeredSpanProcessors=[],this._tracers=new Map;var i=Zxe({},HX(),mPe(e));if(this.resource=(t=i.resource)!==null&&t!==void 0?t:K3.empty(),i.mergeResourceWithDefaults&&(this.resource=K3.default().merge(this.resource)),this._config=Object.assign({},i,{resource:this.resource}),!((r=e.spanProcessors)===null||r===void 0)&&r.length)this._registeredSpanProcessors=OPe([],MPe(e.spanProcessors),!1),this.activeSpanProcessor=new U7(this._registeredSpanProcessors);else{var s=this._buildExporterFromEnv();if(s!==void 0){var o=new yPe(s);this.activeSpanProcessor=o}else this.activeSpanProcessor=new APe}}return n.prototype.getTracer=function(e,t,r){var i=e+"@"+(t||"")+":"+((r==null?void 0:r.schemaUrl)||"");return this._tracers.has(i)||this._tracers.set(i,new wPe({name:e,version:t,schemaUrl:r==null?void 0:r.schemaUrl},this._config,this)),this._tracers.get(i)},n.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(t){return Rt.error("Error while trying to shutdown current span processor",t)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new U7(this._registeredSpanProcessors)},n.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},n.prototype.register=function(e){e===void 0&&(e={}),Ao.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&ql.setGlobalContextManager(e.contextManager),e.propagator&&tb.setGlobalPropagator(e.propagator)},n.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map(function(r){return new Promise(function(i){var s,o=setTimeout(function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),s=Qu.timeout},e);r.forceFlush().then(function(){clearTimeout(o),s!==Qu.timeout&&(s=Qu.resolved,i(s))}).catch(function(a){clearTimeout(o),s=Qu.error,i(a)})})});return new Promise(function(r,i){Promise.all(t).then(function(s){var o=s.filter(function(a){return a!==Qu.resolved});o.length>0?i(o):r()}).catch(function(s){return i([s])})})},n.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},n.prototype._getPropagator=function(e){var t;return(t=this.constructor._registeredPropagators.get(e))===null||t===void 0?void 0:t()},n.prototype._getSpanExporter=function(e){var t;return(t=this.constructor._registeredExporters.get(e))===null||t===void 0?void 0:t()},n.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(Mv().OTEL_PROPAGATORS)),r=t.map(function(s){var o=e._getPropagator(s);return o||Rt.warn('Propagator "'+s+'" requested through environment variable is unavailable.'),o}),i=r.reduce(function(s,o){return o&&s.push(o),s},[]);if(i.length!==0)return t.length===1?i[0]:new wxe({propagators:i})},n.prototype._buildExporterFromEnv=function(){var e=Mv().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var t=this._getSpanExporter(e);return t||Rt.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},n._registeredPropagators=new Map([["tracecontext",function(){return new jxe}],["baggage",function(){return new N3e}]]),n._registeredExporters=new Map,n}(),DPe=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})},FPe=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},UPe=function(){function n(e){this._exporter=e,this._shutdownOnce=new BX(this._shutdown,this),this._unresolvedExports=new Set}return n.prototype.forceFlush=function(){return DPe(this,void 0,void 0,function(){return FPe(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._unresolvedExports))];case 1:return e.sent(),this._exporter.forceFlush?[4,this._exporter.forceFlush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},n.prototype.onStart=function(e,t){},n.prototype.onEnd=function(e){var t=this,r,i;if(!this._shutdownOnce.isCalled&&(e.spanContext().traceFlags&La.SAMPLED)!==0){var s=function(){return iPe._export(t._exporter,[e]).then(function(a){var c;a.code!==xo.SUCCESS&&Rc((c=a.error)!==null&&c!==void 0?c:new Error("SimpleSpanProcessor: span export failed (status "+a+")"))}).catch(function(a){Rc(a)})};if(e.resource.asyncAttributesPending){var o=(i=(r=e.resource).waitForAsyncAttributes)===null||i===void 0?void 0:i.call(r).then(function(){return o!=null&&t._unresolvedExports.delete(o),s()},function(a){return Rc(a)});o!=null&&this._unresolvedExports.add(o)}else s()}},n.prototype.shutdown=function(){return this._shutdownOnce.call()},n.prototype._shutdown=function(){return this._exporter.shutdown()},n}(),jPe=function(){function n(e){this._delegate=e}return n.prototype.export=function(e,t){this._delegate.export(e,t)},n.prototype.forceFlush=function(){return this._delegate.forceFlush()},n.prototype.shutdown=function(){return this._delegate.shutdown()},n}(),$Pe=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),j7=function(n){$Pe(e,n);function e(t,r,i){var s=n.call(this,t)||this;return s.name="OTLPExporterError",s.data=i,s.code=r,s}return e}(Error);function BPe(n){if(!Number.isNaN(n)&&Number.isFinite(n)&&n>0)return n;throw new Error("Configuration: timeoutMillis is invalid, expected number greater than 0 (actual: '"+n+"')")}function HPe(n){if(n!=null)return function(){return n}}function VPe(n,e,t){var r,i,s,o,a,c;return{timeoutMillis:BPe((i=(r=n.timeoutMillis)!==null&&r!==void 0?r:e.timeoutMillis)!==null&&i!==void 0?i:t.timeoutMillis),concurrencyLimit:(o=(s=n.concurrencyLimit)!==null&&s!==void 0?s:e.concurrencyLimit)!==null&&o!==void 0?o:t.concurrencyLimit,compression:(c=(a=n.compression)!==null&&a!==void 0?a:e.compression)!==null&&c!==void 0?c:t.compression}}function GPe(){return{timeoutMillis:1e4,concurrencyLimit:30,compression:"none"}}var qPe=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})},KPe=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},WPe=function(){function n(e){this._sendingPromises=[],this._concurrencyLimit=e}return n.prototype.pushPromise=function(e){var t=this;if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(e);var r=function(){var i=t._sendingPromises.indexOf(e);t._sendingPromises.splice(i,1)};e.then(r,r)},n.prototype.hasReachedLimit=function(){return this._sendingPromises.length>=this._concurrencyLimit},n.prototype.awaitAll=function(){return qPe(this,void 0,void 0,function(){return KPe(this,function(e){switch(e.label){case 0:return[4,Promise.all(this._sendingPromises)];case 1:return e.sent(),[2]}})})},n}();function zPe(n){return new WPe(n.concurrencyLimit)}function YPe(n){return Object.prototype.hasOwnProperty.call(n,"partialSuccess")}function XPe(){return{handleResponse:function(n){n==null||!YPe(n)||n.partialSuccess==null||Object.keys(n.partialSuccess).length===0||Rt.warn("Received Partial Success response:",JSON.stringify(n.partialSuccess))}}}var JPe=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})},ZPe=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},QPe=function(){function n(e,t,r,i,s){this._transport=e,this._serializer=t,this._responseHandler=r,this._promiseQueue=i,this._timeout=s,this._diagLogger=Rt.createComponentLogger({namespace:"OTLPExportDelegate"})}return n.prototype.export=function(e,t){var r=this;if(this._diagLogger.debug("items to be sent",e),this._promiseQueue.hasReachedLimit()){t({code:xo.FAILED,error:new Error("Concurrent export limit reached")});return}var i=this._serializer.serializeRequest(e);if(i==null){t({code:xo.FAILED,error:new Error("Nothing to send")});return}this._promiseQueue.pushPromise(this._transport.send(i,this._timeout).then(function(s){if(s.status==="success"){if(s.data!=null)try{r._responseHandler.handleResponse(r._serializer.deserializeResponse(s.data))}catch(o){r._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",o,s.data)}t({code:xo.SUCCESS});return}else if(s.status==="failure"&&s.error){t({code:xo.FAILED,error:s.error});return}else s.status==="retryable"?t({code:xo.FAILED,error:new j7("Export failed with retryable status")}):t({code:xo.FAILED,error:new j7("Export failed with unknown error")})},function(s){return t({code:xo.FAILED,error:s})}))},n.prototype.forceFlush=function(){return this._promiseQueue.awaitAll()},n.prototype.shutdown=function(){return JPe(this,void 0,void 0,function(){return ZPe(this,function(e){switch(e.label){case 0:return this._diagLogger.debug("shutdown started"),[4,this.forceFlush()];case 1:return e.sent(),this._transport.shutdown(),[2]}})})},n}();function e6e(n,e){return new QPe(n.transport,n.serializer,XPe(),n.promiseHandler,e.timeout)}function GX(n,e,t){return e6e({transport:t,serializer:e,promiseHandler:zPe(n)},{timeout:n.timeoutMillis})}function qX(n){var e=BigInt(1e9);return BigInt(n[0])*e+BigInt(n[1])}function t6e(n){var e=Number(BigInt.asUintN(32,n)),t=Number(BigInt.asUintN(32,n>>BigInt(32)));return{low:e,high:t}}function KX(n){var e=qX(n);return t6e(e)}function n6e(n){var e=qX(n);return e.toString()}var r6e=typeof BigInt<"u"?n6e:bxe;function $7(n){return n}function WX(n){if(n!==void 0)return NL(n)}var i6e={encodeHrTime:KX,encodeSpanContext:NL,encodeOptionalSpanContext:WX};function s6e(n){var e,t;if(n===void 0)return i6e;var r=(e=n.useLongBits)!==null&&e!==void 0?e:!0,i=(t=n.useHex)!==null&&t!==void 0?t:!1;return{encodeHrTime:r?KX:r6e,encodeSpanContext:i?$7:NL,encodeOptionalSpanContext:i?$7:WX}}var o6e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s};function a6e(n){return{attributes:dE(n.attributes),droppedAttributesCount:0}}function c6e(n){return{name:n.name,version:n.version}}function dE(n){return Object.keys(n).map(function(e){return zX(e,n[e])})}function zX(n,e){return{key:n,value:YX(e)}}function YX(n){var e=typeof n;return e==="string"?{stringValue:n}:e==="number"?Number.isInteger(n)?{intValue:n}:{doubleValue:n}:e==="boolean"?{boolValue:n}:n instanceof Uint8Array?{bytesValue:n}:Array.isArray(n)?{arrayValue:{values:n.map(YX)}}:e==="object"&&n!=null?{kvlistValue:{values:Object.entries(n).map(function(t){var r=o6e(t,2),i=r[0],s=r[1];return zX(i,s)})}}:{}}var l6e=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},u6e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s};function d6e(n,e){var t,r=n.spanContext(),i=n.status;return{traceId:e.encodeSpanContext(r.traceId),spanId:e.encodeSpanContext(r.spanId),parentSpanId:e.encodeOptionalSpanContext(n.parentSpanId),traceState:(t=r.traceState)===null||t===void 0?void 0:t.serialize(),name:n.name,kind:n.kind==null?0:n.kind+1,startTimeUnixNano:e.encodeHrTime(n.startTime),endTimeUnixNano:e.encodeHrTime(n.endTime),attributes:dE(n.attributes),droppedAttributesCount:n.droppedAttributesCount,events:n.events.map(function(s){return f6e(s,e)}),droppedEventsCount:n.droppedEventsCount,status:{code:i.code,message:i.message},links:n.links.map(function(s){return h6e(s,e)}),droppedLinksCount:n.droppedLinksCount}}function h6e(n,e){var t;return{attributes:n.attributes?dE(n.attributes):[],spanId:e.encodeSpanContext(n.context.spanId),traceId:e.encodeSpanContext(n.context.traceId),traceState:(t=n.context.traceState)===null||t===void 0?void 0:t.serialize(),droppedAttributesCount:n.droppedAttributesCount||0}}function f6e(n,e){return{attributes:n.attributes?dE(n.attributes):[],name:n.name,timeUnixNano:e.encodeHrTime(n.time),droppedAttributesCount:n.droppedAttributesCount||0}}function p6e(n,e){var t=s6e(e);return{resourceSpans:g6e(n,t)}}function m6e(n){var e,t,r=new Map;try{for(var i=l6e(n),s=i.next();!s.done;s=i.next()){var o=s.value,a=r.get(o.resource);a||(a=new Map,r.set(o.resource,a));var c=o.instrumentationLibrary.name+"@"+(o.instrumentationLibrary.version||"")+":"+(o.instrumentationLibrary.schemaUrl||""),l=a.get(c);l||(l=[],a.set(c,l)),l.push(o)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r}function g6e(n,e){for(var t=m6e(n),r=[],i=t.entries(),s=i.next();!s.done;){for(var o=u6e(s.value,2),a=o[0],c=o[1],l=[],u=c.values(),h=u.next();!h.done;){var p=h.value;if(p.length>0){var m=p.map(function(g){return d6e(g,e)});l.push({scope:c6e(p[0].instrumentationLibrary),spans:m,schemaUrl:p[0].instrumentationLibrary.schemaUrl})}h=u.next()}var v={resource:a6e(a),scopeSpans:l,schemaUrl:void 0};r.push(v),s=i.next()}return r}var v6e={serializeRequest:function(n){var e=p6e(n,{useHex:!0,useLongBits:!1}),t=new TextEncoder;return t.encode(JSON.stringify(e))},deserializeResponse:function(n){var e=new TextDecoder;return JSON.parse(e.decode(n))}},y6e=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})},_6e=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},b6e=5,S6e=1e3,w6e=5e3,E6e=1.5,B7=.2;function C6e(){return Math.random()*(2*B7)-B7}var T6e=function(){function n(e){this._transport=e}return n.prototype.retry=function(e,t,r){var i=this;return new Promise(function(s,o){setTimeout(function(){i._transport.send(e,t).then(s,o)},r)})},n.prototype.send=function(e,t){var r;return y6e(this,void 0,void 0,function(){var i,s,o,a,c,l,u;return _6e(this,function(h){switch(h.label){case 0:return i=Date.now()+t,[4,this._transport.send(e,t)];case 1:s=h.sent(),o=b6e,a=S6e,h.label=2;case 2:return s.status==="retryable"&&o>0?(o--,c=Math.max(Math.min(a,w6e)+C6e(),0),a=a*E6e,l=(r=s.retryInMillis)!==null&&r!==void 0?r:c,u=i-Date.now(),l>u?[2,s]:[4,this.retry(e,u,l)]):[3,4];case 3:return s=h.sent(),[3,2];case 4:return[2,s]}})})},n.prototype.shutdown=function(){return this._transport.shutdown()},n}();function XX(n){return new T6e(n.transport)}function I6e(n){var e=[429,502,503,504];return e.includes(n)}function R6e(n){if(n!=null){var e=Number.parseInt(n,10);if(Number.isInteger(e))return e>0?e*1e3:-1;var t=new Date(n).getTime()-Date.now();return t>=0?t:0}}var k6e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},x6e=function(){function n(e){this._parameters=e}return n.prototype.send=function(e,t){var r=this;return new Promise(function(i){var s=new XMLHttpRequest;s.timeout=t,s.open("POST",r._parameters.url);var o=r._parameters.headers();Object.entries(o).forEach(function(a){var c=k6e(a,2),l=c[0],u=c[1];s.setRequestHeader(l,u)}),s.ontimeout=function(a){i({status:"failure",error:new Error("XHR request timed out")})},s.onreadystatechange=function(){s.status>=200&&s.status<=299?(Rt.debug("XHR success"),i({status:"success"})):s.status&&I6e(s.status)?i({status:"retryable",retryInMillis:R6e(s.getResponseHeader("Retry-After"))}):s.status!==0&&i({status:"failure",error:new Error("XHR request failed with non-retryable status")})},s.onabort=function(){i({status:"failure",error:new Error("XHR request aborted")})},s.onerror=function(){i({status:"failure",error:new Error("XHR request errored")})},s.send(e)})},n.prototype.shutdown=function(){},n}();function P6e(n){return new x6e(n)}var L6e=function(){function n(e){this._params=e}return n.prototype.send=function(e){var t=this;return new Promise(function(r){navigator.sendBeacon(t._params.url,new Blob([e],{type:t._params.blobType}))?(Rt.debug("SendBeacon success"),r({status:"success"})):r({status:"failure",error:new Error("SendBeacon failed")})})},n.prototype.shutdown=function(){},n}();function A6e(n){return new L6e(n)}function M6e(n,e){return GX(n,e,XX({transport:P6e(n)}))}function O6e(n,e){return GX(n,e,XX({transport:A6e({url:n.url,blobType:n.headers()["Content-Type"]})}))}var N6e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s};function D6e(n){return function(){var e,t={};return Object.entries((e=n==null?void 0:n())!==null&&e!==void 0?e:{}).forEach(function(r){var i=N6e(r,2),s=i[0],o=i[1];typeof o<"u"?t[s]=String(o):Rt.warn('Header "'+s+'" has invalid value ('+o+") and will be ignored")}),t}}var Ud=function(){return Ud=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ud.apply(this,arguments)};function F6e(n,e,t){var r=Ud({},t()),i={};return function(){return e!=null&&Object.assign(i,e()),n!=null&&Object.assign(i,n()),Object.assign(i,r)}}function U6e(n){if(n!=null)try{return new URL(n),n}catch{throw new Error("Configuration: Could not parse user-provided export URL: '"+n+"'")}}function j6e(n,e,t){var r,i,s,o;return Ud(Ud({},VPe(n,e,t)),{headers:F6e(D6e(n.headers),e.headers,t.headers),url:(i=(r=U6e(n.url))!==null&&r!==void 0?r:e.url)!==null&&i!==void 0?i:t.url,agentOptions:(o=(s=n.agentOptions)!==null&&s!==void 0?s:e.agentOptions)!==null&&o!==void 0?o:t.agentOptions})}function $6e(n,e){return Ud(Ud({},GPe()),{headers:function(){return n},url:"http://localhost:4318/"+e,agentOptions:{keepAlive:!0}})}function B6e(n,e,t){return j6e({url:n.url,timeoutMillis:n.timeoutMillis,headers:HPe(n.headers),concurrencyLimit:n.concurrencyLimit},{},$6e(t,e))}function H6e(n,e,t,r){var i=!!n.headers||typeof navigator.sendBeacon!="function",s=B6e(n,t,r);return i?M6e(s,e):O6e(s,e)}var V6e=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),G6e=function(n){V6e(e,n);function e(t){return t===void 0&&(t={}),n.call(this,H6e(t,v6e,"v1/traces",{"Content-Type":"application/json"}))||this}return e}(jPe),q6e=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s},K6e=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},W6e=function(){function n(){this._enabled=!1,this._currentContext=rf}return n.prototype._bindFunction=function(e,t){e===void 0&&(e=rf);var r=this,i=function(){for(var s=this,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return r.with(e,function(){return t.apply(s,o)})};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),i},n.prototype.active=function(){return this._currentContext},n.prototype.bind=function(e,t){return e===void 0&&(e=this.active()),typeof t=="function"?this._bindFunction(e,t):t},n.prototype.disable=function(){return this._currentContext=rf,this._enabled=!1,this},n.prototype.enable=function(){return this._enabled?this:(this._enabled=!0,this._currentContext=rf,this)},n.prototype.with=function(e,t,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];var o=this._currentContext;this._currentContext=e||rf;try{return t.call.apply(t,K6e([r],q6e(i),!1))}finally{this._currentContext=o}},n}(),z6e=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Y6e=function(n){z6e(e,n);function e(t){t===void 0&&(t={});var r=n.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return r}return e.prototype.register=function(t){t===void 0&&(t={}),t.contextManager===void 0&&(t.contextManager=new W6e),t.contextManager&&t.contextManager.enable(),n.prototype.register.call(this,t)},e}(NPe);function X6e(n){for(var e={},t=n.length,r=0;r<t;r++){var i=n[r];i&&(e[String(i).toUpperCase().replace(/[-.]/g,"_")]=i)}return e}var J6e="cloud.provider",Z6e="cloud.account.id",Q6e="cloud.region",eLe="cloud.availability_zone",tLe="cloud.platform",nLe="aws.ecs.container.arn",rLe="aws.ecs.cluster.arn",iLe="aws.ecs.launchtype",sLe="aws.ecs.task.arn",oLe="aws.ecs.task.family",aLe="aws.ecs.task.revision",cLe="aws.eks.cluster.arn",lLe="aws.log.group.names",uLe="aws.log.group.arns",dLe="aws.log.stream.names",hLe="aws.log.stream.arns",fLe="container.name",pLe="container.id",mLe="container.runtime",gLe="container.image.name",vLe="container.image.tag",yLe="deployment.environment",_Le="device.id",bLe="device.model.identifier",SLe="device.model.name",wLe="faas.name",ELe="faas.id",CLe="faas.version",TLe="faas.instance",ILe="faas.max_memory",RLe="host.id",kLe="host.name",xLe="host.type",PLe="host.arch",LLe="host.image.name",ALe="host.image.id",MLe="host.image.version",OLe="k8s.cluster.name",NLe="k8s.node.name",DLe="k8s.node.uid",FLe="k8s.namespace.name",ULe="k8s.pod.uid",jLe="k8s.pod.name",$Le="k8s.container.name",BLe="k8s.replicaset.uid",HLe="k8s.replicaset.name",VLe="k8s.deployment.uid",GLe="k8s.deployment.name",qLe="k8s.statefulset.uid",KLe="k8s.statefulset.name",WLe="k8s.daemonset.uid",zLe="k8s.daemonset.name",YLe="k8s.job.uid",XLe="k8s.job.name",JLe="k8s.cronjob.uid",ZLe="k8s.cronjob.name",QLe="os.type",e4e="os.description",t4e="os.name",n4e="os.version",r4e="process.pid",i4e="process.executable.name",s4e="process.executable.path",o4e="process.command",a4e="process.command_line",c4e="process.command_args",l4e="process.owner",u4e="process.runtime.name",d4e="process.runtime.version",h4e="process.runtime.description",f4e="service.name",p4e="service.namespace",m4e="service.instance.id",g4e="service.version",v4e="telemetry.sdk.name",y4e="telemetry.sdk.language",_4e="telemetry.sdk.version",b4e="telemetry.auto.version",S4e="webengine.name",w4e="webengine.version",E4e="webengine.description",C4e=X6e([J6e,Z6e,Q6e,eLe,tLe,nLe,rLe,iLe,sLe,oLe,aLe,cLe,lLe,uLe,dLe,hLe,fLe,pLe,mLe,gLe,vLe,yLe,_Le,bLe,SLe,wLe,ELe,CLe,TLe,ILe,RLe,kLe,xLe,PLe,LLe,ALe,MLe,OLe,NLe,DLe,FLe,ULe,jLe,$Le,BLe,HLe,VLe,GLe,qLe,KLe,WLe,zLe,YLe,XLe,JLe,ZLe,QLe,e4e,t4e,n4e,r4e,i4e,s4e,o4e,a4e,c4e,l4e,u4e,d4e,h4e,f4e,p4e,m4e,g4e,v4e,y4e,_4e,b4e,S4e,w4e,E4e]);function H7(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ue(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?H7(Object(t),!0).forEach(function(r){me(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):H7(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Ov(n){return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ov(n)}function Bt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function V7(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Ht(n,e,t){return e&&V7(n.prototype,e),t&&V7(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function me(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function T4e(n,e){if(n==null)return{};var t,r,i=function(o,a){if(o==null)return{};var c,l,u={},h=Object.keys(o);for(l=0;l<h.length;l++)c=h[l],a.indexOf(c)>=0||(u[c]=o[c]);return u}(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function _i(n,e){return function(t){if(Array.isArray(t))return t}(n)||function(t,r){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,o,a=[],c=!0,l=!1;try{for(i=i.call(t);!(c=(s=i.next()).done)&&(a.push(s.value),!r||a.length!==r);c=!0);}catch(u){l=!0,o=u}finally{try{c||i.return==null||i.return()}finally{if(l)throw o}}return a}}(n,e)||DL(n,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function kc(n){return function(e){if(Array.isArray(e))return W3(e)}(n)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(n)||DL(n)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function DL(n,e){if(n){if(typeof n=="string")return W3(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?W3(n,e):void 0}}function W3(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function so(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=DL(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){t=t.call(n)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||t.return==null||t.return()}finally{if(a)throw s}}}}var Bs={DEBUG:!1,LIB_VERSION:"1.160.3"},I4e=Array.isArray,JX=Object.prototype,ZX=JX.hasOwnProperty,hE=JX.toString,vr=I4e||function(n){return hE.call(n)==="[object Array]"},Ys=function(n){return typeof n=="function"},zr=function(n){return n===Object(n)&&!vr(n)},ob=function(n){if(zr(n)){for(var e in n)if(ZX.call(n,e))return!1;return!0}return!1},Qe=function(n){return n===void 0},ui=function(n){return hE.call(n)=="[object String]"},G7=function(n){return ui(n)&&n.trim().length===0},Vc=function(n){return n===null},es=function(n){return Qe(n)||Vc(n)},Hs=function(n){return hE.call(n)=="[object Number]"},od=function(n){return hE.call(n)==="[object Boolean]"},R4e=function(n){return n instanceof FormData},ae=typeof window<"u"?window:void 0,Yi=typeof globalThis<"u"?globalThis:ae,QX=Array.prototype,q7=QX.forEach,K7=QX.indexOf,jo=Yi==null?void 0:Yi.navigator,Ke=Yi==null?void 0:Yi.document,Hi=Yi==null?void 0:Yi.location,z3=Yi==null?void 0:Yi.fetch,Y3=Yi!=null&&Yi.XMLHttpRequest&&"withCredentials"in new Yi.XMLHttpRequest?Yi.XMLHttpRequest:void 0,W7=Yi==null?void 0:Yi.AbortController,Rr=jo==null?void 0:jo.userAgent,Cn=ae??{},z7="[PostHog.js]",ye={_log:function(n){if(ae&&(Bs.DEBUG||Cn.POSTHOG_DEBUG)&&!Qe(ae.console)&&ae.console){for(var e=("__rrweb_original__"in ae.console[n])?ae.console[n].__rrweb_original__:ae.console[n],t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];e.apply(void 0,[z7].concat(r))}},info:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];ye._log.apply(ye,["log"].concat(e))},warn:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];ye._log.apply(ye,["warn"].concat(e))},error:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];ye._log.apply(ye,["error"].concat(e))},critical:function(){for(var n,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];(n=console).error.apply(n,[z7].concat(t))},uninitializedWarning:function(n){ye.error("You must initialize PostHog before calling ".concat(n))}},bS={},fE=function(n){return n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Of(n,e,t){if(vr(n)){if(q7&&n.forEach===q7)n.forEach(e,t);else if("length"in n&&n.length===+n.length){for(var r=0,i=n.length;r<i;r++)if(r in n&&e.call(t,n[r],r)===bS)return}}}function an(n,e,t){if(!es(n)){if(vr(n))return Of(n,e,t);if(R4e(n)){var r,i=so(n.entries());try{for(i.s();!(r=i.n()).done;){var s=r.value;if(e.call(t,s[1],s[0])===bS)return}}catch(a){i.e(a)}finally{i.f()}}else for(var o in n)if(ZX.call(n,o)&&e.call(t,n[o],o)===bS)return}}var bi=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return Of(t,function(i){for(var s in i)i[s]!==void 0&&(n[s]=i[s])}),n};function Tt(n,e){return n.indexOf(e)!==-1}function ab(n){for(var e=Object.keys(n),t=e.length,r=new Array(t);t--;)r[t]=[e[t],n[e[t]]];return r}var eJ=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},Y7=function(n){try{return n()}catch{return}},k4e=function(n){return function(){try{for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(this,t)}catch(i){ye.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),ye.critical(i)}}},X3=function(n){var e={};return an(n,function(t,r){ui(t)&&t.length>0&&(e[r]=t)}),e},J3=function(n){return n.replace(/^\$/,"")};function x4e(n,e){return t=n,r=function(s){return ui(s)&&!Vc(e)?s.slice(0,e):s},i=new Set,function s(o,a){return o!==Object(o)?r?r(o,a):o:i.has(o)?void 0:(i.add(o),vr(o)?(c=[],Of(o,function(l){c.push(s(l))})):(c={},an(o,function(l,u){i.has(l)||(c[u]=s(l,u))})),c);var c}(t);var t,r,i}var Do,P4e=function(n){var e,t,r,i,s="";for(e=t=0,r=(n=(n+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<r;i++){var o=n.charCodeAt(i),a=null;o<128?t++:a=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),Vc(a)||(t>e&&(s+=n.substring(e,t)),s+=a,e=t=i+1)}return t>e&&(s+=n.substring(e,n.length)),s},mc=function(){function n(e){return e&&(e.preventDefault=n.preventDefault,e.stopPropagation=n.stopPropagation),e}return n.preventDefault=function(){this.returnValue=!1},n.stopPropagation=function(){this.cancelBubble=!0},function(e,t,r,i,s){if(e)if(e.addEventListener&&!i)e.addEventListener(t,r,!!s);else{var o="on"+t,a=e[o];e[o]=function(c,l,u){return function(h){if(h=h||n(ae==null?void 0:ae.event)){var p,m=!0;Ys(u)&&(p=u(h));var v=l.call(c,h);return p!==!1&&v!==!1||(m=!1),m}}}(e,r,a)}else ye.error("No valid element provided to register_event")}}();function tJ(n,e){for(var t=0;t<n.length;t++)if(e(n[t]))return n[t]}(function(n){n.GZipJS="gzip-js",n.Base64="base64"})(Do||(Do={}));var nJ="$people_distinct_id",_g="__alias",bg="__timers",X7="$autocapture_disabled_server_side",Z3="$heatmaps_enabled_server_side",J7="$exception_capture_enabled_server_side",Z7="$exception_capture_endpoint_suffix",Q7="$web_vitals_enabled_server_side",Q3="$session_recording_enabled_server_side",eD="$console_log_recording_enabled_server_side",tD="$session_recording_network_payload_capture",nD="$session_recording_canvas_recording",rD="$replay_sample_rate",iD="$replay_minimum_duration",SS="$sesid",Gg="$session_is_sampled",mf="$enabled_feature_flags",ex="$early_access_features",gf="$stored_person_properties",Rl="$stored_group_properties",tx="$surveys",U1="$surveys_activated",wS="$flag_call_reported",oc="$user_state",nx="$client_session_props",rx="$capture_rate_limit",ix="$initial_campaign_params",sx="$initial_referrer_info",sD="$initial_person_info",ES="$epp",ox="__POSTHOG_TOOLBAR__",L4e=[nJ,_g,"__cmpns",bg,Q3,Z3,SS,mf,oc,ex,Rl,gf,tx,wS,nx,rx,ix,sx,ES],I2="$active_feature_flags",j1="$override_feature_flags",oD="$feature_flag_payloads",aD=function(n){var e,t={},r=so(ab(n||{}));try{for(r.s();!(e=r.n()).done;){var i=_i(e.value,2),s=i[0],o=i[1];o&&(t[s]=o)}}catch(a){r.e(a)}finally{r.f()}return t},A4e=function(){function n(e){Bt(this,n),this.instance=e,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return Ht(n,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(mf),t=this.instance.get_property(j1);if(!t)return e||{};for(var r=bi({},e),i=Object.keys(t),s=0;s<i.length;s++)r[i[s]]=t[i[s]];return this._override_warning||(ye.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:r}),this._override_warning=!0),r}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(oD)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout(function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())},5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var t=this.instance.config.token,r=this.instance.get_property(gf),i=this.instance.get_property(Rl),s={token:t,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:r,group_properties:i,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:s,compression:this.instance.config.disable_compression?void 0:Do.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(o){var a;e.setReloadingPaused(!1);var c=!0;o.statusCode===200&&(e.$anon_distinct_id=void 0,c=!1),e.receivedFeatureFlags((a=o.json)!==null&&a!==void 0?a:{},c),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var r,i=this.getFlagVariants()[e],s="".concat(i),o=this.instance.get_property(wS)||{};return(t.send_event||!("send_event"in t))&&(!(e in o)||!o[e].includes(s))&&(vr(o[e])?o[e].push(s):o[e]=[s],(r=this.instance.persistence)===null||r===void 0||r.register(me({},wS,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:i})),i}ye.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,t);ye.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(function(t){return t!==e})}},{key:"receivedFeatureFlags",value:function(e,t){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var r=this.getFlagVariants(),i=this.getFlagPayloads();(function(s,o){var a,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=s.featureFlags,h=s.featureFlagPayloads;if(u)if(vr(u)){var p,m={};if(u)for(var v=0;v<u.length;v++)m[u[v]]=!0;o&&o.register((me(p={},I2,u),me(p,mf,m),p))}else{var g=u,S=h;s.errorsWhileComputingFlags&&(g=Ue(Ue({},c),g),S=Ue(Ue({},l),S)),o&&o.register((me(a={},I2,Object.keys(aD(g))),me(a,mf,g||{}),me(a,oD,S||{}),a))}})(e,this.instance.persistence,r,i),this._fireFeatureFlagsCallbacks(t)}}},{key:"override",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return ye.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=t,e===!1)this.instance.persistence.unregister(j1);else if(vr(e)){for(var r={},i=0;i<e.length;i++)r[e[i]]=!0;this.instance.persistence.register(me({},j1,r))}else this.instance.persistence.register(me({},j1,e))}},{key:"onFeatureFlags",value:function(e){var t=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var r=this._prepareFeatureFlagsForCallbacks(),i=r.flags,s=r.flagVariants;e(i,s)}return function(){return t.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,t){var r,i,s=me({},"$feature_enrollment/".concat(e),t);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:t,$set:s}),this.setPersonPropertiesForFlags(s,!1);var o=Ue(Ue({},this.getFlagVariants()),{},me({},e,t));(r=this.instance.persistence)===null||r===void 0||r.register((me(i={},I2,Object.keys(aD(o))),me(i,mf,o),i)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var t=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=this.instance.get_property(ex);if(i&&!r)return e(i);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(s){var o;if(s.json){var a=s.json.earlyAccessFeatures;return(o=t.instance.persistence)===null||o===void 0||o.register(me({},ex,a)),e(a)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter(function(r){return t[r]}),flagVariants:Object.keys(t).filter(function(r){return t[r]}).reduce(function(r,i){return r[i]=t[i],r},{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var t=this._prepareFeatureFlagsForCallbacks(),r=t.flags,i=t.flagVariants;this.featureFlagEventHandlers.forEach(function(s){return s(r,i,{errorsLoading:e})})}},{key:"setPersonPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(gf)||{};this.instance.register(me({},gf,Ue(Ue({},r),e))),t&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(gf)}},{key:"setGroupPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(Rl)||{};Object.keys(r).length!==0&&Object.keys(r).forEach(function(i){r[i]=Ue(Ue({},r[i]),e[i]),delete e[i]}),this.instance.register(me({},Rl,Ue(Ue({},r),e))),t&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var t=this.instance.get_property(Rl)||{};this.instance.register(me({},Rl,Ue(Ue({},t),{},me({},e,{}))))}else this.instance.unregister(Rl)}}]),n}();Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)}),Number.isInteger||(Number.isInteger=function(n){return Hs(n)&&isFinite(n)&&Math.floor(n)===n});var cD="0123456789abcdef",M4e=function(){function n(e){if(Bt(this,n),this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}return Ht(n,[{key:"toString",value:function(){for(var e="",t=0;t<this.bytes.length;t++)e=e+cD.charAt(this.bytes[t]>>>4)+cD.charAt(15&this.bytes[t]),t!==3&&t!==5&&t!==7&&t!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new n(this.bytes.slice(0))}},{key:"equals",value:function(e){return this.compareTo(e)===0}},{key:"compareTo",value:function(e){for(var t=0;t<16;t++){var r=this.bytes[t]-e.bytes[t];if(r!==0)return Math.sign(r)}return 0}}],[{key:"fromFieldsV7",value:function(e,t,r,i){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(r)||!Number.isInteger(i)||e<0||t<0||r<0||i<0||e>0xffffffffffff||t>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var s=new Uint8Array(16);return s[0]=e/Math.pow(2,40),s[1]=e/Math.pow(2,32),s[2]=e/Math.pow(2,24),s[3]=e/Math.pow(2,16),s[4]=e/Math.pow(2,8),s[5]=e,s[6]=112|t>>>8,s[7]=t,s[8]=128|r>>>24,s[9]=r>>>16,s[10]=r>>>8,s[11]=r,s[12]=i>>>24,s[13]=i>>>16,s[14]=i>>>8,s[15]=i,new n(s)}}]),n}(),O4e=function(){function n(){Bt(this,n),me(this,"timestamp",0),me(this,"counter",0),me(this,"random",new N4e)}return Ht(n,[{key:"generate",value:function(){var e=this.generateOrAbort();if(Qe(e)){this.timestamp=0;var t=this.generateOrAbort();if(Qe(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return M4e.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),n}(),rJ=function(n){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<n.length;e++)n[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return n};ae&&!Qe(ae.crypto)&&crypto.getRandomValues&&(rJ=function(n){return crypto.getRandomValues(n)});var lD,N4e=function(){function n(){Bt(this,n),me(this,"buffer",new Uint32Array(8)),me(this,"cursor",1/0)}return Ht(n,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(rJ(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),n}(),Dl=function(){return D4e().toString()},D4e=function(){return(lD||(lD=new O4e)).generate()},F4e="Thu, 01 Jan 1970 00:00:00 GMT",Zm="",U4e=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function j4e(n,e){if(e){var t=function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ke;if(Zm)return Zm;if(!s||["localhost","127.0.0.1"].includes(i))return"";for(var o=i.split("."),a=Math.min(o.length,8),c="dmn_chk_"+Dl(),l=new RegExp("(^|;)\\s*"+c+"=1");!Zm&&a--;){var u=o.slice(a).join("."),h=c+"=1;domain=."+u;s.cookie=h,l.test(s.cookie)&&(s.cookie=h+";expires="+F4e,Zm=u)}return Zm}(n);if(!t){var r=function(i){var s=i.match(U4e);return s?s[0]:""}(n);r!==t&&ye.info("Warning: cookie subdomain discovery mismatch",r,t),t=r}return t?"; domain=."+t:""}return""}var $r,xc={is_supported:function(){return!!Ke},error:function(n){ye.error("cookieStore error: "+n)},get:function(n){if(Ke){try{for(var e=n+"=",t=Ke.cookie.split(";").filter(function(s){return s.length}),r=0;r<t.length;r++){for(var i=t[r];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},parse:function(n){var e;try{e=JSON.parse(xc.get(n))||{}}catch{}return e},set:function(n,e,t,r,i){if(Ke)try{var s="",o="",a=j4e(Ke.location.hostname,r);if(t){var c=new Date;c.setTime(c.getTime()+24*t*60*60*1e3),s="; expires="+c.toUTCString()}i&&(o="; secure");var l=n+"="+encodeURIComponent(JSON.stringify(e))+s+"; SameSite=Lax; path=/"+a+o;return l.length>3686.4&&ye.warn("cookieStore warning: large cookie, len="+l.length),Ke.cookie=l,l}catch{return}},remove:function(n,e){try{xc.set(n,"",-1,e)}catch{return}}},R2=null,gr={is_supported:function(){if(!Vc(R2))return R2;var n=!0;if(Qe(ae))n=!1;else try{var e="__mplssupport__";gr.set(e,"xyz"),gr.get(e)!=='"xyz"'&&(n=!1),gr.remove(e)}catch{n=!1}return n||ye.error("localStorage unsupported; falling back to cookie store"),R2=n,n},error:function(n){ye.error("localStorage error: "+n)},get:function(n){try{return ae==null?void 0:ae.localStorage.getItem(n)}catch(e){gr.error(e)}return null},parse:function(n){try{return JSON.parse(gr.get(n))||{}}catch{}return null},set:function(n,e){try{ae==null||ae.localStorage.setItem(n,JSON.stringify(e))}catch(t){gr.error(t)}},remove:function(n){try{ae==null||ae.localStorage.removeItem(n)}catch(e){gr.error(e)}}},$4e=["distinct_id",SS,Gg,ES],$1=Ue(Ue({},gr),{},{parse:function(n){try{var e={};try{e=xc.parse(n)||{}}catch{}var t=bi(e,JSON.parse(gr.get(n)||"{}"));return gr.set(n,t),t}catch{}return null},set:function(n,e,t,r,i,s){try{gr.set(n,e,void 0,void 0,s);var o={};$4e.forEach(function(a){e[a]&&(o[a]=e[a])}),Object.keys(o).length&&xc.set(n,o,t,r,i,s)}catch(a){gr.error(a)}},remove:function(n,e){try{ae==null||ae.localStorage.removeItem(n),xc.remove(n,e)}catch(t){gr.error(t)}}}),B1={},B4e={is_supported:function(){return!0},error:function(n){ye.error("memoryStorage error: "+n)},get:function(n){return B1[n]||null},parse:function(n){return B1[n]||null},set:function(n,e){B1[n]=e},remove:function(n){delete B1[n]}},Hu=null,qr={is_supported:function(){if(!Vc(Hu))return Hu;if(Hu=!0,Qe(ae))Hu=!1;else try{var n="__support__";qr.set(n,"xyz"),qr.get(n)!=='"xyz"'&&(Hu=!1),qr.remove(n)}catch{Hu=!1}return Hu},error:function(n){ye.error("sessionStorage error: ",n)},get:function(n){try{return ae==null?void 0:ae.sessionStorage.getItem(n)}catch(e){qr.error(e)}return null},parse:function(n){try{return JSON.parse(qr.get(n))||null}catch{}return null},set:function(n,e){try{ae==null||ae.sessionStorage.setItem(n,JSON.stringify(e))}catch(t){qr.error(t)}},remove:function(n){try{ae==null||ae.sessionStorage.removeItem(n)}catch(e){qr.error(e)}}},H4e=["localhost","127.0.0.1"],qg=function(n){var e=Ke==null?void 0:Ke.createElement("a");return Qe(e)?null:(e.href=n,e)},CS=function(n,e){return!!function(t){try{new RegExp(t)}catch{return!1}return!0}(e)&&new RegExp(e).test(n)},V4e=function(n){var e,t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"&",i=[];return an(n,function(s,o){Qe(s)||Qe(o)||o==="undefined"||(e=encodeURIComponent(function(a){return a instanceof File}(s)?s.name:s.toString()),t=encodeURIComponent(o),i[i.length]=t+"="+e)}),i.join(r)},uD=function(n,e){for(var t,r=((n.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var s=r[i].split("=");if(s[0]===e){t=s;break}}if(!vr(t)||t.length<2)return"";var o=t[1];try{o=decodeURIComponent(o)}catch{ye.error("Skipping decoding for malformed query param: "+o)}return o.replace(/\+/g," ")},TS=function(n,e){var t=n.match(new RegExp(e+"=([^&]*)"));return t?t[1]:null},eo="Mobile",IS="iOS",Ca="Android",Nv="Tablet",iJ=Ca+" "+Nv,sJ="iPad",oJ="Apple",aJ=oJ+" Watch",Dv="Safari",op="BlackBerry",cJ="Samsung",lJ=cJ+"Browser",uJ=cJ+" Internet",Kl="Chrome",G4e=Kl+" OS",dJ=Kl+" "+IS,FL="Internet Explorer",hJ=FL+" "+eo,UL="Opera",q4e=UL+" Mini",jL="Edge",fJ="Microsoft "+jL,Nf="Firefox",pJ=Nf+" "+IS,Fv="Nintendo",Uv="PlayStation",Df="Xbox",mJ=Ca+" "+eo,gJ=eo+" "+Dv,Sg="Windows",ax=Sg+" Phone",dD="Nokia",cx="Ouya",vJ="Generic",K4e=vJ+" "+eo.toLowerCase(),yJ=vJ+" "+Nv.toLowerCase(),lx="Konqueror",vi="(\\d+(\\.\\d+)?)",k2=new RegExp("Version/"+vi),W4e=new RegExp(Df,"i"),z4e=new RegExp(Uv+" \\w+","i"),Y4e=new RegExp(Fv+" \\w+","i"),$L=new RegExp(op+"|PlayBook|BB10","i"),X4e={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},J4e=function(n,e){return e&&Tt(e,oJ)||function(t){return Tt(t,Dv)&&!Tt(t,Kl)&&!Tt(t,Ca)}(n)},hD=function(n,e){return e=e||"",Tt(n," OPR/")&&Tt(n,"Mini")?q4e:Tt(n," OPR/")?UL:$L.test(n)?op:Tt(n,"IE"+eo)||Tt(n,"WPDesktop")?hJ:Tt(n,lJ)?uJ:Tt(n,jL)||Tt(n,"Edg/")?fJ:Tt(n,"FBIOS")?"Facebook "+eo:Tt(n,"UCWEB")||Tt(n,"UCBrowser")?"UC Browser":Tt(n,"CriOS")?dJ:Tt(n,"CrMo")?Kl:Tt(n,Ca)&&Tt(n,Dv)?mJ:Tt(n,Kl)?Kl:Tt(n,"FxiOS")?pJ:Tt(n.toLowerCase(),lx.toLowerCase())?lx:J4e(n,e)?Tt(n,eo)?gJ:Dv:Tt(n,Nf)?Nf:Tt(n,"MSIE")||Tt(n,"Trident/")?FL:Tt(n,"Gecko")?Nf:""},Z4e=(me($r={},hJ,[new RegExp("rv:"+vi)]),me($r,fJ,[new RegExp(jL+"?\\/"+vi)]),me($r,Kl,[new RegExp("("+Kl+"|CrMo)\\/"+vi)]),me($r,dJ,[new RegExp("CriOS\\/"+vi)]),me($r,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+vi)]),me($r,Dv,[k2]),me($r,gJ,[k2]),me($r,UL,[new RegExp("(Opera|OPR)\\/"+vi)]),me($r,Nf,[new RegExp(Nf+"\\/"+vi)]),me($r,pJ,[new RegExp("FxiOS\\/"+vi)]),me($r,lx,[new RegExp("Konqueror[:/]?"+vi,"i")]),me($r,op,[new RegExp(op+" "+vi),k2]),me($r,mJ,[new RegExp("android\\s"+vi,"i")]),me($r,uJ,[new RegExp(lJ+"\\/"+vi)]),me($r,FL,[new RegExp("(rv:|MSIE )"+vi)]),me($r,"Mozilla",[new RegExp("rv:"+vi)]),$r),fD=[[new RegExp(Df+"; "+Df+" (.*?)[);]","i"),function(n){return[Df,n&&n[1]||""]}],[new RegExp(Fv,"i"),[Fv,""]],[new RegExp(Uv,"i"),[Uv,""]],[$L,[op,""]],[new RegExp(Sg,"i"),function(n,e){if(/Phone/.test(e)||/WPDesktop/.test(e))return[ax,""];if(new RegExp(eo).test(e)&&!/IEMobile\b/.test(e))return[Sg+" "+eo,""];var t=/Windows NT ([0-9.]+)/i.exec(e);if(t&&t[1]){var r=t[1],i=X4e[r]||"";return/arm/i.test(e)&&(i="RT"),[Sg,i]}return[Sg,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(n){if(n&&n[3]){var e=[n[3],n[4],n[5]||"0"];return[IS,e.join(".")]}return[IS,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(n){var e="";return n&&n.length>=3&&(e=Qe(n[2])?n[3]:n[2]),["watchOS",e]}],[new RegExp("("+Ca+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+Ca+")","i"),function(n){if(n&&n[2]){var e=[n[2],n[3],n[4]||"0"];return[Ca,e.join(".")]}return[Ca,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(n){var e=["Mac OS X",""];if(n&&n[1]){var t=[n[1],n[2],n[3]||"0"];e[1]=t.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[G4e,""]],[/Linux|debian/i,["Linux",""]]],pD=function(n){return Y4e.test(n)?Fv:z4e.test(n)?Uv:W4e.test(n)?Df:new RegExp(cx,"i").test(n)?cx:new RegExp("("+ax+"|WPDesktop)","i").test(n)?ax:/iPad/.test(n)?sJ:/iPod/.test(n)?"iPod Touch":/iPhone/.test(n)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(n)?aJ:$L.test(n)?op:/(kobo)\s(ereader|touch)/i.test(n)?"Kobo":new RegExp(dD,"i").test(n)?dD:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(n)||/(kf[a-z]+)( bui|\)).+silk\//i.test(n)?"Kindle Fire":/(Android|ZTE)/i.test(n)?!new RegExp(eo).test(n)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(n)?/pixel[\daxl ]{1,6}/i.test(n)&&!/pixel c/i.test(n)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(n)||/lmy47v/i.test(n)&&!/QTAQZ3/i.test(n)?Ca:iJ:Ca:new RegExp("(pda|"+eo+")","i").test(n)?K4e:new RegExp(Nv,"i").test(n)&&!new RegExp(Nv+" pc","i").test(n)?yJ:""},H1="https?://(.*)",Q4e=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],kr={campaignParams:function(n){return Ke?this._campaignParamsFromUrl(Ke.URL,n):{}},_campaignParamsFromUrl:function(n,e){var t=Q4e.concat(e||[]),r={};return an(t,function(i){var s=uD(n,i);s&&(r[i]=s)}),r},_searchEngine:function(n){return n?n.search(H1+"google.([^/?]*)")===0?"google":n.search(H1+"bing.com")===0?"bing":n.search(H1+"yahoo.com")===0?"yahoo":n.search(H1+"duckduckgo.com")===0?"duckduckgo":null:null},_searchInfoFromReferrer:function(n){var e=kr._searchEngine(n),t=e!="yahoo"?"q":"p",r={};if(!Vc(e)){r.$search_engine=e;var i=Ke?uD(Ke.referrer,t):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var n=Ke==null?void 0:Ke.referrer;return n?this._searchInfoFromReferrer(n):{}},browser:hD,browserVersion:function(n,e){var t=hD(n,e),r=Z4e[t];if(Qe(r))return null;for(var i=0;i<r.length;i++){var s=r[i],o=n.match(s);if(o)return parseFloat(o[o.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(n){for(var e=0;e<fD.length;e++){var t=_i(fD[e],2),r=t[0],i=t[1],s=r.exec(n),o=s&&(Ys(i)?i(s,n):i);if(o)return o}return["",""]},device:pD,deviceType:function(n){var e=pD(n);return e===sJ||e===iJ||e==="Kobo"||e==="Kindle Fire"||e===yJ?Nv:e===Fv||e===Df||e===Uv||e===cx?"Console":e===aJ?"Wearable":e?eo:"Desktop"},referrer:function(){return(Ke==null?void 0:Ke.referrer)||"$direct"},referringDomain:function(){var n;return Ke!=null&&Ke.referrer&&((n=qg(Ke.referrer))===null||n===void 0?void 0:n.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:Hi==null?void 0:Hi.href}},initialPersonPropsFromInfo:function(n){var e,t=n.r,r=n.u,i={$initial_referrer:t,$initial_referring_domain:t==null?void 0:t=="$direct"?"$direct":(e=qg(t))===null||e===void 0?void 0:e.host};if(r){i.$initial_current_url=r;var s=qg(r);i.$initial_host=s==null?void 0:s.host,i.$initial_pathname=s==null?void 0:s.pathname,an(this._campaignParamsFromUrl(r),function(o,a){i["$initial_"+J3(a)]=o})}return t&&an(this._searchInfoFromReferrer(t),function(o,a){i["$initial_"+J3(a)]=o}),i},properties:function(){if(!Rr)return{};var n=_i(kr.os(Rr),2),e=n[0],t=n[1];return bi(X3({$os:e,$os_version:t,$browser:kr.browser(Rr,navigator.vendor),$device:kr.device(Rr),$device_type:kr.deviceType(Rr)}),{$current_url:Hi==null?void 0:Hi.href,$host:Hi==null?void 0:Hi.host,$pathname:Hi==null?void 0:Hi.pathname,$raw_user_agent:Rr.length>1e3?Rr.substring(0,997)+"...":Rr,$browser_version:kr.browserVersion(Rr,navigator.vendor),$browser_language:kr.browserLanguage(),$screen_height:ae==null?void 0:ae.screen.height,$screen_width:ae==null?void 0:ae.screen.width,$viewport_height:ae==null?void 0:ae.innerHeight,$viewport_width:ae==null?void 0:ae.innerWidth,$lib:"web",$lib_version:Bs.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:eJ()/1e3})},people_properties:function(){if(!Rr)return{};var n=_i(kr.os(Rr),2),e=n[0],t=n[1];return bi(X3({$os:e,$os_version:t,$browser:kr.browser(Rr,navigator.vendor)}),{$browser_version:kr.browserVersion(Rr,navigator.vendor)})}},eAe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],x2=function(){function n(e){Bt(this,n),this.config=e,this.props={},this.campaign_params_saved=!1,this.name=function(t){var r="";return t.token&&(r=t.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),t.persistence_name?"ph_"+t.persistence_name:"ph_"+r+"_posthog"}(e),this.storage=this.buildStorage(e),this.load(),e.debug&&ye.info("Persistence loaded",e.persistence,Ue({},this.props)),this.update_config(e,e),this.save()}return Ht(n,[{key:"buildStorage",value:function(e){eAe.indexOf(e.persistence.toLowerCase())===-1&&(ye.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=e.persistence.toLowerCase();return t==="localstorage"&&gr.is_supported()?gr:t==="localstorage+cookie"&&$1.is_supported()?$1:t==="sessionstorage"&&qr.is_supported()?qr:t==="memory"?B4e:t==="cookie"?xc:$1.is_supported()?$1:xc}},{key:"properties",value:function(){var e={};return an(this.props,function(t,r){if(r===mf&&zr(t))for(var i=Object.keys(t),s=0;s<i.length;s++)e["$feature/".concat(i[s])]=t[i[s]];else a=r,c=!1,(Vc(o=L4e)?c:K7&&o.indexOf===K7?o.indexOf(a)!=-1:(an(o,function(l){if(c||(c=l===a))return bS}),c))||(e[r]=t);var o,a,c}),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=bi({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,t,r){var i=this;if(zr(e)){Qe(t)&&(t="None"),this.expire_days=Qe(r)?this.default_expiry:r;var s=!1;if(an(e,function(o,a){i.props.hasOwnProperty(a)&&i.props[a]!==t||(i.props[a]=o,s=!0)}),s)return this.save(),!0}return!1}},{key:"register",value:function(e,t){var r=this;if(zr(e)){this.expire_days=Qe(t)?this.default_expiry:t;var i=!1;if(an(e,function(s,o){e.hasOwnProperty(o)&&r.props[o]!==s&&(r.props[o]=s,i=!0)}),i)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(kr.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(kr.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(kr.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[ix]||this.props[sx]||this.register_once(me({},sD,kr.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return X3({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,t={};an([sx,ix],function(s){var o=e.props[s];o&&an(o,function(a,c){t["$initial_"+J3(c)]=a})});var r=this.props[sD];if(r){var i=kr.initialPersonPropsFromInfo(r);bi(t,i)}return t}},{key:"safe_merge",value:function(e){return an(this.props,function(t,r){r in e||(e[r]=t)}),e}},{key:"update_config",value:function(e,t){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence){var r=this.buildStorage(e),i=this.props;this.clear(),this.storage=r,this.props=i,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,t){var r=this.props[bg]||{};r[e]=t,this.props[bg]=r,this.save()}},{key:"remove_event_timer",value:function(e){var t=(this.props[bg]||{})[e];return Qe(t)||(delete this.props[bg][e],this.save()),t}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,t){this.props[e]=t,this.save()}}]),n}();function ux(n){return JSON.stringify(n,(e=[],function(t,r){if(zr(r)){for(;e.length>0&&e.at(-1)!==this;)e.pop();return e.includes(r)?"[Circular]":(e.push(r),r)}return r})).length;var e}var tAe=2,nAe=4;function dx(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:66060288e-1;if(n.size>=e&&n.data.length>1){var t=Math.floor(n.data.length/2),r=n.data.slice(0,t),i=n.data.slice(t);return[dx({size:ux(r),data:r,sessionId:n.sessionId,windowId:n.windowId}),dx({size:ux(i),data:i,sessionId:n.sessionId,windowId:n.windowId})].flatMap(function(s){return s})}return[n]}var cb=function(n){return n[n.DomContentLoaded=0]="DomContentLoaded",n[n.Load=1]="Load",n[n.FullSnapshot=2]="FullSnapshot",n[n.IncrementalSnapshot=3]="IncrementalSnapshot",n[n.Meta=4]="Meta",n[n.Custom=5]="Custom",n[n.Plugin=6]="Plugin",n}(cb||{}),Qa=function(n){return n[n.Mutation=0]="Mutation",n[n.MouseMove=1]="MouseMove",n[n.MouseInteraction=2]="MouseInteraction",n[n.Scroll=3]="Scroll",n[n.ViewportResize=4]="ViewportResize",n[n.Input=5]="Input",n[n.TouchMove=6]="TouchMove",n[n.MediaInteraction=7]="MediaInteraction",n[n.StyleSheetRule=8]="StyleSheetRule",n[n.CanvasMutation=9]="CanvasMutation",n[n.Font=10]="Font",n[n.Log=11]="Log",n[n.Drag=12]="Drag",n[n.StyleDeclaration=13]="StyleDeclaration",n[n.Selection=14]="Selection",n[n.AdoptedStyleSheet=15]="AdoptedStyleSheet",n[n.CustomElement=16]="CustomElement",n}(Qa||{});function BL(n){return n?fE(n).split(/\s+/):[]}function mD(n){var e=ae==null?void 0:ae.location.href;return!!(e&&n&&n.some(function(t){return e.match(t)}))}function RS(n){var e="";switch(Ov(n.className)){case"string":e=n.className;break;case"object":e=(n.className&&"baseVal"in n.className?n.className.baseVal:null)||n.getAttribute("class")||"";break;default:e=""}return BL(e)}function _J(n){return es(n)?null:fE(n).split(/(\s+)/).filter(function(e){return Ff(e)}).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function kS(n){var e="";return fx(n)&&!EJ(n)&&n.childNodes&&n.childNodes.length&&an(n.childNodes,function(t){var r;bJ(t)&&t.textContent&&(e+=(r=_J(t.textContent))!==null&&r!==void 0?r:"")}),fE(e)}function HL(n){return!!n&&n.nodeType===1}function Wl(n,e){return!!n&&!!n.tagName&&n.tagName.toLowerCase()===e.toLowerCase()}function bJ(n){return!!n&&n.nodeType===3}function SJ(n){return!!n&&n.nodeType===11}var hx=["a","button","form","input","select","textarea","label"];function wJ(n){var e=n.parentNode;return!(!e||!HL(e))&&e}function rAe(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!ae||!n||Wl(n,"html")||!HL(n)||t!=null&&t.url_allowlist&&!mD(t.url_allowlist)||t!=null&&t.url_ignorelist&&mD(t.url_ignorelist))return!1;if(t!=null&&t.dom_event_allowlist){var s=t.dom_event_allowlist;if(s&&!s.some(function(m){return e.type===m}))return!1}for(var o=!1,a=[n],c=!0,l=n;l.parentNode&&!Wl(l,"body");)if(SJ(l.parentNode))a.push(l.parentNode.host),l=l.parentNode.host;else{if(!(c=wJ(l)))break;if(r||hx.indexOf(c.tagName.toLowerCase())>-1)o=!0;else{var u=ae.getComputedStyle(c);u&&u.getPropertyValue("cursor")==="pointer"&&(o=!0)}a.push(c),l=c}if(!function(m,v){var g=v==null?void 0:v.element_allowlist;if(Qe(g))return!0;var S,b=so(m);try{var R=function(){var I=S.value;if(g.some(function(T){return I.tagName.toLowerCase()===T}))return{v:!0}};for(b.s();!(S=b.n()).done;){var k=R();if(Ov(k)==="object")return k.v}}catch(I){b.e(I)}finally{b.f()}return!1}(a,t)||!function(m,v){var g=v==null?void 0:v.css_selector_allowlist;if(Qe(g))return!0;var S,b=so(m);try{var R=function(){var I=S.value;if(g.some(function(T){return I.matches(T)}))return{v:!0}};for(b.s();!(S=b.n()).done;){var k=R();if(Ov(k)==="object")return k.v}}catch(I){b.e(I)}finally{b.f()}return!1}(a,t))return!1;var h=ae.getComputedStyle(n);if(h&&h.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var p=n.tagName.toLowerCase();switch(p){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return o?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(hx.indexOf(p)>-1||n.getAttribute("contenteditable")==="true")}}function fx(n){for(var e=n;e.parentNode&&!Wl(e,"body");e=e.parentNode){var t=RS(e);if(Tt(t,"ph-sensitive")||Tt(t,"ph-no-capture"))return!1}if(Tt(RS(n),"ph-include"))return!0;var r=n.type||"";if(ui(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=n.name||n.id||"";return!(ui(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function EJ(n){return!!(Wl(n,"input")&&!["button","checkbox","submit","reset"].includes(n.type)||Wl(n,"select")||Wl(n,"textarea")||n.getAttribute("contenteditable")==="true")}var CJ="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",iAe=new RegExp("^(?:".concat(CJ,")$")),sAe=new RegExp(CJ),TJ="\\d{3}-?\\d{2}-?\\d{4}",oAe=new RegExp("^(".concat(TJ,")$")),aAe=new RegExp("(".concat(TJ,")"));function Ff(n){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!(es(n)||ui(n)&&(n=fE(n),(e?iAe:sAe).test((n||"").replace(/[- ]/g,""))||(e?oAe:aAe).test(n)))}function gD(n){var e=kS(n);return Ff(e="".concat(e," ").concat(IJ(n)).trim())?e:""}function IJ(n){var e="";return n&&n.childNodes&&n.childNodes.length&&an(n.childNodes,function(t){var r;if(t&&((r=t.tagName)===null||r===void 0?void 0:r.toLowerCase())==="span")try{var i=kS(t);e="".concat(e," ").concat(i).trim(),t.childNodes&&t.childNodes.length&&(e="".concat(e," ").concat(IJ(t)).trim())}catch(s){ye.error(s)}}),e}function cAe(n){return function(e){var t=e.map(function(r){var i,s,o="";if(r.tag_name&&(o+=r.tag_name),r.attr_class){r.attr_class.sort();var a,c=so(r.attr_class);try{for(c.s();!(a=c.n()).done;){var l=a.value;o+=".".concat(l.replace(/"/g,""))}}catch(p){c.e(p)}finally{c.f()}}var u=Ue(Ue(Ue(Ue({},r.text?{text:r.text}:{}),{},{"nth-child":(i=r.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(s=r.nth_of_type)!==null&&s!==void 0?s:0},r.href?{href:r.href}:{}),r.attr_id?{attr_id:r.attr_id}:{}),r.attributes),h={};return ab(u).sort(function(p,m){var v=_i(p,1)[0],g=_i(m,1)[0];return v.localeCompare(g)}).forEach(function(p){var m=_i(p,2),v=m[0],g=m[1];return h[vD(v.toString())]=vD(g.toString())}),o+=":",o+=ab(u).map(function(p){var m=_i(p,2),v=m[0],g=m[1];return"".concat(v,'="').concat(g,'"')}).join("")});return t.join(";")}(function(e){return e.map(function(t){var r,i,s={text:(r=t.$el_text)===null||r===void 0?void 0:r.slice(0,400),tag_name:t.tag_name,href:(i=t.attr__href)===null||i===void 0?void 0:i.slice(0,2048),attr_class:lAe(t),attr_id:t.attr__id,nth_child:t.nth_child,nth_of_type:t.nth_of_type,attributes:{}};return ab(t).filter(function(o){return _i(o,1)[0].indexOf("attr__")===0}).forEach(function(o){var a=_i(o,2),c=a[0],l=a[1];return s.attributes[c]=l}),s})}(n))}function vD(n){return n.replace(/"|\\"/g,'\\"')}function lAe(n){var e=n.attr__class;return e?vr(e)?e:BL(e):void 0}var px="[SessionRecording]",mx="redacted",V1={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(n){return n},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},uAe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],dAe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],hAe=["/s/","/e/","/i/"];function yD(n,e,t,r){if(es(n))return n;var i=(e==null?void 0:e["content-length"])||function(s){return new Blob([s]).size}(n);return ui(i)&&(i=parseInt(i)),i>t?px+" ".concat(r," body too large to record (").concat(i," bytes)"):n}function _D(n,e){if(es(n))return n;var t=n;return Ff(t,!1)||(t=px+" "+e+" body "+mx),an(dAe,function(r){var i,s;(i=t)!==null&&i!==void 0&&i.length&&((s=t)===null||s===void 0?void 0:s.indexOf(r))!==-1&&(t=px+" "+e+" body "+mx+" as might contain: "+r)}),t}var ac,fAe=function(n,e){var t,r,i,s={payloadSizeLimitBytes:V1.payloadSizeLimitBytes,performanceEntryTypeToObserve:kc(V1.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(kc(e.payloadHostDenyList||[]),kc(V1.payloadHostDenyList))},o=n.session_recording.recordHeaders!==!1&&e.recordHeaders,a=n.session_recording.recordBody!==!1&&e.recordBody,c=n.capture_performance!==!1&&e.recordPerformance,l=(t=s,i=Math.min(1e6,(r=t.payloadSizeLimitBytes)!==null&&r!==void 0?r:1e6),function(p){return p!=null&&p.requestBody&&(p.requestBody=yD(p.requestBody,p.requestHeaders,i,"Request")),p!=null&&p.responseBody&&(p.responseBody=yD(p.responseBody,p.responseHeaders,i,"Response")),p}),u=function(p){return l(function(g){var S=qg(g.name);if(!(S&&S.pathname&&hAe.some(function(b){return S.pathname.indexOf(b)===0})))return g}((v=(m=p).requestHeaders,es(v)||an(Object.keys(v??{}),function(g){uAe.includes(g.toLowerCase())&&(v[g]=mx)}),m)));var m,v},h=Ys(n.session_recording.maskNetworkRequestFn);return h&&Ys(n.session_recording.maskCapturedNetworkRequestFn)&&ye.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),h&&(n.session_recording.maskCapturedNetworkRequestFn=function(p){var m=n.session_recording.maskNetworkRequestFn({url:p.name});return Ue(Ue({},p),{},{name:m==null?void 0:m.url})}),s.maskRequestFn=Ys(n.session_recording.maskCapturedNetworkRequestFn)?function(p){var m,v,g,S=u(p);return S&&(m=(v=(g=n.session_recording).maskCapturedNetworkRequestFn)===null||v===void 0?void 0:v.call(g,S))!==null&&m!==void 0?m:void 0}:function(p){return function(m){if(!Qe(m))return m.requestBody=_D(m.requestBody,"Request"),m.responseBody=_D(m.responseBody,"Response"),m}(u(p))},Ue(Ue(Ue({},V1),s),{},{recordHeaders:o,recordBody:a,recordPerformance:c,recordInitialRequests:c})},pAe=Ht(function n(e){var t,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Bt(this,n),me(this,"bucketSize",100),me(this,"refillRate",10),me(this,"mutationBuckets",{}),me(this,"loggedTracker",{}),me(this,"refillBuckets",function(){Object.keys(i.mutationBuckets).forEach(function(o){i.mutationBuckets[o]=i.mutationBuckets[o]+i.refillRate,i.mutationBuckets[o]>=i.bucketSize&&delete i.mutationBuckets[o]})}),me(this,"getNodeOrRelevantParent",function(o){var a=i.rrweb.mirror.getNode(o);if((a==null?void 0:a.nodeName)!=="svg"&&a instanceof Element){var c=a.closest("svg");if(c)return[i.rrweb.mirror.getId(c),c]}return[o,a]}),me(this,"numberOfChanges",function(o){var a,c,l,u,h,p,m,v;return((a=(c=o.removes)===null||c===void 0?void 0:c.length)!==null&&a!==void 0?a:0)+((l=(u=o.attributes)===null||u===void 0?void 0:u.length)!==null&&l!==void 0?l:0)+((h=(p=o.texts)===null||p===void 0?void 0:p.length)!==null&&h!==void 0?h:0)+((m=(v=o.adds)===null||v===void 0?void 0:v.length)!==null&&m!==void 0?m:0)}),me(this,"throttleMutations",function(o){if(o.type!==3||o.data.source!==0)return o;var a=o.data,c=i.numberOfChanges(a);a.attributes&&(a.attributes=a.attributes.filter(function(u){var h,p,m,v=_i(i.getNodeOrRelevantParent(u.id),2),g=v[0],S=v[1];return i.mutationBuckets[g]===0?!1:(i.mutationBuckets[g]=(h=i.mutationBuckets[g])!==null&&h!==void 0?h:i.bucketSize,i.mutationBuckets[g]=Math.max(i.mutationBuckets[g]-1,0),i.mutationBuckets[g]===0&&(i.loggedTracker[g]||(i.loggedTracker[g]=!0,(p=(m=i.options).onBlockedNode)===null||p===void 0||p.call(m,g,S))),u)}));var l=i.numberOfChanges(a);return l!==0||c===l?o:void 0}),this.rrweb=e,this.options=s,this.refillRate=(t=this.options.refillRate)!==null&&t!==void 0?t:this.refillRate,this.bucketSize=(r=this.options.bucketSize)!==null&&r!==void 0?r:this.bucketSize,setInterval(function(){i.refillBuckets()},1e3)}),mAe=3e5,gAe=[Qa.MouseMove,Qa.MouseInteraction,Qa.Scroll,Qa.ViewportResize,Qa.Input,Qa.TouchMove,Qa.MediaInteraction,Qa.Drag],bD=function(n){return{rrwebMethod:n,enqueuedAt:Date.now(),attempt:1}},Ds="[SessionRecording]",vAe=function(){function n(e){var t=this;if(Bt(this,n),me(this,"queuedRRWebEvents",[]),me(this,"isIdle",!1),me(this,"_linkedFlagSeen",!1),me(this,"_lastActivityTimestamp",Date.now()),me(this,"_linkedFlag",null),me(this,"_forceAllowLocalhostNetworkCapture",!1),me(this,"_onBeforeUnload",function(){t._flushBuffer()}),me(this,"_onOffline",function(){t._tryAddCustomEvent("browser offline",{})}),me(this,"_onOnline",function(){t._tryAddCustomEvent("browser online",{})}),me(this,"_onVisibilityChange",function(){if(Ke!=null&&Ke.visibilityState){var o="window "+Ke.visibilityState;t._tryAddCustomEvent(o,{})}}),me(this,"_samplingSessionListener",null),this.instance=e,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw ye.error(Ds+" started without valid sessionManager"),new Error(Ds+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,s=r.windowId;this.sessionId=i,this.windowId=s,this.buffer=this.clearBuffer(),this._setupSampling()}return Ht(n,[{key:"rrwebRecord",get:function(){var e;return Cn==null||(e=Cn.rrweb)===null||e===void 0?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(Ds+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return((e=this.instance.config.session_recording)===null||e===void 0?void 0:e.full_snapshot_interval_millis)||mAe}},{key:"isSampled",get:function(){var e=this.instance.get_property(Gg);return od(e)?e:null}},{key:"sessionDuration",get:function(){var e,t,r=(e=this.buffer)===null||e===void 0?void 0:e.data[((t=this.buffer)===null||t===void 0?void 0:t.data.length)-1],i=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return r?r.timestamp-i:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(Q3),t=!this.instance.config.disable_session_recording;return ae&&e&&t}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(eD),t=this.instance.config.enable_recording_console_log;return t??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(nD);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,t,r=this.instance.get_property(tD),i={recordHeaders:(e=this.instance.config.session_recording)===null||e===void 0?void 0:e.recordHeaders,recordBody:(t=this.instance.config.session_recording)===null||t===void 0?void 0:t.recordBody},s=(i==null?void 0:i.recordHeaders)||(r==null?void 0:r.recordHeaders),o=(i==null?void 0:i.recordBody)||(r==null?void 0:r.recordBody),a=zr(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,c=!!(od(a)?a:r!=null&&r.capturePerformance);return s||o||c?{recordHeaders:s,recordBody:o,recordPerformance:c}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(rD);return Hs(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(iD);return Hs(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?es(this._linkedFlag)||this._linkedFlagSeen?od(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),ae==null||ae.addEventListener("beforeunload",this._onBeforeUnload),ae==null||ae.addEventListener("offline",this._onOffline),ae==null||ae.addEventListener("online",this._onOnline),ae==null||ae.addEventListener("visibilitychange",this._onVisibilityChange),ye.info(Ds+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,ae==null||ae.removeEventListener("beforeunload",this._onBeforeUnload),ae==null||ae.removeEventListener("offline",this._onOffline),ae==null||ae.removeEventListener("online",this._onOnline),ae==null||ae.removeEventListener("visibilitychange",this._onVisibilityChange),ye.info(Ds+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var t,r=this.sessionId!==e,i=this.sampleRate;if(Hs(i)){var s,o=this.isSampled,a=r||!od(o);a?s=Math.random()<i:s=o,!s&&a&&ye.warn(Ds+" Sample rate (".concat(i,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:i}),(t=this.instance.persistence)===null||t===void 0||t.register(me({},Gg,s))}else{var c;(c=this.instance.persistence)===null||c===void 0||c.register(me({},Gg,null))}}},{key:"afterDecideResponse",value:function(e){var t,r,i,s=this;if(this._persistDecideResponse(e),this._linkedFlag=((t=e.sessionRecording)===null||t===void 0?void 0:t.linkedFlag)||null,(r=e.sessionRecording)!==null&&r!==void 0&&r.endpoint&&(this._endpoint=(i=e.sessionRecording)===null||i===void 0?void 0:i.endpoint),this._setupSampling(),!es(this._linkedFlag)&&!this._linkedFlagSeen){var o=ui(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,a=ui(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags(function(c,l){var u=zr(l)&&o in l,h=a?l[o]===a:u;if(h){var p={linkedFlag:o,linkedVariant:a},m="linked flag matched";ye.info(Ds+" "+m,p),s._tryAddCustomEvent(m,p)}s._linkedFlagSeen=h})}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;Hs(this.sampleRate)&&Vc(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId(function(t){e.makeSamplingDecision(t)}))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var t=this.instance.persistence,r=function(){var i,s,o,a,c,l,u,h,p=(i=e.sessionRecording)===null||i===void 0?void 0:i.sampleRate,m=es(p)?null:parseFloat(p),v=(s=e.sessionRecording)===null||s===void 0?void 0:s.minimumDurationMilliseconds;t.register((me(h={},Q3,!!e.sessionRecording),me(h,eD,(o=e.sessionRecording)===null||o===void 0?void 0:o.consoleLogRecordingEnabled),me(h,tD,Ue({capturePerformance:e.capturePerformance},(a=e.sessionRecording)===null||a===void 0?void 0:a.networkPayloadCapture)),me(h,nD,{enabled:(c=e.sessionRecording)===null||c===void 0?void 0:c.recordCanvas,fps:(l=e.sessionRecording)===null||l===void 0?void 0:l.canvasFps,quality:(u=e.sessionRecording)===null||u===void 0?void 0:u.canvasQuality}),me(h,rD,m),me(h,iD,Qe(v)?null:v),h))};r(),this.sessionManager.onSessionId(r)}}},{key:"log",value:function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log";(t=this.instance.sessionRecording)===null||t===void 0||t.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:r,trace:[],payload:[JSON.stringify(e)]}},timestamp:eJ()})}},{key:"_startCapture",value:function(){var e=this;Qe(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(Bs.LIB_VERSION),function(t){if(t)return ye.error(Ds+" could not load recorder.js",t);e._onScriptLoaded()}))}},{key:"isInteractiveEvent",value:function(e){var t;return e.type===3&&gAe.indexOf((t=e.data)===null||t===void 0?void 0:t.source)!==-1}},{key:"_updateWindowAndSessionIds",value:function(e){var t=this.isInteractiveEvent(e);t||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var r=!1;if(t&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),r=!0)),!this.isIdle){var i=this.sessionManager.checkAndGetSessionAndWindowId(!t,e.timestamp),s=i.windowId,o=i.sessionId,a=this.sessionId!==o,c=this.windowId!==s;this.windowId=s,this.sessionId=o,(r||[tAe,nAe].indexOf(e.type)===-1&&(c||a||Qe(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(t){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):ye.warn(Ds+" could not emit queued rrweb event.",t,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,t){var r=this;return this._tryRRWebMethod(bD(function(){return r.rrwebRecord.addCustomEvent(e,t)}))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(bD(function(){return e.rrwebRecord.takeFullSnapshot()}))}},{key:"_onScriptLoaded",value:function(){for(var e,t=this,r={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},i=this.instance.config.session_recording,s=0,o=Object.entries(i||{});s<o.length;s++){var a=_i(o[s],2),c=a[0],l=a[1];c in r&&(c==="maskInputOptions"?r.maskInputOptions=Ue({password:!0},l):r[c]=l)}if(this.canvasRecording&&this.canvasRecording.enabled&&(r.recordCanvas=!0,r.sampling={canvas:this.canvasRecording.fps},r.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=(e=this.mutationRateLimiter)!==null&&e!==void 0?e:new pAe(this.rrwebRecord,{onBlockedNode:function(h,p){var m="Too many mutations on node '".concat(h,"'. Rate limiting. This could be due to SVG animations or something similar");ye.info(m,{node:p}),t.log(Ds+" "+m,"warn")}});var u=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(Ue({emit:function(h){t.onRRwebEmit(h)},plugins:u},r)),this.instance._addCaptureHook(function(h){try{if(h==="$pageview"){var p=ae?t._maskUrl(ae.location.href):"";if(!p)return;t._tryAddCustomEvent("$pageview",{href:p})}}catch(m){ye.error("Could not add $pageview to rrweb session",m)}}),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:r,activePlugins:u.map(function(h){return h==null?void 0:h.name})}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else ye.error(Ds+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var t=this.fullSnapshotIntervalMillis;t&&(this._fullSnapshotTimer=setInterval(function(){e._tryTakeFullSnapshot()},t))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return Cn.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(Cn.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&Ys(Cn.getRecordNetworkPlugin)&&(!H4e.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(Cn.getRecordNetworkPlugin(fAe(this.instance.config,this.networkPayloadCapture))):ye.info(Ds+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&zr(e)){if(e.type===cb.Meta){var t=this._maskUrl(e.data.href);if(this._lastHref=t,!t)return;e.data.href=t}else this._pageViewFallBack();e.type===cb.FullSnapshot&&this._scheduleFullSnapshot();var r=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(r){var i=function(a){var c=a;if(c&&zr(c)&&c.type===6&&zr(c.data)&&c.data.plugin==="rrweb/console@1"){c.data.payload.payload.length>10&&(c.data.payload.payload=c.data.payload.payload.slice(0,10),c.data.payload.payload.push("...[truncated]"));for(var l=[],u=0;u<c.data.payload.payload.length;u++)c.data.payload.payload[u]&&c.data.payload.payload[u].length>2e3?l.push(c.data.payload.payload[u].slice(0,2e3)+"...[truncated]"):l.push(c.data.payload.payload[u]);return c.data.payload.payload=l,a}return a}(r),s=ux(i);if(this._updateWindowAndSessionIds(i),!this.isIdle||i.type===cb.Custom){var o={$snapshot_bytes:s,$snapshot_data:i,$session_id:this.sessionId,$window_id:this.windowId};this.status!=="disabled"?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&ae){var e=this._maskUrl(ae.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var t=kc(this.queuedRRWebEvents);this.queuedRRWebEvents=[],t.forEach(function(r){Date.now()-r.enqueuedAt<=2e3&&e._tryRRWebMethod(r)})}}},{key:"_maskUrl",value:function(e){var t=this.instance.config.session_recording;if(t.maskNetworkRequestFn){var r,i={url:e};return(r=i=t.maskNetworkRequestFn(i))===null||r===void 0?void 0:r.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var t=this.minimumDuration,r=this.sessionDuration,i=Hs(r)&&r>=0,s=Hs(t)&&i&&r<t;return this.status==="buffering"||s?(this.flushBufferTimer=setTimeout(function(){e._flushBuffer()},2e3),this.buffer):(this.buffer.data.length>0&&dx(this.buffer).forEach(function(o){e._captureSnapshot({$snapshot_bytes:o.size,$snapshot_data:o.data,$session_id:o.sessionId,$window_id:o.windowId})}),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var t,r=this,i=2+(((t=this.buffer)===null||t===void 0?void 0:t.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+i>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout(function(){r._flushBuffer()},2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),n}(),yAe=function(){function n(e){Bt(this,n),this.instance=e,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return Ht(n,[{key:"call",value:function(){var e=this,t={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(gf),group_properties:this.instance.get_property(Rl),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:t,compression:this.instance.config.disable_compression?void 0:Do.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(r){return e.parseDecideResponse(r.json)}})}},{key:"parseDecideResponse",value:function(e){var t=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var r=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},r),r)ye.error("Failed to fetch feature flags from PostHog.");else{if(!Ke||!Ke.body)return ye.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(function(){t.parseDecideResponse(e)},500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var i,s=so(e.siteApps);try{var o=function(){var a=i.value,c=a.id,l=a.url,u=t.instance.requestRouter.endpointFor("api",l);Cn["__$$ph_site_app_".concat(c)]=t.instance,t.instance.requestRouter.loadScript(u,function(h){if(h)return ye.error("Error while initializing PostHog app with config id ".concat(c),h)})};for(s.s();!(i=s.n()).done;)o()}catch(a){s.e(a)}finally{s.f()}}else e.siteApps.length>0&&ye.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),n}(),_Ae=ae!=null&&ae.location?TS(ae.location.hash,"__posthog")||TS(location.hash,"state"):null,SD="_postHogToolbarParams";(function(n){n[n.UNINITIALIZED=0]="UNINITIALIZED",n[n.LOADING=1]="LOADING",n[n.LOADED=2]="LOADED"})(ac||(ac={}));var bAe=function(){function n(e){Bt(this,n),this.instance=e}return Ht(n,[{key:"setToolbarState",value:function(e){Cn.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return(e=Cn.ph_toolbar_state)!==null&&e!==void 0?e:ac.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(!ae||!Ke)return!1;r=(e=r)!==null&&e!==void 0?e:ae.location,s=(t=s)!==null&&t!==void 0?t:ae.history;try{if(!i){try{ae.localStorage.setItem("test","test"),ae.localStorage.removeItem("test")}catch{return!1}i=ae==null?void 0:ae.localStorage}var o,a=_Ae||TS(r.hash,"__posthog")||TS(r.hash,"state"),c=a?Y7(function(){return JSON.parse(atob(decodeURIComponent(a)))})||Y7(function(){return JSON.parse(decodeURIComponent(a))}):null;return c&&c.action==="ph_authorize"?((o=c).source="url",o&&Object.keys(o).length>0&&(c.desiredHash?r.hash=c.desiredHash:s?s.replaceState(s.state,"",r.pathname+r.search):r.hash="")):((o=JSON.parse(i.getItem(SD)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token)&&(this.loadToolbar(o),!0)}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(Cn.ph_load_toolbar||Cn.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var t=this,r=!(Ke==null||!Ke.getElementById(ox));if(!ae||r)return!1;var i=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,s=Ue(Ue({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},i?{instrument:!1}:{});if(ae.localStorage.setItem(SD,JSON.stringify(Ue(Ue({},s),{},{source:void 0}))),this.getToolbarState()===ac.LOADED)this._callLoadToolbar(s);else if(this.getToolbarState()===ac.UNINITIALIZED){this.setToolbarState(ac.LOADING);var o=3e5,a=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(a),function(c){if(c)return ye.error("Failed to load toolbar",c),void t.setToolbarState(ac.UNINITIALIZED);t.setToolbarState(ac.LOADED),t._callLoadToolbar(s)}),mc(ae,"turbolinks:load",function(){t.setToolbarState(ac.UNINITIALIZED),t.loadToolbar(s)})}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return this.maybeLoadToolbar(e,t,r)}}]),n}(),SAe=function(){function n(e){Bt(this,n),me(this,"isPaused",!0),me(this,"queue",[]),me(this,"flushTimeoutMs",3e3),this.sendRequest=e}return Ht(n,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var t=this.queue.length>0?this.formatQueue():{},r=Object.values(t);[].concat(kc(r.filter(function(i){return i.url.indexOf("/e")===0})),kc(r.filter(function(i){return i.url.indexOf("/e")!==0}))).map(function(i){e.sendRequest(Ue(Ue({},i),{},{transport:"sendBeacon"}))})}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout(function(){if(e.clearFlushTimeout(),e.queue.length>0){var t=e.formatQueue(),r=function(s){var o=t[s],a=new Date().getTime();o.data&&vr(o.data)&&an(o.data,function(c){c.offset=Math.abs(c.timestamp-a),delete c.timestamp}),e.sendRequest(o)};for(var i in t)r(i)}},this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return an(this.queue,function(t){var r,i=t,s=(i?i.batchKey:null)||i.url;Qe(e[s])&&(e[s]=Ue(Ue({},i),{},{data:[]})),(r=e[s].data)===null||r===void 0||r.push(i.data)}),this.queue=[],e}}]),n}(),to=Uint8Array,Xi=Uint16Array,ap=Uint32Array,VL=new to([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),GL=new to([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wD=new to([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),RJ=function(n,e){for(var t=new Xi(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];var i=new ap(t[30]);for(r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return[t,i]},kJ=RJ(VL,2),wAe=kJ[0],gx=kJ[1];wAe[28]=258,gx[258]=28;for(var ED=RJ(GL,0)[1],xJ=new Xi(32768),vn=0;vn<32768;++vn){var Vu=(43690&vn)>>>1|(21845&vn)<<1;Vu=(61680&(Vu=(52428&Vu)>>>2|(13107&Vu)<<2))>>>4|(3855&Vu)<<4,xJ[vn]=((65280&Vu)>>>8|(255&Vu)<<8)>>>1}var Kg=function(n,e,t){for(var r=n.length,i=0,s=new Xi(e);i<r;++i)++s[n[i]-1];var o,a=new Xi(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;for(o=new Xi(r),i=0;i<r;++i)o[i]=xJ[a[n[i]-1]++]>>>15-n[i];return o},jd=new to(288);for(vn=0;vn<144;++vn)jd[vn]=8;for(vn=144;vn<256;++vn)jd[vn]=9;for(vn=256;vn<280;++vn)jd[vn]=7;for(vn=280;vn<288;++vn)jd[vn]=8;var xS=new to(32);for(vn=0;vn<32;++vn)xS[vn]=5;var EAe=Kg(jd,9),CAe=Kg(xS,5),PJ=function(n){return(n/8>>0)+(7&n&&1)},LJ=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var r=new(n instanceof Xi?Xi:n instanceof ap?ap:to)(t-e);return r.set(n.subarray(e,t)),r},Ja=function(n,e,t){t<<=7&e;var r=e/8>>0;n[r]|=t,n[r+1]|=t>>>8},Qm=function(n,e,t){t<<=7&e;var r=e/8>>0;n[r]|=t,n[r+1]|=t>>>8,n[r+2]|=t>>>16},P2=function(n,e){for(var t=[],r=0;r<n.length;++r)n[r]&&t.push({s:r,f:n[r]});var i=t.length,s=t.slice();if(!i)return[new to(0),0];if(i==1){var o=new to(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(T,C){return T.f-C.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],l=0,u=1,h=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};u!=i-1;)a=t[t[l].f<t[h].f?l++:h++],c=t[l!=u&&t[l].f<t[h].f?l++:h++],t[u++]={s:-1,f:a.f+c.f,l:a,r:c};var p=s[0].s;for(r=1;r<i;++r)s[r].s>p&&(p=s[r].s);var m=new Xi(p+1),v=TAe(t[u-1],m,0);if(v>e){r=0;var g=0,S=v-e,b=1<<S;for(s.sort(function(T,C){return m[C.s]-m[T.s]||T.f-C.f});r<i;++r){var R=s[r].s;if(!(m[R]>e))break;g+=b-(1<<v-m[R]),m[R]=e}for(g>>>=S;g>0;){var k=s[r].s;m[k]<e?g-=1<<e-m[k]++-1:++r}for(;r>=0&&g;--r){var I=s[r].s;m[I]==e&&(--m[I],++g)}v=e}return[new to(m),v]},TAe=function n(e,t,r){return e.s==-1?Math.max(n(e.l,t,r+1),n(e.r,t,r+1)):t[e.s]=r},CD=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new Xi(++e),r=0,i=n[0],s=1,o=function(c){t[r++]=c},a=1;a<=e;++a)if(n[a]==i&&a!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=n[a]}return[t.subarray(0,r),e]},eg=function(n,e){for(var t=0,r=0;r<e.length;++r)t+=n[r]*e[r];return t},vx=function(n,e,t){var r=t.length,i=PJ(e+2);n[i]=255&r,n[i+1]=r>>>8,n[i+2]=255^n[i],n[i+3]=255^n[i+1];for(var s=0;s<r;++s)n[i+s+4]=t[s];return 8*(i+4+r)},TD=function(n,e,t,r,i,s,o,a,c,l,u){Ja(e,u++,t),++i[256];for(var h=P2(i,15),p=h[0],m=h[1],v=P2(s,15),g=v[0],S=v[1],b=CD(p),R=b[0],k=b[1],I=CD(g),T=I[0],C=I[1],P=new Xi(19),M=0;M<R.length;++M)P[31&R[M]]++;for(M=0;M<T.length;++M)P[31&T[M]]++;for(var D=P2(P,7),F=D[0],U=D[1],B=19;B>4&&!F[wD[B-1]];--B);var V,z,H,J,Y=l+5<<3,G=eg(i,jd)+eg(s,xS)+o,K=eg(i,p)+eg(s,g)+o+14+3*B+eg(P,F)+(2*P[16]+3*P[17]+7*P[18]);if(Y<=G&&Y<=K)return vx(e,u,n.subarray(c,c+l));if(Ja(e,u,1+(K<G)),u+=2,K<G){V=Kg(p,m),z=p,H=Kg(g,S),J=g;var ee=Kg(F,U);for(Ja(e,u,k-257),Ja(e,u+5,C-1),Ja(e,u+10,B-4),u+=14,M=0;M<B;++M)Ja(e,u+3*M,F[wD[M]]);u+=3*B;for(var q=[R,T],Q=0;Q<2;++Q){var Se=q[Q];for(M=0;M<Se.length;++M){var Ie=31&Se[M];Ja(e,u,ee[Ie]),u+=F[Ie],Ie>15&&(Ja(e,u,Se[M]>>>5&127),u+=Se[M]>>>12)}}}else V=EAe,z=jd,H=CAe,J=xS;for(M=0;M<a;++M)if(r[M]>255){Ie=r[M]>>>18&31,Qm(e,u,V[Ie+257]),u+=z[Ie+257],Ie>7&&(Ja(e,u,r[M]>>>23&31),u+=VL[Ie]);var Ne=31&r[M];Qm(e,u,H[Ne]),u+=J[Ne],Ne>3&&(Qm(e,u,r[M]>>>5&8191),u+=GL[Ne])}else Qm(e,u,V[r[M]]),u+=z[r[M]];return Qm(e,u,V[256]),u+z[256]},IAe=new ap([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),RAe=function(){for(var n=new ap(256),e=0;e<256;++e){for(var t=e,r=9;--r;)t=(1&t&&3988292384)^t>>>1;n[e]=t}return n}(),kAe=function(n,e,t,r,i){return function(s,o,a,c,l,u){var h=s.length,p=new to(c+h+5*(1+Math.floor(h/7e3))+l),m=p.subarray(c,p.length-l),v=0;if(!o||h<8)for(var g=0;g<=h;g+=65535){var S=g+65535;S<h?v=vx(m,v,s.subarray(g,S)):(m[g]=u,v=vx(m,v,s.subarray(g,h)))}else{for(var b=IAe[o-1],R=b>>>13,k=8191&b,I=(1<<a)-1,T=new Xi(32768),C=new Xi(I+1),P=Math.ceil(a/3),M=2*P,D=function(Qn){return(s[Qn]^s[Qn+1]<<P^s[Qn+2]<<M)&I},F=new ap(25e3),U=new Xi(288),B=new Xi(32),V=0,z=0,H=(g=0,0),J=0,Y=0;g<h;++g){var G=D(g),K=32767&g,ee=C[G];if(T[K]=ee,C[G]=K,J<=g){var q=h-g;if((V>7e3||H>24576)&&q>423){v=TD(s,m,0,F,U,B,z,H,Y,g-Y,v),H=V=z=0,Y=g;for(var Q=0;Q<286;++Q)U[Q]=0;for(Q=0;Q<30;++Q)B[Q]=0}var Se=2,Ie=0,Ne=k,Le=K-ee&32767;if(q>2&&G==D(g-Le))for(var xe=Math.min(R,q)-1,Ee=Math.min(32767,g),Ce=Math.min(258,q);Le<=Ee&&--Ne&&K!=ee;){if(s[g+Se]==s[g+Se-Le]){for(var Ve=0;Ve<Ce&&s[g+Ve]==s[g+Ve-Le];++Ve);if(Ve>Se){if(Se=Ve,Ie=Le,Ve>xe)break;var vt=Math.min(Le,Ve-2),Jt=0;for(Q=0;Q<vt;++Q){var Et=g-Le+Q+32768&32767,Be=Et-T[Et]+32768&32767;Be>Jt&&(Jt=Be,ee=Et)}}}Le+=(K=ee)-(ee=T[K])+32768&32767}if(Ie){F[H++]=268435456|gx[Se]<<18|ED[Ie];var Zn=31&gx[Se],In=31&ED[Ie];z+=VL[Zn]+GL[In],++U[257+Zn],++B[In],J=g+Se,++V}else F[H++]=s[g],++U[s[g]]}}v=TD(s,m,u,F,U,B,z,H,Y,g-Y,v)}return LJ(p,0,c+PJ(v)+l)}(n,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(n.length)))):12+e.mem,t,r,!0)},L2=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8};function xAe(n,e){e===void 0&&(e={});var t=function(){var a=4294967295;return{p:function(c){for(var l=a,u=0;u<c.length;++u)l=RAe[255&l^c[u]]^l>>>8;a=l},d:function(){return 4294967295^a}}}(),r=n.length;t.p(n);var i,s=kAe(n,e,10+((i=e).filename&&i.filename.length+1||0),8),o=s.length;return function(a,c){var l=c.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=c.level<2?4:c.level==9?2:0,a[9]=3,c.mtime!=0&&L2(a,4,Math.floor(new Date(c.mtime||Date.now())/1e3)),l){a[3]=8;for(var u=0;u<=l.length;++u)a[u+10]=l.charCodeAt(u)}}(s,e),L2(s,o-8,t.d()),L2(s,o-4,r),s}var PAe=!!Y3||!!z3,ID="text/plain",PS=function(n,e){var t=_i(n.split("?"),2),r=t[0],i=t[1],s=Ue({},e);i==null||i.split("&").forEach(function(a){var c=_i(a.split("="),1)[0];delete s[c]});var o=V4e(s);return o=o?(i?i+"&":"")+o:i,"".concat(r,"?").concat(o)},LAe=function(n){return"data="+encodeURIComponent(typeof n=="string"?n:JSON.stringify(n))},A2=function(n){var e=n.data,t=n.compression;if(e){if(t===Do.GZipJS){var r=xAe(function(s,o){var a=s.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(s);for(var c=new to(s.length+(s.length>>>1)),l=0,u=function(v){c[l++]=v},h=0;h<a;++h){if(l+5>c.length){var p=new to(l+8+(a-h<<1));p.set(c),c=p}var m=s.charCodeAt(h);m<128||o?u(m):m<2048?(u(192|m>>>6),u(128|63&m)):m>55295&&m<57344?(u(240|(m=65536+(1047552&m)|1023&s.charCodeAt(++h))>>>18),u(128|m>>>12&63),u(128|m>>>6&63),u(128|63&m)):(u(224|m>>>12),u(128|m>>>6&63),u(128|63&m))}return LJ(c,0,l)}(JSON.stringify(e)),{mtime:0});return{contentType:ID,body:new Blob([r],{type:ID})}}if(t===Do.Base64){var i=function(s){var o,a,c,l,u,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=0,m=0,v="",g=[];if(!s)return s;s=P4e(s);do o=(u=s.charCodeAt(p++)<<16|s.charCodeAt(p++)<<8|s.charCodeAt(p++))>>18&63,a=u>>12&63,c=u>>6&63,l=63&u,g[m++]=h.charAt(o)+h.charAt(a)+h.charAt(c)+h.charAt(l);while(p<s.length);switch(v=g.join(""),s.length%3){case 1:v=v.slice(0,-2)+"==";break;case 2:v=v.slice(0,-1)+"="}return v}(JSON.stringify(e));return{contentType:"application/x-www-form-urlencoded",body:LAe(i)}}return{contentType:"application/json",body:JSON.stringify(e)}}},Wg=[];Y3&&Wg.push({transport:"XHR",method:function(n){var e,t=new Y3;t.open(n.method||"GET",n.url,!0);var r=(e=A2(n))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body;an(n.headers,function(o,a){t.setRequestHeader(a,o)}),i&&t.setRequestHeader("Content-Type",i),n.timeout&&(t.timeout=n.timeout),t.withCredentials=!0,t.onreadystatechange=function(){if(t.readyState===4){var o,a={statusCode:t.status,text:t.responseText};if(t.status===200)try{a.json=JSON.parse(t.responseText)}catch{}(o=n.callback)===null||o===void 0||o.call(n,a)}},t.send(s)}}),z3&&Wg.push({transport:"fetch",method:function(n){var e,t,r=(e=A2(n))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body,o=new Headers;an(n.headers,function(u,h){o.append(h,u)}),i&&o.append("Content-Type",i);var a=n.url,c=null;if(W7){var l=new W7;c={signal:l.signal,timeout:setTimeout(function(){return l.abort()},n.timeout)}}z3(a,{method:(n==null?void 0:n.method)||"GET",headers:o,keepalive:n.method==="POST",body:s,signal:(t=c)===null||t===void 0?void 0:t.signal}).then(function(u){return u.text().then(function(h){var p,m={statusCode:u.status,text:h};if(u.status===200)try{m.json=JSON.parse(h)}catch(v){ye.error(v)}(p=n.callback)===null||p===void 0||p.call(n,m)})}).catch(function(u){var h;ye.error(u),(h=n.callback)===null||h===void 0||h.call(n,{statusCode:0,text:u})}).finally(function(){return c?clearTimeout(c.timeout):null})}}),jo!=null&&jo.sendBeacon&&Wg.push({transport:"sendBeacon",method:function(n){var e=PS(n.url,{beacon:"1"});try{var t,r=(t=A2(n))!==null&&t!==void 0?t:{},i=r.contentType,s=r.body,o=typeof s=="string"?new Blob([s],{type:i}):s;jo.sendBeacon(e,o)}catch{}}});var AAe=["retriesPerformedSoFar"],ad,MAe=function(){function n(e){var t=this;Bt(this,n),me(this,"isPolling",!1),me(this,"pollIntervalMs",3e3),me(this,"queue",[]),this.instance=e,this.queue=[],this.areWeOnline=!0,!Qe(ae)&&"onLine"in ae.navigator&&(this.areWeOnline=ae.navigator.onLine,ae.addEventListener("online",function(){t.areWeOnline=!0,t.flush()}),ae.addEventListener("offline",function(){t.areWeOnline=!1}))}return Ht(n,[{key:"retriableRequest",value:function(e){var t=this,r=e.retriesPerformedSoFar,i=T4e(e,AAe);Hs(r)&&r>0&&(i.url=PS(i.url,{retry_count:r})),this.instance._send_request(Ue(Ue({},i),{},{callback:function(s){var o;s.statusCode!==200&&(s.statusCode<400||s.statusCode>=500)&&(r??0)<10?t.enqueue(Ue({retriesPerformedSoFar:r},i)):(o=i.callback)===null||o===void 0||o.call(i,s)}}))}},{key:"enqueue",value:function(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var r=function(o){var a=3e3*Math.pow(2,o),c=a/2,l=Math.min(18e5,a),u=(Math.random()-.5)*(l-c);return Math.ceil(l+u)}(t),i=Date.now()+r;this.queue.push({retryAt:i,requestOptions:e});var s="Enqueued failed request for retry in ".concat(r);navigator.onLine||(s+=" (Browser is offline)"),ye.warn(s),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout(function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()},this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),t=[],r=this.queue.filter(function(a){return a.retryAt<e||(t.push(a),!1)});if(this.queue=t,r.length>0){var i,s=so(r);try{for(s.s();!(i=s.n()).done;){var o=i.value.requestOptions;this.retriableRequest(o)}}catch(a){s.e(a)}finally{s.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,t=so(this.queue);try{for(t.s();!(e=t.n()).done;){var r=e.value.requestOptions;try{this.instance._send_request(Ue(Ue({},r),{},{transport:"sendBeacon"}))}catch(i){ye.error(i)}}}catch(i){t.e(i)}finally{t.f()}this.queue=[]}}]),n}(),G1=1800,OAe=function(){function n(e,t,r,i){var s;Bt(this,n),me(this,"_sessionIdChangedHandlers",[]),this.config=e,this.persistence=t,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||Dl,this._windowIdGenerator=i||Dl;var o=e.persistence_name||e.token,a=e.session_idle_timeout_seconds||G1;if(Hs(a)?a>G1?ye.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&ye.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(ye.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=G1),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),G1),this._window_id_storage_key="ph_"+o+"_window_id",this._primary_window_exists_storage_key="ph_"+o+"_primary_window_exists",this._canUseSessionStorage()){var c=qr.parse(this._window_id_storage_key),l=qr.parse(this._primary_window_exists_storage_key);c&&!l?this._windowId=c:qr.remove(this._window_id_storage_key),qr.set(this._primary_window_exists_storage_key,!0)}if((s=this.config.bootstrap)!==null&&s!==void 0&&s.sessionID)try{var u=function(h){var p=h.replace(/-/g,"");if(p.length!==32)throw new Error("Not a valid UUID");if(p[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(p.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,new Date().getTime(),u)}catch(h){ye.error("Invalid sessionID in bootstrap",h)}this._listenToReloadWindow()}return Ht(n,[{key:"onSessionId",value:function(e){var t=this;return Qe(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){t._sessionIdChangedHandlers=t._sessionIdChangedHandlers.filter(function(r){return r!==e})}}},{key:"_canUseSessionStorage",value:function(){return this.config.persistence!=="memory"&&!this.persistence.disabled&&qr.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&qr.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?qr.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,t,r){e===this._sessionId&&t===this._sessionActivityTimestamp&&r===this._sessionStartTimestamp||(this._sessionStartTimestamp=r,this._sessionActivityTimestamp=t,this._sessionId=e,this.persistence.register(me({},SS,[t,e,r])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[SS];return vr(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;ae==null||ae.addEventListener("beforeunload",function(){e._canUseSessionStorage()&&qr.remove(e._primary_window_exists_storage_key)})}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:null)||new Date().getTime(),r=_i(this._getSessionId(),3),i=r[0],s=r[1],o=r[2],a=this._getWindowId(),c=o&&o>0&&Math.abs(t-o)>864e5,l=!1,u=!s,h=!e&&Math.abs(t-i)>this._sessionTimeoutMs;u||h||c?(s=this._sessionIdGenerator(),a=this._windowIdGenerator(),ye.info("[SessionId] new session ID generated",{sessionId:s,windowId:a,changeReason:{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:c}}),o=t,l=!0):a||(a=this._windowIdGenerator(),l=!0);var p=i===0||!e||c?t:i,m=o===0?new Date().getTime():o;return this._setWindowId(a),this._setSessionId(s,p,m),l&&this._sessionIdChangedHandlers.forEach(function(v){return v(s,a)}),{sessionId:s,windowId:a,sessionStartTimestamp:m}}}]),n}();(function(n){n.US="us",n.EU="eu",n.CUSTOM="custom"})(ad||(ad={}));var RD="i.posthog.com",NAe=function(){function n(e){Bt(this,n),me(this,"_regionCache",{}),this.instance=e}return Ht(n,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,t=(e=this.instance.config.ui_host)===null||e===void 0?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace(".".concat(RD),".posthog.com")),t==="https://app.posthog.com"?"https://us.posthog.com":t}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=ad.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=ad.EU:this._regionCache[this.apiHost]=ad.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t&&(t=t[0]==="/"?t:"/".concat(t)),e==="ui")return this.uiHost+t;if(this.region===ad.CUSTOM)return this.apiHost+t;var r=RD+t;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(r);case"api":return"https://".concat(this.region,".").concat(r)}}},{key:"loadScript",value:function(e,t){if(this.instance.config.disable_external_dependency_loading)return ye.warn("".concat(e," was requested but loading of external scripts is disabled.")),t("Loading of external scripts is disabled");var r=e[0]==="/"?this.endpointFor("assets",e):e,i=function(){if(!Ke)return t("document not found");var s=Ke.createElement("script");s.type="text/javascript",s.src=r,s.onload=function(c){return t(void 0,c)},s.onerror=function(c){return t(c)};var o,a=Ke.querySelectorAll("body > script");a.length>0?(o=a[0].parentNode)===null||o===void 0||o.insertBefore(s,a[0]):Ke.body.appendChild(s)};Ke!=null&&Ke.body?i():Ke==null||Ke.addEventListener("DOMContentLoaded",i)}}]),n}(),AJ="posthog-js";function MJ(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.organization,r=e.projectId,i=e.prefix,s=e.severityAllowList,o=s===void 0?["error"]:s;return function(a){var c,l,u,h,p;if(!(o==="*"||o.includes(a.level))||!n.__loaded)return a;a.tags||(a.tags={});var m=n.requestRouter.endpointFor("ui","/project/".concat(n.config.token,"/person/").concat(n.get_distinct_id()));a.tags["PostHog Person URL"]=m,n.sessionRecordingStarted()&&(a.tags["PostHog Recording URL"]=n.get_session_replay_url({withTimestamp:!0}));var v=((c=a.exception)===null||c===void 0?void 0:c.values)||[],g={$exception_message:((l=v[0])===null||l===void 0?void 0:l.value)||a.message,$exception_type:(u=v[0])===null||u===void 0?void 0:u.type,$exception_personURL:m,$exception_level:a.level,$sentry_event_id:a.event_id,$sentry_exception:a.exception,$sentry_exception_message:((h=v[0])===null||h===void 0?void 0:h.value)||a.message,$sentry_exception_type:(p=v[0])===null||p===void 0?void 0:p.type,$sentry_tags:a.tags,$level:a.level};return t&&r&&(g.$sentry_url=(i||"https://sentry.io/organizations/")+t+"/issues/?project="+r+"&query="+a.event_id),n.exceptions.sendExceptionEvent(g),a}}var DAe=Ht(function n(e,t,r,i,s){Bt(this,n),this.name=AJ,this.setupOnce=function(o){o(MJ(e,{organization:t,projectId:r,prefix:i,severityAllowList:s}))}});function FAe(n,e){var t=n.config.segment;if(!t)return e();(function(r,i){var s=r.config.segment;if(!s)return i();var o=function(c){var l=function(){return c.anonymousId()||Dl()};r.config.get_device_id=l,c.id()&&(r.register({distinct_id:c.id(),$device_id:l()}),r.persistence.set_property(oc,"identified")),i()},a=s.user();"then"in a&&Ys(a.then)?a.then(function(c){return o(c)}):o(a)})(n,function(){t.register(function(r){Promise&&Promise.resolve||ye.warn("This browser does not have Promise support, and can not use the segment integration");var i=function(s,o){var a;if(!o)return s;s.event.userId||s.event.anonymousId===r.get_distinct_id()||(ye.info("Segment integration does not have a userId set, resetting PostHog"),r.reset()),s.event.userId&&s.event.userId!==r.get_distinct_id()&&(ye.info("Segment integration has a userId set, identifying with PostHog"),r.identify(s.event.userId));var c=r._calculate_event_properties(o,(a=s.event.properties)!==null&&a!==void 0?a:{},new Date);return s.event.properties=Object.assign({},c,s.event.properties),s};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(s){return i(s,s.event.event)},page:function(s){return i(s,"$pageview")},identify:function(s){return i(s,"$identify")},screen:function(s){return i(s,"$screen")}}}(n)).then(function(){e()})})}var kD,LS,Eo,UAe=function(){function n(e){Bt(this,n),this._instance=e}return Ht(n,[{key:"doPageView",value:function(e){var t,r=this._previousPageViewProperties(e);return this._currentPath=(t=ae==null?void 0:ae.location.pathname)!==null&&t!==void 0?t:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,r}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var t=this._currentPath,r=this._prevPageviewTimestamp,i=this._instance.scrollManager.getContext();if(!r)return{};var s={};if(i){var o=i.maxScrollHeight,a=i.lastScrollY,c=i.maxScrollY,l=i.maxContentHeight,u=i.lastContentY,h=i.maxContentY;Qe(o)||Qe(a)||Qe(c)||Qe(l)||Qe(u)||Qe(h)||(o=Math.ceil(o),a=Math.ceil(a),c=Math.ceil(c),l=Math.ceil(l),u=Math.ceil(u),h=Math.ceil(h),s={$prev_pageview_last_scroll:a,$prev_pageview_last_scroll_percentage:o<=1?1:q1(a/o,0,1),$prev_pageview_max_scroll:c,$prev_pageview_max_scroll_percentage:o<=1?1:q1(c/o,0,1),$prev_pageview_last_content:u,$prev_pageview_last_content_percentage:l<=1?1:q1(u/l,0,1),$prev_pageview_max_content:h,$prev_pageview_max_content_percentage:l<=1?1:q1(h/l,0,1)})}return t&&(s.$prev_pageview_pathname=t),r&&(s.$prev_pageview_duration=(e.getTime()-r.getTime())/1e3),s}}]),n}();function q1(n,e,t){return Math.max(e,Math.min(n,t))}(function(n){n.Popover="popover",n.API="api",n.Widget="widget"})(kD||(kD={})),function(n){n.Open="open",n.MultipleChoice="multiple_choice",n.SingleChoice="single_choice",n.Rating="rating",n.Link="link"}(LS||(LS={})),function(n){n.NextQuestion="next_question",n.End="end",n.ResponseBased="response_based",n.SpecificQuestion="specific_question"}(Eo||(Eo={}));var OJ=function(){function n(){Bt(this,n),me(this,"events",{}),this.events={}}return Ht(n,[{key:"on",value:function(e,t){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){r.events[e]=r.events[e].filter(function(i){return i!==t})}}},{key:"emit",value:function(e,t){var r,i=so(this.events[e]||[]);try{for(i.s();!(r=i.n()).done;)(0,r.value)(t)}catch(a){i.e(a)}finally{i.f()}var s,o=so(this.events["*"]||[]);try{for(o.s();!(s=o.n()).done;)(0,s.value)(e,t)}catch(a){o.e(a)}finally{o.f()}}}]),n}(),jAe=function(){function n(e){var t=this;Bt(this,n),me(this,"_debugEventEmitter",new OJ),me(this,"checkStep",function(r,i){return t.checkStepEvent(r,i)&&t.checkStepUrl(r,i)&&t.checkStepElement(r,i)}),me(this,"checkStepEvent",function(r,i){return i==null||!i.event||(r==null?void 0:r.event)===(i==null?void 0:i.event)}),this.instance=e,this.actionEvents=new Set,this.actionRegistry=new Set}return Ht(n,[{key:"init",value:function(){var e,t=this;if(!Qe((e=this.instance)===null||e===void 0?void 0:e._addCaptureHook)){var r;(r=this.instance)===null||r===void 0||r._addCaptureHook(function(i,s){t.on(i,s)})}}},{key:"register",value:function(e){var t,r,i=this;if(!Qe((t=this.instance)===null||t===void 0?void 0:t._addCaptureHook)&&(e.forEach(function(a){var c,l;(c=i.actionRegistry)===null||c===void 0||c.add(a),(l=a.steps)===null||l===void 0||l.forEach(function(u){var h;(h=i.actionEvents)===null||h===void 0||h.add((u==null?void 0:u.event)||"")})}),(r=this.instance)!==null&&r!==void 0&&r.autocapture)){var s,o=new Set;e.forEach(function(a){var c;(c=a.steps)===null||c===void 0||c.forEach(function(l){l!=null&&l.selector&&o.add(l==null?void 0:l.selector)})}),(s=this.instance)===null||s===void 0||s.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,t){var r,i=this;t!=null&&e.length!=0&&(this.actionEvents.has(e)||this.actionEvents.has(t==null?void 0:t.event))&&this.actionRegistry&&((r=this.actionRegistry)===null||r===void 0?void 0:r.size)>0&&this.actionRegistry.forEach(function(s){i.checkAction(t,s)&&i._debugEventEmitter.emit("actionCaptured",s.name)})}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",function(t){return e(t)})}},{key:"checkAction",value:function(e,t){if((t==null?void 0:t.steps)==null)return!1;var r,i=so(t.steps);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(this.checkStep(e,s))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"onAction",value:function(e,t){return this._debugEventEmitter.on(e,t)}},{key:"checkStepUrl",value:function(e,t){if(t!=null&&t.url){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$current_url;if(!i||typeof i!="string"||!n.matchString(i,t==null?void 0:t.url,(t==null?void 0:t.url_matching)||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(e,t){if((t!=null&&t.href||t!=null&&t.tag_name||t!=null&&t.text)&&!this.getElementsList(e).some(function(s){return!(t!=null&&t.href&&!n.matchString(s.href||"",t==null?void 0:t.href,(t==null?void 0:t.href_matching)||"exact"))&&(t==null||!t.tag_name||s.tag_name===(t==null?void 0:t.tag_name))&&!(t!=null&&t.text&&!n.matchString(s.text||"",t==null?void 0:t.text,(t==null?void 0:t.text_matching)||"exact")&&!n.matchString(s.$el_text||"",t==null?void 0:t.text,(t==null?void 0:t.text_matching)||"exact"))}))return!1;if(t!=null&&t.selector){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$element_selectors;if(!i||!i.includes(t==null?void 0:t.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return(e==null?void 0:e.properties.$elements)==null?[]:e==null?void 0:e.properties.$elements}}],[{key:"matchString",value:function(e,t,r){switch(r){case"regex":return!!ae&&CS(e,t);case"exact":return t===e;case"contains":var i=n.escapeStringRegexp(t).replace(/_/g,".").replace(/%/g,".*");return CS(e,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),n}(),yx=function(){function n(e){Bt(this,n),this.instance=e,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return Ht(n,[{key:"register",value:function(e){var t;Qe((t=this.instance)===null||t===void 0?void 0:t._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var t=this,r=e.filter(function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.actions)&&((o=i.conditions)===null||o===void 0||(a=o.actions)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0});r.length!==0&&(this.actionMatcher==null&&(this.actionMatcher=new jAe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook(function(i){t.onAction(i)})),r.forEach(function(i){var s,o,a,c,l,u,h,p,m,v;i.conditions&&(s=i.conditions)!==null&&s!==void 0&&s.actions&&(o=i.conditions)!==null&&o!==void 0&&(a=o.actions)!==null&&a!==void 0&&a.values&&((c=i.conditions)===null||c===void 0||(l=c.actions)===null||l===void 0||(u=l.values)===null||u===void 0?void 0:u.length)>0&&((h=t.actionMatcher)===null||h===void 0||h.register(i.conditions.actions.values),(p=i.conditions)===null||p===void 0||(m=p.actions)===null||m===void 0||(v=m.values)===null||v===void 0||v.forEach(function(g){if(g&&g.name){var S=t.actionToSurveys.get(g.name);S&&S.push(i.id),t.actionToSurveys.set(g.name,S||[i.id])}}))}))}},{key:"setupEventBasedSurveys",value:function(e){var t,r=this;e.filter(function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.events)&&((o=i.conditions)===null||o===void 0||(a=o.events)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0}).length!==0&&((t=this.instance)===null||t===void 0||t._addCaptureHook(function(i,s){r.onEvent(i,s)}),e.forEach(function(i){var s,o,a;(s=i.conditions)===null||s===void 0||(o=s.events)===null||o===void 0||(a=o.values)===null||a===void 0||a.forEach(function(c){if(c&&c.name){var l=r.eventToSurveys.get(c.name);l&&l.push(i.id),r.eventToSurveys.set(c.name,l||[i.id])}})}))}},{key:"onEvent",value:function(e,t){var r,i,s=((r=this.instance)===null||r===void 0||(i=r.persistence)===null||i===void 0?void 0:i.props[U1])||[];if(n.SURVEY_SHOWN_EVENT_NAME==e&&t&&s.length>0){var o,a=t==null||(o=t.properties)===null||o===void 0?void 0:o.$survey_id;if(a){var c=s.indexOf(a);c>=0&&(s.splice(c,1),this._updateActivatedSurveys(s))}}else this.eventToSurveys.has(e)&&this._updateActivatedSurveys(s.concat(this.eventToSurveys.get(e)||[]))}},{key:"onAction",value:function(e){var t,r,i=((t=this.instance)===null||t===void 0||(r=t.persistence)===null||r===void 0?void 0:r.props[U1])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(i.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var t,r;(t=this.instance)===null||t===void 0||(r=t.persistence)===null||r===void 0||r.register(me({},U1,kc(new Set(e))))}},{key:"getSurveys",value:function(){var e,t,r=(e=this.instance)===null||e===void 0||(t=e.persistence)===null||t===void 0?void 0:t.props[U1];return r||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),n}();me(yx,"SURVEY_SHOWN_EVENT_NAME","survey shown");var tg="[Surveys]",$Ae={icontains:function(n){return!!ae&&ae.location.href.toLowerCase().indexOf(n.toLowerCase())>-1},not_icontains:function(n){return!!ae&&ae.location.href.toLowerCase().indexOf(n.toLowerCase())===-1},regex:function(n){return!!ae&&CS(ae.location.href,n)},not_regex:function(n){return!!ae&&!CS(ae.location.href,n)},exact:function(n){return(ae==null?void 0:ae.location.href)===n},is_not:function(n){return(ae==null?void 0:ae.location.href)!==n}},BAe=function(){function n(e){Bt(this,n),this.instance=e,this._surveyEventReceiver=null}return Ht(n,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,t=Cn==null?void 0:Cn.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||t||(this._surveyEventReceiver==null&&(this._surveyEventReceiver=new yx(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",function(r){if(r)return ye.error(tg,"Could not load surveys script",r);e._surveyManager=Cn.extendPostHogWithSurveys(e.instance)}))}},{key:"getSurveys",value:function(e){var t=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this.instance.config.disable_surveys)return e([]);this._surveyEventReceiver==null&&(this._surveyEventReceiver=new yx(this.instance));var i=this.instance.get_property(tx);if(i&&!r)return e(i);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(s){var o;if(s.statusCode!==200||!s.json)return e([]);var a,c=s.json.surveys||[],l=c.filter(function(u){var h,p,m,v,g,S,b,R,k,I,T,C;return((h=u.conditions)===null||h===void 0?void 0:h.events)&&((p=u.conditions)===null||p===void 0||(m=p.events)===null||m===void 0?void 0:m.values)&&((v=u.conditions)===null||v===void 0||(g=v.events)===null||g===void 0||(S=g.values)===null||S===void 0?void 0:S.length)>0||((b=u.conditions)===null||b===void 0?void 0:b.actions)&&((R=u.conditions)===null||R===void 0||(k=R.actions)===null||k===void 0?void 0:k.values)&&((I=u.conditions)===null||I===void 0||(T=I.actions)===null||T===void 0||(C=T.values)===null||C===void 0?void 0:C.length)>0});return l.length>0&&((a=t._surveyEventReceiver)===null||a===void 0||a.register(l)),(o=t.instance.persistence)===null||o===void 0||o.register(me({},tx,c)),e(c)}})}},{key:"getActiveMatchingSurveys",value:function(e){var t=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.getSurveys(function(i){var s,o=i.filter(function(l){return!(!l.start_date||l.end_date)}).filter(function(l){var u,h,p,m;if(!l.conditions)return!0;var v=(u=l.conditions)===null||u===void 0||!u.url||$Ae[(h=(p=l.conditions)===null||p===void 0?void 0:p.urlMatchType)!==null&&h!==void 0?h:"icontains"](l.conditions.url),g=(m=l.conditions)===null||m===void 0||!m.selector||(Ke==null?void 0:Ke.querySelector(l.conditions.selector));return v&&g}),a=(s=t._surveyEventReceiver)===null||s===void 0?void 0:s.getSurveys(),c=o.filter(function(l){var u,h,p,m,v,g,S,b,R,k;if(!l.linked_flag_key&&!l.targeting_flag_key&&!l.internal_targeting_flag_key)return!0;var I=!l.linked_flag_key||t.instance.featureFlags.isFeatureEnabled(l.linked_flag_key),T=!l.targeting_flag_key||t.instance.featureFlags.isFeatureEnabled(l.targeting_flag_key),C=((u=l.conditions)===null||u===void 0?void 0:u.events)&&((h=l.conditions)===null||h===void 0||(p=h.events)===null||p===void 0?void 0:p.values)&&((m=l.conditions)===null||m===void 0||(v=m.events)===null||v===void 0?void 0:v.values.length)>0,P=((g=l.conditions)===null||g===void 0?void 0:g.actions)&&((S=l.conditions)===null||S===void 0||(b=S.actions)===null||b===void 0?void 0:b.values)&&((R=l.conditions)===null||R===void 0||(k=R.actions)===null||k===void 0?void 0:k.values.length)>0,M=!C&&!P||(a==null?void 0:a.includes(l.id)),D=t._canActivateRepeatedly(l),F=!(l.internal_targeting_flag_key&&!D)||t.instance.featureFlags.isFeatureEnabled(l.internal_targeting_flag_key);return I&&T&&F&&M});return e(c)},r)}},{key:"getNextSurveyStep",value:function(e,t,r){var i,s=e.questions[t],o=t+1;if((i=s.branching)===null||i===void 0||!i.type)return t===e.questions.length-1?Eo.End:o;if(s.branching.type===Eo.End)return Eo.End;if(s.branching.type===Eo.SpecificQuestion){if(Number.isInteger(s.branching.index))return s.branching.index}else if(s.branching.type===Eo.ResponseBased){if(s.type===LS.SingleChoice){var a,c,l=s.choices.indexOf("".concat(r));if((a=s.branching)!==null&&a!==void 0&&(c=a.responseValues)!==null&&c!==void 0&&c.hasOwnProperty(l)){var u=s.branching.responseValues[l];return Number.isInteger(u)?u:u===Eo.End?Eo.End:o}}else if(s.type===LS.Rating){var h,p;if(typeof r!="number"||!Number.isInteger(r))throw new Error("The response type must be an integer");var m=function(g,S){if(S===3){if(g<1||g>3)throw new Error("The response must be in range 1-3");return g===1?"negative":g===2?"neutral":"positive"}if(S===5){if(g<1||g>5)throw new Error("The response must be in range 1-5");return g<=2?"negative":g===3?"neutral":"positive"}if(S===10){if(g<0||g>10)throw new Error("The response must be in range 0-10");return g<=6?"detractors":g<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(r,s.scale);if((h=s.branching)!==null&&h!==void 0&&(p=h.responseValues)!==null&&p!==void 0&&p.hasOwnProperty(m)){var v=s.branching.responseValues[m];return Number.isInteger(v)?v:v===Eo.End?Eo.End:o}}return o}return ye.warn(tg,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return es(Cn.__PosthogExtensions__.canActivateRepeatedly)&&ye.warn(tg,"canActivateRepeatedly is not defined, must init before calling"),Cn.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var t=this;es(this._surveyManager)?ye.warn(tg,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(r){var i=r.filter(function(s){return s.id===e})[0];t._surveyManager.canRenderSurvey(i)})}},{key:"renderSurvey",value:function(e,t){var r=this;es(this._surveyManager)?ye.warn(tg,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(i){var s=i.filter(function(o){return o.id===e})[0];r._surveyManager.renderSurvey(s,Ke==null?void 0:Ke.querySelector(t))})}}]),n}(),HAe=function(){function n(e){var t,r,i=this;Bt(this,n),me(this,"serverLimits",{}),me(this,"lastEventRateLimited",!1),me(this,"checkForLimiting",function(s){var o=s.text;if(o&&o.length)try{(JSON.parse(o).quota_limited||[]).forEach(function(a){ye.info("[RateLimiter] ".concat(a||"events"," is quota limited.")),i.serverLimits[a]=new Date().getTime()+6e4})}catch(a){return void ye.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(a==null?void 0:a.message,'"'),{text:o})}}),this.instance=e,this.captureEventsPerSecond=((t=e.config.rate_limiting)===null||t===void 0?void 0:t.events_per_second)||10,this.captureEventsBurstLimit=Math.max(((r=e.config.rate_limiting)===null||r===void 0?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return Ht(n,[{key:"clientRateLimitContext",value:function(){var e,t,r,i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=new Date().getTime(),o=(e=(t=this.instance.persistence)===null||t===void 0?void 0:t.get_property(rx))!==null&&e!==void 0?e:{tokens:this.captureEventsBurstLimit,last:s};o.tokens+=(s-o.last)/1e3*this.captureEventsPerSecond,o.last=s,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var a=o.tokens<1;return a||i||(o.tokens=Math.max(0,o.tokens-1)),!a||this.lastEventRateLimited||i||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=a,(r=this.instance.persistence)===null||r===void 0||r.set_property(rx,o),{isRateLimited:a,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var t=this.serverLimits[e||"events"]||!1;return t!==!1&&new Date().getTime()<t}}]),n}(),VAe=function(){return Ue({initialPathName:(Hi==null?void 0:Hi.pathname)||"",referringDomain:kr.referringDomain()},kr.campaignParams())},GAe=function(){function n(e,t,r){var i=this;Bt(this,n),me(this,"_onSessionIdCallback",function(s){var o=i._getStoredProps();if(!o||o.sessionId!==s){var a={sessionId:s,props:i._sessionSourceParamGenerator()};i._persistence.register(me({},nx,a))}}),this._sessionIdManager=e,this._persistence=t,this._sessionSourceParamGenerator=r||VAe,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return Ht(n,[{key:"_getStoredProps",value:function(){return this._persistence.props[nx]}},{key:"getSessionProps",value:function(){var e,t=(e=this._getStoredProps())===null||e===void 0?void 0:e.props;return t?{$client_session_initial_referring_host:t.referringDomain,$client_session_initial_pathname:t.initialPathName,$client_session_initial_utm_source:t.utm_source,$client_session_initial_utm_campaign:t.utm_campaign,$client_session_initial_utm_medium:t.utm_medium,$client_session_initial_utm_content:t.utm_content,$client_session_initial_utm_term:t.utm_term}:{}}}]),n}(),qAe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],xD=function(n,e){if(!n)return!1;var t=n.toLowerCase();return qAe.concat(e||[]).some(function(r){var i=r.toLowerCase();return t.indexOf(i)!==-1})},NJ=function(){function n(){Bt(this,n),this.clicks=[]}return Ht(n,[{key:"isRageClick",value:function(e,t,r){var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(t-i.y)<30&&r-i.timestamp<1e3){if(this.clicks.push({x:e,y:t,timestamp:r}),this.clicks.length===3)return!0}else this.clicks=[{x:e,y:t,timestamp:r}];return!1}}]),n}();function PD(n){var e;return n.id===ox||!((e=n.closest)===null||e===void 0||!e.call(n,"#"+ox))}var KAe=function(){function n(e){var t,r=this;Bt(this,n),me(this,"rageclicks",new NJ),me(this,"_enabledServerSide",!1),me(this,"_initialized",!1),me(this,"_flushInterval",null),this.instance=e,this._enabledServerSide=!((t=this.instance.persistence)===null||t===void 0||!t.props[Z3]),ae==null||ae.addEventListener("beforeunload",function(){r.flush()})}return Ht(n,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return zr(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return Qe(this.instance.config.capture_heatmaps)?Qe(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;ye.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval((e=this._flushInterval)!==null&&e!==void 0?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(me({},Z3,t)),this._enabledServerSide=t,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;ae&&Ke&&(mc(Ke,"click",function(t){return e._onClick(t||(ae==null?void 0:ae.event))},!1,!0),mc(Ke,"mousemove",function(t){return e._onMouseMove(t||(ae==null?void 0:ae.event))},!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,t){var r=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),s=this.instance.scrollManager.scrollElement(),o=function(a,c,l){for(var u=a;u&&!Wl(u,"body");){if(u===l)return!1;if(Tt(c,ae==null?void 0:ae.getComputedStyle(u).position))return!0;u=wJ(u)}return!1}(e.target,["fixed","sticky"],s);return{x:e.clientX+(o?0:i),y:e.clientY+(o?0:r),target_fixed:o,type:t}}},{key:"_onClick",value:function(e){var t;if(!PD(e.target)){var r=this._getProperties(e,"click");(t=this.rageclicks)!==null&&t!==void 0&&t.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._capture(Ue(Ue({},r),{},{type:"rageclick"})),this._capture(r)}}},{key:"_onMouseMove",value:function(e){var t=this;PD(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout(function(){t._capture(t._getProperties(e,"mousemove"))},500))}},{key:"_capture",value:function(e){if(ae){var t=ae.location.href;this.buffer=this.buffer||{},this.buffer[t]||(this.buffer[t]=[]),this.buffer[t].push(e)}}},{key:"flush",value:function(){this.buffer&&!ob(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),n}(),WAe=function(){function n(e){var t=this;Bt(this,n),me(this,"_updateScrollData",function(){var r,i,s,o;t.context||(t.context={});var a=t.scrollElement(),c=t.scrollY(),l=a?Math.max(0,a.scrollHeight-a.clientHeight):0,u=c+((a==null?void 0:a.clientHeight)||0),h=(a==null?void 0:a.scrollHeight)||0;t.context.lastScrollY=Math.ceil(c),t.context.maxScrollY=Math.max(c,(r=t.context.maxScrollY)!==null&&r!==void 0?r:0),t.context.maxScrollHeight=Math.max(l,(i=t.context.maxScrollHeight)!==null&&i!==void 0?i:0),t.context.lastContentY=u,t.context.maxContentY=Math.max(u,(s=t.context.maxContentY)!==null&&s!==void 0?s:0),t.context.maxContentHeight=Math.max(h,(o=t.context.maxContentHeight)!==null&&o!==void 0?o:0)}),this.instance=e}return Ht(n,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){ae==null||ae.addEventListener("scroll",this._updateScrollData,!0),ae==null||ae.addEventListener("scrollend",this._updateScrollData,!0),ae==null||ae.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return ae==null?void 0:ae.document.documentElement;var e,t=so(vr(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(t.s();!(e=t.n()).done;){var r=e.value,i=ae==null?void 0:ae.document.querySelector(r);if(i)return i}}catch(s){t.e(s)}finally{t.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return ae&&(ae.scrollY||ae.pageYOffset||ae.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return ae&&(ae.scrollX||ae.pageXOffset||ae.document.documentElement.scrollLeft)||0}}]),n}(),M2="$copy_autocapture";function O2(n,e){return e.length>n?e.slice(0,n)+"...":e}var kl,zAe=function(){function n(e){Bt(this,n),me(this,"_initialized",!1),me(this,"_isDisabledServerSide",null),me(this,"rageclicks",new NJ),me(this,"_elementsChainAsString",!1),this.instance=e,this._elementSelectors=null}return Ht(n,[{key:"config",get:function(){var e,t,r=zr(this.instance.config.autocapture)?this.instance.config.autocapture:{};return r.url_allowlist=(e=r.url_allowlist)===null||e===void 0?void 0:e.map(function(i){return new RegExp(i)}),r.url_ignorelist=(t=r.url_ignorelist)===null||t===void 0?void 0:t.map(function(i){return new RegExp(i)}),r}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(ae&&Ke){var t=function(i){i=i||(ae==null?void 0:ae.event);try{e._captureEvent(i)}catch(s){ye.error("Failed to capture event",s)}},r=function(i){i=i||(ae==null?void 0:ae.event),e._captureEvent(i,M2)};mc(Ke,"submit",t,!1,!0),mc(Ke,"change",t,!1,!0),mc(Ke,"click",t,!1,!0),this.config.capture_copied_text&&(mc(Ke,"copy",r,!1,!0),mc(Ke,"cut",r,!1,!0))}}else ye.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(me({},X7,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var t,r=[];return(t=this._elementSelectors)===null||t===void 0||t.forEach(function(i){var s=Ke==null?void 0:Ke.querySelectorAll(i);s==null||s.forEach(function(o){e===o&&r.push(i)})}),r}},{key:"isEnabled",get:function(){var e,t,r=(e=this.instance.persistence)===null||e===void 0?void 0:e.props[X7],i=this._isDisabledServerSide;if(Vc(i)&&!od(r)&&!this.instance.config.advanced_disable_decide)return!1;var s=(t=this._isDisabledServerSide)!==null&&t!==void 0?t:!!r;return!!this.instance.config.autocapture&&!s}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var t=e;do t=t.previousSibling;while(t&&!HL(t));return t}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!fx(e))return{};var t={};return an(e.attributes,function(r){if(r.name&&r.name.indexOf("data-ph-capture-attribute")===0){var i=r.name.replace("data-ph-capture-attribute-",""),s=r.value;i&&s&&Ff(s)&&(t[i]=s)}}),t}},{key:"_getPropertiesFromElement",value:function(e,t,r){var i,s=e.tagName.toLowerCase(),o={tag_name:s};hx.indexOf(s)>-1&&!r&&(s.toLowerCase()==="a"||s.toLowerCase()==="button"?o.$el_text=O2(1024,gD(e)):o.$el_text=O2(1024,kS(e)));var a=RS(e);a.length>0&&(o.classes=a.filter(function(p){return p!==""}));var c=(i=this.config)===null||i===void 0?void 0:i.element_attribute_ignorelist;an(e.attributes,function(p){var m;if((!EJ(e)||["name","id","class","aria-label"].indexOf(p.name)!==-1)&&(c==null||!c.includes(p.name))&&!t&&Ff(p.value)&&(m=p.name,!ui(m)||m.substring(0,10)!=="_ngcontent"&&m.substring(0,7)!=="_nghost")){var v=p.value;p.name==="class"&&(v=BL(v).join(" ")),o["attr__"+p.name]=O2(1024,v)}});for(var l=1,u=1,h=e;h=this._previousElementSibling(h);)l++,h.tagName===e.tagName&&u++;return o.nth_child=l,o.nth_of_type=u,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return Qe(e.target)?e.srcElement||null:(t=e.target)!==null&&t!==void 0&&t.shadowRoot?e.composedPath()[0]||null:e.target||null;var t}},{key:"_captureEvent",value:function(e){var t=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"$autocapture";if(this.isEnabled){var i,s=this._getEventTarget(e);bJ(s)&&(s=s.parentNode||null),r==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(i=this.rageclicks)!==null&&i!==void 0&&i.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._captureEvent(e,"$rageclick");var o=r===M2;if(s&&rAe(s,e,this.config,o,o?["copy","cut"]:void 0)){for(var a,c,l=[s],u=s;u.parentNode&&!Wl(u,"body");)SJ(u.parentNode)?(l.push(u.parentNode.host),u=u.parentNode.host):(l.push(u.parentNode),u=u.parentNode);var h,p,m=[],v={},g=!1;if(an(l,function(D){var F=fx(D);D.tagName.toLowerCase()==="a"&&(h=D.getAttribute("href"),h=F&&Ff(h)&&h),Tt(RS(D),"ph-no-capture")&&(g=!0),m.push(t._getPropertiesFromElement(D,t.instance.config.mask_all_element_attributes,t.instance.config.mask_all_text));var U=t._getAugmentPropertiesFromElement(D);bi(v,U)}),this.instance.config.mask_all_text||(s.tagName.toLowerCase()==="a"||s.tagName.toLowerCase()==="button"?m[0].$el_text=gD(s):m[0].$el_text=kS(s)),h){var S,b;m[0].attr__href=h;var R=(S=qg(h))===null||S===void 0?void 0:S.host,k=ae==null||(b=ae.location)===null||b===void 0?void 0:b.host;R&&k&&R!==k&&(p=h)}if(g)return!1;var I=bi(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:cAe(m)}:{$elements:m},(a=m[0])!==null&&a!==void 0&&a.$el_text?{$el_text:(c=m[0])===null||c===void 0?void 0:c.$el_text}:{},p&&e.type==="click"?{$external_click_url:p}:{},v),T=this.getElementSelectors(s);if(T&&T.length>0&&(I.$element_selectors=T),r===M2){var C,P=_J(ae==null||(C=ae.getSelection())===null||C===void 0?void 0:C.toString()),M=e.type||"clipboard";if(!P)return!1;I.$selected_content=P,I.$copy_type=M}return this.instance.capture(r,I),!0}}}},{key:"isBrowserSupported",value:function(){return Ys(Ke==null?void 0:Ke.querySelectorAll)}}]),n}(),YAe=function(){function n(e){var t=this;Bt(this,n),me(this,"_restoreXHRPatch",void 0),me(this,"_restoreFetchPatch",void 0),me(this,"_startCapturing",function(){Qe(t._restoreXHRPatch)&&Cn.postHogTracingHeadersPatchFns._patchXHR(t.instance.sessionManager),Qe(t._restoreFetchPatch)&&Cn.postHogTracingHeadersPatchFns._patchFetch(t.instance.sessionManager)}),this.instance=e}return Ht(n,[{key:"_loadScript",value:function(e){Cn.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(Bs.LIB_VERSION),function(t){if(t)return ye.error("[TRACING-HEADERS] failed to load script",t);e()})}},{key:"startIfEnabledOrStop",value:function(){var e,t;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):((e=this._restoreXHRPatch)===null||e===void 0||e.call(this),(t=this._restoreFetchPatch)===null||t===void 0||t.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),n}();(function(n){n[n.PENDING=-1]="PENDING",n[n.DENIED=0]="DENIED",n[n.GRANTED=1]="GRANTED"})(kl||(kl={}));var XAe=function(){function n(e){Bt(this,n),this.instance=e}return Ht(n,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?kl.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===kl.DENIED||this.consent===kl.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,t=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+t}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return e==="1"?kl.GRANTED:e==="0"?kl.DENIED:kl.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage=e==="localStorage"?gr:xc;var t=e==="localStorage"?xc:gr;t.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut(t.get(this.storageKey)==="1"),t.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!tJ([jo==null?void 0:jo.doNotTrack,jo==null?void 0:jo.msDoNotTrack,Cn.doNotTrack],function(e){return Tt([!0,1,"1","yes"],e)})}}]),n}(),K1="[Exception Autocapture]",JAe=function(){function n(e){var t,r=this;Bt(this,n),me(this,"originalOnUnhandledRejectionHandler",void 0),me(this,"startCapturing",function(){if(ae&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var i=ae.posthogErrorWrappingFunctions.wrapOnError,s=ae.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(i&&s)try{r.unwrapOnError=i(r.captureException.bind(r)),r.unwrapUnhandledRejection=s(r.captureException.bind(r))}catch(o){ye.error(K1+" failed to start",o),r.stopCapturing()}else ye.error(K1+" failed to load error wrapping functions - cannot start")}}),this.instance=e,this.remoteEnabled=!((t=this.instance.persistence)===null||t===void 0||!t.props[J7]),this.startIfEnabled()}return Ht(n,[{key:"isEnabled",get:function(){var e;return(e=this.remoteEnabled)!==null&&e!==void 0&&e}},{key:"isCapturing",get:function(){var e;return!(ae==null||(e=ae.onerror)===null||e===void 0||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(ye.info(K1+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(Bs.LIB_VERSION),function(t){if(t)return ye.error(K1+" failed to load script",t);e()})}},{key:"stopCapturing",value:function(){var e,t;(e=this.unwrapOnError)===null||e===void 0||e.call(this),(t=this.unwrapUnhandledRejection)===null||t===void 0||t.call(this)}},{key:"afterDecideResponse",value:function(e){var t=e.autocaptureExceptions;this.remoteEnabled=!!t||!1,this.instance.persistence&&this.instance.persistence.register(me({},J7,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var t=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(t,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),n}(),LD=9e5,Gu="[Web Vitals]",ZAe=function(){function n(e){var t,r=this;Bt(this,n),me(this,"_enabledServerSide",!1),me(this,"_initialized",!1),me(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),me(this,"_flushToCapture",function(){clearTimeout(r._delayedFlushTimer),r.buffer.metrics.length!==0&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce(function(i,s){var o;return Ue(Ue({},i),{},(me(o={},"$web_vitals_".concat(s.name,"_event"),Ue({},s)),me(o,"$web_vitals_".concat(s.name,"_value"),s.value),o))},{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})}),me(this,"_addToBuffer",function(i){var s,o=(s=r.instance.sessionManager)===null||s===void 0?void 0:s.checkAndGetSessionAndWindowId(!0);if(Qe(o))ye.error(Gu+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=r._currentURL();Qe(a)||(es(i==null?void 0:i.name)||es(i==null?void 0:i.value)?ye.error(Gu+"Invalid metric received",i):r._maxAllowedValue&&i.value>=r._maxAllowedValue?ye.error(Gu+"Ignoring metric with value >= "+r._maxAllowedValue,i):(r.buffer.url!==a&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),Qe(r.buffer.url)&&(r.buffer.url=a),r.buffer.firstMetricTimestamp=Qe(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push(Ue(Ue({},i),{},{$current_url:a,$session_id:o.sessionId,$window_id:o.windowId,timestamp:Date.now()})),r.buffer.metrics.length===4&&r._flushToCapture()))}}),me(this,"_startCapturing",function(){var i=Cn.postHogWebVitalsCallbacks,s=i.onLCP,o=i.onCLS,a=i.onFCP,c=i.onINP;s&&o&&a&&c?(s(r._addToBuffer),o(r._addToBuffer),a(r._addToBuffer),c(r._addToBuffer),r._initialized=!0):ye.error(Gu+"web vitals callbacks not loaded - not starting")}),this.instance=e,this._enabledServerSide=!((t=this.instance.persistence)===null||t===void 0||!t.props[Q7]),this.startIfEnabled()}return Ht(n,[{key:"_maxAllowedValue",get:function(){var e=zr(this.instance.config.capture_performance)&&Hs(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:LD;return 0<e&&e<=6e4?LD:e}},{key:"isEnabled",get:function(){var e=zr(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return od(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(ye.info(Gu+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var t=zr(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(me({},Q7,t)),this._enabledServerSide=t,this.startIfEnabled()}},{key:"loadScript",value:function(e){ae.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(Bs.LIB_VERSION),function(t){t?ye.error(Gu+" failed to load script",t):e()})}},{key:"_currentURL",value:function(){var e=ae?ae.location.href:void 0;return e||ye.error(Gu+"Could not determine current URL"),e}}]),n}(),AD="/e/",QAe=function(){function n(e){var t;Bt(this,n),this.instance=e,this._endpointSuffix=((t=this.instance.persistence)===null||t===void 0?void 0:t.props[Z7])||AD}return Ht(n,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var t=e.autocaptureExceptions;this._endpointSuffix=zr(t)&&t.endpoint||AD,this.instance.persistence&&this.instance.persistence.register(me({},Z7,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),n}(),zg={},MD=function(){},sf="posthog",DJ=!PAe&&(Rr==null?void 0:Rr.indexOf("MSIE"))===-1&&(Rr==null?void 0:Rr.indexOf("Mozilla"))===-1,OD=function(){var n,e,t;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(e=Ke==null?void 0:Ke.location,t=e==null?void 0:e.hostname,!!ui(t)&&t.split(".").slice(-2).join(".")!=="herokuapp.com"),persistence:"localStorage+cookie",persistence_name:"",loaded:MD,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:Hi&&ui(Hi==null?void 0:Hi.search)&&Hi.search.indexOf("__posthog_debug=true")!==-1||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:(ae==null||(n=ae.location)===null||n===void 0?void 0:n.protocol)==="https:",ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(r){var i="Bad HTTP status: "+r.statusCode+" "+r.text;ye.error(i)},get_device_id:function(r){return r},_onCapture:MD,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},ND=function(n){var e={};Qe(n.process_person)||(e.person_profiles=n.process_person),Qe(n.xhr_headers)||(e.request_headers=n.xhr_headers),Qe(n.cookie_name)||(e.persistence_name=n.cookie_name),Qe(n.disable_cookie)||(e.disable_persistence=n.disable_cookie);var t=bi({},e,n);return vr(n.property_blacklist)&&(Qe(n.property_denylist)?t.property_denylist=n.property_blacklist:vr(n.property_denylist)?t.property_denylist=[].concat(kc(n.property_blacklist),kc(n.property_denylist)):ye.error("Invalid value for property_denylist config: "+n.property_denylist)),t},eMe=function(){function n(){Bt(this,n),me(this,"__forceAllowLocalhost",!1)}return Ht(n,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){ye.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),n}(),FJ=function(){function n(){var e=this;Bt(this,n),me(this,"webPerformance",new eMe),me(this,"version",Bs.LIB_VERSION),me(this,"_internalEventEmitter",new OJ),this.config=OD(),this.decideEndpointWasHit=!1,this.SentryIntegration=DAe,this.sentryIntegration=function(t){return function(r,i){var s=MJ(r,i);return{name:AJ,processEvent:function(o){return s(o)}}}(e,t)},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new A4e(this),this.toolbar=new bAe(this),this.scrollManager=new WAe(this),this.pageViewManager=new UAe(this),this.surveys=new BAe(this),this.exceptions=new QAe(this),this.rateLimiter=new HAe(this),this.requestRouter=new NAe(this),this.consent=new XAe(this),this.people={set:function(t,r,i){var s=ui(t)?me({},t,r):t;e.setPersonProperties(s),i==null||i({})},set_once:function(t,r,i){var s=ui(t)?me({},t,r):t;e.setPersonProperties(void 0,s),i==null||i({})}},this.on("eventCaptured",function(t){return ye.info("send",t)})}return Ht(n,[{key:"init",value:function(e,t,r){if(r&&r!==sf){var i,s=(i=zg[r])!==null&&i!==void 0?i:new n;return s._init(e,t,r),zg[r]=s,zg[sf][r]=s,s}return this._init(e,t,r)}},{key:"_init",value:function(e){var t,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(Qe(e)||G7(e))return ye.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return ye.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(bi({},OD(),ND(s),{name:o,token:e})),this.config.on_xhr_error&&ye.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=s.disable_compression?void 0:Do.GZipJS,this.persistence=new x2(this.config),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new x2(Ue(Ue({},this.config),{},{persistence:"sessionStorage"}));var a=Ue({},this.persistence.props),c=Ue({},this.sessionPersistence.props);if(this._requestQueue=new SAe(function(R){return i._send_retriable_request(R)}),this._retryQueue=new MAe(this),this.__request_queue=[],this.sessionManager=new OAe(this.config,this.persistence),this.sessionPropsManager=new GAe(this.sessionManager,this.persistence),new YAe(this).startIfEnabledOrStop(),this.sessionRecording=new vAe(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new zAe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new KAe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new ZAe(this),this.exceptionObserver=new JAe(this),this.exceptionObserver.startIfEnabled(),Bs.DEBUG=Bs.DEBUG||this.config.debug,Bs.DEBUG&&ye.info("Starting in debug mode",{this:this,config:s,thisC:Ue({},this.config),p:a,s:c}),this._sync_opt_out_with_persistence(),((t=s.bootstrap)===null||t===void 0?void 0:t.distinctID)!==void 0){var l,u,h=this.config.get_device_id(Dl()),p=(l=s.bootstrap)!==null&&l!==void 0&&l.isIdentifiedID?h:s.bootstrap.distinctID;this.persistence.set_property(oc,(u=s.bootstrap)!==null&&u!==void 0&&u.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:s.bootstrap.distinctID,$device_id:p})}if(this._hasBootstrappedFeatureFlags()){var m,v,g=Object.keys(((m=s.bootstrap)===null||m===void 0?void 0:m.featureFlags)||{}).filter(function(R){var k,I;return!((k=s.bootstrap)===null||k===void 0||(I=k.featureFlags)===null||I===void 0||!I[R])}).reduce(function(R,k){var I,T;return R[k]=((I=s.bootstrap)===null||I===void 0||(T=I.featureFlags)===null||T===void 0?void 0:T[k])||!1,R},{}),S=Object.keys(((v=s.bootstrap)===null||v===void 0?void 0:v.featureFlagPayloads)||{}).filter(function(R){return g[R]}).reduce(function(R,k){var I,T,C,P;return(I=s.bootstrap)!==null&&I!==void 0&&(T=I.featureFlagPayloads)!==null&&T!==void 0&&T[k]&&(R[k]=(C=s.bootstrap)===null||C===void 0||(P=C.featureFlagPayloads)===null||P===void 0?void 0:P[k]),R},{});this.featureFlags.receivedFeatureFlags({featureFlags:g,featureFlagPayloads:S})}if(!this.get_distinct_id()){var b=this.config.get_device_id(Dl());this.register_once({distinct_id:b,$device_id:b},""),this.persistence.set_property(oc,"anonymous")}return ae==null||(r=ae.addEventListener)===null||r===void 0||r.call(ae,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),s.segment?FAe(this,function(){return i._loaded()}):this._loaded(),Ys(this.config._onCapture)&&this.on("eventCaptured",function(R){return i.config._onCapture(R.event,R)}),this}},{key:"_afterDecideResponse",value:function(e){var t,r,i,s,o,a,c,l;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=Tt(e.supportedCompression,Do.GZipJS)?Do.GZipJS:Tt(e.supportedCompression,Do.Base64)?Do.Base64:void 0),(t=e.analytics)!==null&&t!==void 0&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),(r=this.sessionRecording)===null||r===void 0||r.afterDecideResponse(e),(i=this.autocapture)===null||i===void 0||i.afterDecideResponse(e),(s=this.heatmaps)===null||s===void 0||s.afterDecideResponse(e),(o=this.surveys)===null||o===void 0||o.afterDecideResponse(e),(a=this.webVitalsAutocapture)===null||a===void 0||a.afterDecideResponse(e),(c=this.exceptions)===null||c===void 0||c.afterDecideResponse(e),(l=this.exceptionObserver)===null||l===void 0||l.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,t=this.config.advanced_disable_decide;t||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(r){ye.critical("`loaded` function failed",r)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout(function(){e.consent.isOptedIn()&&e._captureInitialPageview()},1),t||(new yAe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&((e=this._requestQueue)===null||e===void 0||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||Of(this.__request_queue,function(t){return e._send_retriable_request(t)}),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,t;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),(e=this._requestQueue)===null||e===void 0||e.unload(),(t=this._retryQueue)===null||t===void 0||t.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var t=this;this.__loaded&&(DJ?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=PS(e.url,{ip:this.config.ip?1:0}),e.headers=Ue({},this.config.request_headers),e.compression=e.compression==="best-available"?this.compression:e.compression,function(r){var i,s,o,a=Ue({},r);a.timeout=a.timeout||6e4,a.url=PS(a.url,{_:new Date().getTime().toString(),ver:Bs.LIB_VERSION,compression:a.compression});var c=(i=a.transport)!==null&&i!==void 0?i:"XHR",l=(s=(o=tJ(Wg,function(u){return u.transport===c}))===null||o===void 0?void 0:o.method)!==null&&s!==void 0?s:Wg[0].method;if(!l)throw new Error("No available transport method");l(a)}(Ue(Ue({},e),{},{callback:function(r){var i,s,o;t.rateLimiter.checkForLimiting(r),r.statusCode>=400&&((s=(o=t.config).on_request_error)===null||s===void 0||s.call(o,r)),(i=e.callback)===null||i===void 0||i.call(e,r)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var t,r=this,i=[],s=[],o=[];Of(e,function(c){c&&(t=c[0],vr(t)?o.push(c):Ys(c)?c.call(r):vr(c)&&t==="alias"?i.push(c):vr(c)&&t.indexOf("capture")!==-1&&Ys(r[t])?o.push(c):s.push(c))});var a=function(c,l){Of(c,function(u){if(vr(u[0])){var h=l;an(u,function(p){h=h[p[0]].apply(h,p.slice(1))})}else this[u[0]].apply(this,u.slice(1))},l)};a(i,this),a(s,this),a(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,t;return((e=this.config.bootstrap)===null||e===void 0?void 0:e.featureFlags)&&Object.keys((t=this.config.bootstrap)===null||t===void 0?void 0:t.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,t,r){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!Qe(e)&&ui(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var s=r!=null&&r.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(s==null||!s.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,a=(r==null?void 0:r.timestamp)||o,c={uuid:Dl(),event:e,properties:this._calculate_event_properties(e,t||{},a)};s&&(c.properties.$lib_rate_limit_remaining_tokens=s.remainingTokens),r!=null&&r.$set&&(c.$set=r==null?void 0:r.$set);var l=this._calculate_set_once_properties(r==null?void 0:r.$set_once);l&&(c.$set_once=l),(c=x4e(c,r!=null&&r._noTruncate?null:this.config.properties_string_max_length)).timestamp=a,Qe(r==null?void 0:r.timestamp)||(c.properties.$event_time_override_provided=!0,c.properties.$event_time_override_system_time=o);var u=Ue(Ue({},c.properties.$set),c.$set);ob(u)||this.setPersonPropertiesForFlags(u),this._internalEventEmitter.emit("eventCaptured",c);var h={method:"POST",url:(i=r==null?void 0:r._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:c,compression:"best-available",batchKey:r==null?void 0:r._batchKey};return!this.config.request_batching||r&&(r==null||!r._batchKey)||r!=null&&r.send_instantly?this._send_retriable_request(h):this._requestQueue.enqueue(h),c}ye.critical("This capture call is ignored due to client rate limiting.")}}else ye.error("No event name provided to posthog.capture")}else ye.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",function(t){return e(t.event,t)})}},{key:"_calculate_event_properties",value:function(e,t,r){if(r=r||new Date,!this.persistence||!this.sessionPersistence)return t;var i=this.persistence.remove_event_timer(e),s=Ue({},t);if(s.token=this.config.token,e==="$snapshot"){var o=Ue(Ue({},this.persistence.properties()),this.sessionPersistence.properties());return s.distinct_id=o.distinct_id,(!ui(s.distinct_id)&&!Hs(s.distinct_id)||G7(s.distinct_id))&&ye.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),s}var a=kr.properties();if(this.sessionManager){var c=this.sessionManager.checkAndGetSessionAndWindowId(),l=c.sessionId,u=c.windowId;s.$session_id=l,s.$window_id=u}if(this.requestRouter.region===ad.CUSTOM&&(s.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&(e==="$pageview"||e==="$pageleave"||e==="$autocapture")){var h=this.sessionPropsManager.getSessionProps();s=bi(s,h)}if(!this.config.disable_scroll_properties){var p={};e==="$pageview"?p=this.pageViewManager.doPageView(r):e==="$pageleave"&&(p=this.pageViewManager.doPageLeave(r)),s=bi(s,p)}if(e==="$pageview"&&Ke&&(s.title=Ke.title),!Qe(i)){var m=r.getTime()-i;s.$duration=parseFloat((m/1e3).toFixed(3))}Rr&&this.config.opt_out_useragent_filter&&(s.$browser_type=this._is_bot()?"bot":"browser"),(s=bi({},a,this.persistence.properties(),this.sessionPersistence.properties(),s)).$is_identified=this._isIdentified(),vr(this.config.property_denylist)?an(this.config.property_denylist,function(g){delete s[g]}):ye.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var v=this.config.sanitize_properties;return v&&(s=v(s,e)),s.$process_person_profile=this._hasPersonProcessing(),s}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var t=bi({},this.persistence.get_initial_props(),e||{});return ob(t)?void 0:t}},{key:"register",value:function(e,t){var r;(r=this.persistence)===null||r===void 0||r.register(e,t)}},{key:"register_once",value:function(e,t,r){var i;(i=this.persistence)===null||i===void 0||i.register_once(e,t,r)}},{key:"register_for_session",value:function(e){var t;(t=this.sessionPersistence)===null||t===void 0||t.register(e)}},{key:"unregister",value:function(e){var t;(t=this.persistence)===null||t===void 0||t.unregister(e)}},{key:"unregister_for_session",value:function(e){var t;(t=this.sessionPersistence)===null||t===void 0||t.unregister(e)}},{key:"_register_single",value:function(e,t){this.register(me({},e,t))}},{key:"getFeatureFlag",value:function(e,t){return this.featureFlags.getFeatureFlag(e,t)}},{key:"getFeatureFlagPayload",value:function(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch{return t}}},{key:"isFeatureEnabled",value:function(e,t){return this.featureFlags.isFeatureEnabled(e,t)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,t){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t)}},{key:"getEarlyAccessFeatures",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,t)}},{key:"on",value:function(e,t){return this._internalEventEmitter.on(e,t)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var t,r;return(t=(r=this.sessionManager)===null||r===void 0?void 0:r.onSessionId(e))!==null&&t!==void 0?t:function(){}}},{key:"getSurveys",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getSurveys(e,t)}},{key:"getActiveMatchingSurveys",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getActiveMatchingSurveys(e,t)}},{key:"renderSurvey",value:function(e,t){this.surveys.renderSurvey(e,t)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,t,r){return this.surveys.getNextSurveyStep(e,t,r)}},{key:"identify",value:function(e,t,r){if(!this.__loaded||!this.persistence)return ye.uninitializedWarning("posthog.identify");if(Hs(e)&&(e=e.toString(),ye.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))ye.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var s=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:s},"")}e!==i&&e!==this.get_property(_g)&&(this.unregister(_g),this.register({distinct_id:e}));var o=(this.persistence.get_property(oc)||"anonymous")==="anonymous";e!==i&&o?(this.persistence.set_property(oc,"identified"),this.setPersonPropertiesForFlags(t||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:t||{},$set_once:r||{}}),this.featureFlags.setAnonymousDistinctId(i)):(t||r)&&this.setPersonProperties(t,r),e!==i&&(this.reloadFeatureFlags(),this.unregister(wS))}}else ye.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,t){(e||t)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:t||{}}))}},{key:"group",value:function(e,t,r){if(e&&t){if(this._requirePersonProcessing("posthog.group")){var i=this.getGroups();i[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:Ue(Ue({},i),{},me({},e,t))}),r&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:r}),this.setGroupPropertiesForFlags(me({},e,r))),i[e]===t||r||this.reloadFeatureFlags()}}else ye.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,t)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var t,r,i,s;if(ye.info("reset"),!this.__loaded)return ye.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),(t=this.persistence)===null||t===void 0||t.clear(),(r=this.sessionPersistence)===null||r===void 0||r.clear(),(i=this.persistence)===null||i===void 0||i.set_property(oc,"anonymous"),(s=this.sessionManager)===null||s===void 0||s.resetSessionId();var a=this.config.get_device_id(Dl());this.register_once({distinct_id:a,$device_id:e?a:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,t;return(e=(t=this.sessionManager)===null||t===void 0?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var t=this.sessionManager.checkAndGetSessionAndWindowId(!0),r=t.sessionId,i=t.sessionStartTimestamp,s=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(r));if(e!=null&&e.withTimestamp&&i){var o,a=(o=e.timestampLookBack)!==null&&o!==void 0?o:10;if(!i)return s;var c=Math.max(Math.floor((new Date().getTime()-i)/1e3)-a,0);s+="?t=".concat(c)}return s}},{key:"alias",value:function(e,t){return e===this.get_property(nJ)?(ye.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(Qe(t)&&(t=this.get_distinct_id()),e!==t?(this._register_single(_g,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(ye.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var t,r,i,s,o=Ue({},this.config);zr(e)&&(bi(this.config,ND(e)),(t=this.persistence)===null||t===void 0||t.update_config(this.config,o),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new x2(Ue(Ue({},this.config),{},{persistence:"sessionStorage"})),gr.is_supported()&&gr.get("ph_debug")==="true"&&(this.config.debug=!0),this.config.debug&&(Bs.DEBUG=!0,ye.info("set_config",{config:e,oldConfig:o,newConfig:Ue({},this.config)})),(r=this.sessionRecording)===null||r===void 0||r.startIfEnabledOrStop(),(i=this.autocapture)===null||i===void 0||i.startIfEnabled(),(s=this.heatmaps)===null||s===void 0||s.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var t,r=od(e)&&e;if(r||e!=null&&e.sampling){var i,s,o=(i=this.sessionManager)===null||i===void 0?void 0:i.checkAndGetSessionAndWindowId();(s=this.persistence)===null||s===void 0||s.register(me({},Gg,!0)),ye.info("Session recording started with sampling override for session: ",o==null?void 0:o.sessionId)}(r||e!=null&&e.linked_flag)&&((t=this.sessionRecording)===null||t===void 0||t.overrideLinkedFlag(),ye.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!((e=this.sessionRecording)===null||e===void 0||!e.started)}},{key:"captureException",value:function(e,t){var r=Ys(Cn.parseErrorAsProperties)?Cn.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):Ue({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},t);this.exceptions.sendExceptionEvent(r)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var t;return(t=this.persistence)===null||t===void 0?void 0:t.props[e]}},{key:"getSessionProperty",value:function(e){var t;return(t=this.sessionPersistence)===null||t===void 0?void 0:t.props[e]}},{key:"toString",value:function(){var e,t=(e=this.config.name)!==null&&e!==void 0?e:sf;return t!==sf&&(t=sf+"."+t),t}},{key:"_isIdentified",value:function(){var e,t;return((e=this.persistence)===null||e===void 0?void 0:e.get_property(oc))==="identified"||((t=this.sessionPersistence)===null||t===void 0?void 0:t.get_property(oc))==="identified"}},{key:"_hasPersonProcessing",value:function(){var e,t,r,i;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&ob(this.getGroups())&&((e=this.persistence)===null||e===void 0||(t=e.props)===null||t===void 0||!t[_g])&&((r=this.persistence)===null||r===void 0||(i=r.props)===null||i===void 0||!i[ES]))}},{key:"_shouldCapturePageleave",value:function(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return this.config.person_profiles==="never"?(ye.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(ES,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,t,r,i,s=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,a=this.config.disable_persistence||s&&!!o;((e=this.persistence)===null||e===void 0?void 0:e.disabled)!==a&&((r=this.persistence)===null||r===void 0||r.set_disabled(a)),((t=this.sessionPersistence)===null||t===void 0?void 0:t.disabled)!==a&&((i=this.sessionPersistence)===null||i===void 0||i.set_disabled(a))}},{key:"opt_in_capturing",value:function(e){var t;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(Qe(e==null?void 0:e.captureEventName)||e!=null&&e.captureEventName)&&this.capture((t=e==null?void 0:e.captureEventName)!==null&&t!==void 0?t:"$opt_in",e==null?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return jo?function(e,t){if(!e)return!1;var r=e.userAgent;if(r&&xD(r,t))return!0;try{var i=e==null?void 0:e.userAgentData;if(i!=null&&i.brands&&i.brands.some(function(s){return xD(s==null?void 0:s.brand,t)}))return!0}catch{}return!!e.webdriver}(jo,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){Ke&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:Ke.title},{send_instantly:!0}))}},{key:"debug",value:function(e){e===!1?(ae==null||ae.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(ae==null||ae.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),n}();(function(n,e){for(var t=0;t<e.length;t++)n.prototype[e[t]]=k4e(n.prototype[e[t]])})(FJ,["identify"]);var DD,tMe=(DD=zg[sf]=new FJ,function(){function n(){n.done||(n.done=!0,DJ=!1,an(zg,function(e){e._dom_loaded()}))}Ke!=null&&Ke.addEventListener&&(Ke.readyState==="complete"?n():Ke.addEventListener("DOMContentLoaded",n,!1)),ae&&mc(ae,"load",n,!0)}(),DD),N2={},ng={},FD;function nMe(){if(FD)return ng;FD=1,ng.byteLength=a,ng.toByteArray=l,ng.fromByteArray=p;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=r.length;i<s;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function o(m){var v=m.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=m.indexOf("=");g===-1&&(g=v);var S=g===v?0:4-g%4;return[g,S]}function a(m){var v=o(m),g=v[0],S=v[1];return(g+S)*3/4-S}function c(m,v,g){return(v+g)*3/4-g}function l(m){var v,g=o(m),S=g[0],b=g[1],R=new t(c(m,S,b)),k=0,I=b>0?S-4:S,T;for(T=0;T<I;T+=4)v=e[m.charCodeAt(T)]<<18|e[m.charCodeAt(T+1)]<<12|e[m.charCodeAt(T+2)]<<6|e[m.charCodeAt(T+3)],R[k++]=v>>16&255,R[k++]=v>>8&255,R[k++]=v&255;return b===2&&(v=e[m.charCodeAt(T)]<<2|e[m.charCodeAt(T+1)]>>4,R[k++]=v&255),b===1&&(v=e[m.charCodeAt(T)]<<10|e[m.charCodeAt(T+1)]<<4|e[m.charCodeAt(T+2)]>>2,R[k++]=v>>8&255,R[k++]=v&255),R}function u(m){return n[m>>18&63]+n[m>>12&63]+n[m>>6&63]+n[m&63]}function h(m,v,g){for(var S,b=[],R=v;R<g;R+=3)S=(m[R]<<16&16711680)+(m[R+1]<<8&65280)+(m[R+2]&255),b.push(u(S));return b.join("")}function p(m){for(var v,g=m.length,S=g%3,b=[],R=16383,k=0,I=g-S;k<I;k+=R)b.push(h(m,k,k+R>I?I:k+R));return S===1?(v=m[g-1],b.push(n[v>>2]+n[v<<4&63]+"==")):S===2&&(v=(m[g-2]<<8)+m[g-1],b.push(n[v>>10]+n[v>>4&63]+n[v<<2&63]+"=")),b.join("")}return ng}var W1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var UD;function rMe(){return UD||(UD=1,W1.read=function(n,e,t,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=t?i-1:0,p=t?-1:1,m=n[e+h];for(h+=p,s=m&(1<<-u)-1,m>>=-u,u+=a;u>0;s=s*256+n[e+h],h+=p,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+n[e+h],h+=p,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(m?-1:1)*o*Math.pow(2,s-r)},W1.write=function(n,e,t,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:s-1,v=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;n[t+m]=a&255,m+=v,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;n[t+m]=o&255,m+=v,o/=256,l-=8);n[t+m-v]|=g*128}),W1}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var jD;function iMe(){return jD||(jD=1,function(n){const e=nMe(),t=rMe(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=R,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const $=new Uint8Array(1),L={foo:function(){return 42}};return Object.setPrototypeOf(L,Uint8Array.prototype),Object.setPrototypeOf($,L),$.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o($){if($>i)throw new RangeError('The value "'+$+'" is invalid for option "size"');const L=new Uint8Array($);return Object.setPrototypeOf(L,a.prototype),L}function a($,L,N){if(typeof $=="number"){if(typeof L=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return h($)}return c($,L,N)}a.poolSize=8192;function c($,L,N){if(typeof $=="string")return p($,L);if(ArrayBuffer.isView($))return v($);if($==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $);if(br($,ArrayBuffer)||$&&br($.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(br($,SharedArrayBuffer)||$&&br($.buffer,SharedArrayBuffer)))return g($,L,N);if(typeof $=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const W=$.valueOf&&$.valueOf();if(W!=null&&W!==$)return a.from(W,L,N);const ne=S($);if(ne)return ne;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof $[Symbol.toPrimitive]=="function")return a.from($[Symbol.toPrimitive]("string"),L,N);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $)}a.from=function($,L,N){return c($,L,N)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l($){if(typeof $!="number")throw new TypeError('"size" argument must be of type number');if($<0)throw new RangeError('The value "'+$+'" is invalid for option "size"')}function u($,L,N){return l($),$<=0?o($):L!==void 0?typeof N=="string"?o($).fill(L,N):o($).fill(L):o($)}a.alloc=function($,L,N){return u($,L,N)};function h($){return l($),o($<0?0:b($)|0)}a.allocUnsafe=function($){return h($)},a.allocUnsafeSlow=function($){return h($)};function p($,L){if((typeof L!="string"||L==="")&&(L="utf8"),!a.isEncoding(L))throw new TypeError("Unknown encoding: "+L);const N=k($,L)|0;let W=o(N);const ne=W.write($,L);return ne!==N&&(W=W.slice(0,ne)),W}function m($){const L=$.length<0?0:b($.length)|0,N=o(L);for(let W=0;W<L;W+=1)N[W]=$[W]&255;return N}function v($){if(br($,Uint8Array)){const L=new Uint8Array($);return g(L.buffer,L.byteOffset,L.byteLength)}return m($)}function g($,L,N){if(L<0||$.byteLength<L)throw new RangeError('"offset" is outside of buffer bounds');if($.byteLength<L+(N||0))throw new RangeError('"length" is outside of buffer bounds');let W;return L===void 0&&N===void 0?W=new Uint8Array($):N===void 0?W=new Uint8Array($,L):W=new Uint8Array($,L,N),Object.setPrototypeOf(W,a.prototype),W}function S($){if(a.isBuffer($)){const L=b($.length)|0,N=o(L);return N.length===0||$.copy(N,0,0,L),N}if($.length!==void 0)return typeof $.length!="number"||ki($.length)?o(0):m($);if($.type==="Buffer"&&Array.isArray($.data))return m($.data)}function b($){if($>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return $|0}function R($){return+$!=$&&($=0),a.alloc(+$)}a.isBuffer=function(L){return L!=null&&L._isBuffer===!0&&L!==a.prototype},a.compare=function(L,N){if(br(L,Uint8Array)&&(L=a.from(L,L.offset,L.byteLength)),br(N,Uint8Array)&&(N=a.from(N,N.offset,N.byteLength)),!a.isBuffer(L)||!a.isBuffer(N))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(L===N)return 0;let W=L.length,ne=N.length;for(let ce=0,ge=Math.min(W,ne);ce<ge;++ce)if(L[ce]!==N[ce]){W=L[ce],ne=N[ce];break}return W<ne?-1:ne<W?1:0},a.isEncoding=function(L){switch(String(L).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(L,N){if(!Array.isArray(L))throw new TypeError('"list" argument must be an Array of Buffers');if(L.length===0)return a.alloc(0);let W;if(N===void 0)for(N=0,W=0;W<L.length;++W)N+=L[W].length;const ne=a.allocUnsafe(N);let ce=0;for(W=0;W<L.length;++W){let ge=L[W];if(br(ge,Uint8Array))ce+ge.length>ne.length?(a.isBuffer(ge)||(ge=a.from(ge)),ge.copy(ne,ce)):Uint8Array.prototype.set.call(ne,ge,ce);else if(a.isBuffer(ge))ge.copy(ne,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=ge.length}return ne};function k($,L){if(a.isBuffer($))return $.length;if(ArrayBuffer.isView($)||br($,ArrayBuffer))return $.byteLength;if(typeof $!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof $);const N=$.length,W=arguments.length>2&&arguments[2]===!0;if(!W&&N===0)return 0;let ne=!1;for(;;)switch(L){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":return Qn($).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N*2;case"hex":return N>>>1;case"base64":return Dr($).length;default:if(ne)return W?-1:Qn($).length;L=(""+L).toLowerCase(),ne=!0}}a.byteLength=k;function I($,L,N){let W=!1;if((L===void 0||L<0)&&(L=0),L>this.length||((N===void 0||N>this.length)&&(N=this.length),N<=0)||(N>>>=0,L>>>=0,N<=L))return"";for($||($="utf8");;)switch($){case"hex":return K(this,L,N);case"utf8":case"utf-8":return z(this,L,N);case"ascii":return Y(this,L,N);case"latin1":case"binary":return G(this,L,N);case"base64":return V(this,L,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ee(this,L,N);default:if(W)throw new TypeError("Unknown encoding: "+$);$=($+"").toLowerCase(),W=!0}}a.prototype._isBuffer=!0;function T($,L,N){const W=$[L];$[L]=$[N],$[N]=W}a.prototype.swap16=function(){const L=this.length;if(L%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let N=0;N<L;N+=2)T(this,N,N+1);return this},a.prototype.swap32=function(){const L=this.length;if(L%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let N=0;N<L;N+=4)T(this,N,N+3),T(this,N+1,N+2);return this},a.prototype.swap64=function(){const L=this.length;if(L%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let N=0;N<L;N+=8)T(this,N,N+7),T(this,N+1,N+6),T(this,N+2,N+5),T(this,N+3,N+4);return this},a.prototype.toString=function(){const L=this.length;return L===0?"":arguments.length===0?z(this,0,L):I.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(L){if(!a.isBuffer(L))throw new TypeError("Argument must be a Buffer");return this===L?!0:a.compare(this,L)===0},a.prototype.inspect=function(){let L="";const N=n.INSPECT_MAX_BYTES;return L=this.toString("hex",0,N).replace(/(.{2})/g,"$1 ").trim(),this.length>N&&(L+=" ... "),"<Buffer "+L+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(L,N,W,ne,ce){if(br(L,Uint8Array)&&(L=a.from(L,L.offset,L.byteLength)),!a.isBuffer(L))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof L);if(N===void 0&&(N=0),W===void 0&&(W=L?L.length:0),ne===void 0&&(ne=0),ce===void 0&&(ce=this.length),N<0||W>L.length||ne<0||ce>this.length)throw new RangeError("out of range index");if(ne>=ce&&N>=W)return 0;if(ne>=ce)return-1;if(N>=W)return 1;if(N>>>=0,W>>>=0,ne>>>=0,ce>>>=0,this===L)return 0;let ge=ce-ne,dt=W-N;const Zt=Math.min(ge,dt),Ft=this.slice(ne,ce),Qt=L.slice(N,W);for(let Pt=0;Pt<Zt;++Pt)if(Ft[Pt]!==Qt[Pt]){ge=Ft[Pt],dt=Qt[Pt];break}return ge<dt?-1:dt<ge?1:0};function C($,L,N,W,ne){if($.length===0)return-1;if(typeof N=="string"?(W=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,ki(N)&&(N=ne?0:$.length-1),N<0&&(N=$.length+N),N>=$.length){if(ne)return-1;N=$.length-1}else if(N<0)if(ne)N=0;else return-1;if(typeof L=="string"&&(L=a.from(L,W)),a.isBuffer(L))return L.length===0?-1:P($,L,N,W,ne);if(typeof L=="number")return L=L&255,typeof Uint8Array.prototype.indexOf=="function"?ne?Uint8Array.prototype.indexOf.call($,L,N):Uint8Array.prototype.lastIndexOf.call($,L,N):P($,[L],N,W,ne);throw new TypeError("val must be string, number or Buffer")}function P($,L,N,W,ne){let ce=1,ge=$.length,dt=L.length;if(W!==void 0&&(W=String(W).toLowerCase(),W==="ucs2"||W==="ucs-2"||W==="utf16le"||W==="utf-16le")){if($.length<2||L.length<2)return-1;ce=2,ge/=2,dt/=2,N/=2}function Zt(Qt,Pt){return ce===1?Qt[Pt]:Qt.readUInt16BE(Pt*ce)}let Ft;if(ne){let Qt=-1;for(Ft=N;Ft<ge;Ft++)if(Zt($,Ft)===Zt(L,Qt===-1?0:Ft-Qt)){if(Qt===-1&&(Qt=Ft),Ft-Qt+1===dt)return Qt*ce}else Qt!==-1&&(Ft-=Ft-Qt),Qt=-1}else for(N+dt>ge&&(N=ge-dt),Ft=N;Ft>=0;Ft--){let Qt=!0;for(let Pt=0;Pt<dt;Pt++)if(Zt($,Ft+Pt)!==Zt(L,Pt)){Qt=!1;break}if(Qt)return Ft}return-1}a.prototype.includes=function(L,N,W){return this.indexOf(L,N,W)!==-1},a.prototype.indexOf=function(L,N,W){return C(this,L,N,W,!0)},a.prototype.lastIndexOf=function(L,N,W){return C(this,L,N,W,!1)};function M($,L,N,W){N=Number(N)||0;const ne=$.length-N;W?(W=Number(W),W>ne&&(W=ne)):W=ne;const ce=L.length;W>ce/2&&(W=ce/2);let ge;for(ge=0;ge<W;++ge){const dt=parseInt(L.substr(ge*2,2),16);if(ki(dt))return ge;$[N+ge]=dt}return ge}function D($,L,N,W){return Qr(Qn(L,$.length-N),$,N,W)}function F($,L,N,W){return Qr(os(L),$,N,W)}function U($,L,N,W){return Qr(Dr(L),$,N,W)}function B($,L,N,W){return Qr(pi(L,$.length-N),$,N,W)}a.prototype.write=function(L,N,W,ne){if(N===void 0)ne="utf8",W=this.length,N=0;else if(W===void 0&&typeof N=="string")ne=N,W=this.length,N=0;else if(isFinite(N))N=N>>>0,isFinite(W)?(W=W>>>0,ne===void 0&&(ne="utf8")):(ne=W,W=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-N;if((W===void 0||W>ce)&&(W=ce),L.length>0&&(W<0||N<0)||N>this.length)throw new RangeError("Attempt to write outside buffer bounds");ne||(ne="utf8");let ge=!1;for(;;)switch(ne){case"hex":return M(this,L,N,W);case"utf8":case"utf-8":return D(this,L,N,W);case"ascii":case"latin1":case"binary":return F(this,L,N,W);case"base64":return U(this,L,N,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,L,N,W);default:if(ge)throw new TypeError("Unknown encoding: "+ne);ne=(""+ne).toLowerCase(),ge=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V($,L,N){return L===0&&N===$.length?e.fromByteArray($):e.fromByteArray($.slice(L,N))}function z($,L,N){N=Math.min($.length,N);const W=[];let ne=L;for(;ne<N;){const ce=$[ne];let ge=null,dt=ce>239?4:ce>223?3:ce>191?2:1;if(ne+dt<=N){let Zt,Ft,Qt,Pt;switch(dt){case 1:ce<128&&(ge=ce);break;case 2:Zt=$[ne+1],(Zt&192)===128&&(Pt=(ce&31)<<6|Zt&63,Pt>127&&(ge=Pt));break;case 3:Zt=$[ne+1],Ft=$[ne+2],(Zt&192)===128&&(Ft&192)===128&&(Pt=(ce&15)<<12|(Zt&63)<<6|Ft&63,Pt>2047&&(Pt<55296||Pt>57343)&&(ge=Pt));break;case 4:Zt=$[ne+1],Ft=$[ne+2],Qt=$[ne+3],(Zt&192)===128&&(Ft&192)===128&&(Qt&192)===128&&(Pt=(ce&15)<<18|(Zt&63)<<12|(Ft&63)<<6|Qt&63,Pt>65535&&Pt<1114112&&(ge=Pt))}}ge===null?(ge=65533,dt=1):ge>65535&&(ge-=65536,W.push(ge>>>10&1023|55296),ge=56320|ge&1023),W.push(ge),ne+=dt}return J(W)}const H=4096;function J($){const L=$.length;if(L<=H)return String.fromCharCode.apply(String,$);let N="",W=0;for(;W<L;)N+=String.fromCharCode.apply(String,$.slice(W,W+=H));return N}function Y($,L,N){let W="";N=Math.min($.length,N);for(let ne=L;ne<N;++ne)W+=String.fromCharCode($[ne]&127);return W}function G($,L,N){let W="";N=Math.min($.length,N);for(let ne=L;ne<N;++ne)W+=String.fromCharCode($[ne]);return W}function K($,L,N){const W=$.length;(!L||L<0)&&(L=0),(!N||N<0||N>W)&&(N=W);let ne="";for(let ce=L;ce<N;++ce)ne+=xi[$[ce]];return ne}function ee($,L,N){const W=$.slice(L,N);let ne="";for(let ce=0;ce<W.length-1;ce+=2)ne+=String.fromCharCode(W[ce]+W[ce+1]*256);return ne}a.prototype.slice=function(L,N){const W=this.length;L=~~L,N=N===void 0?W:~~N,L<0?(L+=W,L<0&&(L=0)):L>W&&(L=W),N<0?(N+=W,N<0&&(N=0)):N>W&&(N=W),N<L&&(N=L);const ne=this.subarray(L,N);return Object.setPrototypeOf(ne,a.prototype),ne};function q($,L,N){if($%1!==0||$<0)throw new RangeError("offset is not uint");if($+L>N)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(L,N,W){L=L>>>0,N=N>>>0,W||q(L,N,this.length);let ne=this[L],ce=1,ge=0;for(;++ge<N&&(ce*=256);)ne+=this[L+ge]*ce;return ne},a.prototype.readUintBE=a.prototype.readUIntBE=function(L,N,W){L=L>>>0,N=N>>>0,W||q(L,N,this.length);let ne=this[L+--N],ce=1;for(;N>0&&(ce*=256);)ne+=this[L+--N]*ce;return ne},a.prototype.readUint8=a.prototype.readUInt8=function(L,N){return L=L>>>0,N||q(L,1,this.length),this[L]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(L,N){return L=L>>>0,N||q(L,2,this.length),this[L]|this[L+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(L,N){return L=L>>>0,N||q(L,2,this.length),this[L]<<8|this[L+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(L,N){return L=L>>>0,N||q(L,4,this.length),(this[L]|this[L+1]<<8|this[L+2]<<16)+this[L+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(L,N){return L=L>>>0,N||q(L,4,this.length),this[L]*16777216+(this[L+1]<<16|this[L+2]<<8|this[L+3])},a.prototype.readBigUInt64LE=ei(function(L){L=L>>>0,Et(L,"offset");const N=this[L],W=this[L+7];(N===void 0||W===void 0)&&Be(L,this.length-8);const ne=N+this[++L]*2**8+this[++L]*2**16+this[++L]*2**24,ce=this[++L]+this[++L]*2**8+this[++L]*2**16+W*2**24;return BigInt(ne)+(BigInt(ce)<<BigInt(32))}),a.prototype.readBigUInt64BE=ei(function(L){L=L>>>0,Et(L,"offset");const N=this[L],W=this[L+7];(N===void 0||W===void 0)&&Be(L,this.length-8);const ne=N*2**24+this[++L]*2**16+this[++L]*2**8+this[++L],ce=this[++L]*2**24+this[++L]*2**16+this[++L]*2**8+W;return(BigInt(ne)<<BigInt(32))+BigInt(ce)}),a.prototype.readIntLE=function(L,N,W){L=L>>>0,N=N>>>0,W||q(L,N,this.length);let ne=this[L],ce=1,ge=0;for(;++ge<N&&(ce*=256);)ne+=this[L+ge]*ce;return ce*=128,ne>=ce&&(ne-=Math.pow(2,8*N)),ne},a.prototype.readIntBE=function(L,N,W){L=L>>>0,N=N>>>0,W||q(L,N,this.length);let ne=N,ce=1,ge=this[L+--ne];for(;ne>0&&(ce*=256);)ge+=this[L+--ne]*ce;return ce*=128,ge>=ce&&(ge-=Math.pow(2,8*N)),ge},a.prototype.readInt8=function(L,N){return L=L>>>0,N||q(L,1,this.length),this[L]&128?(255-this[L]+1)*-1:this[L]},a.prototype.readInt16LE=function(L,N){L=L>>>0,N||q(L,2,this.length);const W=this[L]|this[L+1]<<8;return W&32768?W|4294901760:W},a.prototype.readInt16BE=function(L,N){L=L>>>0,N||q(L,2,this.length);const W=this[L+1]|this[L]<<8;return W&32768?W|4294901760:W},a.prototype.readInt32LE=function(L,N){return L=L>>>0,N||q(L,4,this.length),this[L]|this[L+1]<<8|this[L+2]<<16|this[L+3]<<24},a.prototype.readInt32BE=function(L,N){return L=L>>>0,N||q(L,4,this.length),this[L]<<24|this[L+1]<<16|this[L+2]<<8|this[L+3]},a.prototype.readBigInt64LE=ei(function(L){L=L>>>0,Et(L,"offset");const N=this[L],W=this[L+7];(N===void 0||W===void 0)&&Be(L,this.length-8);const ne=this[L+4]+this[L+5]*2**8+this[L+6]*2**16+(W<<24);return(BigInt(ne)<<BigInt(32))+BigInt(N+this[++L]*2**8+this[++L]*2**16+this[++L]*2**24)}),a.prototype.readBigInt64BE=ei(function(L){L=L>>>0,Et(L,"offset");const N=this[L],W=this[L+7];(N===void 0||W===void 0)&&Be(L,this.length-8);const ne=(N<<24)+this[++L]*2**16+this[++L]*2**8+this[++L];return(BigInt(ne)<<BigInt(32))+BigInt(this[++L]*2**24+this[++L]*2**16+this[++L]*2**8+W)}),a.prototype.readFloatLE=function(L,N){return L=L>>>0,N||q(L,4,this.length),t.read(this,L,!0,23,4)},a.prototype.readFloatBE=function(L,N){return L=L>>>0,N||q(L,4,this.length),t.read(this,L,!1,23,4)},a.prototype.readDoubleLE=function(L,N){return L=L>>>0,N||q(L,8,this.length),t.read(this,L,!0,52,8)},a.prototype.readDoubleBE=function(L,N){return L=L>>>0,N||q(L,8,this.length),t.read(this,L,!1,52,8)};function Q($,L,N,W,ne,ce){if(!a.isBuffer($))throw new TypeError('"buffer" argument must be a Buffer instance');if(L>ne||L<ce)throw new RangeError('"value" argument is out of bounds');if(N+W>$.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(L,N,W,ne){if(L=+L,N=N>>>0,W=W>>>0,!ne){const dt=Math.pow(2,8*W)-1;Q(this,L,N,W,dt,0)}let ce=1,ge=0;for(this[N]=L&255;++ge<W&&(ce*=256);)this[N+ge]=L/ce&255;return N+W},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(L,N,W,ne){if(L=+L,N=N>>>0,W=W>>>0,!ne){const dt=Math.pow(2,8*W)-1;Q(this,L,N,W,dt,0)}let ce=W-1,ge=1;for(this[N+ce]=L&255;--ce>=0&&(ge*=256);)this[N+ce]=L/ge&255;return N+W},a.prototype.writeUint8=a.prototype.writeUInt8=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,1,255,0),this[N]=L&255,N+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,2,65535,0),this[N]=L&255,this[N+1]=L>>>8,N+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,2,65535,0),this[N]=L>>>8,this[N+1]=L&255,N+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,4,4294967295,0),this[N+3]=L>>>24,this[N+2]=L>>>16,this[N+1]=L>>>8,this[N]=L&255,N+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,4,4294967295,0),this[N]=L>>>24,this[N+1]=L>>>16,this[N+2]=L>>>8,this[N+3]=L&255,N+4};function Se($,L,N,W,ne){Jt(L,W,ne,$,N,7);let ce=Number(L&BigInt(4294967295));$[N++]=ce,ce=ce>>8,$[N++]=ce,ce=ce>>8,$[N++]=ce,ce=ce>>8,$[N++]=ce;let ge=Number(L>>BigInt(32)&BigInt(4294967295));return $[N++]=ge,ge=ge>>8,$[N++]=ge,ge=ge>>8,$[N++]=ge,ge=ge>>8,$[N++]=ge,N}function Ie($,L,N,W,ne){Jt(L,W,ne,$,N,7);let ce=Number(L&BigInt(4294967295));$[N+7]=ce,ce=ce>>8,$[N+6]=ce,ce=ce>>8,$[N+5]=ce,ce=ce>>8,$[N+4]=ce;let ge=Number(L>>BigInt(32)&BigInt(4294967295));return $[N+3]=ge,ge=ge>>8,$[N+2]=ge,ge=ge>>8,$[N+1]=ge,ge=ge>>8,$[N]=ge,N+8}a.prototype.writeBigUInt64LE=ei(function(L,N=0){return Se(this,L,N,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=ei(function(L,N=0){return Ie(this,L,N,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(L,N,W,ne){if(L=+L,N=N>>>0,!ne){const Zt=Math.pow(2,8*W-1);Q(this,L,N,W,Zt-1,-Zt)}let ce=0,ge=1,dt=0;for(this[N]=L&255;++ce<W&&(ge*=256);)L<0&&dt===0&&this[N+ce-1]!==0&&(dt=1),this[N+ce]=(L/ge>>0)-dt&255;return N+W},a.prototype.writeIntBE=function(L,N,W,ne){if(L=+L,N=N>>>0,!ne){const Zt=Math.pow(2,8*W-1);Q(this,L,N,W,Zt-1,-Zt)}let ce=W-1,ge=1,dt=0;for(this[N+ce]=L&255;--ce>=0&&(ge*=256);)L<0&&dt===0&&this[N+ce+1]!==0&&(dt=1),this[N+ce]=(L/ge>>0)-dt&255;return N+W},a.prototype.writeInt8=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,1,127,-128),L<0&&(L=255+L+1),this[N]=L&255,N+1},a.prototype.writeInt16LE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,2,32767,-32768),this[N]=L&255,this[N+1]=L>>>8,N+2},a.prototype.writeInt16BE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,2,32767,-32768),this[N]=L>>>8,this[N+1]=L&255,N+2},a.prototype.writeInt32LE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,4,2147483647,-2147483648),this[N]=L&255,this[N+1]=L>>>8,this[N+2]=L>>>16,this[N+3]=L>>>24,N+4},a.prototype.writeInt32BE=function(L,N,W){return L=+L,N=N>>>0,W||Q(this,L,N,4,2147483647,-2147483648),L<0&&(L=4294967295+L+1),this[N]=L>>>24,this[N+1]=L>>>16,this[N+2]=L>>>8,this[N+3]=L&255,N+4},a.prototype.writeBigInt64LE=ei(function(L,N=0){return Se(this,L,N,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=ei(function(L,N=0){return Ie(this,L,N,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ne($,L,N,W,ne,ce){if(N+W>$.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}function Le($,L,N,W,ne){return L=+L,N=N>>>0,ne||Ne($,L,N,4),t.write($,L,N,W,23,4),N+4}a.prototype.writeFloatLE=function(L,N,W){return Le(this,L,N,!0,W)},a.prototype.writeFloatBE=function(L,N,W){return Le(this,L,N,!1,W)};function xe($,L,N,W,ne){return L=+L,N=N>>>0,ne||Ne($,L,N,8),t.write($,L,N,W,52,8),N+8}a.prototype.writeDoubleLE=function(L,N,W){return xe(this,L,N,!0,W)},a.prototype.writeDoubleBE=function(L,N,W){return xe(this,L,N,!1,W)},a.prototype.copy=function(L,N,W,ne){if(!a.isBuffer(L))throw new TypeError("argument should be a Buffer");if(W||(W=0),!ne&&ne!==0&&(ne=this.length),N>=L.length&&(N=L.length),N||(N=0),ne>0&&ne<W&&(ne=W),ne===W||L.length===0||this.length===0)return 0;if(N<0)throw new RangeError("targetStart out of bounds");if(W<0||W>=this.length)throw new RangeError("Index out of range");if(ne<0)throw new RangeError("sourceEnd out of bounds");ne>this.length&&(ne=this.length),L.length-N<ne-W&&(ne=L.length-N+W);const ce=ne-W;return this===L&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(N,W,ne):Uint8Array.prototype.set.call(L,this.subarray(W,ne),N),ce},a.prototype.fill=function(L,N,W,ne){if(typeof L=="string"){if(typeof N=="string"?(ne=N,N=0,W=this.length):typeof W=="string"&&(ne=W,W=this.length),ne!==void 0&&typeof ne!="string")throw new TypeError("encoding must be a string");if(typeof ne=="string"&&!a.isEncoding(ne))throw new TypeError("Unknown encoding: "+ne);if(L.length===1){const ge=L.charCodeAt(0);(ne==="utf8"&&ge<128||ne==="latin1")&&(L=ge)}}else typeof L=="number"?L=L&255:typeof L=="boolean"&&(L=Number(L));if(N<0||this.length<N||this.length<W)throw new RangeError("Out of range index");if(W<=N)return this;N=N>>>0,W=W===void 0?this.length:W>>>0,L||(L=0);let ce;if(typeof L=="number")for(ce=N;ce<W;++ce)this[ce]=L;else{const ge=a.isBuffer(L)?L:a.from(L,ne),dt=ge.length;if(dt===0)throw new TypeError('The value "'+L+'" is invalid for argument "value"');for(ce=0;ce<W-N;++ce)this[ce+N]=ge[ce%dt]}return this};const Ee={};function Ce($,L,N){Ee[$]=class extends N{constructor(){super(),Object.defineProperty(this,"message",{value:L.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${$}]`,this.stack,delete this.name}get code(){return $}set code(ne){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ne,writable:!0})}toString(){return`${this.name} [${$}]: ${this.message}`}}}Ce("ERR_BUFFER_OUT_OF_BOUNDS",function($){return $?`${$} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ce("ERR_INVALID_ARG_TYPE",function($,L){return`The "${$}" argument must be of type number. Received type ${typeof L}`},TypeError),Ce("ERR_OUT_OF_RANGE",function($,L,N){let W=`The value of "${$}" is out of range.`,ne=N;return Number.isInteger(N)&&Math.abs(N)>2**32?ne=Ve(String(N)):typeof N=="bigint"&&(ne=String(N),(N>BigInt(2)**BigInt(32)||N<-(BigInt(2)**BigInt(32)))&&(ne=Ve(ne)),ne+="n"),W+=` It must be ${L}. Received ${ne}`,W},RangeError);function Ve($){let L="",N=$.length;const W=$[0]==="-"?1:0;for(;N>=W+4;N-=3)L=`_${$.slice(N-3,N)}${L}`;return`${$.slice(0,N)}${L}`}function vt($,L,N){Et(L,"offset"),($[L]===void 0||$[L+N]===void 0)&&Be(L,$.length-(N+1))}function Jt($,L,N,W,ne,ce){if($>N||$<L){const ge=typeof L=="bigint"?"n":"";let dt;throw L===0||L===BigInt(0)?dt=`>= 0${ge} and < 2${ge} ** ${(ce+1)*8}${ge}`:dt=`>= -(2${ge} ** ${(ce+1)*8-1}${ge}) and < 2 ** ${(ce+1)*8-1}${ge}`,new Ee.ERR_OUT_OF_RANGE("value",dt,$)}vt(W,ne,ce)}function Et($,L){if(typeof $!="number")throw new Ee.ERR_INVALID_ARG_TYPE(L,"number",$)}function Be($,L,N){throw Math.floor($)!==$?(Et($,N),new Ee.ERR_OUT_OF_RANGE("offset","an integer",$)):L<0?new Ee.ERR_BUFFER_OUT_OF_BOUNDS:new Ee.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${L}`,$)}const Zn=/[^+/0-9A-Za-z-_]/g;function In($){if($=$.split("=")[0],$=$.trim().replace(Zn,""),$.length<2)return"";for(;$.length%4!==0;)$=$+"=";return $}function Qn($,L){L=L||1/0;let N;const W=$.length;let ne=null;const ce=[];for(let ge=0;ge<W;++ge){if(N=$.charCodeAt(ge),N>55295&&N<57344){if(!ne){if(N>56319){(L-=3)>-1&&ce.push(239,191,189);continue}else if(ge+1===W){(L-=3)>-1&&ce.push(239,191,189);continue}ne=N;continue}if(N<56320){(L-=3)>-1&&ce.push(239,191,189),ne=N;continue}N=(ne-55296<<10|N-56320)+65536}else ne&&(L-=3)>-1&&ce.push(239,191,189);if(ne=null,N<128){if((L-=1)<0)break;ce.push(N)}else if(N<2048){if((L-=2)<0)break;ce.push(N>>6|192,N&63|128)}else if(N<65536){if((L-=3)<0)break;ce.push(N>>12|224,N>>6&63|128,N&63|128)}else if(N<1114112){if((L-=4)<0)break;ce.push(N>>18|240,N>>12&63|128,N>>6&63|128,N&63|128)}else throw new Error("Invalid code point")}return ce}function os($){const L=[];for(let N=0;N<$.length;++N)L.push($.charCodeAt(N)&255);return L}function pi($,L){let N,W,ne;const ce=[];for(let ge=0;ge<$.length&&!((L-=2)<0);++ge)N=$.charCodeAt(ge),W=N>>8,ne=N%256,ce.push(ne),ce.push(W);return ce}function Dr($){return e.toByteArray(In($))}function Qr($,L,N,W){let ne;for(ne=0;ne<W&&!(ne+N>=L.length||ne>=$.length);++ne)L[ne+N]=$[ne];return ne}function br($,L){return $ instanceof L||$!=null&&$.constructor!=null&&$.constructor.name!=null&&$.constructor.name===L.name}function ki($){return $!==$}const xi=function(){const $="0123456789abcdef",L=new Array(256);for(let N=0;N<16;++N){const W=N*16;for(let ne=0;ne<16;++ne)L[W+ne]=$[N]+$[ne]}return L}();function ei($){return typeof BigInt>"u"?ht:$}function ht(){throw new Error("BigInt not supported")}}(N2)),N2}var sMe=iMe();class oMe extends eP{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...t){const r=super.emit(e,...t);if(!r){const i=this.eventBacklogs.get(e);i?i.push(t):this.eventBacklogs.set(e,[t])}return r}on(e,t){super.on(e,t);const r=this.eventBacklogs.get(e);if(r){for(const i of r)super.emit(e,...i);this.eventBacklogs.delete(e)}return this}addListener(e,t){return this.on(e,t)}once(e,t){super.once(e,t);const r=this.eventBacklogs.get(e);return r&&(super.emit(e,...r[0]),r.length===1?this.eventBacklogs.delete(e):r.shift()),this}}const aMe=""+new URL("cat-4r_NkDcK.ogg",import.meta.url).href,cMe=""+new URL("cat-Dd8bv_2W.mp3",import.meta.url).href,lMe=""+new URL("clap-AxCMZLTd.ogg",import.meta.url).href,uMe=""+new URL("clap-Dxm5qGyl.mp3",import.meta.url).href,dMe=""+new URL("crickets-DUJdcuUa.ogg",import.meta.url).href,hMe=""+new URL("crickets-CcwrRdbq.mp3",import.meta.url).href,fMe=""+new URL("dog-CxIWtkNX.ogg",import.meta.url).href,pMe=""+new URL("dog-BoQdnF-w.mp3",import.meta.url).href,mMe=""+new URL("generic-BBbS3Wph.ogg",import.meta.url).href,gMe=""+new URL("generic-BFeSb6fL.mp3",import.meta.url).href,vMe=""+new URL("lightbulb-BIeJtAR_.ogg",import.meta.url).href,yMe=""+new URL("lightbulb-BrnY00qi.mp3",import.meta.url).href,_Me=""+new URL("party-D7rIOhAQ.ogg",import.meta.url).href,bMe=""+new URL("party-BZPeTgC3.mp3",import.meta.url).href,SMe=""+new URL("deer-DPSlVch4.ogg",import.meta.url).href,wMe=""+new URL("deer-91r1Gyrx.mp3",import.meta.url).href,EMe=""+new URL("rock-BVCJXNC-.ogg",import.meta.url).href,CMe=""+new URL("rock-CHdnB31m.mp3",import.meta.url).href,TMe=""+new URL("wave-FiiOzicp.ogg",import.meta.url).href,IMe=""+new URL("wave-Bzf1LSMH.mp3",import.meta.url).href,qL="io.element.call.reaction",_x={name:"generic",emoji:"",sound:{mp3:gMe,ogg:mMe}},bx=5,jv=[{emoji:"👍",name:"thumbsup",alias:["+1","yes","thumbs up"]},{emoji:"🎉",name:"party",alias:["hurray","success"],sound:{ogg:_Me,mp3:bMe}},{emoji:"👏",name:"clapping",alias:["celebrate","success"],sound:{ogg:lMe,mp3:uMe}},{emoji:"🐶",name:"dog",alias:["doggo","pupper","woofer","bark"],sound:{ogg:fMe,mp3:pMe}},{emoji:"🐱",name:"cat",alias:["meow","kitty"],sound:{ogg:aMe,mp3:cMe}},{emoji:"💡",name:"lightbulb",alias:["bulb","light","idea","ping"],sound:{ogg:vMe,mp3:yMe}},{emoji:"🦗",name:"crickets",alias:["awkward","silence"],sound:{ogg:dMe,mp3:hMe}},{emoji:"👎",name:"thumbsdown",alias:["-1","no","thumbs no"]},{emoji:"😵‍💫",name:"dizzy",alias:["dazed","confused"]},{emoji:"👌",name:"ok",alias:["okay","cool"]},{emoji:"🥰",name:"heart",alias:["heart","love","smiling"]},{emoji:"😄",name:"laugh",alias:["giggle","joy","smiling"]},{emoji:"🦌",name:"deer",alias:["stag","doe","bleat"],sound:{ogg:SMe,mp3:wMe}},{emoji:"🤘",name:"rock",alias:["cool","horns","guitar"],sound:{ogg:EMe,mp3:CMe}},{emoji:"👋",name:"wave",alias:["hand","waving"],sound:{ogg:TMe,mp3:IMe}}];var Wr=(n=>(n.JoinCall="io.element.join",n.HangupCall="im.vector.hangup",n.Close="io.element.close",n.TileLayout="io.element.tile_layout",n.SpotlightLayout="io.element.spotlight_layout",n.DeviceMute="io.element.device_mute",n))(Wr||{});const ct=(()=>{try{const{widgetId:n,parentUrl:e}=Rs();if(n&&e){const t=new URL(e).origin;O.info("Widget API is available");const r=new Koe(n,t);r.requestCapability(xg.AlwaysOnScreen);const i=new oMe;[fr.ThemeChange,"io.element.join","im.vector.hangup","io.element.tile_layout","io.element.spotlight_layout","io.element.device_mute"].forEach(b=>{r.on(`action:${b}`,R=>{R.preventDefault(),i.emit(b,R)})});const{roomId:s,userId:o,deviceId:a,baseUrl:c,e2eEnabled:l,allowIceFallback:u}=Rs();if(!s)throw new Error("Room ID must be supplied");if(!o)throw new Error("User ID must be supplied");if(!a)throw new Error("Device ID must be supplied");if(!c)throw new Error("Base URL must be supplied");const h=["org.matrix.rageshake_request",ie.CallEncryptionKeysPrefix,ie.Reaction,ie.RoomRedaction,qL],p=[o,`_${o}_${a}`,`${o}_${a}`].map(b=>({eventType:ie.GroupCallMemberPrefix,stateKey:b})),m=[{eventType:ie.RoomCreate},{eventType:ie.RoomMember},{eventType:ie.RoomEncryption},{eventType:ie.GroupCallMemberPrefix}],v=[ie.CallInvite,ie.CallCandidates,ie.CallAnswer,ie.CallHangup,ie.CallReject,ie.CallSelectAnswer,ie.CallNegotiate,ie.CallSDPStreamMetadataChanged,ie.CallSDPStreamMetadataChangedPrefix,ie.CallReplaces],g=CB(r,{sendEvent:h,receiveEvent:h,sendState:p,receiveState:m,sendToDevice:v,receiveToDevice:v,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0},s,{baseUrl:c,userId:o,deviceId:a,timelineSupport:!0,useE2eForGroupCall:l,fallbackICEServerAllowed:u},!1);return{api:r,lazyActions:i,client:(async()=>(await gt.init(),await g.startClient({clientWellKnownPollPeriod:60*10}),g))()}}else return O.info("No widget API available"),null}catch(n){return O.warn("Continuing without the widget API",n),null}})();class RMe{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,t,r,i){$t.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:t,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:i.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:i.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:i.statistics.counters.roomEventEncryptionKeysReceived>0?i.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/i.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:r})}}class kMe{track(e){$t.instance.trackEvent({eventName:"CallStarted",callId:e})}}class xMe{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){$t.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),$t.instance.setRegistrationType(gE.Registered)}}class PMe{track(){$t.instance.trackEvent({eventName:"Login"}),$t.instance.setRegistrationType(gE.Registered)}}class LMe{track(e,t){$t.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:t})}}class AMe{track(e,t){$t.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:t})}}class MMe{track(e){$t.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class OMe{track(e,t,r){$t.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:t,stars:r})}}class NMe{track(e){$t.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class DMe{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const t=Date.now(),r=t-this.connectStart,i=this.websocketConnected-this.connectStart,s=t-this.websocketConnected;$t.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:r,websocketDuration:i,peerConnectionDuration:s}),e.log&&O.log(`Time to connect:
total: ${r}ms
peerConnection: ${i}ms
websocket: ${s}ms`)}}function Wt(n){return typeof n=="function"}function UJ(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var D2=UJ(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function AS(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Iy=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=lu(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Wt(u))try{u()}catch(g){s=g instanceof D2?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=lu(h),m=p.next();!m.done;m=p.next()){var v=m.value;try{$D(v)}catch(g){s=s??[],g instanceof D2?s=io(io([],ro(s)),ro(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new D2(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)$D(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&AS(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&AS(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),jJ=Iy.EMPTY;function $J(n){return n instanceof Iy||n&&"closed"in n&&Wt(n.remove)&&Wt(n.add)&&Wt(n.unsubscribe)}function $D(n){Wt(n)?n():n.unsubscribe()}var FMe={Promise:void 0},UMe={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,io([n,e],ro(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function BJ(n){UMe.setTimeout(function(){throw n})}function MS(){}function lb(n){n()}var KL=function(n){oo(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,$J(t)&&t.add(r)):r.destination=BMe,r}return e.create=function(t,r,i){return new $v(t,r,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Iy),jMe=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){z1(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){z1(r)}else z1(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){z1(t)}},n}(),$v=function(n){oo(e,n);function e(t,r,i){var s=n.call(this)||this,o;return Wt(t)||!t?o={next:t??void 0,error:r??void 0,complete:i??void 0}:o=t,s.destination=new jMe(o),s}return e}(KL);function z1(n){BJ(n)}function $Me(n){throw n}var BMe={closed:!0,next:MS,error:$Me,complete:MS},WL=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function wu(n){return n}function HMe(n){return n.length===0?wu:n.length===1?n[0]:function(t){return n.reduce(function(r,i){return i(r)},t)}}var Mn=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=GMe(e)?e:new $v(e,t,r);return lb(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=BD(t),new t(function(i,s){var o=new $v({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[WL]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return HMe(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=BD(e),new e(function(r,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},n.create=function(e){return new n(e)},n}();function BD(n){var e;return(e=n??FMe.Promise)!==null&&e!==void 0?e:Promise}function VMe(n){return n&&Wt(n.next)&&Wt(n.error)&&Wt(n.complete)}function GMe(n){return n&&n instanceof KL||VMe(n)&&$J(n)}function qMe(n){return Wt(n==null?void 0:n.lift)}function Nr(n){return function(e){if(qMe(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Yn(n,e,t,r,i){return new KMe(n,e,t,r,i)}var KMe=function(n){oo(e,n);function e(t,r,i,s,o,a){var c=n.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=s?function(l){try{s(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(KL),WMe=UJ(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),xr=function(n){oo(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new HD(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new WMe},e.prototype.next=function(t){var r=this;lb(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=lu(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;lb(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;lb(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?jJ:(this.currentObservers=null,a.push(t),new Iy(function(){r.currentObservers=null,AS(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new Mn;return t.source=this,t},e.create=function(t,r){return new HD(t,r)},e}(Mn),HD=function(n){oo(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:jJ},e}(xr),is=function(n){oo(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(xr),zL={now:function(){return(zL.delegate||Date).now()},delegate:void 0},zMe=function(n){oo(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=zL);var s=n.call(this)||this;return s._bufferSize=t,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,r),s}return e.prototype.next=function(t){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),l=0,u=1;u<s.length&&s[u]<=c;u+=2)l=u;l&&s.splice(0,l+1)}},e}(xr),YMe=function(n){oo(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(Iy),VD={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,io([n,e],ro(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},XMe=function(n){oo(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),VD.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&VD.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,AS(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(YMe),GD=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=zL.now,n}(),JMe=function(n){oo(e,n);function e(t,r){r===void 0&&(r=GD.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(GD),pE=new JMe(XMe),ZMe=pE,OS=new Mn(function(n){return n.complete()});function HJ(n){return n&&Wt(n.schedule)}function YL(n){return n[n.length-1]}function XL(n){return Wt(YL(n))?n.pop():void 0}function Ry(n){return HJ(YL(n))?n.pop():void 0}function QMe(n,e){return typeof YL(n)=="number"?n.pop():e}var JL=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function VJ(n){return Wt(n==null?void 0:n.then)}function GJ(n){return Wt(n[WL])}function qJ(n){return Symbol.asyncIterator&&Wt(n==null?void 0:n[Symbol.asyncIterator])}function KJ(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function eOe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var WJ=eOe();function zJ(n){return Wt(n==null?void 0:n[WJ])}function YJ(n){return U6(this,arguments,function(){var t,r,i,s;return Xw(this,function(o){switch(o.label){case 0:t=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Ic(t.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,Ic(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Ic(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function XJ(n){return Wt(n==null?void 0:n.getReader)}function _r(n){if(n instanceof Mn)return n;if(n!=null){if(GJ(n))return tOe(n);if(JL(n))return nOe(n);if(VJ(n))return rOe(n);if(qJ(n))return JJ(n);if(zJ(n))return iOe(n);if(XJ(n))return sOe(n)}throw KJ(n)}function tOe(n){return new Mn(function(e){var t=n[WL]();if(Wt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function nOe(n){return new Mn(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function rOe(n){return new Mn(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,BJ)})}function iOe(n){return new Mn(function(e){var t,r;try{for(var i=lu(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function JJ(n){return new Mn(function(e){oOe(n,e).catch(function(t){return e.error(t)})})}function sOe(n){return JJ(YJ(n))}function oOe(n,e){var t,r,i,s;return F6(this,void 0,void 0,function(){var o,a;return Xw(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=j6(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function zl(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function ZJ(n,e){return e===void 0&&(e=0),Nr(function(t,r){t.subscribe(Yn(r,function(i){return zl(r,n,function(){return r.next(i)},e)},function(){return zl(r,n,function(){return r.complete()},e)},function(i){return zl(r,n,function(){return r.error(i)},e)}))})}function QJ(n,e){return e===void 0&&(e=0),Nr(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function aOe(n,e){return _r(n).pipe(QJ(e),ZJ(e))}function cOe(n,e){return _r(n).pipe(QJ(e),ZJ(e))}function lOe(n,e){return new Mn(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function uOe(n,e){return new Mn(function(t){var r;return zl(t,e,function(){r=n[WJ](),zl(t,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return Wt(r==null?void 0:r.return)&&r.return()}})}function eZ(n,e){if(!n)throw new Error("Iterable cannot be null");return new Mn(function(t){zl(t,e,function(){var r=n[Symbol.asyncIterator]();zl(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function dOe(n,e){return eZ(YJ(n),e)}function hOe(n,e){if(n!=null){if(GJ(n))return aOe(n,e);if(JL(n))return lOe(n,e);if(VJ(n))return cOe(n,e);if(qJ(n))return eZ(n,e);if(zJ(n))return uOe(n,e);if(XJ(n))return dOe(n,e)}throw KJ(n)}function ky(n,e){return e?hOe(n,e):_r(n)}function It(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ry(n);return ky(n,t)}function fOe(n){return!!n&&(n instanceof Mn||Wt(n.lift)&&Wt(n.subscribe))}function pOe(n){return n instanceof Date&&!isNaN(n)}function Fe(n,e){return Nr(function(t,r){var i=0;t.subscribe(Yn(r,function(s){r.next(n.call(e,s,i++))}))})}var mOe=Array.isArray;function gOe(n,e){return mOe(e)?n.apply(void 0,io([],ro(e))):n(e)}function ZL(n){return Fe(function(e){return gOe(n,e)})}var vOe=Array.isArray,yOe=Object.getPrototypeOf,_Oe=Object.prototype,bOe=Object.keys;function tZ(n){if(n.length===1){var e=n[0];if(vOe(e))return{args:e,keys:null};if(SOe(e)){var t=bOe(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function SOe(n){return n&&typeof n=="object"&&yOe(n)===_Oe}function nZ(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function Nn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ry(n),r=XL(n),i=tZ(n),s=i.args,o=i.keys;if(s.length===0)return ky([],t);var a=new Mn(wOe(s,t,o?function(c){return nZ(o,c)}:wu));return r?a.pipe(ZL(r)):a}function wOe(n,e,t){return t===void 0&&(t=wu),function(r){qD(e,function(){for(var i=n.length,s=new Array(i),o=i,a=i,c=function(u){qD(e,function(){var h=ky(n[u],e),p=!1;h.subscribe(Yn(r,function(m){s[u]=m,p||(p=!0,a--),a||r.next(t(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function qD(n,e,t){n?zl(t,n,e):e()}function EOe(n,e,t,r,i,s,o,a){var c=[],l=0,u=0,h=!1,p=function(){h&&!c.length&&!l&&e.complete()},m=function(g){return l<r?v(g):c.push(g)},v=function(g){l++;var S=!1;_r(t(g,u++)).subscribe(Yn(e,function(b){e.next(b)},function(){S=!0},void 0,function(){if(S)try{l--;for(var b=function(){var R=c.shift();o||v(R)};c.length&&l<r;)b();p()}catch(R){e.error(R)}}))};return n.subscribe(Yn(e,m,function(){h=!0,p()})),function(){}}function xy(n,e,t){return t===void 0&&(t=1/0),Wt(e)?xy(function(r,i){return Fe(function(s,o){return e(r,s,i,o)})(_r(n(r,i)))},t):(typeof e=="number"&&(t=e),Nr(function(r,i){return EOe(r,i,n,t)}))}function rZ(n){return n===void 0&&(n=1/0),xy(wu,n)}function COe(){return rZ(1)}function NS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return COe()(ky(n,Ry(n)))}function TOe(n){return new Mn(function(e){_r(n()).subscribe(e)})}function IOe(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=XL(n),r=tZ(n),i=r.args,s=r.keys,o=new Mn(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,p=function(v){var g=!1;_r(i[v]).subscribe(Yn(a,function(S){g||(g=!0,h--),l[v]=S},function(){return u--},void 0,function(){(!u||!g)&&(h||a.next(s?nZ(s,l):l),a.complete())}))},m=0;m<c;m++)p(m)});return t?o.pipe(ZL(t)):o}var ROe=["addListener","removeListener"],kOe=["addEventListener","removeEventListener"],xOe=["on","off"];function Ta(n,e,t,r){if(Wt(t)&&(r=t,t=void 0),r)return Ta(n,e,t).pipe(ZL(r));var i=ro(AOe(n)?kOe.map(function(a){return function(c){return n[a](e,c,t)}}):POe(n)?ROe.map(KD(n,e)):LOe(n)?xOe.map(KD(n,e)):[],2),s=i[0],o=i[1];if(!s&&JL(n))return xy(function(a){return Ta(a,e,t)})(_r(n));if(!s)throw new TypeError("Invalid event target");return new Mn(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function KD(n,e){return function(t){return function(r){return n[t](e,r)}}}function POe(n){return Wt(n.addListener)&&Wt(n.removeListener)}function LOe(n){return Wt(n.on)&&Wt(n.off)}function AOe(n){return Wt(n.addEventListener)&&Wt(n.removeEventListener)}function Fl(n,e,t){n===void 0&&(n=0),t===void 0&&(t=ZMe);var r=-1;return e!=null&&(HJ(e)?t=e:r=e),new Mn(function(i){var s=pOe(n)?+n-t.now():n;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function Sx(n,e){return n===void 0&&(n=0),e===void 0&&(e=pE),n<0&&(n=0),Fl(n,n,e)}function Bv(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ry(n),r=QMe(n,1/0),i=n;return i.length?i.length===1?_r(i[0]):rZ(r)(ky(i,t)):OS}var MOe=Array.isArray;function OOe(n){return n.length===1&&MOe(n[0])?n[0]:n}function Vo(n,e){return Nr(function(t,r){var i=0;t.subscribe(Yn(r,function(s){return n.call(e,s,i++)&&r.next(s)}))})}function NOe(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=OOe(n),n.length===1?_r(n[0]):new Mn(DOe(n))}function DOe(n){return function(e){for(var t=[],r=function(s){t.push(_r(n[s]).subscribe(Yn(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function FOe(n){return Nr(function(e,t){var r=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var l=i;i=null,t.next(l)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(Yn(t,function(l){r=!0,i=l,s||_r(n(l)).subscribe(s=Yn(t,a,c))},function(){o=!0,(!r||!s||s.closed)&&t.complete()}))})}function UOe(n,e,t,r,i){return function(s,o){var a=t,c=e,l=0;s.subscribe(Yn(o,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),o.next(c)},i))}}function wx(n){return n<=0?function(){return OS}:Nr(function(e,t){var r=0;e.subscribe(Yn(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function jOe(n){return Fe(function(){return n})}function $Oe(n,e){return xy(function(t,r){return _r(n(t,r)).pipe(wx(1),jOe(t))})}function BOe(n,e){e===void 0&&(e=pE);var t=Fl(n,e);return $Oe(function(){return t})}function ba(n,e){return e===void 0&&(e=wu),n=n??HOe,Nr(function(t,r){var i,s=!0;t.subscribe(Yn(r,function(o){var a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}function HOe(n,e){return n===e}function VOe(n,e){return ba(function(t,r){return t[n]===r[n]})}function iZ(n){return Nr(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function ec(n,e){return Nr(UOe(n,e,arguments.length>=2,!0))}function GOe(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new xr}:e,r=n.resetOnError,i=r===void 0?!0:r,s=n.resetOnComplete,o=s===void 0?!0:s,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,p,m=0,v=!1,g=!1,S=function(){h==null||h.unsubscribe(),h=void 0},b=function(){S(),u=p=void 0,v=g=!1},R=function(){var k=u;b(),k==null||k.unsubscribe()};return Nr(function(k,I){m++,!g&&!v&&S();var T=p=p??t();I.add(function(){m--,m===0&&!g&&!v&&(h=F2(R,c))}),T.subscribe(I),!u&&m>0&&(u=new $v({next:function(C){return T.next(C)},error:function(C){g=!0,S(),h=F2(b,i,C),T.error(C)},complete:function(){v=!0,S(),h=F2(b,o),T.complete()}}),_r(k).subscribe(u))})(l)}}function F2(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new $v({next:function(){i.unsubscribe(),n()}});return _r(e.apply(void 0,io([],ro(t)))).subscribe(i)}}function qOe(n,e,t){var r,i,s,o,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,o=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,s=n.refCount,a=s===void 0?!1:s,t=n.scheduler):o=n??1/0,GOe({connector:function(){return new zMe(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function KOe(n){return Vo(function(e,t){return n<=t})}function un(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ry(n);return Nr(function(r,i){(t?NS(n,r,t):NS(n,r)).subscribe(i)})}function Ot(n,e){return Nr(function(t,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};t.subscribe(Yn(r,function(c){i==null||i.unsubscribe();var l=0,u=s++;_r(n(c,u)).subscribe(i=Yn(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){o=!0,a()}))})}function WOe(){return Ot(wu)}function zOe(n,e){return Nr(function(t,r){var i=e;return Ot(function(s,o){return n(i,s,o)},function(s,o){return i=o,o})(t).subscribe(r),function(){i=null}})}function YOe(n){return Nr(function(e,t){_r(n).subscribe(Yn(t,function(){return t.complete()},MS)),!t.closed&&e.subscribe(t)})}function XOe(n,e,t){var r=Wt(n)||e||t?{next:n,error:e,complete:t}:n;return r?Nr(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Yn(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):wu}function Ex(n,e){return Nr(function(t,r){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,p=!1,m=function(){h==null||h.unsubscribe(),h=null,c&&(S(),p&&r.complete())},v=function(){h=null,p&&r.complete()},g=function(b){return h=_r(n(b)).subscribe(Yn(r,m,v))},S=function(){if(l){l=!1;var b=u;u=null,r.next(b),!p&&g(b)}};t.subscribe(Yn(r,function(b){l=!0,u=b,!(h&&!h.closed)&&(o?S():g(b))},function(){p=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function JOe(n,e,t){e===void 0&&(e=pE);var r=Fl(n,e);return Ex(function(){return r},t)}function ZOe(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=XL(n);return Nr(function(r,i){for(var s=n.length,o=new Array(s),a=n.map(function(){return!1}),c=!1,l=function(h){_r(n[h]).subscribe(Yn(i,function(p){o[h]=p,!c&&!a[h]&&(a[h]=!0,(c=a.every(wu))&&(a=null))},MS))},u=0;u<s;u++)l(u);r.subscribe(Yn(i,function(h){if(c){var p=io([h],ro(o));i.next(t?t.apply(void 0,io([],ro(p))):p)}}))})}function QOe(n,e,t){if(!t)return _.useState(e)[0];const[r]=_.useState(()=>new is(t)),[i]=_.useState(()=>e(r)),s=_.useRef(!0);return n(()=>{if(s.current){s.current=!1;return}r.next(t)},t),i}function Hv(n,e){return QOe(_.useEffect,n,e)}var e5e=()=>new xr,t5e=n=>n+1|0,n5e=()=>{const n=_.useState(0)[1];return _.useRef(()=>n(t5e)).current},sZ=typeof window>"u"?_.useEffect:_.useLayoutEffect,WD=n=>{var e;return(e=n[1])!=null&&e.next?n[1]:{next:n[1],error:n[2],complete:n[3]}};function r5e(n,e){const t=_.useRef(e),r=_.useRef(),i=_.useRef();return sZ(()=>{t.current=e,r.current=WD(e)}),n(()=>{const s=t.current[0];r.current||(r.current=WD(t.current));const o=s.subscribe({next:a=>{var c,l;s===t.current[0]&&((l=(c=r.current).next)==null||l.call(c,a))},error:a=>{s===t.current[0]&&(r.current.error?r.current.error(a):console.error(a))},complete:()=>{var a,c;s===t.current[0]&&((c=(a=r.current).complete)==null||c.call(a))}});return i.current=o,()=>{o.unsubscribe()}},[e[0]]),i}function i5e(n,e,t,r){return r5e(_.useEffect,[n,e,t,r])}function s5e(n,e,t){if(fOe(e)){const r=e,[i,s]=_.useState(()=>r instanceof is||r.value!==void 0?r.value:t);return n(r,s),_.useDebugValue(i),i}else{const r=e,[i,s]=_.useState(t),[o]=_.useState(e5e),[a]=_.useState(()=>r(o,i)),c=_.useRef(l=>o.next(l)).current;return n(a,s),_.useDebugValue(i),[i,c]}}function Vv(n,e){return s5e(i5e,n,e)}function st(n){const e=n5e(),t=_.useRef(n),r=_.useRef(),i=_.useRef(!1),s=_.useRef(!1),[o,a]=_.useState(()=>{let c;return n.subscribe({next:l=>{s.current=!0,c=l},error:l=>{r.current=l}}).unsubscribe(),c});if(sZ(()=>{t.current=n}),_.useEffect(()=>{r.current=null;const c=t.current;let l=o;const u=c.subscribe({next:h=>{c===t.current&&(i.current?a(()=>h):l=h)},error:h=>{c===t.current&&(r.current=h,e())}});return i.current||l!==o&&a(()=>l),i.current=!0,()=>{u.unsubscribe()}},[n]),r.current)throw r.current;if(s.current)return _.useDebugValue(o),o;throw new Error("Observable did not synchronously emit a value.")}function o5e(n){const[e]=_.useState(()=>new is(n)),[t]=_.useState(()=>({get current(){return e.value},set current(r){e.next(r)}}));return[t,e]}class Ri{constructor(e,t){this.defaultValue=t,this.setValue=s=>{this._value$.next(s),localStorage.setItem(this.key,JSON.stringify(s))},this.key=`matrix-setting-${e}`;const r=localStorage.getItem(this.key);let i=t;if(r!==null)try{i=JSON.parse(r)}catch(s){O.warn(`Invalid value stored for setting ${e}: ${r}.`,s)}this._value$=new is(i),this.value$=this._value$}}function Mr(n){return[st(n.value$),n.setValue]}const Cx=new Ri("opt-in-analytics",null),mE=()=>{const n=Mr(Cx);return $t.instance.isEnabled()?n:[!1,null]},oZ=new Ri("developer-settings-tab",!1),aZ=new Ri("duplicate-tiles",0),cZ=new Ri("show-non-member-tiles",!1),QL=new Ri("debug-tile-layout",!1),Gv=new Ri("show-connection-stats",!1),a5e=new Ri("audio-input",void 0),c5e=new Ri("audio-output",void 0),l5e=new Ri("video-input",void 0),lZ=new Ri("hand-raised-show-timer",!1),uZ=new Ri("reactions-show",!0),e4=new Ri("reactions-play-sound",!0),dZ=new Ri("sound-effect-volume",.5),hZ=new Ri("new-membership-manager",!0),zD=new Ri("always-show-self",!0);var gE=(n=>(n[n.Guest=0]="Guest",n[n.Registered=1]="Registered",n))(gE||{});const Co=class Co{constructor(e){var r,i;this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.sanitizeProperties=(s,o)=>(this.anonymity==1&&(s.$referrer=null,s.$referring_domain=null,s.$initial_referrer=null,s.$initial_referring_domain=null,s.$device_id=null),s.$current_url=s.$current_url.split("/").slice(0,3).join(""),s),this.eventCallEnded=new RMe,this.eventSignup=new xMe,this.eventCallStarted=new kMe,this.eventLogin=new PMe,this.eventMuteMicrophone=new LMe,this.eventMuteCamera=new AMe,this.eventUndecryptableToDevice=new MMe,this.eventQualitySurvey=new OMe,this.eventCallDisconnected=new NMe,this.eventCallConnectDuration=new DMe;const t={project_api_key:(r=gt.get().posthog)==null?void 0:r.api_key,api_host:(i=gt.get().posthog)==null?void 0:i.api_host};if(t.project_api_key&&t.api_host){if(Co.getPlatformProperties().matrixBackend==="embedded"){const{analyticsID:s}=Rs();Cx.setValue(!!s)}this.posthog.init(t.project_api_key,{api_host:t.api_host,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0}else O.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1;this.startListeningToSettingsChanges()}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new Co(tMe)),this.internalInstance}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){var t,r;return{appVersion:"embedded-v0.9.0-release-test.3",matrixBackend:ct?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:ct||(r=(t=window.matrixclient)==null?void 0:t.getCrypto())==null?void 0:r.getVersion()}}capture(e,t,r){this.enabled&&this.posthog.capture(e,{...t},r)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(e==0||e==1)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map(e=>e.toString(16)).join("")}async identifyUser(e){if(this.anonymity==2&&this.enabled){let t=await this.getAnalyticsId();try{if(!t&&!ct){const r=e();await this.setAccountAnalyticsId(r),t=await this.hashedEcAnalyticsId(r)}}catch(r){O.log("Unable to identify user for tracking"+(r==null?void 0:r.toString()))}t?this.posthog.identify(t):O.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const e=window.matrixclient;let t;if(ct)t=Rs().analyticsID;else{const r=await e.getAccountDataFromServer(Co.ANALYTICS_EVENT_TYPE);t=(r==null?void 0:r.id)??null}return t?await this.hashedEcAnalyticsId(t):null}async hashedEcAnalyticsId(e){const t=window.matrixclient,r="ec"+e+t.getUserId(),i=await crypto.subtle.digest("sha-256",sMe.Buffer.from(r,"utf-8")),s=new Int32Array(i);return Array.from(s).map(o=>Math.abs(o).toString(16).padStart(2,"0")).join("")}async setAccountAnalyticsId(e){if(!ct){const t=window.matrixclient,r=await t.getAccountDataFromServer(Co.ANALYTICS_EVENT_TYPE);await t.setAccountData(Co.ANALYTICS_EVENT_TYPE,Object.assign({id:e},r))}}getAnonymity(){return this.anonymity}logout(){this.enabled&&this.posthog.reset(),this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch(()=>O.log("Could not identify user on login status change"))}updateSuperProperties(){this.platformSuperProperties=Co.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:this.registrationType==0?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(this.anonymity===2&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(Co.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),this.anonymity!==0&&this.updateSuperProperties())}trackEvent({eventName:e,...t},r){const i=()=>{this.anonymity==0||this.anonymity==1||this.capture(e,t,r)};this.identificationPromise?this.identificationPromise.then(i,s=>{O.error("Failed to identify user for tracking",s)}):i()}startListeningToSettingsChanges(){Cx.value$.subscribe(e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch(()=>O.log("Could not identify user"))})}setRegistrationType(e){this.registrationType=e,!(this.anonymity==0||this.anonymity==1)&&this.updateSuperProperties()}};Co.ANALYTICS_EVENT_TYPE="im.vector.analytics",Co.internalInstance=null;let $t=Co;const u5e=2*60*1e3;class d5e{async forceFlush(){}onStart(e){try{switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipStart(e);return;case"matrix.groupCallMembership.summaryReport":this.onSummaryReportStart(e);return}}catch(t){O.debug(t)}}onEnd(e){switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipEnd(e);return}}get prevCall(){const e=localStorage.getItem("matrix-prev-call");if(e===null)return null;try{return JSON.parse(e)}catch(t){return O.warn("Invalid prev call data",e,"error:",t),null}}set prevCall(e){localStorage.setItem("matrix-prev-call",JSON.stringify(e))}onGroupCallMembershipStart(e){const t=this.prevCall,r=e.attributes["matrix.confId"];if(t!==null&&r===t.callId){const i=C7(e.startTime)-t.hangupTs;i<=u5e&&$t.instance.trackEvent({eventName:"Rejoin",callId:t.callId,rejoinDuration:i})}}onGroupCallMembershipEnd(e){this.prevCall={callId:e.attributes["matrix.confId"],hangupTs:C7(e.endTime)}}onSummaryReportStart(e){const t=e.events.find(r=>r.name==="matrix.stats.summary");if(t!==void 0){const r=t.attributes;if(r){const i=`${r["matrix.stats.summary.percentageReceivedMedia"]}`,s=`${r["matrix.stats.summary.percentageReceivedVideoMedia"]}`,o=`${r["matrix.stats.summary.percentageReceivedAudioMedia"]}`,a=`${r["matrix.stats.summary.maxJitter"]}`,c=`${r["matrix.stats.summary.maxPacketLoss"]}`,l=`${r["matrix.stats.summary.peerConnections"]}`,u=`${r["matrix.stats.summary.percentageConcealedAudio"]}`,h=`${r["matrix.stats.summary.opponentUsersInCall"]}`,p=`${r["matrix.stats.summary.opponentDevicesInCall"]}`,m=`${r["matrix.stats.summary.diffDevicesToPeerConnections"]}`,v=`${r["matrix.stats.summary.ratioPeerConnectionToDevices"]}`;$t.instance.trackEvent({eventName:"MediaReceived",callId:e.attributes["matrix.confId"],mediaReceived:i,audioReceived:o,videoReceived:s,maxJitter:a,maxPacketLoss:c,peerConnections:l,percentageConcealedAudio:u,opponentUsersInCall:h,opponentDevicesInCall:p,diffDevicesToPeerConnections:m,ratioPeerConnectionToDevices:v},{send_instantly:!0})}}}async shutdown(){return Promise.resolve()}}const YD=n=>Object.entries(n).map(([e,t])=>({key:e,type:typeof t,value:t}));class h5e{constructor(){this.spans=[]}async forceFlush(){}onStart(e){this.spans.push(e)}onEnd(){}dump(){const e=Date.now()*1e3,t=new Map;for(const s of this.spans){const o=s.spanContext().traceId;let a=t.get(o);a===void 0&&(a=[],t.set(o,a)),a.push(s)}const r="p1",i={[r]:{serviceName:"element-call",tags:[]},warnings:null};return JSON.stringify({total:0,limit:0,offset:0,errors:null,data:[...t.entries()].map(([s,o])=>({traceID:s,warnings:null,processes:i,spans:o.map(a=>{const c=a.spanContext(),l=_2(a.startTime),u=a.duration[0]===-1?e-l:_2(a.duration);return{traceID:s,spanID:c.spanId,operationName:a.name,processID:r,warnings:null,startTime:l,duration:u,references:a.parentSpanId===void 0?[]:[{refType:"CHILD_OF",traceID:s,spanID:a.parentSpanId}],tags:YD(a.attributes),logs:a.events.map(h=>({timestamp:_2(h.time),fields:[...YD(h.attributes??{}),{key:"event",type:"string",value:h.name}]}))}})}))})}async shutdown(){}}const f5e="element-call";let qu;class vE{static globalInit(){var r,i,s;const e=gt.get(),t=!!((r=e.opentelemetry)!=null&&r.collector_url);(!qu||qu.isOtlpEnabled!==t)&&(O.info("(Re)starting OpenTelemetry debug reporting"),qu==null||qu.dispose(),qu=new vE((i=e.opentelemetry)==null?void 0:i.collector_url,(s=e.rageshake)==null?void 0:s.submit_url))}static get instance(){return qu}constructor(e,t){const r={resource:new K3({[C4e.SERVICE_NAME]:f5e})};this._provider=new Y6e(r),e?(O.info("Enabling OTLP collector with URL "+e),this.otlpExporter=new G6e({url:e}),this._provider.addSpanProcessor(new UPe(this.otlpExporter))):O.info("OTLP collector disabled"),t&&(this.rageshakeProcessor=new h5e,this._provider.addSpanProcessor(this.rageshakeProcessor)),this._provider.addSpanProcessor(new d5e),g2.trace.setGlobalTracerProvider(this._provider),this._tracer=g2.trace.getTracer("my-element-call-otl-tracer")}dispose(){var e;g2.trace.disable(),(e=this._provider)==null||e.shutdown().catch(t=>{O.error("Failed to shutdown OpenTelemetry",t)})}get isOtlpEnabled(){return!!this.otlpExporter}get tracer(){return this._tracer}get provider(){return this._provider}}const XD=async n=>{const{gzip:e}=await rv(async()=>{const{gzip:r}=await import("./pako.esm-BMdhWMX1.js");return{gzip:r}},[],import.meta.url),t=new TextEncoder().encode(n);return new Blob([e(t)])};async function p5e(n,e){e.append("crypto_version",n.getVersion());const t=await n.getOwnDeviceKeys(),r=[`curve25519:${t.curve25519}`,`ed25519:${t.ed25519}`];e.append("device_keys",r.join(", "));const i=await n.getCrossSigningStatus();e.append("cross_signing_ready",String(await n.isCrossSigningReady())),e.append("cross_signing_key",await n.getCrossSigningKeyId()??"n/a"),e.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),e.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),e.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),e.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function m5e(n,e,t){const r=n.secretStorage;t.append("secret_storage_ready",String(await e.isSecretStorageReady())),t.append("secret_storage_key_in_account",String(await r.hasKey())),t.append("session_backup_key_in_secret_storage",String(!!await n.isKeyBackupKeyStored()));const i=await e.getSessionBackupPrivateKey();t.append("session_backup_key_cached",String(!!i)),t.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function t4(){const{client:n}=nh(),[{sending:e,sent:t,error:r},i]=_.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:_.useCallback(async o=>{var a;if(!((a=gt.get().rageshake)!=null&&a.submit_url))throw new Error("No rageshake URL is configured");if(!e)try{i({sending:!0,sent:!1,error:void 0});let c="UNKNOWN";window.navigator&&window.navigator.userAgent&&(c=window.navigator.userAgent);let l="UNKNOWN";try{l=String(window.matchMedia("(pointer: coarse)").matches)}catch(m){O.warn("Could not get coarse pointer for rageshake submit.",m)}let u=o.rageshakeRequestId?`Rageshake ${o.rageshakeRequestId}`:"";o.description&&(u+=`: ${o.description}`);const h=new FormData;if(h.append("text",u??"User did not supply any additional text."),h.append("app","matrix-video-chat"),h.append("version","embedded-v0.9.0-release-test.3"),h.append("user_agent",c),h.append("installed_pwa","false"),h.append("touch_input",l),h.append("call_backend","livekit"),h.append("hostname",window.location.hostname),n){const m=n.getUserId(),v=n.getUser(m);h.append("display_name",(v==null?void 0:v.displayName)??""),h.append("user_id",n.credentials.userId??""),h.append("device_id",n.deviceId??""),o.roomId&&h.append("room_id",o.roomId);const g=n.getCrypto();g&&(await p5e(g,h),await m5e(n,g,h))}if(o.label&&h.append("label",o.label),navigator.storage&&navigator.storage.persisted)try{h.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(m){O.warn("coulr not get navigator peristed storage",m)}else if(document.hasStorageAccess)try{h.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(m){O.warn("could not get storage access",m)}if(navigator.storage&&navigator.storage.estimate)try{const m=await navigator.storage.estimate();h.append("storageManager_quota",String(m.quota)),h.append("storageManager_usage",String(m.usage)),m.usageDetails&&Object.keys(m.usageDetails).forEach(v=>{h.append(`storageManager_usage_${v}`,String(m.usageDetails[v]))})}catch(m){O.warn("could not obatain storage estimate",m)}if(o.sendLogs){const m=await Mke();for(const v of m)h.append("compressed-log",await XD(v.lines),v.id);h.append("file",await XD(vE.instance.rageshakeProcessor.dump()),"traces.json.gz")}o.rageshakeRequestId&&h.append("group_call_rageshake_request_id",o.rageshakeRequestId);const p=await fetch(gt.get().rageshake.submit_url,{method:"POST",body:h});if(p.status!==200)throw new Error(`Failed to submit feedback: receive HTTP ${p.status} ${p.statusText}`);i({sending:!1,sent:!0,error:void 0})}catch(c){i({sending:!1,sent:!1,error:c}),O.error(c)}},[n,e]),sending:e,sent:t,error:r}}function g5e(){const{client:n}=nh();return _.useCallback((t,r)=>{n.sendEvent(t,"org.matrix.rageshake_request",{request_id:r}).catch(i=>{O.error("Failed to send org.matrix.rageshake_request event",i)})},[n])}function v5e(n){const[e,t]=_.useState(!1),r=_.useCallback(()=>t(!1),[t]),{client:i}=nh(),[s,o]=_.useState();return _.useEffect(()=>{if(!i)return;const a=c=>{c.getType()==="org.matrix.rageshake_request"&&n===c.getRoomId()&&i.getUserId()!==c.getSender()&&(o(c.getContent().request_id),t(!0))};return i.on(qe.Event,a),()=>{i.removeListener(qe.Event,a)}},[t,n,i]),{rageshakeRequestId:s??"",roomId:n,open:e,onDismiss:r}}const y5e=({description:n})=>{var c;const{submitRageshake:e,sending:t,sent:r,error:i}=t4(),{t:s}=Xe(),o=_.useCallback(()=>{e({description:n,sendLogs:!0}).catch(l=>{O.error("Failed to send rageshake",l)})},[e,n]);if(!((c=gt.get().rageshake)!=null&&c.submit_url))return null;let a=null;if(t)a=w.jsx("span",{children:s("rageshake_sending")});else if(r)a=w.jsx("div",{children:s("rageshake_sent")});else{let l=s("rageshake_send_logs");i&&(l=s("rageshake_button_error_caption")),a=w.jsx(Dt,{onClick:o,className:y7.wideButton,disabled:t,children:l})}return w.jsx("div",{className:y7.rageshakeControl,children:a})},_5e="_error_19mk1_1",b5e="_icon_19mk1_9",Y1={error:_5e,icon:b5e},S5e="_endCall_bwclo_8",w5e={endCall:S5e},fZ=({muted:n,...e})=>{const{t}=Xe(),r=n?TY:SL,i=t(n?"unmute_microphone_button_label":"mute_microphone_button_label");return w.jsx(di,{label:i,children:w.jsx(Dt,{iconOnly:!0,Icon:r,kind:n?"primary":"secondary",...e})})},pZ=({muted:n,...e})=>{const{t}=Xe(),r=n?oIe:KY,i=t(n?"start_video_button_label":"stop_video_button_label");return w.jsx(di,{label:i,children:w.jsx(Dt,{iconOnly:!0,Icon:r,kind:n?"primary":"secondary",...e})})},mZ=n=>{const{t:e}=Xe();return w.jsx(di,{label:e("switch_camera"),children:w.jsx(Dt,{iconOnly:!0,Icon:rIe,kind:"secondary",...n})})},E5e=({enabled:n,...e})=>{const{t}=Xe(),r=t(n?"stop_screenshare_button_label":"screenshare_button_label");return w.jsx(di,{label:r,children:w.jsx(Dt,{iconOnly:!0,Icon:eIe,kind:n?"primary":"secondary",...e})})},gZ=({className:n,...e})=>{const{t}=Xe();return w.jsx(di,{label:t("hangup_button_label"),children:w.jsx(Dt,{className:De(n,w5e.endCall),iconOnly:!0,Icon:mY,destructive:!0,...e})})},vZ=n=>{const{t:e}=Xe();return w.jsx(di,{label:e("common.settings"),children:w.jsx(Dt,{iconOnly:!0,Icon:QTe,kind:"secondary",...n})})},C5e="_external_jhjdf_8",T5e={external:C5e};function yZ(n,e){const t=EV(n),r=MV(n,{state:e});return[t,r]}const Aa=_.forwardRef(function({to:e,state:t,...r},i){const[s,o]=yZ(e,t);return w.jsx(MEe,{ref:i,...r,href:s,onClick:o})}),_d=_.forwardRef(function({className:e,children:t,...r},i){return w.jsx("a",{ref:i,className:De(e,T5e.external),target:"_blank",rel:"noreferrer noopener",...r,children:t})}),n4=_.forwardRef(function({to:e,state:t,...r},i){const[s,o]=yZ(e,t);return w.jsx(Dt,{as:"a",ref:i,...r,href:s,onClick:o})});function _Z(n){const[e,t]=_.useState(n.memberships),r=_.useCallback(()=>{O.info(`Memberships changed for call in room ${n.room.roomId} (${n.memberships.length} members)`),t(n.memberships)},[n]);return _.useEffect(()=>(n.on(ts.MembershipsChanged,r),()=>{n.off(ts.MembershipsChanged,r)}),[n,r]),e}const bZ=_.createContext(void 0),r4=()=>{const n=_.useContext(bZ);if(!n)throw new Error("useReactions must be used within a ReactionsProvider");return n},I5e=({children:n,rtcSession:e,vm:t})=>{const r=_Z(e),i=jp(),s=(i==null?void 0:i.state)==="valid"&&i.supportedFeatures.reactions,o=e.room,a=o.client.getUserId(),c=o.client.getDeviceId(),l=`${a}:${c}`,u=_.useMemo(()=>{var b;return(b=r.find(R=>R.sender===a&&R.deviceId===c))==null?void 0:b.eventId},[r,a,c]),h=st(t.reactions$),p=_.useMemo(()=>l!==void 0?h[l]:void 0,[l,h]),m=st(t.handsRaised$),v=_.useMemo(()=>l!==void 0?m[l]:void 0,[l,m]),g=_.useCallback(async()=>{if(!l)return;const b=v==null?void 0:v.reactionEventId;if(b)try{await o.client.redactEvent(e.room.roomId,b),O.debug("Redacted raise hand event")}catch(R){throw O.error("Failed to redact reaction event",b,R),R}else try{if(!u)throw new Error("Cannot find own membership event");const R=await o.client.sendEvent(e.room.roomId,ie.Reaction,{"m.relates_to":{rel_type:on.Annotation,event_id:u,key:"🖐️"}});O.debug("Sent raise hand event",R.event_id)}catch(R){O.error("Failed to send raised hand",R)}},[u,l,v,e,o]),S=_.useCallback(async b=>{if(!(!l||p)){if(!u)throw new Error("Cannot find own membership event");await o.client.sendEvent(e.room.roomId,qL,{"m.relates_to":{rel_type:on.Reference,event_id:u},emoji:b.emoji,name:b.name})}},[u,p,o,l,e]);return w.jsx(bZ.Provider,{value:{supportsReactions:s,toggleRaisedHand:g,sendReaction:S},children:n})},R5e="_raisedButton_unw54_1",k5e="_reactionPopupMenu_unw54_5",x5e="_reactionPopupMenuRoot_unw54_21",P5e="_reactionPopupMenuModal_unw54_21",L5e="_reactionsMenuSection_unw54_47",A5e="_reactionsMenu_unw54_47",M5e="_reactionButton_unw54_81",O5e="_verticalSeperator_unw54_91",N5e="_alert_unw54_99",Io={raisedButton:R5e,reactionPopupMenu:k5e,reactionPopupMenuRoot:x5e,reactionPopupMenuModal:P5e,reactionsMenuSection:L5e,reactionsMenu:A5e,reactionButton:M5e,verticalSeperator:O5e,alert:N5e};var SZ=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(F5e);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(Tx,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(Tx,{...r,ref:e,children:t})});SZ.displayName="Slot";var Tx=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=j5e(t),s=U5e(r,t.props);return t.type!==_.Fragment&&(s.ref=e?Ha(e,i):i),_.cloneElement(t,s)}return _.Children.count(t)>1?_.Children.only(null):null});Tx.displayName="SlotClone";var D5e=({children:n})=>w.jsx(w.Fragment,{children:n});function F5e(n){return _.isValidElement(n)&&n.type===D5e}function U5e(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function j5e(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var $5e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],B5e=$5e.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?SZ:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{}),H5e="VisuallyHidden",Ix=_.forwardRef((n,e)=>w.jsx(B5e.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));Ix.displayName=H5e;const V5e="_modal_lmgdq_8",G5e="_dialog_lmgdq_14",q5e="_content_lmgdq_21",K5e="_drawer_lmgdq_32",W5e="_close_lmgdq_59",z5e="_header_lmgdq_84",Y5e="_body_lmgdq_114",X5e="_tabbed_lmgdq_129",J5e="_handle_lmgdq_133",Ui={modal:V5e,dialog:G5e,content:q5e,drawer:K5e,close:W5e,header:z5e,body:Y5e,tabbed:X5e,handle:J5e},Z5e="_bg_197ap_8",Q5e="_animate_197ap_23",eNe="_overlay_197ap_40",_a={bg:Z5e,animate:Q5e,overlay:eNe},th=({title:n,hideHeader:e,children:t,className:r,classNameDrawer:i,classNameModal:s,open:o,onDismiss:a,tabbed:c,...l})=>{const{t:u}=Xe(),h=rE("(hover: none) or (pointer: coarse)"),p=_.useCallback(m=>{m||a==null||a()},[a]);if(h)return w.jsx(Ki.Root,{open:o,onOpenChange:p,dismissible:a!==void 0,children:w.jsxs(Ki.Portal,{children:[w.jsx(Ki.Overlay,{className:De(_a.bg)}),w.jsx(Ki.Content,{className:De(r,i,_a.overlay,Ui.modal,Ui.drawer,{[Ui.tabbed]:c}),role:"dialog","aria-describedby":void 0,...l,children:w.jsxs("div",{className:Ui.content,children:[w.jsxs("div",{className:Ui.header,children:[w.jsx("div",{className:Ui.handle}),w.jsx(Ix,{asChild:!0,children:w.jsx(Ki.Title,{children:n})})]}),w.jsx("div",{className:Ui.body,children:t})]})})]})});{const m=w.jsx(sL,{asChild:!0,children:w.jsx(bu,{as:"h2",weight:"semibold",size:"md",children:n})}),v=w.jsxs("div",{className:Ui.header,children:[m,a!==void 0&&w.jsx(pz,{className:Ui.close,"data-testid":"modal_close","aria-label":u("action.close"),children:w.jsx(Vw,{width:20,height:20})})]});return w.jsx(tL,{open:o,onOpenChange:p,children:w.jsxs(nL,{children:[w.jsx(rL,{className:De(_a.bg,_a.animate)}),w.jsx(iL,{asChild:!0,"aria-describedby":void 0,role:"dialog",...l,children:w.jsx(Iz,{className:De(r,s,_a.overlay,_a.animate,Ui.modal,Ui.dialog,{[Ui.tabbed]:c}),children:w.jsxs("div",{className:Ui.content,children:[e?null:v,e?w.jsx(Ix,{asChild:!0,children:m}):null,w.jsx("div",{className:Ui.body,children:t})]})})})]})})}},tNe=({raised:n,open:e,...t})=>{const{t:r}=Xe();return w.jsx(di,{label:r("common.reactions"),children:w.jsx(Dt,{className:De(n&&Io.raisedButton),"aria-expanded":e,"aria-haspopup":!0,kind:n||e?"primary":"secondary",iconOnly:!0,Icon:n?MY:ZTe,...t})})};function nNe({sendReaction:n,toggleRaisedHand:e,isHandRaised:t,canReact:r,errorText:i}){const{t:s}=Xe(),[o,a]=_.useState(!1),c=_.useMemo(()=>o?jv:jv.slice(0,5),[o]),l=s(t?"action.lower_hand":"action.raise_hand");return w.jsxs(w.Fragment,{children:[i&&w.jsx(Z1e,{className:Io.alert,type:"critical",title:s("error.generic"),children:i}),w.jsxs("div",{className:Io.reactionPopupMenu,children:[w.jsx("section",{className:Io.handRaiseSection,children:w.jsx(di,{label:l,caption:"H",children:w.jsx(Dt,{kind:t?"primary":"secondary","aria-keyshortcuts":"H","aria-pressed":t,"aria-label":l,onClick:()=>e(),iconOnly:!0,Icon:MY})})}),w.jsx("div",{className:Io.verticalSeperator}),w.jsx("section",{className:Io.reactionsMenuSection,children:w.jsx("menu",{className:De(o&&Io.reactionsMenuExpanded,Io.reactionsMenu),children:c.map((u,h)=>w.jsx("li",{children:w.jsx(di,{label:u.name,caption:h<bx?(h+1).toString():void 0,children:w.jsx(Dt,{kind:"secondary",className:Io.reactionButton,disabled:!r,onClick:()=>n(u),"aria-keyshortcuts":h<bx?(h+1).toString():void 0,children:u.emoji})})},u.name))})}),w.jsx("section",{style:{marginLeft:"var(--cpd-separator-spacing)"},children:w.jsx(di,{label:s(o?"action.show_less":"action.show_more"),children:w.jsx(Dt,{iconOnly:!0,"aria-label":s(o?"action.show_less":"action.show_more"),Icon:o?HTe:fTe,kind:"tertiary",onClick:()=>a(!o)})})})]})]})}function rNe({identifier:n,vm:e,...t}){const{t:r}=Xe(),{toggleRaisedHand:i,sendReaction:s}=r4(),[o,a]=_.useState(!1),[c,l]=_.useState(!1),[u,h]=_.useState(),p=Vv(e.handsRaised$.pipe(Fe(S=>!!S[n]))),m=Vv(e.reactions$.pipe(Fe(S=>!S[n])));_.useEffect(()=>{h(void 0)},[c]);const v=_.useCallback(async S=>{try{a(!0),await s(S),h(void 0),l(!1)}catch(b){h(b instanceof Error?b.message:"Unknown error"),O.error("Failed to send reaction",b)}finally{a(!1)}},[s]),g=_.useCallback(()=>{(async()=>{try{a(!0),await i(),l(!1)}catch(b){h(b instanceof Error?b.message:"Unknown error"),O.error("Failed to raise/lower hand",b)}finally{a(!1)}})()},[i]);return w.jsxs(w.Fragment,{children:[w.jsx(tNe,{disabled:o,onClick:()=>l(S=>!S),raised:!!p,open:c,...t}),w.jsx(th,{open:c,title:r("action.pick_reaction"),hideHeader:!0,classNameModal:Io.reactionPopupMenuModal,className:Io.reactionPopupMenuRoot,onDismiss:()=>l(!1),children:w.jsx(nNe,{errorText:u,isHandRaised:!!p,canReact:!o&&!!m,sendReaction:S=>void v(S),toggleRaisedHand:g})})]})}const du=({Icon:n,title:e,rageshake:t,fatal:r,children:i})=>{const{t:s}=Xe(),{confineToRoom:o}=eh(),a=_.useCallback(()=>{window.location.href="/"},[]);return w.jsxs("div",{className:Y1.error,children:[w.jsx(aTe,{className:Y1.icon,children:w.jsx(n,{})}),w.jsx(bu,{as:"h1",weight:"semibold",size:"md",children:e}),i,t&&w.jsx(y5e,{description:`***Error View***: ${e}`}),!o&&(r||location.pathname==="/"?w.jsx(Dt,{kind:"tertiary",className:Y1.homeLink,onClick:a,children:s("return_home_button")}):w.jsx(n4,{kind:"tertiary",className:Y1.homeLink,to:"/",children:s("return_home_button")}))]})},ut=n=>typeof n=="string",rg=()=>{let n,e;const t=new Promise((r,i)=>{n=r,e=i});return t.resolve=n,t.reject=e,t},JD=n=>n==null?"":""+n,iNe=(n,e,t)=>{n.forEach(r=>{e[r]&&(t[r]=e[r])})},sNe=/###/g,ZD=n=>n&&n.indexOf("###")>-1?n.replace(sNe,"."):n,QD=n=>!n||ut(n),Yg=(n,e,t)=>{const r=ut(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(QD(n))return{};const s=ZD(r[i]);!n[s]&&t&&(n[s]=new t),Object.prototype.hasOwnProperty.call(n,s)?n=n[s]:n={},++i}return QD(n)?{}:{obj:n,k:ZD(r[i])}},eF=(n,e,t)=>{const{obj:r,k:i}=Yg(n,e,Object);if(r!==void 0||e.length===1){r[i]=t;return}let s=e[e.length-1],o=e.slice(0,e.length-1),a=Yg(n,o,Object);for(;a.obj===void 0&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),a=Yg(n,o,Object),a!=null&&a.obj&&typeof a.obj[`${a.k}.${s}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${s}`]=t},oNe=(n,e,t,r)=>{const{obj:i,k:s}=Yg(n,e,Object);i[s]=i[s]||[],i[s].push(t)},DS=(n,e)=>{const{obj:t,k:r}=Yg(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,r))return t[r]},aNe=(n,e,t)=>{const r=DS(n,t);return r!==void 0?r:DS(e,t)},wZ=(n,e,t)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in n?ut(n[r])||n[r]instanceof String||ut(e[r])||e[r]instanceof String?t&&(n[r]=e[r]):wZ(n[r],e[r],t):n[r]=e[r]);return n},qh=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var cNe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const lNe=n=>ut(n)?n.replace(/[&<>"'\/]/g,e=>cNe[e]):n;class uNe{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const dNe=[" ",",","?","!",";"],hNe=new uNe(20),fNe=(n,e,t)=>{e=e||"",t=t||"";const r=dNe.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(r.length===0)return!0;const i=hNe.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let s=!i.test(n);if(!s){const o=n.indexOf(t);o>0&&!i.test(n.substring(0,o))&&(s=!0)}return s},Rx=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const r=e.split(t);let i=n;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let o,a="";for(let c=s;c<r.length;++c)if(c!==s&&(a+=t),a+=r[c],o=i[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<r.length-1)continue;s+=c-s+1;break}i=o}return i},FS=n=>n==null?void 0:n.replace("_","-"),pNe={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){var t,r;(r=(t=console==null?void 0:console[n])==null?void 0:t.apply)==null||r.call(t,console,e)}};class US{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||pNe,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,i){return i&&!this.debug?null:(ut(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new US(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new US(this.logger,e)}}var Ia=new US;class yE{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(t)||0;this.observers[r].set(t,i+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,c]=o;for(let l=0;l<c;l++)a(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,c]=o;for(let l=0;l<c;l++)a.apply(a,[e,...r])})}}class tF extends yE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r){var l,u;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,t],r&&(Array.isArray(r)?a.push(...r):ut(r)&&s?a.push(...r.split(s)):a.push(r)));const c=DS(this.data,a);return!c&&!t&&!r&&e.indexOf(".")>-1&&(e=a[0],t=a[1],r=a.slice(2).join(".")),c||!o||!ut(r)?c:Rx((u=(l=this.data)==null?void 0:l[e])==null?void 0:u[t],r,s)}addResource(e,t,r,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let a=[e,t];r&&(a=a.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(a=e.split("."),i=t,t=a[1]),this.addNamespaces(t),eF(this.data,a,i),s.silent||this.emit("added",e,t,r,i)}addResources(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in r)(ut(r[s])||Array.isArray(r[s]))&&this.addResource(e,t,s,r[s],{silent:!0});i.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,t];e.indexOf(".")>-1&&(a=e.split("."),i=r,r=t,t=a[1]),this.addNamespaces(t);let c=DS(this.data,a)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?wZ(c,r,s):c={...c,...r},eF(this.data,a,c),o.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(i=>t[i]&&Object.keys(t[i]).length>0)}toJSON(){return this.data}}var EZ={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,r,i){return n.forEach(s=>{var o;e=((o=this.processors[s])==null?void 0:o.process(e,t,r,i))??e}),e}};const nF={},rF=n=>!ut(n)&&typeof n!="boolean"&&typeof n!="number";class jS extends yE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),iNe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ia.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,t);return(r==null?void 0:r.res)!==void 0}extractFromKey(e,t){let r=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,a=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!fNe(e,r,i);if(o&&!a){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:ut(s)?[s]:s};const l=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),e=l.join(i)}return{key:e,namespaces:ut(s)?[s]:s}}translate(e,t,r){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,s=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],t),c=a[a.length-1],l=t.lng||this.language,u=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((l==null?void 0:l.toLowerCase())==="cimode"){if(u){const U=t.nsSeparator||this.options.nsSeparator;return i?{res:`${c}${U}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:c,usedParams:this.getUsedParamsDetails(t)}:`${c}${U}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:c,usedParams:this.getUsedParamsDetails(t)}:o}const h=this.resolve(e,t);let p=h==null?void 0:h.res;const m=(h==null?void 0:h.usedKey)||o,v=(h==null?void 0:h.exactUsedKey)||o,g=["[object Number]","[object Function]","[object RegExp]"],S=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject,R=t.count!==void 0&&!ut(t.count),k=jS.hasDefaultValue(t),I=R?this.pluralResolver.getSuffix(l,t.count,t):"",T=t.ordinal&&R?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",C=R&&!t.ordinal&&t.count===0,P=C&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${I}`]||t[`defaultValue${T}`]||t.defaultValue;let M=p;b&&!p&&k&&(M=P);const D=rF(M),F=Object.prototype.toString.apply(M);if(b&&M&&D&&g.indexOf(F)<0&&!(ut(S)&&Array.isArray(M))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const U=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,M,{...t,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(h.res=U,h.usedParams=this.getUsedParamsDetails(t),h):U}if(s){const U=Array.isArray(M),B=U?[]:{},V=U?v:m;for(const z in M)if(Object.prototype.hasOwnProperty.call(M,z)){const H=`${V}${s}${z}`;k&&!p?B[z]=this.translate(H,{...t,defaultValue:rF(P)?P[z]:void 0,joinArrays:!1,ns:a}):B[z]=this.translate(H,{...t,joinArrays:!1,ns:a}),B[z]===H&&(B[z]=M[z])}p=B}}else if(b&&ut(S)&&Array.isArray(p))p=p.join(S),p&&(p=this.extendTranslation(p,e,t,r));else{let U=!1,B=!1;!this.isValidLookup(p)&&k&&(U=!0,p=P),this.isValidLookup(p)||(B=!0,p=o);const z=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&B?void 0:p,H=k&&P!==p&&this.options.updateMissing;if(B||U||H){if(this.logger.log(H?"updateKey":"missingKey",l,c,o,H?P:p),s){const K=this.resolve(o,{...t,keySeparator:!1});K&&K.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let J=[];const Y=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Y&&Y[0])for(let K=0;K<Y.length;K++)J.push(Y[K]);else this.options.saveMissingTo==="all"?J=this.languageUtils.toResolveHierarchy(t.lng||this.language):J.push(t.lng||this.language);const G=(K,ee,q)=>{var Se;const Q=k&&q!==p?q:z;this.options.missingKeyHandler?this.options.missingKeyHandler(K,c,ee,Q,H,t):(Se=this.backendConnector)!=null&&Se.saveMissing&&this.backendConnector.saveMissing(K,c,ee,Q,H,t),this.emit("missingKey",K,c,ee,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?J.forEach(K=>{const ee=this.pluralResolver.getSuffixes(K,t);C&&t[`defaultValue${this.options.pluralSeparator}zero`]&&ee.indexOf(`${this.options.pluralSeparator}zero`)<0&&ee.push(`${this.options.pluralSeparator}zero`),ee.forEach(q=>{G([K],o+q,t[`defaultValue${q}`]||P)})}):G(J,o,P))}p=this.extendTranslation(p,e,t,h,r),B&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${c}:${o}`),(B||U)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}:${o}`:o,U?p:void 0))}return i?(h.res=p,h.usedParams=this.getUsedParamsDetails(t),h):p}extendTranslation(e,t,r,i,s){var l,u;var o=this;if((l=this.i18nFormat)!=null&&l.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const h=ut(e)&&(((u=r==null?void 0:r.interpolation)==null?void 0:u.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let p;if(h){const v=e.match(this.interpolator.nestingRegexp);p=v&&v.length}let m=r.replace&&!ut(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,r.lng||this.language||i.usedLng,r),h){const v=e.match(this.interpolator.nestingRegexp),g=v&&v.length;p<g&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var v=arguments.length,g=new Array(v),S=0;S<v;S++)g[S]=arguments[S];return(s==null?void 0:s[0])===g[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${t[0]}`),null):o.translate(...g,t)},r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,c=ut(a)?[a]:a;return e!=null&&(c!=null&&c.length)&&r.applyPostProcessor!==!1&&(e=EZ.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,i,s,o,a;return ut(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const l=this.extractFromKey(c,t),u=l.key;i=u;let h=l.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const p=t.count!==void 0&&!ut(t.count),m=p&&!t.ordinal&&t.count===0,v=t.context!==void 0&&(ut(t.context)||typeof t.context=="number")&&t.context!=="",g=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);h.forEach(S=>{var b,R;this.isValidLookup(r)||(a=S,!nF[`${g[0]}-${S}`]&&((b=this.utils)!=null&&b.hasLoadedNamespace)&&!((R=this.utils)!=null&&R.hasLoadedNamespace(a))&&(nF[`${g[0]}-${S}`]=!0,this.logger.warn(`key "${i}" for languages "${g.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),g.forEach(k=>{var C;if(this.isValidLookup(r))return;o=k;const I=[u];if((C=this.i18nFormat)!=null&&C.addLookupKeys)this.i18nFormat.addLookupKeys(I,u,k,S,t);else{let P;p&&(P=this.pluralResolver.getSuffix(k,t.count,t));const M=`${this.options.pluralSeparator}zero`,D=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(I.push(u+P),t.ordinal&&P.indexOf(D)===0&&I.push(u+P.replace(D,this.options.pluralSeparator)),m&&I.push(u+M)),v){const F=`${u}${this.options.contextSeparator}${t.context}`;I.push(F),p&&(I.push(F+P),t.ordinal&&P.indexOf(D)===0&&I.push(F+P.replace(D,this.options.pluralSeparator)),m&&I.push(F+M))}}let T;for(;T=I.pop();)this.isValidLookup(r)||(s=T,r=this.getResource(k,S,T,t))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,r){var s;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(s=this.i18nFormat)!=null&&s.getResource?this.i18nFormat.getResource(e,t,r,i):this.resourceStore.getResource(e,t,r,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!ut(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of t)delete i[s]}return i}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&e[r]!==void 0)return!0;return!1}}class iF{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ia.create("languageUtils")}getScriptPartFromCode(e){if(e=FS(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=FS(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(ut(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(r=>{if(t)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(t=i)}),!t&&this.options.supportedLngs&&e.forEach(r=>{if(t)return;const i=this.getLanguagePartFromCode(r);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find(s=>{if(s===i)return s;if(!(s.indexOf("-")<0&&i.indexOf("-")<0)&&(s.indexOf("-")>0&&i.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===i||s.indexOf(i)===0&&i.length>1))return s})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),ut(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],s=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return ut(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):ut(e)&&s(this.formatLanguageCode(e)),r.forEach(o=>{i.indexOf(o)<0&&s(this.formatLanguageCode(o))}),i}}const sF={zero:0,one:1,two:2,few:3,many:4,other:5},oF={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class mNe{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Ia.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=FS(e==="dev"?"en":e),i=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let o;try{o=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),oF;if(!e.match(/-|_/))return oF;const c=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(c,t)}return this.pluralRulesCache[s]=o,o}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),(r==null?void 0:r.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(i=>`${t}${i}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?r.resolvedOptions().pluralCategories.sort((i,s)=>sF[i]-sF[s]).map(i=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,r))}}const aF=function(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=aNe(n,e,t);return!s&&i&&ut(t)&&(s=Rx(n,t,r),s===void 0&&(s=Rx(e,t,r))),s},U2=n=>n.replace(/\$/g,"$$$$");class gNe{constructor(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ia.create("interpolator"),this.options=e,this.format=((t=e==null?void 0:e.interpolation)==null?void 0:t.format)||(r=>r),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:o,suffix:a,suffixEscaped:c,formatSeparator:l,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:p,nestingPrefixEscaped:m,nestingSuffix:v,nestingSuffixEscaped:g,nestingOptionsSeparator:S,maxReplaces:b,alwaysFormat:R}=e.interpolation;this.escape=t!==void 0?t:lNe,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?qh(s):o||"{{",this.suffix=a?qh(a):c||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=p?qh(p):m||qh("$t("),this.nestingSuffix=v?qh(v):g||qh(")"),this.nestingOptionsSeparator=S||",",this.maxReplaces=b||1e3,this.alwaysFormat=R!==void 0?R:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,r)=>(t==null?void 0:t.source)===r?(t.lastIndex=0,t):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,i){var m;let s,o,a;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=v=>{if(v.indexOf(this.formatSeparator)<0){const R=aF(t,c,v,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(R,void 0,r,{...i,...t,interpolationkey:v}):R}const g=v.split(this.formatSeparator),S=g.shift().trim(),b=g.join(this.formatSeparator).trim();return this.format(aF(t,c,S,this.options.keySeparator,this.options.ignoreJSONStructure),b,r,{...i,...t,interpolationkey:S})};this.resetRegExp();const u=(i==null?void 0:i.missingInterpolationHandler)||this.options.missingInterpolationHandler,h=((m=i==null?void 0:i.interpolation)==null?void 0:m.skipOnVariables)!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:v=>U2(v)},{regex:this.regexp,safeValue:v=>this.escapeValue?U2(this.escape(v)):U2(v)}].forEach(v=>{for(a=0;s=v.regex.exec(e);){const g=s[1].trim();if(o=l(g),o===void 0)if(typeof u=="function"){const b=u(e,s,i);o=ut(b)?b:""}else if(i&&Object.prototype.hasOwnProperty.call(i,g))o="";else if(h){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),o="";else!ut(o)&&!this.useRawValueToEscape&&(o=JD(o));const S=v.safeValue(o);if(e=e.replace(s[0],S),h?(v.regex.lastIndex+=o.length,v.regex.lastIndex-=s[0].length):v.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,s,o;const a=(c,l)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const h=c.split(new RegExp(`${u}[ ]*{`));let p=`{${h[1]}`;c=h[0],p=this.interpolate(p,o);const m=p.match(/'/g),v=p.match(/"/g);(((m==null?void 0:m.length)??0)%2===0&&!v||v.length%2!==0)&&(p=p.replace(/'/g,'"'));try{o=JSON.parse(p),l&&(o={...l,...o})}catch(g){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,g),`${c}${u}${p}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];o={...r},o=o.replace&&!ut(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let l=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const u=i[1].split(this.formatSeparator).map(h=>h.trim());i[1]=u.shift(),c=u,l=!0}if(s=t(a.call(this,i[1].trim(),o),o),s&&i[0]===e&&!ut(s))return s;ut(s)||(s=JD(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),l&&(s=c.reduce((u,h)=>this.format(u,h,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const vNe=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const r=n.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?t.currency||(t.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?t.range||(t.range=i.trim()):i.split(";").forEach(o=>{if(o){const[a,...c]=o.split(":"),l=c.join(":").trim().replace(/^'+|'+$/g,""),u=a.trim();t[u]||(t[u]=l),l==="false"&&(t[u]=!1),l==="true"&&(t[u]=!0),isNaN(l)||(t[u]=parseInt(l,10))}})}return{formatName:e,formatOptions:t}},Kh=n=>{const e={};return(t,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const o=r+JSON.stringify(s);let a=e[o];return a||(a=n(FS(r),i),e[o]=a),a(t)}};class yNe{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ia.create("formatter"),this.options=e,this.formats={number:Kh((t,r)=>{const i=new Intl.NumberFormat(t,{...r});return s=>i.format(s)}),currency:Kh((t,r)=>{const i=new Intl.NumberFormat(t,{...r,style:"currency"});return s=>i.format(s)}),datetime:Kh((t,r)=>{const i=new Intl.DateTimeFormat(t,{...r});return s=>i.format(s)}),relativetime:Kh((t,r)=>{const i=new Intl.RelativeTimeFormat(t,{...r});return s=>i.format(s,r.range||"day")}),list:Kh((t,r)=>{const i=new Intl.ListFormat(t,{...r});return s=>i.format(s)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Kh(t)}format(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(a=>a.indexOf(")")>-1)){const a=s.findIndex(c=>c.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,a)].join(this.formatSeparator)}return s.reduce((a,c)=>{var h;const{formatName:l,formatOptions:u}=vNe(c);if(this.formats[l]){let p=a;try{const m=((h=i==null?void 0:i.formatParams)==null?void 0:h[i.interpolationkey])||{},v=m.locale||m.lng||i.locale||i.lng||r;p=this.formats[l](a,v,{...u,...i,...m})}catch(m){this.logger.warn(m)}return p}else this.logger.warn(`there was no format function for ${l}`);return a},e)}}const _Ne=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class bNe extends yE{constructor(e,t,r){var s,o;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=Ia.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],(o=(s=this.backend)==null?void 0:s.init)==null||o.call(s,r,i.backend,i)}queueLoad(e,t,r,i){const s={},o={},a={},c={};return e.forEach(l=>{let u=!0;t.forEach(h=>{const p=`${l}|${h}`;!r.reload&&this.store.hasResourceBundle(l,h)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?o[p]===void 0&&(o[p]=!0):(this.state[p]=1,u=!1,o[p]===void 0&&(o[p]=!0),s[p]===void 0&&(s[p]=!0),c[h]===void 0&&(c[h]=!0)))}),u||(a[l]=!0)}),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(c)}}loaded(e,t,r){const i=e.split("|"),s=i[0],o=i[1];t&&this.emit("failedLoading",s,o,t),!t&&r&&this.store.addResourceBundle(s,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const a={};this.queue.forEach(c=>{oNe(c.loaded,[s],o),_Ne(c,e),t&&c.errors.push(t),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(l=>{a[l]||(a[l]={});const u=c.loaded[l];u.length&&u.forEach(h=>{a[l][h]===void 0&&(a[l][h]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(c=>!c.done)}read(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:r,tried:i,wait:s,callback:o});return}this.readingCalls++;const a=(l,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(l&&u&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,r,i+1,s*2,o)},s);return}o(l,u)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const l=c(e,t);l&&typeof l.then=="function"?l.then(u=>a(null,u)).catch(a):a(null,l)}catch(l){a(l)}return}return c(e,t,a)}prepareLoading(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();ut(e)&&(e=this.languageUtils.toResolveHierarchy(e)),ut(t)&&(t=[t]);const s=this.queueLoad(e,t,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${t}loading namespace ${s} for language ${i} failed`,o),!o&&a&&this.logger.log(`${t}loaded namespace ${s} for language ${i}`,a),this.loaded(e,o,a)})}saveMissing(e,t,r,i,s){var c,l,u,h,p;let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((l=(c=this.services)==null?void 0:c.utils)!=null&&l.hasLoadedNamespace&&!((h=(u=this.services)==null?void 0:u.utils)!=null&&h.hasLoadedNamespace(t))){this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if((p=this.backend)!=null&&p.create){const m={...o,isUpdate:s},v=this.backend.create.bind(this.backend);if(v.length<6)try{let g;v.length===5?g=v(e,t,r,i,m):g=v(e,t,r,i),g&&typeof g.then=="function"?g.then(S=>a(null,S)).catch(a):a(null,g)}catch(g){a(g)}else v(e,t,r,i,a,m)}!e||!e[0]||this.store.addResource(e[0],t,r,i)}}}const cF=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),ut(n[1])&&(e.defaultValue=n[1]),ut(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(r=>{e[r]=t[r]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),lF=n=>{var e,t;return ut(n.ns)&&(n.ns=[n.ns]),ut(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),ut(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),((t=(e=n.supportedLngs)==null?void 0:e.indexOf)==null?void 0:t.call(e,"cimode"))<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n},X1=()=>{},SNe=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class qv extends yE{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=lF(e),this.services={},this.logger=Ia,this.modules={external:[]},SNe(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),t.defaultNS==null&&t.ns&&(ut(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const i=cF();this.options={...i,...this.options,...lF(t)},this.options.interpolation={...i.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?Ia.init(s(this.modules.logger),this.options):Ia.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=yNe;const h=new iF(this.options);this.store=new tF(this.options.resources,this.options);const p=this.services;p.logger=Ia,p.resourceStore=this.store,p.languageUtils=h,p.pluralResolver=new mNe(h,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),u&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(p.formatter=s(u),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new gNe(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new bNe(s(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(m){for(var v=arguments.length,g=new Array(v>1?v-1:0),S=1;S<v;S++)g[S-1]=arguments[S];e.emit(m,...g)}),this.modules.languageDetector&&(p.languageDetector=s(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=s(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new jS(this.services,this.options),this.translator.on("*",function(m){for(var v=arguments.length,g=new Array(v>1?v-1:0),S=1;S<v;S++)g[S-1]=arguments[S];e.emit(m,...g)}),this.modules.external.forEach(m=>{m.init&&m.init(this)})}if(this.format=this.options.interpolation.format,r||(r=X1),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=function(){return e.store[u](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=function(){return e.store[u](...arguments),e}});const c=rg(),l=()=>{const u=(h,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),c.resolve(p),r(h,p)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),c}loadResources(e){var s,o;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:X1;const i=ut(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if((i==null?void 0:i.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const a=[],c=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(h=>{h!=="cimode"&&a.indexOf(h)<0&&a.push(h)})};i?c(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(u=>c(u)),(o=(s=this.options.preload)==null?void 0:s.forEach)==null||o.call(s,l=>c(l)),this.services.backendConnector.load(a,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(l)})}else r(null)}reloadResources(e,t,r){const i=rg();return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=X1),this.services.backendConnector.reload(e,t,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&EZ.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,t){var r=this;this.isLanguageChangingTo=e;const i=rg();this.emit("languageChanging",e);const s=c=>{this.language=c,this.languages=this.services.languageUtils.toResolveHierarchy(c),this.resolvedLanguage=void 0,this.setResolvedLanguage(c)},o=(c,l)=>{l?(s(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,i.resolve(function(){return r.t(...arguments)}),t&&t(c,function(){return r.t(...arguments)})},a=c=>{var u,h;!e&&!c&&this.services.languageDetector&&(c=[]);const l=ut(c)?c:this.services.languageUtils.getBestMatchFromCodes(c);l&&(this.language||s(l),this.translator.language||this.translator.changeLanguage(l),(h=(u=this.services.languageDetector)==null?void 0:u.cacheUserLanguage)==null||h.call(u,l)),this.loadResources(l,p=>{o(p,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),i}getFixedT(e,t,r){var i=this;const s=function(o,a){let c;if(typeof a!="object"){for(var l=arguments.length,u=new Array(l>2?l-2:0),h=2;h<l;h++)u[h-2]=arguments[h];c=i.options.overloadTranslationOptionHandler([o,a].concat(u))}else c={...a};c.lng=c.lng||s.lng,c.lngs=c.lngs||s.lngs,c.ns=c.ns||s.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||s.keyPrefix);const p=i.options.keySeparator||".";let m;return c.keyPrefix&&Array.isArray(o)?m=o.map(v=>`${c.keyPrefix}${p}${v}`):m=c.keyPrefix?`${c.keyPrefix}${p}${o}`:o,i.t(m,c)};return ut(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=r,s}t(){var i;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(i=this.translator)==null?void 0:i.translate(...t)}exists(){var i;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(i=this.translator)==null?void 0:i.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(a,c)=>{const l=this.services.backendConnector.state[`${a}|${c}`];return l===-1||l===0||l===2};if(t.precheck){const a=t.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!i||o(s,e)))}loadNamespaces(e,t){const r=rg();return this.options.ns?(ut(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),t&&t(i)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=rg();ut(e)&&(e=[e]);const i=this.options.preload||[],s=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return s.length?(this.options.preload=i.concat(s),this.loadResources(o=>{r.resolve(),t&&t(o)}),r):(t&&t(),Promise.resolve())}dir(e){var i,s;if(e||(e=this.resolvedLanguage||(((i=this.languages)==null?void 0:i.length)>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=((s=this.services)==null?void 0:s.languageUtils)||new iF(cF());return t.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new qv(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:X1;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new qv(i);if((e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(a=>{s[a]=this[a]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const a=Object.keys(this.store.data).reduce((c,l)=>(c[l]={...this.store.data[l]},Object.keys(c[l]).reduce((u,h)=>(u[h]={...c[l][h]},u),{})),{});s.store=new tF(a,i),s.services.resourceStore=s.store}return s.translator=new jS(s.services,i),s.translator.on("*",function(a){for(var c=arguments.length,l=new Array(c>1?c-1:0),u=1;u<c;u++)l[u-1]=arguments[u];s.emit(a,...l)}),s.init(i,t),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const fi=qv.createInstance();fi.createInstance=qv.createInstance;fi.createInstance;fi.dir;fi.init;fi.loadResources;fi.reloadResources;fi.use;fi.changeLanguage;fi.getFixedT;const CZ=fi.t;fi.exists;fi.setDefaultNamespace;fi.hasLoadedNamespace;fi.loadNamespaces;fi.loadLanguages;var kx=(n=>(n.MISSING_MATRIX_RTC_FOCUS="MISSING_MATRIX_RTC_FOCUS",n.CONNECTION_LOST_ERROR="CONNECTION_LOST_ERROR",n.MEMBERSHIP_MANAGER_UNRECOVERABLE="MEMBERSHIP_MANAGER_UNRECOVERABLE",n.UNKNOWN_ERROR="UNKNOWN_ERROR",n))(kx||{}),i4=(n=>(n.CONFIGURATION_ISSUE="CONFIGURATION_ISSUE",n.NETWORK_CONNECTIVITY="NETWORK_CONNECTIVITY",n.RTC_SESSION_FAILURE="RTC_SESSION_FAILURE",n.UNKNOWN="UNKNOWN",n))(i4||{});class Kv extends Error{constructor(e,t,r,i){super(e),this.localisedMessage=i,this.category=r,this.code=t}}class wNe extends Kv{constructor(e){super("MatrixRTCFocusMissingError","MISSING_MATRIX_RTC_FOCUS","CONFIGURATION_ISSUE",CZ("error.matrix_rtc_focus_missing",{domain:e,brand:"Element Call",errorCode:"MISSING_MATRIX_RTC_FOCUS"})),this.domain=e}}class TZ extends Kv{constructor(){super("Connection lost","CONNECTION_LOST_ERROR","NETWORK_CONNECTIVITY")}}class ENe extends Kv{constructor(e,t){super("RTCSession Error",e,"RTC_SESSION_FAILURE",t)}}class Py extends Error{constructor(e,t){super(e),this.richMessage=t}}const CNe=()=>{const{t:n}=Xe();return w.jsx(du,{Icon:LY,title:n("error.open_elsewhere"),children:w.jsx("p",{children:n("error.open_elsewhere_description",{brand:"Element Call"})})})};class TNe extends Py{constructor(){super("App opened in another tab",w.jsx(CNe,{}))}}const INe=()=>{const{t:n}=Xe();return w.jsx(du,{Icon:bY,title:n("error.insufficient_capacity"),children:w.jsx("p",{children:n("error.insufficient_capacity_description")})})};class RNe extends Py{constructor(){super("Insufficient server capacity",w.jsx(INe,{}))}}const kNe=({error:n})=>{const{t:e}=Xe();let t,r;switch(n.category){case i4.CONFIGURATION_ISSUE:t=e("error.call_is_not_supported"),r=bY;break;default:t=e("error.generic"),r=Hw}return w.jsx(du,{Icon:r,title:t,children:w.jsx("p",{children:n.localisedMessage??w.jsx(Ci,{i18nKey:"error.unexpected_ec_error",components:[w.jsx("b",{}),w.jsx("code",{})],values:{errorCode:n.code}})})})};class xNe extends Py{constructor(e){super(e.message,w.jsx(kNe,{error:e})),this.ecError=e}}const bd=({className:n,children:e})=>{const{hideHeader:t}=eh();return w.jsxs("div",{className:De(c2.page,n),children:[!t&&w.jsxs(Su,{children:[w.jsx(Jd,{children:w.jsx(Dd,{})}),w.jsx(Zd,{})]}),w.jsx("div",{className:c2.container,children:w.jsx("div",{className:c2.content,children:e})})]})},cp=({error:n})=>{const{t:e}=Xe();return _.useEffect(()=>{O.error(n),Uw(n)},[n]),w.jsx(bd,{children:n instanceof Py?n.richMessage:w.jsx(du,{Icon:Hw,title:e("error.generic"),rageshake:!0,fatal:!0,children:w.jsx("p",{children:e("error.generic_description")})})})},_E=()=>{const{t:n}=Xe();return w.jsx(bd,{children:w.jsx("h1",{children:n("common.loading")})})},s4=_.createContext(void 0);s4.Provider;const jp=()=>_.useContext(s4);function nh(){var r;let n,e;const t=jp();return(t==null?void 0:t.state)==="valid"&&(n=(r=t.authenticated)==null?void 0:r.client,e=t.setClient),{client:n,setClient:e}}function o4(){var c,l,u;const n=jp();let e,t,r=!1,i=!0,s,o=!1,a;return(n==null?void 0:n.state)==="valid"?(e=(c=n.authenticated)==null?void 0:c.client,t=n.setClient,r=((l=n.authenticated)==null?void 0:l.isPasswordlessUser)??!1,i=!1,o=e!==void 0,a=(u=n.authenticated)==null?void 0:u.logout):(n==null?void 0:n.state)==="error"&&(s=n.error,i=!1),{client:e,setClient:t,passwordlessUser:r,loading:i,authenticated:o,logout:a,error:s}}const J1="BroadcastChannel"in window?new BroadcastChannel("load"):null,PNe=({children:n})=>{const e=Ua(),[t,r]=_.useState(void 0),i=_.useRef(!1);_.useEffect(()=>{i.current||(i.current=!0,LNe().then(r).catch(R=>O.error(R)).finally(()=>i.current=!1))},[]);const s=_.useCallback(async R=>{const k=IZ();!(t!=null&&t.client)||!k||(await t.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:k.user_id},user:k.user_id,password:k.tempPassword},R),uF({...k,passwordlessUser:!1}),r({...t,passwordlessUser:!1}))},[t]),o=_.useCallback(R=>{const k=t==null?void 0:t.client,I=R==null?void 0:R.client;k&&k!==I&&k.stopClient(),R?(uF(R.session),r({widgetApi:null,client:R.client,passwordlessUser:R.session.passwordlessUser})):(xx(),r(null))},[t==null?void 0:t.client]),a=_.useCallback(async()=>{const R=t==null?void 0:t.client;R&&(await R.logout(!0),await R.clearStores(),xx(),r(null),await e("/"),$t.instance.setRegistrationType(gE.Guest))},[e,t==null?void 0:t.client]);_.useEffect(()=>{ct||J1==null||J1.postMessage({})},[]);const[c,l]=_.useState(void 0);Bg(J1,"message",_.useCallback(()=>{t==null||t.client.stopClient(),l(new TNe)},[t==null?void 0:t.client,l]));const[u,h]=_.useState(!1),[p,m]=_.useState(!1),[v,g]=_.useState(!1),S=_.useMemo(()=>c?{state:"error",error:c}:t===void 0?void 0:{state:"valid",authenticated:t===null?void 0:{client:t.client,isPasswordlessUser:t.passwordlessUser,changePassword:s,logout:a},setClient:o,disconnected:u,supportedFeatures:{reactions:p,thumbnails:v}},[c,s,t,a,o,u,p,v]),b=_.useCallback((R,k,I)=>{h(ANe(R,I))},[]);return _.useEffect(()=>{if(t){if(window.matrixclient=t.client,window.passwordlessUser=t.passwordlessUser,$t.hasInstance()&&$t.instance.onLoginStatusChanged(),t.client&&t.client.on(qe.Sync,b),t.widgetApi){g(!1);const R=t.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.reaction"),k=t.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.room.redaction"),I=t.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.reaction"),T=t.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.room.redaction");!R||!I||!k||!T?(O.warn("Widget does not support reactions"),m(!1)):m(!0)}else m(!0),g(!0);return()=>{t.client&&t.client.removeListener(qe.Sync,b)}}},[t,b]),c?w.jsx(cp,{error:c}):w.jsx(s4.Provider,{value:S,children:n})};async function LNe(){if(ct){O.log("Using a matryoshka client");const n=await ct.client;return{widgetApi:ct.api,client:n,passwordlessUser:!1}}else{const{initSPA:n}=await rv(async()=>{const{initSPA:e}=await import("./spa-B4U_dboI.js");return{initSPA:e}},[],import.meta.url);return n(IZ,xx)}}const xx=()=>localStorage.removeItem("matrix-auth-store"),uF=n=>localStorage.setItem("matrix-auth-store",JSON.stringify(n)),IZ=()=>{const n=localStorage.getItem("matrix-auth-store");if(n)return JSON.parse(n)},ANe=(n,e)=>{var t;return n==="ERROR"&&((t=e==null?void 0:e.error)==null?void 0:t.name)==="ConnectionError"};function Ly(n){const[{success:e,loading:t,displayName:r,avatarUrl:i,error:s},o]=_.useState(()=>{let c;return n&&(c=n.getUser(n.getUserId())??void 0),{success:!1,loading:!1,displayName:c==null?void 0:c.rawDisplayName,avatarUrl:c==null?void 0:c.avatarUrl,error:void 0}});_.useEffect(()=>{const c=(u,{displayName:h,avatarUrl:p})=>{o({success:!1,loading:!1,displayName:h,avatarUrl:p,error:void 0})};let l;if(n){const u=n.getUserId();l=n.getUser(u),l==null||l.on(Ll.DisplayName,c),l==null||l.on(Ll.AvatarUrl,c)}return()=>{l&&(l.removeListener(Ll.DisplayName,c),l.removeListener(Ll.AvatarUrl,c))}},[n]);const a=_.useCallback(async({displayName:c,avatar:l,removeAvatar:u})=>{if(n){o(h=>({...h,loading:!0,error:void 0,success:!1}));try{await n.setDisplayName(c);let h;u?await n.setAvatarUrl(""):l&&({content_uri:h}=await n.uploadContent(l),await n.setAvatarUrl(h)),o(p=>({...p,displayName:c,avatarUrl:u?void 0:h??p.avatarUrl,loading:!1,success:!0}))}catch(h){o(p=>({...p,loading:!1,error:h instanceof Error?h:Error(h),success:!1}))}}else O.error("Client not initialized before calling saveProfile")},[n]);return{loading:t,error:s,displayName:r,avatarUrl:i,saveProfile:a,success:e}}const MNe="_settingsModal_1dkeq_8",ONe="_volumeSlider_1dkeq_20",dF={settingsModal:MNe,volumeSlider:ONe},NNe="_tabContainer_1nnp9_8",DNe="_tabList_1nnp9_14",hF={tabContainer:NNe,tabList:DNe};function FNe({label:n,tab:e,onTabChange:t,tabs:r}){const i=_.useId();return w.jsxs("div",{className:hF.tabContainer,children:[w.jsx(cTe,{role:"tablist","aria-label":n,className:hF.tabList,children:r.map(({key:s,name:o})=>w.jsx(hTe,{"aria-controls":`${i}[${s}]`,onClick:()=>t(s),active:s===e,children:o}))}),r.map(({key:s,content:o})=>w.jsx("div",{id:`${i}[${s}]`,style:{display:s===e?void 0:"none"},children:o}))]})}const UNe="_fieldRow_iwncy_8",jNe="_field_iwncy_8",$Ne="_rightAlign_iwncy_21",BNe="_inputField_iwncy_33",HNe="_disabled_iwncy_52",VNe="_prefix_iwncy_110",GNe="_checkboxField_iwncy_131",qNe="_checkbox_iwncy_131",KNe="_description_iwncy_168",WNe="_errorMessage_iwncy_197",zNe="_noLabel_iwncy_210",js={fieldRow:UNe,field:jNe,rightAlign:$Ne,inputField:BNe,disabled:HNe,prefix:VNe,checkboxField:GNe,checkbox:qNe,description:KNe,errorMessage:WNe,noLabel:zNe},YNe=(n,e)=>_.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("path",{d:"m20 6-11 11-5-5"})),XNe=_.forwardRef(YNe);class RZ extends Error{constructor(e,t){super(t(e,{lng:"en"})),this.translatedMessage=t(e)}}class JNe extends RZ{}const fF=(n,e)=>new JNe(n,e);function _t({children:n,rightAlign:e,className:t}){return w.jsx("div",{className:De(js.fieldRow,{[js.rightAlign]:e},t),children:n})}function ZNe({children:n,className:e}){return w.jsx("div",{className:De(js.field,e),children:n})}const yn=_.forwardRef(({id:n,label:e,className:t,type:r,checked:i,prefix:s,suffix:o,description:a,disabled:c,min:l,...u},h)=>{const p=_.useId();return w.jsxs(ZNe,{className:De(r==="checkbox"?js.checkboxField:js.inputField,{[js.prefix]:!!s,[js.disabled]:c},t),children:[s&&w.jsx("span",{children:s}),r==="textarea"?w.jsx("textarea",{id:n,ref:h,disabled:c,"aria-describedby":p,...u}):w.jsx("input",{id:n,ref:h,type:r,checked:i,disabled:c,"aria-describedby":p,min:l,...u}),w.jsxs("label",{htmlFor:n,children:[r==="checkbox"&&w.jsx("div",{className:js.checkbox,children:w.jsx(XNe,{})}),e]}),o&&w.jsx("span",{children:o}),a&&w.jsx("p",{id:p,className:e?js.description:De(js.description,js.noLabel),children:a})]})});yn.displayName="InputField";const Eu=({error:n})=>w.jsx("p",{className:js.errorMessage,children:n instanceof RZ?n.translatedMessage:n.message}),QNe="_avatarInputField_1ep5q_8",e8e="_avatar_1ep5q_8",t8e="_fileInput_1ep5q_17",n8e="_edit_1ep5q_21",Z1={avatarInputField:QNe,avatar:e8e,fileInput:t8e,edit:n8e},kZ=({id:n,label:e,className:t,avatarUrl:r,userId:i,displayName:s,onRemoveAvatar:o,...a})=>{const{t:c}=Xe(),[l,u]=_.useState(!1),[h,p]=_.useState(void 0),[m,v]=_.useState(!1),g=_.useRef(null);_.useEffect(()=>{const R=g.current,k=I=>{const T=I;T.target.files&&T.target.files.length>0?(p(URL.createObjectURL(T.target.files[0])),u(!1)):p(void 0)};return R.addEventListener("change",k),()=>{R==null||R.removeEventListener("change",k)}});const S=_.useCallback(()=>{g.current.click()},[g]),b=_.useCallback(()=>{u(!0),o()},[o]);return w.jsxs("div",{className:De(Z1.avatarInputField,t),children:[w.jsx(Np,{id:i,className:Z1.avatar,name:s,size:Op.XL,src:l?void 0:h||r}),w.jsx("input",{id:n,accept:"image/*",ref:g,type:"file",className:Z1.fileInput,role:"button","aria-label":e,...a}),w.jsx("div",{className:Z1.edit,children:(r||h)&&!l?w.jsxs(dL,{title:c("action.edit"),showTitle:!1,open:m,onOpenChange:v,trigger:w.jsx(Dt,{iconOnly:!0,Icon:r7,kind:"tertiary",size:"sm","aria-label":c("action.edit")}),children:[w.jsx(rp,{Icon:tIe,label:c("action.upload_file"),onSelect:S}),w.jsx(rp,{Icon:GTe,label:c("action.remove"),kind:"critical",onSelect:b})]}):w.jsx(Dt,{type:"button",iconOnly:!0,Icon:r7,kind:"tertiary",size:"sm","aria-label":c("action.edit"),onClick:S})})]})};kZ.displayName="AvatarInputField";const r8e="_content_gj715_8",i8e="_avatarFieldRow_gj715_15",pF={content:r8e,avatarFieldRow:i8e},s8e=({client:n})=>{const{t:e}=Xe(),{error:t,displayName:r,avatarUrl:i,saveProfile:s}=Ly(n),o=_.useMemo(()=>n.getUserId(),[n]),a=_.useRef(null),c=_.useRef(!1),l=_.useCallback(()=>{c.current=!0},[]),u=_.useRef(!1),h=_.useCallback(()=>{u.current=!0,c.current=!0},[]);return _.useEffect(()=>{const p=a.current;return()=>{if(c.current){const m=new FormData(p),v=m.get("displayName"),g=m.get("avatar"),S=typeof g=="string"?g.length:(g==null?void 0:g.size)??0,b=typeof v=="string"?v:(v==null?void 0:v.name)??null;if(!b)return;s({displayName:b,avatar:g&&S>0?g:void 0,removeAvatar:u.current&&(!g||S===0)}).catch(R=>{O.error("Failed to save profile",R)})}}},[s]),w.jsxs("form",{onChange:l,ref:a,className:pF.content,children:[w.jsx(_t,{className:pF.avatarFieldRow,children:o&&r&&w.jsx(kZ,{id:"avatar",name:"avatar",label:e("common.avatar"),avatarUrl:i,userId:o,displayName:r,onRemoveAvatar:h})}),w.jsx(_t,{children:w.jsx(yn,{id:"userId",name:"userId",label:e("common.username"),type:"text",disabled:!0,value:n.getUserId()})}),w.jsx(_t,{children:w.jsx(yn,{id:"displayName",name:"displayName",label:e("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:e("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),t&&w.jsx(_t,{children:w.jsx(Eu,{error:t})})]})},o8e="_feedback_19yh9_8",xZ={feedback:o8e},a4=()=>w.jsxs(Ci,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",w.jsx(_d,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",w.jsx(_d,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),a8e=({roomId:n})=>{const{t:e}=Xe(),{submitRageshake:t,sending:r,sent:i,error:s}=t4(),o=g5e(),a=_.useCallback(h=>{h.preventDefault();const p=new FormData(h.target),m=p.get("description"),v=typeof m=="string"?m:"",g=!!p.get("sendLogs"),S=Es(16);t({description:v,sendLogs:g,rageshakeRequestId:S,roomId:n}).catch(b=>{O.error("Failed to send feedback rageshake",b)}),n&&g&&o(n,S)},[t,n,o]),[c,l]=mE(),u=w.jsx(Xt,{size:"sm",children:w.jsxs(Ci,{i18nKey:"settings.opt_in_description",children:[w.jsx(a4,{}),w.jsx("br",{}),"You may withdraw consent by unchecking this box. If you are currently in a call, this setting will take effect at the end of the call."]})});return w.jsxs("div",{children:[w.jsx("h4",{children:e("common.analytics")}),w.jsx(_t,{children:w.jsx(yn,{id:"optInAnalytics",type:"checkbox",checked:c??void 0,description:u,onChange:h=>{l==null||l(h.target.checked)}})}),w.jsx("h4",{children:e("settings.feedback_tab_h4")}),w.jsx(Xt,{children:e("settings.feedback_tab_body")}),w.jsxs("form",{onSubmit:a,children:[w.jsx(_t,{children:w.jsx(yn,{className:xZ.feedback,id:"description",name:"description",label:e("settings.feedback_tab_description_label"),placeholder:e("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&w.jsxs(_t,{children:[w.jsx(yn,{id:"sendLogs",name:"sendLogs",label:e("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),w.jsx(Dt,{type:"submit",disabled:r,children:e(r?"submitting":"action.submit")})]}),w.jsxs(_t,{children:[s&&w.jsx(Eu,{error:s}),i&&w.jsx(Xt,{children:e("settings.feedback_tab_thank_you")})]})]})]})};var ub={exports:{}},c8e=ub.exports,mF;function l8e(){return mF||(mF=1,function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(c8e,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(g){return g==="debug"&&(g="log"),typeof console===t?!1:g==="trace"&&r?c:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===t&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==t&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return l(g)||h.apply(this,arguments)}function m(g,S){var b=this,R,k,I,T="loglevel";typeof g=="string"?T+=":"+g:typeof g=="symbol"&&(T=void 0);function C(U){var B=(i[U]||"silent").toUpperCase();if(!(typeof window===t||!T)){try{window.localStorage[T]=B;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+B+";"}catch{}}}function P(){var U;if(!(typeof window===t||!T)){try{U=window.localStorage[T]}catch{}if(typeof U===t)try{var B=window.document.cookie,V=encodeURIComponent(T),z=B.indexOf(V+"=");z!==-1&&(U=/^([^;]+)/.exec(B.slice(z+V.length+1))[1])}catch{}return b.levels[U]===void 0&&(U=void 0),U}}function M(){if(!(typeof window===t||!T)){try{window.localStorage.removeItem(T)}catch{}try{window.document.cookie=encodeURIComponent(T)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var B=U;if(typeof B=="string"&&b.levels[B.toUpperCase()]!==void 0&&(B=b.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=b.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+U)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return I??k??R},b.setLevel=function(U,B){return I=D(U),B!==!1&&C(I),u.call(b)},b.setDefaultLevel=function(U){k=D(U),P()||b.setLevel(U,!1)},b.resetLevel=function(){I=null,M(),u.call(b)},b.enableAll=function(U){b.setLevel(b.levels.TRACE,U)},b.disableAll=function(U){b.setLevel(b.levels.SILENT,U)},b.rebuild=function(){if(o!==b&&(R=D(o.getLevel())),u.call(b),o===b)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var F=P();F!=null&&(I=D(F)),u.call(b)}o=new m,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[S];return b||(b=s[S]=new m(S,o.methodFactory)),b};var v=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(ub)),ub.exports}var u8e=l8e();const d8e=Wo(u8e);var h8e=(n,e,t)=>new Promise((r,i)=>{var s=c=>{try{a(t.next(c))}catch(l){i(l)}},o=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(n,e)).next())}),f8e=[he.ConnectionStateChanged,he.RoomMetadataChanged,he.ActiveSpeakersChanged,he.ConnectionQualityChanged,he.ParticipantConnected,he.ParticipantDisconnected,he.ParticipantPermissionsChanged,he.ParticipantMetadataChanged,he.ParticipantNameChanged,he.ParticipantAttributesChanged,he.TrackMuted,he.TrackUnmuted,he.TrackPublished,he.TrackUnpublished,he.TrackStreamStateChanged,he.TrackSubscriptionFailed,he.TrackSubscriptionPermissionChanged,he.TrackSubscriptionStatusChanged],p8e=[...f8e,he.LocalTrackPublished,he.LocalTrackUnpublished];ue.TrackPublished,ue.TrackUnpublished,ue.TrackMuted,ue.TrackUnmuted,ue.TrackStreamStateChanged,ue.TrackSubscribed,ue.TrackUnsubscribed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionFailed,ue.LocalTrackPublished,ue.LocalTrackUnpublished;var m8e=[ue.ConnectionQualityChanged,ue.IsSpeakingChanged,ue.ParticipantMetadataChanged,ue.ParticipantPermissionsChanged,ue.TrackMuted,ue.TrackUnmuted,ue.TrackPublished,ue.TrackUnpublished,ue.TrackStreamStateChanged,ue.TrackSubscriptionFailed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionStatusChanged];[...m8e,ue.LocalTrackPublished,ue.LocalTrackUnpublished];var g8e=d8e.getLogger("lk-components-js");g8e.setDefaultLevel("WARN");function v8e(n,...e){return new Mn(r=>{const i=()=>{r.next(n)};return e.forEach(o=>{n.on(o,i)}),()=>{e.forEach(o=>{n.off(o,i)})}}).pipe(un(n))}function y8e(n,e){return new Mn(r=>{const i=(...o)=>{r.next(o)};return n.on(e,i),()=>{n.off(e,i)}})}function _8e(n,e,t=!0){var r;const i=()=>h8e(this,null,function*(){try{const a=yield Mc.getLocalDevices(n,t);s.next(a)}catch(a){e==null||e(a)}}),s=new xr,o=s.pipe(iZ(()=>{var a;(a=navigator==null?void 0:navigator.mediaDevices)==null||a.removeEventListener("devicechange",i)}));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(r=navigator==null?void 0:navigator.mediaDevices)==null||r.addEventListener("devicechange",i)}return NS(Mc.getLocalDevices(n,t).catch(a=>(e==null||e(a),[])),o)}function c4(n,...e){return new Mn(r=>{const i=()=>{r.next(n)};return e.forEach(o=>{n.on(o,i)}),()=>{e.forEach(o=>{n.off(o,i)})}}).pipe(un(n))}function l4(n){return c4(n,ue.TrackMuted,ue.TrackUnmuted,ue.ParticipantPermissionsChanged,ue.TrackPublished,ue.TrackUnpublished,ue.LocalTrackPublished,ue.LocalTrackUnpublished,ue.MediaDevicesError,ue.TrackSubscriptionStatusChanged).pipe(Fe(t=>{const{isMicrophoneEnabled:r,isCameraEnabled:i,isScreenShareEnabled:s}=t,o=t.getTrackPublication(pe.Source.Microphone),a=t.getTrackPublication(pe.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:r,isScreenShareEnabled:s,cameraTrack:a,microphoneTrack:o,participant:t}}))}function b8e(n,e={}){var t;let r;const i=new Mn(c=>(r=c,()=>a.unsubscribe())).pipe(un(Array.from(n.remoteParticipants.values()))),s=(t=e.additionalRoomEvents)!=null?t:p8e,o=Array.from(new Set([he.ParticipantConnected,he.ParticipantDisconnected,he.ConnectionStateChanged,...s])),a=v8e(n,...o).subscribe(c=>r==null?void 0:r.next(Array.from(c.remoteParticipants.values())));return n.remoteParticipants.size>0&&(r==null||r.next(Array.from(n.remoteParticipants.values()))),i}new TextEncoder;new TextDecoder;function j2(n,e,t){const r=_.useRef(!1),i=t||r.current;r.current||(r.current=t);const s=_.useMemo(()=>_8e(n,()=>O.error("Error creating MediaDeviceObserver"),i).pipe(un([])),[n,i]),o=st(_.useMemo(()=>s.pipe(Fe(h=>{var m;let p=new Map(h.map((v,g)=>[v.deviceId,v.label?{type:"name",name:v.label}:{type:"number",number:g+1}]));return n==="audiooutput"&&p.size&&!p.has("")&&!p.has("default")&&(p=new Map([["",{type:"default",name:((m=h[0])==null?void 0:m.label)||null}],...p])),p})),[n,s])),[a,c]=Mr(e),l=_.useMemo(()=>{if(o.size)return a!==void 0&&o.has(a)||o.size===1&&o.has("")?a:o.keys().next().value},[o,a]),u=st(_.useMemo(()=>s.pipe(Fe(h=>{var p;return(p=h.find(m=>m.deviceId===l))==null?void 0:p.groupId})),[s,l]));return _.useMemo(()=>({available:o,selectedId:l,selectedGroupId:u,select:c}),[o,l,u,c])}const $2={available:new Map,selectedId:void 0,selectedGroupId:void 0,select:()=>{}},S8e={audioInput:$2,audioOutput:$2,videoInput:$2,startUsingDeviceNames:()=>{},stopUsingDeviceNames:()=>{}},PZ=_.createContext(S8e),w8e=({children:n})=>{const[e,t]=_.useState(0),r=e>0,i=j2("audioinput",a5e,r),s=j2("audiooutput",c5e,r),o=j2("videoinput",l5e,r),a=_.useCallback(()=>t(u=>u+1),[t]),c=_.useCallback(()=>t(u=>u-1),[t]),l=_.useMemo(()=>({audioInput:i,audioOutput:s,videoInput:o,startUsingDeviceNames:a,stopUsingDeviceNames:c}),[i,s,o,a,c]);return w.jsx(PZ.Provider,{value:l,children:n})},rh=()=>_.useContext(PZ),E8e=(n,e=!0)=>_.useEffect(()=>{if(e)return n.startUsingDeviceNames(),n.stopUsingDeviceNames},[n,e]),C8e=()=>{const{t:n}=Xe(),[e,t]=Mr(lZ),[r,i]=Mr(uZ),[s,o]=Mr(e4),a=(u,h)=>{h(u.target.checked)},[c,l]=Mr(oZ);return w.jsxs("div",{children:[w.jsx(Xt,{children:n("settings.preferences_tab.introduction")}),w.jsx(_t,{children:w.jsx(yn,{id:"showHandRaisedTimer",label:n("settings.preferences_tab.show_hand_raised_timer_label"),description:n("settings.preferences_tab.show_hand_raised_timer_description"),type:"checkbox",checked:e,onChange:u=>a(u,t)})}),w.jsx(_t,{children:w.jsx(yn,{id:"showReactions",label:n("settings.preferences_tab.reactions_show_label"),description:n("settings.preferences_tab.reactions_show_description"),type:"checkbox",checked:r,onChange:u=>a(u,i)})}),w.jsx(_t,{children:w.jsx(yn,{id:"playReactionSound",label:n("settings.preferences_tab.reactions_play_sound_label"),description:n("settings.preferences_tab.reactions_play_sound_description"),type:"checkbox",checked:s,onChange:u=>a(u,o)})}),w.jsx(_t,{children:w.jsx(yn,{id:"developerSettingsTab",type:"checkbox",checked:c,label:n("settings.preferences_tab.developer_mode_label"),description:n("settings.preferences_tab.developer_mode_label_description"),onChange:u=>l(u.target.checked)})})]})};function LZ(n,[e,t]){return Math.min(t,Math.max(e,n))}function T8e(n){const e=_.useRef({value:n,previous:n});return _.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var $S=_.forwardRef((n,e)=>{const{children:t,...r}=n,i=_.Children.toArray(t),s=i.find(R8e);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return w.jsx(Px,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return w.jsx(Px,{...r,ref:e,children:t})});$S.displayName="Slot";var Px=_.forwardRef((n,e)=>{const{children:t,...r}=n;if(_.isValidElement(t)){const i=x8e(t),s=k8e(r,t.props);return t.type!==_.Fragment&&(s.ref=e?Ha(e,i):i),_.cloneElement(t,s)}return _.Children.count(t)>1?_.Children.only(null):null});Px.displayName="SlotClone";var I8e=({children:n})=>w.jsx(w.Fragment,{children:n});function R8e(n){return _.isValidElement(n)&&n.type===I8e}function k8e(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function x8e(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var P8e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],bE=P8e.reduce((n,e)=>{const t=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?$S:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function L8e(n){const e=n+"CollectionProvider",[t,r]=Ba(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:v,children:g}=m,S=Re.useRef(null),b=Re.useRef(new Map).current;return w.jsx(i,{scope:v,itemMap:b,collectionRef:S,children:g})};o.displayName=e;const a=n+"CollectionSlot",c=Re.forwardRef((m,v)=>{const{scope:g,children:S}=m,b=s(a,g),R=sn(v,b.collectionRef);return w.jsx($S,{ref:R,children:S})});c.displayName=a;const l=n+"CollectionItemSlot",u="data-radix-collection-item",h=Re.forwardRef((m,v)=>{const{scope:g,children:S,...b}=m,R=Re.useRef(null),k=sn(v,R),I=s(l,g);return Re.useEffect(()=>(I.itemMap.set(R,{ref:R,...b}),()=>void I.itemMap.delete(R))),w.jsx($S,{[u]:"",ref:k,children:S})});h.displayName=l;function p(m){const v=s(n+"CollectionConsumer",m);return Re.useCallback(()=>{const S=v.collectionRef.current;if(!S)return[];const b=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((I,T)=>b.indexOf(I.ref.current)-b.indexOf(T.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:c,ItemSlot:h},p,r]}var AZ=["PageUp","PageDown"],MZ=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],OZ={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},$p="Slider",[Lx,A8e,M8e]=L8e($p),[NZ,lqe]=Ba($p,[M8e]),[O8e,SE]=NZ($p),DZ=_.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:u,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:m=!1,form:v,...g}=n,S=_.useRef(new Set),b=_.useRef(0),k=o==="horizontal"?N8e:D8e,[I=[],T]=zw({prop:u,defaultProp:l,onChange:U=>{var V;(V=[...S.current][b.current])==null||V.focus(),h(U)}}),C=_.useRef(I);function P(U){const B=B8e(I,U);F(U,B)}function M(U){F(U,b.current)}function D(){const U=C.current[b.current];I[b.current]!==U&&p(I)}function F(U,B,{commit:V}={commit:!1}){const z=q8e(s),H=K8e(Math.round((U-r)/s)*s+r,z),J=LZ(H,[r,i]);T((Y=[])=>{const G=j8e(Y,J,B);if(G8e(G,c*s)){b.current=G.indexOf(J);const K=String(G)!==String(Y);return K&&V&&p(G),K?G:Y}else return Y})}return w.jsx(O8e,{scope:n.__scopeSlider,name:t,disabled:a,min:r,max:i,valueIndexToChangeRef:b,thumbs:S.current,values:I,orientation:o,form:v,children:w.jsx(Lx.Provider,{scope:n.__scopeSlider,children:w.jsx(Lx.Slot,{scope:n.__scopeSlider,children:w.jsx(k,{"aria-disabled":a,"data-disabled":a?"":void 0,...g,ref:e,onPointerDown:Ze(g.onPointerDown,()=>{a||(C.current=I)}),min:r,max:i,inverted:m,onSlideStart:a?void 0:P,onSlideMove:a?void 0:M,onSlideEnd:a?void 0:D,onHomeKeyDown:()=>!a&&F(r,0,{commit:!0}),onEndKeyDown:()=>!a&&F(i,I.length-1,{commit:!0}),onStepKeyDown:({event:U,direction:B})=>{if(!a){const H=AZ.includes(U.key)||U.shiftKey&&MZ.includes(U.key)?10:1,J=b.current,Y=I[J],G=s*H*B;F(Y+G,J,{commit:!0})}}})})})})});DZ.displayName=$p;var[FZ,UZ]=NZ($p,{startEdge:"left",endEdge:"right",size:"width",direction:1}),N8e=_.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...u}=n,[h,p]=_.useState(null),m=sn(e,k=>p(k)),v=_.useRef(void 0),g=M6(i),S=g==="ltr",b=S&&!s||!S&&s;function R(k){const I=v.current||h.getBoundingClientRect(),T=[0,I.width],P=u4(T,b?[t,r]:[r,t]);return v.current=I,P(k-I.left)}return w.jsx(FZ,{scope:n.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:w.jsx(jZ,{dir:g,"data-orientation":"horizontal",...u,ref:m,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:k=>{const I=R(k.clientX);o==null||o(I)},onSlideMove:k=>{const I=R(k.clientX);a==null||a(I)},onSlideEnd:()=>{v.current=void 0,c==null||c()},onStepKeyDown:k=>{const T=OZ[b?"from-left":"from-right"].includes(k.key);l==null||l({event:k,direction:T?-1:1})}})})}),D8e=_.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...l}=n,u=_.useRef(null),h=sn(e,u),p=_.useRef(void 0),m=!i;function v(g){const S=p.current||u.current.getBoundingClientRect(),b=[0,S.height],k=u4(b,m?[r,t]:[t,r]);return p.current=S,k(g-S.top)}return w.jsx(FZ,{scope:n.__scopeSlider,startEdge:m?"bottom":"top",endEdge:m?"top":"bottom",size:"height",direction:m?1:-1,children:w.jsx(jZ,{"data-orientation":"vertical",...l,ref:h,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:g=>{const S=v(g.clientY);s==null||s(S)},onSlideMove:g=>{const S=v(g.clientY);o==null||o(S)},onSlideEnd:()=>{p.current=void 0,a==null||a()},onStepKeyDown:g=>{const b=OZ[m?"from-bottom":"from-top"].includes(g.key);c==null||c({event:g,direction:b?-1:1})}})})}),jZ=_.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...l}=n,u=SE($p,t);return w.jsx(bE.span,{...l,ref:e,onKeyDown:Ze(n.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(a(h),h.preventDefault()):AZ.concat(MZ).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:Ze(n.onPointerDown,h=>{const p=h.target;p.setPointerCapture(h.pointerId),h.preventDefault(),u.thumbs.has(p)?p.focus():r(h)}),onPointerMove:Ze(n.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&i(h)}),onPointerUp:Ze(n.onPointerUp,h=>{const p=h.target;p.hasPointerCapture(h.pointerId)&&(p.releasePointerCapture(h.pointerId),s(h))})})}),$Z="SliderTrack",BZ=_.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=SE($Z,t);return w.jsx(bE.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});BZ.displayName=$Z;var Ax="SliderRange",HZ=_.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=SE(Ax,t),s=UZ(Ax,t),o=_.useRef(null),a=sn(e,o),c=i.values.length,l=i.values.map(p=>GZ(p,i.min,i.max)),u=c>1?Math.min(...l):0,h=100-Math.max(...l);return w.jsx(bE.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...n.style,[s.startEdge]:u+"%",[s.endEdge]:h+"%"}})});HZ.displayName=Ax;var Mx="SliderThumb",VZ=_.forwardRef((n,e)=>{const t=A8e(n.__scopeSlider),[r,i]=_.useState(null),s=sn(e,a=>i(a)),o=_.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return w.jsx(F8e,{...n,ref:s,index:o})}),F8e=_.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,name:i,...s}=n,o=SE(Mx,t),a=UZ(Mx,t),[c,l]=_.useState(null),u=sn(e,R=>l(R)),h=c?o.form||!!c.closest("form"):!0,p=tK(c),m=o.values[r],v=m===void 0?0:GZ(m,o.min,o.max),g=$8e(r,o.values.length),S=p==null?void 0:p[a.size],b=S?H8e(S,v,a.direction):0;return _.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),w.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${b}px)`},children:[w.jsx(Lx.ItemSlot,{scope:n.__scopeSlider,children:w.jsx(bE.span,{role:"slider","aria-label":n["aria-label"]||g,"aria-valuemin":o.min,"aria-valuenow":m,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:m===void 0?{display:"none"}:n.style,onFocus:Ze(n.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),h&&w.jsx(U8e,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:m},r)]})});VZ.displayName=Mx;var U8e=n=>{const{value:e,...t}=n,r=_.useRef(null),i=T8e(e);return _.useEffect(()=>{const s=r.current,o=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(o,"value").set;if(i!==e&&c){const l=new Event("input",{bubbles:!0});c.call(s,e),s.dispatchEvent(l)}},[i,e]),w.jsx("input",{style:{display:"none"},...t,ref:r,defaultValue:e})};function j8e(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,s)=>i-s)}function GZ(n,e,t){const s=100/(t-e)*(n-e);return LZ(s,[0,100])}function $8e(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function B8e(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function H8e(n,e,t){const r=n/2,s=u4([0,50],[0,r]);return(r-s(e)*t)*t}function V8e(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function G8e(n,e){if(e>0){const t=V8e(n);return Math.min(...t)>=e}return!0}function u4(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function q8e(n){return(String(n).split(".")[1]||"").length}function K8e(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var W8e=DZ,z8e=BZ,Y8e=HZ,X8e=VZ;const J8e="_slider_15go1_8",Z8e="_track_15go1_14",Q8e="_highlight_15go1_31",e9e="_handle_15go1_43",Q1={slider:J8e,track:Z8e,highlight:Q8e,handle:e9e},qZ=({className:n,label:e,value:t,onValueChange:r,onValueCommit:i,min:s,max:o,step:a,disabled:c})=>{const l=_.useCallback(([h])=>r(h),[r]),u=_.useCallback(([h])=>i==null?void 0:i(h),[i]);return w.jsxs(W8e,{className:De(n,Q1.slider),value:[t],onValueChange:l,onValueCommit:u,min:s,max:o,step:a,disabled:c,children:[w.jsx(z8e,{className:Q1.track,children:w.jsx(Y8e,{className:Q1.highlight})}),w.jsx(di,{placement:"top",label:Math.round(t*100).toString()+"%",children:w.jsx(X8e,{className:Q1.handle,"aria-label":e})})]})},t9e="_selection_1akwb_1",n9e="_title_1akwb_5",r9e="_separator_1akwb_10",i9e="_options_1akwb_14",s9e="_secondary_1akwb_20",ig={selection:t9e,title:n9e,separator:r9e,options:i9e,secondary:s9e},B2=({devices:n,title:e,numberedLabel:t})=>{const{t:r}=Xe(),i=_.useId(),s=_.useCallback(o=>{n.select(o.target.value)},[n]);return n.available.size==0?null:w.jsxs("div",{className:ig.selection,children:[w.jsx(bu,{type:"body",weight:"semibold",size:"sm",as:"h4",className:ig.title,children:e}),w.jsx(Wz,{className:ig.separator}),w.jsx("div",{className:ig.options,children:[...n.available].map(([o,a])=>{let c;switch(a.type){case"name":c=a.name;break;case"number":c=t(a.number);break;case"default":c=a.name===null?r("settings.devices.default"):w.jsxs(Ci,{i18nKey:"settings.devices.default_named",name:a.name,children:["Default"," ",w.jsxs("span",{className:ig.secondary,children:["(",{name:a.name},")"]})]});break}return w.jsx(qCe,{name:i,control:w.jsx(rTe,{checked:o===n.selectedId,onChange:s,value:o}),children:w.jsx(NCe,{children:c})},o)})})]})},o9e={},a9e=({client:n,livekitRoom:e})=>{var v;const{t}=Xe(),[r,i]=Mr(aZ),[s,o]=Mr(QL),[a,c]=Mr(cZ),[l,u]=Mr(Gv),[h,p]=Mr(hZ),m=_.useMemo(()=>{var g;if((g=e==null?void 0:e.engine.client.ws)!=null&&g.url){const S=new URL(e.engine.client.ws.url);return S.search="",S}return null},[e]);return w.jsxs(w.Fragment,{children:[w.jsx("p",{children:t("developer_mode.hostname",{hostname:window.location.hostname||"unknown"})}),w.jsx("p",{children:t("version",{productName:"Element Call",version:"embedded-v0.9.0-release-test.3"})}),w.jsx("p",{children:t("developer_mode.crypto_version",{version:((v=n.getCrypto())==null?void 0:v.getVersion())||"unknown"})}),w.jsx("p",{children:t("developer_mode.matrix_id",{id:n.getUserId()||"unknown"})}),w.jsx("p",{children:t("developer_mode.device_id",{id:n.getDeviceId()||"unknown"})}),w.jsx(_t,{children:w.jsx(yn,{id:"duplicateTiles",type:"number",label:t("developer_mode.duplicate_tiles_label"),value:r.toString(),min:0,onChange:_.useCallback(g=>{const S=g.target.valueAsNumber;S<0||i(Number.isNaN(S)?0:S)},[i])})}),w.jsx(_t,{children:w.jsx(yn,{id:"debugTileLayout",type:"checkbox",checked:s,label:t("developer_mode.debug_tile_layout_label"),onChange:g=>o(g.target.checked)})}),w.jsx(_t,{children:w.jsx(yn,{id:"showNonMemberTiles",type:"checkbox",label:t("developer_mode.show_non_member_tiles"),checked:!!a,onChange:_.useCallback(g=>{c(g.target.checked)},[c])})}),w.jsx(_t,{children:w.jsx(yn,{id:"showConnectionStats",type:"checkbox",label:t("developer_mode.show_connection_stats"),checked:!!l,onChange:_.useCallback(g=>{u(g.target.checked)},[u])})}),w.jsx(_t,{children:w.jsx(yn,{id:"useNewMembershipManager",type:"checkbox",label:t("developer_mode.use_new_membership_manager"),checked:!!h,onChange:_.useCallback(g=>{p(g.target.checked)},[p])})}),e?w.jsxs(w.Fragment,{children:[w.jsx("p",{children:t("developer_mode.livekit_sfu",{url:(m==null?void 0:m.href)||"unknown"})}),w.jsx("p",{children:t("developer_mode.livekit_server_info")}),w.jsxs("pre",{className:o9e.pre,children:[e.serverInfo?JSON.stringify(e.serverInfo,null,2):"undefined",e.metadata]})]}):null]})},d4="audio",h4=({open:n,onDismiss:e,tab:t,onTabChange:r,client:i,roomId:s,livekitRoom:o})=>{const{t:a}=Xe(),c=rh();E8e(c,n);const[l,u]=Mr(dZ),[h,p]=_.useState(l),[m]=Mr(oZ),v={key:"audio",name:a("common.audio"),content:w.jsx(w.Fragment,{children:w.jsxs(Z9,{children:[w.jsx(B2,{devices:c.audioInput,title:a("settings.devices.microphone"),numberedLabel:T=>a("settings.devices.microphone_numbered",{n:T})}),w.jsx(B2,{devices:c.audioOutput,title:a("settings.devices.speaker"),numberedLabel:T=>a("settings.devices.speaker_numbered",{n:T})}),w.jsxs("div",{className:dF.volumeSlider,children:[w.jsx("label",{children:a("settings.audio_tab.effect_volume_label")}),w.jsx("p",{children:a("settings.audio_tab.effect_volume_description")}),w.jsx(qZ,{label:a("video_tile.volume"),value:h,onValueChange:p,onValueCommit:u,min:0,max:1,step:.01})]})]})})},g={key:"video",name:a("common.video"),content:w.jsx(Z9,{children:w.jsx(B2,{devices:c.videoInput,title:a("settings.devices.camera"),numberedLabel:T=>a("settings.devices.camera_numbered",{n:T})})})},S={key:"preferences",name:a("common.preferences"),content:w.jsx(C8e,{})},b={key:"profile",name:a("common.profile"),content:w.jsx(s8e,{client:i})},R={key:"feedback",name:a("settings.feedback_tab_title"),content:w.jsx(a8e,{roomId:s})},k={key:"developer",name:a("settings.developer_tab_title"),content:w.jsx(a9e,{client:i,livekitRoom:o})},I=[v,g];return ct===null&&I.push(b),I.push(S,R),m&&I.push(k),w.jsx(th,{title:a("common.settings"),className:dF.settingsModal,open:n,onDismiss:e,tabbed:!0,children:w.jsx(FNe,{label:a("common.settings"),tab:t,onTabChange:r,tabs:I})})},c9e=(n,e)=>_.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),_.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),gF=_.forwardRef(c9e),l9e=(n,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),u9e=_.forwardRef(l9e),d9e=(n,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),h9e=_.forwardRef(d9e),f9e=(n,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),p9e=_.forwardRef(f9e),m9e="_userButton_t5z8t_15",g9e={userButton:m9e},v9e=({preventNavigation:n,isAuthenticated:e,isPasswordlessUser:t,userId:r,displayName:i,avatarUrl:s,onAction:o})=>{const{t:a}=Xe(),c=hi(),l=_.useMemo(()=>{const p=[];return e&&(p.push({key:"user",icon:gF,label:i,dataTestid:"usermenu_user"}),p.push({key:"settings",icon:u9e,label:a("common.settings")}),t&&!n&&p.push({key:"login",label:a("action.sign_in"),icon:h9e,dataTestid:"usermenu_login"}),!t&&!n&&p.push({key:"logout",label:a("action.sign_out"),icon:p9e,dataTestid:"usermenu_logout"})),p},[e,t,i,n,a]),[u,h]=_.useState(!1);return e?w.jsx(dL,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:u,onOpenChange:h,trigger:w.jsx("button",{"aria-label":a("common.profile"),className:g9e.userButton,"data-testid":"usermenu_open",children:e&&(!t||s)?w.jsx(Np,{id:r,name:i,size:Op.SM,src:s}):w.jsx(gF,{})}),children:l.map(({key:p,icon:m,label:v,dataTestid:g})=>w.jsx(rp,{Icon:m,label:v,"data-test-id":g,onSelect:()=>o(p)},p))}):w.jsx(n4,{to:{pathname:"/login"},state:{from:c},children:a("log_in")})},f4=({preventNavigation:n=!1})=>{const e=hi(),t=Ua(),{client:r,logout:i,authenticated:s,passwordlessUser:o}=o4(),{displayName:a,avatarUrl:c}=Ly(r),[l,u]=_.useState(!1),h=_.useCallback(()=>u(!1),[u]),[p,m]=_.useState(d4),v=_.useCallback(S=>{var b;switch(S){case"user":m("profile"),u(!0);break;case"settings":m("audio"),u(!0);break;case"logout":i==null||i();break;case"login":(b=t("/login",{state:{from:e}}))==null||b.catch(R=>O.error("Failed to navigate to login",R));break}},[t,e,i,u]),g=(r==null?void 0:r.getUserIdLocalpart())??"";return w.jsxs(w.Fragment,{children:[w.jsx(v9e,{preventNavigation:n,isAuthenticated:s,isPasswordlessUser:o,avatarUrl:c,onAction:v,userId:(r==null?void 0:r.getUserId())??"",displayName:a||(g?g.replace("@",""):"")}),r&&w.jsx(h4,{client:r,open:l,onDismiss:h,tab:p,onTabChange:m})]})};function y9e(n){return new Worker(""+new URL("IndexedDBWorker-DunQAoUH.js",import.meta.url).href,{name:n==null?void 0:n.name})}const db=new eP,_9e=n=>{const[e,t]=_.useState(()=>localStorage.getItem(n));return _.useEffect(()=>(db.on(n,t),()=>{db.off(n,t)}),[n,t]),[e,_.useCallback(r=>{t(r),localStorage.setItem(n,r),db.emit(n,r)},[n,t])]},b9e=(n,e)=>{localStorage.setItem(n,e),db.emit(n,e)};function KZ(n,e){b9e(p4(n),e)}const p4=n=>`room-shared-key-${n}`,S9e=n=>{const e=p4(n);return _9e(e)[0]};function w9e(n){WZ(Rs());const e=p4(n);return localStorage.getItem(e)}function WZ(n){!n.password||!n.roomId||KZ(n.roomId,n.password)}const E9e=()=>{const n=eh();return _.useEffect(()=>WZ(n),[n]),n.roomId&&n.password?[n.roomId,n.password]:[void 0,void 0]};function wE(n){const{client:e}=nh(),[t,r]=E9e(),i=S9e(n),s=e==null?void 0:e.getRoom(n);return _.useMemo(()=>s?i?{kind:Vt.SHARED_KEY,secret:i}:t===n?{kind:Vt.SHARED_KEY,secret:r}:s.hasEncryptionStateEvent()?{kind:Vt.PER_PARTICIPANT}:{kind:Vt.NONE}:{kind:Vt.NONE},[r,s,n,i,t])}const vF=!1,C9e="element-call-sync";async function T9e(n){let e=!!await n.store.getSavedSyncToken();return new Promise((t,r)=>{const i=(s,o,a)=>{s==="PREPARED"?e?e=!1:(n.removeListener(qe.Sync,i),t()):s==="ERROR"&&(n.removeListener(qe.Sync,i),r(a==null?void 0:a.error))};n.on(qe.Sync,i)})}async function zZ(n,e){var a;let t;try{t=window.indexedDB}catch(c){O.warn("Could not get indexDB from window.",c)}const r={fallbackICEServerAllowed:vF,isVoipWithNoMediaAllowed:(a=gt.get().features)==null?void 0:a.feature_group_calls_without_video_and_audio};t&&localStorage?r.store=new pB({indexedDB:window.indexedDB,localStorage,dbName:C9e,workerFactory:()=>new y9e}):localStorage&&(r.store=new pv({localStorage}));const{e2eEnabled:i}=Rs();i||O.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=_w({...r,...n,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:i,fallbackICEServerAllowed:vF});e||await s.clearStores();try{await s.store.startup()}catch(c){O.error("Error starting matrix client indexDB store. Falling back to memory store.",c),s.store=new pv({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(c){O.warn(c,"Make sure to clear client stores before initializing the rust crypto.")}const o=T9e(s);return await s.startClient({clientWellKnownPollPeriod:60*10}),await o,s}function Ay(n){return n.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function I9e(n,e){return`#${Ay(n)}:${e.getDomain()}`}function YZ(n){const e=n.split(":",2);if(e.length===2&&e[0][0]==="#"){if(e[1]===gt.defaultServerName())return e[0];throw new Error("Unsupported remote room alias")}return n}async function XZ(n,e,t){O.log("Creating room for group call");const r=n.createRoom({visibility:TP.Private,preset:oy.PublicChat,name:e,room_alias_name:t?void 0:Ay(e),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[n.getUserId()]:100}}}),i=await new Promise((o,a)=>{r.catch(u=>{a(u),l()});const c=u=>{r.then(h=>{u.roomId===h.room_id&&(o(u.roomId),l())},h=>{O.error("Failed to wait for the room to arrive",h)})},l=()=>{n.off(qe.Room,c)};n.on(qe.Room,c)});let s;return t==Vt.SHARED_KEY&&(s=I$(16),KZ(i,s)),{roomId:i,alias:t?void 0:I9e(e,n),password:s}}function JZ(n,e,t,r){return`${window.location.protocol}//${window.location.host}${EE(n,e,t)}`}function EE(n,e,t,r){return`/room/#${t?"/"+Ay(t):""}?${Cke(n,e).toString()}`}const m4=n=>{const[e,t]=_.useState(void 0),[r,i]=_.useState(void 0),s=_.useRef(void 0);s.current||(s.current=_w({baseUrl:gt.defaultHomeserverUrl()})),_.useEffect(()=>{ct||s.current.registerRequest({}).catch(a=>{var c,l,u,h,p,m,v;t((p=(h=(u=(l=(c=a.data)==null?void 0:c.params["m.login.terms"])==null?void 0:l.policies)==null?void 0:u.privacy_policy)==null?void 0:h.en)==null?void 0:p.url),i((v=(m=a.data)==null?void 0:m.params["m.login.recaptcha"])==null?void 0:v.public_key)})},[]);const o=_.useCallback(async(a,c,l,u,h)=>{const p=new OP({matrixClient:s.current,doRequest:async k=>s.current.registerRequest({username:a,password:c,auth:k||void 0}),stateUpdated:(k,I)=>{if(I.error)throw new Error(I.error);k==="m.login.terms"?p.submitAuthDict({type:"m.login.terms"}).catch(T=>{O.error(T)}):k==="m.login.recaptcha"&&p.submitAuthDict({type:"m.login.recaptcha",response:u}).catch(T=>{O.error(T)})},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:m,access_token:v,device_id:g}=await p.attemptAuth();await(n==null?void 0:n.logout(!0));const S=await zZ({baseUrl:gt.defaultHomeserverUrl(),accessToken:v,userId:m,deviceId:g},!1);await S.setDisplayName(l);const b={user_id:m,device_id:g,access_token:v,passwordlessUser:h};h&&(b.tempPassword=c);const R=S.getUser(S.getUserId());return R.setRawDisplayName(l),R.setDisplayName(l),[S,b]},[n]);return{privacyPolicyUrl:e,recaptchaKey:r,register:o}},R9e="_buttons_1arp2_8",k9e={buttons:R9e},ZZ=({onJoin:n,open:e,onDismiss:t})=>{const{t:r}=Xe();return w.jsxs(th,{title:r("join_existing_call_modal.title"),open:e,onDismiss:t,children:[w.jsx("p",{children:r("join_existing_call_modal.text")}),w.jsxs(_t,{rightAlign:!0,className:k9e.buttons,children:[w.jsx(Dt,{onClick:t,children:r("action.no")}),w.jsx(Dt,{onClick:n,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},yF="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function g4(n){const{t:e}=Xe(),[t]=_.useState(()=>Es(16)),r=_.useRef(void 0);_.useEffect(()=>{var a;if(!n)return;const o=()=>{document.getElementById(t)&&window.grecaptcha.render(t,{sitekey:n,size:"invisible",callback:c=>{var l;return(l=r.current)==null?void 0:l.resolve(c)},"error-callback":()=>{var c;return(c=r.current)==null?void 0:c.reject(new Error)}})};if(typeof((a=window.grecaptcha)==null?void 0:a.render)=="function")o();else if(window.mxOnRecaptchaLoaded=o,!document.querySelector(`script[src="${yF}"]`)){const c=document.createElement("script");c.src=yF,c.async=!0,document.body.appendChild(c)}},[t,n]);const i=_.useCallback(async()=>n?window.grecaptcha?new Promise((o,a)=>{var u,h;const c=new MutationObserver(p=>{var m,v;for(const g of p)if(((v=(m=g.target)==null?void 0:m.style)==null?void 0:v.visibility)!=="visible"){a(fF("recaptcha_dismissed",e)),c.disconnect();return}});r.current={resolve:p=>{o(p),c.disconnect()},reject:p=>{a(p),c.disconnect()}},window.grecaptcha.execute().then(()=>{},p=>{O.error("Recaptcha execution failed",p)});const l=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');(u=l==null?void 0:l.parentNode)!=null&&u.parentNode&&c.observe((h=l==null?void 0:l.parentNode)==null?void 0:h.parentNode,{attributes:!0})}):(O.log("Recaptcha not loaded"),Promise.reject(fF("recaptcha_not_loaded",e))):Promise.resolve(""),[n,e]),s=_.useCallback(()=>{var o;(o=window.grecaptcha)==null||o.reset()},[]);return{execute:i,reset:s,recaptchaId:t}}const x9e="_form_jcuzc_8",P9e={form:x9e},CE=_.forwardRef(({children:n,className:e,onSubmit:t},r)=>w.jsx("form",{onSubmit:t,className:De(P9e.form,e),ref:r,children:n}));CE.displayName="Form";const L9e="_footer_106jg_8",A9e="_mobileLoginLink_106jg_19",M9e="_form_106jg_24",O9e="_notice_106jg_40",sg={footer:L9e,mobileLoginLink:A9e,form:M9e,notice:O9e},N9e="_container_dwllg_8",D9e="_main_dwllg_15",F9e="_logo_dwllg_23",Uf={container:N9e,main:D9e,logo:F9e},_F=n=>{n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296};class U9e{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:t,separator:r,dictionaries:i,style:s,seed:o}=e;this.dictionaries=i,this.separator=r,this.length=t,this.style=s,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.
Length provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((t,r)=>{let i;e?(i=(o=>{if(typeof o=="string"){const a=o.split("").map(l=>l.charCodeAt(0)).reduce((l,u)=>l+u,1),c=Math.floor(Number(a));return _F(c)}return _F(o)})(e),e=4294967296*i):i=Math.random();let s=r[Math.floor(i*r.length)]||"";if(this.style==="lowerCase")s=s.toLowerCase();else if(this.style==="capital"){const[o,...a]=s.split("");s=o.toUpperCase()+a.join("")}else this.style==="upperCase"&&(s=s.toUpperCase());return t?`${t}${this.separator}${s}`:`${s}`},"")}}const bF={separator:"_",dictionaries:[]},j9e=n=>{const e=[...n&&n.dictionaries||bF.dictionaries],t={...bF,...n,length:n&&n.length||e.length,dictionaries:e};if(!n||!n.dictionaries||!n.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new U9e(t).generate()};var $9e=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],B9e=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],H9e=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const V9e=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function QZ(){return j9e({dictionaries:[H9e,$9e,B9e,V9e],style:"lowerCase",length:3,separator:"-"})}const G9e=()=>{const{setClient:n}=nh(),[e,t]=_.useState(!1),[r,i]=_.useState(),[s]=mE(),{recaptchaKey:o,register:a}=m4(),{execute:c,reset:l,recaptchaId:u}=g4(o),[h,p]=_.useState(!1),m=_.useCallback(()=>p(!1),[p]),[v,g]=_.useState(),S=Ua(),{t:b}=Xe(),R=_.useCallback(k=>{k.preventDefault();const I=new FormData(k.target),T=YZ(I.get("callName")),C=I.get("displayName");async function P(){i(void 0),t(!0);const M=await c(),D=QZ(),[F,U]=await a(D,Es(16),C,M,!0);let B;try{B=await XZ(F,T,Vt.SHARED_KEY)}catch(V){if(!n)throw V;if(V.errcode==="M_ROOM_IN_USE"){g(()=>{var H;n({client:F,session:U});const z=Ay(T);(H=S(`/${z}`))==null||H.catch(J=>{O.error("Failed to navigate to alias localpart",J)})}),t(!1),p(!0);return}else throw V}if(!n)throw new Error("setClient is undefined");if(!B.password)throw new Error("Failed to create room with shared secret");n({client:F,session:U}),await S(EE(B.roomId,{kind:Vt.SHARED_KEY,secret:B.password},T))}P().catch(M=>{O.error(M),t(!1),i(M),l()})},[a,l,c,S,p,n]);return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:Uf.container,children:[w.jsxs(Su,{children:[w.jsx(Jd,{children:w.jsx(Dd,{})}),w.jsx(Zd,{hideMobile:!0,children:w.jsx(f4,{})})]}),w.jsxs("main",{className:Uf.main,children:[w.jsx(Dd,{className:Uf.logo}),w.jsx(bu,{size:"lg",weight:"semibold",children:b("start_new_call")}),w.jsxs(CE,{className:sg.form,onSubmit:R,children:[w.jsx(_t,{children:w.jsx(yn,{id:"callName",name:"callName",label:b("call_name"),placeholder:b("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),w.jsx(_t,{children:w.jsx(yn,{id:"displayName",name:"displayName",label:b("common.display_name"),placeholder:b("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),s===null&&w.jsx(Xt,{size:"sm",className:sg.notice,children:w.jsx(a4,{})}),w.jsx(Xt,{size:"sm",className:sg.notice,children:w.jsxs(Ci,{i18nKey:"unauthenticated_view_eula_caption",children:['By clicking "Go", you agree to our'," ",w.jsx(_d,{href:gt.get().eula,children:"End User Licensing Agreement (EULA)"})]})}),r&&w.jsx(_t,{children:w.jsx(Eu,{error:r})}),w.jsx(Dt,{type:"submit",size:"lg",disabled:e,"data-testid":"home_go",children:b(e?"common.loading":"action.go")}),w.jsx("div",{id:u})]})]}),w.jsxs("footer",{className:sg.footer,children:[w.jsx(Xt,{className:sg.mobileLoginLink,children:w.jsx(Aa,{to:"/login","data-testid":"home_login",children:b("unauthenticated_view_login_button")})}),w.jsx(Xt,{children:w.jsxs(Ci,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",w.jsx(Aa,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),v&&w.jsx(ZZ,{onJoin:v,open:h,onDismiss:m})]})},Wh={};function SF(n,e){if(Wh[e.roomId])return Wh[e.roomId];if(!e||!e.timeline){const i=Number.MAX_SAFE_INTEGER;return Wh[e.roomId]=i,i}const t=n.getUserId();if(e.getMyMembership()!==ze.Join){const i=e.currentState.getStateEvents("m.room.member",t);if(i&&!Array.isArray(i)){const s=i.getTs();return Wh[e.roomId]=s,s}}for(let i=e.timeline.length-1;i>=0;--i){const o=e.timeline[i].getTs();if(o)return Wh[e.roomId]=o,o}const r=Number.MAX_SAFE_INTEGER;return Wh[e.roomId]=r,r}function q9e(n,e){return e.sort((t,r)=>SF(n,r)-SF(n,t))}const K9e=n=>{var e,t;if(!n.hasEncryptionStateEvent()&&!w9e(n.roomId))return!1;switch(n.getJoinRule()){case Sc.Public:return!0;case Sc.Knock:switch(n.getMyMembership()){case ze.Join:case ze.Knock:return!0;case ze.Invite:return((t=(e=n.getLiveTimeline().getState($e.FORWARDS))==null?void 0:e.getStateEvents(ie.RoomMember,n.myUserId))==null?void 0:t.getPrevContent().membership)===Sc.Knock;default:return!1}default:return n.getMyMembership()===ze.Join}},W9e=n=>{var e,t;switch(n.getMyMembership()){case ze.Join:return!!((t=(e=n.getLiveTimeline().getState($e.FORWARDS))==null?void 0:e.events)!=null&&t.get(ie.GroupCallMemberPrefix));case ze.Knock:return!0;default:return!1}};function z9e(n){const[e,t]=_.useState([]);return _.useEffect(()=>{function r(){const i=n.getRooms().filter(W9e).filter(K9e),o=q9e(n,i).map(a=>{const c=n.matrixRTC.getRoomSession(a);return{roomAlias:a.getCanonicalAlias()??void 0,roomName:a.name,avatarUrl:a.getMxcAvatarUrl(),room:a,session:c,participants:c.memberships.filter(l=>l.sender).map(l=>a.getMember(l.sender)).filter(l=>l)}});t(o)}return r(),n.matrixRTC.on(ak.SessionStarted,r),n.on(Je.MyMembership,r),()=>{n.matrixRTC.off(ak.SessionStarted,r),n.off(Je.MyMembership,r)}},[n]),e}const Y9e="_form_1vjc2_8",X9e="_fieldRow_1vjc2_16",J9e="_button_1vjc2_24",Z9e="_notice_1vjc2_32",og={form:Y9e,fieldRow:X9e,button:J9e,notice:Z9e},Q9e="_callTileSpacer_l4ywf_8",e7e="_callTile_l4ywf_8",t7e="_callTileLink_l4ywf_28",n7e="_callInfo_l4ywf_40",r7e="_callName_l4ywf_53",i7e="_callList_l4ywf_63",s7e="_disabled_l4ywf_74",lc={callTileSpacer:Q9e,callTile:e7e,callTileLink:t7e,callInfo:n7e,callName:r7e,callList:i7e,disabled:s7e},o7e=({rooms:n,client:e})=>w.jsx(w.Fragment,{children:w.jsxs("div",{className:lc.callList,children:[n.map(({room:t,roomName:r,avatarUrl:i,participants:s})=>w.jsx(a7e,{client:e,name:r,avatarUrl:i,room:t,participants:s},t.roomId)),n.length>3&&w.jsxs(w.Fragment,{children:[w.jsx("div",{className:lc.callTileSpacer}),w.jsx("div",{className:lc.callTileSpacer})]})]})}),a7e=({name:n,avatarUrl:e,room:t,client:r})=>{const{t:i}=Xe(),s=wE(t.roomId),[o,a]=_.useState(!1),c=_.useCallback(u=>{u.stopPropagation(),u.preventDefault(),a(!0),r.leave(t.roomId).catch(()=>a(!1))},[t,r]),l=w.jsxs(w.Fragment,{children:[w.jsx(Np,{id:t.roomId,name:n,size:Op.LG,src:e}),w.jsx("div",{className:lc.callInfo,children:w.jsx(Xt,{weight:"semibold",className:lc.callName,children:n})}),w.jsx(qq,{onClick:c,disabled:o,"aria-label":i("action.remove"),children:w.jsx(Vw,{})})]});return w.jsx("div",{className:lc.callTile,children:o?w.jsx("span",{className:De(lc.callTileLink,lc.disabled),children:l}):w.jsx(xw,{to:EE(t.roomId,s,t.name),className:lc.callTileLink,children:l})})},c7e=({client:n})=>{const[e,t]=_.useState(!1),[r,i]=_.useState(),[s]=mE(),o=Ua(),{t:a}=Xe(),[c,l]=_.useState(!1),u=_.useCallback(()=>l(!1),[l]),h=_.useCallback(S=>{S.preventDefault();const R=new FormData(S.target).get("callName"),k=typeof R=="string"?YZ(R):"";async function I(){i(void 0),t(!0);const T=await XZ(n,k,Vt.SHARED_KEY);if(!T.password)throw new Error("Failed to create room with shared secret");await o(EE(T.roomId,{kind:Vt.SHARED_KEY,secret:T.password},k))}I().catch(T=>{T.errcode==="M_ROOM_IN_USE"?(v(Ay(k)),t(!1),i(void 0),l(!0)):(O.error(T),t(!1),i(T))})},[n,o,l]),p=z9e(n),[m,v]=_.useState(),g=_.useCallback(()=>{var S;(S=o(`/${m}`))==null||S.catch(b=>{O.error("Failed to navigate to existing alias",b)})},[o,m]);return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:Uf.container,children:[w.jsxs(Su,{children:[w.jsx(Jd,{children:w.jsx(Dd,{})}),w.jsx(Zd,{children:w.jsx(f4,{})})]}),w.jsxs("main",{className:Uf.main,children:[w.jsx(Dd,{className:Uf.logo}),w.jsx(bu,{size:"lg",weight:"semibold",children:a("start_new_call")}),w.jsxs(CE,{className:og.form,onSubmit:h,children:[w.jsxs(_t,{className:og.fieldRow,children:[w.jsx(yn,{id:"callName",name:"callName",label:a("call_name"),placeholder:a("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),w.jsx(Dt,{type:"submit",size:"lg",className:og.button,disabled:e,"data-testid":"home_go",children:a(e?"common.loading":"action.go")})]}),s===null&&w.jsx(Xt,{size:"sm",className:og.notice,children:w.jsx(a4,{})}),r&&w.jsx(_t,{className:og.fieldRow,children:w.jsx(Eu,{error:r})})]}),p.length>0&&w.jsx(o7e,{rooms:p,client:n})]})]}),w.jsx(ZZ,{onJoin:g,open:c,onDismiss:u})]})};function My(n){_.useEffect(()=>{const e="Element Call";document.title=n?`${e} | ${n}`:e},[n])}const eQ=()=>{const{t:n}=Xe();My(n("common.home"));const e=jp();return e?e.state==="error"?w.jsx(cp,{error:e.error}):e.authenticated?w.jsx(c7e,{client:e.authenticated.client}):w.jsx(G9e,{}):w.jsx(_E,{})},l7e=(n,e)=>_.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),_.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),_.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),_.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),_.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),_.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),_.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),tQ=_.forwardRef(l7e),u7e="_logo_1gx2r_8",d7e="_container_1gx2r_14",h7e="_content_1gx2r_22",f7e="_formContainer_1gx2r_30",p7e="_authLinks_1gx2r_62",Sa={logo:u7e,container:d7e,content:h7e,formContainer:f7e,authLinks:p7e};function m7e(n){return _.useCallback(async(e,t,r)=>{const i=_w({baseUrl:e}),s=new OP({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:t},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:o,access_token:a,device_id:c}=await s.attemptAuth(),l={user_id:o,access_token:a,device_id:c,passwordlessUser:!1};return await(n==null?void 0:n.logout(!0)),[await zZ({baseUrl:e,accessToken:a,userId:o,deviceId:c},!1),l]},[n])}const g7e=()=>{var g,S;const{t:n}=Xe();My(n("login_title"));const{client:e,setClient:t}=nh(),r=m7e(e),i=gt.defaultHomeserverUrl(),s=_.useRef(null),o=_.useRef(null),a=Ua(),c=hi(),[l,u]=_.useState(!1),[h,p]=_.useState(),m=_.useCallback(b=>{if(b.preventDefault(),u(!0),!i||!s.current||!o.current){p(Error("Login parameters are undefined")),u(!1);return}r(i,s.current.value,o.current.value).then(async([R,k])=>{if(!t)return;t({client:R,session:k});const I=c.state;I&&I.from?await a(I.from):await a("/"),$t.instance.eventLogin.track()}).catch(R=>{p(R),u(!1)})},[r,c,a,i,t]);let v=(g=gt.defaultServerName())==null?void 0:g.slice(0,25);return v=(v==null?void 0:v.length)!==((S=gt.defaultServerName())==null?void 0:S.length)?v+"...":v,w.jsx(w.Fragment,{children:w.jsx("div",{className:Sa.container,children:w.jsxs("div",{className:Sa.content,children:[w.jsxs("div",{className:Sa.formContainer,children:[w.jsx(tQ,{width:"auto",height:"auto",className:Sa.logo}),w.jsx("h2",{children:n("log_in")}),w.jsx("h4",{children:n("login_subheading")}),w.jsxs("form",{onSubmit:m,children:[w.jsx(_t,{children:w.jsx(yn,{type:"text",ref:s,placeholder:n("common.username"),label:n("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${v}`,"data-testid":"login_username"})}),w.jsx(_t,{children:w.jsx(yn,{type:"password",ref:o,placeholder:n("common.password"),label:n("common.password"),"data-testid":"login_password"})}),h&&w.jsx(_t,{children:w.jsx(Eu,{error:h})}),w.jsx(_t,{children:w.jsx(Dt,{type:"submit",disabled:l,"data-testid":"login_login",children:n(l?"logging_in":"login_title")})})]})]}),w.jsxs("div",{className:Sa.authLinks,children:[w.jsx("p",{children:n("login_auth_links_prompt")}),w.jsx("p",{children:w.jsxs(Ci,{i18nKey:"login_auth_links",children:[w.jsx(Aa,{to:"/register",children:"Create an account"})," Or ",w.jsx(Aa,{to:"/",children:"Access as a guest"})]})})]})]})})})},v7e=()=>{const{t:n}=Xe();My(n("action.register"));const{loading:e,authenticated:t,passwordlessUser:r,client:i,setClient:s}=o4(),o=_.useRef(null),a=Ua(),c=hi(),[l,u]=_.useState(!1),[h,p]=_.useState(),[m,v]=_.useState(""),[g,S]=_.useState(""),{recaptchaKey:b,register:R}=m4(i),{execute:k,reset:I,recaptchaId:T}=g4(b),C=_.useCallback(P=>{P.preventDefault();const M=new FormData(P.target),D=M.get("userName"),F=M.get("password"),U=M.get("passwordConfirmation");if(F!==U)return;(async()=>{u(!0);const V=await k(),[z,H]=await R(D,F,D,V,r);if(i&&(i!=null&&i.groupCallEventHandler)&&r)for(const J of i.groupCallEventHandler.groupCalls.values()){const Y=J.room.roomId;try{await z.joinRoom(Y)}catch(G){G.errcode==="M_LIMIT_EXCEEDED"?(await Td(G.data.retry_after_ms),await z.joinRoom(Y)):(Uw(G),O.error(`Couldn't join room ${Y}`,G))}}s==null||s({client:z,session:H}),$t.instance.eventSignup.cacheSignupEnd(new Date)})().then(async()=>{var V,z;(V=c.state)!=null&&V.from?await a((z=c.state)==null?void 0:z.from):await a("/")}).catch(V=>{p(V),u(!1),I()})},[R,c,a,r,I,k,i,s]);return _.useEffect(()=>{var P,M;m&&g&&m!==g?(P=o.current)==null||P.setCustomValidity(n("register.passwords_must_match")):(M=o.current)==null||M.setCustomValidity("")},[m,g,n]),_.useEffect(()=>{var P;!e&&t&&!r&&!l&&((P=a("/"))==null||P.catch(M=>{O.error("Failed to navigate to /",M)}))},[e,a,t,r,l]),e?w.jsx(_E,{}):($t.instance.eventSignup.cacheSignupStart(new Date),w.jsx(w.Fragment,{children:w.jsx("div",{className:Sa.container,children:w.jsxs("div",{className:Sa.content,children:[w.jsxs("div",{className:Sa.formContainer,children:[w.jsx(tQ,{width:"auto",height:"auto",className:Sa.logo}),w.jsx("h2",{children:n("register_heading")}),w.jsxs("form",{onSubmit:C,children:[w.jsx(_t,{children:w.jsx(yn,{type:"text",name:"userName",placeholder:n("common.username"),label:n("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${gt.defaultServerName()}`,"data-testid":"register_username"})}),w.jsx(_t,{children:w.jsx(yn,{required:!0,name:"password",type:"password",onChange:P=>v(P.target.value),value:m,placeholder:n("common.password"),label:n("common.password"),"data-testid":"register_password"})}),w.jsx(_t,{children:w.jsx(yn,{required:!0,type:"password",name:"passwordConfirmation",onChange:P=>S(P.target.value),value:g,placeholder:n("register_confirm_password_label"),label:n("register_confirm_password_label"),ref:o,"data-testid":"register_confirm_password"})}),w.jsx(Xt,{size:"sm",children:w.jsxs(Ci,{i18nKey:"recaptcha_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",w.jsx(_d,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",w.jsx(_d,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",w.jsx("br",{}),'By clicking "Register", you agree to our'," ",w.jsx(_d,{href:gt.get().eula,children:"End User Licensing Agreement (EULA)"})]})}),h&&w.jsx(_t,{children:w.jsx(Eu,{error:h})}),w.jsx(_t,{children:w.jsx(Dt,{type:"submit",disabled:l,"data-testid":"register_register",children:n(l?"register.registering":"action.register")})}),w.jsx("div",{id:T})]})]}),w.jsx("div",{className:Sa.authLinks,children:w.jsxs(Ci,{i18nKey:"register_auth_links",children:[w.jsx("p",{children:"Already have an account?"}),w.jsxs("p",{children:[w.jsx(Aa,{to:"/login",children:"Log in"})," Or ",w.jsx(Aa,{to:"/",children:"Access as a guest"})]})]})})]})})}))},y7e="_form_1wfyo_8",_7e="_headline_1wfyo_18",b7e="_container_1wfyo_37",S7e="_main_1wfyo_45",w7e="_footer_1wfyo_62",ag={form:y7e,headline:_7e,container:b7e,main:S7e,footer:w7e};function nQ(){const{setClient:n}=nh(),{privacyPolicyUrl:e,recaptchaKey:t,register:r}=m4(),{execute:i,reset:s,recaptchaId:o}=g4(t),a=_.useCallback(async c=>{if(!n)throw new Error("No client context");if(ct)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const l=await i(),u=QZ(),[h,p]=await r(u,Es(16),c,l,!0);n({client:h,session:p})}catch(l){throw s(),l}},[i,s,r,n]);return{privacyPolicyUrl:e,registerPasswordlessUser:a,recaptchaId:o}}const E7e=()=>{const[n,e]=_.useState(!1),[t,r]=_.useState(),{registerPasswordlessUser:i,recaptchaId:s}=nQ(),o=_.useCallback(l=>{l.preventDefault(),e(!0);const h=new FormData(l.target).get("displayName");i(typeof h=="string"?h:"").catch(m=>{O.error("Failed to register passwordless user",l),e(!1),r(m)})},[i]),{t:a}=Xe(),c=hi();return w.jsxs(w.Fragment,{children:[w.jsxs(Su,{children:[w.jsx(Jd,{children:w.jsx(Dd,{})}),w.jsx(Zd,{children:w.jsx(f4,{preventNavigation:!0})})]}),w.jsxs("div",{className:ag.container,children:[w.jsxs("main",{className:ag.main,children:[w.jsx(bu,{size:"xl",weight:"semibold",className:ag.headline,children:a("lobby.join_as_guest")}),w.jsxs(CE,{className:ag.form,onSubmit:o,children:[w.jsx(_t,{children:w.jsx(yn,{id:"displayName",name:"displayName",label:a("common.display_name"),placeholder:a("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),w.jsx(Xt,{size:"sm",children:w.jsxs(Ci,{i18nKey:"room_auth_view_eula_caption",children:['By clicking "Join call now", you agree to our'," ",w.jsx(_d,{href:gt.get().eula,children:"End User Licensing Agreement (EULA)"})]})}),t&&w.jsx(_t,{children:w.jsx(Eu,{error:t})}),w.jsx(Dt,{type:"submit",size:"lg",disabled:n,"data-testid":"joincall_joincall",children:a(n?"common.loading":"room_auth_view_continue_button")}),w.jsx("div",{id:s})]})]}),w.jsx(Xt,{className:ag.footer,children:w.jsxs(Ci,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",w.jsx(Aa,{to:"/register",state:{from:c},children:"Create an account"})]})})]})]})};var wg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rQ(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var iQ={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(wg,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(g){return g==="debug"&&(g="log"),typeof console===t?!1:g==="trace"&&r?c:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===t&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==t&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return l(g)||h.apply(this,arguments)}function m(g,S){var b=this,R,k,I,T="loglevel";typeof g=="string"?T+=":"+g:typeof g=="symbol"&&(T=void 0);function C(U){var B=(i[U]||"silent").toUpperCase();if(!(typeof window===t||!T)){try{window.localStorage[T]=B;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+B+";"}catch{}}}function P(){var U;if(!(typeof window===t||!T)){try{U=window.localStorage[T]}catch{}if(typeof U===t)try{var B=window.document.cookie,V=encodeURIComponent(T),z=B.indexOf(V+"=");z!==-1&&(U=/^([^;]+)/.exec(B.slice(z+V.length+1))[1])}catch{}return b.levels[U]===void 0&&(U=void 0),U}}function M(){if(!(typeof window===t||!T)){try{window.localStorage.removeItem(T)}catch{}try{window.document.cookie=encodeURIComponent(T)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var B=U;if(typeof B=="string"&&b.levels[B.toUpperCase()]!==void 0&&(B=b.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=b.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+U)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return I??k??R},b.setLevel=function(U,B){return I=D(U),B!==!1&&C(I),u.call(b)},b.setDefaultLevel=function(U){k=D(U),P()||b.setLevel(U,!1)},b.resetLevel=function(){I=null,M(),u.call(b)},b.enableAll=function(U){b.setLevel(b.levels.TRACE,U)},b.disableAll=function(U){b.setLevel(b.levels.SILENT,U)},b.rebuild=function(){if(o!==b&&(R=D(o.getLevel())),u.call(b),o===b)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var F=P();F!=null&&(I=D(F)),u.call(b)}o=new m,o.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[g];return S||(S=s[g]=new m(g,o.methodFactory)),S};var v=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})})(iQ);var C7e=iQ.exports;const T7e=rQ(C7e);var Ox=function(n,e){return Ox=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Ox(n,e)};function Gc(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ox(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function I7e(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,[])).next())})}function sQ(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function lp(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function BS(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function HS(n,e,t){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function jf(n){return this instanceof jf?(this.v=n,this):new jf(n)}function R7e(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(m){return function(v){return Promise.resolve(v).then(m,h)}}function a(m,v){r[m]&&(i[m]=function(g){return new Promise(function(S,b){s.push([m,g,S,b])>1||c(m,g)})},v&&(i[m]=v(i[m])))}function c(m,v){try{l(r[m](v))}catch(g){p(s[0][3],g)}}function l(m){m.value instanceof jf?Promise.resolve(m.value.v).then(u,h):p(s[0][2],m)}function u(m){c("next",m)}function h(m){c("throw",m)}function p(m,v){m(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function k7e(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof lp=="function"?lp(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function yr(n){return typeof n=="function"}function v4(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var H2=v4(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function VS(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Oy=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=lp(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(yr(u))try{u()}catch(g){s=g instanceof H2?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=lp(h),m=p.next();!m.done;m=p.next()){var v=m.value;try{wF(v)}catch(g){s=s??[],g instanceof H2?s=HS(HS([],BS(s)),BS(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new H2(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)wF(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&VS(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&VS(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),oQ=Oy.EMPTY;function aQ(n){return n instanceof Oy||n&&"closed"in n&&yr(n.remove)&&yr(n.add)&&yr(n.unsubscribe)}function wF(n){yr(n)?n():n.unsubscribe()}var x7e={Promise:void 0},P7e={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,HS([n,e],BS(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function cQ(n){P7e.setTimeout(function(){throw n})}function EF(){}function hb(n){n()}var y4=function(n){Gc(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,aQ(t)&&t.add(r)):r.destination=M7e,r}return e.create=function(t,r,i){return new Nx(t,r,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Oy),L7e=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){e_(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){e_(r)}else e_(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){e_(t)}},n}(),Nx=function(n){Gc(e,n);function e(t,r,i){var s=n.call(this)||this,o;return yr(t)||!t?o={next:t??void 0,error:r??void 0,complete:i??void 0}:o=t,s.destination=new L7e(o),s}return e}(y4);function e_(n){cQ(n)}function A7e(n){throw n}var M7e={closed:!0,next:EF,error:A7e,complete:EF},_4=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function lQ(n){return n}function O7e(n){return n.length===0?lQ:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var ks=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=D7e(e)?e:new Nx(e,t,r);return hb(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=CF(t),new t(function(i,s){var o=new Nx({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[_4]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return O7e(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=CF(e),new e(function(r,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},n.create=function(e){return new n(e)},n}();function CF(n){var e;return(e=n??x7e.Promise)!==null&&e!==void 0?e:Promise}function N7e(n){return n&&yr(n.next)&&yr(n.error)&&yr(n.complete)}function D7e(n){return n&&n instanceof y4||N7e(n)&&aQ(n)}function F7e(n){return yr(n==null?void 0:n.lift)}function Ny(n){return function(e){if(F7e(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function GS(n,e,t,r,i){return new U7e(n,e,t,r,i)}var U7e=function(n){Gc(e,n);function e(t,r,i,s,o,a){var c=n.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=s?function(l){try{s(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(y4),j7e=v4(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),uQ=function(n){Gc(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new TF(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new j7e},e.prototype.next=function(t){var r=this;hb(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=lp(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;hb(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;hb(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?oQ:(this.currentObservers=null,a.push(t),new Oy(function(){r.currentObservers=null,VS(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new ks;return t.source=this,t},e.create=function(t,r){return new TF(t,r)},e}(ks),TF=function(n){Gc(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:oQ},e}(uQ);(function(n){Gc(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(uQ);var $7e={now:function(){return Date.now()}},B7e=function(n){Gc(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(Oy),IF={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,HS([n,e],BS(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},H7e=function(n){Gc(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),IF.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&IF.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,VS(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(B7e),RF=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=$7e.now,n}(),V7e=function(n){Gc(e,n);function e(t,r){r===void 0&&(r=RF.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(RF);new V7e(H7e);function G7e(n){return n&&yr(n.schedule)}function q7e(n){return n[n.length-1]}function dQ(n){return G7e(q7e(n))?n.pop():void 0}var hQ=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function fQ(n){return yr(n==null?void 0:n.then)}function pQ(n){return yr(n[_4])}function mQ(n){return Symbol.asyncIterator&&yr(n==null?void 0:n[Symbol.asyncIterator])}function gQ(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function K7e(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var vQ=K7e();function yQ(n){return yr(n==null?void 0:n[vQ])}function _Q(n){return R7e(this,arguments,function(){var e,t,r,i;return sQ(this,function(s){switch(s.label){case 0:e=n.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,jf(e.read())];case 3:return t=s.sent(),r=t.value,i=t.done,i?[4,jf(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,jf(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function bQ(n){return yr(n==null?void 0:n.getReader)}function Dy(n){if(n instanceof ks)return n;if(n!=null){if(pQ(n))return W7e(n);if(hQ(n))return z7e(n);if(fQ(n))return Y7e(n);if(mQ(n))return SQ(n);if(yQ(n))return X7e(n);if(bQ(n))return J7e(n)}throw gQ(n)}function W7e(n){return new ks(function(e){var t=n[_4]();if(yr(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function z7e(n){return new ks(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function Y7e(n){return new ks(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,cQ)})}function X7e(n){return new ks(function(e){var t,r;try{for(var i=lp(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function SQ(n){return new ks(function(e){Z7e(n,e).catch(function(t){return e.error(t)})})}function J7e(n){return SQ(_Q(n))}function Z7e(n,e){var t,r,i,s;return I7e(this,void 0,void 0,function(){var o,a;return sQ(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=k7e(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Sd(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function wQ(n,e){return e===void 0&&(e=0),Ny(function(t,r){t.subscribe(GS(r,function(i){return Sd(r,n,function(){return r.next(i)},e)},function(){return Sd(r,n,function(){return r.complete()},e)},function(i){return Sd(r,n,function(){return r.error(i)},e)}))})}function EQ(n,e){return e===void 0&&(e=0),Ny(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function Q7e(n,e){return Dy(n).pipe(EQ(e),wQ(e))}function eDe(n,e){return Dy(n).pipe(EQ(e),wQ(e))}function tDe(n,e){return new ks(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function nDe(n,e){return new ks(function(t){var r;return Sd(t,e,function(){r=n[vQ](),Sd(t,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return yr(r==null?void 0:r.return)&&r.return()}})}function CQ(n,e){if(!n)throw new Error("Iterable cannot be null");return new ks(function(t){Sd(t,e,function(){var r=n[Symbol.asyncIterator]();Sd(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function rDe(n,e){return CQ(_Q(n),e)}function iDe(n,e){if(n!=null){if(pQ(n))return Q7e(n,e);if(hQ(n))return tDe(n,e);if(fQ(n))return eDe(n,e);if(mQ(n))return CQ(n,e);if(yQ(n))return nDe(n,e);if(bQ(n))return rDe(n,e)}throw gQ(n)}function sDe(n,e){return e?iDe(n,e):Dy(n)}v4(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function TE(n,e){return Ny(function(t,r){var i=0;t.subscribe(GS(r,function(s){r.next(n.call(e,s,i++))}))})}function oDe(n,e,t,r,i,s,o,a){var c=[],l=0,u=0,h=!1,p=function(){h&&!c.length&&!l&&e.complete()},m=function(g){return l<r?v(g):c.push(g)},v=function(g){l++;var S=!1;Dy(t(g,u++)).subscribe(GS(e,function(b){e.next(b)},function(){S=!0},void 0,function(){if(S)try{l--;for(var b=function(){var R=c.shift();o||v(R)};c.length&&l<r;)b();p()}catch(R){e.error(R)}}))};return n.subscribe(GS(e,m,function(){h=!0,p()})),function(){}}function TQ(n,e,t){return t===void 0&&(t=1/0),yr(e)?TQ(function(r,i){return TE(function(s,o){return e(r,s,i,o)})(Dy(n(r,i)))},t):(typeof e=="number"&&(t=e),Ny(function(r,i){return oDe(r,i,n,t)}))}function aDe(n){return TQ(lQ,n)}function cDe(){return aDe(1)}function kF(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cDe()(sDe(n,dQ(n)))}function IE(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=dQ(n);return Ny(function(r,i){(t?kF(n,r,t):kF(n,r)).subscribe(i)})}var lDe="lk";function b4(n){return typeof n>"u"?!1:uDe(n)||dDe(n)}function uDe(n){var e;return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("track")&&typeof((e=n.publication)==null?void 0:e.track)<"u":!1}function dDe(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("publication")&&typeof n.publication<"u":!1}function hDe(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&typeof n.publication>"u":!1}function fDe(n){if(typeof n=="string"||typeof n=="number")return`${n}`;if(hDe(n))return`${n.participant.identity}_${n.source}_placeholder`;if(b4(n))return`${n.participant.identity}_${n.publication.source}_${n.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${n}`)}var pDe=[he.ConnectionStateChanged,he.RoomMetadataChanged,he.ActiveSpeakersChanged,he.ConnectionQualityChanged,he.ParticipantConnected,he.ParticipantDisconnected,he.ParticipantPermissionsChanged,he.ParticipantMetadataChanged,he.ParticipantNameChanged,he.ParticipantAttributesChanged,he.TrackMuted,he.TrackUnmuted,he.TrackPublished,he.TrackUnpublished,he.TrackStreamStateChanged,he.TrackSubscriptionFailed,he.TrackSubscriptionPermissionChanged,he.TrackSubscriptionStatusChanged],mDe=[...pDe,he.LocalTrackPublished,he.LocalTrackUnpublished];ue.TrackPublished,ue.TrackUnpublished,ue.TrackMuted,ue.TrackUnmuted,ue.TrackStreamStateChanged,ue.TrackSubscribed,ue.TrackUnsubscribed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionFailed,ue.LocalTrackPublished,ue.LocalTrackUnpublished;var gDe=[ue.ConnectionQualityChanged,ue.IsSpeakingChanged,ue.ParticipantMetadataChanged,ue.ParticipantPermissionsChanged,ue.TrackMuted,ue.TrackUnmuted,ue.TrackPublished,ue.TrackUnpublished,ue.TrackStreamStateChanged,ue.TrackSubscriptionFailed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionStatusChanged];[...gDe,ue.LocalTrackPublished,ue.LocalTrackUnpublished];var hu=T7e.getLogger("lk-components-js");hu.setDefaultLevel("WARN");function IQ(n){return typeof n=="object"}function RQ(n){return Array.isArray(n)&&n.filter(IQ).length>0}function vDe(n){return`${lDe}-${n}`}function yDe(n){const e=Dx(n),t=kQ(n.participant).pipe(TE(()=>Dx(n)),IE(e));return{className:vDe(n.source===pe.Source.Camera||n.source===pe.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function Dx(n){if(b4(n))return n.publication;{const{source:e,name:t,participant:r}=n;if(e&&t)return r.getTrackPublications().find(i=>i.source===e&&i.trackName===t);if(t)return r.getTrackPublicationByName(t);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function _De(n,...e){return new ks(t=>{const r=()=>{t.next(n)};return e.forEach(i=>{n.on(i,r)}),()=>{e.forEach(i=>{n.off(i,r)})}}).pipe(IE(n))}function bDe(n,...e){return new ks(t=>{const r=()=>{t.next(n)};return e.forEach(i=>{n.on(i,r)}),()=>{e.forEach(i=>{n.off(i,r)})}}).pipe(IE(n))}function kQ(n){return bDe(n,ue.TrackMuted,ue.TrackUnmuted,ue.ParticipantPermissionsChanged,ue.TrackPublished,ue.TrackUnpublished,ue.LocalTrackPublished,ue.LocalTrackUnpublished,ue.MediaDevicesError,ue.TrackSubscriptionStatusChanged).pipe(TE(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:r,isScreenShareEnabled:i}=e,s=e.getTrackPublication(pe.Source.Microphone),o=e.getTrackPublication(pe.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:o,microphoneTrack:s,participant:e}}))}new TextEncoder;new TextDecoder;function xF(n,e,t=!0){const r=[n.localParticipant,...Array.from(n.remoteParticipants.values())],i=[];return r.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!t||c.track)).map(c=>({participant:s,publication:c,source:c.source}));i.push(...a)})}),{trackReferences:i,participants:r}}function SDe(n,e,t){var r,i;const s=(r=t.additionalRoomEvents)!=null?r:mDe,o=(i=t.onlySubscribed)!=null?i:!0,a=Array.from(new Set([he.ParticipantConnected,he.ParticipantDisconnected,he.ConnectionStateChanged,he.LocalTrackPublished,he.LocalTrackUnpublished,he.TrackPublished,he.TrackUnpublished,he.TrackSubscriptionStatusChanged,...s]).values());return _De(n,...a).pipe(TE(c=>{const l=xF(c,e,o);return hu.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),IE(xF(n,e,o)))}_.createContext(void 0);const wDe=_.createContext(void 0);function EDe(){return _.useContext(wDe)}function xQ(n){const e=EDe(),t=n??e;if(!t)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return t}_.createContext(void 0);const PQ=_.createContext(void 0);function CDe(){return _.useContext(PQ)}function LQ(n){const e=CDe(),t=n??e;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}_.createContext(void 0);function AQ(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=AQ(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function TDe(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=AQ(n))&&(r&&(r+=" "),r+=e);return r}function IDe(...n){return(...e)=>{for(const t of n)if(typeof t=="function")try{t(...e)}catch(r){console.error(r)}}}function RDe(...n){const e={...n[0]};for(let t=1;t<n.length;t++){const r=n[t];for(const i in r){const s=e[i],o=r[i];typeof s=="function"&&typeof o=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=IDe(s,o):(i==="className"||i==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[i]=TDe(s,o):e[i]=o!==void 0?o:s}}return e}function kDe(n){return n!==void 0}function xDe(...n){return RDe(...n.filter(kDe))}function PDe(n,e){return n==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:n==="e2ee"&&e?"e2ee-enabled":e}function LDe(n={}){const e=LQ(n.room),[t,r]=_.useState(e.localParticipant),[i,s]=_.useState(t.isMicrophoneEnabled),[o,a]=_.useState(t.isMicrophoneEnabled),[c,l]=_.useState(t.lastMicrophoneError),[u,h]=_.useState(t.lastCameraError),[p,m]=_.useState(t.isMicrophoneEnabled),[v,g]=_.useState(void 0),[S,b]=_.useState(void 0),R=k=>{a(k.isCameraEnabled),s(k.isMicrophoneEnabled),m(k.isScreenShareEnabled),b(k.cameraTrack),g(k.microphoneTrack),l(k.participant.lastMicrophoneError),h(k.participant.lastCameraError),r(k.participant)};return _.useEffect(()=>{const k=kQ(e.localParticipant).subscribe(R);return()=>k.unsubscribe()},[e]),{isMicrophoneEnabled:i,isScreenShareEnabled:p,isCameraEnabled:o,microphoneTrack:v,cameraTrack:S,lastMicrophoneError:c,lastCameraError:u,localParticipant:t}}function ADe(n=[pe.Source.Camera,pe.Source.Microphone,pe.Source.ScreenShare,pe.Source.ScreenShareAudio,pe.Source.Unknown],e={}){const t=LQ(e.room),[r,i]=_.useState([]),[s,o]=_.useState([]),a=_.useMemo(()=>n.map(c=>IQ(c)?c.source:c),[JSON.stringify(n)]);return _.useEffect(()=>{const c=SDe(t,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:u})=>{hu.debug("setting track bundles",l,u),i(l),o(u)});return()=>c.unsubscribe()},[t,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(n)]),_.useMemo(()=>{if(RQ(n)){const c=ODe(n,s),l=Array.from(r);return s.forEach(u=>{c.has(u.identity)&&(c.get(u.identity)??[]).forEach(h=>{if(r.find(({participant:m,publication:v})=>u.identity===m.identity&&v.source===h))return;hu.debug(`Add ${h} placeholder for participant ${u.identity}.`);const p={participant:u,source:h};l.push(p)})}),l}else return r},[r,s,n])}function MDe(n,e){const t=new Set(n);for(const r of e)t.delete(r);return t}function ODe(n,e){const t=new Map;if(RQ(n)){const r=n.filter(i=>i.withPlaceholder).map(i=>i.source);e.forEach(i=>{const s=i.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(MDe(new Set(r),new Set(s)));o.length>0&&t.set(i.identity,o)})}return t}function MQ(n,e={}){const[t,r]=_.useState(Dx(n)),[i,s]=_.useState(t==null?void 0:t.isMuted),[o,a]=_.useState(t==null?void 0:t.isSubscribed),[c,l]=_.useState(t==null?void 0:t.track),[u,h]=_.useState("landscape"),p=_.useRef(),{className:m,trackObserver:v}=_.useMemo(()=>yDe(n),[n.participant.sid??n.participant.identity,n.source,b4(n)&&n.publication.trackSid]);return _.useEffect(()=>{const g=v.subscribe(S=>{hu.debug("update track",S),r(S),s(S==null?void 0:S.isMuted),a(S==null?void 0:S.isSubscribed),l(S==null?void 0:S.track)});return()=>g==null?void 0:g.unsubscribe()},[v]),_.useEffect(()=>{var g,S;return c&&(p.current&&c.detach(p.current),(g=e.element)!=null&&g.current&&!(n.participant.isLocal&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),p.current=(S=e.element)==null?void 0:S.current,()=>{p.current&&(c==null||c.detach(p.current))}},[c,e.element]),_.useEffect(()=>{var g,S;if(typeof((g=t==null?void 0:t.dimensions)==null?void 0:g.width)=="number"&&typeof((S=t==null?void 0:t.dimensions)==null?void 0:S.height)=="number"){const b=t.dimensions.width>t.dimensions.height?"landscape":"portrait";h(b)}},[t]),{publication:t,isMuted:i,isSubscribed:o,track:c,elementProps:xDe(e.props,{className:m,"data-lk-local-participant":n.participant.isLocal,"data-lk-source":t==null?void 0:t.source,...(t==null?void 0:t.kind)==="video"&&{"data-lk-orientation":u}})}}var NDe="Expected a function",PF=NaN,DDe="[object Symbol]",FDe=/^\s+|\s+$/g,UDe=/^[-+]0x[0-9a-f]+$/i,jDe=/^0b[01]+$/i,$De=/^0o[0-7]+$/i,BDe=parseInt,HDe=typeof wg=="object"&&wg&&wg.Object===Object&&wg,VDe=typeof self=="object"&&self&&self.Object===Object&&self,GDe=HDe||VDe||Function("return this")(),qDe=Object.prototype,KDe=qDe.toString,WDe=Math.max,zDe=Math.min,V2=function(){return GDe.Date.now()};function YDe(n,e,t){var r,i,s,o,a,c,l=0,u=!1,h=!1,p=!0;if(typeof n!="function")throw new TypeError(NDe);e=LF(e)||0,Fx(t)&&(u=!!t.leading,h="maxWait"in t,s=h?WDe(LF(t.maxWait)||0,e):s,p="trailing"in t?!!t.trailing:p);function m(C){var P=r,M=i;return r=i=void 0,l=C,o=n.apply(M,P),o}function v(C){return l=C,a=setTimeout(b,e),u?m(C):o}function g(C){var P=C-c,M=C-l,D=e-P;return h?zDe(D,s-M):D}function S(C){var P=C-c,M=C-l;return c===void 0||P>=e||P<0||h&&M>=s}function b(){var C=V2();if(S(C))return R(C);a=setTimeout(b,g(C))}function R(C){return a=void 0,p&&r?m(C):(r=i=void 0,o)}function k(){a!==void 0&&clearTimeout(a),l=0,r=c=i=a=void 0}function I(){return a===void 0?o:R(V2())}function T(){var C=V2(),P=S(C);if(r=arguments,i=this,c=C,P){if(a===void 0)return v(c);if(h)return a=setTimeout(b,e),m(c)}return a===void 0&&(a=setTimeout(b,e)),o}return T.cancel=k,T.flush=I,T}function Fx(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function XDe(n){return!!n&&typeof n=="object"}function JDe(n){return typeof n=="symbol"||XDe(n)&&KDe.call(n)==DDe}function LF(n){if(typeof n=="number")return n;if(JDe(n))return PF;if(Fx(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Fx(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(FDe,"");var t=jDe.test(n);return t||$De.test(n)?BDe(n.slice(2),t?2:8):UDe.test(n)?PF:+n}var ZDe=YDe;const AF=rQ(ZDe);function QDe(n){const e=_.useRef(n);e.current=n,_.useEffect(()=>()=>{e.current()},[])}function eFe(n,e=500,t){const r=_.useRef();QDe(()=>{r.current&&r.current.cancel()});const i=_.useMemo(()=>{const s=AF(n,e,t),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!r.current,o.flush=()=>s.flush(),o},[n,e,t]);return _.useEffect(()=>{r.current=AF(n,e,t)},[n,e,t]),i}function tFe(n,e,t){const r=(l,u)=>l===u,i=n instanceof Function?n():n,[s,o]=_.useState(i),a=_.useRef(i),c=eFe(o,e,t);return r(a.current,i)||(c(i),a.current=i),[s,c]}function nFe({threshold:n=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:s}={}){var o;const[a,c]=_.useState(null),[l,u]=_.useState(()=>({isIntersecting:i,entry:void 0})),h=_.useRef();h.current=s;const p=((o=l.entry)==null?void 0:o.isIntersecting)&&r;_.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||p)return;const g=new IntersectionObserver(S=>{const b=Array.isArray(g.thresholds)?g.thresholds:[g.thresholds];S.forEach(R=>{const k=R.isIntersecting&&b.some(I=>R.intersectionRatio>=I);u({isIntersecting:k,entry:R}),h.current&&h.current(k,R)})},{threshold:n,root:e,rootMargin:t});return g.observe(a),()=>{g.disconnect()}},[a,JSON.stringify(n),e,t,p,r]);const m=_.useRef(null);_.useEffect(()=>{var g;!a&&(g=l.entry)!=null&&g.target&&!r&&!p&&m.current!==l.entry.target&&(m.current=l.entry.target,u({isIntersecting:i,entry:void 0}))},[a,l.entry,r,p,i]);const v=[c,!!l.isIntersecting,l.entry];return v.ref=v[0],v.isIntersecting=v[1],v.entry=v[2],v}const rFe=_.forwardRef(function({onTrackClick:n,onClick:e,onSubscriptionStatusChanged:t,trackRef:r,manageSubscription:i,...s},o){const a=xQ(r),c=_.useRef(null);_.useImperativeHandle(o,()=>c.current);const l=nFe({root:c.current}),[u]=tFe(l,3e3);_.useEffect(()=>{i&&a.publication instanceof Wb&&(u==null?void 0:u.isIntersecting)===!1&&(l==null?void 0:l.isIntersecting)===!1&&a.publication.setSubscribed(!1)},[u,a,i]),_.useEffect(()=>{i&&a.publication instanceof Wb&&(l==null?void 0:l.isIntersecting)===!0&&a.publication.setSubscribed(!0)},[l,a,i]);const{elementProps:h,publication:p,isSubscribed:m}=MQ(a,{element:c,props:s});_.useEffect(()=>{t==null||t(!!m)},[m,t]);const v=g=>{e==null||e(g),n==null||n({participant:a==null?void 0:a.participant,track:p})};return _.createElement("video",{ref:c,...h,muted:!0,onClick:v})}),iFe=_.forwardRef(function({trackRef:n,onSubscriptionStatusChanged:e,volume:t,...r},i){const s=xQ(n),o=_.useRef(null);_.useImperativeHandle(i,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:u}=MQ(s,{element:o,props:r});return _.useEffect(()=>{e==null||e(!!c)},[c,e]),_.useEffect(()=>{l===void 0||t===void 0||(l instanceof pV?l.setVolume(t):hu.warn("Volume can only be set on remote audio tracks."))},[t,l]),_.useEffect(()=>{u===void 0||r.muted===void 0||(u instanceof Wb?u.setEnabled(!r.muted):hu.warn("Can only call setEnabled on remote track publications."))},[r.muted,u,l]),_.createElement("audio",{ref:o,...a})});function sFe({volume:n,muted:e}){const t=ADe([pe.Source.Microphone,pe.Source.ScreenShareAudio,pe.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(r=>!r.participant.isLocal&&r.publication.kind===pe.Kind.Audio);return _.createElement("div",{style:{display:"none"}},t.map(r=>_.createElement(iFe,{key:fDe(r),trackRef:r,volume:n,muted:e})))}function oFe(n,e){const[t,r]=_.useState(),i=_.useMemo(()=>new Wi,[]);return _.useEffect(()=>{let s=!1,o=[];return i.lock().then(async a=>{try{(n.audio||n.video)&&(o=await e6(n),s?o.forEach(c=>c.stop()):r(o))}catch(c){e&&c instanceof Error?e(c):hu.error(c)}finally{a()}}),()=>{s=!0,o.forEach(a=>{a.stop()})}},[JSON.stringify(n,PDe),e,i]),t}const aFe="_inRoom_1a6xo_8",cFe="_header_1a6xo_17",lFe="_filler_1a6xo_29",uFe="_footer_1a6xo_34",dFe="_hidden_1a6xo_53",hFe="_overlay_1a6xo_57",fFe="_logo_1a6xo_75",pFe="_buttons_1a6xo_84",mFe="_layout_1a6xo_91",gFe="_raiseHand_1a6xo_111",vFe="_invite_1a6xo_117",yFe="_switchCamera_1a6xo_118",_Fe="_shareScreen_1a6xo_119",bFe="_fixedGrid_1a6xo_148",SFe="_scrollingGrid_1a6xo_154",wFe="_tile_1a6xo_173",EFe="_maximised_1a6xo_178",xn={inRoom:aFe,header:cFe,filler:lFe,footer:uFe,hidden:dFe,overlay:hFe,logo:fFe,buttons:pFe,layout:mFe,raiseHand:gFe,invite:vFe,switchCamera:yFe,shareScreen:_Fe,fixedGrid:bFe,scrollingGrid:SFe,tile:wFe,maximised:EFe},CFe="_content_1cy0f_8",TFe="_wait_1cy0f_19",IFe="_join_1cy0f_32",cg={content:CFe,wait:TFe,join:IFe};function MF(n,e){let t;return(...r)=>{window.clearTimeout(t),t=window.setTimeout(()=>n(...r),e)}}function Xg({debounce:n,scroll:e,polyfill:t,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=_.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=_.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=n?typeof n=="number"?n:n.scroll:null,l=n?typeof n=="number"?n:n.resize:null,u=_.useRef(!1);_.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,p,m]=_.useMemo(()=>{const b=()=>{if(!a.current.element)return;const{left:R,top:k,width:I,height:T,bottom:C,right:P,x:M,y:D}=a.current.element.getBoundingClientRect(),F={left:R,top:k,width:I,height:T,bottom:C,right:P,x:M,y:D};a.current.element instanceof HTMLElement&&r&&(F.height=a.current.element.offsetHeight,F.width=a.current.element.offsetWidth),Object.freeze(F),u.current&&!PFe(a.current.lastBounds,F)&&o(a.current.lastBounds=F)};return[b,l?MF(b,l):b,c?MF(b,c):b]},[o,r,c,l]);function v(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",m,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function g(){a.current.element&&(a.current.resizeObserver=new i(m),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(b=>b.addEventListener("scroll",m,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{m()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const S=b=>{!b||b===a.current.element||(v(),a.current.element=b,a.current.scrollContainers=OQ(b),g())};return kFe(m,!!e),RFe(p),_.useEffect(()=>{v(),g()},[e,m,p]),_.useEffect(()=>v,[]),[S,s,h]}function RFe(n){_.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function kFe(n,e){_.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function OQ(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:r,overflowY:i}=window.getComputedStyle(n);return[t,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...OQ(n.parentElement)]}const xFe=["x","y","top","bottom","left","right","width","height"],PFe=(n,e)=>xFe.every(t=>n[t]===e[t]),LFe="_loading_14w06_8",AFe={loading:LFe},MFe=({size:n,loading:e,...t})=>w.jsxs("div",{children:[e&&w.jsx("div",{className:AFe.loading,children:w.jsx(YCe,{size:n/3})}),w.jsx(Np,{size:n,...t})]}),OFe="_preview_1jjvr_8",NFe="_mirror_1jjvr_24",DFe="_cameraStarting_1jjvr_28",FFe="_avatarContainer_1jjvr_39",UFe="_buttonBar_1jjvr_51",lg={preview:OFe,mirror:NFe,cameraStarting:DFe,avatarContainer:FFe,buttonBar:UFe},jFe=({matrixInfo:n,muteStates:e,videoTrack:t,children:r})=>{const{t:i}=Xe(),[s,o]=Xg(),a=_.useRef(null);_.useEffect(()=>(a.current&&(t==null||t.attach(a.current)),()=>{t==null||t.detach()}),[t]);const c=_.useMemo(()=>e.video.enabled&&!t,[e.video.enabled,t]);return w.jsxs("div",{className:De(lg.preview),ref:s,children:[w.jsx("video",{className:t&&t6(t).facingMode==="user"?lg.mirror:void 0,ref:a,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),(!e.video.enabled||c)&&w.jsx(w.Fragment,{children:w.jsxs("div",{className:lg.avatarContainer,children:[c&&w.jsx("div",{className:lg.cameraStarting,role:"status",children:i("video_tile.camera_starting")}),w.jsx(MFe,{id:n.userId,name:n.displayName,size:Math.min(o.width,o.height)/2,src:n.avatarUrl,loading:c})]})}),w.jsx("div",{className:lg.buttonBar,children:r})]})},NQ=n=>{const{t:e}=Xe();return w.jsx(Dt,{kind:"secondary",size:"sm",Icon:sIe,...n,children:e("action.invite")})};function up(n){const e=_.useRef(void 0);return e.current??(e.current={value:n()}),e.current.value}let wd;/android/i.test(navigator.userAgent)?wd="android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?wd="ios":wd="desktop";const $Fe=()=>{const{userAgent:n}=navigator;return n.includes("Firefox")};function Pc(n){const e=_.useRef(n);return e.current=n,e}function DQ(n){const e=rh(),t=Pc(e.videoInput.select),r=Hv(s=>s.pipe(Ot(([o])=>o),Ot(o=>o===null?It(null):Bv(Ta(o,Pe.Restarted).pipe(un(null),Fe(()=>o)),Ta(o,Pe.Muted).pipe(Fe(()=>null))))),[n]),i=Hv(s=>wd==="desktop"?It(null):s.pipe(Ot(([o])=>o),Fe(o=>{if(o===null)return null;const a=t6(o).facingMode;return a!=="user"&&a!=="environment"?null:()=>void o.restartTrack({facingMode:a==="user"?"environment":"user"}).then(()=>{const c=o.mediaStreamTrack.getSettings().deviceId;c!==void 0&&t.current(c)}).catch(c=>O.error("Failed to switch camera",a,c))})),[r]);return st(i)}const FQ=({client:n,matrixInfo:e,muteStates:t,onEnter:r,enterLabel:i,confineToRoom:s,hideHeader:o,participantCount:a,onShareClick:c,waitingForInvite:l})=>{const{t:u}=Xe();My(e.roomName);const h=_.useCallback(()=>{var z,H;return(H=(z=t.audio).setEnabled)==null?void 0:H.call(z,J=>!J)},[t]),p=_.useCallback(()=>{var z,H;return(H=(z=t.video).setEnabled)==null?void 0:H.call(z,J=>!J)},[t]),[m,v]=_.useState(!1),[g,S]=_.useState(d4),b=_.useCallback(()=>v(!0),[v]),R=_.useCallback(()=>v(!1),[v]),k=Ua(),I=_.useCallback(()=>{var z;(z=k("/"))==null||z.catch(H=>{O.error("Failed to navigate to /",H)})},[k]),T=rE("(max-height: 500px)"),C=!s&&w.jsx(Aa,{className:cg.recents,to:"/",children:u("lobby.leave_button")}),P=rh(),M=up(()=>t.audio.enabled&&{deviceId:P.audioInput.selectedId}),D=_.useMemo(()=>({audio:Object.assign({},M),video:t.video.enabled&&{deviceId:P.videoInput.selectedId}}),[M,P.videoInput.selectedId,t.video.enabled]),F=_.useCallback(z=>{var H,J,Y,G;O.error("Error while creating preview Tracks:",z),(J=(H=t.audio).setEnabled)==null||J.call(H,!1),(G=(Y=t.video).setEnabled)==null||G.call(Y,!1)},[t.audio,t.video]),U=oFe(D,F),B=_.useMemo(()=>(U==null?void 0:U.find(z=>z.kind===pe.Kind.Video))??null,[U]),V=DQ(Hv(z=>z.pipe(Fe(([H])=>H)),[B]));return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:De(cg.room,xn.inRoom),children:[!o&&w.jsxs(Su,{children:[w.jsx(Jd,{children:w.jsx(JY,{id:e.roomId,name:e.roomName,avatarUrl:e.roomAvatar,encrypted:e.e2eeSystem.kind!==Vt.NONE,participantCount:a})}),w.jsx(Zd,{children:c!==null&&w.jsx(NQ,{onClick:c})})]}),w.jsxs("div",{className:cg.content,children:[w.jsx(jFe,{matrixInfo:e,muteStates:t,videoTrack:B,children:w.jsx(Dt,{className:De(cg.join,{[cg.wait]:l}),size:l?"sm":"lg",onClick:()=>{l||r()},"data-testid":"lobby_joinCall",children:i??u("lobby.join_button")})}),!T&&C]}),w.jsxs("div",{className:xn.footer,children:[T&&C,w.jsxs("div",{className:xn.buttons,children:[w.jsx(fZ,{muted:!t.audio.enabled,onClick:h,disabled:t.audio.setEnabled===null}),w.jsx(pZ,{muted:!t.video.enabled,onClick:p,disabled:t.video.setEnabled===null}),V&&w.jsx(mZ,{onClick:V}),w.jsx(vZ,{onClick:b}),!s&&w.jsx(gZ,{onClick:I})]})]})]}),n&&w.jsx(h4,{client:n,open:m,onDismiss:R,tab:g,onTabChange:S})]})},BFe="_headline_1em2y_8",HFe="_callEndedContent_1em2y_15",VFe="_callEndedButton_1em2y_35",GFe="_submitButton_1em2y_40",qFe="_container_1em2y_47",KFe="_main_1em2y_55",WFe="_footer_1em2y_72",gl={headline:BFe,callEndedContent:HFe,callEndedButton:VFe,submitButton:GFe,container:qFe,main:KFe,footer:WFe},zFe="_starIcon_1m09w_8",YFe="_starRating_1m09w_12",XFe="_inputContainer_1m09w_18",JFe="_hideElement_1m09w_22",ug={starIcon:zFe,starRating:YFe,inputContainer:XFe,hideElement:JFe},ZFe=(n,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),QFe=_.forwardRef(ZFe),eUe=(n,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),tUe=_.forwardRef(eUe);function nUe({starCount:n,onChange:e,required:t}){const[r,i]=_.useState(0),[s,o]=_.useState(0),{t:a}=Xe();return w.jsx("div",{className:ug.starRating,children:[...Array(n)].map((c,l)=>(l+=1,w.jsxs("div",{className:ug.inputContainer,onMouseEnter:()=>o(l),onMouseLeave:()=>o(r),children:[w.jsx("input",{className:ug.hideElement,type:"radio",id:"starInput"+String(l),value:String(l)+"Star",name:"star rating",onChange:u=>{i(l),e(l)},required:!0}),w.jsx("label",{className:ug.hideElement,id:"starInvisibleLabel"+String(l),htmlFor:"starInput"+String(l),children:a("star_rating_input_label",{count:l})}),w.jsx("label",{className:ug.starIcon,id:"starIcon"+String(l),htmlFor:"starInput"+String(l),children:l<=(s||r)?w.jsx(QFe,{}):w.jsx(tUe,{})})]},l)))})}const rUe=({client:n,isPasswordlessUser:e,confineToRoom:t,endedCallId:r})=>{const{t:i}=Xe(),s=Ua(),{displayName:o}=Ly(n),[a,c]=_.useState(!1),[l,u]=_.useState(0),[h,p]=_.useState(!1),[m,v]=_.useState(!1),g=_.useCallback(R=>{R.preventDefault();const I=new FormData(R.target).get("feedbackText");$t.instance.eventQualitySurvey.track(r,I,l),p(!0),setTimeout(()=>{v(!0),setTimeout(()=>{var T;e?c(!0):t||(T=s("/"))==null||T.catch(C=>{O.error("Failed to navigate to /",C)})},1e3)},1e3)},[r,s,e,t,l]),S=e&&w.jsxs("div",{className:gl.callEndedContent,children:[w.jsxs(Ci,{i18nKey:"call_ended_view.create_account_prompt",children:[w.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),w.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),w.jsx(n4,{className:gl.callEndedButton,to:"/register",children:i("call_ended_view.create_account_button")})]}),b=w.jsxs("div",{className:gl.callEndedContent,children:[w.jsx(Ci,{i18nKey:"call_ended_view.feedback_prompt",children:w.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),w.jsxs("form",{onSubmit:g,children:[w.jsx(_t,{children:w.jsx(nUe,{starCount:5,onChange:u,required:!0})}),w.jsx(_t,{children:w.jsx(yn,{className:xZ.feedback,id:"feedbackText",name:"feedbackText",label:i("settings.feedback_tab_description_label"),placeholder:i("settings.feedback_tab_description_label"),type:"textarea"})})," ",w.jsx(_t,{children:m?w.jsx(Ci,{i18nKey:"call_ended_view.feedback_done",children:w.jsx("p",{children:"Thanks for your feedback!"})}):w.jsx(Dt,{type:"submit",className:gl.submitButton,"data-testid":"home_go",children:i(h?"submitting":"action.submit")})})]})]});return w.jsxs(w.Fragment,{children:[w.jsxs(Su,{children:[w.jsx(Jd,{children:!t&&w.jsx(Dd,{})}),w.jsx(Zd,{})]}),w.jsxs("div",{className:gl.container,children:[w.jsxs("main",{className:gl.main,children:[w.jsx(bu,{size:"xl",weight:"semibold",className:gl.headline,children:a?i("call_ended_view.headline",{displayName:o}):i("call_ended_view.headline",{displayName:o})+`
`+i("call_ended_view.survey_prompt")}),(!a||t)&&$t.instance.isEnabled()?b:S]}),!t&&w.jsx(Xt,{className:gl.footer,children:w.jsxs(Aa,{to:"/",children:[" ",i("call_ended_view.not_now_button")," "]})})]})]})};function OF(n,e,t){const r=t.find(i=>i.kind===e&&i.label===n);return r==null?void 0:r.deviceId}const iUe=(n,e)=>_.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("g",{id:"Logo Mark"},_.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),_.createElement("g",{id:"Union"},_.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),_.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),_.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),_.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),sUe=_.forwardRef(iUe),oUe=(n,e)=>_.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...n},_.createElement("g",{id:"Logo Type"},_.createElement("g",{id:"Vector"},_.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),_.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),_.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),_.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),_.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),_.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),_.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),_.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),aUe=_.forwardRef(oUe),NF=n=>{const e=document.activeElement;return e!==null&&e.contains(n)},DF=Object.fromEntries(jv.slice(0,bx).map((n,e)=>[(e+1).toString(),n]));function cUe(n,e,t,r,i,s){const o=_.useRef(!1);Bg(window,"keydown",_.useCallback(a=>{n.current!==null&&NF(n.current)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||(a.key==="m"?(a.preventDefault(),e()):a.key=="v"?(a.preventDefault(),t()):a.key===" "?(a.preventDefault(),o.current||(o.current=!0,r(!1))):a.key==="h"?(a.preventDefault(),s()):DF[a.key]&&(a.preventDefault(),i(DF[a.key]))))},[n,t,e,r,i,s]),_.useMemo(()=>({capture:!0}),[])),Bg(window,"keyup",_.useCallback(a=>{n.current!==null&&NF(n.current)&&a.key===" "&&(o.current=!1,r(!0))},[n,r])),Bg(window,"blur",_.useCallback(()=>{o.current&&(o.current=!1,r(!0))},[r,o]))}const lUe="_tile_vtjqb_8",uUe="_speaking_vtjqb_27",dUe="_handRaised_vtjqb_47",hUe="_muteIcon_vtjqb_74",fUe="_volumeSlider_vtjqb_82",Eg={tile:lUe,speaking:uUe,handRaised:dUe,muteIcon:hUe,volumeSlider:fUe};class UQ{constructor(){this.ended$=new xr,this.bindImpl=YOe(this.ended$),this.stateImpl=e=>e.pipe(this.bind(),ba(),qOe({bufferSize:1,refCount:!1}))}bind(){return this.bindImpl}state(){return this.stateImpl}end(){this.ended$.next(),this.ended$.complete()}}class RE{constructor(){this.scope=new UQ}destroy(){this.scope.end()}}const FF=Symbol("nothing");function pUe(n){return e=>TOe(()=>{let t=FF;return e.pipe(XOe(r=>t=r),iZ(()=>{t!==FF&&n(t)}))})}function Ux(n,e){return t=>t.pipe(ec(e,n),un(n))}function qS(n,e){return n.pipe(Ot(t=>t?l4(t).pipe(Fe(()=>({participant:t,publication:t.getTrackPublication(e),source:e})),VOe("publication")):It(void 0)))}function jQ(n,e,t){return Nn([qS(It(n),e),Sx(1e3).pipe(un(0))]).pipe(Ot(async([r])=>{var o;const i=(o=r==null?void 0:r.publication)==null?void 0:o.track;if(!i||!(i instanceof QP||i instanceof Iw))return;const s=await i.getRTCStatsReport();if(s){for(const a of s.values())if(a.type===t)return a}}),un(void 0))}function jx(n,e){return jQ(n,e,"inbound-rtp").pipe(Fe(t=>t))}function UF(n,e){return jQ(n,e,"outbound-rtp").pipe(Fe(t=>t))}function t_(n,e){let t={framesDecoded:void 0,framesReceived:void 0};return jx(n,e).pipe(Fe(r=>{if(!r)return;const{framesDecoded:i,framesDropped:s,framesReceived:o}=r;return{framesDecoded:i,framesDropped:s,framesReceived:o}}),Vo(r=>!!r),Fe(r=>{const i=t;if(t=r,typeof r.framesReceived=="number"&&typeof i.framesReceived=="number"&&typeof r.framesDecoded=="number"&&typeof i.framesDecoded=="number"){const s=r.framesReceived-i.framesReceived,o=r.framesDecoded-i.framesDecoded;if(s>0)return o>0}}),Vo(r=>typeof r=="boolean"),un(void 0))}function G2(n,e,t,r){return y8e(n,he.EncryptionError).pipe(Fe(i=>{const[s]=i;return t.kind===Vt.PER_PARTICIPANT?((s==null?void 0:s.message.includes(e.identity))&&(s==null?void 0:s.message.includes(r)))??!1:t.kind===Vt.SHARED_KEY?!!(s!=null&&s.message.includes(r)):!1}),JOe(1e3),un(!1))}class $Q extends RE{constructor(e,t,r,i,s,o,a,c){super(),this.id=e,this.member=t,this.participant$=r,this.displayname$=c;const l=qS(r,s).pipe(this.scope.state());this.video$=qS(r,o).pipe(this.scope.state()),this.unencryptedWarning$=Nn([l,this.video$],(u,h)=>{var p,m;return i.kind!==Vt.NONE&&(((p=u==null?void 0:u.publication)==null?void 0:p.isEncrypted)===!1||((m=h==null?void 0:h.publication)==null?void 0:m.isEncrypted)===!1)}).pipe(this.scope.state()),this.encryptionStatus$=this.participant$.pipe(Ot(u=>u?u.isLocal||i.kind===Vt.NONE?It(1):i.kind===Vt.PER_PARTICIPANT?Nn([G2(a,u,i,"MissingKey"),G2(a,u,i,"InvalidKey"),t_(u,s),t_(u,o)]).pipe(Fe(([h,p,m,v])=>{if(h)return 2;if(p)return 3;if(m||v)return 1}),Vo(h=>!!h),un(0)):Nn([G2(a,u,i,"InvalidKey"),t_(u,s),t_(u,o)]).pipe(Fe(([h,p,m])=>{if(h)return 4;if(p||m)return 1}),Vo(h=>!!h),un(0)):It(0)),this.scope.state())}}class BQ extends $Q{constructor(e,t,r,i,s,o,a,c){super(e,t,r,i,pe.Source.Microphone,pe.Source.Camera,s,o),this.handRaised$=a,this.reaction$=c,this.speaking$=this.participant$.pipe(Ot(u=>u?c4(u,ue.IsSpeakingChanged).pipe(Fe(h=>h.isSpeaking)):It(!1)),this.scope.state()),this._cropVideo$=new is(!0),this.cropVideo$=this._cropVideo$;const l=r.pipe(Ot(u=>(u&&l4(u))??It(void 0)),this.scope.state());this.audioEnabled$=l.pipe(Fe(u=>{var h;return((h=u==null?void 0:u.microphoneTrack)==null?void 0:h.isMuted)===!1})),this.videoEnabled$=l.pipe(Fe(u=>{var h;return((h=u==null?void 0:u.cameraTrack)==null?void 0:h.isMuted)===!1}))}toggleFitContain(){this._cropVideo$.next(!this._cropVideo$.value)}get local(){return this instanceof dp}}class dp extends BQ{constructor(e,t,r,i,s,o,a,c){super(e,t,r,i,s,o,a,c),this.mirror$=this.video$.pipe(Ot(l=>{var h;const u=(h=l==null?void 0:l.publication)==null?void 0:h.track;return u instanceof Iw?Ta(u,Pe.Restarted).pipe(un(null),Fe(()=>t6(u).facingMode==="user")):It(!1)}),this.scope.state()),this.alwaysShow$=zD.value$,this.setAlwaysShow=zD.setValue,this.audioStreamStats$=Nn([this.participant$,Gv.value$]).pipe(Ot(([l,u])=>!l||!u?It(void 0):UF(l,pe.Source.Microphone))),this.videoStreamStats$=Nn([this.participant$,Gv.value$]).pipe(Ot(([l,u])=>!l||!u?It(void 0):UF(l,pe.Source.Camera)))}}class mUe extends BQ{constructor(e,t,r,i,s,o,a,c){super(e,t,r,i,s,o,a,c),this.locallyMutedToggle$=new xr,this.localVolumeAdjustment$=new xr,this.localVolumeCommit$=new xr,this.localVolume$=Bv(this.locallyMutedToggle$.pipe(Fe(()=>"toggle mute")),this.localVolumeAdjustment$,this.localVolumeCommit$.pipe(Fe(()=>"commit"))).pipe(Ux({volume:1,committedVolume:1},(l,u)=>{switch(u){case"toggle mute":return{...l,volume:l.volume===0?l.committedVolume:0};case"commit":return{...l,committedVolume:l.volume===0?l.committedVolume:l.volume};default:return{...l,volume:u}}}),Fe(({volume:l})=>l),this.scope.state()),this.locallyMuted$=this.localVolume$.pipe(Fe(l=>l===0),this.scope.state()),this.audioStreamStats$=Nn([this.participant$,Gv.value$]).pipe(Ot(([l,u])=>!l||!u?It(void 0):jx(l,pe.Source.Microphone))),this.videoStreamStats$=Nn([this.participant$,Gv.value$]).pipe(Ot(([l,u])=>!l||!u?It(void 0):jx(l,pe.Source.Camera))),Nn([r,this.localVolume$.pipe(this.scope.bind())]).subscribe(([l,u])=>l&&l.setVolume(u))}toggleLocallyMuted(){this.locallyMutedToggle$.next()}setLocalVolume(e){this.localVolumeAdjustment$.next(e)}commitLocalVolume(){this.localVolumeCommit$.next()}}class vf extends $Q{constructor(e,t,r,i,s,o,a){super(e,t,r,i,pe.Source.ScreenShareAudio,pe.Source.ScreenShare,s,o),this.local=a}}var S4=Uy(),ft=n=>Fy(n,S4),w4=Uy();ft.write=n=>Fy(n,w4);var kE=Uy();ft.onStart=n=>Fy(n,kE);var E4=Uy();ft.onFrame=n=>Fy(n,E4);var C4=Uy();ft.onFinish=n=>Fy(n,C4);var $f=[];ft.setTimeout=(n,e)=>{const t=ft.now()+e,r=()=>{const s=$f.findIndex(o=>o.cancel==r);~s&&$f.splice(s,1),jl-=~s?1:0},i={time:t,handler:n,cancel:r};return $f.splice(HQ(t),0,i),jl+=1,VQ(),i};var HQ=n=>~(~$f.findIndex(e=>e.time>n)||~$f.length);ft.cancel=n=>{kE.delete(n),E4.delete(n),C4.delete(n),S4.delete(n),w4.delete(n)};ft.sync=n=>{$x=!0,ft.batchedUpdates(n),$x=!1};ft.throttle=n=>{let e;function t(){try{n(...e)}finally{e=null}}function r(...i){e=i,ft.onStart(t)}return r.handler=n,r.cancel=()=>{kE.delete(t),e=null},r};var T4=typeof window<"u"?window.requestAnimationFrame:()=>{};ft.use=n=>T4=n;ft.now=typeof performance<"u"?()=>performance.now():Date.now;ft.batchedUpdates=n=>n();ft.catch=console.error;ft.frameLoop="always";ft.advance=()=>{ft.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):qQ()};var Ul=-1,jl=0,$x=!1;function Fy(n,e){$x?(e.delete(n),n(0)):(e.add(n),VQ())}function VQ(){Ul<0&&(Ul=0,ft.frameLoop!=="demand"&&T4(GQ))}function gUe(){Ul=-1}function GQ(){~Ul&&(T4(GQ),ft.batchedUpdates(qQ))}function qQ(){const n=Ul;Ul=ft.now();const e=HQ(Ul);if(e&&(KQ($f.splice(0,e),t=>t.handler()),jl-=e),!jl){gUe();return}kE.flush(),S4.flush(n?Math.min(64,Ul-n):16.667),E4.flush(),w4.flush(),C4.flush()}function Uy(){let n=new Set,e=n;return{add(t){jl+=e==n&&!n.has(t)?1:0,n.add(t)},delete(t){return jl-=e==n&&n.has(t)?1:0,n.delete(t)},flush(t){e.size&&(n=new Set,jl-=e.size,KQ(e,r=>r(t)&&n.add(r)),jl+=n.size,e=n)}}}function KQ(n,e){n.forEach(t=>{try{e(t)}catch(r){ft.catch(r)}})}var vUe=Object.defineProperty,yUe=(n,e)=>{for(var t in e)vUe(n,t,{get:e[t],enumerable:!0})},Ko={};yUe(Ko,{assign:()=>bUe,colors:()=>Yl,createStringInterpolator:()=>R4,skipAnimation:()=>zQ,to:()=>WQ,willAdvance:()=>k4});function Bx(){}var _Ue=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),Te={arr:Array.isArray,obj:n=>!!n&&n.constructor.name==="Object",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0};function cc(n,e){if(Te.arr(n)){if(!Te.arr(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}return n===e}var mt=(n,e)=>n.forEach(e);function Ma(n,e,t){if(Te.arr(n)){for(let r=0;r<n.length;r++)e.call(t,n[r],`${r}`);return}for(const r in n)n.hasOwnProperty(r)&&e.call(t,n[r],r)}var Si=n=>Te.und(n)?[]:Te.arr(n)?n:[n];function Jg(n,e){if(n.size){const t=Array.from(n);n.clear(),mt(t,e)}}var Cg=(n,...e)=>Jg(n,t=>t(...e)),I4=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),R4,WQ,Yl=null,zQ=!1,k4=Bx,bUe=n=>{n.to&&(WQ=n.to),n.now&&(ft.now=n.now),n.colors!==void 0&&(Yl=n.colors),n.skipAnimation!=null&&(zQ=n.skipAnimation),n.createStringInterpolator&&(R4=n.createStringInterpolator),n.requestAnimationFrame&&ft.use(n.requestAnimationFrame),n.batchedUpdates&&(ft.batchedUpdates=n.batchedUpdates),n.willAdvance&&(k4=n.willAdvance),n.frameLoop&&(ft.frameLoop=n.frameLoop)},Zg=new Set,qs=[],q2=[],KS=0,xE={get idle(){return!Zg.size&&!qs.length},start(n){KS>n.priority?(Zg.add(n),ft.onStart(SUe)):(YQ(n),ft(Hx))},advance:Hx,sort(n){if(KS)ft.onFrame(()=>xE.sort(n));else{const e=qs.indexOf(n);~e&&(qs.splice(e,1),XQ(n))}},clear(){qs=[],Zg.clear()}};function SUe(){Zg.forEach(YQ),Zg.clear(),ft(Hx)}function YQ(n){qs.includes(n)||XQ(n)}function XQ(n){qs.splice(wUe(qs,e=>e.priority>n.priority),0,n)}function Hx(n){const e=q2;for(let t=0;t<qs.length;t++){const r=qs[t];KS=r.priority,r.idle||(k4(r),r.advance(n),r.idle||e.push(r))}return KS=0,q2=qs,q2.length=0,qs=e,qs.length>0}function wUe(n,e){const t=n.findIndex(e);return t<0?n.length:t}var EUe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},$o="[-+]?\\d*\\.?\\d+",WS=$o+"%";function PE(...n){return"\\(\\s*("+n.join(")\\s*,\\s*(")+")\\s*\\)"}var CUe=new RegExp("rgb"+PE($o,$o,$o)),TUe=new RegExp("rgba"+PE($o,$o,$o,$o)),IUe=new RegExp("hsl"+PE($o,WS,WS)),RUe=new RegExp("hsla"+PE($o,WS,WS,$o)),kUe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,xUe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,PUe=/^#([0-9a-fA-F]{6})$/,LUe=/^#([0-9a-fA-F]{8})$/;function AUe(n){let e;return typeof n=="number"?n>>>0===n&&n>=0&&n<=4294967295?n:null:(e=PUe.exec(n))?parseInt(e[1]+"ff",16)>>>0:Yl&&Yl[n]!==void 0?Yl[n]:(e=CUe.exec(n))?(zh(e[1])<<24|zh(e[2])<<16|zh(e[3])<<8|255)>>>0:(e=TUe.exec(n))?(zh(e[1])<<24|zh(e[2])<<16|zh(e[3])<<8|BF(e[4]))>>>0:(e=kUe.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=LUe.exec(n))?parseInt(e[1],16)>>>0:(e=xUe.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=IUe.exec(n))?(jF($F(e[1]),n_(e[2]),n_(e[3]))|255)>>>0:(e=RUe.exec(n))?(jF($F(e[1]),n_(e[2]),n_(e[3]))|BF(e[4]))>>>0:null}function K2(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function jF(n,e,t){const r=t<.5?t*(1+e):t+e-t*e,i=2*t-r,s=K2(i,r,n+1/3),o=K2(i,r,n),a=K2(i,r,n-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function zh(n){const e=parseInt(n,10);return e<0?0:e>255?255:e}function $F(n){return(parseFloat(n)%360+360)%360/360}function BF(n){const e=parseFloat(n);return e<0?0:e>1?255:Math.round(e*255)}function n_(n){const e=parseFloat(n);return e<0?0:e>100?1:e/100}function HF(n){let e=AUe(n);if(e===null)return n;e=e||0;const t=(e&4278190080)>>>24,r=(e&16711680)>>>16,i=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${r}, ${i}, ${s})`}var Wv=(n,e,t)=>{if(Te.fun(n))return n;if(Te.arr(n))return Wv({range:n,output:e,extrapolate:t});if(Te.str(n.output[0]))return R4(n);const r=n,i=r.output,s=r.range||[0,1],o=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",c=r.easing||(l=>l);return l=>{const u=OUe(l,s);return MUe(l,s[u],s[u+1],i[u],i[u+1],c,o,a,r.map)}};function MUe(n,e,t,r,i,s,o,a,c){let l=c?c(n):n;if(l<e){if(o==="identity")return l;o==="clamp"&&(l=e)}if(l>t){if(a==="identity")return l;a==="clamp"&&(l=t)}return r===i?r:e===t?n<=e?r:i:(e===-1/0?l=-l:t===1/0?l=l-e:l=(l-e)/(t-e),l=s(l),r===-1/0?l=-l:i===1/0?l=l+r:l=l*(i-r)+r,l)}function OUe(n,e){for(var t=1;t<e.length-1&&!(e[t]>=n);++t);return t-1}var NUe={linear:n=>n},zv=Symbol.for("FluidValue.get"),hp=Symbol.for("FluidValue.observers"),Vs=n=>!!(n&&n[zv]),Vi=n=>n&&n[zv]?n[zv]():n,VF=n=>n[hp]||null;function DUe(n,e){n.eventObserved?n.eventObserved(e):n(e)}function Yv(n,e){const t=n[hp];t&&t.forEach(r=>{DUe(r,e)})}var JQ=class{constructor(n){if(!n&&!(n=this.get))throw Error("Unknown getter");FUe(this,n)}},FUe=(n,e)=>ZQ(n,zv,e);function Bp(n,e){if(n[zv]){let t=n[hp];t||ZQ(n,hp,t=new Set),t.has(e)||(t.add(e),n.observerAdded&&n.observerAdded(t.size,e))}return e}function Xv(n,e){const t=n[hp];if(t&&t.has(e)){const r=t.size-1;r?t.delete(e):n[hp]=null,n.observerRemoved&&n.observerRemoved(r,e)}}var ZQ=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),fb=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,UUe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,GF=new RegExp(`(${fb.source})(%|[a-z]+)`,"i"),jUe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,LE=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,QQ=n=>{const[e,t]=$Ue(n);if(!e||I4())return n;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(t&&t.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(t);return i||n}else{if(t&&LE.test(t))return QQ(t);if(t)return t}return n},$Ue=n=>{const e=LE.exec(n);if(!e)return[,];const[,t,r]=e;return[t,r]},W2,BUe=(n,e,t,r,i)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(r)}, ${i})`,eee=n=>{W2||(W2=Yl?new RegExp(`(${Object.keys(Yl).join("|")})(?!\\w)`,"g"):/^\b$/);const e=n.output.map(s=>Vi(s).replace(LE,QQ).replace(UUe,HF).replace(W2,HF)),t=e.map(s=>s.match(fb).map(Number)),i=t[0].map((s,o)=>t.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>Wv({...n,output:s}));return s=>{var c;const o=!GF.test(e[0])&&((c=e.find(l=>GF.test(l)))==null?void 0:c.replace(fb,""));let a=0;return e[0].replace(fb,()=>`${i[a++](s)}${o||""}`).replace(jUe,BUe)}},x4="react-spring: ",tee=n=>{const e=n;let t=!1;if(typeof e!="function")throw new TypeError(`${x4}once requires a function parameter`);return(...r)=>{t||(e(...r),t=!0)}},HUe=tee(console.warn);function VUe(){HUe(`${x4}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var GUe=tee(console.warn);function qUe(){GUe(`${x4}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function AE(n){return Te.str(n)&&(n[0]=="#"||/\d/.test(n)||!I4()&&LE.test(n)||n in(Yl||{}))}var yf=I4()?_.useEffect:_.useLayoutEffect,KUe=()=>{const n=_.useRef(!1);return yf(()=>(n.current=!0,()=>{n.current=!1}),[]),n};function nee(){const n=_.useState()[1],e=KUe();return()=>{e.current&&n(Math.random())}}function WUe(n,e){const[t]=_.useState(()=>({inputs:e,result:n()})),r=_.useRef(),i=r.current;let s=i;return s?e&&s.inputs&&zUe(e,s.inputs)||(s={inputs:e,result:n()}):s=t,_.useEffect(()=>{r.current=s,i==t&&(t.inputs=t.result=void 0)},[s]),s.result}function zUe(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}var ree=n=>_.useEffect(n,YUe),YUe=[];function XUe(n){const e=_.useRef();return _.useEffect(()=>{e.current=n}),e.current}var Jv=Symbol.for("Animated:node"),JUe=n=>!!n&&n[Jv]===n,ma=n=>n&&n[Jv],P4=(n,e)=>_Ue(n,Jv,e),ME=n=>n&&n[Jv]&&n[Jv].getPayload(),iee=class{constructor(){P4(this,this)}getPayload(){return this.payload||[]}},jy=class extends iee{constructor(n){super(),this._value=n,this.done=!0,this.durationProgress=0,Te.num(this._value)&&(this.lastPosition=this._value)}static create(n){return new jy(n)}getPayload(){return[this]}getValue(){return this._value}setValue(n,e){return Te.num(n)&&(this.lastPosition=n,e&&(n=Math.round(n/e)*e,this.done&&(this.lastPosition=n))),this._value===n?!1:(this._value=n,!0)}reset(){const{done:n}=this;this.done=!1,Te.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,n&&(this.lastVelocity=null),this.v0=null)}},Zv=class extends jy{constructor(n){super(0),this._string=null,this._toString=Wv({output:[n,n]})}static create(n){return new Zv(n)}getValue(){const n=this._string;return n??(this._string=this._toString(this._value))}setValue(n){if(Te.str(n)){if(n==this._string)return!1;this._string=n,this._value=1}else if(super.setValue(n))this._string=null;else return!1;return!0}reset(n){n&&(this._toString=Wv({output:[this.getValue(),n]})),this._value=0,super.reset()}},zS={dependencies:null},OE=class extends iee{constructor(n){super(),this.source=n,this.setValue(n)}getValue(n){const e={};return Ma(this.source,(t,r)=>{JUe(t)?e[r]=t.getValue(n):Vs(t)?e[r]=Vi(t):n||(e[r]=t)}),e}setValue(n){this.source=n,this.payload=this._makePayload(n)}reset(){this.payload&&mt(this.payload,n=>n.reset())}_makePayload(n){if(n){const e=new Set;return Ma(n,this._addToPayload,e),Array.from(e)}}_addToPayload(n){zS.dependencies&&Vs(n)&&zS.dependencies.add(n);const e=ME(n);e&&mt(e,t=>this.add(t))}},see=class extends OE{constructor(n){super(n)}static create(n){return new see(n)}getValue(){return this.source.map(n=>n.getValue())}setValue(n){const e=this.getPayload();return n.length==e.length?e.map((t,r)=>t.setValue(n[r])).some(Boolean):(super.setValue(n.map(ZUe)),!0)}};function ZUe(n){return(AE(n)?Zv:jy).create(n)}function Vx(n){const e=ma(n);return e?e.constructor:Te.arr(n)?see:AE(n)?Zv:jy}var qF=(n,e)=>{const t=!Te.fun(n)||n.prototype&&n.prototype.isReactComponent;return _.forwardRef((r,i)=>{const s=_.useRef(null),o=t&&_.useCallback(v=>{s.current=tje(i,v)},[i]),[a,c]=eje(r,e),l=nee(),u=()=>{const v=s.current;if(t&&!v)return;(v?e.applyAnimatedValues(v,a.getValue(!0)):!1)===!1&&l()},h=new QUe(u,c),p=_.useRef();yf(()=>(p.current=h,mt(c,v=>Bp(v,h)),()=>{p.current&&(mt(p.current.deps,v=>Xv(v,p.current)),ft.cancel(p.current.update))})),_.useEffect(u,[]),ree(()=>()=>{const v=p.current;mt(v.deps,g=>Xv(g,v))});const m=e.getComponentProps(a.getValue());return _.createElement(n,{...m,ref:o})})},QUe=class{constructor(n,e){this.update=n,this.deps=e}eventObserved(n){n.type=="change"&&ft.write(this.update)}};function eje(n,e){const t=new Set;return zS.dependencies=t,n.style&&(n={...n,style:e.createAnimatedStyle(n.style)}),n=new OE(n),zS.dependencies=null,[n,t]}function tje(n,e){return n&&(Te.fun(n)?n(e):n.current=e),e}var KF=Symbol.for("AnimatedComponent"),nje=(n,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=i=>new OE(i),getComponentProps:r=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:r},s=o=>{const a=WF(o)||"Anonymous";return Te.str(o)?o=s[o]||(s[o]=qF(o,i)):o=o[KF]||(o[KF]=qF(o,i)),o.displayName=`Animated(${a})`,o};return Ma(n,(o,a)=>{Te.arr(n)&&(a=WF(o)),s[a]=s(o)}),{animated:s}},WF=n=>Te.str(n)?n:n&&Te.str(n.displayName)?n.displayName:Te.fun(n)&&n.name||null;function Gi(n,...e){return Te.fun(n)?n(...e):n}var Qg=(n,e)=>n===!0||!!(e&&n&&(Te.fun(n)?n(e):Si(n).includes(e))),oee=(n,e)=>Te.obj(n)?e&&n[e]:n,aee=(n,e)=>n.default===!0?n[e]:n.default?n.default[e]:void 0,rje=n=>n,L4=(n,e=rje)=>{let t=ije;n.default&&n.default!==!0&&(n=n.default,t=Object.keys(n));const r={};for(const i of t){const s=e(n[i],i);Te.und(s)||(r[i]=s)}return r},ije=["config","onProps","onStart","onChange","onPause","onResume","onRest"],sje={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function oje(n){const e={};let t=0;if(Ma(n,(r,i)=>{sje[i]||(e[i]=r,t++)}),t)return e}function A4(n){const e=oje(n);if(e){const t={to:e};return Ma(n,(r,i)=>i in e||(t[i]=r)),t}return{...n}}function Qv(n){return n=Vi(n),Te.arr(n)?n.map(Qv):AE(n)?Ko.createStringInterpolator({range:[0,1],output:[n,n]})(1):n}function aje(n){for(const e in n)return!0;return!1}function Gx(n){return Te.fun(n)||Te.arr(n)&&Te.obj(n[0])}function zF(n,e){var t;(t=n.ref)==null||t.delete(n),e==null||e.delete(n)}function cje(n,e){var t;e&&n.ref!==e&&((t=n.ref)==null||t.delete(n),e.add(n),n.ref=e)}var lje={default:{tension:170,friction:26}},qx={...lje.default,mass:1,damping:1,easing:NUe.linear,clamp:!1},uje=class{constructor(){this.velocity=0,Object.assign(this,qx)}};function dje(n,e,t){t&&(t={...t},YF(t,e),e={...t,...e}),YF(n,e),Object.assign(n,e);for(const o in qx)n[o]==null&&(n[o]=qx[o]);let{frequency:r,damping:i}=n;const{mass:s}=n;return Te.und(r)||(r<.01&&(r=.01),i<0&&(i=0),n.tension=Math.pow(2*Math.PI/r,2)*s,n.friction=4*Math.PI*i*s/r),n}function YF(n,e){if(!Te.und(e.decay))n.duration=void 0;else{const t=!Te.und(e.tension)||!Te.und(e.friction);(t||!Te.und(e.frequency)||!Te.und(e.damping)||!Te.und(e.mass))&&(n.duration=void 0,n.decay=void 0),t&&(n.frequency=void 0)}}var XF=[],hje=class{constructor(){this.changed=!1,this.values=XF,this.toValues=null,this.fromValues=XF,this.config=new uje,this.immediate=!1}};function cee(n,{key:e,props:t,defaultProps:r,state:i,actions:s}){return new Promise((o,a)=>{let c,l,u=Qg(t.cancel??(r==null?void 0:r.cancel),e);if(u)m();else{Te.und(t.pause)||(i.paused=Qg(t.pause,e));let v=r==null?void 0:r.pause;v!==!0&&(v=i.paused||Qg(v,e)),c=Gi(t.delay||0,e),v?(i.resumeQueue.add(p),s.pause()):(s.resume(),p())}function h(){i.resumeQueue.add(p),i.timeouts.delete(l),l.cancel(),c=l.time-ft.now()}function p(){c>0&&!Ko.skipAnimation?(i.delayed=!0,l=ft.setTimeout(m,c),i.pauseQueue.add(h),i.timeouts.add(l)):m()}function m(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(h),i.timeouts.delete(l),n<=(i.cancelId||0)&&(u=!0);try{s.start({...t,callId:n,cancel:u},o)}catch(v){a(v)}}})}var M4=(n,e)=>e.length==1?e[0]:e.some(t=>t.cancelled)?Bf(n.get()):e.every(t=>t.noop)?lee(n.get()):Mo(n.get(),e.every(t=>t.finished)),lee=n=>({value:n,noop:!0,finished:!0,cancelled:!1}),Mo=(n,e,t=!1)=>({value:n,finished:e,cancelled:t}),Bf=n=>({value:n,cancelled:!0,finished:!1});function uee(n,e,t,r){const{callId:i,parentId:s,onRest:o}=e,{asyncTo:a,promise:c}=t;return!s&&n===a&&!e.reset?c:t.promise=(async()=>{t.asyncId=i,t.asyncTo=n;const l=L4(e,(S,b)=>b==="onRest"?void 0:S);let u,h;const p=new Promise((S,b)=>(u=S,h=b)),m=S=>{const b=i<=(t.cancelId||0)&&Bf(r)||i!==t.asyncId&&Mo(r,!1);if(b)throw S.result=b,h(S),S},v=(S,b)=>{const R=new JF,k=new ZF;return(async()=>{if(Ko.skipAnimation)throw ey(t),k.result=Mo(r,!1),h(k),k;m(R);const I=Te.obj(S)?{...S}:{...b,to:S};I.parentId=i,Ma(l,(C,P)=>{Te.und(I[P])&&(I[P]=C)});const T=await r.start(I);return m(R),t.paused&&await new Promise(C=>{t.resumeQueue.add(C)}),T})()};let g;if(Ko.skipAnimation)return ey(t),Mo(r,!1);try{let S;Te.arr(n)?S=(async b=>{for(const R of b)await v(R)})(n):S=Promise.resolve(n(v,r.stop.bind(r))),await Promise.all([S.then(u),p]),g=Mo(r.get(),!0,!1)}catch(S){if(S instanceof JF)g=S.result;else if(S instanceof ZF)g=S.result;else throw S}finally{i==t.asyncId&&(t.asyncId=s,t.asyncTo=s?a:void 0,t.promise=s?c:void 0)}return Te.fun(o)&&ft.batchedUpdates(()=>{o(g,r,r.item)}),g})()}function ey(n,e){Jg(n.timeouts,t=>t.cancel()),n.pauseQueue.clear(),n.resumeQueue.clear(),n.asyncId=n.asyncTo=n.promise=void 0,e&&(n.cancelId=e)}var JF=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},ZF=class extends Error{constructor(){super("SkipAnimationSignal")}},Kx=n=>n instanceof O4,fje=1,O4=class extends JQ{constructor(){super(...arguments),this.id=fje++,this._priority=0}get priority(){return this._priority}set priority(n){this._priority!=n&&(this._priority=n,this._onPriorityChange(n))}get(){const n=ma(this);return n&&n.getValue()}to(...n){return Ko.to(this,n)}interpolate(...n){return VUe(),Ko.to(this,n)}toJSON(){return this.get()}observerAdded(n){n==1&&this._attach()}observerRemoved(n){n==0&&this._detach()}_attach(){}_detach(){}_onChange(n,e=!1){Yv(this,{type:"change",parent:this,value:n,idle:e})}_onPriorityChange(n){this.idle||xE.sort(this),Yv(this,{type:"priority",parent:this,priority:n})}},$d=Symbol.for("SpringPhase"),dee=1,hee=2,fee=4,z2=n=>(n[$d]&dee)>0,vl=n=>(n[$d]&hee)>0,dg=n=>(n[$d]&fee)>0,QF=(n,e)=>e?n[$d]|=hee|dee:n[$d]&=-3,eU=(n,e)=>e?n[$d]|=fee:n[$d]&=-5,pje=class extends O4{constructor(n,e){if(super(),this.animation=new hje,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Te.und(n)||!Te.und(e)){const t=Te.obj(n)?{...n}:{...e,from:n};Te.und(t.default)&&(t.default=!0),this.start(t)}}get idle(){return!(vl(this)||this._state.asyncTo)||dg(this)}get goal(){return Vi(this.animation.to)}get velocity(){const n=ma(this);return n instanceof jy?n.lastVelocity||0:n.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return z2(this)}get isAnimating(){return vl(this)}get isPaused(){return dg(this)}get isDelayed(){return this._state.delayed}advance(n){let e=!0,t=!1;const r=this.animation;let{toValues:i}=r;const{config:s}=r,o=ME(r.to);!o&&Vs(r.to)&&(i=Si(Vi(r.to))),r.values.forEach((l,u)=>{if(l.done)return;const h=l.constructor==Zv?1:o?o[u].lastPosition:i[u];let p=r.immediate,m=h;if(!p){if(m=l.lastPosition,s.tension<=0){l.done=!0;return}let v=l.elapsedTime+=n;const g=r.fromValues[u],S=l.v0!=null?l.v0:l.v0=Te.arr(s.velocity)?s.velocity[u]:s.velocity;let b;const R=s.precision||(g==h?.005:Math.min(1,Math.abs(h-g)*.001));if(Te.und(s.duration))if(s.decay){const k=s.decay===!0?.998:s.decay,I=Math.exp(-(1-k)*v);m=g+S/(1-k)*(1-I),p=Math.abs(l.lastPosition-m)<=R,b=S*I}else{b=l.lastVelocity==null?S:l.lastVelocity;const k=s.restVelocity||R/10,I=s.clamp?0:s.bounce,T=!Te.und(I),C=g==h?l.v0>0:g<h;let P,M=!1;const D=1,F=Math.ceil(n/D);for(let U=0;U<F&&(P=Math.abs(b)>k,!(!P&&(p=Math.abs(h-m)<=R,p)));++U){T&&(M=m==h||m>h==C,M&&(b=-b*I,m=h));const B=-s.tension*1e-6*(m-h),V=-s.friction*.001*b,z=(B+V)/s.mass;b=b+z*D,m=m+b*D}}else{let k=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,l.durationProgress>0&&(l.elapsedTime=s.duration*l.durationProgress,v=l.elapsedTime+=n)),k=(s.progress||0)+v/this._memoizedDuration,k=k>1?1:k<0?0:k,l.durationProgress=k),m=g+s.easing(k)*(h-g),b=(m-l.lastPosition)/n,p=k==1}l.lastVelocity=b,Number.isNaN(m)&&(console.warn("Got NaN while animating:",this),p=!0)}o&&!o[u].done&&(p=!1),p?l.done=!0:e=!1,l.setValue(m,s.round)&&(t=!0)});const a=ma(this),c=a.getValue();if(e){const l=Vi(r.to);(c!==l||t)&&!s.decay?(a.setValue(l),this._onChange(l)):t&&s.decay&&this._onChange(c),this._stop()}else t&&this._onChange(c)}set(n){return ft.batchedUpdates(()=>{this._stop(),this._focus(n),this._set(n)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(vl(this)){const{to:n,config:e}=this.animation;ft.batchedUpdates(()=>{this._onStart(),e.decay||this._set(n,!1),this._stop()})}return this}update(n){return(this.queue||(this.queue=[])).push(n),this}start(n,e){let t;return Te.und(n)?(t=this.queue||[],this.queue=[]):t=[Te.obj(n)?n:{...e,to:n}],Promise.all(t.map(r=>this._update(r))).then(r=>M4(this,r))}stop(n){const{to:e}=this.animation;return this._focus(this.get()),ey(this._state,n&&this._lastCallId),ft.batchedUpdates(()=>this._stop(e,n)),this}reset(){this._update({reset:!0})}eventObserved(n){n.type=="change"?this._start():n.type=="priority"&&(this.priority=n.priority+1)}_prepareNode(n){const e=this.key||"";let{to:t,from:r}=n;t=Te.obj(t)?t[e]:t,(t==null||Gx(t))&&(t=void 0),r=Te.obj(r)?r[e]:r,r==null&&(r=void 0);const i={to:t,from:r};return z2(this)||(n.reverse&&([t,r]=[r,t]),r=Vi(r),Te.und(r)?ma(this)||this._set(t):this._set(r)),i}_update({...n},e){const{key:t,defaultProps:r}=this;n.default&&Object.assign(r,L4(n,(o,a)=>/^on/.test(a)?oee(o,t):o)),nU(this,n,"onProps"),fg(this,"onProps",n,this);const i=this._prepareNode(n);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return cee(++this._lastCallId,{key:t,props:n,defaultProps:r,state:s,actions:{pause:()=>{dg(this)||(eU(this,!0),Cg(s.pauseQueue),fg(this,"onPause",Mo(this,hg(this,this.animation.to)),this))},resume:()=>{dg(this)&&(eU(this,!1),vl(this)&&this._resume(),Cg(s.resumeQueue),fg(this,"onResume",Mo(this,hg(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(n.loop&&o.finished&&!(e&&o.noop)){const a=pee(n);if(a)return this._update(a,!0)}return o})}_merge(n,e,t){if(e.cancel)return this.stop(!0),t(Bf(this));const r=!Te.und(n.to),i=!Te.und(n.from);if(r||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return t(Bf(this));const{key:s,defaultProps:o,animation:a}=this,{to:c,from:l}=a;let{to:u=c,from:h=l}=n;i&&!r&&(!e.default||Te.und(u))&&(u=h),e.reverse&&([u,h]=[h,u]);const p=!cc(h,l);p&&(a.from=h),h=Vi(h);const m=!cc(u,c);m&&this._focus(u);const v=Gx(e.to),{config:g}=a,{decay:S,velocity:b}=g;(r||i)&&(g.velocity=0),e.config&&!v&&dje(g,Gi(e.config,s),e.config!==o.config?Gi(o.config,s):void 0);let R=ma(this);if(!R||Te.und(u))return t(Mo(this,!0));const k=Te.und(e.reset)?i&&!e.default:!Te.und(h)&&Qg(e.reset,s),I=k?h:this.get(),T=Qv(u),C=Te.num(T)||Te.arr(T)||AE(T),P=!v&&(!C||Qg(o.immediate||e.immediate,s));if(m){const U=Vx(u);if(U!==R.constructor)if(P)R=this._set(T);else throw Error(`Cannot animate between ${R.constructor.name} and ${U.name}, as the "to" prop suggests`)}const M=R.constructor;let D=Vs(u),F=!1;if(!D){const U=k||!z2(this)&&p;(m||U)&&(F=cc(Qv(I),T),D=!F),(!cc(a.immediate,P)&&!P||!cc(g.decay,S)||!cc(g.velocity,b))&&(D=!0)}if(F&&vl(this)&&(a.changed&&!k?D=!0:D||this._stop(c)),!v&&((D||Vs(c))&&(a.values=R.getPayload(),a.toValues=Vs(u)?null:M==Zv?[1]:Si(T)),a.immediate!=P&&(a.immediate=P,!P&&!k&&this._set(c)),D)){const{onRest:U}=a;mt(mje,V=>nU(this,e,V));const B=Mo(this,hg(this,c));Cg(this._pendingCalls,B),this._pendingCalls.add(t),a.changed&&ft.batchedUpdates(()=>{var V;a.changed=!k,U==null||U(B,this),k?Gi(o.onRest,B):(V=a.onStart)==null||V.call(a,B,this)})}k&&this._set(I),v?t(uee(e.to,e,this._state,this)):D?this._start():vl(this)&&!m?this._pendingCalls.add(t):t(lee(I))}_focus(n){const e=this.animation;n!==e.to&&(VF(this)&&this._detach(),e.to=n,VF(this)&&this._attach())}_attach(){let n=0;const{to:e}=this.animation;Vs(e)&&(Bp(e,this),Kx(e)&&(n=e.priority+1)),this.priority=n}_detach(){const{to:n}=this.animation;Vs(n)&&Xv(n,this)}_set(n,e=!0){const t=Vi(n);if(!Te.und(t)){const r=ma(this);if(!r||!cc(t,r.getValue())){const i=Vx(t);!r||r.constructor!=i?P4(this,i.create(t)):r.setValue(t),r&&ft.batchedUpdates(()=>{this._onChange(t,e)})}}return ma(this)}_onStart(){const n=this.animation;n.changed||(n.changed=!0,fg(this,"onStart",Mo(this,hg(this,n.to)),this))}_onChange(n,e){e||(this._onStart(),Gi(this.animation.onChange,n,this)),Gi(this.defaultProps.onChange,n,this),super._onChange(n,e)}_start(){const n=this.animation;ma(this).reset(Vi(n.to)),n.immediate||(n.fromValues=n.values.map(e=>e.lastPosition)),vl(this)||(QF(this,!0),dg(this)||this._resume())}_resume(){Ko.skipAnimation?this.finish():xE.start(this)}_stop(n,e){if(vl(this)){QF(this,!1);const t=this.animation;mt(t.values,i=>{i.done=!0}),t.toValues&&(t.onChange=t.onPause=t.onResume=void 0),Yv(this,{type:"idle",parent:this});const r=e?Bf(this.get()):Mo(this.get(),hg(this,n??t.to));Cg(this._pendingCalls,r),t.changed&&(t.changed=!1,fg(this,"onRest",r,this))}}};function hg(n,e){const t=Qv(e),r=Qv(n.get());return cc(r,t)}function pee(n,e=n.loop,t=n.to){const r=Gi(e);if(r){const i=r!==!0&&A4(r),s=(i||n).reverse,o=!i||i.reset;return YS({...n,loop:e,default:!1,pause:void 0,to:!s||Gx(t)?t:void 0,from:o?n.from:void 0,reset:o,...i})}}function YS(n){const{to:e,from:t}=n=A4(n),r=new Set;return Te.obj(e)&&tU(e,r),Te.obj(t)&&tU(t,r),n.keys=r.size?Array.from(r):null,n}function tU(n,e){Ma(n,(t,r)=>t!=null&&e.add(r))}var mje=["onStart","onRest","onChange","onPause","onResume"];function nU(n,e,t){n.animation[t]=e[t]!==aee(e,t)?oee(e[t],n.key):void 0}function fg(n,e,...t){var r,i,s,o;(i=(r=n.animation)[e])==null||i.call(r,...t),(o=(s=n.defaultProps)[e])==null||o.call(s,...t)}var gje=["onStart","onChange","onRest"],vje=1,yje=class{constructor(e,t){this.id=vje++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((t,r)=>e[r]=t.get()),e}set(e){for(const t in e){const r=e[t];Te.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(YS(e)),this}start(e){let{queue:t}=this;return e?t=Si(e).map(YS):this.queue=[],this._flush?this._flush(this,t):(yee(this,t),_je(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const r=this.springs;mt(Si(t),i=>r[i].stop(!!e))}else ey(this._state,this._lastAsyncId),this.each(r=>r.stop(!!e));return this}pause(e){if(Te.und(e))this.start({pause:!0});else{const t=this.springs;mt(Si(e),r=>t[r].pause())}return this}resume(e){if(Te.und(e))this.start({pause:!1});else{const t=this.springs;mt(Si(e),r=>t[r].resume())}return this}each(e){Ma(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:r}=this._events,i=this._active.size>0,s=this._changed.size>0;(i&&!this._started||s&&!this._started)&&(this._started=!0,Jg(e,([c,l])=>{l.value=this.get(),c(l,this,this._item)}));const o=!i&&this._started,a=s||o&&r.size?this.get():null;s&&t.size&&Jg(t,([c,l])=>{l.value=a,c(l,this,this._item)}),o&&(this._started=!1,Jg(r,([c,l])=>{l.value=a,c(l,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;ft.onFrame(this._onFrame)}};function _je(n,e){return Promise.all(e.map(t=>mee(n,t))).then(t=>M4(n,t))}async function mee(n,e,t){const{keys:r,to:i,from:s,loop:o,onRest:a,onResolve:c}=e,l=Te.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),s===!1&&(e.from=null);const u=Te.arr(i)||Te.fun(i)?i:void 0;u?(e.to=void 0,e.onRest=void 0,l&&(l.onRest=void 0)):mt(gje,g=>{const S=e[g];if(Te.fun(S)){const b=n._events[g];e[g]=({finished:R,cancelled:k})=>{const I=b.get(S);I?(R||(I.finished=!1),k&&(I.cancelled=!0)):b.set(S,{value:null,finished:R||!1,cancelled:k||!1})},l&&(l[g]=e[g])}});const h=n._state;e.pause===!h.paused?(h.paused=e.pause,Cg(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const p=(r||Object.keys(n.springs)).map(g=>n.springs[g].start(e)),m=e.cancel===!0||aee(e,"cancel")===!0;(u||m&&h.asyncId)&&p.push(cee(++n._lastAsyncId,{props:e,state:h,actions:{pause:Bx,resume:Bx,start(g,S){m?(ey(h,n._lastAsyncId),S(Bf(n))):(g.onRest=a,S(uee(u,g,h,n)))}}})),h.paused&&await new Promise(g=>{h.resumeQueue.add(g)});const v=M4(n,await Promise.all(p));if(o&&v.finished&&!(t&&v.noop)){const g=pee(e,o,i);if(g)return yee(n,[g]),mee(n,g,!0)}return c&&ft.batchedUpdates(()=>c(v,n,n.item)),v}function bje(n,e){const t={...n.springs};return e&&mt(Si(e),r=>{Te.und(r.keys)&&(r=YS(r)),Te.obj(r.to)||(r={...r,to:void 0}),vee(t,r,i=>gee(i))}),Sje(n,t),t}function Sje(n,e){Ma(e,(t,r)=>{n.springs[r]||(n.springs[r]=t,Bp(t,n))})}function gee(n,e){const t=new pje;return t.key=n,e&&Bp(t,e),t}function vee(n,e,t){e.keys&&mt(e.keys,r=>{(n[r]||(n[r]=t(r)))._prepareNode(e)})}function yee(n,e){mt(e,t=>{vee(n.springs,t,r=>gee(r,n))})}var NE=({children:n,...e})=>{const t=_.useContext(XS),r=e.pause||!!t.pause,i=e.immediate||!!t.immediate;e=WUe(()=>({pause:r,immediate:i}),[r,i]);const{Provider:s}=XS;return _.createElement(s,{value:e},n)},XS=wje(NE,{});NE.Provider=XS.Provider;NE.Consumer=XS.Consumer;function wje(n,e){return Object.assign(n,_.createContext(e)),n.Provider._context=n,n.Consumer._context=n,n}var Eje=()=>{const n=[],e=function(r){qUe();const i=[];return mt(n,(s,o)=>{if(Te.und(r))i.push(s.start());else{const a=t(r,s,o);a&&i.push(s.start(a))}}),i};e.current=n,e.add=function(r){n.includes(r)||n.push(r)},e.delete=function(r){const i=n.indexOf(r);~i&&n.splice(i,1)},e.pause=function(){return mt(n,r=>r.pause(...arguments)),this},e.resume=function(){return mt(n,r=>r.resume(...arguments)),this},e.set=function(r){mt(n,(i,s)=>{const o=Te.fun(r)?r(s,i):r;o&&i.set(o)})},e.start=function(r){const i=[];return mt(n,(s,o)=>{if(Te.und(r))i.push(s.start());else{const a=this._getProps(r,s,o);a&&i.push(s.start(a))}}),i},e.stop=function(){return mt(n,r=>r.stop(...arguments)),this},e.update=function(r){return mt(n,(i,s)=>i.update(this._getProps(r,i,s))),this};const t=function(r,i,s){return Te.fun(r)?r(s,i):r};return e._getProps=t,e};function Cje(n,e,t){const r=Te.fun(e)&&e,{reset:i,sort:s,trail:o=0,expires:a=!0,exitBeforeEnter:c=!1,onDestroyed:l,ref:u,config:h}=r?r():e,p=_.useMemo(()=>r||arguments.length==3?Eje():void 0,[]),m=Si(n),v=[],g=_.useRef(null),S=i?null:g.current;yf(()=>{g.current=v}),ree(()=>(mt(v,z=>{p==null||p.add(z.ctrl),z.ctrl.ref=p}),()=>{mt(g.current,z=>{z.expired&&clearTimeout(z.expirationId),zF(z.ctrl,p),z.ctrl.stop(!0)})}));const b=Ije(m,r?r():e,S),R=i&&g.current||[];yf(()=>mt(R,({ctrl:z,item:H,key:J})=>{zF(z,p),Gi(l,H,J)}));const k=[];if(S&&mt(S,(z,H)=>{z.expired?(clearTimeout(z.expirationId),R.push(z)):(H=k[H]=b.indexOf(z.key),~H&&(v[H]=z))}),mt(m,(z,H)=>{v[H]||(v[H]={key:b[H],item:z,phase:"mount",ctrl:new yje},v[H].ctrl.item=z)}),k.length){let z=-1;const{leave:H}=r?r():e;mt(k,(J,Y)=>{const G=S[Y];~J?(z=v.indexOf(G),v[z]={...G,item:m[J]}):H&&v.splice(++z,0,G)})}Te.fun(s)&&v.sort((z,H)=>s(z.item,H.item));let I=-o;const T=nee(),C=L4(e),P=new Map,M=_.useRef(new Map),D=_.useRef(!1);mt(v,(z,H)=>{const J=z.key,Y=z.phase,G=r?r():e;let K,ee;const q=Gi(G.delay||0,J);if(Y=="mount")K=G.enter,ee="enter";else{const Ne=b.indexOf(J)<0;if(Y!="leave")if(Ne)K=G.leave,ee="leave";else if(K=G.update)ee="update";else return;else if(!Ne)K=G.enter,ee="enter";else return}if(K=Gi(K,z.item,H),K=Te.obj(K)?A4(K):{to:K},!K.config){const Ne=h||C.config;K.config=Gi(Ne,z.item,H,ee)}I+=o;const Q={...C,delay:q+I,ref:u,immediate:G.immediate,reset:!1,...K};if(ee=="enter"&&Te.und(Q.from)){const Ne=r?r():e,Le=Te.und(Ne.initial)||S?Ne.from:Ne.initial;Q.from=Gi(Le,z.item,H)}const{onResolve:Se}=Q;Q.onResolve=Ne=>{Gi(Se,Ne);const Le=g.current,xe=Le.find(Ee=>Ee.key===J);if(xe&&!(Ne.cancelled&&xe.phase!="update")&&xe.ctrl.idle){const Ee=Le.every(Ce=>Ce.ctrl.idle);if(xe.phase=="leave"){const Ce=Gi(a,xe.item);if(Ce!==!1){const Ve=Ce===!0?0:Ce;if(xe.expired=!0,!Ee&&Ve>0){Ve<=2147483647&&(xe.expirationId=setTimeout(T,Ve));return}}}Ee&&Le.some(Ce=>Ce.expired)&&(M.current.delete(xe),c&&(D.current=!0),T())}};const Ie=bje(z.ctrl,Q);ee==="leave"&&c?M.current.set(z,{phase:ee,springs:Ie,payload:Q}):P.set(z,{phase:ee,springs:Ie,payload:Q})});const F=_.useContext(NE),U=XUe(F),B=F!==U&&aje(F);yf(()=>{B&&mt(v,z=>{z.ctrl.start({default:F})})},[F]),mt(P,(z,H)=>{if(M.current.size){const J=v.findIndex(Y=>Y.key===H.key);v.splice(J,1)}}),yf(()=>{mt(M.current.size?M.current:P,({phase:z,payload:H},J)=>{const{ctrl:Y}=J;J.phase=z,p==null||p.add(Y),B&&z=="enter"&&Y.start({default:F}),H&&(cje(Y,H.ref),(Y.ref||p)&&!D.current?Y.update(H):(Y.start(H),D.current&&(D.current=!1)))})},i?void 0:t);const V=z=>_.createElement(_.Fragment,null,v.map((H,J)=>{const{springs:Y}=P.get(H)||H.ctrl,G=z({...Y},H.item,H,J);return G&&G.type?_.createElement(G.type,{...G.props,key:Te.str(H.key)||Te.num(H.key)?H.key:H.ctrl.id,ref:G.ref}):G}));return p?[V,p]:V}var Tje=1;function Ije(n,{key:e,keys:t=e},r){if(t===null){const i=new Set;return n.map(s=>{const o=r&&r.find(a=>a.item===s&&a.phase!=="leave"&&!i.has(a));return o?(i.add(o),o.key):Tje++})}return Te.und(t)?n:Te.fun(t)?n.map(t):Si(t)}var Rje=class extends O4{constructor(n,e){super(),this.source=n,this.idle=!0,this._active=new Set,this.calc=Wv(...e);const t=this._get(),r=Vx(t);P4(this,r.create(t))}advance(n){const e=this._get(),t=this.get();cc(e,t)||(ma(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&rU(this._active)&&Y2(this)}_get(){const n=Te.arr(this.source)?this.source.map(Vi):Si(Vi(this.source));return this.calc(...n)}_start(){this.idle&&!rU(this._active)&&(this.idle=!1,mt(ME(this),n=>{n.done=!1}),Ko.skipAnimation?(ft.batchedUpdates(()=>this.advance()),Y2(this)):xE.start(this))}_attach(){let n=1;mt(Si(this.source),e=>{Vs(e)&&Bp(e,this),Kx(e)&&(e.idle||this._active.add(e),n=Math.max(n,e.priority+1))}),this.priority=n,this._start()}_detach(){mt(Si(this.source),n=>{Vs(n)&&Xv(n,this)}),this._active.clear(),Y2(this)}eventObserved(n){n.type=="change"?n.idle?this.advance():(this._active.add(n.parent),this._start()):n.type=="idle"?this._active.delete(n.parent):n.type=="priority"&&(this.priority=Si(this.source).reduce((e,t)=>Math.max(e,(Kx(t)?t.priority:0)+1),0))}};function kje(n){return n.idle!==!1}function rU(n){return!n.size||Array.from(n).every(kje)}function Y2(n){n.idle||(n.idle=!0,mt(ME(n),e=>{e.done=!0}),Yv(n,{type:"idle",parent:n}))}Ko.assign({createStringInterpolator:eee,to:(n,e)=>new Rje(n,e)});var _ee=/^--/;function xje(n,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!_ee.test(n)&&!(ev.hasOwnProperty(n)&&ev[n])?e+"px":(""+e).trim()}var iU={};function Pje(n,e){if(!n.nodeType||!n.setAttribute)return!1;const t=n.nodeName==="filter"||n.parentNode&&n.parentNode.nodeName==="filter",{className:r,style:i,children:s,scrollTop:o,scrollLeft:a,viewBox:c,...l}=e,u=Object.values(l),h=Object.keys(l).map(p=>t||n.hasAttribute(p)?p:iU[p]||(iU[p]=p.replace(/([A-Z])/g,m=>"-"+m.toLowerCase())));s!==void 0&&(n.textContent=s);for(const p in i)if(i.hasOwnProperty(p)){const m=xje(p,i[p]);_ee.test(p)?n.style.setProperty(p,m):n.style[p]=m}h.forEach((p,m)=>{n.setAttribute(p,u[m])}),r!==void 0&&(n.className=r),o!==void 0&&(n.scrollTop=o),a!==void 0&&(n.scrollLeft=a),c!==void 0&&n.setAttribute("viewBox",c)}var ev={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lje=(n,e)=>n+e.charAt(0).toUpperCase()+e.substring(1),Aje=["Webkit","Ms","Moz","O"];ev=Object.keys(ev).reduce((n,e)=>(Aje.forEach(t=>n[Lje(t,e)]=n[e]),n),ev);var Mje=/^(matrix|translate|scale|rotate|skew)/,Oje=/^(translate)/,Nje=/^(rotate|skew)/,X2=(n,e)=>Te.num(n)&&n!==0?n+e:n,pb=(n,e)=>Te.arr(n)?n.every(t=>pb(t,e)):Te.num(n)?n===e:parseFloat(n)===e,Dje=class extends OE{constructor({x:n,y:e,z:t,...r}){const i=[],s=[];(n||e||t)&&(i.push([n||0,e||0,t||0]),s.push(o=>[`translate3d(${o.map(a=>X2(a,"px")).join(",")})`,pb(o,0)])),Ma(r,(o,a)=>{if(a==="transform")i.push([o||""]),s.push(c=>[c,c===""]);else if(Mje.test(a)){if(delete r[a],Te.und(o))return;const c=Oje.test(a)?"px":Nje.test(a)?"deg":"";i.push(Si(o)),s.push(a==="rotate3d"?([l,u,h,p])=>[`rotate3d(${l},${u},${h},${X2(p,c)})`,pb(p,0)]:l=>[`${a}(${l.map(u=>X2(u,c)).join(",")})`,pb(l,a.startsWith("scale")?1:0)])}}),i.length&&(r.transform=new Fje(i,s)),super(r)}},Fje=class extends JQ{constructor(n,e){super(),this.inputs=n,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let n="",e=!0;return mt(this.inputs,(t,r)=>{const i=Vi(t[0]),[s,o]=this.transforms[r](Te.arr(i)?i:t.map(Vi));n+=" "+s,e=e&&o}),e?"none":n}observerAdded(n){n==1&&mt(this.inputs,e=>mt(e,t=>Vs(t)&&Bp(t,this)))}observerRemoved(n){n==0&&mt(this.inputs,e=>mt(e,t=>Vs(t)&&Xv(t,this)))}eventObserved(n){n.type=="change"&&(this._value=null),Yv(this,n)}},Uje=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];Ko.assign({batchedUpdates:Sp.unstable_batchedUpdates,createStringInterpolator:eee,colors:EUe});var jje=nje(Uje,{applyAnimatedValues:Pje,createAnimatedStyle:n=>new Dje(n),getComponentProps:({scrollTop:n,scrollLeft:e,...t})=>t}),bee=jje.animated;const $je="_media_40njg_8",Bje="_mirror_40njg_25",Hje="_bg_40njg_37",Vje="_avatar_40njg_45",Gje="_fg_40njg_70",qje="_nameTag_40njg_84",Kje="_status_40njg_100",Wje="_reactions_40njg_119",zje="_name_40njg_84",Yje="_errorIcon_40njg_138",So={media:$je,mirror:Bje,bg:Hje,avatar:Vje,fg:Gje,nameTag:qje,status:Kje,reactions:Wje,name:zje,errorIcon:Yje},Xje="_reactionIndicatorWidget_14f9a_1",Jje="_reactionIndicatorWidgetLarge_14f9a_21",Zje="_reactionLarge_14f9a_28",Qje="_reaction_14f9a_1",r_={reactionIndicatorWidget:Xje,reactionIndicatorWidgetLarge:Jje,reactionLarge:Zje,reaction:Qje};function See({emoji:n,miniature:e,children:t}){const{t:r}=Xe();return w.jsxs("div",{className:De(r_.reactionIndicatorWidget,{[r_.reactionIndicatorWidgetLarge]:!e}),children:[w.jsx("div",{className:De(r_.reaction,{[r_.reactionLarge]:!e}),children:w.jsx("span",{role:"img","aria-label":r("common.reaction"),children:n})}),t]})}function e$e({raisedHandTime:n,miniature:e,showTimer:t,onClick:r}){const{t:i}=Xe(),[s,o]=_.useState(""),a=_.useMemo(()=>new Intl.DurationFormat(void 0,{minutesDisplay:"always",secondsDisplay:"always",hoursDisplay:"auto",style:"digital"}),[]),c=_.useCallback(u=>{r&&(u.preventDefault(),r())},[r]);if(_.useEffect(()=>{if(!n||!t)return;const u=()=>{const p=Math.ceil((new Date().getTime()-n.getTime())/1e3);o(a.format({seconds:p%60,minutes:Math.floor(p/60)}))};u();const h=setInterval(u,1e3);return()=>clearInterval(h)},[o,n,t,a]),!n)return;const l=w.jsx(See,{emoji:"✋",miniature:e,children:t&&w.jsx("p",{children:s})});return r?w.jsx("button",{"aria-label":i("action.lower_hand"),style:{display:"contents",background:"none"},onClick:c,children:l}):l}const t$e="_modal_13thw_8",n$e="_statsPill_13thw_12",sU={modal:t$e,statsPill:n$e},r$e=({audio:n,video:e,...t})=>{const[r,i]=_.useState(!1),[s,o]=_.useState("none"),a=l=>{i(!0),o(l)},c=()=>{i(!1),o("none")};return w.jsxs("div",{className:De(So.nameTag,sU.statsPill),children:[w.jsx(th,{title:"RTC Connection Stats",open:r,onDismiss:c,children:w.jsx("div",{className:sU.modal,children:w.jsx("pre",{children:s!=="none"&&JSON.stringify(s==="video"?e:n,null,2)})})}),n&&w.jsx("div",{children:w.jsx(Dt,{onClick:()=>a("audio"),size:"sm",kind:"tertiary",Icon:SL,children:"jitter"in n&&typeof n.jitter=="number"&&w.jsxs(Xt,{as:"span",size:"xs",title:"jitter",children:[" ",(n.jitter*1e3).toFixed(0),"ms"]})})}),e&&w.jsx("div",{children:w.jsxs(Dt,{onClick:()=>a("video"),size:"sm",kind:"tertiary",Icon:KY,children:[!!(e!=null&&e.framesPerSecond)&&w.jsxs(Xt,{as:"span",size:"xs",title:"frame rate",children:[" ",e.framesPerSecond.toFixed(0),"fps"]}),"jitter"in e&&typeof e.jitter=="number"&&w.jsxs(Xt,{as:"span",size:"xs",title:"jitter",children:[" ",(e.jitter*1e3).toFixed(0),"ms"]}),"frameHeight"in e&&typeof e.frameHeight=="number"&&"frameWidth"in e&&typeof e.frameWidth=="number"&&w.jsxs(Xt,{as:"span",size:"xs",title:"frame size",children:[" ",e.frameWidth,"x",e.frameHeight]}),"qualityLimitationReason"in e&&typeof e.qualityLimitationReason=="string"&&e.qualityLimitationReason!=="none"&&w.jsxs(Xt,{as:"span",size:"xs",title:"quality limitation reason",children:[" ",e.qualityLimitationReason]})]})})]})},$y=_.forwardRef(({className:n,style:e,targetWidth:t,targetHeight:r,video:i,videoFit:s,mirror:o,member:a,videoEnabled:c,unencryptedWarning:l,nameTagLeadingIcon:u,displayName:h,primaryButton:p,encryptionStatus:m,raisedHandTime:v,currentReaction:g,raisedHandOnClick:S,localParticipant:b,audioStreamStats:R,videoStreamStats:k,...I},T)=>{const{t:C}=Xe(),[P]=Mr(lZ),M=Math.round(Math.min(t,r)/2);return w.jsxs(bee.div,{className:De(So.media,n,{[So.mirror]:o}),style:e,ref:T,"data-testid":"videoTile","data-video-fit":s,...I,children:[w.jsxs("div",{className:So.bg,children:[w.jsx(Np,{id:(a==null?void 0:a.userId)??h,name:h,size:M,src:a==null?void 0:a.getMxcAvatarUrl(),className:So.avatar,style:{display:i&&c?"none":"initial"}}),(i==null?void 0:i.publication)!==void 0&&w.jsx(rFe,{trackRef:i,tabIndex:-1,disablePictureInPicture:!0,style:{display:i&&c?"block":"none"},"data-testid":"video"})]}),w.jsxs("div",{className:So.fg,children:[w.jsxs("div",{className:So.reactions,children:[w.jsx(e$e,{raisedHandTime:v,miniature:M<96,showTimer:P,onClick:S}),g&&w.jsx(See,{miniature:M<96,emoji:g.emoji})]}),!i&&!b&&w.jsx("div",{className:So.status,children:C("video_tile.waiting_for_media")}),(R||k)&&w.jsx(r$e,{audio:R,video:k}),w.jsxs("div",{className:So.nameTag,children:[u,w.jsx(Xt,{as:"span",size:"sm",weight:"medium",className:So.name,"data-testid":"name_tag",children:h}),l&&w.jsx(di,{label:C("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,children:w.jsx(Hw,{width:20,height:20,className:So.errorIcon,role:"img","aria-label":C("common.unencrypted")})})]}),p]})]})});$y.displayName="MediaView";const By=(...n)=>_.useCallback(e=>n.forEach(t=>{typeof t=="function"?t(e):t!==null&&(t.current=e)}),n),N4=_.forwardRef(({vm:n,showSpeakingIndicators:e,locallyMuted:t,menuStart:r,menuEnd:i,className:s,displayName:o,...a},c)=>{const{toggleRaisedHand:l}=r4(),{t:u}=Xe(),h=st(n.video$),p=st(n.unencryptedWarning$),m=st(n.encryptionStatus$),v=st(n.audioStreamStats$),g=st(n.videoStreamStats$),S=st(n.audioEnabled$),b=st(n.videoEnabled$),R=st(n.speaking$),k=st(n.cropVideo$),I=_.useCallback(H=>{H.preventDefault(),n.toggleFitContain()},[n]),T=Vv(n.handRaised$),C=Vv(n.reaction$),P=t?aIe:S?SL:TY,M=u(t?"video_tile.muted_for_me":S?"microphone_on":"microphone_off"),[D,F]=_.useState(!1),U=w.jsxs(w.Fragment,{children:[r,w.jsx(_L,{Icon:vY,label:u("video_tile.change_fit_contain"),checked:k,onSelect:I}),i]}),B=n.local?()=>void l():void 0,V=e&&R,z=w.jsx($y,{ref:c,video:h,member:n.member,unencryptedWarning:p,encryptionStatus:m,videoEnabled:b,videoFit:k?"cover":"contain",className:De(s,Eg.tile,{[Eg.speaking]:V,[Eg.handRaised]:!V&&T}),nameTagLeadingIcon:w.jsx(P,{width:20,height:20,"aria-label":M,"data-muted":t||!S,className:Eg.muteIcon}),displayName:o,primaryButton:w.jsx(dL,{open:D,onOpenChange:F,title:o,trigger:w.jsx("button",{"aria-label":u("common.options"),children:w.jsx(JTe,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:U}),raisedHandTime:T??void 0,currentReaction:C??void 0,raisedHandOnClick:B,localParticipant:n.local,audioStreamStats:v,videoStreamStats:g,...a});return w.jsx(kEe,{title:o,trigger:z,hasAccessibleAlternative:!0,children:U})});N4.displayName="UserMediaTile";const wee=_.forwardRef(({vm:n,onOpenProfile:e,...t},r)=>{const{t:i}=Xe(),s=st(n.mirror$),o=st(n.alwaysShow$),a=Pc(o),c=_.useCallback(l=>{l.preventDefault(),n.setAlwaysShow(!a.current)},[n,a]);return w.jsx(N4,{ref:r,vm:n,locallyMuted:!1,mirror:s,menuStart:w.jsx(_L,{Icon:ZCe,label:i("video_tile.always_show"),checked:o,onSelect:c}),menuEnd:e&&w.jsx(rp,{Icon:VY,label:i("common.profile"),onSelect:e}),...t})});wee.displayName="LocalUserMediaTile";const Eee=_.forwardRef(({vm:n,...e},t)=>{const{t:r}=Xe(),i=st(n.locallyMuted$),s=st(n.localVolume$),o=_.useCallback(u=>{u.preventDefault(),n.toggleLocallyMuted()},[n]),a=_.useCallback(u=>n.setLocalVolume(u),[n]),c=_.useCallback(()=>n.commitLocalVolume(),[n]),l=i?cIe:lIe;return w.jsx(N4,{ref:t,vm:n,locallyMuted:i,mirror:!1,menuStart:w.jsxs(w.Fragment,{children:[w.jsx(_L,{Icon:YTe,label:r("video_tile.mute_for_me"),checked:i,onSelect:o}),w.jsx(rp,{as:"div",Icon:l,label:null,onSelect:null,children:w.jsx(qZ,{className:Eg.volumeSlider,label:r("video_tile.volume"),value:s,onValueChange:a,onValueCommit:c,min:0,max:1,step:.01})})]}),...e})});Eee.displayName="RemoteUserMediaTile";const Cee=_.forwardRef(({vm:n,onOpenProfile:e,...t},r)=>{const i=_.useRef(null),s=By(i,r),o=st(n.media$),a=st(o.displayname$);return o instanceof dp?w.jsx(wee,{ref:s,vm:o,onOpenProfile:e,displayName:a,...t}):w.jsx(Eee,{ref:s,vm:o,displayName:a,...t})});Cee.displayName="GridTile";const i$e=({rageshakeRequestId:n,roomId:e,open:t,onDismiss:r})=>{const{t:i}=Xe(),{submitRageshake:s,sending:o,sent:a,error:c}=t4();return _.useEffect(()=>{a&&r()},[a,r]),w.jsxs(th,{title:i("rageshake_request_modal.title"),open:t,onDismiss:r,children:[w.jsx(Xt,{children:i("rageshake_request_modal.body")}),w.jsx(_t,{children:w.jsx(Dt,{onClick:()=>void s({sendLogs:!0,rageshakeRequestId:n,roomId:e}),disabled:o,children:i(o?"rageshake_sending_logs":"rageshake_send_logs")})}),c&&w.jsx(_t,{children:w.jsx(Eu,{error:c})})]})};function oU(n){return new Worker(""+new URL("livekit-client.e2ee.worker-uNa5aSsA.js",import.meta.url).href,{name:n==null?void 0:n.name})}const s$e={audioPreset:Gb.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[Ea.h180,Ea.h360],screenShareEncoding:Ew.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:Ea.h720.encoding,backupCodec:{codec:"vp8",encoding:Ea.h720.encoding}},J2={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:Ea.h720.resolution},publishDefaults:s$e,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new yH,disconnectOnPageLeave:!0,webAudioMix:!1};function o$e(n){const[e,t]=_.useState(()=>{const i=n.getActiveFocus();return i&&ok(i)?i:void 0}),r=_.useCallback(()=>{const i=n.getActiveFocus();if(!(i&&!ok(i))&&!Cd(e,i)){const s=n.getOldestMembership();O.warn(`Got new active focus from membership: ${s==null?void 0:s.sender}/${s==null?void 0:s.deviceId}.
        Updating focus (focus switch) from ${JSON.stringify(e)} to ${JSON.stringify(i)}`),t(i)}},[e,n]);return _.useEffect(()=>(n.on(ts.MembershipsChanged,r),()=>{n.off(ts.MembershipsChanged,r)})),e}function a$e(n,e){return n===void 0&&e===void 0?!0:n===void 0||e===void 0?!1:n.jwt===e.jwt&&n.url===e.url}function c$e(n,e){const[t,r]=_.useState(void 0),i=o$e(e);return _.useEffect(()=>{i?l$e(n,i).then(s=>{r(s)},s=>{O.error("Failed to get SFU config",s)}):r(void 0)},[n,i]),t}async function l$e(n,e){const t=await n.getOpenIdToken();O.debug("Got openID token",t);try{O.info(`Trying to get JWT from call's active focus URL of ${e.livekit_service_url}...`);const r=await u$e(n,e.livekit_service_url,e.livekit_alias,t);return O.info("Got JWT from call's active focus URL."),r}catch(r){O.warn(`Failed to get JWT from RTC session's active focus URL of ${e.livekit_service_url}.`,r);return}}async function u$e(n,e,t,r){try{const i=await fetch(e+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:t,openid_token:r,device_id:n.getDeviceId()})});if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}catch(i){throw new Error("SFU Config fetch failed with exception "+i)}}var Wx=(n=>(n.ECSwitchingFocus="ec_switching_focus",n.ECWaiting="ec_waiting",n))(Wx||{});function i_(n){return!!(n!=null&&n.url)&&!!(n!=null&&n.jwt)}async function d$e(n,e,t,r){if(n.localParticipant.getTrackPublication(pe.Source.Microphone)){O.warn("Pre-creating audio track but participant already appears to have an microphone track: this shouldn't happen!"),gpe("Pre-creating audio track but participant already appears to have an microphone track!");return}O.info("Pre-creating microphone track");let i;try{const s=await n.localParticipant.createTracks({audio:r});s.length<1?O.info("Tried to pre-create local audio track but got no tracks"):i=s[0],O.info("Pre-created microphone track")}catch(s){O.error("Failed to pre-create microphone track",s)}if(t||await(i==null?void 0:i.mute()),n.localParticipant.getTrackPublication(pe.Source.Microphone)){O.warn("Pre-created audio track but participant already appears to have an microphone track: this shouldn't happen!"),i==null||i.stop();return}O.info("Connecting & publishing");try{await Tee(n,e,i,[])}catch(s){throw i==null||i.stop(),O.debug("Stopped precreated audio tracks."),s}}async function Tee(n,e,t,r){const i=$t.instance.eventCallConnectDuration;i.cacheConnectStart(),n.once(he.SignalConnected,i.cacheWsConnect);try{await n.connect(e.url,e.jwt,{peerConnectionTimeout:window.peerConnectionTimeout??45e3,websocketTimeout:window.websocketTimeout??45e3})}catch(s){throw s instanceof rn&&(s.status===503||s.status===429)?new RNe:s}n.off(he.SignalConnected,i.cacheWsConnect),i.track({log:!0}),t&&(O.info("Publishing precreated mic track"),await n.localParticipant.publishTrack(t,{source:pe.Source.Microphone})),O.info(`Publishing ${r.length} precreated screenshare tracks`);for(const s of r)n.localParticipant.publishTrack(s,{source:pe.Source.ScreenShare}).catch(o=>{O.error("Failed to publish screenshare track",o)})}function h$e(n,e,t,r){const[i,s]=_.useState(r&&t?t.state:"ec_waiting"),[o,a]=_.useState(!1),[c,l]=_.useState(!1),[u,h]=_.useState(null);if(u!==null)throw u;const p=_.useCallback(g=>{g==Ct.Connected&&a(!1),s(g)},[]);_.useEffect(()=>{const g=t;return t&&t.on(he.ConnectionStateChanged,p),()=>{g&&g.off(he.ConnectionStateChanged,p)}},[t,p]);const m=_.useCallback(async()=>{const g=[];for(const S of t.localParticipant.videoTrackPublications.values())if(S.track&&S.source==pe.Source.ScreenShare){const b=S.track.mediaStreamTrack.clone();b.enabled=!0,g.push(b)}a(!0),await(t==null?void 0:t.disconnect()),l(!0);try{await Tee(t,r,void 0,g)}finally{l(!1)}},[t,r]),v=_.useRef(Object.assign({},r));return _.useEffect(()=>{var g;i_(r)&&i_(v.current)&&!a$e(v.current,r)?(O.info(`SFU config changed! URL was ${(g=v.current)==null?void 0:g.url} now ${r==null?void 0:r.url}`),m().catch(S=>{O.error("Failed to switch focus",S)})):!i_(v.current)&&i_(r)&&(l(!0),d$e(t,r,e,n).catch(S=>{S instanceof Py?h(S):O.error("Failed to connect to SFU",S)}).finally(()=>l(!1))),v.current=Object.assign({},r)},[r,t,n,e,m]),o?"ec_switching_focus":c?Ct.Connecting:i}class f$e extends QH{constructor(){super({ratchetWindowSize:0,keyringSize:256}),this.onEncryptionKeyChanged=(e,t,r)=>{ZH(e).then(i=>{var s;this.onSetEncryptionKey(i,r,t),O.debug(`Sent new key to livekit room=${(s=this.rtcSession)==null?void 0:s.room.roomId} participantId=${r} encryptionKeyIndex=${t}`)},i=>{var s;O.error(`Failed to create key material from buffer for livekit room=${(s=this.rtcSession)==null?void 0:s.room.roomId} participantId=${r} encryptionKeyIndex=${t}`,i)})}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(ts.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(ts.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession.reemitEncryptionKeys()}}function p$e(n,e,t,r){const i=_.useMemo(()=>{if(r.kind!==Vt.NONE){if(r.kind===Vt.PER_PARTICIPANT)return{keyProvider:new f$e,worker:new oU};if(r.kind===Vt.SHARED_KEY&&r.secret)return{keyProvider:new vle,worker:new oU}}},[r]);_.useEffect(()=>{r.kind===Vt.NONE||!i||(r.kind===Vt.PER_PARTICIPANT?i.keyProvider.setRTCSession(n):r.kind===Vt.SHARED_KEY&&r.secret&&i.keyProvider.setKey(r.secret).catch(v=>{O.error("Failed to set shared key for E2EE",v)}))},[i,r,n]);const s=_.useRef(e),o=rh(),a=_.useRef(o),c=_.useMemo(()=>({...J2,videoCaptureDefaults:{...J2.videoCaptureDefaults,deviceId:a.current.videoInput.selectedId},audioCaptureDefaults:{...J2.audioCaptureDefaults,deviceId:a.current.audioInput.selectedId},audioOutput:{deviceId:a.current.audioOutput.selectedId},e2ee:i}),[i]),l=_.useRef(!1),u=_.useRef(!1),h=_.useRef({audio:s.current.audio.enabled,video:s.current.video.enabled}),p=_.useMemo(()=>{const v=new Mc(c);return v.setE2EEEnabled(r.kind!==Vt.NONE).catch(g=>{O.error("Failed to set E2EE enabled on room",g)}),v},[c,r]),m=h$e({deviceId:a.current.audioInput.selectedId},s.current.audio.enabled,p,t);return _.useEffect(()=>{if(p!==void 0&&m===Ct.Connected){const v=p.localParticipant;h.current={audio:e.audio.enabled,video:e.video.enabled};let g;(b=>{b[b.Microphone=0]="Microphone",b[b.Camera=1]="Camera"})(g||(g={}));const S=async(b,R)=>{var C,P,M,D;if(b>10){O.error("Stop trying to sync the input device with current mute state after 10 failed tries");return}let k,I,T;switch(R){case 0:k=v.isMicrophoneEnabled,I=h.current.audio,T=l.current;break;case 1:k=v.isCameraEnabled,I=h.current.video,T=u.current;break}if(k!==I&&!T)try{let F;switch(R){case 0:l.current=!0,F=await v.setMicrophoneEnabled(h.current.audio),l.current=!1;break;case 1:u.current=!0,F=await v.setCameraEnabled(h.current.video),u.current=!1;break}if(F)await new Promise(U=>setTimeout(U,100)),await S(b+1,R);else throw new Error("track with new mute state could not be published")}catch(F){F.name==="NotAllowedError"?(O.error("Fatal error while syncing mute state: resetting",F),R===0?(l.current=!1,(P=(C=e.audio).setEnabled)==null||P.call(C,!1)):(u.current=!1,(D=(M=e.video).setEnabled)==null||D.call(M,!1))):(O.error("Failed to sync audio mute state with LiveKit (will retry to sync in 1s):",F),setTimeout(()=>{S(b+1,R).catch(U=>{O.error(`Failed to sync ${g[R]} mute state with LiveKit iterCount=${b+1}`,U)})},1e3))}};S(0,0).catch(b=>{O.error("Failed to sync audio mute state with LiveKit",b)}),S(0,1).catch(b=>{O.error("Failed to sync video mute state with LiveKit",b)})}},[p,e,m]),_.useEffect(()=>{if(p!==void 0&&m===Ct.Connected){const v=(g,S)=>{var R,k,I,T;const b=S.selectedId;if(b==="default"&&g==="audioinput"&&((R=p.options.audioCaptureDefaults)==null?void 0:R.deviceId)==="default"){const C=(k=Array.from(p.localParticipant.audioTrackPublications.values()).find(P=>P.source===pe.Source.Microphone))==null?void 0:k.track;C&&C.mediaStreamTrack.readyState!=="ended"&&S.selectedGroupId!==C.mediaStreamTrack.getSettings().groupId&&((T=(I=p.localParticipant.getTrackPublication(pe.Source.Microphone))==null?void 0:I.audioTrack)==null||T.restartTrack().catch(P=>{O.error("Failed to restart audio device track",P)}))}else b!==void 0&&p.getActiveDevice(g)!==b&&p.switchActiveDevice(g,b).catch(C=>O.error(`Failed to sync ${g} device with LiveKit`,C))};v("audioinput",o.audioInput),v("audiooutput",o.audioOutput),v("videoinput",o.videoInput)}},[p,o,m]),{connState:m,livekitRoom:p}}function m$e(){_.useEffect(()=>{if("wakeLock"in navigator){let n=!0,e=null;const t=()=>{document.visibilityState==="visible"&&navigator.wakeLock.request("screen").then(r=>{e=r,n||e.release().catch(i=>O.warn("Can't release wake lock",i))},r=>{O.warn("Can't acquire wake lock",r)})};return t(),document.addEventListener("visibilitychange",t),()=>{n=!1,e!==null&&e.release().catch(r=>O.warn("Can't release wake lock",r)),document.removeEventListener("visibilitychange",t)}}},[])}const g$e="_toggle_z1rxf_8",v$e={toggle:g$e},y$e=({layout:n,setLayout:e,className:t,onTouchEnd:r})=>{const{t:i}=Xe(),s=_.useCallback(o=>e(o.target.value),[e]);return w.jsxs("div",{className:De(v$e.toggle,t),children:[w.jsx(di,{label:i("layout_spotlight_label"),children:w.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:n==="spotlight",onChange:s,onTouchEnd:r})}),w.jsx(nIe,{"aria-hidden":!0,width:24,height:24}),w.jsx(di,{label:i("layout_grid_label"),children:w.jsx("input",{type:"radio",name:"layout",value:"grid",checked:n==="grid",onChange:s,onTouchEnd:r})}),w.jsx(qTe,{"aria-hidden":!0,width:24,height:24})]})},of=new xr;window.controls={canEnterPip(){return of.observed},enablePip(){if(!of.observed)throw new Error("No call is running");of.next(!0)},disablePip(){if(!of.observed)throw new Error("No call is running");of.next(!1)}};let _$e=0;function b$e(){return(_$e++).toString()}class Iee extends RE{constructor(e){super(),this.media$=e,this.id=b$e()}}class S$e extends RE{constructor(e,t){super(),this.media$=e,this.maximised$=t}}function w$e(n,e){return{[Symbol.iterator](){const t=n[Symbol.iterator](),r=e[Symbol.iterator]();return{next(){let i;do{if(i=t.next(),!i.done&&i.value!==void 0)return i;const s=r.next();if(!s.done)return s}while(!i.done);return i}}}}}function s_(n){return n.map(e=>{var t;return((t=e.media.member)==null?void 0:t.rawDisplayName)??"[👻]"})}let mb=!1;QL.value$.subscribe(n=>mb=n);class E$e{get media(){return this.media$.value}set media(e){this.media$.next(e)}get maximised(){return this.maximised$.value}set maximised(e){this.maximised$.next(e)}constructor(e,t){this.media$=new is(e),this.maximised$=new is(t),this.vm=new S$e(this.media$,this.maximised$)}destroy(){this.vm.destroy()}}class aU{get media(){return this.media$.value}set media(e){this.media$.next(e)}constructor(e){this.media$=new is(e),this.vm=new Iee(this.media$)}destroy(){this.vm.destroy()}}class JS{constructor(e,t,r){var i;this.spotlight=e,this.grid=t,this.generation=r,this.spotlightTile=(i=this.spotlight)==null?void 0:i.vm,this.gridTiles=this.grid.map(({vm:s})=>s),this.gridTilesByMedia=new Map(this.grid.map(({vm:s,media:o})=>[o,s]))}static empty(){return new JS(null,[],0)}from(e){return new C$e(this.spotlight,this.grid,(t,r)=>new JS(t,r,this.generation+1),e,this.generation)}}class C$e{constructor(e,t,r,i,s){var o;this.prevSpotlight=e,this.prevGrid=t,this.construct=r,this.visibleTiles=i,this.generation=s,this.spotlight=null,this.prevSpotlightSpeaker=((o=this.prevSpotlight)==null?void 0:o.media.length)===1&&"speaking"in this.prevSpotlight.media[0]&&this.prevSpotlight.media[0],this.prevGridByMedia=new Map(this.prevGrid.map((a,c)=>[a.media,[a,c]])),this.numGridEntries=0,this.stationaryGridEntries=new Array(this.prevGrid.length),this.visibleGridEntries=[],this.invisibleGridEntries=[]}registerSpotlight(e,t){if(mb&&O.debug(`[TileStore, ${this.generation}] register spotlight: ${e.map(r=>{var i;return((i=r.member)==null?void 0:i.rawDisplayName)??"[👻]"})}`),this.spotlight!==null)throw new Error("Spotlight already set");if(this.numGridEntries>0)throw new Error("Spotlight must be registered before grid tiles");this.prevSpotlight===null?this.spotlight=new E$e(e,t):(this.spotlight=this.prevSpotlight,this.spotlight.media=e,this.spotlight.maximised=t)}registerGridTile(e){var r;if(mb&&O.debug(`[TileStore, ${this.generation}] register grid tile: ${((r=e.member)==null?void 0:r.rawDisplayName)??"[👻]"}`),this.spotlight!==null){if(!e.local&&this.spotlight.media.includes(e))return;if(e===this.prevSpotlightSpeaker&&this.spotlight.media.length===1&&"speaking"in this.spotlight.media[0]&&this.prevSpotlightSpeaker!==this.spotlight.media[0]){const i=this.prevGridByMedia.get(this.spotlight.media[0]);if(i!==void 0){const[s,o]=i,a=o<this.visibleTiles,c=this.numGridEntries<this.visibleTiles;a===c?(this.stationaryGridEntries[o]=s,s.media=e,this.prevGridByMedia.delete(this.spotlight.media[0]),this.prevGridByMedia.set(e,i)):(c?this.visibleGridEntries:this.invisibleGridEntries).push(new aU(e)),this.numGridEntries++;return}}}const t=this.prevGridByMedia.get(e);if(t===void 0)(this.numGridEntries<this.visibleTiles?this.visibleGridEntries:this.invisibleGridEntries).push(new aU(e));else{const[i,s]=t,o=s<this.visibleTiles,a=this.numGridEntries<this.visibleTiles;o===a?this.stationaryGridEntries[s]=i:(a?this.visibleGridEntries:this.invisibleGridEntries).push(i)}this.numGridEntries++}build(){const e=[...w$e(this.stationaryGridEntries,[...this.visibleGridEntries,...this.invisibleGridEntries])];mb&&(O.debug(`[TileStore, ${this.generation}] stationary: ${s_(this.stationaryGridEntries)}`),O.debug(`[TileStore, ${this.generation}] visible: ${s_(this.visibleGridEntries)}`),O.debug(`[TileStore, ${this.generation}] invisible: ${s_(this.invisibleGridEntries)}`),O.debug(`[TileStore, ${this.generation}] result: ${s_(e)}`)),this.spotlight===null&&this.prevSpotlight!==null&&this.prevSpotlight.destroy();const t=new Set(e);for(const r of this.prevGrid)t.has(r)||r.destroy();return this.construct(this.spotlight,e)}}function T$e(n,e,t,r){const i=r.from(e);n.spotlight!==void 0&&i.registerSpotlight(n.spotlight,n.type==="spotlight-portrait");for(const o of n.grid)i.registerGridTile(o);const s=i.build();return[{type:n.type,spotlight:s.spotlightTile,grid:s.gridTiles,setVisibleTiles:t},s]}function I$e(n,e){const t=e.from(1);t.registerSpotlight(n.spotlight,!0),n.pip!==void 0&&t.registerGridTile(n.pip);const r=t.build();return[{type:n.type,spotlight:r.spotlightTile,pip:r.gridTiles[0]},r]}function R$e(n,e){const t=e.from(2);t.registerGridTile(n.local),t.registerGridTile(n.remote);const r=t.build();return[{type:n.type,local:r.gridTilesByMedia.get(n.local),remote:r.gridTilesByMedia.get(n.remote)},r]}function k$e(n,e){const t=e.from(0);t.registerSpotlight(n.spotlight,!0);const r=t.build();return[{type:n.type,spotlight:r.spotlightTile},r]}function x$e(n){const e=n.pipe(ba());return e.pipe(FOe(t=>Bv(Fl(t?1e3:6e4),e.pipe(Vo(r=>r!==t)))),un(!1),ba())}function cU(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}const pg=new Map;function zx(n){if(pg.has(n))return pg.get(n);const e=$l(n);return pg.size>500&&pg.clear(),pg.set(n,e),e}function P$e(n,e,t){const{rawDisplayName:r,userId:i}=n;if(!r||r===i)return!1;const s=zx(r);return s?/@.+:.+/.test(r)||/[\u200E\u200F\u202A-\u202F]/.test(r)?!0:e.map(o=>o.sender&&t.getMember(o.sender)).filter(o=>!!o).filter(o=>o.userId!==i).some(o=>zx(Ree(o,!1))===s):!1}function Ree(n,e){const{rawDisplayName:t,userId:r}=n;if(!t||t===r)return r;const i=_b(t);return e?i+" ("+r+")":zx(t)?i:r}const L$e=3e3,A$e=3,Z2=4e3;class o_{constructor(e,t,r,i,s,o,a,c){this.id=e,this.scope=new UQ,this.participant$=new is(r),r!=null&&r.isLocal?this.vm=new dp(this.id,t,this.participant$.asObservable(),i,s,o,a,c):this.vm=new mUe(e,t,this.participant$.asObservable(),i,s,o,a,c),this.speaker$=x$e(this.vm.speaking$).pipe(this.scope.state()),this.presenter$=this.participant$.pipe(Ot(l=>(l&&c4(l,ue.TrackPublished,ue.TrackUnpublished,ue.LocalTrackPublished,ue.LocalTrackUnpublished).pipe(Fe(u=>u.isScreenShareEnabled)))??It(!1)),this.scope.state())}updateParticipant(e){this.participant$.value!==e&&this.participant$.next(e)}destroy(){this.scope.end(),this.vm.destroy()}}class lU{constructor(e,t,r,i,s,o){this.participant$=new is(r),this.vm=new vf(e,t,this.participant$.asObservable(),i,s,o,r.isLocal)}destroy(){this.vm.destroy()}}function uU(n,e){let t=n.sender+":"+n.deviceId;if(!n.sender)return{id:t,member:void 0};n.sender===e.client.getUserId()&&n.deviceId===e.client.getDeviceId()&&(t="local");const r=e.getMember(n.sender)??void 0;return{id:t,member:r}}class M$e extends RE{constructor(e,t,r,i,s,o){super(),this.matrixRTCSession=e,this.livekitRoom=t,this.encryptionSystem=r,this.connectionState$=i,this.handsRaisedSubject$=s,this.reactionsSubject$=o,this.localVideo$=qS(It(this.livekitRoom.localParticipant),pe.Source.Camera).pipe(Fe(a=>{var l;const c=(l=a==null?void 0:a.publication)==null?void 0:l.track;return c instanceof yv?c:null})),this.rawRemoteParticipants$=b8e(this.livekitRoom).pipe(this.scope.state()),this.remoteParticipantHolds$=this.connectionState$.pipe(ZOe(this.rawRemoteParticipants$),xy(([a,c])=>a===Wx.ECSwitchingFocus?NS(It({hold:c}),IOe([Fl(L$e),this.connectionState$.pipe(Vo(l=>l!==Wx.ECSwitchingFocus),wx(1))]).pipe(Fe(()=>({unhold:c})))):OS),Ux([],(a,c)=>"hold"in c?[c.hold,...a]:a.filter(l=>l!==c.unhold))),this.remoteParticipants$=Nn([this.rawRemoteParticipants$,this.remoteParticipantHolds$],(a,c)=>{const l=[...a],u=new Set(l.map(h=>h.identity));for(const h of c)for(const p of h)u.has(p.identity)||(l.push(p),u.add(p.identity));return l}),this.memberDisplaynames$=Bv(Ta(this.matrixRTCSession,ts.MembershipsChanged),Ta(this.matrixRTCSession.room,kt.Members)).pipe(un(null),Fe(()=>{const a=new Map,{room:c,memberships:l}=this.matrixRTCSession;for(const u of l){const h=`${u.sender}:${u.deviceId}`,{member:p}=uU(u,c);if(!p){O.error("Could not find member for media id:",h);continue}const m=P$e(p,l,c);a.set(h,Ree(p,m))}return a}),this.scope.state()),this.mediaItems$=Nn([this.remoteParticipants$,l4(this.livekitRoom.localParticipant),aZ.value$,Ta(this.matrixRTCSession,ts.MembershipsChanged).pipe(un(null)),cZ.value$]).pipe(ec((a,[c,{participant:l},u,h,p])=>{const m=new Map((function*(){const S=this.matrixRTCSession.room;for(const b of this.matrixRTCSession.memberships){const{member:R,id:k}=uU(b,S),I=`${b.sender}:${b.deviceId}`;let T;k==="local"?T=l:T=c.find(C=>C.identity===k),R||O.error("Could not find member for media id: ",k);for(let C=0;C<1+u;C++){const P=`${k}:${C}`;let M=a.get(P);if(M&&M instanceof o_&&(M.updateParticipant(T),M.vm.member===void 0&&(M=void 0)),yield[P,M??new o_(P,R,T,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Fe(D=>D.get(I)??"[👻]")),this.handsRaised$.pipe(Fe(D=>{var F;return((F=D[I])==null?void 0:F.time)??null})),this.reactions$.pipe(Fe(D=>D[I]??void 0)))],T!=null&&T.isScreenShareEnabled){const D=`${P}:screen-share`;yield[D,a.get(D)??new lU(D,R,T,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Fe(F=>F.get(I)??"[👻]")))]}}}}).bind(this)()),v=p?new Map((function*(){for(const S of c)for(let b=0;b<1+u;b++){const R=S.identity+":"+b;if(!m.has(R)){const k=R;yield[k,a.get(k)??new o_(k,void 0,S,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Fe(I=>I.get(S.identity)??"[👻]")),It(null),It(null))]}}}).bind(this)()):new Map;v.size>0&&O.debug("Added NonMember items: ",v);const g=new Map([...v.entries(),...m.entries()]);for(const[S,b]of a)g.has(S)||b.destroy();return g},new Map),Fe(a=>[...a.values()]),pUe(a=>{for(const c of a)c.destroy()}),this.scope.state()),this.userMedia$=this.mediaItems$.pipe(Fe(a=>a.filter(c=>c instanceof o_))),this.memberChanges$=this.userMedia$.pipe(Fe(a=>a.map(c=>c.id))).pipe(ec((a,c)=>{const l=a.ids.filter(h=>!c.includes(h)),u=c.filter(h=>!a.ids.includes(h));return{ids:c,joined:u,left:l}},{ids:[],joined:[],left:[]})),this.screenShares$=this.mediaItems$.pipe(Fe(a=>a.filter(c=>c instanceof lU)),this.scope.state()),this.spotlightSpeaker$=this.userMedia$.pipe(Ot(a=>a.length===0?It([]):Nn(a.map(c=>c.vm.speaking$.pipe(Fe(l=>[c,l]))))),ec((a,c)=>{var h,p,m;const[l,u]=!(a!=null&&a.vm.local)&&c.find(([v])=>v===a)||[];return u?l:((h=c.find(([v,g])=>!v.vm.local&&g))==null?void 0:h[0])??l??((p=c.find(([v])=>!v.vm.local))==null?void 0:p[0])??((m=c.find(([v])=>v.vm.local))==null?void 0:m[0])},null),Fe(a=>(a==null?void 0:a.vm)??null),this.scope.state()),this.grid$=this.userMedia$.pipe(Ot(a=>{const c=a.map(l=>Nn([l.speaker$,l.presenter$,l.vm.videoEnabled$,l.vm.handRaised$,l.vm instanceof dp?l.vm.alwaysShow$:It(!1)],(u,h,p,m,v)=>{let g;return l.vm.local?g=v?0:6:h?g=1:u?g=2:m?g=3:p?g=4:g=5,[l,g]}));return c.length===0?It([]):Nn(c,(...l)=>l.sort(([,u],[,h])=>u-h).map(([u])=>u.vm))}),ba(cU),this.scope.state()),this.spotlight$=this.screenShares$.pipe(Ot(a=>a.length>0?It(a.map(c=>c.vm)):this.spotlightSpeaker$.pipe(Fe(c=>c?[c]:[]))),ba(cU),this.scope.state()),this.pip$=Nn([this.screenShares$,this.spotlightSpeaker$,this.mediaItems$]).pipe(Ot(([a,c,l])=>{if(a.length>0)return this.spotlightSpeaker$;if(!c||c.local)return It(null);const u=l.find(p=>p.vm instanceof dp),h=u==null?void 0:u.vm;return h?h.alwaysShow$.pipe(Fe(p=>p?h:null)):It(null)}),this.scope.state()),this.hasRemoteScreenShares$=this.spotlight$.pipe(Fe(a=>a.some(c=>!c.local&&c instanceof vf)),ba()),this.pipEnabled$=of.pipe(un(!1)),this.naturalWindowMode$=Ta(window,"resize").pipe(un(null),Fe(()=>{const a=window.innerHeight,c=window.innerWidth;return a<=400&&c<=340?"pip":a<=600?"flat":c<=600?"narrow":"normal"}),this.scope.state()),this.windowMode$=this.pipEnabled$.pipe(Ot(a=>a?It("pip"):this.naturalWindowMode$)),this.spotlightExpandedToggle$=new xr,this.spotlightExpanded$=this.spotlightExpandedToggle$.pipe(Ux(!1,a=>!a),this.scope.state()),this.gridModeUserSelection$=new xr,this.gridMode$=this.gridModeUserSelection$.pipe(un(null),Ot(a=>(a==="spotlight"?OS:Nn([this.hasRemoteScreenShares$,this.windowMode$]).pipe(KOe(a===null?0:1),Fe(([c,l])=>c||l==="flat"?"spotlight":"grid"))).pipe(un(a??"grid"))),this.scope.state()),this.gridLayoutMedia$=Nn([this.grid$,this.spotlight$],(a,c)=>({type:"grid",spotlight:c.some(l=>l instanceof vf)?c:void 0,grid:a})),this.spotlightLandscapeLayoutMedia$=Nn([this.grid$,this.spotlight$],(a,c)=>({type:"spotlight-landscape",spotlight:c,grid:a})),this.spotlightPortraitLayoutMedia$=Nn([this.grid$,this.spotlight$],(a,c)=>({type:"spotlight-portrait",spotlight:c,grid:a})),this.spotlightExpandedLayoutMedia$=Nn([this.spotlight$,this.pip$],(a,c)=>({type:"spotlight-expanded",spotlight:a,pip:c??void 0})),this.oneOnOneLayoutMedia$=this.mediaItems$.pipe(Fe(a=>{var u,h;if(a.length!==2)return null;const c=(u=a.find(p=>p.vm.local))==null?void 0:u.vm,l=(h=a.find(p=>!p.vm.local))==null?void 0:h.vm;return!l||!c?null:{type:"one-on-one",local:c,remote:l}})),this.pipLayoutMedia$=this.spotlight$.pipe(Fe(a=>({type:"pip",spotlight:a}))),this.layoutMedia$=this.windowMode$.pipe(Ot(a=>{switch(a){case"normal":return this.gridMode$.pipe(Ot(c=>{switch(c){case"grid":return this.oneOnOneLayoutMedia$.pipe(Ot(l=>l===null?this.gridLayoutMedia$:It(l)));case"spotlight":return this.spotlightExpanded$.pipe(Ot(l=>l?this.spotlightExpandedLayoutMedia$:this.spotlightLandscapeLayoutMedia$))}}));case"narrow":return this.oneOnOneLayoutMedia$.pipe(Ot(c=>c===null?Nn([this.grid$,this.spotlight$],(l,u)=>l.length>A$e||u.some(h=>h instanceof vf)?this.spotlightPortraitLayoutMedia$:this.gridLayoutMedia$).pipe(WOe()):this.spotlightExpandedLayoutMedia$));case"flat":return this.gridMode$.pipe(Ot(c=>{switch(c){case"grid":return this.spotlightLandscapeLayoutMedia$;case"spotlight":return this.spotlightExpandedLayoutMedia$}}));case"pip":return this.pipLayoutMedia$}}),this.scope.state()),this.visibleTiles$=new xr,this.setVisibleTiles=a=>this.visibleTiles$.next(a),this.layoutInternals$=Nn([this.layoutMedia$,this.visibleTiles$.pipe(un(0),ba())]).pipe(ec(({tiles:a},[c,l])=>{let u,h;switch(c.type){case"grid":case"spotlight-landscape":case"spotlight-portrait":[u,h]=T$e(c,l,this.setVisibleTiles,a);break;case"spotlight-expanded":[u,h]=I$e(c,a);break;case"one-on-one":[u,h]=R$e(c,a);break;case"pip":[u,h]=k$e(c,a);break}return{layout:u,tiles:h}},{layout:null,tiles:JS.empty()}),this.scope.state()),this.layout$=this.layoutInternals$.pipe(Fe(({layout:a})=>a),this.scope.state()),this.tileStoreGeneration$=this.layoutInternals$.pipe(Fe(({tiles:a})=>a.generation),this.scope.state()),this.showSpotlightIndicators$=this.layout$.pipe(Fe(a=>a.type!=="grid"),this.scope.state()),this.showSpeakingIndicators$=this.layout$.pipe(Ot(a=>{switch(a.type){case"spotlight-landscape":case"spotlight-portrait":return a.spotlight.media$.pipe(Fe(c=>c.some(l=>l instanceof vf)));case"spotlight-expanded":case"one-on-one":return It(!1);default:return It(!0)}}),this.scope.state()),this.toggleSpotlightExpanded$=this.windowMode$.pipe(Ot(a=>a==="normal"?this.layout$.pipe(Fe(c=>c.type==="spotlight-landscape"||c.type==="spotlight-expanded")):It(!1)),ba(),Fe(a=>a?()=>this.spotlightExpandedToggle$.next():null),this.scope.state()),this.screenTap$=new xr,this.controlsTap$=new xr,this.screenHover$=new xr,this.screenUnhover$=new xr,this.showHeader$=this.windowMode$.pipe(Fe(a=>a!=="pip"&&a!=="flat"),this.scope.state()),this.showFooter$=this.windowMode$.pipe(Ot(a=>{switch(a){case"pip":return It(!1);case"normal":case"narrow":return It(!0);case"flat":return $Fe()?It(!0):Bv(this.screenTap$.pipe(Fe(()=>"tap screen")),this.controlsTap$.pipe(Fe(()=>"tap controls")),this.screenHover$.pipe(Fe(()=>"hover"))).pipe(zOe((c,l)=>{switch(l){case"tap screen":return c?It(!1):Fl(Z2).pipe(Fe(()=>!1),un(!0));case"tap controls":return Fl(Z2).pipe(Fe(()=>!1),un(!0));case"hover":return NOe(Fl(Z2),this.screenUnhover$.pipe(wx(1))).pipe(Fe(()=>!1),un(!0))}},!1),un(!1))}}),this.scope.state()),this.reactions$=this.reactionsSubject$.pipe(Fe(a=>Object.fromEntries(Object.entries(a).map(([c,{reactionOption:l}])=>[c,l])))),this.handsRaised$=this.handsRaisedSubject$.pipe(),this.visibleReactions$=uZ.value$.pipe(Ot(a=>a?this.reactions$:It({})),ec((a,c)=>{var u;const l=[];for(const[h,p]of Object.entries(c)){const m=((u=a.find(v=>v.sender===h&&v.emoji))==null?void 0:u.startX)??Math.ceil(Math.random()*80)+10;l.push({sender:h,emoji:p.emoji,startX:m})}return l},[])),this.audibleReactions$=e4.value$.pipe(Ot(a=>a?this.reactions$:It({})),Fe(a=>Object.values(a).map(c=>c.name)),ec((a,c)=>({playing:c.filter(l=>a.playing.includes(l)||a.newSounds.includes(l)),newSounds:c.filter(l=>!a.playing.includes(l)&&!a.newSounds.includes(l))}),{playing:[],newSounds:[]}),Fe(a=>a.newSounds)),this.newHandRaised$=this.handsRaised$.pipe(Fe(a=>Object.keys(a).length),ec((a,c)=>({value:c,playSounds:c>a.value}),{value:0,playSounds:!1}),Vo(a=>a.playSounds)),this.newScreenShare$=this.screenShares$.pipe(Fe(a=>a.length),ec((a,c)=>({value:c,playSounds:c>a.value}),{value:0,playSounds:!1}),Vo(a=>a.playSounds))}setGridMode(e){this.gridModeUserSelection$.next(e)}tapScreen(){this.screenTap$.next()}tapControls(){this.controlsTap$.next()}hoverScreen(){this.screenHover$.next()}unhoverScreen(){this.screenUnhover$.next()}}function O$e(n,e,t){return Math.max(e,Math.min(n,t))}const Or={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function dU(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function hU(n,e,t,r=.15){return r===0?O$e(n,e,t):n<e?-dU(e-n,t-e,r)+e:n>t?+dU(n-t,t-e,r)+t:n}function N$e(n,[e,t],[r,i]){const[[s,o],[a,c]]=n;return[hU(e,s,o,r),hU(t,a,c,i)]}function D$e(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function F$e(n){var e=D$e(n,"string");return typeof e=="symbol"?e:String(e)}function yi(n,e,t){return e=F$e(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function fU(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ln(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fU(Object(t),!0).forEach(function(r){yi(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fU(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const kee={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function pU(n){return n?n[0].toUpperCase()+n.slice(1):""}const U$e=["enter","leave"];function j$e(n=!1,e){return n&&!U$e.includes(e)}function $$e(n,e="",t=!1){const r=kee[n],i=r&&r[e]||e;return"on"+pU(n)+pU(i)+(j$e(t,i)?"Capture":"")}const B$e=["gotpointercapture","lostpointercapture"];function H$e(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=B$e.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function V$e(n,e=""){const t=kee[n],r=t&&t[e]||e;return n+r}function DE(n){return"touches"in n}function xee(n){return DE(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function G$e(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function q$e(n){return n.type==="touchend"||n.type==="touchcancel"?n.changedTouches:n.targetTouches}function Pee(n){return DE(n)?q$e(n)[0]:n}function K$e(n){return G$e(n).map(e=>e.identifier)}function Q2(n){const e=Pee(n);return DE(n)?e.identifier:e.pointerId}function mU(n){const e=Pee(n);return[e.clientX,e.clientY]}function W$e(n){var e,t;const{scrollX:r,scrollY:i,scrollLeft:s,scrollTop:o}=n.currentTarget;return[(e=r??s)!==null&&e!==void 0?e:0,(t=i??o)!==null&&t!==void 0?t:0]}function z$e(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s})}return e}function ZS(n,...e){return typeof n=="function"?n(...e):n}function Y$e(){}function X$e(...n){return n.length===0?Y$e:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function gU(n,e){return Object.assign({},e,n||{})}const J$e=32;class Z$e{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?ZS(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,z$e(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const C=t._delta.map(Math.abs);Or.addTo(t._distance,C)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[c,l]=r.threshold,{_step:u,values:h}=t;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=c&&h[0]),u[1]===!1&&(u[1]=Math.abs(a)>=l&&h[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=c&&Math.sign(o)*c),u[1]===!1&&(u[1]=Math.abs(a)>=l&&Math.sign(a)*l)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const p=[0,0];if(r.hasCustomTransform){const[C,P]=h;p[0]=u[0]!==!1?C-u[0]:0,p[1]=u[1]!==!1?P-u[1]:0}else p[0]=u[0]!==!1?o-u[0]:0,p[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(p);const m=t.offset,v=t._active&&!t._blocked||t.active;v&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=ZS(r.bounds,t)),this.setup&&this.setup()),t.movement=p,this.computeOffset()));const[g,S]=t.offset,[[b,R],[k,I]]=t._bounds;t.overflow=[g<b?-1:g>R?1:0,S<k?-1:S>I?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const T=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=N$e(t._bounds,t.offset,T),t.delta=Or.sub(t.offset,m),this.computeMovement(),v&&(!t.last||s>J$e)){t.delta=Or.sub(t.offset,m);const C=t.delta.map(Math.abs);Or.addTo(t.distance,C),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[C[0]/s,C[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(Ln(Ln(Ln({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function Q$e([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class Lee extends Z$e{constructor(...e){super(...e),yi(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Or.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Or.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[xee(e)]:r.axisThreshold;t.axis=Q$e(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const eBe=n=>n,vU=.15,Aee={enabled(n=!0){return n},eventOptions(n,e,t){return Ln(Ln({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[vU,vU];case!1:return[0,0];default:return Or.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return Or.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||eBe},threshold(n){return Or.toVector(n,0)}},tBe=0,Hp=Ln(Ln({},Aee),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=tBe){return n},bounds(n={}){if(typeof n=="function")return s=>Hp.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),yU={ArrowRight:(n,e=1)=>[n*e,0],ArrowLeft:(n,e=1)=>[-1*n*e,0],ArrowUp:(n,e=1)=>[0,-1*n*e],ArrowDown:(n,e=1)=>[0,n*e]};class nBe extends Lee{constructor(...e){super(...e),yi(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=Hp.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,r=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&r._pointerActive)&&(this.start(e),this.setupPointer(e),r._pointerId=Q2(e),r._pointerActive=!0,this.computeValues(mU(e)),this.computeInitial(),t.preventScrollAxis&&xee(e)!=="mouse"?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,r=this.config;if(!t._pointerActive)return;const i=Q2(e);if(t._pointerId!==void 0&&i!==t._pointerId)return;const s=mU(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=Or.sub(s,t._values),this.computeValues(s)),Or.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;const i=Q2(e);if(t._pointerId!==void 0&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=t._distance;if(t.tap=s<=r.tapsThreshold&&o<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{const[a,c]=t._delta,[l,u]=t._movement,[h,p]=r.swipe.velocity,[m,v]=r.swipe.distance,g=r.swipe.duration;if(t.elapsedTime<g){const S=Math.abs(a/t.timeDelta),b=Math.abs(c/t.timeDelta);S>h&&Math.abs(l)>m&&(t.swipe[0]=Math.sign(a)),b>p&&Math.abs(u)>v&&(t.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,rBe(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=yU[e.key];if(t){const r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,i),r._keyboardActive=!0,Or.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in yU&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function rBe(n){"persist"in n&&typeof n.persist=="function"&&n.persist()}const Hy=typeof window<"u"&&window.document&&window.document.createElement;function Mee(){return Hy&&"ontouchstart"in window}function iBe(){return Mee()||Hy&&window.navigator.maxTouchPoints>1}function sBe(){return Hy&&"onpointerdown"in window}function oBe(){return Hy&&"exitPointerLock"in window.document}function aBe(){try{return"constructor"in GestureEvent}catch{return!1}}const Gs={isBrowser:Hy,gesture:aBe(),touch:Mee(),touchscreen:iBe(),pointer:sBe(),pointerLock:oBe()},cBe=250,lBe=180,uBe=.5,dBe=50,hBe=250,fBe=10,_U={mouse:0,touch:0,pen:8},pBe=Ln(Ln({},Hp),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Gs.pointerLock,Gs.touch&&t?"touch":this.pointerLock?"mouse":Gs.pointer&&!i?"pointer":Gs.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?cBe:void 0,!(!Gs.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const s=Or.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,s},swipe({velocity:n=uBe,distance:e=dBe,duration:t=hBe}={}){return{velocity:this.transform(Or.toVector(n)),distance:this.transform(Or.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return lBe;case!1:return 0;default:return n}},axisThreshold(n){return n?Ln(Ln({},_U),n):_U},keyboardDisplacement(n=fBe){return n}});Ln(Ln({},Aee),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!Gs.touch&&Gs.gesture)return"gesture";if(Gs.touch&&r)return"touch";if(Gs.touchscreen){if(Gs.pointer)return"pointer";if(Gs.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=o=>{const a=gU(ZS(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=gU(ZS(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",Or.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Ln(Ln({},Hp),{},{mouseOnly:(n=!0)=>n});class mBe extends Lee{constructor(...e){super(...e),yi(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,r=W$e(e);t._delta=Or.sub(r,t._values),Or.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const gBe=Hp;Ln(Ln({},Hp),{},{mouseOnly:(n=!0)=>n});const Oee=new Map,Yx=new Map;function Nee(n){Oee.set(n.key,n.engine),Yx.set(n.key,n.resolver)}const vBe={key:"drag",engine:nBe,resolver:pBe},yBe={key:"scroll",engine:mBe,resolver:gBe};function _Be(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function bBe(n,e){if(n==null)return{};var t=_Be(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const SBe={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Gs.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},wBe=["target","eventOptions","window","enabled","transform"];function gb(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=gb(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function EBe(n,e,t={}){const r=n,{target:i,eventOptions:s,window:o,enabled:a,transform:c}=r,l=bBe(r,wBe);if(t.shared=gb({target:i,eventOptions:s,window:o,enabled:a,transform:c},SBe),e){const u=Yx.get(e);t[e]=gb(Ln({shared:t.shared},l),u)}else for(const u in l){const h=Yx.get(u);h&&(t[u]=gb(Ln({shared:t.shared},l[u]),h))}return t}class Dee{constructor(e,t){yi(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,s){const o=this._listeners,a=V$e(t,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=Ln(Ln({},c),s);e.addEventListener(a,i,l);const u=()=>{e.removeEventListener(a,i,l),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class CBe{constructor(){yi(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class TBe{constructor(e){yi(this,"gestures",new Set),yi(this,"_targetEventStore",new Dee(this)),yi(this,"gestureEventStores",{}),yi(this,"gestureTimeoutStores",{}),yi(this,"handlers",{}),yi(this,"config",{}),yi(this,"pointerIds",new Set),yi(this,"touchIds",new Set),yi(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),IBe(this,e)}setEventIds(e){if(DE(e))return this.touchIds=new Set(K$e(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=EBe(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],c=bU(r,a.eventOptions,!!i);if(a.enabled){const l=Oee.get(o);new l(this,e,o).bind(c)}}const s=bU(r,t.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](Ln(Ln({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=X$e(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:c}=H$e(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:c})}}}}function Yh(n,e){n.gestures.add(e),n.gestureEventStores[e]=new Dee(n,e),n.gestureTimeoutStores[e]=new CBe}function IBe(n,e){e.drag&&Yh(n,"drag"),e.wheel&&Yh(n,"wheel"),e.scroll&&Yh(n,"scroll"),e.move&&Yh(n,"move"),e.pinch&&Yh(n,"pinch"),e.hover&&Yh(n,"hover")}const bU=(n,e,t)=>(r,i,s,o={},a=!1)=>{var c,l;const u=(c=o.capture)!==null&&c!==void 0?c:e.capture,h=(l=o.passive)!==null&&l!==void 0?l:e.passive;let p=a?r:$$e(r,i,u);t&&h&&(p+="Passive"),n[p]=n[p]||[],n[p].push(s)};function Fee(n,e={},t,r){const i=Re.useMemo(()=>new TBe(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),Re.useEffect(i.effect.bind(i)),Re.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function RBe(n,e){return Nee(vBe),Fee({drag:n},e||{},"drag")}function kBe(n,e){return Nee(yBe),Fee({scroll:n},e||{},"scroll")}const xBe="_grid_19qx5_8",PBe="_slot_19qx5_12",eR={grid:xBe,slot:PBe},LBe="_tile_lwkx2_8",ABe="_draggable_lwkx2_8",SU={tile:LBe,draggable:ABe},Uee=_.memo(({id:n,onDrag:e,targetWidth:t,targetHeight:r,model:i,Tile:s,opacity:o,scale:a,zIndex:c,x:l,y:u,width:h,height:p})=>{const m=_.useRef(null);return RBe(v=>e==null?void 0:e.current(n,v),{target:m,filterTaps:!0,preventScroll:!0}),w.jsx(s,{ref:m,className:De(SU.tile,{[SU.draggable]:e}),style:{opacity:o,scale:a,zIndex:c,x:l,y:u,width:h,height:p},targetWidth:t,targetHeight:r,model:i})});Uee.displayName="TileWrapper";const MBe=Uee,OBe=()=>rE("(prefers-reduced-motion)");function jee(n,e){if(!(n.offsetParent instanceof HTMLElement)||n.offsetParent===e)return{x:n.offsetLeft,y:n.offsetTop};{const t=jee(n.offsetParent,e);return t.x+=n.offsetLeft,t.y+=n.offsetTop,t}}const $ee=_.createContext(null);function Bee(){const n=_.useContext($ee);if(n===null)throw new Error("useUpdateLayout called outside a Grid layout context");return n}function Oa(){const{setGeneration:n}=Bee();_.useEffect(()=>n(e=>e===null?0:e+1))}function D4(n){const{setVisibleTilesCallback:e}=Bee();_.useEffect(()=>e(()=>n),[n,e]),_.useEffect(()=>()=>e(null),[e])}const NBe=Ta(window,"resize").pipe(un(null),Fe(()=>window.innerHeight));function wU({model:n,Layout:e,Tile:t,className:r,style:i}){const[s,o]=Xg(),[a,c]=_.useState(null),l=By(s,c),u=st(NBe),[h,p]=_.useState(null),[m,v]=_.useState(null),[g,S]=_.useState(null),b=up(()=>new Map),R=OBe(),k=_.useMemo(()=>function({id:J,model:Y,onDrag:G,style:K,className:ee,...q}){const Q=_.useRef(null);return _.useEffect(()=>(b.set(J,{id:J,model:Y,onDrag:G}),()=>void b.delete(J)),[J,Y,G]),w.jsx("div",{ref:Q,className:De(ee,eR.slot),"data-id":J,style:K,...q})},[b]),I=_.useMemo(()=>_.memo(_.forwardRef(function({Layout:J,...Y},G){return w.jsx(J,{...Y,ref:G})})),[]),T=_.useMemo(()=>({setGeneration:v,setVisibleTilesCallback:S}),[S]),C=_.useMemo(()=>{const H=[];if(a!==null&&h!==null){const J=h.getElementsByClassName(eR.slot);for(const Y of J){const G=Y.getAttribute("data-id");Y.offsetWidth>0&&Y.offsetHeight>0&&H.push({...b.get(G),...jee(Y,a),width:Y.offsetWidth,height:Y.offsetHeight})}}return H},[a,h,b,o,m]),P=_.useMemo(()=>Math.min(o.bottom,u)-o.top,[o,u]);_.useEffect(()=>{g==null||g(C.filter(H=>H.y+H.height<=P).length)},[C,g,P]);const M=_.useRef(null),[D,F]=Cje(C,()=>({key:({id:H})=>H,from:({x:H,y:J,width:Y,height:G})=>({opacity:0,scale:0,zIndex:1,x:H,y:J,width:Y,height:G,immediate:R}),enter:{opacity:1,scale:1,immediate:R},update:({id:H,x:J,y:Y,width:G,height:K})=>{var ee;return H===((ee=M.current)==null?void 0:ee.tileId)?null:{x:J,y:Y,width:G,height:K,immediate:R}},leave:{opacity:0,scale:0,immediate:R},config:{mass:.7,tension:252,friction:25}}));_.useEffect(()=>{F.start().forEach(H=>void H.catch(O.error))},[C,F]);const U=(H,J)=>{var q;const{tileId:Y,tileX:G,tileY:K}=M.current,ee=C.find(Q=>Q.id===Y);(q=F.current.find(Q=>Q.item.id===Y))==null||q.start(H?{scale:1,zIndex:1,x:ee.x,y:ee.y,width:ee.width,height:ee.height,immediate:R||(Q=>Q==="zIndex"),delay:Q=>Q==="zIndex"?500:0}:{scale:1.1,zIndex:2,x:G,y:K,immediate:R||(Q=>Q==="zIndex"||Q==="x"||Q==="y")}).catch(O.error),H&&J({x:G,y:K,xRatio:G/(o.width-ee.width),yRatio:K/(o.height-ee.height)})},B=(H,{tap:J,initial:[Y,G],delta:[K,ee],last:q})=>{if(!J){const Q=F.current.find(Ie=>Ie.item.id===H),Se=b.get(Q.item.id).onDrag;if(Se!=null){if(M.current===null){const Ie=Q.get();M.current={tileId:H,tileX:Ie.x,tileY:Ie.y,cursorX:Y-o.x,cursorY:G-o.y+z.current}}M.current.tileX+=K,M.current.tileY+=ee,M.current.cursorX+=K,M.current.cursorY+=ee,U(q,Se),q&&(M.current=null)}}},V=_.useRef(B);V.current=B;const z=_.useRef(0);return kBe(({xy:[,H],delta:[,J]})=>{z.current=H,M.current!==null&&(M.current.tileY+=J,M.current.cursorY+=J,U(!1,b.get(M.current.tileId).onDrag))},{target:a??void 0}),w.jsxs("div",{ref:l,className:De(r,eR.grid),style:i,children:[w.jsx($ee.Provider,{value:T,children:w.jsx(I,{ref:p,Layout:e,model:n,Slot:k})}),D((H,{id:J,model:Y,onDrag:G,width:K,height:ee})=>w.jsx(MBe,{id:J,onDrag:G?V:null,targetWidth:K,targetHeight:ee,model:Y,Tile:t,...H},J))]})}const DBe="_contents_18jbt_8",FBe="_tile_18jbt_25",UBe="_maximised_18jbt_25",jBe="_item_18jbt_29",$Be="_snap_18jbt_36",BBe="_advance_18jbt_40",HBe="_back_18jbt_76",VBe="_next_18jbt_80",GBe="_expand_18jbt_84",qBe="_indicators_18jbt_128",KBe="_show_18jbt_140",gs={contents:DBe,tile:FBe,maximised:UBe,item:jBe,snap:$Be,advance:BBe,back:HBe,next:VBe,expand:GBe,indicators:qBe,show:KBe},Hee=(n,e)=>{const t=_.useRef(void 0);t.current===void 0&&(t.current=n());const r=_.useRef(void 0),[,i]=_.useState(0);return(r.current===void 0||e.length!==r.current.length||e.some((s,o)=>!Object.is(s,r.current[o])))&&(t.current=n(t.current)),r.current=e,[t.current,_.useCallback(s=>{typeof s=="function"?t.current=s(t.current):t.current=s,i(o=>o+1)},[i])]},Vee=_.forwardRef(({vm:n,...e},t)=>{const r=st(n.mirror$);return w.jsx($y,{ref:t,mirror:r,...e})});Vee.displayName="SpotlightLocalUserMediaItem";const Gee=_.forwardRef(({vm:n,...e},t)=>{const r=st(n.videoEnabled$),i=st(n.cropVideo$),s={ref:t,videoEnabled:r,videoFit:i?"cover":"contain",...e};return n instanceof dp?w.jsx(Vee,{vm:n,...s}):w.jsx($y,{mirror:!1,...s})});Gee.displayName="SpotlightUserMediaItem";const qee=_.forwardRef(({vm:n,targetWidth:e,targetHeight:t,intersectionObserver$:r,snap:i,"aria-hidden":s},o)=>{const a=_.useRef(null),c=By(a,o),l=st(n.displayname$),u=st(n.video$),h=st(n.unencryptedWarning$),p=st(n.encryptionStatus$);_.useEffect(()=>{const v=a.current;let g=null;const S=r.subscribe(b=>{g==null||g.unobserve(v),b.observe(v),g=b});return()=>{S.unsubscribe(),g==null||g.unobserve(v)}},[r]);const m={ref:c,"data-id":n.id,className:De(gs.item,{[gs.snap]:i}),targetWidth:e,targetHeight:t,video:u,member:n.member,unencryptedWarning:h,displayName:l,encryptionStatus:p,"aria-hidden":s,localParticipant:n.local};return n instanceof vf?w.jsx($y,{videoEnabled:!0,videoFit:"contain",mirror:!1,...m}):w.jsx(Gee,{vm:n,...m})});qee.displayName="SpotlightItem";const Xx=_.forwardRef(({vm:n,expanded:e,onToggleExpanded:t,targetWidth:r,targetHeight:i,showIndicators:s,className:o,style:a},c)=>{var B;const{t:l}=Xe(),[u,h]=o5e(null),p=By(u,c),m=st(n.maximised$),v=st(n.media$),[g,S]=_.useState((B=v[0])==null?void 0:B.id),b=Pc(v),R=Pc(g),k=v.findIndex(V=>V.id===g),I=k>0,T=k!==-1&&k<v.length-1,C=up(()=>h.pipe(Fe(V=>new IntersectionObserver(z=>{const H=z.find(J=>J.isIntersecting);H!==void 0&&S(H.target.getAttribute("data-id"))},{root:V,threshold:.5})))),[P,M]=Hee(V=>V==null||V===g||v.every(z=>z.id!==V)?null:V,[g]),D=_.useCallback(()=>{const V=b.current,z=V.findIndex(H=>H.id===R.current);z>0&&M(V[z-1].id)},[R,b,M]),F=_.useCallback(()=>{const V=b.current,z=V.findIndex(H=>H.id===R.current);z!==-1&&z!==V.length-1&&M(V[z+1].id)},[R,b,M]),U=e?VTe:vY;return w.jsxs(bee.div,{ref:p,className:De(o,gs.tile,{[gs.maximised]:m}),style:a,children:[I&&w.jsx("button",{className:De(gs.advance,gs.back),"aria-label":l("common.back"),onClick:D,children:w.jsx(pTe,{"aria-hidden":!0,width:24,height:24})}),w.jsx("div",{className:gs.contents,children:v.map(V=>w.jsx(qee,{vm:V,targetWidth:r,targetHeight:i,intersectionObserver$:C,snap:P===null||P===V.id,"aria-hidden":(P??g)!==V.id},V.id))}),t&&w.jsx("button",{className:De(gs.expand),"aria-label":l(e?"video_tile.collapse":"video_tile.expand"),onClick:t,children:w.jsx(U,{"aria-hidden":!0,width:20,height:20})}),T&&w.jsx("button",{className:De(gs.advance,gs.next),"aria-label":l("common.next"),onClick:F,children:w.jsx(Dz,{"aria-hidden":!0,width:24,height:24})}),!e&&w.jsx("div",{className:De(gs.indicators,{[gs.show]:s&&v.length>1}),children:v.map(V=>w.jsx("div",{className:gs.item,"data-visible":V.id===g},V.id))})]})});Xx.displayName="SpotlightTile";const WBe="_fixed_r39jt_8",zBe="_scrolling_r39jt_9",YBe="_slot_r39jt_21",a_={fixed:WBe,scrolling:zBe,slot:YBe},XBe={inline:"end",block:"end"},JBe={inline:"end",block:"start"},EU=17/9,tR=4/3;function F4(n,e,t){const r=n<800?16:20,i=n*e,s=Math.pow(Math.sqrt(i)/8+125,2),o=Math.min(t,i/s);let a=Math.min(o,Math.round(Math.sqrt(n/e/tR*o))),c=o/a;o===t&&(c=Math.ceil(c),a=Math.ceil(t/c));let l=(n-(a+1)*r)/a,u=(e-(c-1)*r)/c;const h=l/u;return h>EU?l=u*EU:h<tR&&(u=l/tR),{tileWidth:l,tileHeight:u,gap:r,columns:a}}const ZBe=({minBounds$:n,spotlightAlignment$:e})=>({scrollingOnTop:!1,fixed:_.forwardRef(function({model:r,Slot:i},s){Oa();const o=st(up(()=>e.pipe(ba((c,l)=>c.block===l.block&&c.inline===l.inline)))),a=_.useCallback(({xRatio:c,yRatio:l})=>e.next({block:l<.5?"start":"end",inline:c<.5?"start":"end"}),[]);return w.jsx("div",{ref:s,className:a_.fixed,children:r.spotlight&&w.jsx(i,{className:a_.slot,id:"spotlight",model:r.spotlight,onDrag:a,"data-block-alignment":o.block,"data-inline-alignment":o.inline})})}),scrolling:_.forwardRef(function({model:r,Slot:i},s){Oa(),D4(r.setVisibleTiles);const{width:o,height:a}=st(n),{gap:c,tileWidth:l,tileHeight:u}=_.useMemo(()=>F4(o,a,r.grid.length),[o,a,r.grid.length]);return w.jsx("div",{ref:s,className:a_.scrolling,style:{width:o,"--gap":`${c}px`,"--width":`${Math.floor(l)}px`,"--height":`${Math.floor(u)}px`},children:r.grid.map(h=>w.jsx(i,{className:a_.slot,id:h.id,model:h},h.id))})})}),QBe="_layer_mc5gk_8",eHe="_container_mc5gk_14",tHe="_local_mc5gk_18",nHe="_slot_mc5gk_31",c_={layer:QBe,container:eHe,local:tHe,slot:nHe},rHe=({minBounds$:n,pipAlignment$:e})=>({scrollingOnTop:!1,fixed:_.forwardRef(function(r,i){return Oa(),w.jsx("div",{ref:i})}),scrolling:_.forwardRef(function({model:r,Slot:i},s){Oa();const{width:o,height:a}=st(n),c=st(e),{tileWidth:l,tileHeight:u}=_.useMemo(()=>F4(o,a,1),[o,a]),h=_.useCallback(({xRatio:p,yRatio:m})=>e.next({block:m<.5?"start":"end",inline:p<.5?"start":"end"}),[]);return w.jsx("div",{ref:s,className:c_.layer,children:w.jsx(i,{id:r.remote.id,model:r.remote,className:c_.container,style:{width:l,height:u},children:w.jsx(i,{className:De(c_.slot,c_.local),id:r.local.id,model:r.local,onDrag:h,"data-block-alignment":c.block,"data-inline-alignment":c.inline})})})})}),iHe="_layer_1swii_8",sHe="_spotlight_1swii_12",oHe="_pip_1swii_17",l_={layer:iHe,spotlight:sHe,pip:oHe},aHe=({pipAlignment$:n})=>({scrollingOnTop:!0,fixed:_.forwardRef(function({model:t,Slot:r},i){return Oa(),w.jsx("div",{ref:i,className:l_.layer,children:w.jsx(r,{className:l_.spotlight,id:"spotlight",model:t.spotlight})})}),scrolling:_.forwardRef(function({model:t,Slot:r},i){Oa();const s=st(n),o=_.useCallback(({xRatio:a,yRatio:c})=>n.next({block:c<.5?"start":"end",inline:a<.5?"start":"end"}),[]);return w.jsx("div",{ref:i,className:l_.layer,children:t.pip&&w.jsx(r,{className:l_.pip,id:t.pip.id,model:t.pip,onDrag:o,"data-block-alignment":s.block,"data-inline-alignment":s.inline})})})}),cHe="_layer_jsvx2_8",lHe="_spotlight_jsvx2_19",uHe="_slot_jsvx2_28",dHe="_grid_jsvx2_34",Za={layer:cHe,spotlight:lHe,slot:uHe,grid:dHe},hHe=({minBounds$:n})=>({scrollingOnTop:!1,fixed:_.forwardRef(function({model:t,Slot:r},i){return Oa(),st(n),w.jsxs("div",{ref:i,className:Za.layer,children:[w.jsx("div",{className:Za.spotlight,children:w.jsx(r,{className:Za.slot,id:"spotlight",model:t.spotlight})}),w.jsx("div",{className:Za.grid})]})}),scrolling:_.forwardRef(function({model:t,Slot:r},i){Oa(),D4(t.setVisibleTiles),st(n);const s=st(t.spotlight.media$).length>1;return w.jsxs("div",{ref:i,className:Za.layer,children:[w.jsx("div",{className:De(Za.spotlight,{[Za.withIndicators]:s})}),w.jsx("div",{className:Za.grid,children:t.grid.map(o=>w.jsx(r,{className:Za.slot,id:o.id,model:o},o.id))})]})})}),fHe="_layer_1q32d_8",pHe="_spotlight_1q32d_17",mHe="_withIndicators_1q32d_26",gHe="_slot_1q32d_30",vHe="_grid_1q32d_35",yl={layer:fHe,spotlight:pHe,withIndicators:mHe,slot:gHe,grid:vHe},yHe=({minBounds$:n})=>({scrollingOnTop:!1,fixed:_.forwardRef(function({model:t,Slot:r},i){return Oa(),w.jsx("div",{ref:i,className:yl.layer,children:w.jsx("div",{className:yl.spotlight,children:w.jsx(r,{className:yl.slot,id:"spotlight",model:t.spotlight})})})}),scrolling:_.forwardRef(function({model:t,Slot:r},i){Oa(),D4(t.setVisibleTiles);const{width:s}=st(n),{gap:o,tileWidth:a,tileHeight:c}=F4(s,s,t.grid.length),l=st(t.spotlight.media$).length>1;return w.jsxs("div",{ref:i,className:yl.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(a)}px`,"--grid-tile-height":`${Math.floor(c)}px`},children:[w.jsx("div",{className:De(yl.spotlight,{[yl.withIndicators]:l})}),w.jsx("div",{className:yl.grid,children:t.grid.map(u=>w.jsx(r,{className:yl.slot,id:u.id,model:u},u.id))})]})})});async function _He(n,e,t){const r=n.createGain();r.gain.setValueAtTime(t,0);const i=n.createBufferSource();i.buffer=e,i.connect(r).connect(n.destination);const s=new Promise(o=>i.addEventListener("ended",()=>o()));return i.start(),s}function U4(n){const[e]=Mr(dZ),t=rh(),[r,i]=_.useState(),[s,o]=_.useState();return _.useEffect(()=>{const a=n.sounds;if(!a)return;const c=new AudioContext({latencyHint:n.latencyHint});return(async()=>{const l={};for(const[u,h]of Object.entries(await a)){const p=await c.decodeAudioData(h.slice(0));l[u]=p}o(l)})().catch(l=>{O.debug("Failed to setup audio context",l)}),i(c),()=>{c.close().catch(l=>{O.debug("Failed to close audio engine",l)}),i(void 0)}},[n.sounds,n.latencyHint]),_.useEffect(()=>{r&&"setSinkId"in r&&r.setSinkId(t.audioOutput.selectedId).catch(a=>{O.warn("Unable to change sink for audio context",a)})},[r,t]),!r||!s?null:{playSound:async a=>{if(!s[a]){O.debug(`Tried to play a sound that wasn't buffered (${a})`);return}return _He(r,s[a],e)}}}function bHe(){return document.createElement("audio").canPlayType("audio/ogg")==="maybe"?"ogg":"mp3"}const SHe=bHe();async function Kee(n){const e={};return await Promise.all(Object.entries(n).map(async([t,r])=>{const{mp3:i,ogg:s}=r,o=await fetch(SHe==="ogg"?s:i??s);if(RL(o)){O.warn(`Could not load sound ${t}, response was not okay`);return}e[t]=await o.arrayBuffer()})),e}const CU=Object.fromEntries([...jv.filter(n=>n.sound!==void 0).map(n=>[n.name,n.sound]),[_x.name,_x.sound]]);function wHe({vm:n}){const[e]=Mr(e4),[t,r]=_.useState(null),i=U4({sounds:t,latencyHint:"interactive"}),s=Pc(i);return _.useEffect(()=>{!e||t||r(Kee(CU))},[t,e]),_.useEffect(()=>{const o=n.audibleReactions$.subscribe(a=>{var c,l;for(const u of a)CU[u]?(c=s.current)==null||c.playSound(u):(l=s.current)==null||l.playSound("generic")});return()=>{o.unsubscribe()}},[n,s]),null}const EHe="_container_1ux8r_1",CHe="_reaction_1ux8r_12",TU={container:EHe,reaction:CHe};function THe({vm:n}){const e=Vv(n.visibleReactions$);return w.jsx("div",{className:TU.container,children:e==null?void 0:e.map(({sender:t,emoji:r,startX:i})=>w.jsx("span",{role:"presentation",style:{left:`${i}vw`},className:TU.reaction,children:r},t))})}const IHe=""+new URL("join_call-dEJCP2wD.mp3",import.meta.url).href,RHe=""+new URL("join_call-DlMV9nHk.ogg",import.meta.url).href,kHe=""+new URL("left_call-BbqmRgnC.mp3",import.meta.url).href,xHe=""+new URL("left_call-C7NMl6WI.ogg",import.meta.url).href,PHe=""+new URL("raise_hand-CUbxEnt9.ogg",import.meta.url).href,LHe=""+new URL("raise_hand-Bzqn65WB.mp3",import.meta.url).href,AHe=""+new URL("screen_share_started-IZDL-kAw.ogg",import.meta.url).href,MHe=""+new URL("screen_share_started-DH3qxml5.mp3",import.meta.url).href,IU=8,RU=500,Wee=Kee({join:{mp3:IHe,ogg:RHe},left:{mp3:kHe,ogg:xHe},raiseHand:{mp3:LHe,ogg:PHe},screenshareStarted:{mp3:MHe,ogg:AHe}});function OHe({vm:n}){const e=U4({sounds:Wee,latencyHint:"interactive"}),t=Pc(e);return _.useEffect(()=>{const r=n.memberChanges$.pipe(Vo(({joined:a,ids:c})=>c.length<=IU&&a.length>0),Ex(()=>Sx(RU))).subscribe(()=>{var a;(a=t.current)==null||a.playSound("join")}),i=n.memberChanges$.pipe(Vo(({ids:a,left:c})=>a.length<=IU&&c.length>0),Ex(()=>Sx(RU))).subscribe(()=>{var a;(a=t.current)==null||a.playSound("left")}),s=n.newHandRaised$.subscribe(()=>{var a;(a=t.current)==null||a.playSound("raiseHand")}),o=n.newScreenShare$.subscribe(()=>{var a;(a=t.current)==null||a.playSound("screenshareStarted")});return()=>{r.unsubscribe(),i.unsubscribe(),s.unsubscribe(),o.unsubscribe()}},[t,n]),w.jsx(w.Fragment,{})}const kU=3e3;class NHe{constructor(e){this.rtcSession=e,this.raisedHandsSubject$=new is({}),this.reactionsSubject$=new is({}),this.raisedHands$=this.raisedHandsSubject$.asObservable(),this.reactions$=this.reactionsSubject$.asObservable(),this.onMembershipsChanged=t=>{for(const r of Object.keys(this.raisedHandsSubject$.value).filter(i=>t.find(s=>s.sender==i)))this.removeRaisedHand(r);for(const r of this.rtcSession.memberships){if(!r.sender||!r.eventId)continue;const i=`${r.sender}:${r.deviceId}`;this.raisedHandsSubject$.value[i]&&this.raisedHandsSubject$.value[i].membershipEventId!==r.eventId&&this.removeRaisedHand(i);const s=this.getLastReactionEvent(r.eventId,r.sender);if(s){const o=s==null?void 0:s.getId();if(!o)continue;this.addRaisedHand(`${r.sender}:${r.deviceId}`,{membershipEventId:r.eventId,reactionEventId:o,time:new Date(s.localTimestamp)})}}},this.handleReactionEvent=t=>{var o,a,c;const r=this.rtcSession.room;if(t.getRoomId()!==r.roomId||t.isSending())return;const i=t.getSender(),s=t.getId();if(!(!i||!s)&&(r.client.decryptEventIfNeeded(t).catch(l=>O.warn(`Failed to decrypt ${t.getId()}`,l)),!(t.isBeingDecrypted()||t.isDecryptionFailure()))){if(t.getType()===qL){const l=t.getContent(),u=(o=l==null?void 0:l["m.relates_to"])==null?void 0:o.event_id,h=this.rtcSession.memberships.find(b=>b.eventId===u&&b.sender===i);if(!h){O.warn(`Reaction target was not a membership event for ${i}, ignoring`);return}const p=`${h.sender}:${h.deviceId}`;if(!l.emoji){O.warn(`Reaction had no emoji from ${s}`);return}const v=(a=new Intl.Segmenter(void 0,{granularity:"grapheme"}).segment(l.emoji)[Symbol.iterator]().next().value)==null?void 0:a.segment;if(!(v!=null&&v.trim())){O.warn(`Reaction had no emoji from ${s} after splitting`);return}const g={..._x,emoji:v,...jv.find(b=>b.name===l.name)},S=this.reactionsSubject$.value;if(S[p]){O.warn(`Got reaction from ${p} but one is still playing`);return}this.reactionsSubject$.next({...S,[p]:{reactionOption:g,expireAfter:new Date(Date.now()+kU)}})}else if(t.getType()===ie.Reaction){const l=t.getContent(),u=l["m.relates_to"].event_id,h=this.rtcSession.memberships.find(p=>p.eventId===u&&p.sender===i);if(!h){O.warn(`Reaction target was not a membership event for ${i}, ignoring`);return}(l==null?void 0:l["m.relates_to"].key)==="🖐️"&&this.addRaisedHand(`${h.sender}:${h.deviceId}`,{reactionEventId:s,membershipEventId:u,time:new Date(t.localTimestamp)})}else if(t.getType()===ie.RoomRedaction){const l=t.event.redacts,u=(c=Object.entries(this.raisedHandsSubject$.value).find(([h,p])=>p.reactionEventId===l))==null?void 0:c[0];if(!u)return;this.removeRaisedHand(u)}}},this.reactionsSub=this.reactionsSubject$.pipe(BOe(kU)).subscribe(t=>{const r=new Date,i=Object.fromEntries(Object.entries(t).filter(([s,o])=>o.expireAfter>r));Object.keys(t).length!==Object.keys(i).length&&this.reactionsSubject$.next(i)}),this.rtcSession.room.on(Je.Timeline,this.handleReactionEvent),this.rtcSession.room.on(Je.Redaction,this.handleReactionEvent),this.rtcSession.room.client.on(mn.Decrypted,this.handleReactionEvent),this.rtcSession.room.on(Je.LocalEchoUpdated,this.handleReactionEvent),e.on(ts.MembershipsChanged,this.onMembershipsChanged),this.onMembershipsChanged([])}getLastReactionEvent(e,t){const r=this.rtcSession.room.relations.getChildEventsForEvent(e,on.Annotation,ie.Reaction);return((r==null?void 0:r.getRelations())??[]).find(s=>{var o,a;return s.event.sender===t&&s.getType()===ie.Reaction&&((a=(o=s.getContent())==null?void 0:o["m.relates_to"])==null?void 0:a.key)==="🖐️"})}addRaisedHand(e,t){this.raisedHandsSubject$.next({...this.raisedHandsSubject$.value,[e]:t})}removeRaisedHand(e){this.raisedHandsSubject$.next(Object.fromEntries(Object.entries(this.raisedHandsSubject$.value).filter(([t])=>t!==e)))}destroy(){this.rtcSession.off(ts.MembershipsChanged,this.onMembershipsChanged),this.rtcSession.room.off(Je.Timeline,this.handleReactionEvent),this.rtcSession.room.off(Je.Redaction,this.handleReactionEvent),this.rtcSession.room.client.off(mn.Decrypted,this.handleReactionEvent),this.rtcSession.room.off(Je.LocalEchoUpdated,this.handleReactionEvent),this.reactionsSub.unsubscribe()}}const DHe="getDisplayMedia"in(navigator.mediaDevices??{}),FHe=400,UHe=n=>{const e=c$e(n.client,n.rtcSession),{livekitRoom:t,connState:r}=p$e(n.rtcSession,n.muteStates,e,n.e2eeSystem),i=Hv(a=>a.pipe(Fe(([c])=>c)),[r]),[s,o]=_.useState(null);return _.useEffect(()=>()=>{t==null||t.disconnect().catch(a=>{O.error("Failed to disconnect from livekit room",a)})},[]),_.useEffect(()=>{if(t!==void 0){const a=new NHe(n.rtcSession),c=new M$e(n.rtcSession,t,n.e2eeSystem,i,a.raisedHands$,a.reactions$);return o(c),()=>{c.destroy(),a.destroy()}}},[n.rtcSession,t,n.e2eeSystem,i]),t===void 0||s===null?null:w.jsx(PQ.Provider,{value:t,children:w.jsx(I5e,{vm:s,rtcSession:n.rtcSession,children:w.jsx(jHe,{...n,vm:s,livekitRoom:t,connState:r})})})},jHe=({client:n,vm:e,matrixInfo:t,rtcSession:r,livekitRoom:i,muteStates:s,participantCount:o,onLeave:a,hideHeader:c,connState:l,onShareClick:u})=>{const{supportsReactions:h,sendReaction:p,toggleRaisedHand:m}=r4();if(m$e(),l===Ct.Disconnected)throw new TZ;const v=_.useRef(null),[g,S]=Xg(),b=By(v,g),{hideScreensharing:R,showControls:k}=eh(),{isScreenShareEnabled:I,localParticipant:T}=LDe({room:i}),C=_.useCallback(()=>{var ht,$;return($=(ht=s.audio).setEnabled)==null?void 0:$.call(ht,L=>!L)},[s]),P=_.useCallback(()=>{var ht,$;return($=(ht=s.video).setEnabled)==null?void 0:$.call(ht,L=>!L)},[s]);cUe(v,C,P,ht=>{var $,L;return(L=($=s.audio).setEnabled)==null?void 0:L.call($,!ht)},ht=>void p(ht),()=>void m());const M=st(e.windowMode$),D=st(e.layout$),F=st(e.tileStoreGeneration$),[U]=Mr(QL),B=st(e.gridMode$),V=st(e.showHeader$),z=st(e.showFooter$),H=DQ(e.localVideo$),J=_.useRef(null),Y=_.useCallback(()=>J.current=Date.now(),[]),G=_.useCallback(()=>{const ht=J.current;ht!==null&&Date.now()-ht<=FHe&&e.tapScreen(),J.current=null},[e]),K=_.useCallback(()=>J.current=null,[]),ee=_.useCallback(ht=>{z?(ht.stopPropagation(),e.tapControls()):ht.preventDefault()},[e,z]),q=_.useCallback(ht=>{ht.pointerType==="mouse"&&e.hoverScreen()},[e]),Q=_.useCallback(()=>e.unhoverScreen(),[e]),[Se,Ie]=_.useState(!1),[Ne,Le]=_.useState(d4),xe=_.useCallback(()=>Ie(!0),[Ie]),Ee=_.useCallback(()=>Ie(!1),[Ie]),Ce=_.useMemo(()=>ct===null?()=>{Le("profile"),Ie(!0)}:null,[Le,Ie]),[Ve,vt]=Xg(),[Jt,Et]=Xg(),Be=_.useMemo(()=>({width:S.width,height:S.height-vt.height-(M==="flat"?0:Et.height)}),[S.width,S.height,vt.height,Et.height,M]),Zn=Hv(ht=>ht.pipe(Fe(([$])=>$)),[Be]),In=up(()=>new is(XBe)),Qn=up(()=>new is(JBe)),os=_.useCallback(ht=>e.setGridMode(ht),[e]);_.useEffect(()=>{ct==null||ct.api.transport.send(B==="grid"?Wr.TileLayout:Wr.SpotlightLayout,{}).catch(ht=>{O.error("Failed to send layout change to widget API",ht)})},[B]),_.useEffect(()=>{if(ct){const ht=L=>{os("grid"),ct.api.transport.reply(L.detail,{})},$=L=>{os("spotlight"),ct.api.transport.reply(L.detail,{})};return ct.lazyActions.on(Wr.TileLayout,ht),ct.lazyActions.on(Wr.SpotlightLayout,$),()=>{ct.lazyActions.off(Wr.TileLayout,ht),ct.lazyActions.off(Wr.SpotlightLayout,$)}}},[os]);const pi=_.useMemo(()=>_.forwardRef(function({className:$,style:L,targetWidth:N,targetHeight:W,model:ne},ce){const ge=st(e.spotlightExpanded$),dt=st(e.toggleSpotlightExpanded$),Zt=st(e.showSpeakingIndicators$),Ft=st(e.showSpotlightIndicators$);return ne instanceof Iee?w.jsx(Cee,{ref:ce,vm:ne,onOpenProfile:Ce,targetWidth:N,targetHeight:W,className:De($,xn.tile),style:L,showSpeakingIndicators:Zt}):w.jsx(Xx,{ref:ce,vm:ne,expanded:ge,onToggleExpanded:dt,targetWidth:N,targetHeight:W,showIndicators:Ft,className:De($,xn.tile),style:L})}),[e,Ce]),Dr=_.useMemo(()=>{const ht={minBounds$:Zn,spotlightAlignment$:In,pipAlignment$:Qn};return{grid:ZBe(ht),"spotlight-landscape":hHe(ht),"spotlight-portrait":yHe(ht),"spotlight-expanded":aHe(ht),"one-on-one":rHe(ht)}},[Zn,In,Qn]),Qr=()=>{if(D.type==="pip")return w.jsx(Xx,{className:De(xn.tile,xn.maximised),vm:D.spotlight,expanded:!0,onToggleExpanded:null,targetWidth:Be.height,targetHeight:Be.width,showIndicators:!1});const ht=Dr[D.type],$=w.jsx(wU,{className:xn.fixedGrid,style:{insetBlockStart:vt.bottom,height:Be.height},model:D,Layout:ht.fixed,Tile:pi},"fixed"),L=w.jsx(wU,{className:xn.scrollingGrid,model:D,Layout:ht.scrolling,Tile:pi},"scrolling");return D.type==="spotlight-expanded"?w.jsxs(w.Fragment,{children:[$,L]}):w.jsxs(w.Fragment,{children:[L,$]})},br=v5e(r.room.roomId),ki=_.useCallback(()=>{T.setScreenShareEnabled(!I,{audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"}).catch(O.error)},[T,I]),xi=[];xi.push(w.jsx(fZ,{muted:!s.audio.enabled,onClick:C,onTouchEnd:ee,disabled:s.audio.setEnabled===null,"data-testid":"incall_mute"},"audio"),w.jsx(pZ,{muted:!s.video.enabled,onClick:P,onTouchEnd:ee,disabled:s.video.setEnabled===null,"data-testid":"incall_videomute"},"video")),H!==null&&xi.push(w.jsx(mZ,{className:xn.switchCamera,onClick:H,onTouchEnd:ee},"switch_camera")),DHe&&!R&&xi.push(w.jsx(E5e,{className:xn.shareScreen,enabled:I,onClick:ki,onTouchEnd:ee,"data-testid":"incall_screenshare"},"share_screen")),h&&xi.push(w.jsx(rNe,{vm:e,className:xn.raiseHand,identifier:`${n.getUserId()}:${n.getDeviceId()}`,onTouchEnd:ee},"raise_hand")),D.type!=="pip"&&xi.push(w.jsx(vZ,{onClick:xe,onTouchEnd:ee},"settings")),xi.push(w.jsx(gZ,{onClick:function(){a()},onTouchEnd:ee,"data-testid":"incall_leave"},"end_call"));const ei=w.jsxs("div",{ref:Jt,className:De(xn.footer,{[xn.overlay]:M==="flat",[xn.hidden]:!z||!k&&c}),children:[!c&&w.jsxs("div",{className:xn.logo,children:[w.jsx(sUe,{width:24,height:24,"aria-hidden":!0}),w.jsx(aUe,{width:80,height:11,"aria-label":"Element Call"}),U?`Tiles generation: ${F}`:void 0]}),k&&w.jsx("div",{className:xn.buttons,children:xi}),k&&w.jsx(y$e,{className:xn.layout,layout:B,setLayout:os,onTouchEnd:ee})]});return w.jsxs("div",{className:xn.inRoom,ref:b,onTouchStart:Y,onTouchEnd:G,onTouchCancel:K,onPointerMove:q,onPointerOut:Q,children:[V&&(c?w.jsx("div",{className:De(xn.header,xn.filler),ref:Ve}):w.jsxs(Su,{className:xn.header,ref:Ve,children:[w.jsx(Jd,{children:w.jsx(JY,{id:t.roomId,name:t.roomName,avatarUrl:t.roomAvatar,encrypted:t.e2eeSystem.kind!==Vt.NONE,participantCount:o})}),w.jsx(Zd,{children:k&&u!==null&&w.jsx(NQ,{className:xn.invite,onClick:u})})]})),w.jsx(sFe,{}),Qr(),w.jsx(OHe,{vm:e}),w.jsx(wHe,{vm:e}),w.jsx(THe,{vm:e}),ei,D.type!=="pip"&&w.jsxs(w.Fragment,{children:[w.jsx(i$e,{...br}),w.jsx(h4,{client:n,roomId:r.room.roomId,open:Se,onDismiss:Ee,tab:Ne,onTabChange:Le,livekitRoom:i})]})]})},$He=8,BHe={enabled:!1,setEnabled:null};function xU(n,e){const[t,r]=Hee(i=>i??(n.available.size>0?e():void 0),[n]);return _.useMemo(()=>n.available.size===0?BHe:{enabled:t??!1,setEnabled:r},[n,t,r])}function HHe(n){const e=rh(),{skipLobby:t}=eh(),r=xU(e.audioInput,()=>gt.get().media_devices.enable_audio&&!t&&!n),i=xU(e.videoInput,()=>gt.get().media_devices.enable_video&&!t&&!n);_.useEffect(()=>{ct==null||ct.api.transport.send(Wr.DeviceMute,{audio_enabled:r.enabled,video_enabled:i.enabled}).catch(o=>O.warn("Could not send DeviceMute action to widget",o))},[r,i]);const s=_.useCallback(o=>{var c,l;const a={audio_enabled:r.enabled,video_enabled:i.enabled};o.detail.data.audio_enabled!=null&&typeof o.detail.data.audio_enabled=="boolean"&&((c=r.setEnabled)==null||c.call(r,o.detail.data.audio_enabled),a.audio_enabled=o.detail.data.audio_enabled),o.detail.data.video_enabled!=null&&typeof o.detail.data.video_enabled=="boolean"&&((l=i.setEnabled)==null||l.call(i,o.detail.data.video_enabled),a.video_enabled=o.detail.data.video_enabled),ct.api.transport.reply(o.detail,a)},[r,i]);return _.useEffect(()=>{if(ct)return ct.lazyActions.on(Wr.DeviceMute,s),()=>{ct==null||ct.lazyActions.off(Wr.DeviceMute,s)}},[s]),_.useMemo(()=>({audio:r,video:i}),[r,i])}const VHe="org.matrix.msc4143.rtc_foci";function GHe(){return{type:"livekit",focus_selection:"oldest_membership"}}async function qHe(n,e){var o,a;O.log("Start building foci_preferred list: ",n.room.roomId);const t=[],r=n.getFocusInUse();r&&ok(r)&&(O.log("Adding livekit focus from oldest member: ",r),t.push(r));const i=n.room.client.getDomain();if(i){const c=(o=await lv.getRawClientConfig(i))==null?void 0:o[VHe];Array.isArray(c)&&t.push(...c.filter(l=>!!l).filter(H$).map(l=>(O.log("Adding livekit focus from well known: ",l),{...l,livekit_alias:e})))}const s=(a=gt.get().livekit)==null?void 0:a.livekit_service_url;if(s){const c={type:"livekit",livekit_service_url:s,livekit_alias:e};O.log("Adding livekit focus from config: ",c),t.push(c)}if(t.length===0)throw new wNe(i??"");return Promise.resolve(t)}async function KHe(n,e,t=!0){$t.instance.eventCallEnded.cacheStartCall(new Date),$t.instance.eventCallStarted.track(n.room.roomId);const r=n.room.roomId,{features:i,matrix_rtc_session:s}=gt.get(),o=i==null?void 0:i.feature_use_device_session_member_events;if(n.joinRoomSession(await qHe(n,r),GHe(),{useNewMembershipManager:t,manageMediaKeys:e,...o!==void 0&&{useLegacyMemberEvents:!o},membershipServerSideExpiryTimeout:s==null?void 0:s.membership_server_side_expiry_timeout,membershipKeepAlivePeriod:s==null?void 0:s.membership_keep_alive_period,makeKeyDelay:s==null?void 0:s.key_rotation_on_leave_delay}),ct)try{await ct.api.transport.send(Wr.JoinCall,{})}catch(a){O.error("Failed to send join action",a)}}const WHe=async(n,e,t)=>{try{await n.api.setAlwaysOnScreen(!1)}catch(r){O.error("Failed to set call widget `alwaysOnScreen` to false",r)}await t;try{await n.api.transport.send(Wr.HangupCall,{})}catch(r){O.error("Failed to send hangup action",r)}if(e==="user"&&!Rs().returnToLobby){try{await n.api.transport.send(Wr.Close,{})}catch(r){O.error("Failed to send close action",r)}n.api.transport.stop(),$t.instance.logout()}};async function PU(n,e,t){await n.leaveRoomSession(),ct?await WHe(ct,e,t):await t}const zee=(n,e)=>{const[t,r]=_.useState(0);return wL(n,kt.Update,_.useCallback(()=>r(i=>i+1),[r])),_.useMemo(()=>e(n.currentState),[n,e,t])};function zHe(n){return zee(n,_.useCallback(()=>n.getMxcAvatarUrl(),[n]))}function YHe(n){const[,e]=_.useState(0);return wL(n,Je.Name,()=>e(t=>t+1)),n.name}function XHe(n){return zee(n,_.useCallback(e=>e.getJoinRule(),[]))}var nR,LU;function JHe(){return LU||(LU=1,nR=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,t=[],r=0;r<n.rangeCount;r++)t.push(n.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||t.forEach(function(i){n.addRange(i)}),e&&e.focus()}}),nR}var rR,AU;function ZHe(){if(AU)return rR;AU=1;var n=JHe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},t="Copy to clipboard: #{key}, Enter";function r(s){var o=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return s.replace(/#{\s*key\s*}/g,o)}function i(s,o){var a,c,l,u,h,p,m=!1;o||(o={}),a=o.debug||!1;try{l=n(),u=document.createRange(),h=document.getSelection(),p=document.createElement("span"),p.textContent=s,p.ariaHidden="true",p.style.all="unset",p.style.position="fixed",p.style.top=0,p.style.clip="rect(0, 0, 0, 0)",p.style.whiteSpace="pre",p.style.webkitUserSelect="text",p.style.MozUserSelect="text",p.style.msUserSelect="text",p.style.userSelect="text",p.addEventListener("copy",function(g){if(g.stopPropagation(),o.format)if(g.preventDefault(),typeof g.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var S=e[o.format]||e.default;window.clipboardData.setData(S,s)}else g.clipboardData.clearData(),g.clipboardData.setData(o.format,s);o.onCopy&&(g.preventDefault(),o.onCopy(g.clipboardData))}),document.body.appendChild(p),u.selectNodeContents(p),h.addRange(u);var v=document.execCommand("copy");if(!v)throw new Error("copy command was unsuccessful");m=!0}catch(g){a&&console.error("unable to copy using execCommand: ",g),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(o.format||"text",s),o.onCopy&&o.onCopy(window.clipboardData),m=!0}catch(S){a&&console.error("unable to copy using clipboardData: ",S),a&&console.error("falling back to prompt"),c=r("message"in o?o.message:t),window.prompt(c,s)}}finally{h&&(typeof h.removeRange=="function"?h.removeRange(u):h.removeAllRanges()),p&&document.body.removeChild(p),l()}return m}return rR=i,rR}var QHe=ZHe();const eVe=Wo(QHe);function tVe(n,e){var t=_.useState(!1),r=t[0],i=t[1],s=e;return _.useEffect(function(){},[r,s]),[r,function(){var o=eVe(n);i(o)}]}const nVe="_url_1ibuh_8",rVe="_button_1ibuh_15",iVe="_qrCode_1ibuh_19",iR={url:nVe,button:rVe,qrCode:iVe},sVe="_toast_z5w27_8",oVe={toast:sVe},aVe=({open:n,onDismiss:e,autoDismiss:t,children:r,Icon:i})=>{const s=_.useCallback(o=>{o||e()},[e]);return _.useEffect(()=>{if(n&&t!==void 0){const o=setTimeout(e,t);return()=>clearTimeout(o)}},[n,t,e]),w.jsx(tL,{open:n,onOpenChange:s,children:w.jsxs(nL,{children:[w.jsx(rL,{className:De(_a.bg,_a.animate)}),w.jsx(iL,{"aria-describedby":void 0,asChild:!0,children:w.jsxs(pz,{className:De(_a.overlay,_a.animate,oVe.toast),children:[w.jsx(sL,{asChild:!0,children:w.jsx(Xt,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&w.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]})})};var Xh={},sR,MU;function cVe(){return MU||(MU=1,sR=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),sR}var oR={},_l={},OU;function ih(){if(OU)return _l;OU=1;let n;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return _l.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},_l.getSymbolTotalCodewords=function(r){return e[r]},_l.getBCHDigit=function(t){let r=0;for(;t!==0;)r++,t>>>=1;return r},_l.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');n=r},_l.isKanjiModeEnabled=function(){return typeof n<"u"},_l.toSJIS=function(r){return n(r)},_l}var aR={},NU;function j4(){return NU||(NU=1,function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+t)}}n.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},n.from=function(r,i){if(n.isValid(r))return r;try{return e(r)}catch{return i}}}(aR)),aR}var cR,DU;function lVe(){if(DU)return cR;DU=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let r=0;r<t;r++)this.putBit((e>>>t-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},cR=n,cR}var lR,FU;function uVe(){if(FU)return lR;FU=1;function n(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return n.prototype.set=function(e,t,r,i){const s=e*this.size+t;this.data[s]=r,i&&(this.reservedBit[s]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},lR=n,lR}var uR={},UU;function dVe(){return UU||(UU=1,function(n){const e=ih().getSymbolSize;n.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,s=e(r),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let c=1;c<i-1;c++)a[c]=a[c-1]-o;return a.push(6),a.reverse()},n.getPositions=function(r){const i=[],s=n.getRowColCoords(r),o=s.length;for(let a=0;a<o;a++)for(let c=0;c<o;c++)a===0&&c===0||a===0&&c===o-1||a===o-1&&c===0||i.push([s[a],s[c]]);return i}}(uR)),uR}var dR={},jU;function hVe(){if(jU)return dR;jU=1;const n=ih().getSymbolSize,e=7;return dR.getPositions=function(r){const i=n(r);return[[0,0],[i-e,0],[0,i-e]]},dR}var hR={},$U;function fVe(){return $U||($U=1,function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};n.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},n.from=function(i){return n.isValid(i)?parseInt(i,10):void 0},n.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,c=0,l=null,u=null;for(let h=0;h<s;h++){a=c=0,l=u=null;for(let p=0;p<s;p++){let m=i.get(h,p);m===l?a++:(a>=5&&(o+=e.N1+(a-5)),l=m,a=1),m=i.get(p,h),m===u?c++:(c>=5&&(o+=e.N1+(c-5)),u=m,c=1)}a>=5&&(o+=e.N1+(a-5)),c>=5&&(o+=e.N1+(c-5))}return o},n.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let c=0;c<s-1;c++){const l=i.get(a,c)+i.get(a,c+1)+i.get(a+1,c)+i.get(a+1,c+1);(l===4||l===0)&&o++}return o*e.N2},n.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,c=0;for(let l=0;l<s;l++){a=c=0;for(let u=0;u<s;u++)a=a<<1&2047|i.get(l,u),u>=10&&(a===1488||a===93)&&o++,c=c<<1&2047|i.get(u,l),u>=10&&(c===1488||c===93)&&o++}return o*e.N3},n.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let c=0;c<o;c++)s+=i.data[c];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function t(r,i,s){switch(r){case n.Patterns.PATTERN000:return(i+s)%2===0;case n.Patterns.PATTERN001:return i%2===0;case n.Patterns.PATTERN010:return s%3===0;case n.Patterns.PATTERN011:return(i+s)%3===0;case n.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case n.Patterns.PATTERN101:return i*s%2+i*s%3===0;case n.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case n.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}n.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let c=0;c<o;c++)s.isReserved(c,a)||s.xor(c,a,t(i,c,a))},n.getBestMask=function(i,s){const o=Object.keys(n.Patterns).length;let a=0,c=1/0;for(let l=0;l<o;l++){s(l),n.applyMask(l,i);const u=n.getPenaltyN1(i)+n.getPenaltyN2(i)+n.getPenaltyN3(i)+n.getPenaltyN4(i);n.applyMask(l,i),u<c&&(c=u,a=l)}return a}}(hR)),hR}var u_={},BU;function Yee(){if(BU)return u_;BU=1;const n=j4(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],t=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return u_.getBlocksCount=function(i,s){switch(s){case n.L:return e[(i-1)*4+0];case n.M:return e[(i-1)*4+1];case n.Q:return e[(i-1)*4+2];case n.H:return e[(i-1)*4+3];default:return}},u_.getTotalCodewordsCount=function(i,s){switch(s){case n.L:return t[(i-1)*4+0];case n.M:return t[(i-1)*4+1];case n.Q:return t[(i-1)*4+2];case n.H:return t[(i-1)*4+3];default:return}},u_}var fR={},mg={},HU;function pVe(){if(HU)return mg;HU=1;const n=new Uint8Array(512),e=new Uint8Array(256);return function(){let r=1;for(let i=0;i<255;i++)n[i]=r,e[r]=i,r<<=1,r&256&&(r^=285);for(let i=255;i<512;i++)n[i]=n[i-255]}(),mg.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},mg.exp=function(r){return n[r]},mg.mul=function(r,i){return r===0||i===0?0:n[e[r]+e[i]]},mg}var VU;function mVe(){return VU||(VU=1,function(n){const e=pVe();n.mul=function(r,i){const s=new Uint8Array(r.length+i.length-1);for(let o=0;o<r.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(r[o],i[a]);return s},n.mod=function(r,i){let s=new Uint8Array(r);for(;s.length-i.length>=0;){const o=s[0];for(let c=0;c<i.length;c++)s[c]^=e.mul(i[c],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},n.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let s=0;s<r;s++)i=n.mul(i,new Uint8Array([1,e.exp(s)]));return i}}(fR)),fR}var pR,GU;function gVe(){if(GU)return pR;GU=1;const n=mVe();function e(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=n.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const i=new Uint8Array(r.length+this.degree);i.set(r);const s=n.mod(i,this.genPoly),o=this.degree-s.length;if(o>0){const a=new Uint8Array(this.degree);return a.set(s,o),a}return s},pR=e,pR}var mR={},gR={},vR={},qU;function Xee(){return qU||(qU=1,vR.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),vR}var ia={},KU;function Jee(){if(KU)return ia;KU=1;const n="[0-9]+",e="[A-Z $%*+\\-./:]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+`)(?:.|[\r
]))+`;ia.KANJI=new RegExp(t,"g"),ia.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ia.BYTE=new RegExp(r,"g"),ia.NUMERIC=new RegExp(n,"g"),ia.ALPHANUMERIC=new RegExp(e,"g");const i=new RegExp("^"+t+"$"),s=new RegExp("^"+n+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ia.testKanji=function(c){return i.test(c)},ia.testNumeric=function(c){return s.test(c)},ia.testAlphanumeric=function(c){return o.test(c)},ia}var WU;function sh(){return WU||(WU=1,function(n){const e=Xee(),t=Jee();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},n.getBestModeForData=function(s){return t.testNumeric(s)?n.NUMERIC:t.testAlphanumeric(s)?n.ALPHANUMERIC:t.testKanji(s)?n.KANJI:n.BYTE},n.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},n.isValid=function(s){return s&&s.bit&&s.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+i)}}n.from=function(s,o){if(n.isValid(s))return s;try{return r(s)}catch{return o}}}(gR)),gR}var zU;function vVe(){return zU||(zU=1,function(n){const e=ih(),t=Yee(),r=j4(),i=sh(),s=Xee(),o=7973,a=e.getBCHDigit(o);function c(p,m,v){for(let g=1;g<=40;g++)if(m<=n.getCapacity(g,v,p))return g}function l(p,m){return i.getCharCountIndicator(p,m)+4}function u(p,m){let v=0;return p.forEach(function(g){const S=l(g.mode,m);v+=S+g.getBitsLength()}),v}function h(p,m){for(let v=1;v<=40;v++)if(u(p,v)<=n.getCapacity(v,m,i.MIXED))return v}n.from=function(m,v){return s.isValid(m)?parseInt(m,10):v},n.getCapacity=function(m,v,g){if(!s.isValid(m))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=i.BYTE);const S=e.getSymbolTotalCodewords(m),b=t.getTotalCodewordsCount(m,v),R=(S-b)*8;if(g===i.MIXED)return R;const k=R-l(g,m);switch(g){case i.NUMERIC:return Math.floor(k/10*3);case i.ALPHANUMERIC:return Math.floor(k/11*2);case i.KANJI:return Math.floor(k/13);case i.BYTE:default:return Math.floor(k/8)}},n.getBestVersionForData=function(m,v){let g;const S=r.from(v,r.M);if(Array.isArray(m)){if(m.length>1)return h(m,S);if(m.length===0)return 1;g=m[0]}else g=m;return c(g.mode,g.getLength(),S)},n.getEncodedBits=function(m){if(!s.isValid(m)||m<7)throw new Error("Invalid QR Code version");let v=m<<12;for(;e.getBCHDigit(v)-a>=0;)v^=o<<e.getBCHDigit(v)-a;return m<<12|v}}(mR)),mR}var yR={},YU;function yVe(){if(YU)return yR;YU=1;const n=ih(),e=1335,t=21522,r=n.getBCHDigit(e);return yR.getEncodedBits=function(s,o){const a=s.bit<<3|o;let c=a<<10;for(;n.getBCHDigit(c)-r>=0;)c^=e<<n.getBCHDigit(c)-r;return(a<<10|c)^t},yR}var _R={},bR,XU;function _Ve(){if(XU)return bR;XU=1;const n=sh();function e(t){this.mode=n.NUMERIC,this.data=t.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let i,s,o;for(i=0;i+3<=this.data.length;i+=3)s=this.data.substr(i,3),o=parseInt(s,10),r.put(o,10);const a=this.data.length-i;a>0&&(s=this.data.substr(i),o=parseInt(s,10),r.put(o,a*3+1))},bR=e,bR}var SR,JU;function bVe(){if(JU)return SR;JU=1;const n=sh(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function t(r){this.mode=n.ALPHANUMERIC,this.data=r}return t.getBitsLength=function(i){return 11*Math.floor(i/2)+6*(i%2)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(i){let s;for(s=0;s+2<=this.data.length;s+=2){let o=e.indexOf(this.data[s])*45;o+=e.indexOf(this.data[s+1]),i.put(o,11)}this.data.length%2&&i.put(e.indexOf(this.data[s]),6)},SR=t,SR}var wR,ZU;function SVe(){if(ZU)return wR;ZU=1;const n=sh();function e(t){this.mode=n.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(t){for(let r=0,i=this.data.length;r<i;r++)t.put(this.data[r],8)},wR=e,wR}var ER,QU;function wVe(){if(QU)return ER;QU=1;const n=sh(),e=ih();function t(r){this.mode=n.KANJI,this.data=r}return t.getBitsLength=function(i){return i*13},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(r){let i;for(i=0;i<this.data.length;i++){let s=e.toSJIS(this.data[i]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[i]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},ER=t,ER}var CR={exports:{}},ej;function EVe(){return ej||(ej=1,function(n){var e={single_source_shortest_paths:function(t,r,i){var s={},o={};o[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,l,u,h,p,m,v,g,S;!a.empty();){c=a.pop(),l=c.value,h=c.cost,p=t[l]||{};for(u in p)p.hasOwnProperty(u)&&(m=p[u],v=h+m,g=o[u],S=typeof o[u]>"u",(S||g>v)&&(o[u]=v,a.push(u,v),s[u]=l))}if(typeof i<"u"&&typeof o[i]>"u"){var b=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(b)}return s},extract_shortest_path_from_predecessor_list:function(t,r){for(var i=[],s=r;s;)i.push(s),t[s],s=t[s];return i.reverse(),i},find_path:function(t,r,i){var s=e.single_source_shortest_paths(t,r,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(t){var r=e.PriorityQueue,i={},s;t=t||{};for(s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);return i.queue=[],i.sorter=t.sorter||r.default_sorter,i},default_sorter:function(t,r){return t.cost-r.cost},push:function(t,r){var i={value:t,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=e}(CR)),CR.exports}var tj;function CVe(){return tj||(tj=1,function(n){const e=sh(),t=_Ve(),r=bVe(),i=SVe(),s=wVe(),o=Jee(),a=ih(),c=EVe();function l(b){return unescape(encodeURIComponent(b)).length}function u(b,R,k){const I=[];let T;for(;(T=b.exec(k))!==null;)I.push({data:T[0],index:T.index,mode:R,length:T[0].length});return I}function h(b){const R=u(o.NUMERIC,e.NUMERIC,b),k=u(o.ALPHANUMERIC,e.ALPHANUMERIC,b);let I,T;return a.isKanjiModeEnabled()?(I=u(o.BYTE,e.BYTE,b),T=u(o.KANJI,e.KANJI,b)):(I=u(o.BYTE_KANJI,e.BYTE,b),T=[]),R.concat(k,I,T).sort(function(P,M){return P.index-M.index}).map(function(P){return{data:P.data,mode:P.mode,length:P.length}})}function p(b,R){switch(R){case e.NUMERIC:return t.getBitsLength(b);case e.ALPHANUMERIC:return r.getBitsLength(b);case e.KANJI:return s.getBitsLength(b);case e.BYTE:return i.getBitsLength(b)}}function m(b){return b.reduce(function(R,k){const I=R.length-1>=0?R[R.length-1]:null;return I&&I.mode===k.mode?(R[R.length-1].data+=k.data,R):(R.push(k),R)},[])}function v(b){const R=[];for(let k=0;k<b.length;k++){const I=b[k];switch(I.mode){case e.NUMERIC:R.push([I,{data:I.data,mode:e.ALPHANUMERIC,length:I.length},{data:I.data,mode:e.BYTE,length:I.length}]);break;case e.ALPHANUMERIC:R.push([I,{data:I.data,mode:e.BYTE,length:I.length}]);break;case e.KANJI:R.push([I,{data:I.data,mode:e.BYTE,length:l(I.data)}]);break;case e.BYTE:R.push([{data:I.data,mode:e.BYTE,length:l(I.data)}])}}return R}function g(b,R){const k={},I={start:{}};let T=["start"];for(let C=0;C<b.length;C++){const P=b[C],M=[];for(let D=0;D<P.length;D++){const F=P[D],U=""+C+D;M.push(U),k[U]={node:F,lastCount:0},I[U]={};for(let B=0;B<T.length;B++){const V=T[B];k[V]&&k[V].node.mode===F.mode?(I[V][U]=p(k[V].lastCount+F.length,F.mode)-p(k[V].lastCount,F.mode),k[V].lastCount+=F.length):(k[V]&&(k[V].lastCount=F.length),I[V][U]=p(F.length,F.mode)+4+e.getCharCountIndicator(F.mode,R))}}T=M}for(let C=0;C<T.length;C++)I[T[C]].end=0;return{map:I,table:k}}function S(b,R){let k;const I=e.getBestModeForData(b);if(k=e.from(R,I),k!==e.BYTE&&k.bit<I.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(k)+`.
 Suggested mode is: `+e.toString(I));switch(k===e.KANJI&&!a.isKanjiModeEnabled()&&(k=e.BYTE),k){case e.NUMERIC:return new t(b);case e.ALPHANUMERIC:return new r(b);case e.KANJI:return new s(b);case e.BYTE:return new i(b)}}n.fromArray=function(R){return R.reduce(function(k,I){return typeof I=="string"?k.push(S(I,null)):I.data&&k.push(S(I.data,I.mode)),k},[])},n.fromString=function(R,k){const I=h(R,a.isKanjiModeEnabled()),T=v(I),C=g(T,k),P=c.find_path(C.map,"start","end"),M=[];for(let D=1;D<P.length-1;D++)M.push(C.table[P[D]].node);return n.fromArray(m(M))},n.rawSplit=function(R){return n.fromArray(h(R,a.isKanjiModeEnabled()))}}(_R)),_R}var nj;function TVe(){if(nj)return oR;nj=1;const n=ih(),e=j4(),t=lVe(),r=uVe(),i=dVe(),s=hVe(),o=fVe(),a=Yee(),c=gVe(),l=vVe(),u=yVe(),h=sh(),p=CVe();function m(C,P){const M=C.size,D=s.getPositions(P);for(let F=0;F<D.length;F++){const U=D[F][0],B=D[F][1];for(let V=-1;V<=7;V++)if(!(U+V<=-1||M<=U+V))for(let z=-1;z<=7;z++)B+z<=-1||M<=B+z||(V>=0&&V<=6&&(z===0||z===6)||z>=0&&z<=6&&(V===0||V===6)||V>=2&&V<=4&&z>=2&&z<=4?C.set(U+V,B+z,!0,!0):C.set(U+V,B+z,!1,!0))}}function v(C){const P=C.size;for(let M=8;M<P-8;M++){const D=M%2===0;C.set(M,6,D,!0),C.set(6,M,D,!0)}}function g(C,P){const M=i.getPositions(P);for(let D=0;D<M.length;D++){const F=M[D][0],U=M[D][1];for(let B=-2;B<=2;B++)for(let V=-2;V<=2;V++)B===-2||B===2||V===-2||V===2||B===0&&V===0?C.set(F+B,U+V,!0,!0):C.set(F+B,U+V,!1,!0)}}function S(C,P){const M=C.size,D=l.getEncodedBits(P);let F,U,B;for(let V=0;V<18;V++)F=Math.floor(V/3),U=V%3+M-8-3,B=(D>>V&1)===1,C.set(F,U,B,!0),C.set(U,F,B,!0)}function b(C,P,M){const D=C.size,F=u.getEncodedBits(P,M);let U,B;for(U=0;U<15;U++)B=(F>>U&1)===1,U<6?C.set(U,8,B,!0):U<8?C.set(U+1,8,B,!0):C.set(D-15+U,8,B,!0),U<8?C.set(8,D-U-1,B,!0):U<9?C.set(8,15-U-1+1,B,!0):C.set(8,15-U-1,B,!0);C.set(D-8,8,1,!0)}function R(C,P){const M=C.size;let D=-1,F=M-1,U=7,B=0;for(let V=M-1;V>0;V-=2)for(V===6&&V--;;){for(let z=0;z<2;z++)if(!C.isReserved(F,V-z)){let H=!1;B<P.length&&(H=(P[B]>>>U&1)===1),C.set(F,V-z,H),U--,U===-1&&(B++,U=7)}if(F+=D,F<0||M<=F){F-=D,D=-D;break}}}function k(C,P,M){const D=new t;M.forEach(function(z){D.put(z.mode.bit,4),D.put(z.getLength(),h.getCharCountIndicator(z.mode,C)),z.write(D)});const F=n.getSymbolTotalCodewords(C),U=a.getTotalCodewordsCount(C,P),B=(F-U)*8;for(D.getLengthInBits()+4<=B&&D.put(0,4);D.getLengthInBits()%8!==0;)D.putBit(0);const V=(B-D.getLengthInBits())/8;for(let z=0;z<V;z++)D.put(z%2?17:236,8);return I(D,C,P)}function I(C,P,M){const D=n.getSymbolTotalCodewords(P),F=a.getTotalCodewordsCount(P,M),U=D-F,B=a.getBlocksCount(P,M),V=D%B,z=B-V,H=Math.floor(D/B),J=Math.floor(U/B),Y=J+1,G=H-J,K=new c(G);let ee=0;const q=new Array(B),Q=new Array(B);let Se=0;const Ie=new Uint8Array(C.buffer);for(let Ce=0;Ce<B;Ce++){const Ve=Ce<z?J:Y;q[Ce]=Ie.slice(ee,ee+Ve),Q[Ce]=K.encode(q[Ce]),ee+=Ve,Se=Math.max(Se,Ve)}const Ne=new Uint8Array(D);let Le=0,xe,Ee;for(xe=0;xe<Se;xe++)for(Ee=0;Ee<B;Ee++)xe<q[Ee].length&&(Ne[Le++]=q[Ee][xe]);for(xe=0;xe<G;xe++)for(Ee=0;Ee<B;Ee++)Ne[Le++]=Q[Ee][xe];return Ne}function T(C,P,M,D){let F;if(Array.isArray(C))F=p.fromArray(C);else if(typeof C=="string"){let H=P;if(!H){const J=p.rawSplit(C);H=l.getBestVersionForData(J,M)}F=p.fromString(C,H||40)}else throw new Error("Invalid data");const U=l.getBestVersionForData(F,M);if(!U)throw new Error("The amount of data is too big to be stored in a QR Code");if(!P)P=U;else if(P<U)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+U+`.
`);const B=k(P,M,F),V=n.getSymbolSize(P),z=new r(V);return m(z,P),v(z),g(z,P),b(z,M,0),P>=7&&S(z,P),R(z,B),isNaN(D)&&(D=o.getBestMask(z,b.bind(null,z,M))),o.applyMask(D,z),b(z,M,D),{modules:z,version:P,errorCorrectionLevel:M,maskPattern:D,segments:F}}return oR.create=function(P,M){if(typeof P>"u"||P==="")throw new Error("No input text");let D=e.M,F,U;return typeof M<"u"&&(D=e.from(M.errorCorrectionLevel,e.M),F=l.from(M.version),U=o.from(M.maskPattern),M.toSJISFunc&&n.setToSJISFunction(M.toSJISFunc)),T(P,F,D,U)},oR}var TR={},IR={},rj;function Zee(){return rj||(rj=1,function(n){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let r=t.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+t);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}n.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},n.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},n.getImageWidth=function(r,i){const s=n.getScale(r,i);return Math.floor((r+i.margin*2)*s)},n.qrToImageData=function(r,i,s){const o=i.modules.size,a=i.modules.data,c=n.getScale(o,s),l=Math.floor((o+s.margin*2)*c),u=s.margin*c,h=[s.color.light,s.color.dark];for(let p=0;p<l;p++)for(let m=0;m<l;m++){let v=(p*l+m)*4,g=s.color.light;if(p>=u&&m>=u&&p<l-u&&m<l-u){const S=Math.floor((p-u)/c),b=Math.floor((m-u)/c);g=h[a[S*o+b]?1:0]}r[v++]=g.r,r[v++]=g.g,r[v++]=g.b,r[v]=g.a}}}(IR)),IR}var ij;function IVe(){return ij||(ij=1,function(n){const e=Zee();function t(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(s,o,a){let c=a,l=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(l=r()),c=e.getOptions(c);const u=e.getImageWidth(s.modules.size,c),h=l.getContext("2d"),p=h.createImageData(u,u);return e.qrToImageData(p.data,s,c),t(h,l,u),h.putImageData(p,0,0),l},n.renderToDataURL=function(s,o,a){let c=a;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const l=n.render(s,o,c),u=c.type||"image/png",h=c.rendererOpts||{};return l.toDataURL(u,h.quality)}}(TR)),TR}var RR={},sj;function RVe(){if(sj)return RR;sj=1;const n=Zee();function e(i,s){const o=i.a/255,a=s+'="'+i.hex+'"';return o<1?a+" "+s+'-opacity="'+o.toFixed(2).slice(1)+'"':a}function t(i,s,o){let a=i+s;return typeof o<"u"&&(a+=" "+o),a}function r(i,s,o){let a="",c=0,l=!1,u=0;for(let h=0;h<i.length;h++){const p=Math.floor(h%s),m=Math.floor(h/s);!p&&!l&&(l=!0),i[h]?(u++,h>0&&p>0&&i[h-1]||(a+=l?t("M",p+o,.5+m+o):t("m",c,0),c=0,l=!1),p+1<s&&i[h+1]||(a+=t("h",u),u=0)):c++}return a}return RR.render=function(s,o,a){const c=n.getOptions(o),l=s.modules.size,u=s.modules.data,h=l+c.margin*2,p=c.color.light.a?"<path "+e(c.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",m="<path "+e(c.color.dark,"stroke")+' d="'+r(u,l,c.margin)+'"/>',v='viewBox="0 0 '+h+" "+h+'"',S='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+v+' shape-rendering="crispEdges">'+p+m+`</svg>
`;return typeof a=="function"&&a(null,S),S},RR}var oj;function kVe(){if(oj)return Xh;oj=1;const n=cVe(),e=TVe(),t=IVe(),r=RVe();function i(s,o,a,c,l){const u=[].slice.call(arguments,1),h=u.length,p=typeof u[h-1]=="function";if(!p&&!n())throw new Error("Callback required as last argument");if(p){if(h<2)throw new Error("Too few arguments provided");h===2?(l=a,a=o,o=c=void 0):h===3&&(o.getContext&&typeof l>"u"?(l=c,c=void 0):(l=c,c=a,a=o,o=void 0))}else{if(h<1)throw new Error("Too few arguments provided");return h===1?(a=o,o=c=void 0):h===2&&!o.getContext&&(c=a,a=o,o=void 0),new Promise(function(m,v){try{const g=e.create(a,c);m(s(g,o,c))}catch(g){v(g)}})}try{const m=e.create(a,c);l(null,s(m,o,c))}catch(m){l(m)}}return Xh.create=e.create,Xh.toCanvas=i.bind(null,t.render),Xh.toDataURL=i.bind(null,t.renderToDataURL),Xh.toString=i.bind(null,function(s,o,a){return r.render(s,a)}),Xh}var xVe=kVe();const PVe="_qrCode_h54ia_8",LVe={qrCode:PVe},AVe=({data:n,className:e})=>{const[t,r]=_.useState(null);return _.useEffect(()=>{let i=!1;return xVe.toDataURL(n,{errorCorrectionLevel:"L"}).then(s=>{i||r(s)}).catch(s=>{i||r(null)}),()=>{i=!0}},[n]),w.jsx("div",{className:De(LVe.qrCode,e),children:t&&w.jsx("img",{src:t,alt:CZ("qr_code")})})},MVe=({room:n,open:e,onDismiss:t})=>{const{t:r}=Xe(),i=wE(n.roomId),s=_.useMemo(()=>JZ(n.roomId,i,n.name),[i,n.name,n.roomId]),[,o]=tVe(s),[a,c]=_.useState(!1),l=_.useCallback(()=>c(!1),[c]),u=_.useCallback(h=>{h.stopPropagation(),o(),t(),c(!0)},[o,t]);return w.jsxs(w.Fragment,{children:[w.jsxs(th,{title:r("invite_modal.title"),open:e,onDismiss:t,children:[w.jsx(AVe,{className:iR.qrCode,data:s}),w.jsx(Xt,{className:iR.url,size:"sm",weight:"semibold",children:s}),w.jsx(Dt,{className:iR.button,Icon:KTe,onClick:u,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),w.jsx(aVe,{open:a,onDismiss:l,autoDismiss:2e3,Icon:Zz,children:r("invite_modal.link_copied_toast")})]})},OVe=({client:n,isPasswordlessUser:e,confineToRoom:t,preload:r,skipLobby:i,hideHeader:s,rtcSession:o,isJoined:a,muteStates:c,widget:l})=>{const u=_Z(o),h=Pc(U4({sounds:Wee,latencyHint:"interactive"}));_.useEffect(()=>{var Ee,Ce;u.length>=$He&&((Ce=(Ee=c.audio).setEnabled)==null||Ce.call(Ee,!1))},[]),_.useEffect(()=>(window.rtcSession=o,()=>{delete window.rtcSession}),[o]),wL(o,ts.MembershipManagerError,Ee=>{z(new ENe(kx.MEMBERSHIP_MANAGER_UNRECOVERABLE,Ee.message??Ee))}),_.useEffect(()=>{n.getRoom(o.room.roomId)!==o.room&&O.warn(`We've ended up with multiple rooms for the same ID (${o.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)},[n,o.room]);const p=o.room,{displayName:m,avatarUrl:v}=Ly(n),g=YHe(p),S=zHe(p),{perParticipantE2EE:b,returnToLobby:R}=eh(),k=wE(p.roomId),[I]=Mr(hZ);My(g);const T=_.useMemo(()=>({userId:n.getUserId(),displayName:m,avatarUrl:v,roomId:p.roomId,roomName:g,roomAlias:p.getCanonicalAlias(),roomAvatar:S,e2eeSystem:k}),[n,m,v,g,p,S,k]),C=_.useMemo(()=>new Set(u.map(Ee=>Ee.sender)).size,[u]),P=rh(),M=Pc(P),D=Pc(c),F=async(Ee,Ce,Ve)=>{try{await KHe(Ee,Ce,Ve)}catch(vt){if(vt instanceof Kv)z(vt);else{O.error("Unknown Error while entering RTC session",vt);const Jt=new Kv(vt instanceof Error?vt.message:"Unknown error",kx.UNKNOWN_ERROR,i4.UNKNOWN);z(Jt)}}};_.useEffect(()=>{const Ee=async({audioInput:Ce,videoInput:Ve})=>{var Jt,Et,Be,Zn;const vt=await Mc.getLocalDevices(void 0,!0);if(Ce){const In=OF(Ce,"audioinput",vt);In?(O.debug(`Found audio input ID ${In} for name ${Ce}`),M.current.audioInput.select(In)):(O.warn("Unknown audio input: "+Ce),(Et=(Jt=D.current.audio).setEnabled)==null||Et.call(Jt,!1))}if(Ve){const In=OF(Ve,"videoinput",vt);In?(O.debug(`Found video input ID ${In} for name ${Ve}`),M.current.videoInput.select(In)):(O.warn("Unknown video input: "+Ve),(Zn=(Be=D.current.video).setEnabled)==null||Zn.call(Be,!1))}};if(i)if(l)if(r){const Ce=Ve=>{(async()=>{await Ee(Ve.detail.data),await F(o,b,I),l.api.transport.reply(Ve.detail,{})})().catch(vt=>{O.error("Error joining RTC session",vt)})};return l.lazyActions.on(Wr.JoinCall,Ce),()=>{l.lazyActions.off(Wr.JoinCall,Ce)}}else(async()=>{await F(o,b,I)})().catch(Ce=>{O.error("Error joining RTC session",Ce)});else F(o,b,I)},[l,o,r,i,b,M,D,I]);const[U,B]=_.useState(!1),[V,z]=_.useState(null),H=Ua(),J=_.useCallback((Ee="user")=>{var Jt;const Ce=(Jt=h.current)==null?void 0:Jt.playSound("left"),Ve=!!l;B(!0);const vt=new Promise(Et=>{$t.instance.eventCallEnded.track(p.roomId,o.memberships.length,Ve,o),window.setTimeout(Et,10)});PU(o,Ee,Promise.all([Ce,vt])).then(async()=>{!e&&!t&&!$t.instance.isEnabled()&&await H("/")}).catch(Et=>{O.error("Error leaving RTC session",Et)})},[h,l,o,p.roomId,e,t,H]);_.useEffect(()=>{if(l&&a){l.api.setAlwaysOnScreen(!0).catch(Ce=>{O.error("Error calling setAlwaysOnScreen(true)",Ce)});const Ee=Ce=>{l.api.transport.reply(Ce.detail,{}),PU(o,"user").catch(Ve=>{O.error("Failed to leave RTC session",Ve)})};return l.lazyActions.once(Wr.HangupCall,Ee),()=>{l.lazyActions.off(Wr.HangupCall,Ee)}}},[l,a,o]);const Y=XHe(p),[G,K]=_.useState(!1),ee=_.useCallback(()=>K(!1),[K]),q=_.useCallback(()=>K(!0),[K]),Q=Y===Sc.Public?q:null,{t:Se}=Xe(),Ie=_.useMemo(()=>{function Ee({error:Ce,resetError:Ve}){_.useEffect(()=>{o.isJoined()&&J("error")},[Ce]);const vt=_.useCallback(()=>{B(!1),Ve(),F(o,b,I).catch(Jt=>{O.error("Error re-entering RTC session on reconnect",Jt)})},[Ve]);return Ce instanceof TZ?w.jsx(bd,{children:w.jsxs(du,{Icon:XTe,title:Se("error.connection_lost"),rageshake:!0,children:[w.jsx("p",{children:Se("error.connection_lost_description")}),w.jsx(Dt,{onClick:vt,children:Se("call_ended_view.reconnect_button")})]})}):w.jsx(cp,{error:Ce})}return Ee},[Se,o,J,b,I]);if(!JH()&&k.kind!==Vt.NONE)return w.jsx(bd,{children:w.jsx(du,{Icon:uIe,title:Se("error.e2ee_unsupported"),children:w.jsx("p",{children:Se("error.e2ee_unsupported_description")})})});const Ne=w.jsx(MVe,{room:p,open:G,onDismiss:ee}),Le=w.jsxs(w.Fragment,{children:[Ne,w.jsx(FQ,{client:n,matrixInfo:T,muteStates:c,onEnter:()=>void F(o,b,I),confineToRoom:t,hideHeader:s,participantCount:C,onShareClick:Q})]});let xe;if(V){const Ee=()=>{throw new xNe(V)};xe=w.jsx(Ee,{})}else a?xe=w.jsxs(w.Fragment,{children:[Ne,w.jsx(UHe,{client:n,matrixInfo:T,rtcSession:o,participantCount:C,onLeave:J,hideHeader:s,muteStates:c,e2eeSystem:k,onShareClick:Q})]}):U&&l===null?e||$t.instance.isEnabled()&&l===null?xe=w.jsx(rUe,{endedCallId:o.room.roomId,client:n,isPasswordlessUser:e,confineToRoom:t}):xe=null:U&&l!==null?xe=R?Le:null:r||i?xe=null:xe=Le;return w.jsx(Bw,{fallback:Ie,children:xe})},NVe="_modal_1tnec_8",DVe={modal:NVe},FVe=({roomId:n})=>{const{t:e}=Xe(),[t,r]=_.useState(!0),i=_.useCallback(a=>{a.preventDefault(),a.stopPropagation(),r(!1)},[r]),s=wE(n);s.kind===Vt.NONE&&O.error("Generating app redirect URL for encrypted room but don't have key available!");const o=_.useMemo(()=>{const a=new URL(n===null?window.location.href:JZ(n,s));a.hash=Ske(a.hash,l=>(l.set("appPrompt","false"),l.set("confineToRoom","true"),l));const c=new URL("io.element.call:/");return c.searchParams.set("url",a.toString()),c.toString()},[s,n]);return w.jsxs(th,{className:DVe.modal,title:e("app_selection_modal.title"),open:t,children:[w.jsx(Xt,{size:"md",weight:"semibold",children:e("app_selection_modal.text")}),w.jsx(Dt,{kind:"secondary",onClick:i,children:e("app_selection_modal.continue_in_browser")}),w.jsx(Dt,{as:"a",href:o,Icon:LY,children:e("app_selection_modal.open_in_app")})]})},UVe=3,jVe=3e3;async function Qee(n,e=0,...t){try{return await n.joinRoom(...t)}catch(r){if(r instanceof gn&&r.errcode==="M_FORBIDDEN"&&e<UVe)return await new Promise(i=>setTimeout(i,jVe)),Qee(n,e+1,...t);throw r}}class vb extends Error{constructor(e,t,r,i){super(t),this.icon=e,this.messageBody=r,this.reason=i}}const $Ve=(n,e,t)=>{const[r,i]=_.useState({kind:"loading"}),s=_.useRef(void 0),{t:o}=Xe(),a=_.useCallback(()=>new vb(BTe,o("group_call_loader.banned_heading"),o("group_call_loader.banned_body"),u()),[o]),c=_.useCallback(()=>new vb(Vw,o("group_call_loader.knock_reject_heading"),o("group_call_loader.knock_reject_body"),u()),[o]),l=_.useCallback(()=>new vb(mY,o("group_call_loader.call_ended_heading"),o("group_call_loader.call_ended_body"),u()),[o]),u=()=>{var h,p,m;return(m=(p=s.current)==null?void 0:p.currentState.getStateEvents(ie.RoomMember,(h=s.current)==null?void 0:h.myUserId))==null?void 0:m.getContent().reason};return _.useEffect(()=>{if(!n||!e)return;const h=async b=>{let R=null;const k=await n.getRoomIdForAlias(b.toLowerCase());return O.info(`${b} resolved to ${k.room_id}`),R=n.getRoom(k.room_id),R?O.info(`Already in room ${k.room_id}, not rejoining.`):(O.info(`Room ${k.room_id} not found, joining.`),R=await n.joinRoom(k.room_id,{viaServers:k.servers})),R},p=async(b,R,k)=>(await n.knockRoom(b,{viaServers:R}),k(),await new Promise((I,T)=>{n.on(Je.MyMembership,(C,P,M)=>{b===C.roomId&&(s.current=C,P===ze.Invite&&M===ze.Knock&&Qee(n,0,C.roomId,{viaServers:R}).then(D=>{O.log("Auto-joined %s",D.roomId),I(D)},T),P===ze.Ban&&T(a()),P===ze.Leave&&T(c()))})})),m=async()=>{let b=null;if(e[0]==="#")b=await h(e),s.current=b;else{const R=e;b=n.getRoom(R),s.current=b??void 0;const k=b==null?void 0:b.getMyMembership();if(k===ze.Join)return b;if(ct)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(k===ze.Ban)throw a();if(k===ze.Invite)b=await n.joinRoom(R,{viaServers:t});else{let I;try{I=await n.getRoomSummary(R,t)}catch(T){O.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",T)}if(I===void 0||I.join_rule===Sc.Public)b=await n.joinRoom(R,{viaServers:t});else if(I.join_rule===Sc.Knock){const T=I;let C=()=>{};const P=new Promise(M=>{T.membership!==ze.Knock?C=M:M()});i({kind:"canKnock",roomSummary:T,knock:C}),await P,b=await p(I.room_id,t,()=>i({kind:"waitForInvite",roomSummary:T}))}else throw new Error(`Room ${I.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`)}}return O.info(`Joined ${e}, waiting room to be ready for group calls`),await n.waitUntilRoomReadyForGroupCalls(b.roomId),O.info(`${e}, is ready for group calls`),b},v=async()=>{const b=await m();return s.current=b,O.debug(`Fetched / joined room ${e}`),n.matrixRTC.getRoomSession(b)},g=async()=>{n.getSyncState()!==Lr.Syncing&&(O.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise(b=>{const R=()=>{if(n.getSyncState()===Lr.Syncing)return n.off(qe.Sync,R),b()};n.on(qe.Sync,R)}),O.debug("useLoadGroupCall: client is now syncing."))},S=async()=>{await new Promise((b,R)=>{n.on(Je.MyMembership,(k,I)=>{I===ze.Leave&&R(l()),I===ze.Ban&&R(a())})})};r.kind==="loading"&&(O.log("Start loading group call"),g().then(v).then(b=>i({kind:"loaded",rtcSession:b})).then(S).catch(b=>i({kind:"failed",error:b})))},[a,n,c,l,e,r,o,t]),r};function BVe(n){const[,e]=_.useState(0);return _.useEffect(()=>{if(n!==void 0){const t=r=>{O.info(`Session in room ${n.room.roomId} changed to ${r?"joined":"left"}`),e(i=>i+1)};return n.on(ts.JoinStateChanged,t),()=>{n.off(ts.JoinStateChanged,t)}}},[n]),(n==null?void 0:n.isJoined())??!1}const HVe=()=>{const{confineToRoom:n,appPrompt:e,preload:t,hideHeader:r,displayName:i,skipLobby:s}=eh(),{t:o}=Xe(),{roomAlias:a,roomId:c,viaServers:l}=Eke(),u=c??a;u||O.error("No room specified");const{registerPasswordlessUser:h}=nQ(),[p,m]=_.useState(!1),{loading:v,authenticated:g,client:S,error:b,passwordlessUser:R}=o4(),{avatarUrl:k,displayName:I}=Ly(S),T=$Ve(S,u,l),C=BVe(T.kind==="loaded"?T.rtcSession:void 0),P=HHe(C);_.useEffect(()=>{!v&&!g&&i&&!ct&&(m(!0),h(i).catch(V=>{O.error("Failed to register passwordless user",V)}).finally(()=>{m(!1)}))},[v,g,i,m,h]);const[M,D]=mE();_.useEffect(()=>{M===null&&D&&D(!0)},[M,D]);const F=_.useRef(!1);_.useEffect(()=>{T.kind==="loaded"&&F.current&&O.log("Play join sound 'Not yet implemented'")},[T.kind]);const U=()=>{switch(T.kind){case"loaded":return w.jsx(OVe,{widget:ct,client:S,rtcSession:T.rtcSession,isJoined:C,isPasswordlessUser:R,confineToRoom:n,preload:t,skipLobby:s||F.current,hideHeader:r,muteStates:P});case"waitForInvite":case"canKnock":{F.current=F.current||T.kind==="waitForInvite";const V=T.kind==="canKnock"?T.knock:null,z=T.kind==="canKnock"?o("lobby.ask_to_join"):w.jsxs(w.Fragment,{children:[o("lobby.waiting_for_invite"),w.jsx(Zz,{})]});return w.jsx(FQ,{client:S,matrixInfo:{userId:S.getUserId()??"",displayName:I??"",avatarUrl:k??"",roomAlias:null,roomId:T.roomSummary.room_id,roomName:T.roomSummary.name??"",roomAvatar:T.roomSummary.avatar_url??null,e2eeSystem:{kind:T.roomSummary["im.nheko.summary.encryption"]?Vt.PER_PARTICIPANT:Vt.NONE}},onEnter:()=>V==null?void 0:V(),enterLabel:z,waitingForInvite:T.kind==="waitForInvite",confineToRoom:n,hideHeader:r,participantCount:null,muteStates:P,onShareClick:null})}case"loading":return w.jsx(bd,{children:w.jsx("h1",{children:o("common.loading")})});case"failed":return F.current=!1,T.error.errcode==="M_NOT_FOUND"?w.jsx(bd,{children:w.jsx(du,{Icon:iIe,title:o("error.call_not_found"),children:w.jsx(Ci,{i18nKey:"error.call_not_found_description",children:w.jsxs("p",{children:["That link doesn't appear to belong to any existing call. Check that you have the right link, or"," ",w.jsx(Aa,{to:"/",children:"create a new one"}),"."]})})})}):T.error instanceof vb?w.jsx(bd,{children:w.jsxs(du,{Icon:T.error.icon,title:T.error.message,children:[w.jsx("p",{children:T.error.messageBody}),T.error.reason&&w.jsx("p",{children:o("group_call_loader.reason",{reason:T.error.reason})})]})}):w.jsx(cp,{error:T.error});default:return w.jsx(w.Fragment,{children:" "})}};let B;return v||p?B=w.jsx(_E,{}):b?B=w.jsx(cp,{error:b}):S?u?B=U():B=w.jsx(eQ,{}):B=w.jsx(E7e,{}),w.jsxs(w.Fragment,{children:[B,e&&gt.get().app_prompt&&(wd==="android"||wd==="ios")&&c&&w.jsx(FVe,{roomId:c})]})},VVe="_banner_sye6n_8",GVe={banner:VVe},qVe=({children:n,className:e,...t})=>{const{t:r}=Xe(),i=jp();let s=!1;return(i==null?void 0:i.state)==="valid"&&(s=i.disconnected),w.jsx(w.Fragment,{children:s&&w.jsxs("div",{className:De(GVe.banner,e),...t,children:[n,r("disconnected_banner")]})})},KVe="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQvNC10L3RjiIKICB9LAogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAi0JfQsNGC0LLQvtGA0LgiLAogICAgImdvIjogItCd0LDQv9GA0LXQtCIsCiAgICAibm8iOiAi0J3QtSIsCiAgICAicmVnaXN0ZXIiOiAi0KDQtdCz0LjRgdGC0YDQsNGG0LjRjyIsCiAgICAicmVtb3ZlIjogItCf0YDQtdC80LDRhdC90LgiLAogICAgInNpZ25faW4iOiAi0JLQu9C10LciLAogICAgInNpZ25fb3V0IjogItCY0LfQu9C10LciCiAgfSwKICAiY2FsbF9lbmRlZF92aWV3IjogewogICAgImNyZWF0ZV9hY2NvdW50X2J1dHRvbiI6ICLQodGK0LfQtNCw0Lkg0LDQutCw0YPQvdGCIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+0JfQsNGJ0L4g0L3QtSDQvdCw0YHRgtGA0L7QudGC0LUg0L/QsNGA0L7Qu9CwINC30LAg0LTQsCDQt9Cw0L/QsNC30LjRgtC1INCw0LrQsNGD0L3RgtCwINGB0Lg/PC8wPjwxPtCp0LUg0LzQvtC20LXRgtC1INC00LAg0LfQsNC/0LDQt9C40YLQtSDQuNC80LXRgtC+INC4INCw0LLQsNGC0LDRgNCwINGB0Lgg0LfQsCDQsdGK0LTQtdGJ0Lgg0YDQsNC30LPQvtCy0L7RgNC4PC8xPiIsCiAgICAibm90X25vd19idXR0b24iOiAi0J3QtSDRgdC10LPQsCwg0LLRitGA0L3QuCDRgdC1INC90LAg0L3QsNGH0LDQu9C90LjRjyDQtdC60YDQsNC9IgogIH0sCiAgImNvbW1vbiI6IHsKICAgICJhdWRpbyI6ICLQl9Cy0YPQuiIsCiAgICAiYXZhdGFyIjogItCQ0LLQsNGC0LDRgCIsCiAgICAiZGlzcGxheV9uYW1lIjogItCY0LzQtS/Qv9GB0LXQstC00L7QvdC40LwiLAogICAgImhvbWUiOiAi0J3QsNGH0LDQu9C+IiwKICAgICJsb2FkaW5nIjogItCX0LDRgNC10LbQtNCw0L3QteKApiIsCiAgICAicGFzc3dvcmQiOiAi0J/QsNGA0L7Qu9CwIiwKICAgICJwcm9maWxlIjogItCf0YDQvtGE0LjQuyIsCiAgICAic2V0dGluZ3MiOiAi0J3QsNGB0YLRgNC+0LnQutC4IiwKICAgICJ1c2VybmFtZSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQuNC80LUiLAogICAgInZpZGVvIjogItCS0LjQtNC10L4iCiAgfSwKICAiam9pbl9leGlzdGluZ19jYWxsX21vZGFsIjogewogICAgImpvaW5fYnV0dG9uIjogItCU0LAsINC/0YDQuNGB0YrQtdC00LjQvdC4INGB0LUiLAogICAgInRleHQiOiAi0KLQvtC30Lgg0YDQsNC30LPQvtCy0L7RgCDQstC10YfQtSDRgdGK0YnQtdGB0YLQstGD0LLQsCwg0LjRgdC60LDRgtC1INC70Lgg0LTQsCDRgdC1INC/0YDQuNGB0YrQtdC00LjQvdC40YLQtT8iLAogICAgInRpdGxlIjogItCf0YDQuNGB0YrQtdC00LjQvdGP0LLQsNC90LUg0LrRitC8INGB0YrRidC10YHRgtCy0YPQstCw0Ykg0YDQsNC30LPQvtCy0L7RgD8iCiAgfSwKICAibGF5b3V0X3Nwb3RsaWdodF9sYWJlbCI6ICLQn9GA0L7QttC10LrRgtC+0YAiLAogICJsb2JieSI6IHsKICAgICJqb2luX2J1dHRvbiI6ICLQktC70LXQtyDQsiDRgNCw0LfQs9C+0LLQvtGA0LAiCiAgfSwKICAibG9nZ2luZ19pbiI6ICLQktC70LjQt9Cw0L3QteKApiIsCiAgImxvZ2luX2F1dGhfbGlua3MiOiAiPDA+0KHRitC30LTQsNC50YLQtSDQsNC60LDRg9C90YI8LzA+INC40LvQuCA8Mj7QktC70LXQt9GC0LUg0LrQsNGC0L4g0LPQvtGB0YI8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi0JLQu9C10LciLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItCU0YDRg9CzINC/0L7RgtGA0LXQsdC40YLQtdC7INCyINGC0L7Qt9C4INGA0LDQt9Cz0L7QstC+0YAg0LjQvNCwINC/0YDQvtCx0LvQtdC8LiDQl9CwINC00LAg0LTQuNCw0LPQvdC+0YHRgtC40YbQuNGA0LDQvNC1INGC0L7Qt9C4INC/0YDQvtCx0LvQtdC8INC/0L4t0LTQvtCx0YDQtSDQvdC4INGB0LUg0LjRgdC60LAg0LTQsCDRgdGK0LHQtdGA0LXQvCBkZWJ1ZyDQu9C+0LPQvtCy0LUuIiwKICAgICJ0aXRsZSI6ICLQl9Cw0Y/QstC60LAg0LfQsCBkZWJ1ZyDQu9C+0LPQvtCy0LUiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLQmNC30L/RgNCw0YLQtdGC0LUgZGVidWcg0LvQvtCz0L7QstC1IiwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAi0JjQt9C/0YDQsNGJ0LDQvdC14oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICJSZWNhcHRjaGEg0L7RgtGF0LLRitGA0LvQtdC90LAiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJSZWNhcHRjaGEg0L3QtSDQtSDQt9Cw0YDQtdC00LXQvdCwIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi0J/QsNGA0L7Qu9C40YLQtSDQvdC1INGB0YrQstC/0LDQtNCw0YIiLAogICAgInJlZ2lzdGVyaW5nIjogItCg0LXQs9C40YHRgtGA0LjRgNCw0L3QteKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtCS0LXRh9C1INC40LzQsNGC0LUg0LDQutCw0YPQvdGCPzwvMD48MT48MD7QktC70LXQt9GC0LUg0YEg0L3QtdCz0L48LzA+INC40LvQuCA8Mj7QktC70LXQt9GC0LUg0LrQsNGC0L4g0LPQvtGB0YI8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAi0J/QvtGC0LLRitGA0LTQuCDQv9Cw0YDQvtC70LDRgtCwIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItCS0YDRitGJ0LDQvdC1INC90LAg0L3QsNGH0LDQu9C90LjRjyDQtdC60YDQsNC9IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogItCh0L/QvtC00LXQu9C4INC10LrRgNCw0L3QsCIsCiAgInNldHRpbmdzIjogewogICAgImRldmVsb3Blcl90YWJfdGl0bGUiOiAi0KDQsNC30YDQsNCx0L7RgtGH0LjQuiIsCiAgICAiZmVlZGJhY2tfdGFiX2g0IjogItCY0LfQv9GA0LDRgtC4INC+0LHRgNCw0YLQvdCwINCy0YDRitC30LrQsCIsCiAgICAiZmVlZGJhY2tfdGFiX3NlbmRfbG9nc19sYWJlbCI6ICLQktC60LvRjtGH0LggZGVidWcg0LvQvtCz0L7QstC1IgogIH0sCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAi0JLRgdC1INC+0YnQtSDQvdC1INGB0YLQtSDRgNC10LPQuNGB0YLRgNC40YDQsNC90Lg/IDwyPtCh0YrQt9C00LDQudGC0LUg0LDQutCw0YPQvdGCPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLQktC70LXQt9GC0LUg0LIg0LDQutCw0YPQvdGC0LAg0YHQuCIsCiAgInZlcnNpb24iOiAi0JLQtdGA0YHQuNGPOiB7e3ZlcnNpb259fSIKfQo=",WVe="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICJVxb5pdmF0ZWxza8OpIG1lbnUiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogIlphdsWZw610IiwKICAgICJnbyI6ICJQb2tyYcSNb3ZhdCIsCiAgICAibm8iOiAiTmUiLAogICAgInJlZ2lzdGVyIjogIlJlZ2lzdHJhY2UiLAogICAgInJlbW92ZSI6ICJPZHN0cmFuaXQiLAogICAgInNpZ25faW4iOiAiUMWZaWhsw6FzaXQgc2UiLAogICAgInNpZ25fb3V0IjogIk9kaGzDoXNpdCBzZSIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogIlZ5dHZvxZlpdCDDusSNZXQiLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD5Qcm/EjSBuZXNrb27EjWl0IG5hc3RhdmVuw61tIGhlc2xhLCBhYnlzdGUgbW9obGkgw7rEjWV0IHBvdcW+w610IHpub3Z1PzwvMD48MT5CdWRldGUgc2kgbW9jaSBuZWNoYXQgc3bDqSBqbcOpbm8gYSBuYXN0YXZpdCBzaSBhdmF0YXIgcHJvIGJ1ZG91Y8OtIGhvdm9yeSA8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICJUZcSPIG5lLCB2csOhdGl0IHNlIG5hIGRvbW92c2tvdSBvYnJhem92a3UiCiAgfSwKICAiY29tbW9uIjogewogICAgImRpc3BsYXlfbmFtZSI6ICJab2JyYXpvdmFuw6kgam3DqW5vIiwKICAgICJob21lIjogIkRvbW92IiwKICAgICJsb2FkaW5nIjogIk5hxI3DrXTDoW7DreKApiIsCiAgICAicGFzc3dvcmQiOiAiSGVzbG8iLAogICAgInByb2ZpbGUiOiAiUHJvZmlsIiwKICAgICJzZXR0aW5ncyI6ICJOYXN0YXZlbsOtIiwKICAgICJ1c2VybmFtZSI6ICJVxb5pdmF0ZWxza8OpIGptw6lubyIKICB9LAogICJoZWFkZXJfbGFiZWwiOiAiRG9tb3YgRWxlbWVudCBDYWxsIiwKICAiam9pbl9leGlzdGluZ19jYWxsX21vZGFsIjogewogICAgImpvaW5fYnV0dG9uIjogIkFubywgcMWZaXBvaml0IHNlIiwKICAgICJ0ZXh0IjogIlRlbnRvIGhvdm9yIGppxb4gZXhpc3R1amUsIGNoY2V0ZSBzZSBwxZlpcG9qaXQ/IiwKICAgICJ0aXRsZSI6ICJQxZlpcG9qaXQgc2UgayBleGlzdHVqw61jaW11IGhvdm9ydT8iCiAgfSwKICAibGF5b3V0X3Nwb3RsaWdodF9sYWJlbCI6ICJTb3VzdMWZZWTEm27DvSBtw7NkIiwKICAibG9iYnkiOiB7CiAgICAiam9pbl9idXR0b24iOiAiUMWZaXBvaml0IHNlIGsgaG92b3J1IgogIH0sCiAgImxvZ2dpbmdfaW4iOiAiUMWZaWhsYcWhb3bDoW7DrSBzZeKApiIsCiAgImxvZ2luX2F1dGhfbGlua3MiOiAiPDA+Vnl0dm/FmWl0IMO6xI1ldDwvMD4gT3IgPDI+SmFrbyBob3N0PC8yPiIsCiAgImxvZ2luX3RpdGxlIjogIlDFmWlobMOhxaFlbsOtIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJKaW7DvSB1xb5pdmF0ZWwgdiB0b210byBob3ZvcnUgbcOhIHByb2Jsw6lteS4gQWJ5Y2hvbSBtb2hsaSBkaWFnbm9zdGlrb3ZhdCBwcm9ibMOpbSwgcsOhZGkgYnljaG9tIHNocm9tw6HFvmRpbGkgcHJvdG9rb2x5IGxhZMSbbsOtLiIsCiAgICAidGl0bGUiOiAixb3DoWRvc3QgbyBwcm90b2tvbHkgbGFkxJtuw60iCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICJQb3NsYXQgbGFkw61jw60gesOhem5hbSIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogIlBvc8OtbMOhbsOt4oCmIiwKICAicmFnZXNoYWtlX3NlbmRpbmdfbG9ncyI6ICJQb3PDrWzDoW7DrSBsYWTDrWPDrWhvIHrDoXpuYW114oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICJSZWNhcHRjaGEgYnlsYSB6YW3DrXRudXRhIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAiUmVjYXB0Y2hhIHNlIG5lbmHEjWV0bGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJIZXNsYSBzZSBtdXPDrSBzaG9kb3ZhdCIsCiAgICAicmVnaXN0ZXJpbmciOiAiUmVnaXN0cm92w6Fuw63igKYiCiAgfSwKICAicmVnaXN0ZXJfYXV0aF9saW5rcyI6ICI8MD5Vxb4gbcOhdGUgw7rEjWV0PzwvMD48MT48MD5QxZlpaGzDoXNpdCBzZTwvMD4gT3IgPDI+SmFrbyBob3N0PC8yPjwvMT4iLAogICJyZWdpc3Rlcl9jb25maXJtX3Bhc3N3b3JkX2xhYmVsIjogIlBvdHZyZGl0IGhlc2xvIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogIlZyw6F0aXQgc2UgbmEgZG9tw6Fjw60gb2JyYXpvdmt1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIlNkw61sZXQgb2JyYXpvdmt1IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJWw712b2rDocWZIiwKICAgICJmZWVkYmFja190YWJfaDQiOiAiRMOhdCBmZWVkYmFjayIsCiAgICAiZmVlZGJhY2tfdGFiX3NlbmRfbG9nc19sYWJlbCI6ICJaYWhybm91dCBsYWTDrWPDrSB6w6F6bmFteSIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogIk5lanN0ZSByZWdpc3Ryb3ZhbsOtPyA8Mj5WeXR2b8WZaXQgw7rEjWV0PC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICJQxZlpaGzDoXNpdCBzZSBrZSBzdsOpbXUgw7rEjXR1IiwKICAidmVyc2lvbiI6ICJWZXJ6ZToge3t2ZXJzaW9ufX0iCn0K",zVe=""+new URL("de-app-BVrY_LcE.json",import.meta.url).href,YVe=""+new URL("el-app-Bgiig2Nz.json",import.meta.url).href,XVe=""+new URL("en-app-CaNSxxxY.json",import.meta.url).href,JVe=""+new URL("es-app-k4RDObng.json",import.meta.url).href,ZVe=""+new URL("et-app-lXLRqT0e.json",import.meta.url).href,QVe="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLZgdmH2LHYs9iqINqp2KfYsdio2LEiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogItio2LPYqtmGIiwKICAgICJnbyI6ICLYsdmB2KrZhiIsCiAgICAibm8iOiAi2K7bjNixIiwKICAgICJyZWdpc3RlciI6ICLYq9io2KrigIzZhtin2YUiLAogICAgInJlbW92ZSI6ICLYrdiw2YEiLAogICAgInNpZ25faW4iOiAi2YjYsdmI2K8iLAogICAgInNpZ25fb3V0IjogItiu2LHZiNisIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAi2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+2obYsdinINuM2qkg2LHZhdiyINi52KjZiNixINio2LHYp9uMINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2KrZhti424zZhSDZhtmF24zigIzaqdmG24zYr9ifPC8wPjwxPti02YXYpyDZhduM4oCM2KrZiNin2YbbjNivINmG2KfZhSDYrtmI2K8g2LHYpyDYrdmB2Lgg2qnZhtuM2K8g2Ygg24zaqSDYotmI2KfYqtin2LEg2KjYsdin24wg2KrZhdin2LPigIzZh9in24wg2KLbjNmG2K/ZhyDYqNiz2KfYstuM2K88LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLYp9mE2KfZhiDZhtmH2Iwg2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCDYqNix2q/Ysdiv24zYryIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi2LXYr9inIiwKICAgICJhdmF0YXIiOiAi2KLZiNin2KrYp9ixIiwKICAgICJkaXNwbGF5X25hbWUiOiAi2YbYp9mFINmG2YXYp9uM2LTbjCIsCiAgICAiaG9tZSI6ICLYrtin2YbZhyIsCiAgICAibG9hZGluZyI6ICLYqNin2LHar9iy2KfYsduM4oCmIiwKICAgICJwYXNzd29yZCI6ICLYsdmF2LIg2LnYqNmI2LEiLAogICAgInByb2ZpbGUiOiAi2b7YsdmI2YHYp9uM2YQiLAogICAgInNldHRpbmdzIjogItiq2YbYuNuM2YXYp9iqIiwKICAgICJ1c2VybmFtZSI6ICLZhtin2YUg2qnYp9ix2KjYsduMIiwKICAgICJ2aWRlbyI6ICLZiNuM2K/bjNmIIgogIH0sCiAgImhlYWRlcl9sYWJlbCI6ICLYrtin2YbZh9mUINiq2YXYp9izINin2YTZhdmG2KoiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi2KjZhNmH2Iwg2KjZhyDYqtmF2KfYsyDYqNm+24zZiNmG2K/bjNivIiwKICAgICJ0ZXh0IjogItin24zZhiDYqtmF2KfYsyDYp9iyINmC2KjZhCDZiNis2YjYryDYr9in2LHYr9iMINmF24zigIzYrtmI2KfZh9uM2K8g2KjZvtuM2YjZhtiv24zYr9ifIiwKICAgICJ0aXRsZSI6ICLZvtuM2YjYs9iqINio2Ycg2KrZhdin2LPYnyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItmG2YjYsSDYp9mB2qnZhiIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItm+24zZiNiz2KrZhiDYqNmHINiq2YXYp9izIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi2YjYsdmI2K/igKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPtiz2KfYrtiqINit2LPYp9ioINqp2KfYsdio2LHbjDwvMD4gT3IgPDI+2K/Ys9iq2LHYs9uMINio2Ycg2LnZhtmI2KfZhiDZhduM2YfZhdin2YY8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi2YjYsdmI2K8iLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItqp2KfYsdio2LEg2K/bjNqv2LHbjCDYr9ixINin24zZhiDYqtmF2KfYsyDZhdi02qnZhNuMINiv2KfYsdivLiDYqNix2KfbjCDYqti02K7bjNi1INio2YfYqtixINmF2LTaqdmE2Iwg2KjZh9iq2LEg2KfYs9iqINmF2Kcg2YTYp9qvINi524zYqOKAjNuM2KfYqNuMINix2Kcg2KzZhdi54oCM2KLZiNix24wg2qnZhtuM2YUuIiwKICAgICJ0aXRsZSI6ICLYr9ix2K7ZiNin2LPYqiDZhNin2q8g2LnbjNio4oCM24zYp9io24wiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLYp9ix2LPYp9mEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YTigKYiLAogICJyYWdlc2hha2Vfc2VuZGluZ19sb2dzIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YQg2KjYp9qv4oCM2YfYp9uMINi524zYqOKAjNuM2KfYqNuM4oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICLYsduM2qnZvtqG2Kcg2LHYryDYtNivIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAi2qnZvtqG2Kcg2KjYp9ix2q/bjNix24wg2YbYtNivIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi2LHZhdiyINi52KjZiNixINio2KfbjNivINmH2YXYrtmI2KfZhtuMINiv2KfYtNiq2Ycg2KjYp9i02K8iLAogICAgInJlZ2lzdGVyaW5nIjogItir2KjYquKAjNmG2KfZheKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtin2LIg2YLYqNmEINit2LPYp9ioINqp2KfYsdio2LHbjCDYr9in2LHbjNiv2J88LzA+PDE+PDA+2YjYsdmI2K88LzA+IE9yIDwyPtio2Ycg2LnZhtmI2KfZhiDbjNqpINmF24zZh9mF2KfZhiDZiNin2LHYryDYtNmI24zYrzwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLYqtin24zbjNivINix2YXYsti52KjZiNixIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItio2LHar9i02Kog2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCIsCiAgInNjcmVlbnNoYXJlX2J1dHRvbl9sYWJlbCI6ICLYp9i02KrYsdin2qkg2q/YsNin2LHbjCDYtdmB2K3ZhyDZhtmF2KfbjNi0IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLYqtmI2LPYudmHINiv2YfZhtiv2YciLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICLYqNin2LLYrtmI2LHYryDYp9ix2KfYptmHINiv2YfbjNivIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIti02KfZhdmEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogItmH2YbZiNiyINir2KjYquKAjNmG2KfZhSDZhtqp2LHYr9mH4oCM2KfbjNiv2J8gPDI+2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLYqNmHINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2YjYp9ix2K8g2LTZiNuM2K8iLAogICJ2ZXJzaW9uIjogItmG2LPYrtmHOiB7e9mG2LPYrtmHfX0iCn0K",eGe=""+new URL("fr-app-DbyWYFAw.json",import.meta.url).href,tGe=""+new URL("id-app-C7u2K42_.json",import.meta.url).href,nGe=""+new URL("it-app-Brq71wxA.json",import.meta.url).href,rGe="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLjg6bjg7zjgrbjg7zjg6Hjg4vjg6Xjg7wiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogIumWieOBmOOCiyIsCiAgICAiZ28iOiAi57aa6KGMIiwKICAgICJubyI6ICLjgYTjgYTjgYgiLAogICAgInJlZ2lzdGVyIjogIueZu+mMsiIsCiAgICAicmVtb3ZlIjogIuWJiumZpCIsCiAgICAic2lnbl9pbiI6ICLjgrXjgqTjg7PjgqTjg7MiLAogICAgInNpZ25fb3V0IjogIuOCteOCpOODs+OCouOCpuODiCIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogIuOCouOCq+OCpuODs+ODiOOCkuS9nOaIkCIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi6Z+z5aOwIiwKICAgICJhdmF0YXIiOiAi44Ki44OQ44K/44O8IiwKICAgICJkaXNwbGF5X25hbWUiOiAi6KGo56S65ZCNIiwKICAgICJob21lIjogIuODm+ODvOODoCIsCiAgICAibG9hZGluZyI6ICLoqq3jgb/ovrzjgpPjgafjgYTjgb7jgZnigKYiLAogICAgInBhc3N3b3JkIjogIuODkeOCueODr+ODvOODiSIsCiAgICAicHJvZmlsZSI6ICLjg5fjg63jg5XjgqPjg7zjg6siLAogICAgInNldHRpbmdzIjogIuioreWumiIsCiAgICAidXNlcm5hbWUiOiAi44Om44O844K244O85ZCNIiwKICAgICJ2aWRlbyI6ICLjg5Pjg4fjgqoiCiAgfSwKICAiaGVhZGVyX2xhYmVsIjogIkVsZW1lbnQgQ2FsbCDjg5vjg7zjg6AiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi44Gv44GE44CB6YCa6Kmx44Gr5Y+C5YqgIiwKICAgICJ0ZXh0IjogIuOBk+OBrumAmuipseOBr+aXouOBq+WtmOWcqOOBl+OBvuOBmeOAguWPguWKoOOBl+OBvuOBmeOBi++8nyIsCiAgICAidGl0bGUiOiAi5pei5a2Y44Gu6YCa6Kmx44Gr5Y+C5Yqg44GX44G+44GZ44GL77yfIgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAi44K544Od44OD44OI44Op44Kk44OIIiwKICAibG9iYnkiOiB7CiAgICAiam9pbl9idXR0b24iOiAi6YCa6Kmx44Gr5Y+C5YqgIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi44Ot44Kw44Kk44Oz44GX44Gm44GE44G+44GZ4oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD7jgqLjgqvjgqbjg7Pjg4jjgpLkvZzmiJA8LzA+44G+44Gf44GvPDI+44Ky44K544OI44Go44GX44Gm44Ki44Kv44K744K5PC8yPiIsCiAgImxvZ2luX3RpdGxlIjogIuODreOCsOOCpOODsyIsCiAgInJhZ2VzaGFrZV9yZXF1ZXN0X21vZGFsIjogewogICAgInRpdGxlIjogIuODh+ODkOODg+OCsOODreOCsOOCkuimgeaxgiIKICB9LAogICJyYWdlc2hha2Vfc2VuZF9sb2dzIjogIuODh+ODkOODg+OCsOODreOCsOOCkumAgeS/oSIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogIumAgeS/oeOBl+OBpuOBhOOBvuOBmeKApiIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nX2xvZ3MiOiAi44OH44OQ44OD44Kw44Ot44Kw44KS6YCB5L+h44GX44Gm44GE44G+44GZ4oCmIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi44OR44K544Ov44O844OJ44GM5LiA6Ie044GZ44KL5b+F6KaB44GM44GC44KK44G+44GZIiwKICAgICJyZWdpc3RlcmluZyI6ICLnmbvpjLLjgZfjgabjgYTjgb7jgZnigKYiCiAgfSwKICAicmVnaXN0ZXJfYXV0aF9saW5rcyI6ICI8MD7ml6LjgavjgqLjgqvjgqbjg7Pjg4jjgpLjgYrmjIHjgaHjgafjgZnjgYvvvJ88LzA+PDE+PDA+44Ot44Kw44Kk44OzPC8wPuOBvuOBn+OBrzwyPuOCsuOCueODiOOBqOOBl+OBpuOCouOCr+OCu+OCuTwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLjg5Hjgrnjg6/jg7zjg4njgpLnorroqo0iLAogICJyZXR1cm5faG9tZV9idXR0b24iOiAi44Ob44O844Og55S76Z2i44Gr5oi744KLIiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIueUu+mdouWFseaciSIsCiAgInNldHRpbmdzIjogewogICAgImRldmVsb3Blcl90YWJfdGl0bGUiOiAi6ZaL55m66ICFIiwKICAgICJmZWVkYmFja190YWJfaDQiOiAi44OV44Kj44O844OJ44OQ44OD44Kv44KS6YCB5L+hIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIuODh+ODkOODg+OCsOODreOCsOOCkuWQq+OCgeOCiyIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogIuOCouOCq+OCpuODs+ODiOOBjOOBguOCiuOBvuOBm+OCk+OBi++8nyA8Mj7jgqLjgqvjgqbjg7Pjg4jjgpLkvZzmiJA8LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogIuOCouOCq+OCpuODs+ODiOOBq+ODreOCsOOCpOODsyIsCiAgInZlcnNpb24iOiAi44OQ44O844K444On44Oz77yae3t2ZXJzaW9ufX0iCn0K",iGe=""+new URL("lv-app--dkl5K2p.json",import.meta.url).href,sGe=""+new URL("pl-app-DGeQk6oM.json",import.meta.url).href,oGe=""+new URL("ro-app-C7W3EjXp.json",import.meta.url).href,aGe=""+new URL("ru-app-B-FtZqJU.json",import.meta.url).href,cGe=""+new URL("sk-app-C-Uhf1j4.json",import.meta.url).href,lGe="data:application/json;base64,ewogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiaGVhZGxpbmUiOiAie3tkaXNwbGF5TmFtZX19LCBkaXR0IHNhbXRhbCBoYXIgYXZzbHV0YXRzLiIKICB9LAogICJzdGFyX3JhdGluZ19pbnB1dF9sYWJlbF9vbmUiOiAie3tjb3VudH19IHN0asOkcm5hIiwKICAic3Rhcl9yYXRpbmdfaW5wdXRfbGFiZWxfb3RoZXIiOiAie3tjb3VudH19IHN0asOkcm5vciIKfQo=",uGe="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAiS2FwYXQiLAogICAgImdvIjogIkdpdCIsCiAgICAibm8iOiAiSGF5xLFyIiwKICAgICJyZWdpc3RlciI6ICJLYXlkb2wiLAogICAgInJlbW92ZSI6ICLDh8Sxa2FyIiwKICAgICJzaWduX2luIjogIkdpciIsCiAgICAic2lnbl9vdXQiOiAiw4fEsWsiCiAgfSwKICAiY2FsbF9lbmRlZF92aWV3IjogewogICAgImNyZWF0ZV9hY2NvdW50X2J1dHRvbiI6ICJIZXNhcCBhw6ciLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD5IZXNhYsSxbsSxesSxIHR1dG1hayBpw6dpbiBuaXllIGJpciBwYXJvbGEgYcOnbcSxeW9yc3VudXo/PC8wPjwxPkLDtnlsZWNlIGlsZXJpa2kgYXJhbWFsYXJkYSBhZMSxbsSxesSxIHZlIGF2YXRhcsSxbsSxesSxIGt1bGxhbmFiaWxlY2Vrc2luaXo8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLFnmltZGkgZGXEn2lsLCBldiBla3JhbsSxbmEgZMO2biIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiU2VzIiwKICAgICJkaXNwbGF5X25hbWUiOiAiRWtyYW4gYWTEsSIsCiAgICAiaG9tZSI6ICJFdiIsCiAgICAibG9hZGluZyI6ICJZw7xrbGVuaXlvcuKApiIsCiAgICAicGFzc3dvcmQiOiAiUGFyb2xhIiwKICAgICJzZXR0aW5ncyI6ICJBeWFybGFyIgogIH0sCiAgImpvaW5fZXhpc3RpbmdfY2FsbF9tb2RhbCI6IHsKICAgICJ0ZXh0IjogIkJ1IGFyYW1hIHphdGVuIHZhciwga2F0xLFsbWFrIGlzdGVyIG1pc2luaXo/IiwKICAgICJ0aXRsZSI6ICJNZXZjdXQgYXJhbWF5YSBrYXTEsWw/IgogIH0sCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIkFyYW1heWEga2F0xLFsIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAiR2lyaWxpeW9y4oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD5IZXNhcCBvbHXFn3R1cjwvMD4geWFodXQgPDI+S29udWsgb2xhcmFrIGdpcjwvMj4iLAogICJsb2dpbl90aXRsZSI6ICJHaXIiLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogIkJ1IGFyYW1hZGFraSBiYcWfa2EgYmlyIGt1bGxhbsSxY8SxIHNvcnVuIHlhxZ/EsXlvci4gU29ydW51IGRhaGEgaXlpIMOnw7Z6ZWJpbG1lbWl6IGnDp2luIGhhdGEgYXnEsWtsYW1hIGvDvHTDvMSfw7xuw7wgYWxtYWsgaXN0ZXJpei4iLAogICAgInRpdGxlIjogIkhhdGEgYXnEsWtsYW1hIGvDvHTDvGsgaXN0ZW1pIgogIH0sCiAgInJhZ2VzaGFrZV9zZW5kX2xvZ3MiOiAiSGF0YSBhecSxa2xhbWEga8O8dMO8xJ/DvG7DvCBnw7ZuZGVyIiwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAiR8O2bmRlcmlsaXlvcuKApiIsCiAgInJlY2FwdGNoYV9kaXNtaXNzZWQiOiAicmVDQVBUQ0hBIGF0bGFuZMSxIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAicmVDQVBUQ0hBIHnDvGtsZW5tZWRpIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAiUGFyb2xhbGFyIGF5bsSxIG9sbWFsxLEiLAogICAgInJlZ2lzdGVyaW5nIjogIktheWRlZGl5b3LigKYiCiAgfSwKICAicmVnaXN0ZXJfYXV0aF9saW5rcyI6ICI8MD5NZXZjdXQgaGVzYWLEsW7EsXogbcSxIHZhcj88LzA+PDE+PDA+R2lyPC8wPiB5YWh1dCA8Mj5Lb251ayBnaXJpxZ9pPC8yPjwvMT4iLAogICJyZWdpc3Rlcl9jb25maXJtX3Bhc3N3b3JkX2xhYmVsIjogIlBhcm9sYXnEsSB0ZWtyYXIgZWRpbiIsCiAgInJldHVybl9ob21lX2J1dHRvbiI6ICJFdiBla3JhbsSxbmEgZ2VyaSBkw7ZuIiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkVrcmFuIHBheWxhxZ8iLAogICJzZXR0aW5ncyI6IHsKICAgICJkZXZlbG9wZXJfdGFiX3RpdGxlIjogIkdlbGnFn3RpcmljaSIsCiAgICAiZmVlZGJhY2tfdGFiX2g0IjogIkdlcmkgYmlsZGlyaW0gdmVyIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIkhhdGEgYXnEsWtsYW1hIGvDvHTDvMSfw7xuw7wgZGFoaWwgZXQiCiAgfSwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfYm9keSI6ICJLYXlkb2xtYWTEsW7EsXogbcSxPyA8Mj5IZXNhcCBhw6fEsW48LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogIkhlc2FixLFuxLF6YSBnaXJpbiIKfQo=",dGe=""+new URL("uk-app-BxyP4dDT.json",import.meta.url).href,hGe="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAixJDDs25nIiwKICAgICJubyI6ICJLaMO0bmciLAogICAgInJlZ2lzdGVyIjogIsSQxINuZyBrw70iLAogICAgInNpZ25faW4iOiAixJDEg25nIG5o4bqtcCIsCiAgICAic2lnbl9vdXQiOiAixJDEg25nIHh14bqldCIsCiAgICAic3VibWl0IjogIkfhu61pIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAiVOG6oW8gdMOgaSBraG/huqNuIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+VOG6oWkgc2FvIGzhuqFpIGtow7RuZyBob8OgbiB0aGnhu4duIGLhurFuZyBjw6FjaCDEkeG6t3QgbeG6rXQga2jhuql1IMSR4buDIGdp4buvIHTDoGkga2hv4bqjbiBj4bunYSBi4bqhbj88LzA+PDE+QuG6oW4gc+G6vSBjw7MgdGjhu4MgZ2nhu68gdMOqbiB2w6AgxJHhurd0IOG6o25oIMSR4bqhaSBkaeG7h24gY2hvIG5o4buvbmcgY3Xhu5ljIGfhu41pIHRp4bq/cCB0aGVvLjwvMT4iLAogICAgImZlZWRiYWNrX2RvbmUiOiAiPDA+Q+G6o20gaMahbiB2w6wgxJHDoyBwaOG6o24gaOG7k2khPC8wPiIsCiAgICAiZmVlZGJhY2tfcHJvbXB0IjogIjwwPkNow7puZyB0w7RpIG114buRbiBuZ2hlIHBo4bqjbiBo4buTaSBj4bunYSBi4bqhbiDEkeG7gyBjw7JuIGPhuqNpIHRoaeG7h24gdHLhuqNpIG5naGnhu4dtIGNobyBi4bqhbi48LzA+IiwKICAgICJoZWFkbGluZSI6ICJ7e2Rpc3BsYXlOYW1lfX0sIGN14buZYyBn4buNaSDEkcOjIGvhur90IHRow7pjLiIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiw4JtIHRoYW5oIiwKICAgICJhdmF0YXIiOiAi4bqibmggxJHhuqFpIGRp4buHbiIsCiAgICAiZGlzcGxheV9uYW1lIjogIlTDqm4gaGnhu4NuIHRo4buLIiwKICAgICJsb2FkaW5nIjogIsSQYW5nIHThuqNp4oCmIiwKICAgICJwYXNzd29yZCI6ICJN4bqtdCBraOG6qXUiLAogICAgInByb2ZpbGUiOiAiSOG7kyBzxqEiLAogICAgInNldHRpbmdzIjogIkPDoGkgxJHhurd0IiwKICAgICJ1c2VybmFtZSI6ICJUw6puIG5nxrDhu51pIGTDuW5nIiwKICAgICJ2aWRlbyI6ICJUcnV54buBbiBow6xuaCIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAiVsOibmcsIHRoYW0gZ2lhIGN14buZYyBn4buNaSIsCiAgICAidGV4dCI6ICJDdeG7mWMgZ+G7jWkgxJHDoyB04buTbiB04bqhaSwgYuG6oW4gY8OzIG114buRbiB0aGFtIGdpYSBraMO0bmc/IiwKICAgICJ0aXRsZSI6ICJUaGFtIGdpYSBjdeG7mWMgZ+G7jWk/IgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAiVGnDqnUgxJFp4buDbSIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIlRoYW0gZ2lhIGN14buZYyBn4buNaSIKICB9LAogICJsb2dnaW5nX2luIjogIsSQYW5nIMSRxINuZyBuaOG6rXDigKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPlThuqFvIHTDoGkga2hv4bqjbjwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBraMOhYzwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLEkMSDbmcgbmjhuq1wIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJN4buZdCBuZ8aw4budaSBkw7luZyBraMOhYyB0cm9uZyBjdeG7mWMgZ+G7jWkgxJFhbmcgZ+G6t3AgduG6pW4gxJHhu4EuIMSQ4buDIGPDsyB0aOG7gyBjaOG6qW4gxJFvw6FuIHThu5F0IGjGoW4gY2jDum5nIHTDtGkgbXXhu5FuIHRodSB0aOG6rXAgbmjhuq10IGvDvSBn4buhIGzhu5dpLiIsCiAgICAidGl0bGUiOiAiWcOqdSBj4bqndSBuaOG6rXQga8O9IGfhu6EgbOG7l2kiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAixJBhbmcgZ+G7rWnigKYiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJDaMawYSB04bqjaSDEkcaw4bujYyBSZWNhcHRjaGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJN4bqtdCBraOG6qXUgcGjhuqNpIGto4bubcCIsCiAgICAicmVnaXN0ZXJpbmciOiAixJBhbmcgxJHEg25nIGvDveKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPsSQw6MgY8OzIHTDoGkga2hv4bqjbj88LzA+PDE+PDA+xJDEg25nIG5o4bqtcDwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBLaMOhY2g8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAiWMOhYyBuaOG6rW4gbeG6rXQga2jhuql1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkNoaWEgc+G6uyBtw6BuIGjDrG5oIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJOaMOgIHBow6F0IHRyaeG7g24iLAogICAgImZlZWRiYWNrX3RhYl9kZXNjcmlwdGlvbl9sYWJlbCI6ICJQaOG6o24gaOG7k2kgY+G7p2EgYuG6oW4iLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICJH4butaSBwaOG6o24gaOG7k2kiLAogICAgImZlZWRiYWNrX3RhYl9zZW5kX2xvZ3NfbGFiZWwiOiAiS8OobSB0aGVvIG5o4bqtdCBrw70gZ+G7oSBs4buXaSIsCiAgICAiZmVlZGJhY2tfdGFiX3RoYW5rX3lvdSI6ICJD4bqjbSDGoW4sIGNow7puZyB0w7RpIMSRw6Mgbmjhuq1uIMSRxrDhu6NjIHBo4bqjbiBo4buTaSEiLAogICAgImZlZWRiYWNrX3RhYl90aXRsZSI6ICJQaOG6o24gaOG7k2kiCiAgfSwKICAic3VibWl0dGluZyI6ICLEkGFuZyBn4butaeKApiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAiQ2jGsGEgxJHEg25nIGvDvT8gPDI+VOG6oW8gdMOgaSBraG/huqNuPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGPhu6dhIGLhuqFuIiwKICAidmVyc2lvbiI6ICJQaGnDqm4gYuG6o246IHt7dmVyc2lvbn19Igp9Cg==",fGe=""+new URL("zh-Hans-app-CCvn5Yaa.json",import.meta.url).href,pGe=""+new URL("zh-Hant-app-bsZKL_R6.json",import.meta.url).href,{slice:mGe,forEach:gGe}=[];function vGe(n){return gGe.call(mGe.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}const aj=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,yGe=function(n,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let s=`${n}=${i}`;if(r.maxAge>0){const o=r.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(o)}`}if(r.domain){if(!aj.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!aj.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s},cj={create(n,e,t,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+t*60*1e3)),r&&(i.domain=r),document.cookie=yGe(n,encodeURIComponent(e),i)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let r=0;r<t.length;r++){let i=t[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(n){this.create(n,"",-1)}};var _Ge={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return cj.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:r,cookieDomain:i,cookieOptions:s}=e;t&&typeof document<"u"&&cj.create(t,n,r,i,s)}},bGe={name:"querystring",lookup(n){var r;let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const o=i.substring(1).split("&");for(let a=0;a<o.length;a++){const c=o[a].indexOf("=");c>0&&o[a].substring(0,c)===e&&(t=o[a].substring(c+1))}}return t}};let Jh=null;const lj=()=>{if(Jh!==null)return Jh;try{if(Jh=typeof window<"u"&&window.localStorage!==null,!Jh)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{Jh=!1}return Jh};var SGe={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&lj())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&lj()&&window.localStorage.setItem(t,n)}};let Zh=null;const uj=()=>{if(Zh!==null)return Zh;try{if(Zh=typeof window<"u"&&window.sessionStorage!==null,!Zh)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{Zh=!1}return Zh};var wGe={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&uj())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&uj()&&window.sessionStorage.setItem(t,n)}},EGe={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:r,language:i}=navigator;if(t)for(let s=0;s<t.length;s++)e.push(t[s]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},CGe={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(t=r.getAttribute("lang")),t}},TGe={name:"path",lookup(n){var i;let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(i=t[typeof e=="number"?e:0])==null?void 0:i.replace("/",""):void 0}},IGe={name:"subdomain",lookup(n){var i,s;let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,r=typeof window<"u"&&((s=(i=window.location)==null?void 0:i.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[t]}};let ete=!1;try{document.cookie,ete=!0}catch{}const tte=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];ete||tte.splice(1,1);const RGe=()=>({order:tte,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class nte{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=vGe(t,this.options||{},RGe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(_Ge),this.addDetector(bGe),this.addDetector(SGe),this.addDetector(wGe),this.addDetector(EGe),this.addDetector(CGe),this.addDetector(TGe),this.addDetector(IGe)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(t=t.concat(i))}}),t=t.map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}nte.type="languageDetector";var d_={},dj;function kGe(){if(dj)return d_;dj=1,Object.defineProperty(d_,"__esModule",{value:!0}),d_.shouldPolyfill=n;function n(){return!Intl.Segmenter}return d_}var xGe=kGe(),h_={},hj;function PGe(){if(hj)return h_;hj=1,Object.defineProperty(h_,"__esModule",{value:!0}),h_.shouldPolyfill=n;function n(){return typeof Intl>"u"||!("DurationFormat"in Intl)}return h_}var LGe=PGe();const rte=Object.assign({"../locales/bg/app.json":KVe,"../locales/cs/app.json":WVe,"../locales/de/app.json":zVe,"../locales/el/app.json":YVe,"../locales/en/app.json":XVe,"../locales/es/app.json":JVe,"../locales/et/app.json":ZVe,"../locales/fa/app.json":QVe,"../locales/fr/app.json":eGe,"../locales/id/app.json":tGe,"../locales/it/app.json":nGe,"../locales/ja/app.json":rGe,"../locales/lv/app.json":iGe,"../locales/pl/app.json":sGe,"../locales/ro/app.json":oGe,"../locales/ru/app.json":aGe,"../locales/sk/app.json":cGe,"../locales/sv/app.json":lGe,"../locales/tr/app.json":uGe,"../locales/uk/app.json":dGe,"../locales/vi/app.json":hGe,"../locales/zh-Hans/app.json":fGe,"../locales/zh-Hant/app.json":pGe}),AGe=(n,e)=>rte[`../locales/${n}/${e}.json`],MGe=[...new Set(Object.keys(rte).map(n=>{var t;const e=(t=n.match(/\/([^/]+)\/[^/]+\.json$/))==null?void 0:t[1];if(!e)throw new Error(`Could not parse locale URL ${n}`);return e}))],OGe={type:"backend",init(){},read(n,e,t){(async()=>{const r=AGe(n,e);if(!r)throw new Error(`Namespace ${e} for locale ${n} not found`);const i=await fetch(r,{credentials:"omit",headers:{Accept:"application/json"}});if(RL(i))throw Error(`Failed to fetch ${r}`);return await i.json()})().then(r=>t(null,r),r=>t(r,null))}};class NGe{constructor(){this.config=0,this.sentry=0,this.openTelemetry=0}allDepsAreLoaded(){return!Object.values(this).some(e=>e!==2)}}class Us{constructor(){this.isInitialized=!1,this.loadStates=new NGe}static isInitialized(){var e;return(e=Us.internalInstance)==null?void 0:e.isInitialized}static async initBeforeReact(){const e=[];xGe.shouldPolyfill()&&e.push(rv(()=>import("./polyfill-force--UtEEfcF.js").then(s=>s.p),__vite__mapDeps([2,3]),import.meta.url)),LGe.shouldPolyfill()&&e.push(rv(()=>import("./polyfill-force-BPMH2I58.js").then(s=>s.p),__vite__mapDeps([4,3]),import.meta.url)),await Promise.all(e);const t=new nte;t.addDetector({name:"urlFragment",lookup:()=>Rs().lang??void 0}),await fi.use(OGe).use(t).use(FTe).init({fallbackLng:"en",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",supportedLngs:MGe,interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}});const{fonts:r,fontScale:i}=Rs();i!==null&&document.documentElement.style.setProperty("--font-scale",i.toString()),r.length>0&&document.documentElement.style.setProperty("--font-family",r.map(s=>`"${s}"`).join(", ")),document.body.setAttribute("data-platform",wd)}static init(){var e;return(e=Us==null?void 0:Us.internalInstance)!=null&&e.initPromise?null:(Us.internalInstance=new Us,Us.internalInstance.initPromise=new Promise(t=>{Us.internalInstance.initStep(t)}),Us.internalInstance.initPromise)}initStep(e){var t,r,i,s;this.loadStates.config===0&&(this.loadStates.config=1,gt.init().then(()=>{this.loadStates.config=2,this.initStep(e)},o=>{O.error("Failed to load config",o)})),this.loadStates.sentry===0&&this.loadStates.config===2&&((t=gt.get().sentry)!=null&&t.DSN&&((r=gt.get().sentry)!=null&&r.environment)&&yye({dsn:(i=gt.get().sentry)==null?void 0:i.DSN,environment:(s=gt.get().sentry)==null?void 0:s.environment,integrations:[Fye({useEffect:Re.useEffect,useLocation:hi,useNavigationType:Ide,createRoutesFromChildren:Xb,matchRoutes:n6})],tracesSampleRate:1}),this.loadStates.sentry=2),this.loadStates.openTelemetry===0&&this.loadStates.config===2&&(vE.globalInit(),this.loadStates.openTelemetry=2),this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const DGe=()=>{const[n,e]=_.useState(()=>Rs().theme),t=_.useRef(document.body.classList.item(0));_.useEffect(()=>{if(ct){const r=i=>{i.preventDefault(),"name"in i.detail.data&&typeof i.detail.data.name=="string"&&e(i.detail.data.name),ct.api.transport.reply(i.detail,{})};return ct.lazyActions.on(fr.ThemeChange,r),()=>{ct.lazyActions.off(fr.ThemeChange,r)}}},[]),_.useLayoutEffect(()=>{const r=n!=null&&n.includes("light")?"light":"dark",i=n!=null&&n.includes("high-contrast")?"-hc":"",s="cpd-theme-"+r+i;s!==t.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(s),t.current=s),document.body.classList.remove("no-theme")},[t,n])},f_=Uye(kV),FGe=({children:n})=>{const{pathname:e}=hi();return _.useEffect(()=>{let t="";!["/login","/register"].includes(e)&&!ct&&(t="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=t},[e]),w.jsx(w.Fragment,{children:n})},UGe=({children:n})=>(DGe(),n),jGe=()=>{const[n,e]=_.useState(!1);return _.useEffect(()=>{var t;(t=Us.init())==null||t.then(async()=>{n||(e(!0),await(ct==null?void 0:ct.api.sendContentLoaded()))}).catch(O.error)}),w.jsx(hhe,{children:w.jsx(FGe,{children:w.jsx(UGe,{children:w.jsx(Gq,{children:n?w.jsx(_.Suspense,{fallback:null,children:w.jsx(PNe,{children:w.jsx(w8e,{children:w.jsxs(Bw,{fallback:cp,children:[w.jsx(qVe,{}),w.jsxs(Hde,{children:[w.jsx(f_,{path:"/",element:w.jsx(eQ,{})}),w.jsx(f_,{path:"/login",element:w.jsx(g7e,{})}),w.jsx(f_,{path:"/register",element:w.jsx(v7e,{})}),w.jsx(f_,{path:"*",element:w.jsx(HVe,{})})]})]})})})}):w.jsx(_E,{})})})})})};window.setLKLogLevel=vH;Lke().catch(n=>{O.error("Failed to initialize rageshake",n)});vH("warn");Qce((n,e,t)=>{global.mx_rage_logger.log(n,"livekit",e,t)});O.info("Element Call embedded-v0.9.0-release-test.3");const Jx=wae.createRoot(document.getElementById("root"));let tv=null;window.isSecureContext?navigator.mediaDevices||(tv=new Error("Your browser does not support WebRTC.")):tv=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(tv!==null)throw Jx.render(tv.message),tv;Us.initBeforeReact().then(()=>{Jx.render(w.jsx(_.StrictMode,{children:w.jsx(jGe,{})}))}).catch(n=>{O.error("Failed to initialize app",n),Jx.render(n.message)});export{YGe as A,doe as B,gt as C,loe as D,ie as E,Es as F,mn as G,gw as H,uoe as I,yc as J,ze as K,GGe as L,gn as M,A5 as N,rk as O,hoe as P,foe as Q,tr as R,zu as S,Xn as T,XGe as U,Id as V,moe as W,io as _,BGe as a,oo as b,$Ge as c,zGe as d,VGe as e,vF as f,Wo as g,lr as h,zZ as i,de as j,_f as k,O as l,Ae as m,aw as n,u$ as o,cB as p,Xoe as q,sy as r,Td as s,tqe as t,zo as u,Xl as v,ur as w,boe as x,y_ as y,JGe as z};
//# sourceMappingURL=index-DFHdYQ7O.js.map
